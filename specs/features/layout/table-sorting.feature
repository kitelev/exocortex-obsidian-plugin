# language: ru
@sorting @implemented
Функция: Интерактивная сортировка таблиц

  Как пользователь Exocortex плагина
  Я хочу сортировать таблицы по разным колонкам
  Чтобы быстро находить нужную информацию

  Предыстория:
    Дано существует заметка с Universal Layout таблицей
    И таблица содержит заметки:
      | Name      | exo__Instance_class | exo__Status | Modified   |
      | Задача C  | [[ems__Task]]       | Готово      | 2025-10-01 |
      | Задача A  | [[ems__Area]]       | В работе    | 2025-10-03 |
      | Задача B  | [[ems__Task]]       | Новая       | 2025-10-02 |

  Правило: Сортировка по колонке Name

    Сценарий: Первый клик - сортировка по возрастанию
      Когда я кликаю на заголовок "Name"
      Тогда таблица сортируется по возрастанию
      И порядок строк:
        | Задача A |
        | Задача B |
        | Задача C |
      И заголовок "Name" имеет класс "sorted-asc"
      И заголовок "Name" содержит символ "▲"

    Сценарий: Второй клик - сортировка по убыванию
      Дано я кликнул на заголовок "Name" один раз
      И таблица отсортирована по возрастанию
      Когда я снова кликаю на заголовок "Name"
      Тогда таблица сортируется по убыванию
      И порядок строк:
        | Задача C |
        | Задача B |
        | Задача A |
      И заголовок "Name" имеет класс "sorted-desc"
      И заголовок "Name" содержит символ "▼"
      И НЕ содержит символ "▲"

    Сценарий: Третий клик - возврат к возрастанию
      Дано я кликнул на заголовок "Name" дважды
      И таблица отсортирована по убыванию
      Когда я снова кликаю на заголовок "Name"
      Тогда таблица снова сортируется по возрастанию
      И заголовок "Name" имеет класс "sorted-asc"

  Правило: Сортировка по Instance Class

    Сценарий: Сортировка по Instance Class работает корректно
      Когда я кликаю на заголовок "exo__Instance_class"
      Тогда таблица сортируется по значению Instance Class
      И порядок строк:
        | Задача A |  # ems__Area
        | Задача C |  # ems__Task
        | Задача B |  # ems__Task
      И заголовок "exo__Instance_class" имеет класс "sorted-asc"

    Сценарий: Instance Class извлекается из метаданных
      Дано заметка имеет Instance Class "[[ems__Task]]"
      Когда выполняется сортировка по "exo__Instance_class"
      Тогда для сортировки используется значение "ems__Task"
      И НЕ используется "[[ems__Task]]"

  Правило: Сортировка по дополнительным свойствам

    Сценарий: Сортировка по кастомному свойству
      Дано конфигурация включает:
        """yaml
        showProperties:
          - exo__Status
        """
      Когда я кликаю на заголовок "exo__Status"
      Тогда таблица сортируется по значению "exo__Status"
      И порядок строк:
        | Задача A |  # В работе
        | Задача C |  # Готово
        | Задача B |  # Новая

    Сценарий: Все кастомные свойства сортируемые
      Дано конфигурация включает:
        """yaml
        showProperties:
          - exo__Priority
          - exo__Status
          - exo__Assignee
        """
      Тогда заголовки "exo__Priority", "exo__Status", "exo__Assignee" имеют класс "sortable"
      И клик по любому заголовку вызывает сортировку

  Правило: Индикаторы сортировки

    Сценарий: Только одна колонка имеет индикатор
      Дано таблица отсортирована по "Name"
      И заголовок "Name" имеет класс "sorted-asc"
      Когда я кликаю на заголовок "exo__Instance_class"
      Тогда заголовок "Name" НЕ имеет класс "sorted-asc"
      И заголовок "Name" НЕ содержит символы "▲" или "▼"
      И заголовок "exo__Instance_class" имеет класс "sorted-asc"
      И заголовок "exo__Instance_class" содержит символ "▲"

    Сценарий: Стрелки обновляются при изменении направления
      Дано заголовок "Name" содержит "▲"
      Когда я кликаю на "Name" для изменения направления
      Тогда символ "▲" заменяется на "▼"
      И одновременно присутствует только один символ

  Правило: Состояние сортировки

    Сценарий: Начальная сортировка по Name ascending
      Когда таблица рендерится первый раз
      Тогда таблица автоматически сортируется по "Name"
      И направление сортировки "asc"
      И заголовок "Name" имеет начальное состояние

    Сценарий: Сохранение состояния сортировки в группах
      Дано включена группировка по Instance Class
      И в группе "ems__Task" я отсортировал по "Name" по убыванию
      Когда я сортирую группу "ems__Project" по "exo__Status"
      Тогда состояние сортировки группы "ems__Task" сохраняется
      И группа "ems__Task" остаётся отсортированной по "Name" desc
      И группа "ems__Project" сортируется по "exo__Status"

  Правило: Обработка специальных значений

    Сценарий: Сортировка с пустыми значениями
      Дано таблица содержит заметки:
        | Name     | exo__Status |
        | Задача 1 | Готово      |
        | Задача 2 | (пусто)     |
        | Задача 3 | В работе    |
      Когда я сортирую по "exo__Status"
      Тогда пустые значения помещаются в конец списка
      И порядок строк:
        | Задача 1 |  # Готово
        | Задача 3 |  # В работе
        | Задача 2 |  # (пусто)

    Сценарий: Сортировка дат
      Дано таблица содержит колонку "Modified" с датами
      Когда я сортирую по "Modified"
      Тогда даты сортируются хронологически
      И не как строки

    Сценарий: Сортировка чисел
      Дано таблица содержит колонку с числовыми значениями
      Когда я сортирую по этой колонке
      Тогда числа сортируются численно
      И не лексикографически
      Примечание: 2 < 10 (не "10" < "2")
