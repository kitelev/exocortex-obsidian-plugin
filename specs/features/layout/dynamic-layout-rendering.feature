# language: ru
Функция: Рендеринг Dynamic Layout

  Как пользователь Exocortex плагина
  Я хочу использовать предустановленные макеты для разных типов заметок
  Чтобы автоматически получать оптимальное отображение контента

  Предыстория:
    Дано Obsidian vault с установленным Exocortex плагином
    И существует файл макета "layouts/ems__Project.md"

  Сценарий: Автоматическое применение макета по Instance Class
    Дано существует заметка "Новый Проект" с метаданными:
      | Свойство            | Значение        |
      | exo__Instance_class | [[ems__Project]] |
    Когда я открываю заметку "Новый Проект"
    Тогда плагин загружает макет из "layouts/ems__Project.md"
    И рендерит страницу согласно макету

  Сценарий: Fallback на дефолтный макет
    Дано существует заметка "Обычная Заметка" без метаданных
    Когда я открываю заметку "Обычная Заметка"
    Тогда плагин использует дефолтный макет
    И отображает базовую информацию о заметке

  Сценарий: Макет с секциями
    Дано файл макета "layouts/ems__Project.md" содержит:
      """markdown
      ## Информация о проекте

      ```exocortex-dynamic
      section: info
      ```

      ## Связанные задачи

      ```exocortex-dynamic
      section: tasks
      query: |
        WHERE exo__Parent = [[{current}]]
        AND exo__Instance_class = [[ems__Task]]
      ```
      """
    И существует заметка "Мой Проект" класса "ems__Project"
    Когда я открываю заметку "Мой Проект"
    Тогда я вижу секцию "Информация о проекте"
    И я вижу секцию "Связанные задачи"
    И секция "Связанные задачи" содержит таблицу с задачами

  Сценарий: Кеширование макетов
    Дано существует файл макета "layouts/ems__Task.md"
    И я открыл заметку "Задача 1" класса "ems__Task"
    Когда я открываю заметку "Задача 2" класса "ems__Task"
    Тогда плагин использует закешированный макет
    И не выполняет повторное чтение файла

  Сценарий: Обновление макета при изменении файла
    Дано существует файл макета "layouts/ems__Area.md"
    И я открыл заметку "Моя Область" класса "ems__Area"
    Когда я редактирую файл "layouts/ems__Area.md"
    И сохраняю изменения
    Тогда кеш макета "ems__Area" инвалидируется
    И при следующем открытии заметки класса "ems__Area" загружается обновлённый макет
