# Test Result Analyzer Dockerfile
FROM node:20-alpine

# Install system dependencies
RUN apk add --no-cache \
    jq \
    bash \
    curl \
    imagemagick \
    ffmpeg

# Install Node.js dependencies for analysis
WORKDIR /workspace
RUN npm install -g \
    sharp@0.33.4 \
    pixelmatch@5.3.0 \
    pngjs@7.0.0

# Copy analyzer scripts
COPY analyze-results.js /usr/local/bin/
COPY generate-visual-diff.js /usr/local/bin/
COPY create-video-summary.sh /usr/local/bin/

RUN chmod +x /usr/local/bin/*

# Default command
CMD ["node", "/usr/local/bin/analyze-results.js"]