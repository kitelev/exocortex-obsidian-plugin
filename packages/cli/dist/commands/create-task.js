import { Command } from "commander";
import chalk from "chalk";
import ora from "ora";
import * as path from "path";
import { TaskCreationService, AssetClass } from "@exocortex/core";
import { FileSystemVaultAdapter } from "../adapters/FileSystemVaultAdapter.js";
export function createTaskCommand() {
    const cmd = new Command("task");
    cmd
        .description("Create a new task from an area or project")
        .requiredOption("-s, --source <path>", "Path to source file (area or project)")
        .option("-l, --label <label>", "Task label")
        .option("--size <size>", "Task size")
        .option("-r, --root <path>", "Root directory of vault", process.cwd())
        .action(async (options) => {
        const spinner = ora("Creating task...").start();
        try {
            const adapter = new FileSystemVaultAdapter(options.root);
            const service = new TaskCreationService(adapter);
            const sourcePath = path.relative(options.root, options.source);
            const metadata = await adapter.getFileMetadata(sourcePath);
            let sourceClass = AssetClass.AREA;
            if (metadata.exo__Instance_class) {
                const classes = Array.isArray(metadata.exo__Instance_class)
                    ? metadata.exo__Instance_class
                    : [metadata.exo__Instance_class];
                const normalizedClass = classes[0]?.replace(/["'[\]]/g, "").trim();
                if (normalizedClass === AssetClass.PROJECT) {
                    sourceClass = AssetClass.PROJECT;
                }
                else if (normalizedClass === AssetClass.TASK_PROTOTYPE) {
                    sourceClass = AssetClass.TASK_PROTOTYPE;
                }
            }
            const createdPath = await service.createTask(sourcePath, metadata, sourceClass, options.label, options.size || null);
            spinner.succeed(chalk.green(`Task created: ${createdPath}`));
        }
        catch (error) {
            spinner.fail(chalk.red(`Failed to create task: ${error.message}`));
            process.exit(1);
        }
    });
    return cmd;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY3JlYXRlLXRhc2suanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9zcmMvY29tbWFuZHMvY3JlYXRlLXRhc2sudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLE9BQU8sRUFBRSxNQUFNLFdBQVcsQ0FBQztBQUNwQyxPQUFPLEtBQUssTUFBTSxPQUFPLENBQUM7QUFDMUIsT0FBTyxHQUFHLE1BQU0sS0FBSyxDQUFDO0FBQ3RCLE9BQU8sS0FBSyxJQUFJLE1BQU0sTUFBTSxDQUFDO0FBQzdCLE9BQU8sRUFBRSxtQkFBbUIsRUFBRSxVQUFVLEVBQUUsTUFBTSxpQkFBaUIsQ0FBQztBQUNsRSxPQUFPLEVBQUUsc0JBQXNCLEVBQUUsTUFBTSx1Q0FBdUMsQ0FBQztBQUUvRSxNQUFNLFVBQVUsaUJBQWlCO0lBQy9CLE1BQU0sR0FBRyxHQUFHLElBQUksT0FBTyxDQUFDLE1BQU0sQ0FBQyxDQUFDO0lBRWhDLEdBQUc7U0FDQSxXQUFXLENBQUMsMkNBQTJDLENBQUM7U0FDeEQsY0FBYyxDQUNiLHFCQUFxQixFQUNyQix1Q0FBdUMsQ0FDeEM7U0FDQSxNQUFNLENBQUMscUJBQXFCLEVBQUUsWUFBWSxDQUFDO1NBQzNDLE1BQU0sQ0FBQyxlQUFlLEVBQUUsV0FBVyxDQUFDO1NBQ3BDLE1BQU0sQ0FBQyxtQkFBbUIsRUFBRSx5QkFBeUIsRUFBRSxPQUFPLENBQUMsR0FBRyxFQUFFLENBQUM7U0FDckUsTUFBTSxDQUFDLEtBQUssRUFBRSxPQUFPLEVBQUUsRUFBRTtRQUN4QixNQUFNLE9BQU8sR0FBRyxHQUFHLENBQUMsa0JBQWtCLENBQUMsQ0FBQyxLQUFLLEVBQUUsQ0FBQztRQUVoRCxJQUFJLENBQUM7WUFDSCxNQUFNLE9BQU8sR0FBRyxJQUFJLHNCQUFzQixDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsQ0FBQztZQUN6RCxNQUFNLE9BQU8sR0FBRyxJQUFJLG1CQUFtQixDQUFDLE9BQU8sQ0FBQyxDQUFDO1lBRWpELE1BQU0sVUFBVSxHQUFHLElBQUksQ0FBQyxRQUFRLENBQUMsT0FBTyxDQUFDLElBQUksRUFBRSxPQUFPLENBQUMsTUFBTSxDQUFDLENBQUM7WUFDL0QsTUFBTSxRQUFRLEdBQUcsTUFBTSxPQUFPLENBQUMsZUFBZSxDQUFDLFVBQVUsQ0FBQyxDQUFDO1lBRTNELElBQUksV0FBVyxHQUFHLFVBQVUsQ0FBQyxJQUFJLENBQUM7WUFDbEMsSUFBSSxRQUFRLENBQUMsbUJBQW1CLEVBQUUsQ0FBQztnQkFDakMsTUFBTSxPQUFPLEdBQUcsS0FBSyxDQUFDLE9BQU8sQ0FBQyxRQUFRLENBQUMsbUJBQW1CLENBQUM7b0JBQ3pELENBQUMsQ0FBQyxRQUFRLENBQUMsbUJBQW1CO29CQUM5QixDQUFDLENBQUMsQ0FBQyxRQUFRLENBQUMsbUJBQW1CLENBQUMsQ0FBQztnQkFFbkMsTUFBTSxlQUFlLEdBQUcsT0FBTyxDQUFDLENBQUMsQ0FBQyxFQUFFLE9BQU8sQ0FBQyxVQUFVLEVBQUUsRUFBRSxDQUFDLENBQUMsSUFBSSxFQUFFLENBQUM7Z0JBQ25FLElBQUksZUFBZSxLQUFLLFVBQVUsQ0FBQyxPQUFPLEVBQUUsQ0FBQztvQkFDM0MsV0FBVyxHQUFHLFVBQVUsQ0FBQyxPQUFPLENBQUM7Z0JBQ25DLENBQUM7cUJBQU0sSUFBSSxlQUFlLEtBQUssVUFBVSxDQUFDLGNBQWMsRUFBRSxDQUFDO29CQUN6RCxXQUFXLEdBQUcsVUFBVSxDQUFDLGNBQWMsQ0FBQztnQkFDMUMsQ0FBQztZQUNILENBQUM7WUFFRCxNQUFNLFdBQVcsR0FBRyxNQUFNLE9BQU8sQ0FBQyxVQUFVLENBQzFDLFVBQVUsRUFDVixRQUFRLEVBQ1IsV0FBVyxFQUNYLE9BQU8sQ0FBQyxLQUFLLEVBQ2IsT0FBTyxDQUFDLElBQUksSUFBSSxJQUFJLENBQ3JCLENBQUM7WUFFRixPQUFPLENBQUMsT0FBTyxDQUFDLEtBQUssQ0FBQyxLQUFLLENBQUMsaUJBQWlCLFdBQVcsRUFBRSxDQUFDLENBQUMsQ0FBQztRQUMvRCxDQUFDO1FBQUMsT0FBTyxLQUFLLEVBQUUsQ0FBQztZQUNmLE9BQU8sQ0FBQyxJQUFJLENBQ1YsS0FBSyxDQUFDLEdBQUcsQ0FBQywwQkFBMkIsS0FBZSxDQUFDLE9BQU8sRUFBRSxDQUFDLENBQ2hFLENBQUM7WUFDRixPQUFPLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQ2xCLENBQUM7SUFDSCxDQUFDLENBQUMsQ0FBQztJQUVMLE9BQU8sR0FBRyxDQUFDO0FBQ2IsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENvbW1hbmQgfSBmcm9tIFwiY29tbWFuZGVyXCI7XG5pbXBvcnQgY2hhbGsgZnJvbSBcImNoYWxrXCI7XG5pbXBvcnQgb3JhIGZyb20gXCJvcmFcIjtcbmltcG9ydCAqIGFzIHBhdGggZnJvbSBcInBhdGhcIjtcbmltcG9ydCB7IFRhc2tDcmVhdGlvblNlcnZpY2UsIEFzc2V0Q2xhc3MgfSBmcm9tIFwiQGV4b2NvcnRleC9jb3JlXCI7XG5pbXBvcnQgeyBGaWxlU3lzdGVtVmF1bHRBZGFwdGVyIH0gZnJvbSBcIi4uL2FkYXB0ZXJzL0ZpbGVTeXN0ZW1WYXVsdEFkYXB0ZXIuanNcIjtcblxuZXhwb3J0IGZ1bmN0aW9uIGNyZWF0ZVRhc2tDb21tYW5kKCk6IENvbW1hbmQge1xuICBjb25zdCBjbWQgPSBuZXcgQ29tbWFuZChcInRhc2tcIik7XG5cbiAgY21kXG4gICAgLmRlc2NyaXB0aW9uKFwiQ3JlYXRlIGEgbmV3IHRhc2sgZnJvbSBhbiBhcmVhIG9yIHByb2plY3RcIilcbiAgICAucmVxdWlyZWRPcHRpb24oXG4gICAgICBcIi1zLCAtLXNvdXJjZSA8cGF0aD5cIixcbiAgICAgIFwiUGF0aCB0byBzb3VyY2UgZmlsZSAoYXJlYSBvciBwcm9qZWN0KVwiLFxuICAgIClcbiAgICAub3B0aW9uKFwiLWwsIC0tbGFiZWwgPGxhYmVsPlwiLCBcIlRhc2sgbGFiZWxcIilcbiAgICAub3B0aW9uKFwiLS1zaXplIDxzaXplPlwiLCBcIlRhc2sgc2l6ZVwiKVxuICAgIC5vcHRpb24oXCItciwgLS1yb290IDxwYXRoPlwiLCBcIlJvb3QgZGlyZWN0b3J5IG9mIHZhdWx0XCIsIHByb2Nlc3MuY3dkKCkpXG4gICAgLmFjdGlvbihhc3luYyAob3B0aW9ucykgPT4ge1xuICAgICAgY29uc3Qgc3Bpbm5lciA9IG9yYShcIkNyZWF0aW5nIHRhc2suLi5cIikuc3RhcnQoKTtcblxuICAgICAgdHJ5IHtcbiAgICAgICAgY29uc3QgYWRhcHRlciA9IG5ldyBGaWxlU3lzdGVtVmF1bHRBZGFwdGVyKG9wdGlvbnMucm9vdCk7XG4gICAgICAgIGNvbnN0IHNlcnZpY2UgPSBuZXcgVGFza0NyZWF0aW9uU2VydmljZShhZGFwdGVyKTtcblxuICAgICAgICBjb25zdCBzb3VyY2VQYXRoID0gcGF0aC5yZWxhdGl2ZShvcHRpb25zLnJvb3QsIG9wdGlvbnMuc291cmNlKTtcbiAgICAgICAgY29uc3QgbWV0YWRhdGEgPSBhd2FpdCBhZGFwdGVyLmdldEZpbGVNZXRhZGF0YShzb3VyY2VQYXRoKTtcblxuICAgICAgICBsZXQgc291cmNlQ2xhc3MgPSBBc3NldENsYXNzLkFSRUE7XG4gICAgICAgIGlmIChtZXRhZGF0YS5leG9fX0luc3RhbmNlX2NsYXNzKSB7XG4gICAgICAgICAgY29uc3QgY2xhc3NlcyA9IEFycmF5LmlzQXJyYXkobWV0YWRhdGEuZXhvX19JbnN0YW5jZV9jbGFzcylcbiAgICAgICAgICAgID8gbWV0YWRhdGEuZXhvX19JbnN0YW5jZV9jbGFzc1xuICAgICAgICAgICAgOiBbbWV0YWRhdGEuZXhvX19JbnN0YW5jZV9jbGFzc107XG5cbiAgICAgICAgICBjb25zdCBub3JtYWxpemVkQ2xhc3MgPSBjbGFzc2VzWzBdPy5yZXBsYWNlKC9bXCInW1xcXV0vZywgXCJcIikudHJpbSgpO1xuICAgICAgICAgIGlmIChub3JtYWxpemVkQ2xhc3MgPT09IEFzc2V0Q2xhc3MuUFJPSkVDVCkge1xuICAgICAgICAgICAgc291cmNlQ2xhc3MgPSBBc3NldENsYXNzLlBST0pFQ1Q7XG4gICAgICAgICAgfSBlbHNlIGlmIChub3JtYWxpemVkQ2xhc3MgPT09IEFzc2V0Q2xhc3MuVEFTS19QUk9UT1RZUEUpIHtcbiAgICAgICAgICAgIHNvdXJjZUNsYXNzID0gQXNzZXRDbGFzcy5UQVNLX1BST1RPVFlQRTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBjcmVhdGVkUGF0aCA9IGF3YWl0IHNlcnZpY2UuY3JlYXRlVGFzayhcbiAgICAgICAgICBzb3VyY2VQYXRoLFxuICAgICAgICAgIG1ldGFkYXRhLFxuICAgICAgICAgIHNvdXJjZUNsYXNzLFxuICAgICAgICAgIG9wdGlvbnMubGFiZWwsXG4gICAgICAgICAgb3B0aW9ucy5zaXplIHx8IG51bGwsXG4gICAgICAgICk7XG5cbiAgICAgICAgc3Bpbm5lci5zdWNjZWVkKGNoYWxrLmdyZWVuKGBUYXNrIGNyZWF0ZWQ6ICR7Y3JlYXRlZFBhdGh9YCkpO1xuICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgc3Bpbm5lci5mYWlsKFxuICAgICAgICAgIGNoYWxrLnJlZChgRmFpbGVkIHRvIGNyZWF0ZSB0YXNrOiAkeyhlcnJvciBhcyBFcnJvcikubWVzc2FnZX1gKSxcbiAgICAgICAgKTtcbiAgICAgICAgcHJvY2Vzcy5leGl0KDEpO1xuICAgICAgfVxuICAgIH0pO1xuXG4gIHJldHVybiBjbWQ7XG59XG4iXX0=