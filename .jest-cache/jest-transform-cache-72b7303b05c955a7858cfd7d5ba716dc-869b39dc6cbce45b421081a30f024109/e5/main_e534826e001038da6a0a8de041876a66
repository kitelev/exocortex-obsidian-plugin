895ace63e1cc3c0745fdcbae89116466
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const tslib_1 = require("tslib");
const obsidian_1 = require("obsidian");
const Graph_1 = require("./domain/semantic/core/Graph");
const Triple_1 = require("./domain/semantic/core/Triple");
const SPARQLProcessor_1 = require("./presentation/processors/SPARQLProcessor");
const GraphVisualizationProcessor_1 = require("./presentation/processors/GraphVisualizationProcessor");
const CreateAssetModal_1 = require("./presentation/modals/CreateAssetModal");
const ExportRDFModal_1 = require("./presentation/modals/ExportRDFModal");
const ImportRDFModal_1 = require("./presentation/modals/ImportRDFModal");
const QuickTaskModal_1 = require("./presentation/modals/QuickTaskModal");
const DIContainer_1 = require("./infrastructure/container/DIContainer");
const RDFService_1 = require("./application/services/RDFService");
const CreateTaskFromProjectUseCase_1 = require("./application/use-cases/CreateTaskFromProjectUseCase");
const GetCurrentProjectUseCase_1 = require("./application/use-cases/GetCurrentProjectUseCase");
const ObsidianTaskRepository_1 = require("./infrastructure/repositories/ObsidianTaskRepository");
const ObsidianAssetRepository_1 = require("./infrastructure/repositories/ObsidianAssetRepository");
const IndexedGraph_1 = require("./domain/semantic/core/IndexedGraph");
const ExoFocusService_1 = require("./application/services/ExoFocusService");
class ExocortexPlugin extends obsidian_1.Plugin {
    onload() {
        return tslib_1.__awaiter(this, void 0, void 0, function* () {
            // Plugin initialization
            // Initialize DI container
            DIContainer_1.DIContainer.initialize(this.app, this);
            this.container = DIContainer_1.DIContainer.getInstance();
            // Initialize graph
            this.graph = new Graph_1.Graph();
            // Initialize RDF service
            this.rdfService = new RDFService_1.RDFService(this.app);
            // Load vault data into graph
            try {
                yield this.loadVaultIntoGraph();
            }
            catch (error) {
                // Vault loading failed - plugin should still function
                console.warn('Failed to load vault into graph:', error);
            }
            // Initialize SPARQL processor with cache configuration
            const cacheConfig = {
                maxSize: 500,
                defaultTTL: 5 * 60 * 1000,
                enabled: true
            };
            this.sparqlProcessor = new SPARQLProcessor_1.SPARQLProcessor(this, this.graph, undefined, cacheConfig);
            // Initialize Graph Visualization processor
            this.graphVisualizationProcessor = new GraphVisualizationProcessor_1.GraphVisualizationProcessor(this, this.graph);
            // Register SPARQL code block processor
            try {
                this.registerMarkdownCodeBlockProcessor('sparql', (source, el, ctx) => this.sparqlProcessor.processCodeBlock(source, el, ctx));
            }
            catch (error) {
                // SPARQL processor may already be registered (hot reload scenario)
                console.warn('SPARQL processor registration failed, likely due to hot reload:', error.message);
            }
            // Register Graph Visualization code block processor
            try {
                this.registerMarkdownCodeBlockProcessor('graph', (source, el, ctx) => this.graphVisualizationProcessor.processCodeBlock(source, el, ctx));
            }
            catch (error) {
                // Graph processor may already be registered (hot reload scenario)
                console.warn('Graph processor registration failed, likely due to hot reload:', error.message);
            }
            // Register command: Create new asset
            this.addCommand({
                id: 'create-exo-asset',
                name: 'Create new ExoAsset',
                hotkeys: [{ modifiers: ["Mod", "Shift"], key: "n" }],
                callback: () => {
                    new CreateAssetModal_1.CreateAssetModal(this.app).open();
                }
            });
            // Add ribbon icon for quick access
            this.addRibbonIcon('plus-circle', 'Create ExoAsset', () => {
                new CreateAssetModal_1.CreateAssetModal(this.app).open();
            });
            // Register command: View SPARQL cache statistics
            this.addCommand({
                id: 'view-sparql-cache-stats',
                name: 'View SPARQL cache statistics',
                callback: () => {
                    const stats = this.sparqlProcessor.getCacheStatistics();
                    const message = [
                        `SPARQL Query Cache Statistics:`,
                        `• Cache hits: ${stats.hits}`,
                        `• Cache misses: ${stats.misses}`,
                        `• Hit rate: ${stats.hitRate.toFixed(1)}%`,
                        `• Cached entries: ${stats.size}/${stats.maxSize}`,
                        `• Total queries: ${stats.totalQueries}`,
                        `• Evictions: ${stats.evictions}`
                    ].join('\n');
                    new obsidian_1.Notice(message, 8000);
                }
            });
            // Register command: Clear SPARQL cache
            this.addCommand({
                id: 'clear-sparql-cache',
                name: 'Clear SPARQL cache',
                callback: () => {
                    this.sparqlProcessor.invalidateCache();
                    new obsidian_1.Notice('SPARQL query cache cleared!');
                }
            });
            // Register command: Export knowledge graph
            this.addCommand({
                id: 'export-knowledge-graph',
                name: 'Export knowledge graph',
                callback: () => {
                    const modal = new ExportRDFModal_1.ExportRDFModal(this.app, this.graph, this.rdfService.getNamespaceManager(), (result) => {
                        // Graph export completed
                    });
                    modal.open();
                }
            });
            // Register command: Import RDF data
            this.addCommand({
                id: 'import-rdf-data',
                name: 'Import RDF data',
                callback: () => {
                    const modal = new ImportRDFModal_1.ImportRDFModal(this.app, this.graph, this.rdfService.getNamespaceManager(), (importedGraph, options) => tslib_1.__awaiter(this, void 0, void 0, function* () {
                        try {
                            if (options.mergeMode === 'replace') {
                                this.graph.clear();
                                this.graph.merge(importedGraph);
                            }
                            else {
                                this.graph.merge(importedGraph);
                            }
                            // Invalidate SPARQL cache since graph changed
                            this.sparqlProcessor.invalidateCache();
                            // RDF import completed
                        }
                        catch (error) {
                            // RDF import failed
                            new obsidian_1.Notice(`Import failed: ${error.message}`);
                        }
                    }));
                    modal.open();
                }
            });
            // Register command: Quick Task Creation
            this.addCommand({
                id: 'quick-create-task',
                name: 'Quick create task for current project',
                hotkeys: [{ modifiers: ["Mod", "Shift"], key: "t" }],
                callback: () => tslib_1.__awaiter(this, void 0, void 0, function* () {
                    try {
                        // Get current file context
                        const activeFile = this.app.workspace.getActiveFile();
                        const activeFilePath = activeFile === null || activeFile === void 0 ? void 0 : activeFile.path;
                        // Initialize repositories and services
                        const taskRepository = new ObsidianTaskRepository_1.ObsidianTaskRepository(this.app);
                        const assetRepository = new ObsidianAssetRepository_1.ObsidianAssetRepository(this.app);
                        const indexedGraph = new IndexedGraph_1.IndexedGraph();
                        const focusService = new ExoFocusService_1.ExoFocusService(this.app, this.graph);
                        // Create use cases
                        const getCurrentProjectUseCase = new GetCurrentProjectUseCase_1.GetCurrentProjectUseCase(assetRepository, focusService, indexedGraph);
                        const createTaskUseCase = new CreateTaskFromProjectUseCase_1.CreateTaskFromProjectUseCase(taskRepository, assetRepository, indexedGraph, getCurrentProjectUseCase);
                        // Open modal
                        const modal = new QuickTaskModal_1.QuickTaskModal(this.app, createTaskUseCase, getCurrentProjectUseCase, activeFilePath);
                        modal.open();
                    }
                    catch (error) {
                        // Quick task modal error
                        new obsidian_1.Notice(`Failed to open task creation: ${error.message}`);
                    }
                })
            });
            // Register file modification handler to update graph
            this.registerEvent(this.app.vault.on('modify', (file) => tslib_1.__awaiter(this, void 0, void 0, function* () {
                if (file instanceof obsidian_1.TFile && file.extension === 'md') {
                    yield this.updateFileInGraph(file);
                    // Invalidate SPARQL query cache when data changes
                    this.sparqlProcessor.invalidateCache();
                }
            })));
            // Register file creation handler
            this.registerEvent(this.app.vault.on('create', (file) => tslib_1.__awaiter(this, void 0, void 0, function* () {
                if (file instanceof obsidian_1.TFile && file.extension === 'md') {
                    yield this.updateFileInGraph(file);
                    // Invalidate SPARQL query cache when data changes
                    this.sparqlProcessor.invalidateCache();
                }
            })));
            // Register file deletion handler
            this.registerEvent(this.app.vault.on('delete', (file) => tslib_1.__awaiter(this, void 0, void 0, function* () {
                if (file instanceof obsidian_1.TFile && file.extension === 'md') {
                    this.removeFileFromGraph(file);
                    // Invalidate SPARQL query cache when data changes
                    this.sparqlProcessor.invalidateCache();
                }
            })));
            new obsidian_1.Notice('🔍 Exocortex: SPARQL support and graph visualization enabled!');
            // SPARQL and graph processors initialized
        });
    }
    loadVaultIntoGraph() {
        return tslib_1.__awaiter(this, void 0, void 0, function* () {
            // Loading vault data
            const startTime = Date.now();
            let triplesCount = 0;
            try {
                const files = this.app.vault.getMarkdownFiles();
                for (const file of files) {
                    try {
                        const content = yield this.app.vault.read(file);
                        const triples = this.extractTriplesFromFile(file, content);
                        for (const triple of triples) {
                            this.graph.add(triple);
                            triplesCount++;
                        }
                    }
                    catch (err) {
                        // File processing failed - continue with next file
                    }
                }
            }
            catch (err) {
                // Vault access failed - plugin should still function
                console.warn('Failed to access vault files during graph initialization:', err);
                new obsidian_1.Notice('Exocortex: Unable to load vault files into graph');
                return;
            }
            const loadTime = Date.now() - startTime;
            // Vault data loaded
        });
    }
    updateFileInGraph(file) {
        return tslib_1.__awaiter(this, void 0, void 0, function* () {
            try {
                // Remove old triples for this file
                this.removeFileFromGraph(file);
                // Add new triples
                const content = yield this.app.vault.read(file);
                const triples = this.extractTriplesFromFile(file, content);
                for (const triple of triples) {
                    this.graph.add(triple);
                }
            }
            catch (err) {
                // File update failed
            }
        });
    }
    removeFileFromGraph(file) {
        const subject = new Triple_1.IRI(`file://${file.basename}`);
        const triplesToRemove = this.graph.match(subject, null, null);
        for (const triple of triplesToRemove) {
            this.graph.remove(triple);
        }
    }
    extractTriplesFromFile(file, content) {
        const triples = [];
        const subject = new Triple_1.IRI(`file://${file.basename}`);
        // Extract frontmatter
        const frontmatterMatch = content.match(/^---\n([\s\S]*?)\n---/);
        if (frontmatterMatch) {
            const frontmatter = this.parseFrontmatter(frontmatterMatch[1]);
            for (const [key, value] of Object.entries(frontmatter)) {
                if (Array.isArray(value)) {
                    for (const v of value) {
                        triples.push(new Triple_1.Triple(subject, new Triple_1.IRI(key), Triple_1.Literal.string(String(v))));
                    }
                }
                else if (value !== null && value !== undefined) {
                    triples.push(new Triple_1.Triple(subject, new Triple_1.IRI(key), Triple_1.Literal.string(String(value))));
                }
            }
        }
        // Add basic file metadata
        triples.push(new Triple_1.Triple(subject, new Triple_1.IRI('file_path'), Triple_1.Literal.string(file.path)));
        triples.push(new Triple_1.Triple(subject, new Triple_1.IRI('file_name'), Triple_1.Literal.string(file.name)));
        return triples;
    }
    parseFrontmatter(yaml) {
        const result = {};
        const lines = yaml.split('\n');
        let currentKey = null;
        let currentValue = null;
        let inArray = false;
        for (const line of lines) {
            const trimmed = line.trim();
            if (!trimmed)
                continue;
            // Check for array item
            if (line.startsWith('  - ') || line.startsWith('    - ')) {
                if (currentKey && inArray) {
                    const value = line.substring(line.indexOf('- ') + 2).trim();
                    const cleanValue = value.replace(/^["']|["']$/g, '').replace(/\[\[|\]\]/g, '');
                    if (!Array.isArray(currentValue)) {
                        currentValue = [];
                    }
                    currentValue.push(cleanValue);
                }
                continue;
            }
            // Check for key:value pair
            if (trimmed.includes(':')) {
                // Save previous key-value if exists
                if (currentKey !== null && currentValue !== null) {
                    result[currentKey] = currentValue;
                }
                const colonIndex = trimmed.indexOf(':');
                currentKey = trimmed.substring(0, colonIndex).trim();
                const valueStr = trimmed.substring(colonIndex + 1).trim();
                if (!valueStr) {
                    // Value will be on next lines (array)
                    inArray = true;
                    currentValue = [];
                }
                else {
                    // Single value
                    inArray = false;
                    currentValue = valueStr.replace(/^["']|["']$/g, '').replace(/\[\[|\]\]/g, '');
                }
            }
        }
        // Save last key-value
        if (currentKey !== null && currentValue !== null) {
            result[currentKey] = currentValue;
        }
        return result;
    }
    onunload() {
        return tslib_1.__awaiter(this, void 0, void 0, function* () {
            // Plugin cleanup completed
            if (this.graph) {
                this.graph.clear();
            }
            if (this.sparqlProcessor) {
                this.sparqlProcessor.destroy();
            }
        });
    }
}
exports.default = ExocortexPlugin;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL2tpdGVsZXYvRG9jdW1lbnRzL2V4b2NvcnRleC1vYnNpZGlhbi1wbHVnaW4vc3JjL21haW4udHMiLCJtYXBwaW5ncyI6Ijs7O0FBQUEsdUNBQStFO0FBQy9FLHdEQUFxRDtBQUNyRCwwREFBcUU7QUFDckUsK0VBQTRFO0FBQzVFLHVHQUFvRztBQUNwRyw2RUFBMEU7QUFDMUUseUVBQXNFO0FBQ3RFLHlFQUFzRTtBQUN0RSx5RUFBc0U7QUFDdEUsd0VBQXFFO0FBQ3JFLGtFQUErRDtBQUMvRCx1R0FBb0c7QUFDcEcsK0ZBQTRGO0FBQzVGLGlHQUE4RjtBQUM5RixtR0FBZ0c7QUFDaEcsc0VBQW1FO0FBQ25FLDRFQUF5RTtBQUl6RSxNQUFxQixlQUFnQixTQUFRLGlCQUFNO0lBT3pDLE1BQU07O1lBQ1Isd0JBQXdCO1lBRXhCLDBCQUEwQjtZQUMxQix5QkFBVyxDQUFDLFVBQVUsQ0FBQyxJQUFJLENBQUMsR0FBRyxFQUFFLElBQUksQ0FBQyxDQUFDO1lBQ3ZDLElBQUksQ0FBQyxTQUFTLEdBQUcseUJBQVcsQ0FBQyxXQUFXLEVBQUUsQ0FBQztZQUUzQyxtQkFBbUI7WUFDbkIsSUFBSSxDQUFDLEtBQUssR0FBRyxJQUFJLGFBQUssRUFBRSxDQUFDO1lBRXpCLHlCQUF5QjtZQUN6QixJQUFJLENBQUMsVUFBVSxHQUFHLElBQUksdUJBQVUsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUM7WUFFM0MsNkJBQTZCO1lBQzdCLElBQUk7Z0JBQ0EsTUFBTSxJQUFJLENBQUMsa0JBQWtCLEVBQUUsQ0FBQzthQUNuQztZQUFDLE9BQU8sS0FBSyxFQUFFO2dCQUNaLHNEQUFzRDtnQkFDdEQsT0FBTyxDQUFDLElBQUksQ0FBQyxrQ0FBa0MsRUFBRSxLQUFLLENBQUMsQ0FBQzthQUMzRDtZQUVELHVEQUF1RDtZQUN2RCxNQUFNLFdBQVcsR0FBRztnQkFDaEIsT0FBTyxFQUFFLEdBQUc7Z0JBQ1osVUFBVSxFQUFFLENBQUMsR0FBRyxFQUFFLEdBQUcsSUFBSTtnQkFDekIsT0FBTyxFQUFF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QUFJLEVBQUUsQ0FBQztnQkFFMUQsSUFBSSxDQUFDLFFBQVEsRUFBRTtvQkFDWCxzQ0FBc0M7b0JBQ3RDLE9BQU8sR0FBRyxJQUFJLENBQUM7b0JBQ2YsWUFBWSxHQUFHLEVBQUUsQ0FBQztpQkFDckI7cUJBQU07b0JBQ0gsZUFBZTtvQkFDZixPQUFPLEdBQUcsS0FBSyxDQUFDO29CQUNoQixZQUFZLEdBQUcsUUFBUSxDQUFDLE9BQU8sQ0FBQyxjQUFjLEVBQUUsRUFBRSxDQUFDLENBQUMsT0FBTyxDQUFDLFlBQVksRUFBRSxFQUFFLENBQUMsQ0FBQztpQkFDakY7YUFDSjtTQUNKO1FBRUQsc0JBQXNCO1FBQ3RCLElBQUksVUFBVSxLQUFLLElBQUksSUFBSSxZQUFZLEtBQUssSUFBSSxFQUFFO1lBQzlDLE1BQU0sQ0FBQyxVQUFVLENBQUMsR0FBRyxZQUFZLENBQUM7U0FDckM7UUFFRCxPQUFPLE1BQU0sQ0FBQztJQUNsQixDQUFDO0lBRUssUUFBUTs7WUFDViwyQkFBMkI7WUFDM0IsSUFBSSxJQUFJLENBQUMsS0FBSyxFQUFFO2dCQUNaLElBQUksQ0FBQyxLQUFLLENBQUMsS0FBSyxFQUFFLENBQUM7YUFDdEI7WUFDRCxJQUFJLElBQUksQ0FBQyxlQUFlLEVBQUU7Z0JBQ3RCLElBQUksQ0FBQyxlQUFlLENBQUMsT0FBTyxFQUFFLENBQUM7YUFDbEM7UUFDTCxDQUFDO0tBQUE7Q0FDSjtBQW5aRCxrQ0FtWkMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL1VzZXJzL2tpdGVsZXYvRG9jdW1lbnRzL2V4b2NvcnRleC1vYnNpZGlhbi1wbHVnaW4vc3JjL21haW4udHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgUGx1Z2luLCBOb3RpY2UsIE1hcmtkb3duUG9zdFByb2Nlc3NvckNvbnRleHQsIFRGaWxlIH0gZnJvbSAnb2JzaWRpYW4nO1xuaW1wb3J0IHsgR3JhcGggfSBmcm9tICcuL2RvbWFpbi9zZW1hbnRpYy9jb3JlL0dyYXBoJztcbmltcG9ydCB7IFRyaXBsZSwgSVJJLCBMaXRlcmFsIH0gZnJvbSAnLi9kb21haW4vc2VtYW50aWMvY29yZS9UcmlwbGUnO1xuaW1wb3J0IHsgU1BBUlFMUHJvY2Vzc29yIH0gZnJvbSAnLi9wcmVzZW50YXRpb24vcHJvY2Vzc29ycy9TUEFSUUxQcm9jZXNzb3InO1xuaW1wb3J0IHsgR3JhcGhWaXN1YWxpemF0aW9uUHJvY2Vzc29yIH0gZnJvbSAnLi9wcmVzZW50YXRpb24vcHJvY2Vzc29ycy9HcmFwaFZpc3VhbGl6YXRpb25Qcm9jZXNzb3InO1xuaW1wb3J0IHsgQ3JlYXRlQXNzZXRNb2RhbCB9IGZyb20gJy4vcHJlc2VudGF0aW9uL21vZGFscy9DcmVhdGVBc3NldE1vZGFsJztcbmltcG9ydCB7IEV4cG9ydFJERk1vZGFsIH0gZnJvbSAnLi9wcmVzZW50YXRpb24vbW9kYWxzL0V4cG9ydFJERk1vZGFsJztcbmltcG9ydCB7IEltcG9ydFJERk1vZGFsIH0gZnJvbSAnLi9wcmVzZW50YXRpb24vbW9kYWxzL0ltcG9ydFJERk1vZGFsJztcbmltcG9ydCB7IFF1aWNrVGFza01vZGFsIH0gZnJvbSAnLi9wcmVzZW50YXRpb24vbW9kYWxzL1F1aWNrVGFza01vZGFsJztcbmltcG9ydCB7IERJQ29udGFpbmVyIH0gZnJvbSAnLi9pbmZyYXN0cnVjdHVyZS9jb250YWluZXIvRElDb250YWluZXInO1xuaW1wb3J0IHsgUkRGU2VydmljZSB9IGZyb20gJy4vYXBwbGljYXRpb24vc2VydmljZXMvUkRGU2VydmljZSc7XG5pbXBvcnQgeyBDcmVhdGVUYXNrRnJvbVByb2plY3RVc2VDYXNlIH0gZnJvbSAnLi9hcHBsaWNhdGlvbi91c2UtY2FzZXMvQ3JlYXRlVGFza0Zyb21Qcm9qZWN0VXNlQ2FzZSc7XG5pbXBvcnQgeyBHZXRDdXJyZW50UHJvamVjdFVzZUNhc2UgfSBmcm9tICcuL2FwcGxpY2F0aW9uL3VzZS1jYXNlcy9HZXRDdXJyZW50UHJvamVjdFVzZUNhc2UnO1xuaW1wb3J0IHsgT2JzaWRpYW5UYXNrUmVwb3NpdG9yeSB9IGZyb20gJy4vaW5mcmFzdHJ1Y3R1cmUvcmVwb3NpdG9yaWVzL09ic2lkaWFuVGFza1JlcG9zaXRvcnknO1xuaW1wb3J0IHsgT2JzaWRpYW5Bc3NldFJlcG9zaXRvcnkgfSBmcm9tICcuL2luZnJhc3RydWN0dXJlL3JlcG9zaXRvcmllcy9PYnNpZGlhbkFzc2V0UmVwb3NpdG9yeSc7XG5pbXBvcnQgeyBJbmRleGVkR3JhcGggfSBmcm9tICcuL2RvbWFpbi9zZW1hbnRpYy9jb3JlL0luZGV4ZWRHcmFwaCc7XG5pbXBvcnQgeyBFeG9Gb2N1c1NlcnZpY2UgfSBmcm9tICcuL2FwcGxpY2F0aW9uL3NlcnZpY2VzL0V4b0ZvY3VzU2VydmljZSc7XG5cbmltcG9ydCBtYW5pZmVzdCBmcm9tICcuLi9tYW5pZmVzdC5qc29uJztcblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgRXhvY29ydGV4UGx1Z2luIGV4dGVuZHMgUGx1Z2luIHtcbiAgICBwcml2YXRlIGdyYXBoOiBHcmFwaDtcbiAgICBwcml2YXRlIHNwYXJxbFByb2Nlc3NvcjogU1BBUlFMUHJvY2Vzc29yO1xuICAgIHByaXZhdGUgZ3JhcGhWaXN1YWxpemF0aW9uUHJvY2Vzc29yOiBHcmFwaFZpc3VhbGl6YXRpb25Qcm9jZXNzb3I7XG4gICAgcHJpdmF0ZSBjb250YWluZXI6IERJQ29udGFpbmVyO1xuICAgIHByaXZhdGUgcmRmU2VydmljZTogUkRGU2VydmljZTtcbiAgICBcbiAgICBhc3luYyBvbmxvYWQoKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgICAgIC8vIFBsdWdpbiBpbml0aWFsaXphdGlvblxuICAgICAgICBcbiAgICAgICAgLy8gSW5pdGlhbGl6ZSBESSBjb250YWluZXJcbiAgICAgICAgRElDb250YWluZXIuaW5pdGlhbGl6ZSh0aGlzLmFwcCwgdGhpcyk7XG4gICAgICAgIHRoaXMuY29udGFpbmVyID0gRElDb250YWluZXIuZ2V0SW5zdGFuY2UoKTtcbiAgICAgICAgXG4gICAgICAgIC8vIEluaXRpYWxpemUgZ3JhcGhcbiAgICAgICAgdGhpcy5ncmFwaCA9IG5ldyBHcmFwaCgpO1xuICAgICAgICBcbiAgICAgICAgLy8gSW5pdGlhbGl6ZSBSREYgc2VydmljZVxuICAgICAgICB0aGlzLnJkZlNlcnZpY2UgPSBuZXcgUkRGU2VydmljZSh0aGlzLmFwcCk7XG4gICAgICAgIFxuICAgICAgICAvLyBMb2FkIHZhdWx0IGRhdGEgaW50byBncmFwaFxuICAgICAgICB0cnkge1xuICAgICAgICAgICAgYXdhaXQgdGhpcy5sb2FkVmF1bHRJbnRvR3JhcGgoKTtcbiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAgIC8vIFZhdWx0IGxvYWRpbmcgZmFpbGVkIC0gcGx1Z2luIHNob3VsZCBzdGlsbCBmdW5jdGlvblxuICAgICAgICAgICAgY29uc29sZS53YXJuKCdGYWlsZWQgdG8gbG9hZCB2YXVsdCBpbnRvIGdyYXBoOicsIGVycm9yKTtcbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgLy8gSW5pdGlhbGl6ZSBTUEFSUUwgcHJvY2Vzc29yIHdpdGggY2FjaGUgY29uZmlndXJhdGlvblxuICAgICAgICBjb25zdCBjYWNoZUNvbmZpZyA9IHtcbiAgICAgICAgICAgIG1heFNpemU6IDUwMCwgICAgICAgICAgIC8vIFJlYXNvbmFibGUgY2FjaGUgc2l6ZSBmb3IgT2JzaWRpYW4gcGx1Z2luXG4gICAgICAgICAgICBkZWZhdWx0VFRMOiA1ICogNjAgKiAxMDAwLCAgLy8gNSBtaW51dGVzIFRUTFxuICAgICAgICAgICAgZW5hYmxlZDogdHJ1ZVxuICAgICAgICB9O1xuICAgICAgICB0aGlzLnNwYXJxbFByb2Nlc3NvciA9IG5ldyBTUEFSUUxQcm9jZXNzb3IodGhpcywgdGhpcy5ncmFwaCwgdW5kZWZpbmVkLCBjYWNoZUNvbmZpZyk7XG4gICAgICAgIFxuICAgICAgICAvLyBJbml0aWFsaXplIEdyYXBoIFZpc3VhbGl6YXRpb24gcHJvY2Vzc29yXG4gICAgICAgIHRoaXMuZ3JhcGhWaXN1YWxpemF0aW9uUHJvY2Vzc29yID0gbmV3IEdyYXBoVmlzdWFsaXphdGlvblByb2Nlc3Nvcih0aGlzLCB0aGlzLmdyYXBoKTtcbiAgICAgICAgXG4gICAgICAgIC8vIFJlZ2lzdGVyIFNQQVJRTCBjb2RlIGJsb2NrIHByb2Nlc3NvclxuICAgICAgICB0cnkge1xuICAgICAgICAgICAgdGhpcy5yZWdpc3Rlck1hcmtkb3duQ29kZUJsb2NrUHJvY2Vzc29yKCdzcGFycWwnLCBcbiAgICAgICAgICAgICAgICAoc291cmNlLCBlbCwgY3R4KSA9PiB0aGlzLnNwYXJxbFByb2Nlc3Nvci5wcm9jZXNzQ29kZUJsb2NrKHNvdXJjZSwgZWwsIGN0eClcbiAgICAgICAgICAgICk7XG4gICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICAvLyBTUEFSUUwgcHJvY2Vzc29yIG1heSBhbHJlYWR5IGJlIHJlZ2lzdGVyZWQgKGhvdCByZWxvYWQgc2NlbmFyaW8pXG4gICAgICAgICAgICBjb25zb2xlLndhcm4oJ1NQQVJRTCBwcm9jZXNzb3IgcmVnaXN0cmF0aW9uIGZhaWxlZCwgbGlrZWx5IGR1ZSB0byBob3QgcmVsb2FkOicsIGVycm9yLm1lc3NhZ2UpO1xuICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICAvLyBSZWdpc3RlciBHcmFwaCBWaXN1YWxpemF0aW9uIGNvZGUgYmxvY2sgcHJvY2Vzc29yXG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICB0aGlzLnJlZ2lzdGVyTWFya2Rvd25Db2RlQmxvY2tQcm9jZXNzb3IoJ2dyYXBoJywgXG4gICAgICAgICAgICAgICAgKHNvdXJjZSwgZWwsIGN0eCkgPT4gdGhpcy5ncmFwaFZpc3VhbGl6YXRpb25Qcm9jZXNzb3IucHJvY2Vzc0NvZGVCbG9jayhzb3VyY2UsIGVsLCBjdHgpXG4gICAgICAgICAgICApO1xuICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgLy8gR3JhcGggcHJvY2Vzc29yIG1heSBhbHJlYWR5IGJlIHJlZ2lzdGVyZWQgKGhvdCByZWxvYWQgc2NlbmFyaW8pXG4gICAgICAgICAgICBjb25zb2xlLndhcm4oJ0dyYXBoIHByb2Nlc3NvciByZWdpc3RyYXRpb24gZmFpbGVkLCBsaWtlbHkgZHVlIHRvIGhvdCByZWxvYWQ6JywgZXJyb3IubWVzc2FnZSk7XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIC8vIFJlZ2lzdGVyIGNvbW1hbmQ6IENyZWF0ZSBuZXcgYXNzZXRcbiAgICAgICAgdGhpcy5hZGRDb21tYW5kKHtcbiAgICAgICAgICAgIGlkOiAnY3JlYXRlLWV4by1hc3NldCcsXG4gICAgICAgICAgICBuYW1lOiAnQ3JlYXRlIG5ldyBFeG9Bc3NldCcsXG4gICAgICAgICAgICBob3RrZXlzOiBbeyBtb2RpZmllcnM6IFtcIk1vZFwiLCBcIlNoaWZ0XCJdLCBrZXk6IFwiblwiIH1dLFxuICAgICAgICAgICAgY2FsbGJhY2s6ICgpID0+IHtcbiAgICAgICAgICAgICAgICBuZXcgQ3JlYXRlQXNzZXRNb2RhbCh0aGlzLmFwcCkub3BlbigpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgXG4gICAgICAgIC8vIEFkZCByaWJib24gaWNvbiBmb3IgcXVpY2sgYWNjZXNzXG4gICAgICAgIHRoaXMuYWRkUmliYm9uSWNvbigncGx1cy1jaXJjbGUnLCAnQ3JlYXRlIEV4b0Fzc2V0JywgKCkgPT4ge1xuICAgICAgICAgICAgbmV3IENyZWF0ZUFzc2V0TW9kYWwodGhpcy5hcHApLm9wZW4oKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy8gUmVnaXN0ZXIgY29tbWFuZDogVmlldyBTUEFSUUwgY2FjaGUgc3RhdGlzdGljc1xuICAgICAgICB0aGlzLmFkZENvbW1hbmQoe1xuICAgICAgICAgICAgaWQ6ICd2aWV3LXNwYXJxbC1jYWNoZS1zdGF0cycsXG4gICAgICAgICAgICBuYW1lOiAnVmlldyBTUEFSUUwgY2FjaGUgc3RhdGlzdGljcycsXG4gICAgICAgICAgICBjYWxsYmFjazogKCkgPT4ge1xuICAgICAgICAgICAgICAgIGNvbnN0IHN0YXRzID0gdGhpcy5zcGFycWxQcm9jZXNzb3IuZ2V0Q2FjaGVTdGF0aXN0aWNzKCk7XG4gICAgICAgICAgICAgICAgY29uc3QgbWVzc2FnZSA9IFtcbiAgICAgICAgICAgICAgICAgICAgYFNQQVJRTCBRdWVyeSBDYWNoZSBTdGF0aXN0aWNzOmAsXG4gICAgICAgICAgICAgICAgICAgIGDigKIgQ2FjaGUgaGl0czogJHtzdGF0cy5oaXRzfWAsXG4gICAgICAgICAgICAgICAgICAgIGDigKIgQ2FjaGUgbWlzc2VzOiAke3N0YXRzLm1pc3Nlc31gLFxuICAgICAgICAgICAgICAgICAgICBg4oCiIEhpdCByYXRlOiAke3N0YXRzLmhpdFJhdGUudG9GaXhlZCgxKX0lYCxcbiAgICAgICAgICAgICAgICAgICAgYOKAoiBDYWNoZWQgZW50cmllczogJHtzdGF0cy5zaXplfS8ke3N0YXRzLm1heFNpemV9YCxcbiAgICAgICAgICAgICAgICAgICAgYOKAoiBUb3RhbCBxdWVyaWVzOiAke3N0YXRzLnRvdGFsUXVlcmllc31gLFxuICAgICAgICAgICAgICAgICAgICBg4oCiIEV2aWN0aW9uczogJHtzdGF0cy5ldmljdGlvbnN9YFxuICAgICAgICAgICAgICAgIF0uam9pbignXFxuJyk7XG4gICAgICAgICAgICAgICAgbmV3IE5vdGljZShtZXNzYWdlLCA4MDAwKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy8gUmVnaXN0ZXIgY29tbWFuZDogQ2xlYXIgU1BBUlFMIGNhY2hlXG4gICAgICAgIHRoaXMuYWRkQ29tbWFuZCh7XG4gICAgICAgICAgICBpZDogJ2NsZWFyLXNwYXJxbC1jYWNoZScsXG4gICAgICAgICAgICBuYW1lOiAnQ2xlYXIgU1BBUlFMIGNhY2hlJyxcbiAgICAgICAgICAgIGNhbGxiYWNrOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5zcGFycWxQcm9jZXNzb3IuaW52YWxpZGF0ZUNhY2hlKCk7XG4gICAgICAgICAgICAgICAgbmV3IE5vdGljZSgnU1BBUlFMIHF1ZXJ5IGNhY2hlIGNsZWFyZWQhJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vIFJlZ2lzdGVyIGNvbW1hbmQ6IEV4cG9ydCBrbm93bGVkZ2UgZ3JhcGhcbiAgICAgICAgdGhpcy5hZGRDb21tYW5kKHtcbiAgICAgICAgICAgIGlkOiAnZXhwb3J0LWtub3dsZWRnZS1ncmFwaCcsXG4gICAgICAgICAgICBuYW1lOiAnRXhwb3J0IGtub3dsZWRnZSBncmFwaCcsXG4gICAgICAgICAgICBjYWxsYmFjazogKCkgPT4ge1xuICAgICAgICAgICAgICAgIGNvbnN0IG1vZGFsID0gbmV3IEV4cG9ydFJERk1vZGFsKFxuICAgICAgICAgICAgICAgICAgICB0aGlzLmFwcCxcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5ncmFwaCxcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5yZGZTZXJ2aWNlLmdldE5hbWVzcGFjZU1hbmFnZXIoKSxcbiAgICAgICAgICAgICAgICAgICAgKHJlc3VsdCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gR3JhcGggZXhwb3J0IGNvbXBsZXRlZFxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgICAgICBtb2RhbC5vcGVuKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vIFJlZ2lzdGVyIGNvbW1hbmQ6IEltcG9ydCBSREYgZGF0YVxuICAgICAgICB0aGlzLmFkZENvbW1hbmQoe1xuICAgICAgICAgICAgaWQ6ICdpbXBvcnQtcmRmLWRhdGEnLFxuICAgICAgICAgICAgbmFtZTogJ0ltcG9ydCBSREYgZGF0YScsXG4gICAgICAgICAgICBjYWxsYmFjazogKCkgPT4ge1xuICAgICAgICAgICAgICAgIGNvbnN0IG1vZGFsID0gbmV3IEltcG9ydFJERk1vZGFsKFxuICAgICAgICAgICAgICAgICAgICB0aGlzLmFwcCxcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5ncmFwaCxcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5yZGZTZXJ2aWNlLmdldE5hbWVzcGFjZU1hbmFnZXIoKSxcbiAgICAgICAgICAgICAgICAgICAgYXN5bmMgKGltcG9ydGVkR3JhcGgsIG9wdGlvbnMpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG9wdGlvbnMubWVyZ2VNb2RlID09PSAncmVwbGFjZScpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5ncmFwaC5jbGVhcigpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmdyYXBoLm1lcmdlKGltcG9ydGVkR3JhcGgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZ3JhcGgubWVyZ2UoaW1wb3J0ZWRHcmFwaCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIEludmFsaWRhdGUgU1BBUlFMIGNhY2hlIHNpbmNlIGdyYXBoIGNoYW5nZWRcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNwYXJxbFByb2Nlc3Nvci5pbnZhbGlkYXRlQ2FjaGUoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBSREYgaW1wb3J0IGNvbXBsZXRlZFxuICAgICAgICAgICAgICAgICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBSREYgaW1wb3J0IGZhaWxlZFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5ldyBOb3RpY2UoYEltcG9ydCBmYWlsZWQ6ICR7ZXJyb3IubWVzc2FnZX1gKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICAgICAgbW9kYWwub3BlbigpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICAvLyBSZWdpc3RlciBjb21tYW5kOiBRdWljayBUYXNrIENyZWF0aW9uXG4gICAgICAgIHRoaXMuYWRkQ29tbWFuZCh7XG4gICAgICAgICAgICBpZDogJ3F1aWNrLWNyZWF0ZS10YXNrJyxcbiAgICAgICAgICAgIG5hbWU6ICdRdWljayBjcmVhdGUgdGFzayBmb3IgY3VycmVudCBwcm9qZWN0JyxcbiAgICAgICAgICAgIGhvdGtleXM6IFt7IG1vZGlmaWVyczogW1wiTW9kXCIsIFwiU2hpZnRcIl0sIGtleTogXCJ0XCIgfV0sXG4gICAgICAgICAgICBjYWxsYmFjazogYXN5bmMgKCkgPT4ge1xuICAgICAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIEdldCBjdXJyZW50IGZpbGUgY29udGV4dFxuICAgICAgICAgICAgICAgICAgICBjb25zdCBhY3RpdmVGaWxlID0gdGhpcy5hcHAud29ya3NwYWNlLmdldEFjdGl2ZUZpbGUoKTtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgYWN0aXZlRmlsZVBhdGggPSBhY3RpdmVGaWxlPy5wYXRoO1xuXG4gICAgICAgICAgICAgICAgICAgIC8vIEluaXRpYWxpemUgcmVwb3NpdG9yaWVzIGFuZCBzZXJ2aWNlc1xuICAgICAgICAgICAgICAgICAgICBjb25zdCB0YXNrUmVwb3NpdG9yeSA9IG5ldyBPYnNpZGlhblRhc2tSZXBvc2l0b3J5KHRoaXMuYXBwKTtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgYXNzZXRSZXBvc2l0b3J5ID0gbmV3IE9ic2lkaWFuQXNzZXRSZXBvc2l0b3J5KHRoaXMuYXBwKTtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgaW5kZXhlZEdyYXBoID0gbmV3IEluZGV4ZWRHcmFwaCgpO1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBmb2N1c1NlcnZpY2UgPSBuZXcgRXhvRm9jdXNTZXJ2aWNlKHRoaXMuYXBwLCB0aGlzLmdyYXBoKTtcblxuICAgICAgICAgICAgICAgICAgICAvLyBDcmVhdGUgdXNlIGNhc2VzXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGdldEN1cnJlbnRQcm9qZWN0VXNlQ2FzZSA9IG5ldyBHZXRDdXJyZW50UHJvamVjdFVzZUNhc2UoXG4gICAgICAgICAgICAgICAgICAgICAgICBhc3NldFJlcG9zaXRvcnksXG4gICAgICAgICAgICAgICAgICAgICAgICBmb2N1c1NlcnZpY2UsXG4gICAgICAgICAgICAgICAgICAgICAgICBpbmRleGVkR3JhcGhcbiAgICAgICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGNyZWF0ZVRhc2tVc2VDYXNlID0gbmV3IENyZWF0ZVRhc2tGcm9tUHJvamVjdFVzZUNhc2UoXG4gICAgICAgICAgICAgICAgICAgICAgICB0YXNrUmVwb3NpdG9yeSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGFzc2V0UmVwb3NpdG9yeSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGluZGV4ZWRHcmFwaCxcbiAgICAgICAgICAgICAgICAgICAgICAgIGdldEN1cnJlbnRQcm9qZWN0VXNlQ2FzZVxuICAgICAgICAgICAgICAgICAgICApO1xuXG4gICAgICAgICAgICAgICAgICAgIC8vIE9wZW4gbW9kYWxcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgbW9kYWwgPSBuZXcgUXVpY2tUYXNrTW9kYWwoXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmFwcCxcbiAgICAgICAgICAgICAgICAgICAgICAgIGNyZWF0ZVRhc2tVc2VDYXNlLFxuICAgICAgICAgICAgICAgICAgICAgICAgZ2V0Q3VycmVudFByb2plY3RVc2VDYXNlLFxuICAgICAgICAgICAgICAgICAgICAgICAgYWN0aXZlRmlsZVBhdGhcbiAgICAgICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgICAgICAgICAgbW9kYWwub3BlbigpO1xuICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIFF1aWNrIHRhc2sgbW9kYWwgZXJyb3JcbiAgICAgICAgICAgICAgICAgICAgbmV3IE5vdGljZShgRmFpbGVkIHRvIG9wZW4gdGFzayBjcmVhdGlvbjogJHtlcnJvci5tZXNzYWdlfWApO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIFxuICAgICAgICAvLyBSZWdpc3RlciBmaWxlIG1vZGlmaWNhdGlvbiBoYW5kbGVyIHRvIHVwZGF0ZSBncmFwaFxuICAgICAgICB0aGlzLnJlZ2lzdGVyRXZlbnQoXG4gICAgICAgICAgICB0aGlzLmFwcC52YXVsdC5vbignbW9kaWZ5JywgYXN5bmMgKGZpbGUpID0+IHtcbiAgICAgICAgICAgICAgICBpZiAoZmlsZSBpbnN0YW5jZW9mIFRGaWxlICYmIGZpbGUuZXh0ZW5zaW9uID09PSAnbWQnKSB7XG4gICAgICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMudXBkYXRlRmlsZUluR3JhcGgoZmlsZSk7XG4gICAgICAgICAgICAgICAgICAgIC8vIEludmFsaWRhdGUgU1BBUlFMIHF1ZXJ5IGNhY2hlIHdoZW4gZGF0YSBjaGFuZ2VzXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc3BhcnFsUHJvY2Vzc29yLmludmFsaWRhdGVDYWNoZSgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pXG4gICAgICAgICk7XG4gICAgICAgIFxuICAgICAgICAvLyBSZWdpc3RlciBmaWxlIGNyZWF0aW9uIGhhbmRsZXJcbiAgICAgICAgdGhpcy5yZWdpc3RlckV2ZW50KFxuICAgICAgICAgICAgdGhpcy5hcHAudmF1bHQub24oJ2NyZWF0ZScsIGFzeW5jIChmaWxlKSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKGZpbGUgaW5zdGFuY2VvZiBURmlsZSAmJiBmaWxlLmV4dGVuc2lvbiA9PT0gJ21kJykge1xuICAgICAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLnVwZGF0ZUZpbGVJbkdyYXBoKGZpbGUpO1xuICAgICAgICAgICAgICAgICAgICAvLyBJbnZhbGlkYXRlIFNQQVJRTCBxdWVyeSBjYWNoZSB3aGVuIGRhdGEgY2hhbmdlc1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnNwYXJxbFByb2Nlc3Nvci5pbnZhbGlkYXRlQ2FjaGUoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KVxuICAgICAgICApO1xuICAgICAgICBcbiAgICAgICAgLy8gUmVnaXN0ZXIgZmlsZSBkZWxldGlvbiBoYW5kbGVyXG4gICAgICAgIHRoaXMucmVnaXN0ZXJFdmVudChcbiAgICAgICAgICAgIHRoaXMuYXBwLnZhdWx0Lm9uKCdkZWxldGUnLCBhc3luYyAoZmlsZSkgPT4ge1xuICAgICAgICAgICAgICAgIGlmIChmaWxlIGluc3RhbmNlb2YgVEZpbGUgJiYgZmlsZS5leHRlbnNpb24gPT09ICdtZCcpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5yZW1vdmVGaWxlRnJvbUdyYXBoKGZpbGUpO1xuICAgICAgICAgICAgICAgICAgICAvLyBJbnZhbGlkYXRlIFNQQVJRTCBxdWVyeSBjYWNoZSB3aGVuIGRhdGEgY2hhbmdlc1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnNwYXJxbFByb2Nlc3Nvci5pbnZhbGlkYXRlQ2FjaGUoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KVxuICAgICAgICApO1xuICAgICAgICBcbiAgICAgICAgbmV3IE5vdGljZSgn8J+UjSBFeG9jb3J0ZXg6IFNQQVJRTCBzdXBwb3J0IGFuZCBncmFwaCB2aXN1YWxpemF0aW9uIGVuYWJsZWQhJyk7XG4gICAgICAgIC8vIFNQQVJRTCBhbmQgZ3JhcGggcHJvY2Vzc29ycyBpbml0aWFsaXplZFxuICAgIH1cbiAgICBcbiAgICBwcml2YXRlIGFzeW5jIGxvYWRWYXVsdEludG9HcmFwaCgpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICAgICAgLy8gTG9hZGluZyB2YXVsdCBkYXRhXG4gICAgICAgIGNvbnN0IHN0YXJ0VGltZSA9IERhdGUubm93KCk7XG4gICAgICAgIGxldCB0cmlwbGVzQ291bnQgPSAwO1xuICAgICAgICBcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGNvbnN0IGZpbGVzID0gdGhpcy5hcHAudmF1bHQuZ2V0TWFya2Rvd25GaWxlcygpO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICBmb3IgKGNvbnN0IGZpbGUgb2YgZmlsZXMpIHtcbiAgICAgICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBjb250ZW50ID0gYXdhaXQgdGhpcy5hcHAudmF1bHQucmVhZChmaWxlKTtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgdHJpcGxlcyA9IHRoaXMuZXh0cmFjdFRyaXBsZXNGcm9tRmlsZShmaWxlLCBjb250ZW50KTtcbiAgICAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgICAgIGZvciAoY29uc3QgdHJpcGxlIG9mIHRyaXBsZXMpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZ3JhcGguYWRkKHRyaXBsZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB0cmlwbGVzQ291bnQrKztcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgICAgICAgICAgICAgICAvLyBGaWxlIHByb2Nlc3NpbmcgZmFpbGVkIC0gY29udGludWUgd2l0aCBuZXh0IGZpbGVcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgICAgICAgLy8gVmF1bHQgYWNjZXNzIGZhaWxlZCAtIHBsdWdpbiBzaG91bGQgc3RpbGwgZnVuY3Rpb25cbiAgICAgICAgICAgIGNvbnNvbGUud2FybignRmFpbGVkIHRvIGFjY2VzcyB2YXVsdCBmaWxlcyBkdXJpbmcgZ3JhcGggaW5pdGlhbGl6YXRpb246JywgZXJyKTtcbiAgICAgICAgICAgIG5ldyBOb3RpY2UoJ0V4b2NvcnRleDogVW5hYmxlIHRvIGxvYWQgdmF1bHQgZmlsZXMgaW50byBncmFwaCcpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICBjb25zdCBsb2FkVGltZSA9IERhdGUubm93KCkgLSBzdGFydFRpbWU7XG4gICAgICAgIC8vIFZhdWx0IGRhdGEgbG9hZGVkXG4gICAgfVxuICAgIFxuICAgIHByaXZhdGUgYXN5bmMgdXBkYXRlRmlsZUluR3JhcGgoZmlsZTogVEZpbGUpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIC8vIFJlbW92ZSBvbGQgdHJpcGxlcyBmb3IgdGhpcyBmaWxlXG4gICAgICAgICAgICB0aGlzLnJlbW92ZUZpbGVGcm9tR3JhcGgoZmlsZSk7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIC8vIEFkZCBuZXcgdHJpcGxlc1xuICAgICAgICAgICAgY29uc3QgY29udGVudCA9IGF3YWl0IHRoaXMuYXBwLnZhdWx0LnJlYWQoZmlsZSk7XG4gICAgICAgICAgICBjb25zdCB0cmlwbGVzID0gdGhpcy5leHRyYWN0VHJpcGxlc0Zyb21GaWxlKGZpbGUsIGNvbnRlbnQpO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICBmb3IgKGNvbnN0IHRyaXBsZSBvZiB0cmlwbGVzKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5ncmFwaC5hZGQodHJpcGxlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICAgICAgICAvLyBGaWxlIHVwZGF0ZSBmYWlsZWRcbiAgICAgICAgfVxuICAgIH1cbiAgICBcbiAgICBwcml2YXRlIHJlbW92ZUZpbGVGcm9tR3JhcGgoZmlsZTogVEZpbGUpOiB2b2lkIHtcbiAgICAgICAgY29uc3Qgc3ViamVjdCA9IG5ldyBJUkkoYGZpbGU6Ly8ke2ZpbGUuYmFzZW5hbWV9YCk7XG4gICAgICAgIGNvbnN0IHRyaXBsZXNUb1JlbW92ZSA9IHRoaXMuZ3JhcGgubWF0Y2goc3ViamVjdCwgbnVsbCwgbnVsbCk7XG4gICAgICAgIFxuICAgICAgICBmb3IgKGNvbnN0IHRyaXBsZSBvZiB0cmlwbGVzVG9SZW1vdmUpIHtcbiAgICAgICAgICAgIHRoaXMuZ3JhcGgucmVtb3ZlKHRyaXBsZSk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgXG4gICAgcHJpdmF0ZSBleHRyYWN0VHJpcGxlc0Zyb21GaWxlKGZpbGU6IFRGaWxlLCBjb250ZW50OiBzdHJpbmcpOiBUcmlwbGVbXSB7XG4gICAgICAgIGNvbnN0IHRyaXBsZXM6IFRyaXBsZVtdID0gW107XG4gICAgICAgIGNvbnN0IHN1YmplY3QgPSBuZXcgSVJJKGBmaWxlOi8vJHtmaWxlLmJhc2VuYW1lfWApO1xuICAgICAgICBcbiAgICAgICAgLy8gRXh0cmFjdCBmcm9udG1hdHRlclxuICAgICAgICBjb25zdCBmcm9udG1hdHRlck1hdGNoID0gY29udGVudC5tYXRjaCgvXi0tLVxcbihbXFxzXFxTXSo/KVxcbi0tLS8pO1xuICAgICAgICBcbiAgICAgICAgaWYgKGZyb250bWF0dGVyTWF0Y2gpIHtcbiAgICAgICAgICAgIGNvbnN0IGZyb250bWF0dGVyID0gdGhpcy5wYXJzZUZyb250bWF0dGVyKGZyb250bWF0dGVyTWF0Y2hbMV0pO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICBmb3IgKGNvbnN0IFtrZXksIHZhbHVlXSBvZiBPYmplY3QuZW50cmllcyhmcm9udG1hdHRlcikpIHtcbiAgICAgICAgICAgICAgICBpZiAoQXJyYXkuaXNBcnJheSh2YWx1ZSkpIHtcbiAgICAgICAgICAgICAgICAgICAgZm9yIChjb25zdCB2IG9mIHZhbHVlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0cmlwbGVzLnB1c2gobmV3IFRyaXBsZShcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdWJqZWN0LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5ldyBJUkkoa2V5KSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBMaXRlcmFsLnN0cmluZyhTdHJpbmcodikpXG4gICAgICAgICAgICAgICAgICAgICAgICApKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAodmFsdWUgIT09IG51bGwgJiYgdmFsdWUgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgICAgICB0cmlwbGVzLnB1c2gobmV3IFRyaXBsZShcbiAgICAgICAgICAgICAgICAgICAgICAgIHN1YmplY3QsXG4gICAgICAgICAgICAgICAgICAgICAgICBuZXcgSVJJKGtleSksXG4gICAgICAgICAgICAgICAgICAgICAgICBMaXRlcmFsLnN0cmluZyhTdHJpbmcodmFsdWUpKVxuICAgICAgICAgICAgICAgICAgICApKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIC8vIEFkZCBiYXNpYyBmaWxlIG1ldGFkYXRhXG4gICAgICAgIHRyaXBsZXMucHVzaChuZXcgVHJpcGxlKFxuICAgICAgICAgICAgc3ViamVjdCxcbiAgICAgICAgICAgIG5ldyBJUkkoJ2ZpbGVfcGF0aCcpLFxuICAgICAgICAgICAgTGl0ZXJhbC5zdHJpbmcoZmlsZS5wYXRoKVxuICAgICAgICApKTtcbiAgICAgICAgXG4gICAgICAgIHRyaXBsZXMucHVzaChuZXcgVHJpcGxlKFxuICAgICAgICAgICAgc3ViamVjdCxcbiAgICAgICAgICAgIG5ldyBJUkkoJ2ZpbGVfbmFtZScpLFxuICAgICAgICAgICAgTGl0ZXJhbC5zdHJpbmcoZmlsZS5uYW1lKVxuICAgICAgICApKTtcbiAgICAgICAgXG4gICAgICAgIHJldHVybiB0cmlwbGVzO1xuICAgIH1cbiAgICBcbiAgICBwcml2YXRlIHBhcnNlRnJvbnRtYXR0ZXIoeWFtbDogc3RyaW5nKTogUmVjb3JkPHN0cmluZywgYW55PiB7XG4gICAgICAgIGNvbnN0IHJlc3VsdDogUmVjb3JkPHN0cmluZywgYW55PiA9IHt9O1xuICAgICAgICBjb25zdCBsaW5lcyA9IHlhbWwuc3BsaXQoJ1xcbicpO1xuICAgICAgICBsZXQgY3VycmVudEtleTogc3RyaW5nIHwgbnVsbCA9IG51bGw7XG4gICAgICAgIGxldCBjdXJyZW50VmFsdWU6IGFueSA9IG51bGw7XG4gICAgICAgIGxldCBpbkFycmF5ID0gZmFsc2U7XG4gICAgICAgIFxuICAgICAgICBmb3IgKGNvbnN0IGxpbmUgb2YgbGluZXMpIHtcbiAgICAgICAgICAgIGNvbnN0IHRyaW1tZWQgPSBsaW5lLnRyaW0oKTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgaWYgKCF0cmltbWVkKSBjb250aW51ZTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgLy8gQ2hlY2sgZm9yIGFycmF5IGl0ZW1cbiAgICAgICAgICAgIGlmIChsaW5lLnN0YXJ0c1dpdGgoJyAgLSAnKSB8fCBsaW5lLnN0YXJ0c1dpdGgoJyAgICAtICcpKSB7XG4gICAgICAgICAgICAgICAgaWYgKGN1cnJlbnRLZXkgJiYgaW5BcnJheSkge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCB2YWx1ZSA9IGxpbmUuc3Vic3RyaW5nKGxpbmUuaW5kZXhPZignLSAnKSArIDIpLnRyaW0oKTtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgY2xlYW5WYWx1ZSA9IHZhbHVlLnJlcGxhY2UoL15bXCInXXxbXCInXSQvZywgJycpLnJlcGxhY2UoL1xcW1xcW3xcXF1cXF0vZywgJycpO1xuICAgICAgICAgICAgICAgICAgICBpZiAoIUFycmF5LmlzQXJyYXkoY3VycmVudFZhbHVlKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVudFZhbHVlID0gW107XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgY3VycmVudFZhbHVlLnB1c2goY2xlYW5WYWx1ZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgXG4gICAgICAgICAgICAvLyBDaGVjayBmb3Iga2V5OnZhbHVlIHBhaXJcbiAgICAgICAgICAgIGlmICh0cmltbWVkLmluY2x1ZGVzKCc6JykpIHtcbiAgICAgICAgICAgICAgICAvLyBTYXZlIHByZXZpb3VzIGtleS12YWx1ZSBpZiBleGlzdHNcbiAgICAgICAgICAgICAgICBpZiAoY3VycmVudEtleSAhPT0gbnVsbCAmJiBjdXJyZW50VmFsdWUgIT09IG51bGwpIHtcbiAgICAgICAgICAgICAgICAgICAgcmVzdWx0W2N1cnJlbnRLZXldID0gY3VycmVudFZhbHVlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICBjb25zdCBjb2xvbkluZGV4ID0gdHJpbW1lZC5pbmRleE9mKCc6Jyk7XG4gICAgICAgICAgICAgICAgY3VycmVudEtleSA9IHRyaW1tZWQuc3Vic3RyaW5nKDAsIGNvbG9uSW5kZXgpLnRyaW0oKTtcbiAgICAgICAgICAgICAgICBjb25zdCB2YWx1ZVN0ciA9IHRyaW1tZWQuc3Vic3RyaW5nKGNvbG9uSW5kZXggKyAxKS50cmltKCk7XG4gICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgaWYgKCF2YWx1ZVN0cikge1xuICAgICAgICAgICAgICAgICAgICAvLyBWYWx1ZSB3aWxsIGJlIG9uIG5leHQgbGluZXMgKGFycmF5KVxuICAgICAgICAgICAgICAgICAgICBpbkFycmF5ID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgY3VycmVudFZhbHVlID0gW107XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gU2luZ2xlIHZhbHVlXG4gICAgICAgICAgICAgICAgICAgIGluQXJyYXkgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgY3VycmVudFZhbHVlID0gdmFsdWVTdHIucmVwbGFjZSgvXltcIiddfFtcIiddJC9nLCAnJykucmVwbGFjZSgvXFxbXFxbfFxcXVxcXS9nLCAnJyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICAvLyBTYXZlIGxhc3Qga2V5LXZhbHVlXG4gICAgICAgIGlmIChjdXJyZW50S2V5ICE9PSBudWxsICYmIGN1cnJlbnRWYWx1ZSAhPT0gbnVsbCkge1xuICAgICAgICAgICAgcmVzdWx0W2N1cnJlbnRLZXldID0gY3VycmVudFZhbHVlO1xuICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgIH1cbiAgICBcbiAgICBhc3luYyBvbnVubG9hZCgpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICAgICAgLy8gUGx1Z2luIGNsZWFudXAgY29tcGxldGVkXG4gICAgICAgIGlmICh0aGlzLmdyYXBoKSB7XG4gICAgICAgICAgICB0aGlzLmdyYXBoLmNsZWFyKCk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMuc3BhcnFsUHJvY2Vzc29yKSB7XG4gICAgICAgICAgICB0aGlzLnNwYXJxbFByb2Nlc3Nvci5kZXN0cm95KCk7XG4gICAgICAgIH1cbiAgICB9XG59Il0sInZlcnNpb24iOjN9