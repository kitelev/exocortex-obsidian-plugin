3f614a27acdf265ae68b976dc234a87d
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.RenderClassButtonsUseCase = void 0;
const tslib_1 = require("tslib");
const Result_1 = require("../../domain/core/Result");
const ClassName_1 = require("../../domain/value-objects/ClassName");
class RenderClassButtonsUseCase {
    constructor(classViewRepository, buttonRepository) {
        this.classViewRepository = classViewRepository;
        this.buttonRepository = buttonRepository;
    }
    execute(request) {
        var _a;
        return tslib_1.__awaiter(this, void 0, void 0, function* () {
            // Validate request
            if (!request.className) {
                return Result_1.Result.fail('Class name is required');
            }
            // Create ClassName value object
            const classNameResult = ClassName_1.ClassName.create(request.className);
            if (classNameResult.isFailure) {
                return Result_1.Result.fail(classNameResult.error);
            }
            const className = classNameResult.getValue();
            // Find ClassView configuration
            const classViewResult = yield this.classViewRepository.findByClassName(className);
            if (classViewResult.isFailure) {
                return Result_1.Result.fail(`Failed to load class view: ${classViewResult.error}`);
            }
            const classView = classViewResult.getValue();
            // If no ClassView configured, return empty buttons
            if (!classView) {
                return Result_1.Result.ok({
                    buttons: [],
                    displayOptions: {
                        position: 'top',
                        showButtons: false
                    }
                });
            }
            // Check if buttons should be shown
            if (!classView.displayOptions.showButtons) {
                return Result_1.Result.ok({
                    buttons: [],
                    displayOptions: {
                        position: classView.displayOptions.buttonPosition,
                        showButtons: false
                    }
                });
            }
            // Get enabled buttons
            const enabledButtons = classView.getEnabledButtons();
            // Load commands for each button
            const buttonRenderData = [];
            for (const button of enabledButtons) {
                const commandResult = yield this.buttonRepository.findCommandById(button.commandId);
                if (commandResult.isFailure) {
                    console.warn(`Failed to load command for button ${button.id}: ${commandResult.error}`);
                    continue;
                }
                const command = commandResult.getValue();
                if (!command) {
                    console.warn(`Command not found for button ${button.id}`);
                    continue;
                }
                // Check if command can be executed in current context
                const canExecute = command.canExecute({
                    currentClass: request.className,
                    hasSelection: ((_a = request.context) === null || _a === void 0 ? void 0 : _a.hasSelection) || false
                });
                // Only include button if it can be executed
                if (canExecute) {
                    buttonRenderData.push({
                        buttonId: button.id.toString(),
                        label: button.label,
                        tooltip: button.tooltip,
                        isEnabled: button.isEnabled,
                        order: button.order,
                        command: {
                            id: command.id.toString(),
                            type: command.type,
                            requiresInput: command.requiresInput,
                            parameters: command.parameters
                        }
                    });
                }
            }
            // Sort buttons by order
            buttonRenderData.sort((a, b) => a.order - b.order);
            return Result_1.Result.ok({
                buttons: buttonRenderData,
                displayOptions: {
                    position: classView.displayOptions.buttonPosition,
                    showButtons: true
                }
            });
        });
    }
}
exports.RenderClassButtonsUseCase = RenderClassButtonsUseCase;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL2tpdGVsZXYvRG9jdW1lbnRzL2V4b2NvcnRleC1vYnNpZGlhbi1wbHVnaW4vc3JjL2FwcGxpY2F0aW9uL3VzZS1jYXNlcy9SZW5kZXJDbGFzc0J1dHRvbnNVc2VDYXNlLnRzIiwibWFwcGluZ3MiOiI7Ozs7QUFDQSxxREFBa0Q7QUFHbEQsb0VBQWlFO0FBdUNqRSxNQUFhLHlCQUF5QjtJQUdsQyxZQUNZLG1CQUF5QyxFQUN6QyxnQkFBbUM7UUFEbkMsd0JBQW1CLEdBQW5CLG1CQUFtQixDQUFzQjtRQUN6QyxxQkFBZ0IsR0FBaEIsZ0JBQWdCLENBQW1CO0lBQzVDLENBQUM7SUFFRSxPQUFPLENBQUMsT0FBa0M7OztZQUM1QyxtQkFBbUI7WUFDbkIsSUFBSSxDQUFDLE9BQU8sQ0FBQyxTQUFTLEVBQUU7Z0JBQ3BCLE9BQU8sZUFBTSxDQUFDLElBQUksQ0FBNkIsd0JBQXdCLENBQUMsQ0FBQzthQUM1RTtZQUVELGdDQUFnQztZQUNoQyxNQUFNLGVBQWUsR0FBRyxxQkFBUyxDQUFDLE1BQU0sQ0FBQyxPQUFPLENBQUMsU0FBUyxDQUFDLENBQUM7WUFDNUQsSUFBSSxlQUFlLENBQUMsU0FBUyxFQUFFO2dCQUMzQixPQUFPLGVBQU0sQ0FBQyxJQUFJLENBQTZCLGVBQWUsQ0FBQyxLQUFLLENBQUMsQ0FBQzthQUN6RTtZQUNELE1BQU0sU0FBUyxHQUFHLGVBQWUsQ0FBQyxRQUFRLEVBQUUsQ0FBQztZQUU3QywrQkFBK0I7WUFDL0IsTUFBTSxlQUFlLEdBQUcsTUFBTSxJQUFJLENBQUMsbUJBQW1CLENBQUMsZUFBZSxDQUFDLFNBQVMsQ0FBQyxDQUFDO1lBQ2xGLElBQUksZUFBZSxDQUFDLFNBQVMsRUFBRTtnQkFDM0IsT0FBTyxlQUFNLENBQUMsSUFBSSxDQUNkLDhCQUE4QixlQUFlLENBQUMsS0FBSyxFQUFFLENBQ3hELENBQUM7YUFDTDtZQUVELE1BQU0sU0FBUyxHQUFHLGVBQWUsQ0FBQyxRQUFRLEVBQUUsQ0FBQztZQUU3QyxtREFBbUQ7WUFDbkQsSUFBSSxDQUFDLFNBQVMs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IjpbIi9Vc2Vycy9raXRlbGV2L0RvY3VtZW50cy9leG9jb3J0ZXgtb2JzaWRpYW4tcGx1Z2luL3NyYy9hcHBsaWNhdGlvbi91c2UtY2FzZXMvUmVuZGVyQ2xhc3NCdXR0b25zVXNlQ2FzZS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBVc2VDYXNlIH0gZnJvbSAnLi4vY29yZS9Vc2VDYXNlJztcbmltcG9ydCB7IFJlc3VsdCB9IGZyb20gJy4uLy4uL2RvbWFpbi9jb3JlL1Jlc3VsdCc7XG5pbXBvcnQgeyBJQ2xhc3NWaWV3UmVwb3NpdG9yeSB9IGZyb20gJy4uLy4uL2RvbWFpbi9yZXBvc2l0b3JpZXMvSUNsYXNzVmlld1JlcG9zaXRvcnknO1xuaW1wb3J0IHsgSUJ1dHRvblJlcG9zaXRvcnkgfSBmcm9tICcuLi8uLi9kb21haW4vcmVwb3NpdG9yaWVzL0lCdXR0b25SZXBvc2l0b3J5JztcbmltcG9ydCB7IENsYXNzTmFtZSB9IGZyb20gJy4uLy4uL2RvbWFpbi92YWx1ZS1vYmplY3RzL0NsYXNzTmFtZSc7XG5pbXBvcnQgeyBVSUJ1dHRvbiB9IGZyb20gJy4uLy4uL2RvbWFpbi9lbnRpdGllcy9VSUJ1dHRvbic7XG5pbXBvcnQgeyBCdXR0b25Db21tYW5kIH0gZnJvbSAnLi4vLi4vZG9tYWluL2VudGl0aWVzL0J1dHRvbkNvbW1hbmQnO1xuXG4vKipcbiAqIFVzZSBDYXNlIGZvciByZW5kZXJpbmcgYnV0dG9ucyBpbiBhbiBhc3NldCB2aWV3XG4gKiBGb2xsb3dpbmcgQ2xlYW4gQXJjaGl0ZWN0dXJlIC0gb3JjaGVzdHJhdGVzIGRvbWFpbiBsb2dpY1xuICovXG5leHBvcnQgaW50ZXJmYWNlIFJlbmRlckNsYXNzQnV0dG9uc1JlcXVlc3Qge1xuICAgIGNsYXNzTmFtZTogc3RyaW5nO1xuICAgIGFzc2V0SWQ/OiBzdHJpbmc7XG4gICAgY29udGV4dD86IHtcbiAgICAgICAgaGFzU2VsZWN0aW9uOiBib29sZWFuO1xuICAgICAgICBjdXJyZW50VXNlcj86IHN0cmluZztcbiAgICB9O1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIEJ1dHRvblJlbmRlckRhdGEge1xuICAgIGJ1dHRvbklkOiBzdHJpbmc7XG4gICAgbGFiZWw6IHN0cmluZztcbiAgICB0b29sdGlwPzogc3RyaW5nO1xuICAgIGlzRW5hYmxlZDogYm9vbGVhbjtcbiAgICBvcmRlcjogbnVtYmVyO1xuICAgIGNvbW1hbmQ6IHtcbiAgICAgICAgaWQ6IHN0cmluZztcbiAgICAgICAgdHlwZTogc3RyaW5nO1xuICAgICAgICByZXF1aXJlc0lucHV0OiBib29sZWFuO1xuICAgICAgICBwYXJhbWV0ZXJzOiBhbnlbXTtcbiAgICB9O1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIFJlbmRlckNsYXNzQnV0dG9uc1Jlc3BvbnNlIHtcbiAgICBidXR0b25zOiBCdXR0b25SZW5kZXJEYXRhW107XG4gICAgZGlzcGxheU9wdGlvbnM6IHtcbiAgICAgICAgcG9zaXRpb246ICd0b3AnIHwgJ2JvdHRvbScgfCAnZmxvYXRpbmcnO1xuICAgICAgICBzaG93QnV0dG9uczogYm9vbGVhbjtcbiAgICB9O1xufVxuXG5leHBvcnQgY2xhc3MgUmVuZGVyQ2xhc3NCdXR0b25zVXNlQ2FzZSBcbiAgICBpbXBsZW1lbnRzIFVzZUNhc2U8UmVuZGVyQ2xhc3NCdXR0b25zUmVxdWVzdCwgUmVuZGVyQ2xhc3NCdXR0b25zUmVzcG9uc2U+IHtcbiAgICBcbiAgICBjb25zdHJ1Y3RvcihcbiAgICAgICAgcHJpdmF0ZSBjbGFzc1ZpZXdSZXBvc2l0b3J5OiBJQ2xhc3NWaWV3UmVwb3NpdG9yeSxcbiAgICAgICAgcHJpdmF0ZSBidXR0b25SZXBvc2l0b3J5OiBJQnV0dG9uUmVwb3NpdG9yeVxuICAgICkge31cblxuICAgIGFzeW5jIGV4ZWN1dGUocmVxdWVzdDogUmVuZGVyQ2xhc3NCdXR0b25zUmVxdWVzdCk6IFByb21pc2U8UmVzdWx0PFJlbmRlckNsYXNzQnV0dG9uc1Jlc3BvbnNlPj4ge1xuICAgICAgICAvLyBWYWxpZGF0ZSByZXF1ZXN0XG4gICAgICAgIGlmICghcmVxdWVzdC5jbGFzc05hbWUpIHtcbiAgICAgICAgICAgIHJldHVybiBSZXN1bHQuZmFpbDxSZW5kZXJDbGFzc0J1dHRvbnNSZXNwb25zZT4oJ0NsYXNzIG5hbWUgaXMgcmVxdWlyZWQnKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIENyZWF0ZSBDbGFzc05hbWUgdmFsdWUgb2JqZWN0XG4gICAgICAgIGNvbnN0IGNsYXNzTmFtZVJlc3VsdCA9IENsYXNzTmFtZS5jcmVhdGUocmVxdWVzdC5jbGFzc05hbWUpO1xuICAgICAgICBpZiAoY2xhc3NOYW1lUmVzdWx0LmlzRmFpbHVyZSkge1xuICAgICAgICAgICAgcmV0dXJuIFJlc3VsdC5mYWlsPFJlbmRlckNsYXNzQnV0dG9uc1Jlc3BvbnNlPihjbGFzc05hbWVSZXN1bHQuZXJyb3IpO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGNsYXNzTmFtZSA9IGNsYXNzTmFtZVJlc3VsdC5nZXRWYWx1ZSgpO1xuXG4gICAgICAgIC8vIEZpbmQgQ2xhc3NWaWV3IGNvbmZpZ3VyYXRpb25cbiAgICAgICAgY29uc3QgY2xhc3NWaWV3UmVzdWx0ID0gYXdhaXQgdGhpcy5jbGFzc1ZpZXdSZXBvc2l0b3J5LmZpbmRCeUNsYXNzTmFtZShjbGFzc05hbWUpO1xuICAgICAgICBpZiAoY2xhc3NWaWV3UmVzdWx0LmlzRmFpbHVyZSkge1xuICAgICAgICAgICAgcmV0dXJuIFJlc3VsdC5mYWlsPFJlbmRlckNsYXNzQnV0dG9uc1Jlc3BvbnNlPihcbiAgICAgICAgICAgICAgICBgRmFpbGVkIHRvIGxvYWQgY2xhc3MgdmlldzogJHtjbGFzc1ZpZXdSZXN1bHQuZXJyb3J9YFxuICAgICAgICAgICAgKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IGNsYXNzVmlldyA9IGNsYXNzVmlld1Jlc3VsdC5nZXRWYWx1ZSgpO1xuICAgICAgICBcbiAgICAgICAgLy8gSWYgbm8gQ2xhc3NWaWV3IGNvbmZpZ3VyZWQsIHJldHVybiBlbXB0eSBidXR0b25zXG4gICAgICAgIGlmICghY2xhc3NWaWV3KSB7XG4gICAgICAgICAgICByZXR1cm4gUmVzdWx0Lm9rPFJlbmRlckNsYXNzQnV0dG9uc1Jlc3BvbnNlPih7XG4gICAgICAgICAgICAgICAgYnV0dG9uczogW10sXG4gICAgICAgICAgICAgICAgZGlzcGxheU9wdGlvbnM6IHtcbiAgICAgICAgICAgICAgICAgICAgcG9zaXRpb246ICd0b3AnLFxuICAgICAgICAgICAgICAgICAgICBzaG93QnV0dG9uczogZmFsc2VcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIENoZWNrIGlmIGJ1dHRvbnMgc2hvdWxkIGJlIHNob3duXG4gICAgICAgIGlmICghY2xhc3NWaWV3LmRpc3BsYXlPcHRpb25zLnNob3dCdXR0b25zKSB7XG4gICAgICAgICAgICByZXR1cm4gUmVzdWx0Lm9rPFJlbmRlckNsYXNzQnV0dG9uc1Jlc3BvbnNlPih7XG4gICAgICAgICAgICAgICAgYnV0dG9uczogW10sXG4gICAgICAgICAgICAgICAgZGlzcGxheU9wdGlvbnM6IHtcbiAgICAgICAgICAgICAgICAgICAgcG9zaXRpb246IGNsYXNzVmlldy5kaXNwbGF5T3B0aW9ucy5idXR0b25Qb3NpdGlvbixcbiAgICAgICAgICAgICAgICAgICAgc2hvd0J1dHRvbnM6IGZhbHNlXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBHZXQgZW5hYmxlZCBidXR0b25zXG4gICAgICAgIGNvbnN0IGVuYWJsZWRCdXR0b25zID0gY2xhc3NWaWV3LmdldEVuYWJsZWRCdXR0b25zKCk7XG4gICAgICAgIFxuICAgICAgICAvLyBMb2FkIGNvbW1hbmRzIGZvciBlYWNoIGJ1dHRvblxuICAgICAgICBjb25zdCBidXR0b25SZW5kZXJEYXRhOiBCdXR0b25SZW5kZXJEYXRhW10gPSBbXTtcbiAgICAgICAgXG4gICAgICAgIGZvciAoY29uc3QgYnV0dG9uIG9mIGVuYWJsZWRCdXR0b25zKSB7XG4gICAgICAgICAgICBjb25zdCBjb21tYW5kUmVzdWx0ID0gYXdhaXQgdGhpcy5idXR0b25SZXBvc2l0b3J5LmZpbmRDb21tYW5kQnlJZChidXR0b24uY29tbWFuZElkKTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgaWYgKGNvbW1hbmRSZXN1bHQuaXNGYWlsdXJlKSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS53YXJuKGBGYWlsZWQgdG8gbG9hZCBjb21tYW5kIGZvciBidXR0b24gJHtidXR0b24uaWR9OiAke2NvbW1hbmRSZXN1bHQuZXJyb3J9YCk7XG4gICAgICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGNvbnN0IGNvbW1hbmQgPSBjb21tYW5kUmVzdWx0LmdldFZhbHVlKCk7XG4gICAgICAgICAgICBpZiAoIWNvbW1hbmQpIHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLndhcm4oYENvbW1hbmQgbm90IGZvdW5kIGZvciBidXR0b24gJHtidXR0b24uaWR9YCk7XG4gICAgICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIENoZWNrIGlmIGNvbW1hbmQgY2FuIGJlIGV4ZWN1dGVkIGluIGN1cnJlbnQgY29udGV4dFxuICAgICAgICAgICAgY29uc3QgY2FuRXhlY3V0ZSA9IGNvbW1hbmQuY2FuRXhlY3V0ZSh7XG4gICAgICAgICAgICAgICAgY3VycmVudENsYXNzOiByZXF1ZXN0LmNsYXNzTmFtZSxcbiAgICAgICAgICAgICAgICBoYXNTZWxlY3Rpb246IHJlcXVlc3QuY29udGV4dD8uaGFzU2VsZWN0aW9uIHx8IGZhbHNlXG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgLy8gT25seSBpbmNsdWRlIGJ1dHRvbiBpZiBpdCBjYW4gYmUgZXhlY3V0ZWRcbiAgICAgICAgICAgIGlmIChjYW5FeGVjdXRlKSB7XG4gICAgICAgICAgICAgICAgYnV0dG9uUmVuZGVyRGF0YS5wdXNoKHtcbiAgICAgICAgICAgICAgICAgICAgYnV0dG9uSWQ6IGJ1dHRvbi5pZC50b1N0cmluZygpLFxuICAgICAgICAgICAgICAgICAgICBsYWJlbDogYnV0dG9uLmxhYmVsLFxuICAgICAgICAgICAgICAgICAgICB0b29sdGlwOiBidXR0b24udG9vbHRpcCxcbiAgICAgICAgICAgICAgICAgICAgaXNFbmFibGVkOiBidXR0b24uaXNFbmFibGVkLFxuICAgICAgICAgICAgICAgICAgICBvcmRlcjogYnV0dG9uLm9yZGVyLFxuICAgICAgICAgICAgICAgICAgICBjb21tYW5kOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZDogY29tbWFuZC5pZC50b1N0cmluZygpLFxuICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogY29tbWFuZC50eXBlLFxuICAgICAgICAgICAgICAgICAgICAgICAgcmVxdWlyZXNJbnB1dDogY29tbWFuZC5yZXF1aXJlc0lucHV0LFxuICAgICAgICAgICAgICAgICAgICAgICAgcGFyYW1ldGVyczogY29tbWFuZC5wYXJhbWV0ZXJzXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIC8vIFNvcnQgYnV0dG9ucyBieSBvcmRlclxuICAgICAgICBidXR0b25SZW5kZXJEYXRhLnNvcnQoKGEsIGIpID0+IGEub3JkZXIgLSBiLm9yZGVyKTtcblxuICAgICAgICByZXR1cm4gUmVzdWx0Lm9rPFJlbmRlckNsYXNzQnV0dG9uc1Jlc3BvbnNlPih7XG4gICAgICAgICAgICBidXR0b25zOiBidXR0b25SZW5kZXJEYXRhLFxuICAgICAgICAgICAgZGlzcGxheU9wdGlvbnM6IHtcbiAgICAgICAgICAgICAgICBwb3NpdGlvbjogY2xhc3NWaWV3LmRpc3BsYXlPcHRpb25zLmJ1dHRvblBvc2l0aW9uLFxuICAgICAgICAgICAgICAgIHNob3dCdXR0b25zOiB0cnVlXG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH1cbn0iXSwidmVyc2lvbiI6M30=