64ca16a637225946402d81bbdd14ddd0
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.ClassLayout = void 0;
const Entity_1 = require("../core/Entity");
const Result_1 = require("../core/Result");
class ClassLayout extends Entity_1.Entity {
    constructor(props) {
        super(props, props.id.toString());
    }
    generateId() {
        return this.props.id.toString();
    }
    validate() {
        if (!this.props.id) {
            throw new Error("ClassLayout must have a valid ID");
        }
        if (!this.props.targetClass) {
            throw new Error("ClassLayout must have a valid target class");
        }
        if (this.props.blocks.length > ClassLayout.MAX_BLOCKS) {
            throw new Error(`ClassLayout cannot have more than ${ClassLayout.MAX_BLOCKS} blocks`);
        }
    }
    static create(props) {
        if (!props.targetClass) {
            return Result_1.Result.fail("Target class is required");
        }
        if (props.blocks.length > ClassLayout.MAX_BLOCKS) {
            return Result_1.Result.fail(`Cannot have more than ${ClassLayout.MAX_BLOCKS} blocks`);
        }
        const orders = props.blocks.map((b) => b.order);
        const uniqueOrders = new Set(orders);
        if (uniqueOrders.size !== orders.length) {
            return Result_1.Result.fail("Blocks cannot have duplicate order values");
        }
        return Result_1.Result.ok(new ClassLayout(props));
    }
    get id() {
        return this.props.id;
    }
    get targetClass() {
        return this.props.targetClass;
    }
    get blocks() {
        return [...this.props.blocks].sort((a, b) => a.order - b.order);
    }
    get isEnabled() {
        return this.props.isEnabled;
    }
    get priority() {
        return this.props.priority;
    }
    addBlock(block) {
        if (this.props.blocks.length >= ClassLayout.MAX_BLOCKS) {
            return Result_1.Result.fail(`Cannot add more blocks. Maximum of ${ClassLayout.MAX_BLOCKS} reached`);
        }
        if (this.props.blocks.some((b) => b.id === block.id)) {
            return Result_1.Result.fail("Block with this ID already exists");
        }
        if (this.props.blocks.some((b) => b.order === block.order)) {
            return Result_1.Result.fail(`Block with order ${block.order} already exists`);
        }
        this.props.blocks.push(block);
        return Result_1.Result.ok();
    }
    removeBlock(blockId) {
        const blockIndex = this.props.blocks.findIndex((b) => b.id === blockId);
        if (blockIndex === -1) {
            return Result_1.Result.fail("Block not found");
        }
        this.props.blocks.splice(blockIndex, 1);
        return Result_1.Result.ok();
    }
    updateBlock(blockId, updates) {
        const block = this.props.blocks.find((b) => b.id === blockId);
        if (!block) {
            return Result_1.Result.fail("Block not found");
        }
        if (updates.order !== undefined && updates.order !== block.order) {
            if (this.props.blocks.some((b) => b.id !== blockId && b.order === updates.order)) {
                return Result_1.Result.fail(`Block with order ${updates.order} already exists`);
            }
        }
        Object.assign(block, updates);
        return Result_1.Result.ok();
    }
    getVisibleBlocks() {
        return this.blocks.filter((b) => b.isVisible);
    }
    enable() {
        this.props.isEnabled = true;
    }
    disable() {
        this.props.isEnabled = false;
    }
}
exports.ClassLayout = ClassLayout;
ClassLayout.MAX_BLOCKS = 20;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL2tpdGVsZXYvRG9jdW1lbnRzL2V4b2NvcnRleC1vYnNpZGlhbi1wbHVnaW4vc3JjL2RvbWFpbi9lbnRpdGllcy9DbGFzc0xheW91dC50cyIsIm1hcHBpbmdzIjoiOzs7QUFBQSwyQ0FBd0M7QUFHeEMsMkNBQXdDO0FBc0J4QyxNQUFhLFdBQVksU0FBUSxlQUF3QjtJQUd2RCxZQUFvQixLQUF1QjtRQUN6QyxLQUFLLENBQUMsS0FBSyxFQUFFLEtBQUssQ0FBQyxFQUFFLENBQUMsUUFBUSxFQUFFLENBQUMsQ0FBQztJQUNwQyxDQUFDO0lBRVMsVUFBVTtRQUNsQixPQUFPLElBQUksQ0FBQyxLQUFLLENBQUMsRUFBRSxDQUFDLFFBQVEsRUFBRSxDQUFDO0lBQ2xDLENBQUM7SUFFUyxRQUFRO1FBQ2hCLElBQUksQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLEVBQUUsRUFBRTtZQUNsQixNQUFNLElBQUksS0FBSyxDQUFDLGtDQUFrQyxDQUFDLENBQUM7U0FDckQ7UUFFRCxJQUFJLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxXQUFXLEVBQUU7WUFDM0IsTUFBTSxJQUFJLEtBQUssQ0FBQyw0Q0FBNEMsQ0FBQyxDQUFDO1NBQy9EO1FBRUQsSUFBSSxJQUFJLENBQUMsS0FBSyxDQUFDLE1BQU0sQ0FBQyxNQUFNLEdBQUcsV0FBVyxDQUFDLFVBQVUsRUFBRTtZQUNyRCxNQUFNLElBQUksS0FBSyxDQUNiLHFDQUFxQyxXQUFXLENBQUMsVUFBVSxTQUFTLENBQ3JFLENBQUM7U0FDSDtJQUNILENBQUM7SUFFTSxNQUFNLENBQUMsTUFBTSxDQUFDLEtBQXVCO1FBQzFDLElBQUksQ0FBQyxLQUFLLENBQUMsV0FBVyxFQUFFO1lBQ3RCLE9BQU8sZUFBTSxDQUFDLElBQUksQ0FBYywwQkFBMEIsQ0FBQyxDQUFDO1NBQzdEO1FBRUQsSUFBSSxLQUFLLENBQUMsTUFBTSxDQUFDLE1BQU0sR0FBRyxXQUFXLENBQUMsVUFBVSxFQUFFO1lBQ2hELE9BQU8sZUFBTSxDQUFDLElBQUksQ0FDaEIseUJB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QTBJQztBQXpJeUIsc0JBQVUsR0FBRyxFQUFFLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL1VzZXJzL2tpdGVsZXYvRG9jdW1lbnRzL2V4b2NvcnRleC1vYnNpZGlhbi1wbHVnaW4vc3JjL2RvbWFpbi9lbnRpdGllcy9DbGFzc0xheW91dC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBFbnRpdHkgfSBmcm9tIFwiLi4vY29yZS9FbnRpdHlcIjtcbmltcG9ydCB7IEFzc2V0SWQgfSBmcm9tIFwiLi4vdmFsdWUtb2JqZWN0cy9Bc3NldElkXCI7XG5pbXBvcnQgeyBDbGFzc05hbWUgfSBmcm9tIFwiLi4vdmFsdWUtb2JqZWN0cy9DbGFzc05hbWVcIjtcbmltcG9ydCB7IFJlc3VsdCB9IGZyb20gXCIuLi9jb3JlL1Jlc3VsdFwiO1xuaW1wb3J0IHsgQmxvY2tUeXBlIH0gZnJvbSBcIi4vTGF5b3V0QmxvY2tcIjtcblxuZXhwb3J0IGludGVyZmFjZSBMYXlvdXRCbG9ja0NvbmZpZyB7XG4gIGlkOiBzdHJpbmc7XG4gIHR5cGU6IEJsb2NrVHlwZTtcbiAgdGl0bGU6IHN0cmluZztcbiAgb3JkZXI6IG51bWJlcjtcbiAgY29uZmlnOiBSZWNvcmQ8c3RyaW5nLCBhbnk+O1xuICBpc1Zpc2libGU6IGJvb2xlYW47XG4gIGlzQ29sbGFwc2libGU/OiBib29sZWFuO1xuICBpc0NvbGxhcHNlZD86IGJvb2xlYW47XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgQ2xhc3NMYXlvdXRQcm9wcyB7XG4gIGlkOiBBc3NldElkO1xuICB0YXJnZXRDbGFzczogQ2xhc3NOYW1lO1xuICBibG9ja3M6IExheW91dEJsb2NrQ29uZmlnW107XG4gIGlzRW5hYmxlZDogYm9vbGVhbjtcbiAgcHJpb3JpdHk6IG51bWJlcjtcbn1cblxuZXhwb3J0IGNsYXNzIENsYXNzTGF5b3V0IGV4dGVuZHMgRW50aXR5PENsYXNzTGF5b3V0UHJvcHM+IHtcbiAgcHJpdmF0ZSBzdGF0aWMgcmVhZG9ubHkgTUFYX0JMT0NLUyA9IDIwO1xuXG4gIHByaXZhdGUgY29uc3RydWN0b3IocHJvcHM6IENsYXNzTGF5b3V0UHJvcHMpIHtcbiAgICBzdXBlcihwcm9wcywgcHJvcHMuaWQudG9TdHJpbmcoKSk7XG4gIH1cblxuICBwcm90ZWN0ZWQgZ2VuZXJhdGVJZCgpOiBzdHJpbmcge1xuICAgIHJldHVybiB0aGlzLnByb3BzLmlkLnRvU3RyaW5nKCk7XG4gIH1cblxuICBwcm90ZWN0ZWQgdmFsaWRhdGUoKTogdm9pZCB7XG4gICAgaWYgKCF0aGlzLnByb3BzLmlkKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXCJDbGFzc0xheW91dCBtdXN0IGhhdmUgYSB2YWxpZCBJRFwiKTtcbiAgICB9XG5cbiAgICBpZiAoIXRoaXMucHJvcHMudGFyZ2V0Q2xhc3MpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcIkNsYXNzTGF5b3V0IG11c3QgaGF2ZSBhIHZhbGlkIHRhcmdldCBjbGFzc1wiKTtcbiAgICB9XG5cbiAgICBpZiAodGhpcy5wcm9wcy5ibG9ja3MubGVuZ3RoID4gQ2xhc3NMYXlvdXQuTUFYX0JMT0NLUykge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICBgQ2xhc3NMYXlvdXQgY2Fubm90IGhhdmUgbW9yZSB0aGFuICR7Q2xhc3NMYXlvdXQuTUFYX0JMT0NLU30gYmxvY2tzYCxcbiAgICAgICk7XG4gICAgfVxuICB9XG5cbiAgcHVibGljIHN0YXRpYyBjcmVhdGUocHJvcHM6IENsYXNzTGF5b3V0UHJvcHMpOiBSZXN1bHQ8Q2xhc3NMYXlvdXQ+IHtcbiAgICBpZiAoIXByb3BzLnRhcmdldENsYXNzKSB7XG4gICAgICByZXR1cm4gUmVzdWx0LmZhaWw8Q2xhc3NMYXlvdXQ+KFwiVGFyZ2V0IGNsYXNzIGlzIHJlcXVpcmVkXCIpO1xuICAgIH1cblxuICAgIGlmIChwcm9wcy5ibG9ja3MubGVuZ3RoID4gQ2xhc3NMYXlvdXQuTUFYX0JMT0NLUykge1xuICAgICAgcmV0dXJuIFJlc3VsdC5mYWlsPENsYXNzTGF5b3V0PihcbiAgICAgICAgYENhbm5vdCBoYXZlIG1vcmUgdGhhbiAke0NsYXNzTGF5b3V0Lk1BWF9CTE9DS1N9IGJsb2Nrc2AsXG4gICAgICApO1xuICAgIH1cblxuICAgIGNvbnN0IG9yZGVycyA9IHByb3BzLmJsb2Nrcy5tYXAoKGIpID0+IGIub3JkZXIpO1xuICAgIGNvbnN0IHVuaXF1ZU9yZGVycyA9IG5ldyBTZXQob3JkZXJzKTtcbiAgICBpZiAodW5pcXVlT3JkZXJzLnNpemUgIT09IG9yZGVycy5sZW5ndGgpIHtcbiAgICAgIHJldHVybiBSZXN1bHQuZmFpbDxDbGFzc0xheW91dD4oXG4gICAgICAgIFwiQmxvY2tzIGNhbm5vdCBoYXZlIGR1cGxpY2F0ZSBvcmRlciB2YWx1ZXNcIixcbiAgICAgICk7XG4gICAgfVxuXG4gICAgcmV0dXJuIFJlc3VsdC5vazxDbGFzc0xheW91dD4obmV3IENsYXNzTGF5b3V0KHByb3BzKSk7XG4gIH1cblxuICBnZXQgaWQoKTogQXNzZXRJZCB7XG4gICAgcmV0dXJuIHRoaXMucHJvcHMuaWQ7XG4gIH1cblxuICBnZXQgdGFyZ2V0Q2xhc3MoKTogQ2xhc3NOYW1lIHtcbiAgICByZXR1cm4gdGhpcy5wcm9wcy50YXJnZXRDbGFzcztcbiAgfVxuXG4gIGdldCBibG9ja3MoKTogTGF5b3V0QmxvY2tDb25maWdbXSB7XG4gICAgcmV0dXJuIFsuLi50aGlzLnByb3BzLmJsb2Nrc10uc29ydCgoYSwgYikgPT4gYS5vcmRlciAtIGIub3JkZXIpO1xuICB9XG5cbiAgZ2V0IGlzRW5hYmxlZCgpOiBib29sZWFuIHtcbiAgICByZXR1cm4gdGhpcy5wcm9wcy5pc0VuYWJsZWQ7XG4gIH1cblxuICBnZXQgcHJpb3JpdHkoKTogbnVtYmVyIHtcbiAgICByZXR1cm4gdGhpcy5wcm9wcy5wcmlvcml0eTtcbiAgfVxuXG4gIHB1YmxpYyBhZGRCbG9jayhibG9jazogTGF5b3V0QmxvY2tDb25maWcpOiBSZXN1bHQ8dm9pZD4ge1xuICAgIGlmICh0aGlzLnByb3BzLmJsb2Nrcy5sZW5ndGggPj0gQ2xhc3NMYXlvdXQuTUFYX0JMT0NLUykge1xuICAgICAgcmV0dXJuIFJlc3VsdC5mYWlsPHZvaWQ+KFxuICAgICAgICBgQ2Fubm90IGFkZCBtb3JlIGJsb2Nrcy4gTWF4aW11bSBvZiAke0NsYXNzTGF5b3V0Lk1BWF9CTE9DS1N9IHJlYWNoZWRgLFxuICAgICAgKTtcbiAgICB9XG5cbiAgICBpZiAodGhpcy5wcm9wcy5ibG9ja3Muc29tZSgoYikgPT4gYi5pZCA9PT0gYmxvY2suaWQpKSB7XG4gICAgICByZXR1cm4gUmVzdWx0LmZhaWw8dm9pZD4oXCJCbG9jayB3aXRoIHRoaXMgSUQgYWxyZWFkeSBleGlzdHNcIik7XG4gICAgfVxuXG4gICAgaWYgKHRoaXMucHJvcHMuYmxvY2tzLnNvbWUoKGIpID0+IGIub3JkZXIgPT09IGJsb2NrLm9yZGVyKSkge1xuICAgICAgcmV0dXJuIFJlc3VsdC5mYWlsPHZvaWQ+KFxuICAgICAgICBgQmxvY2sgd2l0aCBvcmRlciAke2Jsb2NrLm9yZGVyfSBhbHJlYWR5IGV4aXN0c2AsXG4gICAgICApO1xuICAgIH1cblxuICAgIHRoaXMucHJvcHMuYmxvY2tzLnB1c2goYmxvY2spO1xuICAgIHJldHVybiBSZXN1bHQub2s8dm9pZD4oKTtcbiAgfVxuXG4gIHB1YmxpYyByZW1vdmVCbG9jayhibG9ja0lkOiBzdHJpbmcpOiBSZXN1bHQ8dm9pZD4ge1xuICAgIGNvbnN0IGJsb2NrSW5kZXggPSB0aGlzLnByb3BzLmJsb2Nrcy5maW5kSW5kZXgoKGIpID0+IGIuaWQgPT09IGJsb2NrSWQpO1xuXG4gICAgaWYgKGJsb2NrSW5kZXggPT09IC0xKSB7XG4gICAgICByZXR1cm4gUmVzdWx0LmZhaWw8dm9pZD4oXCJCbG9jayBub3QgZm91bmRcIik7XG4gICAgfVxuXG4gICAgdGhpcy5wcm9wcy5ibG9ja3Muc3BsaWNlKGJsb2NrSW5kZXgsIDEpO1xuICAgIHJldHVybiBSZXN1bHQub2s8dm9pZD4oKTtcbiAgfVxuXG4gIHB1YmxpYyB1cGRhdGVCbG9jayhcbiAgICBibG9ja0lkOiBzdHJpbmcsXG4gICAgdXBkYXRlczogUGFydGlhbDxMYXlvdXRCbG9ja0NvbmZpZz4sXG4gICk6IFJlc3VsdDx2b2lkPiB7XG4gICAgY29uc3QgYmxvY2sgPSB0aGlzLnByb3BzLmJsb2Nrcy5maW5kKChiKSA9PiBiLmlkID09PSBibG9ja0lkKTtcblxuICAgIGlmICghYmxvY2spIHtcbiAgICAgIHJldHVybiBSZXN1bHQuZmFpbDx2b2lkPihcIkJsb2NrIG5vdCBmb3VuZFwiKTtcbiAgICB9XG5cbiAgICBpZiAodXBkYXRlcy5vcmRlciAhPT0gdW5kZWZpbmVkICYmIHVwZGF0ZXMub3JkZXIgIT09IGJsb2NrLm9yZGVyKSB7XG4gICAgICBpZiAoXG4gICAgICAgIHRoaXMucHJvcHMuYmxvY2tzLnNvbWUoXG4gICAgICAgICAgKGIpID0+IGIuaWQgIT09IGJsb2NrSWQgJiYgYi5vcmRlciA9PT0gdXBkYXRlcy5vcmRlcixcbiAgICAgICAgKVxuICAgICAgKSB7XG4gICAgICAgIHJldHVybiBSZXN1bHQuZmFpbDx2b2lkPihcbiAgICAgICAgICBgQmxvY2sgd2l0aCBvcmRlciAke3VwZGF0ZXMub3JkZXJ9IGFscmVhZHkgZXhpc3RzYCxcbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBPYmplY3QuYXNzaWduKGJsb2NrLCB1cGRhdGVzKTtcbiAgICByZXR1cm4gUmVzdWx0Lm9rPHZvaWQ+KCk7XG4gIH1cblxuICBwdWJsaWMgZ2V0VmlzaWJsZUJsb2NrcygpOiBMYXlvdXRCbG9ja0NvbmZpZ1tdIHtcbiAgICByZXR1cm4gdGhpcy5ibG9ja3MuZmlsdGVyKChiKSA9PiBiLmlzVmlzaWJsZSk7XG4gIH1cblxuICBwdWJsaWMgZW5hYmxlKCk6IHZvaWQge1xuICAgIHRoaXMucHJvcHMuaXNFbmFibGVkID0gdHJ1ZTtcbiAgfVxuXG4gIHB1YmxpYyBkaXNhYmxlKCk6IHZvaWQge1xuICAgIHRoaXMucHJvcHMuaXNFbmFibGVkID0gZmFsc2U7XG4gIH1cbn1cbiJdLCJ2ZXJzaW9uIjozfQ==