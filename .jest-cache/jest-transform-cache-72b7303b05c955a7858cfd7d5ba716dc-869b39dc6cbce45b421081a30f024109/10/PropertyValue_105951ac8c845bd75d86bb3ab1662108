be6f3843672a3360c4f3dffb06f0d6f1
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.PropertyValue = exports.PropertyValueType = void 0;
const Result_1 = require("../core/Result");
/**
 * Enumeration of supported property value types
 */
var PropertyValueType;
(function (PropertyValueType) {
    PropertyValueType["STRING"] = "string";
    PropertyValueType["NUMBER"] = "number";
    PropertyValueType["BOOLEAN"] = "boolean";
    PropertyValueType["DATE"] = "date";
    PropertyValueType["ARRAY"] = "array";
    PropertyValueType["OBJECT"] = "object";
    PropertyValueType["REFERENCE"] = "reference";
    PropertyValueType["IRI"] = "iri";
})(PropertyValueType = exports.PropertyValueType || (exports.PropertyValueType = {}));
/**
 * Value object representing a typed property value in the domain
 * Ensures type safety and validation for asset properties
 */
class PropertyValue {
    constructor(value, type, constraints = {}) {
        this._value = value;
        this._type = type;
        this._constraints = constraints;
    }
    /**
     * Create a PropertyValue with automatic type detection
     */
    static create(value, constraints = {}) {
        if (value === null || value === undefined) {
            return Result_1.Result.fail("Property value cannot be null or undefined");
        }
        const type = PropertyValue.detectType(value);
        const validationResult = PropertyValue.validateValue(value, type, constraints);
        if (!validationResult.isValid) {
            return Result_1.Result.fail(validationResult.error);
        }
        return Result_1.Result.ok(new PropertyValue(value, type, constraints));
    }
    /**
     * Create a PropertyValue with explicit type
     */
    static createTyped(value, type, constraints = {}) {
        const validationResult = PropertyValue.validateValue(value, type, constraints);
        if (!validationResult.isValid) {
            return Result_1.Result.fail(validationResult.error);
        }
        const convertedValue = PropertyValue.convertValue(value, type);
        return Result_1.Result.ok(new PropertyValue(convertedValue, type, constraints));
    }
    /**
     * Detect type from JavaScript value
     */
    static detectType(value) {
        if (typeof value === "string") {
            // Check for WikiLink pattern [[...]]
            if (/^\[\[.*\]\]$/.test(value)) {
                return PropertyValueType.REFERENCE;
            }
            // Check for IRI pattern
            if (/^https?:\/\/|^[a-z][a-z0-9+.-]*:/i.test(value)) {
                return PropertyValueType.IRI;
            }
            // Check for ISO date pattern
            if (/^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}/.test(value)) {
                return PropertyValueType.DATE;
            }
            return PropertyValueType.STRING;
        }
        if (typeof value === "number") {
            return PropertyValueType.NUMBER;
        }
        if (typeof value === "boolean") {
            return PropertyValueType.BOOLEAN;
        }
        if (value instanceof Date) {
            return PropertyValueType.DATE;
        }
        if (Array.isArray(value)) {
            return PropertyValueType.ARRAY;
        }
        return PropertyValueType.OBJECT;
    }
    /**
     * Convert value to appropriate type
     */
    static convertValue(value, type) {
        switch (type) {
            case PropertyValueType.STRING:
                return String(value);
            case PropertyValueType.NUMBER:
                return Number(value);
            case PropertyValueType.BOOLEAN:
                return Boolean(value);
            case PropertyValueType.DATE:
                return value instanceof Date ? value : new Date(value);
            case PropertyValueType.ARRAY:
                return Array.isArray(value) ? [...value] : [value];
            case PropertyValueType.REFERENCE:
            case PropertyValueType.IRI:
                return String(value);
            default:
                return value;
        }
    }
    /**
     * Validate value against type and constraints
     */
    static validateValue(value, type, constraints) {
        switch (type) {
            case PropertyValueType.STRING:
            case PropertyValueType.REFERENCE:
            case PropertyValueType.IRI:
                if (typeof value !== "string") {
                    return {
                        isValid: false,
                        error: `Expected string, got ${typeof value}`,
                    };
                }
                if (constraints.minLength && value.length < constraints.minLength) {
                    return {
                        isValid: false,
                        error: `String too short, minimum ${constraints.minLength}`,
                    };
                }
                if (constraints.maxLength && value.length > constraints.maxLength) {
                    return {
                        isValid: false,
                        error: `String too long, maximum ${constraints.maxLength}`,
                    };
                }
                if (constraints.pattern && !constraints.pattern.test(value)) {
                    return {
                        isValid: false,
                        error: "String does not match required pattern",
                    };
                }
                break;
            case PropertyValueType.NUMBER:
                const num = Number(value);
                if (isNaN(num)) {
                    return { isValid: false, error: "Invalid number" };
                }
                if (constraints.min !== undefined && num < constraints.min) {
                    return {
                        isValid: false,
                        error: `Number too small, minimum ${constraints.min}`,
                    };
                }
                if (constraints.max !== undefined && num > constraints.max) {
                    return {
                        isValid: false,
                        error: `Number too large, maximum ${constraints.max}`,
                    };
                }
                break;
            case PropertyValueType.DATE:
                const date = value instanceof Date ? value : new Date(value);
                if (isNaN(date.getTime())) {
                    return { isValid: false, error: "Invalid date" };
                }
                break;
            case PropertyValueType.ARRAY:
                if (!Array.isArray(value)) {
                    return { isValid: false, error: "Expected array" };
                }
                if (constraints.minItems && value.length < constraints.minItems) {
                    return {
                        isValid: false,
                        error: `Array too short, minimum ${constraints.minItems} items`,
                    };
                }
                if (constraints.maxItems && value.length > constraints.maxItems) {
                    return {
                        isValid: false,
                        error: `Array too long, maximum ${constraints.maxItems} items`,
                    };
                }
                break;
        }
        return { isValid: true, error: "" };
    }
    /**
     * Get the raw value
     */
    getValue() {
        // Return deep copy for objects and arrays to maintain immutability
        if (this._type === PropertyValueType.ARRAY) {
            return [...this._value];
        }
        if (this._type === PropertyValueType.OBJECT) {
            return { ...this._value };
        }
        return this._value;
    }
    /**
     * Get the property type
     */
    getType() {
        return this._type;
    }
    /**
     * Get the constraints
     */
    getConstraints() {
        return { ...this._constraints };
    }
    /**
     * Check if this is a semantic reference (WikiLink)
     */
    isReference() {
        return this._type === PropertyValueType.REFERENCE;
    }
    /**
     * Check if this is an IRI
     */
    isIRI() {
        return this._type === PropertyValueType.IRI;
    }
    /**
     * Extract reference target from WikiLink
     */
    getReferenceTarget() {
        if (!this.isReference()) {
            return null;
        }
        const match = this._value.match(/^\[\[(.*?)\]\]$/);
        return match ? match[1] : null;
    }
    /**
     * Convert to string representation
     */
    toString() {
        if (this._type === PropertyValueType.DATE && this._value instanceof Date) {
            return this._value.toISOString().replace(/\.\d{3}Z$/, "");
        }
        return String(this._value);
    }
    /**
     * Equality comparison
     */
    equals(other) {
        if (this._type !== other._type) {
            return false;
        }
        // For complex types, use JSON comparison
        if (this._type === PropertyValueType.ARRAY ||
            this._type === PropertyValueType.OBJECT) {
            return JSON.stringify(this._value) === JSON.stringify(other._value);
        }
        return this._value === other._value;
    }
    /**
     * Create a new PropertyValue with updated constraints
     */
    withConstraints(constraints) {
        return PropertyValue.createTyped(this._value, this._type, {
            ...this._constraints,
            ...constraints,
        });
    }
}
exports.PropertyValue = PropertyValue;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL2tpdGVsZXYvRG9jdW1lbnRzL2V4b2NvcnRleC1vYnNpZGlhbi1wbHVnaW4vc3JjL2RvbWFpbi92YWx1ZS1vYmplY3RzL1Byb3BlcnR5VmFsdWUudHMiLCJtYXBwaW5ncyI6Ijs7O0FBQUEsMkNBQXdDO0FBRXhDOztHQUVHO0FBQ0gsSUFBWSxpQkFTWDtBQVRELFdBQVksaUJBQWlCO0lBQzNCLHNDQUFpQixDQUFBO0lBQ2pCLHNDQUFpQixDQUFBO0lBQ2pCLHdDQUFtQixDQUFBO0lBQ25CLGtDQUFhLENBQUE7SUFDYixvQ0FBZSxDQUFBO0lBQ2Ysc0NBQWlCLENBQUE7SUFDakIsNENBQXVCLENBQUE7SUFDdkIsZ0NBQVcsQ0FBQTtBQUNiLENBQUMsRUFUVyxpQkFBaUIsR0FBakIseUJBQWlCLEtBQWpCLHlCQUFpQixRQVM1QjtBQUVEOzs7R0FHRztBQUNILE1BQWEsYUFBYTtJQUt4QixZQUNFLEtBQVUsRUFDVixJQUF1QixFQUN2QixjQUFtQyxFQUFFO1FBRXJDLElBQUksQ0FBQyxNQUFNLEdBQUcsS0FBSyxDQUFDO1FBQ3BCLElBQUksQ0FBQyxLQUFLLEdBQUcsSUFBSSxDQUFDO1FBQ2xCLElBQUksQ0FBQyxZQUFZLEdBQUcsV0FBVyxDQUFDO0lBQ2xDLENBQUM7SUFFRDs7T0FFRztJQUNILE1BQU0sQ0FBQyxNQUFNLENBQ1gsS0FBVSxFQUNWLGNBQW1DLEVBQUU7UUFFckMsSUFBSSxLQUFLLEtBQUssSUFBSSxJQUFJLEtBQUssS0FBSyxTQUFTLEVBQUU7WUFDekMsT0FBTyxlQUFNLENBQUMsSUFBSSxDQUNoQiw0Q0FBNEMsQ0FDN0MsQ0FBQztTQUNIO1FBRUQsTUFBTSxJQUFJLEdBQUcsYUFBYSxDQUFDLFVBQVUsQ0FBQyxLQUFLLENBQUMsQ0FBQztRQUM3QyxNQUFNLGdCQUFnQixHQUFHLGFBQWEsQ0FBQyxhQUFhLENBQ2xELEtBQUssRUFDTCxJQUFJLEVBQ0osV0FBVyxDQUNaLENBQUM7UUFFRixJQUFJLENBQUMsZ0JBQWdCLENBQUMsT0FBTyxFQUFFO1lBQzdCLE9B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QUksQ0FBQyxLQUFLLEtBQUssaUJBQWlCLENBQUMsTUFBTSxFQUN2QztZQUNBLE9BQU8sSUFBSSxDQUFDLFNBQVMsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLEtBQUssSUFBSSxDQUFDLFNBQVMsQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFDLENBQUM7U0FDckU7UUFFRCxPQUFPLElBQUksQ0FBQyxNQUFNLEtBQUssS0FBSyxDQUFDLE1BQU0sQ0FBQztJQUN0QyxDQUFDO0lBRUQ7O09BRUc7SUFDSCxlQUFlLENBQUMsV0FBZ0M7UUFDOUMsT0FBTyxhQUFhLENBQUMsV0FBVyxDQUFDLElBQUksQ0FBQyxNQUFNLEVBQUUsSUFBSSxDQUFDLEtBQUssRUFBRTtZQUN4RCxHQUFHLElBQUksQ0FBQyxZQUFZO1lBQ3BCLEdBQUcsV0FBVztTQUNmLENBQUMsQ0FBQztJQUNMLENBQUM7Q0FDRjtBQW5URCxzQ0FtVEMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL1VzZXJzL2tpdGVsZXYvRG9jdW1lbnRzL2V4b2NvcnRleC1vYnNpZGlhbi1wbHVnaW4vc3JjL2RvbWFpbi92YWx1ZS1vYmplY3RzL1Byb3BlcnR5VmFsdWUudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgUmVzdWx0IH0gZnJvbSBcIi4uL2NvcmUvUmVzdWx0XCI7XG5cbi8qKlxuICogRW51bWVyYXRpb24gb2Ygc3VwcG9ydGVkIHByb3BlcnR5IHZhbHVlIHR5cGVzXG4gKi9cbmV4cG9ydCBlbnVtIFByb3BlcnR5VmFsdWVUeXBlIHtcbiAgU1RSSU5HID0gXCJzdHJpbmdcIixcbiAgTlVNQkVSID0gXCJudW1iZXJcIixcbiAgQk9PTEVBTiA9IFwiYm9vbGVhblwiLFxuICBEQVRFID0gXCJkYXRlXCIsXG4gIEFSUkFZID0gXCJhcnJheVwiLFxuICBPQkpFQ1QgPSBcIm9iamVjdFwiLFxuICBSRUZFUkVOQ0UgPSBcInJlZmVyZW5jZVwiLCAvLyBGb3IgV2lraUxpbmtzIGxpa2UgW1tBc3NldE5hbWVdXVxuICBJUkkgPSBcImlyaVwiLCAvLyBGb3Igc2VtYW50aWMgd2ViIElSSXNcbn1cblxuLyoqXG4gKiBWYWx1ZSBvYmplY3QgcmVwcmVzZW50aW5nIGEgdHlwZWQgcHJvcGVydHkgdmFsdWUgaW4gdGhlIGRvbWFpblxuICogRW5zdXJlcyB0eXBlIHNhZmV0eSBhbmQgdmFsaWRhdGlvbiBmb3IgYXNzZXQgcHJvcGVydGllc1xuICovXG5leHBvcnQgY2xhc3MgUHJvcGVydHlWYWx1ZSB7XG4gIHByaXZhdGUgcmVhZG9ubHkgX3ZhbHVlOiBhbnk7XG4gIHByaXZhdGUgcmVhZG9ubHkgX3R5cGU6IFByb3BlcnR5VmFsdWVUeXBlO1xuICBwcml2YXRlIHJlYWRvbmx5IF9jb25zdHJhaW50czogUHJvcGVydHlDb25zdHJhaW50cztcblxuICBwcml2YXRlIGNvbnN0cnVjdG9yKFxuICAgIHZhbHVlOiBhbnksXG4gICAgdHlwZTogUHJvcGVydHlWYWx1ZVR5cGUsXG4gICAgY29uc3RyYWludHM6IFByb3BlcnR5Q29uc3RyYWludHMgPSB7fSxcbiAgKSB7XG4gICAgdGhpcy5fdmFsdWUgPSB2YWx1ZTtcbiAgICB0aGlzLl90eXBlID0gdHlwZTtcbiAgICB0aGlzLl9jb25zdHJhaW50cyA9IGNvbnN0cmFpbnRzO1xuICB9XG5cbiAgLyoqXG4gICAqIENyZWF0ZSBhIFByb3BlcnR5VmFsdWUgd2l0aCBhdXRvbWF0aWMgdHlwZSBkZXRlY3Rpb25cbiAgICovXG4gIHN0YXRpYyBjcmVhdGUoXG4gICAgdmFsdWU6IGFueSxcbiAgICBjb25zdHJhaW50czogUHJvcGVydHlDb25zdHJhaW50cyA9IHt9LFxuICApOiBSZXN1bHQ8UHJvcGVydHlWYWx1ZT4ge1xuICAgIGlmICh2YWx1ZSA9PT0gbnVsbCB8fCB2YWx1ZSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICByZXR1cm4gUmVzdWx0LmZhaWw8UHJvcGVydHlWYWx1ZT4oXG4gICAgICAgIFwiUHJvcGVydHkgdmFsdWUgY2Fubm90IGJlIG51bGwgb3IgdW5kZWZpbmVkXCIsXG4gICAgICApO1xuICAgIH1cblxuICAgIGNvbnN0IHR5cGUgPSBQcm9wZXJ0eVZhbHVlLmRldGVjdFR5cGUodmFsdWUpO1xuICAgIGNvbnN0IHZhbGlkYXRpb25SZXN1bHQgPSBQcm9wZXJ0eVZhbHVlLnZhbGlkYXRlVmFsdWUoXG4gICAgICB2YWx1ZSxcbiAgICAgIHR5cGUsXG4gICAgICBjb25zdHJhaW50cyxcbiAgICApO1xuXG4gICAgaWYgKCF2YWxpZGF0aW9uUmVzdWx0LmlzVmFsaWQpIHtcbiAgICAgIHJldHVybiBSZXN1bHQuZmFpbDxQcm9wZXJ0eVZhbHVlPih2YWxpZGF0aW9uUmVzdWx0LmVycm9yKTtcbiAgICB9XG5cbiAgICByZXR1cm4gUmVzdWx0Lm9rPFByb3BlcnR5VmFsdWU+KFxuICAgICAgbmV3IFByb3BlcnR5VmFsdWUodmFsdWUsIHR5cGUsIGNvbnN0cmFpbnRzKSxcbiAgICApO1xuICB9XG5cbiAgLyoqXG4gICAqIENyZWF0ZSBhIFByb3BlcnR5VmFsdWUgd2l0aCBleHBsaWNpdCB0eXBlXG4gICAqL1xuICBzdGF0aWMgY3JlYXRlVHlwZWQoXG4gICAgdmFsdWU6IGFueSxcbiAgICB0eXBlOiBQcm9wZXJ0eVZhbHVlVHlwZSxcbiAgICBjb25zdHJhaW50czogUHJvcGVydHlDb25zdHJhaW50cyA9IHt9LFxuICApOiBSZXN1bHQ8UHJvcGVydHlWYWx1ZT4ge1xuICAgIGNvbnN0IHZhbGlkYXRpb25SZXN1bHQgPSBQcm9wZXJ0eVZhbHVlLnZhbGlkYXRlVmFsdWUoXG4gICAgICB2YWx1ZSxcbiAgICAgIHR5cGUsXG4gICAgICBjb25zdHJhaW50cyxcbiAgICApO1xuXG4gICAgaWYgKCF2YWxpZGF0aW9uUmVzdWx0LmlzVmFsaWQpIHtcbiAgICAgIHJldHVybiBSZXN1bHQuZmFpbDxQcm9wZXJ0eVZhbHVlPih2YWxpZGF0aW9uUmVzdWx0LmVycm9yKTtcbiAgICB9XG5cbiAgICBjb25zdCBjb252ZXJ0ZWRWYWx1ZSA9IFByb3BlcnR5VmFsdWUuY29udmVydFZhbHVlKHZhbHVlLCB0eXBlKTtcbiAgICByZXR1cm4gUmVzdWx0Lm9rPFByb3BlcnR5VmFsdWU+KFxuICAgICAgbmV3IFByb3BlcnR5VmFsdWUoY29udmVydGVkVmFsdWUsIHR5cGUsIGNvbnN0cmFpbnRzKSxcbiAgICApO1xuICB9XG5cbiAgLyoqXG4gICAqIERldGVjdCB0eXBlIGZyb20gSmF2YVNjcmlwdCB2YWx1ZVxuICAgKi9cbiAgcHJpdmF0ZSBzdGF0aWMgZGV0ZWN0VHlwZSh2YWx1ZTogYW55KTogUHJvcGVydHlWYWx1ZVR5cGUge1xuICAgIGlmICh0eXBlb2YgdmFsdWUgPT09IFwic3RyaW5nXCIpIHtcbiAgICAgIC8vIENoZWNrIGZvciBXaWtpTGluayBwYXR0ZXJuIFtbLi4uXV1cbiAgICAgIGlmICgvXlxcW1xcWy4qXFxdXFxdJC8udGVzdCh2YWx1ZSkpIHtcbiAgICAgICAgcmV0dXJuIFByb3BlcnR5VmFsdWVUeXBlLlJFRkVSRU5DRTtcbiAgICAgIH1cbiAgICAgIC8vIENoZWNrIGZvciBJUkkgcGF0dGVyblxuICAgICAgaWYgKC9eaHR0cHM/OlxcL1xcL3xeW2Etel1bYS16MC05Ky4tXSo6L2kudGVzdCh2YWx1ZSkpIHtcbiAgICAgICAgcmV0dXJuIFByb3BlcnR5VmFsdWVUeXBlLklSSTtcbiAgICAgIH1cbiAgICAgIC8vIENoZWNrIGZvciBJU08gZGF0ZSBwYXR0ZXJuXG4gICAgICBpZiAoL15cXGR7NH0tXFxkezJ9LVxcZHsyfVRcXGR7Mn06XFxkezJ9OlxcZHsyfS8udGVzdCh2YWx1ZSkpIHtcbiAgICAgICAgcmV0dXJuIFByb3BlcnR5VmFsdWVUeXBlLkRBVEU7XG4gICAgICB9XG4gICAgICByZXR1cm4gUHJvcGVydHlWYWx1ZVR5cGUuU1RSSU5HO1xuICAgIH1cblxuICAgIGlmICh0eXBlb2YgdmFsdWUgPT09IFwibnVtYmVyXCIpIHtcbiAgICAgIHJldHVybiBQcm9wZXJ0eVZhbHVlVHlwZS5OVU1CRVI7XG4gICAgfVxuXG4gICAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gXCJib29sZWFuXCIpIHtcbiAgICAgIHJldHVybiBQcm9wZXJ0eVZhbHVlVHlwZS5CT09MRUFOO1xuICAgIH1cblxuICAgIGlmICh2YWx1ZSBpbnN0YW5jZW9mIERhdGUpIHtcbiAgICAgIHJldHVybiBQcm9wZXJ0eVZhbHVlVHlwZS5EQVRFO1xuICAgIH1cblxuICAgIGlmIChBcnJheS5pc0FycmF5KHZhbHVlKSkge1xuICAgICAgcmV0dXJuIFByb3BlcnR5VmFsdWVUeXBlLkFSUkFZO1xuICAgIH1cblxuICAgIHJldHVybiBQcm9wZXJ0eVZhbHVlVHlwZS5PQkpFQ1Q7XG4gIH1cblxuICAvKipcbiAgICogQ29udmVydCB2YWx1ZSB0byBhcHByb3ByaWF0ZSB0eXBlXG4gICAqL1xuICBwcml2YXRlIHN0YXRpYyBjb252ZXJ0VmFsdWUodmFsdWU6IGFueSwgdHlwZTogUHJvcGVydHlWYWx1ZVR5cGUpOiBhbnkge1xuICAgIHN3aXRjaCAodHlwZSkge1xuICAgICAgY2FzZSBQcm9wZXJ0eVZhbHVlVHlwZS5TVFJJTkc6XG4gICAgICAgIHJldHVybiBTdHJpbmcodmFsdWUpO1xuICAgICAgY2FzZSBQcm9wZXJ0eVZhbHVlVHlwZS5OVU1CRVI6XG4gICAgICAgIHJldHVybiBOdW1iZXIodmFsdWUpO1xuICAgICAgY2FzZSBQcm9wZXJ0eVZhbHVlVHlwZS5CT09MRUFOOlxuICAgICAgICByZXR1cm4gQm9vbGVhbih2YWx1ZSk7XG4gICAgICBjYXNlIFByb3BlcnR5VmFsdWVUeXBlLkRBVEU6XG4gICAgICAgIHJldHVybiB2YWx1ZSBpbnN0YW5jZW9mIERhdGUgPyB2YWx1ZSA6IG5ldyBEYXRlKHZhbHVlKTtcbiAgICAgIGNhc2UgUHJvcGVydHlWYWx1ZVR5cGUuQVJSQVk6XG4gICAgICAgIHJldHVybiBBcnJheS5pc0FycmF5KHZhbHVlKSA/IFsuLi52YWx1ZV0gOiBbdmFsdWVdO1xuICAgICAgY2FzZSBQcm9wZXJ0eVZhbHVlVHlwZS5SRUZFUkVOQ0U6XG4gICAgICBjYXNlIFByb3BlcnR5VmFsdWVUeXBlLklSSTpcbiAgICAgICAgcmV0dXJuIFN0cmluZyh2YWx1ZSk7XG4gICAgICBkZWZhdWx0OlxuICAgICAgICByZXR1cm4gdmFsdWU7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIFZhbGlkYXRlIHZhbHVlIGFnYWluc3QgdHlwZSBhbmQgY29uc3RyYWludHNcbiAgICovXG4gIHByaXZhdGUgc3RhdGljIHZhbGlkYXRlVmFsdWUoXG4gICAgdmFsdWU6IGFueSxcbiAgICB0eXBlOiBQcm9wZXJ0eVZhbHVlVHlwZSxcbiAgICBjb25zdHJhaW50czogUHJvcGVydHlDb25zdHJhaW50cyxcbiAgKTogeyBpc1ZhbGlkOiBib29sZWFuOyBlcnJvcjogc3RyaW5nIH0ge1xuICAgIHN3aXRjaCAodHlwZSkge1xuICAgICAgY2FzZSBQcm9wZXJ0eVZhbHVlVHlwZS5TVFJJTkc6XG4gICAgICBjYXNlIFByb3BlcnR5VmFsdWVUeXBlLlJFRkVSRU5DRTpcbiAgICAgIGNhc2UgUHJvcGVydHlWYWx1ZVR5cGUuSVJJOlxuICAgICAgICBpZiAodHlwZW9mIHZhbHVlICE9PSBcInN0cmluZ1wiKSB7XG4gICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIGlzVmFsaWQ6IGZhbHNlLFxuICAgICAgICAgICAgZXJyb3I6IGBFeHBlY3RlZCBzdHJpbmcsIGdvdCAke3R5cGVvZiB2YWx1ZX1gLFxuICAgICAgICAgIH07XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGNvbnN0cmFpbnRzLm1pbkxlbmd0aCAmJiB2YWx1ZS5sZW5ndGggPCBjb25zdHJhaW50cy5taW5MZW5ndGgpIHtcbiAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgaXNWYWxpZDogZmFsc2UsXG4gICAgICAgICAgICBlcnJvcjogYFN0cmluZyB0b28gc2hvcnQsIG1pbmltdW0gJHtjb25zdHJhaW50cy5taW5MZW5ndGh9YCxcbiAgICAgICAgICB9O1xuICAgICAgICB9XG4gICAgICAgIGlmIChjb25zdHJhaW50cy5tYXhMZW5ndGggJiYgdmFsdWUubGVuZ3RoID4gY29uc3RyYWludHMubWF4TGVuZ3RoKSB7XG4gICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIGlzVmFsaWQ6IGZhbHNlLFxuICAgICAgICAgICAgZXJyb3I6IGBTdHJpbmcgdG9vIGxvbmcsIG1heGltdW0gJHtjb25zdHJhaW50cy5tYXhMZW5ndGh9YCxcbiAgICAgICAgICB9O1xuICAgICAgICB9XG4gICAgICAgIGlmIChjb25zdHJhaW50cy5wYXR0ZXJuICYmICFjb25zdHJhaW50cy5wYXR0ZXJuLnRlc3QodmFsdWUpKSB7XG4gICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIGlzVmFsaWQ6IGZhbHNlLFxuICAgICAgICAgICAgZXJyb3I6IFwiU3RyaW5nIGRvZXMgbm90IG1hdGNoIHJlcXVpcmVkIHBhdHRlcm5cIixcbiAgICAgICAgICB9O1xuICAgICAgICB9XG4gICAgICAgIGJyZWFrO1xuXG4gICAgICBjYXNlIFByb3BlcnR5VmFsdWVUeXBlLk5VTUJFUjpcbiAgICAgICAgY29uc3QgbnVtID0gTnVtYmVyKHZhbHVlKTtcbiAgICAgICAgaWYgKGlzTmFOKG51bSkpIHtcbiAgICAgICAgICByZXR1cm4geyBpc1ZhbGlkOiBmYWxzZSwgZXJyb3I6IFwiSW52YWxpZCBudW1iZXJcIiB9O1xuICAgICAgICB9XG4gICAgICAgIGlmIChjb25zdHJhaW50cy5taW4gIT09IHVuZGVmaW5lZCAmJiBudW0gPCBjb25zdHJhaW50cy5taW4pIHtcbiAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgaXNWYWxpZDogZmFsc2UsXG4gICAgICAgICAgICBlcnJvcjogYE51bWJlciB0b28gc21hbGwsIG1pbmltdW0gJHtjb25zdHJhaW50cy5taW59YCxcbiAgICAgICAgICB9O1xuICAgICAgICB9XG4gICAgICAgIGlmIChjb25zdHJhaW50cy5tYXggIT09IHVuZGVmaW5lZCAmJiBudW0gPiBjb25zdHJhaW50cy5tYXgpIHtcbiAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgaXNWYWxpZDogZmFsc2UsXG4gICAgICAgICAgICBlcnJvcjogYE51bWJlciB0b28gbGFyZ2UsIG1heGltdW0gJHtjb25zdHJhaW50cy5tYXh9YCxcbiAgICAgICAgICB9O1xuICAgICAgICB9XG4gICAgICAgIGJyZWFrO1xuXG4gICAgICBjYXNlIFByb3BlcnR5VmFsdWVUeXBlLkRBVEU6XG4gICAgICAgIGNvbnN0IGRhdGUgPSB2YWx1ZSBpbnN0YW5jZW9mIERhdGUgPyB2YWx1ZSA6IG5ldyBEYXRlKHZhbHVlKTtcbiAgICAgICAgaWYgKGlzTmFOKGRhdGUuZ2V0VGltZSgpKSkge1xuICAgICAgICAgIHJldHVybiB7IGlzVmFsaWQ6IGZhbHNlLCBlcnJvcjogXCJJbnZhbGlkIGRhdGVcIiB9O1xuICAgICAgICB9XG4gICAgICAgIGJyZWFrO1xuXG4gICAgICBjYXNlIFByb3BlcnR5VmFsdWVUeXBlLkFSUkFZOlxuICAgICAgICBpZiAoIUFycmF5LmlzQXJyYXkodmFsdWUpKSB7XG4gICAgICAgICAgcmV0dXJuIHsgaXNWYWxpZDogZmFsc2UsIGVycm9yOiBcIkV4cGVjdGVkIGFycmF5XCIgfTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoY29uc3RyYWludHMubWluSXRlbXMgJiYgdmFsdWUubGVuZ3RoIDwgY29uc3RyYWludHMubWluSXRlbXMpIHtcbiAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgaXNWYWxpZDogZmFsc2UsXG4gICAgICAgICAgICBlcnJvcjogYEFycmF5IHRvbyBzaG9ydCwgbWluaW11bSAke2NvbnN0cmFpbnRzLm1pbkl0ZW1zfSBpdGVtc2AsXG4gICAgICAgICAgfTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoY29uc3RyYWludHMubWF4SXRlbXMgJiYgdmFsdWUubGVuZ3RoID4gY29uc3RyYWludHMubWF4SXRlbXMpIHtcbiAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgaXNWYWxpZDogZmFsc2UsXG4gICAgICAgICAgICBlcnJvcjogYEFycmF5IHRvbyBsb25nLCBtYXhpbXVtICR7Y29uc3RyYWludHMubWF4SXRlbXN9IGl0ZW1zYCxcbiAgICAgICAgICB9O1xuICAgICAgICB9XG4gICAgICAgIGJyZWFrO1xuICAgIH1cblxuICAgIHJldHVybiB7IGlzVmFsaWQ6IHRydWUsIGVycm9yOiBcIlwiIH07XG4gIH1cblxuICAvKipcbiAgICogR2V0IHRoZSByYXcgdmFsdWVcbiAgICovXG4gIGdldFZhbHVlKCk6IGFueSB7XG4gICAgLy8gUmV0dXJuIGRlZXAgY29weSBmb3Igb2JqZWN0cyBhbmQgYXJyYXlzIHRvIG1haW50YWluIGltbXV0YWJpbGl0eVxuICAgIGlmICh0aGlzLl90eXBlID09PSBQcm9wZXJ0eVZhbHVlVHlwZS5BUlJBWSkge1xuICAgICAgcmV0dXJuIFsuLi50aGlzLl92YWx1ZV07XG4gICAgfVxuICAgIGlmICh0aGlzLl90eXBlID09PSBQcm9wZXJ0eVZhbHVlVHlwZS5PQkpFQ1QpIHtcbiAgICAgIHJldHVybiB7IC4uLnRoaXMuX3ZhbHVlIH07XG4gICAgfVxuICAgIHJldHVybiB0aGlzLl92YWx1ZTtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgdGhlIHByb3BlcnR5IHR5cGVcbiAgICovXG4gIGdldFR5cGUoKTogUHJvcGVydHlWYWx1ZVR5cGUge1xuICAgIHJldHVybiB0aGlzLl90eXBlO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldCB0aGUgY29uc3RyYWludHNcbiAgICovXG4gIGdldENvbnN0cmFpbnRzKCk6IFByb3BlcnR5Q29uc3RyYWludHMge1xuICAgIHJldHVybiB7IC4uLnRoaXMuX2NvbnN0cmFpbnRzIH07XG4gIH1cblxuICAvKipcbiAgICogQ2hlY2sgaWYgdGhpcyBpcyBhIHNlbWFudGljIHJlZmVyZW5jZSAoV2lraUxpbmspXG4gICAqL1xuICBpc1JlZmVyZW5jZSgpOiBib29sZWFuIHtcbiAgICByZXR1cm4gdGhpcy5fdHlwZSA9PT0gUHJvcGVydHlWYWx1ZVR5cGUuUkVGRVJFTkNFO1xuICB9XG5cbiAgLyoqXG4gICAqIENoZWNrIGlmIHRoaXMgaXMgYW4gSVJJXG4gICAqL1xuICBpc0lSSSgpOiBib29sZWFuIHtcbiAgICByZXR1cm4gdGhpcy5fdHlwZSA9PT0gUHJvcGVydHlWYWx1ZVR5cGUuSVJJO1xuICB9XG5cbiAgLyoqXG4gICAqIEV4dHJhY3QgcmVmZXJlbmNlIHRhcmdldCBmcm9tIFdpa2lMaW5rXG4gICAqL1xuICBnZXRSZWZlcmVuY2VUYXJnZXQoKTogc3RyaW5nIHwgbnVsbCB7XG4gICAgaWYgKCF0aGlzLmlzUmVmZXJlbmNlKCkpIHtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbiAgICBjb25zdCBtYXRjaCA9IHRoaXMuX3ZhbHVlLm1hdGNoKC9eXFxbXFxbKC4qPylcXF1cXF0kLyk7XG4gICAgcmV0dXJuIG1hdGNoID8gbWF0Y2hbMV0gOiBudWxsO1xuICB9XG5cbiAgLyoqXG4gICAqIENvbnZlcnQgdG8gc3RyaW5nIHJlcHJlc2VudGF0aW9uXG4gICAqL1xuICB0b1N0cmluZygpOiBzdHJpbmcge1xuICAgIGlmICh0aGlzLl90eXBlID09PSBQcm9wZXJ0eVZhbHVlVHlwZS5EQVRFICYmIHRoaXMuX3ZhbHVlIGluc3RhbmNlb2YgRGF0ZSkge1xuICAgICAgcmV0dXJuIHRoaXMuX3ZhbHVlLnRvSVNPU3RyaW5nKCkucmVwbGFjZSgvXFwuXFxkezN9WiQvLCBcIlwiKTtcbiAgICB9XG4gICAgcmV0dXJuIFN0cmluZyh0aGlzLl92YWx1ZSk7XG4gIH1cblxuICAvKipcbiAgICogRXF1YWxpdHkgY29tcGFyaXNvblxuICAgKi9cbiAgZXF1YWxzKG90aGVyOiBQcm9wZXJ0eVZhbHVlKTogYm9vbGVhbiB7XG4gICAgaWYgKHRoaXMuX3R5cGUgIT09IG90aGVyLl90eXBlKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuXG4gICAgLy8gRm9yIGNvbXBsZXggdHlwZXMsIHVzZSBKU09OIGNvbXBhcmlzb25cbiAgICBpZiAoXG4gICAgICB0aGlzLl90eXBlID09PSBQcm9wZXJ0eVZhbHVlVHlwZS5BUlJBWSB8fFxuICAgICAgdGhpcy5fdHlwZSA9PT0gUHJvcGVydHlWYWx1ZVR5cGUuT0JKRUNUXG4gICAgKSB7XG4gICAgICByZXR1cm4gSlNPTi5zdHJpbmdpZnkodGhpcy5fdmFsdWUpID09PSBKU09OLnN0cmluZ2lmeShvdGhlci5fdmFsdWUpO1xuICAgIH1cblxuICAgIHJldHVybiB0aGlzLl92YWx1ZSA9PT0gb3RoZXIuX3ZhbHVlO1xuICB9XG5cbiAgLyoqXG4gICAqIENyZWF0ZSBhIG5ldyBQcm9wZXJ0eVZhbHVlIHdpdGggdXBkYXRlZCBjb25zdHJhaW50c1xuICAgKi9cbiAgd2l0aENvbnN0cmFpbnRzKGNvbnN0cmFpbnRzOiBQcm9wZXJ0eUNvbnN0cmFpbnRzKTogUmVzdWx0PFByb3BlcnR5VmFsdWU+IHtcbiAgICByZXR1cm4gUHJvcGVydHlWYWx1ZS5jcmVhdGVUeXBlZCh0aGlzLl92YWx1ZSwgdGhpcy5fdHlwZSwge1xuICAgICAgLi4udGhpcy5fY29uc3RyYWludHMsXG4gICAgICAuLi5jb25zdHJhaW50cyxcbiAgICB9KTtcbiAgfVxufVxuXG4vKipcbiAqIFByb3BlcnR5IHZhbGlkYXRpb24gY29uc3RyYWludHNcbiAqL1xuZXhwb3J0IGludGVyZmFjZSBQcm9wZXJ0eUNvbnN0cmFpbnRzIHtcbiAgbWluTGVuZ3RoPzogbnVtYmVyO1xuICBtYXhMZW5ndGg/OiBudW1iZXI7XG4gIG1pbj86IG51bWJlcjtcbiAgbWF4PzogbnVtYmVyO1xuICBwYXR0ZXJuPzogUmVnRXhwO1xuICBtaW5JdGVtcz86IG51bWJlcjtcbiAgbWF4SXRlbXM/OiBudW1iZXI7XG4gIHJlcXVpcmVkPzogYm9vbGVhbjtcbn1cbiJdLCJ2ZXJzaW9uIjozfQ==