aa48ba7f0c07f722352439e187d27fc9
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.EnhancedResult = void 0;
const Result_1 = require("./Result");
const ExocortexError_1 = require("../errors/ExocortexError");
class EnhancedResult {
    constructor(result, errorDetails) {
        this._result = result;
        this._errorDetails = errorDetails;
    }
    get isSuccess() {
        return this._result.isSuccess;
    }
    get isFailure() {
        return this._result.isFailure;
    }
    get error() {
        return this._result.error;
    }
    getValue() {
        return this._result.getValue();
    }
    errorValue() {
        return this._result.errorValue();
    }
    getErrorDetails() {
        return this._errorDetails;
    }
    static okEnhanced(value) {
        const result = Result_1.Result.ok(value);
        return new EnhancedResult(result);
    }
    static failEnhanced(error) {
        let errorMessage;
        let errorDetails;
        if (typeof error === 'string') {
            errorMessage = error;
            errorDetails = ExocortexError_1.ErrorBuilder.create()
                .withTitle('Operation Failed')
                .withMessage(error)
                .withSeverity(ExocortexError_1.ErrorSeverity.ERROR)
                .withCategory(ExocortexError_1.ErrorCategory.SYSTEM)
                .withContext({
                operation: 'Unknown',
                timestamp: new Date()
            })
                .build();
        }
        else {
            errorMessage = error.message;
            errorDetails = error;
        }
        const result = Result_1.Result.fail(errorMessage);
        return new EnhancedResult(result, errorDetails);
    }
    mapError(fn) {
        if (this.isSuccess) {
            return this;
        }
        const currentError = this._errorDetails || ExocortexError_1.ErrorBuilder.create()
            .withMessage(this.error)
            .withSeverity(ExocortexError_1.ErrorSeverity.ERROR)
            .withCategory(ExocortexError_1.ErrorCategory.SYSTEM)
            .withContext({
            operation: 'Unknown',
            timestamp: new Date()
        })
            .build();
        const mappedError = fn(currentError);
        return EnhancedResult.failEnhanced(mappedError);
    }
    chain(fn) {
        if (this.isFailure) {
            return EnhancedResult.failEnhanced(this._errorDetails || this.error);
        }
        return fn(this.getValue());
    }
    static combineEnhanced(results) {
        const errors = [];
        for (const result of results) {
            if (result.isFailure) {
                const errorDetails = result.getErrorDetails();
                if (errorDetails) {
                    errors.push(errorDetails);
                }
            }
        }
        if (errors.length > 0) {
            const combinedError = ExocortexError_1.ErrorBuilder.create()
                .withTitle('Multiple Errors Occurred')
                .withMessage(`${errors.length} error(s) occurred during operation`)
                .withSeverity(ExocortexError_1.ErrorSeverity.ERROR)
                .withCategory(ExocortexError_1.ErrorCategory.SYSTEM)
                .withContext({
                operation: 'Combined Operation',
                timestamp: new Date(),
                metadata: {
                    errorCount: errors.length,
                    errors: errors.map(e => ({ id: e.id, title: e.title }))
                }
            })
                .withInnerError(errors[0])
                .build();
            return EnhancedResult.failEnhanced(combinedError);
        }
        return EnhancedResult.okEnhanced();
    }
    withContext(context) {
        if (this.isSuccess) {
            return this;
        }
        const currentError = this._errorDetails;
        if (!currentError) {
            return this;
        }
        const updatedError = Object.assign(Object.assign({}, currentError), { context: Object.assign(Object.assign({}, currentError.context), context) });
        return EnhancedResult.failEnhanced(updatedError);
    }
}
exports.EnhancedResult = EnhancedResult;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL2tpdGVsZXYvRG9jdW1lbnRzL2V4b2NvcnRleC1vYnNpZGlhbi1wbHVnaW4vc3JjL2RvbWFpbi9jb3JlL0VuaGFuY2VkUmVzdWx0LnRzIiwibWFwcGluZ3MiOiI7OztBQUFBLHFDQUFrQztBQUNsQyw2REFBc0c7QUFFdEcsTUFBYSxjQUFjO0lBSXZCLFlBQW9CLE1BQWlCLEVBQUUsWUFBNkI7UUFDaEUsSUFBSSxDQUFDLE9BQU8sR0FBRyxNQUFNLENBQUM7UUFDdEIsSUFBSSxDQUFDLGFBQWEsR0FBRyxZQUFZLENBQUM7SUFDdEMsQ0FBQztJQUVELElBQUksU0FBUztRQUNULE9BQU8sSUFBSSxDQUFDLE9BQU8sQ0FBQyxTQUFTLENBQUM7SUFDbEMsQ0FBQztJQUVELElBQUksU0FBUztRQUNULE9BQU8sSUFBSSxDQUFDLE9BQU8sQ0FBQyxTQUFTLENBQUM7SUFDbEMsQ0FBQztJQUVELElBQUksS0FBSztRQUNMLE9BQU8sSUFBSSxDQUFDLE9BQU8sQ0FBQyxLQUFLLENBQUM7SUFDOUIsQ0FBQztJQUVNLFFBQVE7UUFDWCxPQUFPLElBQUksQ0FBQyxPQUFPLENBQUMsUUFBUSxFQUFFLENBQUM7SUFDbkMsQ0FBQztJQUVNLFVBQVU7UUFDYixPQUFPLElBQUksQ0FBQyxPQUFPLENBQUMsVUFBVSxFQUFFLENBQUM7SUFDckMsQ0FBQztJQUVNLGVBQWU7UUFDbEIsT0FBTyxJQUFJLENBQUMsYUFBYSxDQUFDO0lBQzlCLENBQUM7SUFFTSxNQUFNLENBQUMsVUFBVSxDQUFJLEtBQVM7UUFDakMsTUFBTSxNQUFNLEdBQUcsZUFBTSxDQUFDLEVBQUUsQ0FBSSxLQUFLLENBQUMsQ0FBQztRQUNuQyxPQUFPLElBQUksY0FBYyxDQUFDLE1BQU0sQ0FBQyxDQUFDO0lBQ3RDLENBQUM7SUFFTSxNQUFNLENBQUMsWUFBWSxDQUFJLEtBQThCO1FBQ3hELElBQUksWUFBb0IsQ0FBQztRQUN6QixJQUFJLFlBQXdDLENBQUM7UUFFN0MsSUFBSSxPQUFPLEtBQUssS0FBSyxRQUFRLEVBQUU7WUFDM0Is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Q0FBQyxFQUFFLEVBQUUsRUFBRSxDQUFDLENBQUMsRUFBRSxFQUFFLEtBQUssRUFBRSxDQUFDLENBQUMsS0FBSyxFQUFFLENBQUMsQ0FBQztpQkFDMUQ7YUFDSixDQUFDO2lCQUNELGNBQWMsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLENBQUM7aUJBQ3pCLEtBQUssRUFBRSxDQUFDO1lBRWIsT0FBTyxjQUFjLENBQUMsWUFBWSxDQUFDLGFBQWEsQ0FBQyxDQUFDO1NBQ3JEO1FBRUQsT0FBTyxjQUFjLENBQUMsVUFBVSxFQUFFLENBQUM7SUFDdkMsQ0FBQztJQUVNLFdBQVcsQ0FBQyxPQUEyQztRQUMxRCxJQUFJLElBQUksQ0FBQyxTQUFTLEVBQUU7WUFDaEIsT0FBTyxJQUFJLENBQUM7U0FDZjtRQUVELE1BQU0sWUFBWSxHQUFHLElBQUksQ0FBQyxhQUFhLENBQUM7UUFDeEMsSUFBSSxDQUFDLFlBQVksRUFBRTtZQUNmLE9BQU8sSUFBSSxDQUFDO1NBQ2Y7UUFFRCxNQUFNLFlBQVksbUNBQ1gsWUFBWSxLQUNmLE9BQU8sa0NBQ0EsWUFBWSxDQUFDLE9BQU8sR0FDcEIsT0FBTyxJQUVqQixDQUFDO1FBRUYsT0FBTyxjQUFjLENBQUMsWUFBWSxDQUFJLFlBQVksQ0FBQyxDQUFDO0lBQ3hELENBQUM7Q0FDSjtBQWhKRCx3Q0FnSkMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL1VzZXJzL2tpdGVsZXYvRG9jdW1lbnRzL2V4b2NvcnRleC1vYnNpZGlhbi1wbHVnaW4vc3JjL2RvbWFpbi9jb3JlL0VuaGFuY2VkUmVzdWx0LnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFJlc3VsdCB9IGZyb20gJy4vUmVzdWx0JztcbmltcG9ydCB7IEV4b2NvcnRleEVycm9yLCBFcnJvckJ1aWxkZXIsIEVycm9yU2V2ZXJpdHksIEVycm9yQ2F0ZWdvcnkgfSBmcm9tICcuLi9lcnJvcnMvRXhvY29ydGV4RXJyb3InO1xuXG5leHBvcnQgY2xhc3MgRW5oYW5jZWRSZXN1bHQ8VD4ge1xuICAgIHByaXZhdGUgX3Jlc3VsdDogUmVzdWx0PFQ+O1xuICAgIHByaXZhdGUgX2Vycm9yRGV0YWlscz86IEV4b2NvcnRleEVycm9yO1xuXG4gICAgcHJpdmF0ZSBjb25zdHJ1Y3RvcihyZXN1bHQ6IFJlc3VsdDxUPiwgZXJyb3JEZXRhaWxzPzogRXhvY29ydGV4RXJyb3IpIHtcbiAgICAgICAgdGhpcy5fcmVzdWx0ID0gcmVzdWx0O1xuICAgICAgICB0aGlzLl9lcnJvckRldGFpbHMgPSBlcnJvckRldGFpbHM7XG4gICAgfVxuXG4gICAgZ2V0IGlzU3VjY2VzcygpOiBib29sZWFuIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX3Jlc3VsdC5pc1N1Y2Nlc3M7XG4gICAgfVxuXG4gICAgZ2V0IGlzRmFpbHVyZSgpOiBib29sZWFuIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX3Jlc3VsdC5pc0ZhaWx1cmU7XG4gICAgfVxuXG4gICAgZ2V0IGVycm9yKCk6IHN0cmluZyB7XG4gICAgICAgIHJldHVybiB0aGlzLl9yZXN1bHQuZXJyb3I7XG4gICAgfVxuXG4gICAgcHVibGljIGdldFZhbHVlKCk6IFQge1xuICAgICAgICByZXR1cm4gdGhpcy5fcmVzdWx0LmdldFZhbHVlKCk7XG4gICAgfVxuXG4gICAgcHVibGljIGVycm9yVmFsdWUoKTogc3RyaW5nIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX3Jlc3VsdC5lcnJvclZhbHVlKCk7XG4gICAgfVxuXG4gICAgcHVibGljIGdldEVycm9yRGV0YWlscygpOiBFeG9jb3J0ZXhFcnJvciB8IHVuZGVmaW5lZCB7XG4gICAgICAgIHJldHVybiB0aGlzLl9lcnJvckRldGFpbHM7XG4gICAgfVxuXG4gICAgcHVibGljIHN0YXRpYyBva0VuaGFuY2VkPFU+KHZhbHVlPzogVSk6IEVuaGFuY2VkUmVzdWx0PFU+IHtcbiAgICAgICAgY29uc3QgcmVzdWx0ID0gUmVzdWx0Lm9rPFU+KHZhbHVlKTtcbiAgICAgICAgcmV0dXJuIG5ldyBFbmhhbmNlZFJlc3VsdChyZXN1bHQpO1xuICAgIH1cblxuICAgIHB1YmxpYyBzdGF0aWMgZmFpbEVuaGFuY2VkPFU+KGVycm9yOiBzdHJpbmcgfCBFeG9jb3J0ZXhFcnJvcik6IEVuaGFuY2VkUmVzdWx0PFU+IHtcbiAgICAgICAgbGV0IGVycm9yTWVzc2FnZTogc3RyaW5nO1xuICAgICAgICBsZXQgZXJyb3JEZXRhaWxzOiBFeG9jb3J0ZXhFcnJvciB8IHVuZGVmaW5lZDtcblxuICAgICAgICBpZiAodHlwZW9mIGVycm9yID09PSAnc3RyaW5nJykge1xuICAgICAgICAgICAgZXJyb3JNZXNzYWdlID0gZXJyb3I7XG4gICAgICAgICAgICBlcnJvckRldGFpbHMgPSBFcnJvckJ1aWxkZXIuY3JlYXRlKClcbiAgICAgICAgICAgICAgICAud2l0aFRpdGxlKCdPcGVyYXRpb24gRmFpbGVkJylcbiAgICAgICAgICAgICAgICAud2l0aE1lc3NhZ2UoZXJyb3IpXG4gICAgICAgICAgICAgICAgLndpdGhTZXZlcml0eShFcnJvclNldmVyaXR5LkVSUk9SKVxuICAgICAgICAgICAgICAgIC53aXRoQ2F0ZWdvcnkoRXJyb3JDYXRlZ29yeS5TWVNURU0pXG4gICAgICAgICAgICAgICAgLndpdGhDb250ZXh0KHtcbiAgICAgICAgICAgICAgICAgICAgb3BlcmF0aW9uOiAnVW5rbm93bicsXG4gICAgICAgICAgICAgICAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKVxuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgLmJ1aWxkKCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBlcnJvck1lc3NhZ2UgPSBlcnJvci5tZXNzYWdlO1xuICAgICAgICAgICAgZXJyb3JEZXRhaWxzID0gZXJyb3I7XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCByZXN1bHQgPSBSZXN1bHQuZmFpbDxVPihlcnJvck1lc3NhZ2UpO1xuICAgICAgICByZXR1cm4gbmV3IEVuaGFuY2VkUmVzdWx0KHJlc3VsdCwgZXJyb3JEZXRhaWxzKTtcbiAgICB9XG5cbiAgICBwdWJsaWMgbWFwRXJyb3IoZm46IChlcnJvcjogRXhvY29ydGV4RXJyb3IpID0+IEV4b2NvcnRleEVycm9yKTogRW5oYW5jZWRSZXN1bHQ8VD4ge1xuICAgICAgICBpZiAodGhpcy5pc1N1Y2Nlc3MpIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzO1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgY3VycmVudEVycm9yID0gdGhpcy5fZXJyb3JEZXRhaWxzIHx8IEVycm9yQnVpbGRlci5jcmVhdGUoKVxuICAgICAgICAgICAgLndpdGhNZXNzYWdlKHRoaXMuZXJyb3IpXG4gICAgICAgICAgICAud2l0aFNldmVyaXR5KEVycm9yU2V2ZXJpdHkuRVJST1IpXG4gICAgICAgICAgICAud2l0aENhdGVnb3J5KEVycm9yQ2F0ZWdvcnkuU1lTVEVNKVxuICAgICAgICAgICAgLndpdGhDb250ZXh0KHtcbiAgICAgICAgICAgICAgICBvcGVyYXRpb246ICdVbmtub3duJyxcbiAgICAgICAgICAgICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKClcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAuYnVpbGQoKTtcblxuICAgICAgICBjb25zdCBtYXBwZWRFcnJvciA9IGZuKGN1cnJlbnRFcnJvcik7XG4gICAgICAgIHJldHVybiBFbmhhbmNlZFJlc3VsdC5mYWlsRW5oYW5jZWQ8VD4obWFwcGVkRXJyb3IpO1xuICAgIH1cblxuICAgIHB1YmxpYyBjaGFpbjxVPihmbjogKHZhbHVlOiBUKSA9PiBFbmhhbmNlZFJlc3VsdDxVPik6IEVuaGFuY2VkUmVzdWx0PFU+IHtcbiAgICAgICAgaWYgKHRoaXMuaXNGYWlsdXJlKSB7XG4gICAgICAgICAgICByZXR1cm4gRW5oYW5jZWRSZXN1bHQuZmFpbEVuaGFuY2VkPFU+KHRoaXMuX2Vycm9yRGV0YWlscyB8fCB0aGlzLmVycm9yKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZm4odGhpcy5nZXRWYWx1ZSgpKTtcbiAgICB9XG5cbiAgICBwdWJsaWMgc3RhdGljIGNvbWJpbmVFbmhhbmNlZChyZXN1bHRzOiBFbmhhbmNlZFJlc3VsdDxhbnk+W10pOiBFbmhhbmNlZFJlc3VsdDxhbnk+IHtcbiAgICAgICAgY29uc3QgZXJyb3JzOiBFeG9jb3J0ZXhFcnJvcltdID0gW107XG4gICAgICAgIFxuICAgICAgICBmb3IgKGNvbnN0IHJlc3VsdCBvZiByZXN1bHRzKSB7XG4gICAgICAgICAgICBpZiAocmVzdWx0LmlzRmFpbHVyZSkge1xuICAgICAgICAgICAgICAgIGNvbnN0IGVycm9yRGV0YWlscyA9IHJlc3VsdC5nZXRFcnJvckRldGFpbHMoKTtcbiAgICAgICAgICAgICAgICBpZiAoZXJyb3JEZXRhaWxzKSB7XG4gICAgICAgICAgICAgICAgICAgIGVycm9ycy5wdXNoKGVycm9yRGV0YWlscyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGVycm9ycy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICBjb25zdCBjb21iaW5lZEVycm9yID0gRXJyb3JCdWlsZGVyLmNyZWF0ZSgpXG4gICAgICAgICAgICAgICAgLndpdGhUaXRsZSgnTXVsdGlwbGUgRXJyb3JzIE9jY3VycmVkJylcbiAgICAgICAgICAgICAgICAud2l0aE1lc3NhZ2UoYCR7ZXJyb3JzLmxlbmd0aH0gZXJyb3Iocykgb2NjdXJyZWQgZHVyaW5nIG9wZXJhdGlvbmApXG4gICAgICAgICAgICAgICAgLndpdGhTZXZlcml0eShFcnJvclNldmVyaXR5LkVSUk9SKVxuICAgICAgICAgICAgICAgIC53aXRoQ2F0ZWdvcnkoRXJyb3JDYXRlZ29yeS5TWVNURU0pXG4gICAgICAgICAgICAgICAgLndpdGhDb250ZXh0KHtcbiAgICAgICAgICAgICAgICAgICAgb3BlcmF0aW9uOiAnQ29tYmluZWQgT3BlcmF0aW9uJyxcbiAgICAgICAgICAgICAgICAgICAgdGltZXN0YW1wOiBuZXcgRGF0ZSgpLFxuICAgICAgICAgICAgICAgICAgICBtZXRhZGF0YToge1xuICAgICAgICAgICAgICAgICAgICAgICAgZXJyb3JDb3VudDogZXJyb3JzLmxlbmd0aCxcbiAgICAgICAgICAgICAgICAgICAgICAgIGVycm9yczogZXJyb3JzLm1hcChlID0+ICh7IGlkOiBlLmlkLCB0aXRsZTogZS50aXRsZSB9KSlcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgLndpdGhJbm5lckVycm9yKGVycm9yc1swXSlcbiAgICAgICAgICAgICAgICAuYnVpbGQoKTtcblxuICAgICAgICAgICAgcmV0dXJuIEVuaGFuY2VkUmVzdWx0LmZhaWxFbmhhbmNlZChjb21iaW5lZEVycm9yKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBFbmhhbmNlZFJlc3VsdC5va0VuaGFuY2VkKCk7XG4gICAgfVxuXG4gICAgcHVibGljIHdpdGhDb250ZXh0KGNvbnRleHQ6IFBhcnRpYWw8RXhvY29ydGV4RXJyb3JbJ2NvbnRleHQnXT4pOiBFbmhhbmNlZFJlc3VsdDxUPiB7XG4gICAgICAgIGlmICh0aGlzLmlzU3VjY2Vzcykge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBjdXJyZW50RXJyb3IgPSB0aGlzLl9lcnJvckRldGFpbHM7XG4gICAgICAgIGlmICghY3VycmVudEVycm9yKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IHVwZGF0ZWRFcnJvciA9IHtcbiAgICAgICAgICAgIC4uLmN1cnJlbnRFcnJvcixcbiAgICAgICAgICAgIGNvbnRleHQ6IHtcbiAgICAgICAgICAgICAgICAuLi5jdXJyZW50RXJyb3IuY29udGV4dCxcbiAgICAgICAgICAgICAgICAuLi5jb250ZXh0XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG5cbiAgICAgICAgcmV0dXJuIEVuaGFuY2VkUmVzdWx0LmZhaWxFbmhhbmNlZDxUPih1cGRhdGVkRXJyb3IpO1xuICAgIH1cbn0iXSwidmVyc2lvbiI6M30=