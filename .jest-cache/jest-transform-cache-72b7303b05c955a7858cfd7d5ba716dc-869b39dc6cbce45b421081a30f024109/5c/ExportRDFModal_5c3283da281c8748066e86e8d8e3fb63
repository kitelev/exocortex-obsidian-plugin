3eccd262a8aef51caffbdf9dfd95a638
"use strict";
/**
 * Modal for RDF Export functionality
 * Allows users to export knowledge graph or SPARQL results to various RDF formats
 */
Object.defineProperty(exports, "__esModule", { value: true });
exports.ExportRDFModal = void 0;
const tslib_1 = require("tslib");
const obsidian_1 = require("obsidian");
const Graph_1 = require("../../domain/semantic/core/Graph");
const RDFSerializer_1 = require("../../application/services/RDFSerializer");
const NamespaceManager_1 = require("../../application/services/NamespaceManager");
class ExportRDFModal extends obsidian_1.Modal {
    constructor(app, graph, namespaceManager, onExport) {
        super(app);
        this.options = {
            format: 'turtle',
            includeComments: true,
            prettyPrint: true,
            saveToVault: true,
            fileName: 'knowledge-graph'
        };
        this.graph = graph;
        this.namespaceManager = namespaceManager || new NamespaceManager_1.NamespaceManager();
        this.serializer = new RDFSerializer_1.RDFSerializer(this.namespaceManager);
        this.onExport = onExport;
    }
    onOpen() {
        const { contentEl } = this;
        contentEl.empty();
        // Title
        contentEl.createEl('h2', { text: 'Export Knowledge Graph' });
        // Statistics
        const statsEl = contentEl.createDiv('export-stats');
        statsEl.innerHTML = `
            <div class="stat-item">
                <span class="stat-label">Triples:</span>
                <span class="stat-value">${this.graph.size()}</span>
            </div>
            <div class="stat-item">
                <span class="stat-label">Subjects:</span>
                <span class="stat-value">${this.graph.subjects().size}</span>
            </div>
            <div class="stat-item">
                <span class="stat-label">Predicates:</span>
                <span class="stat-value">${this.graph.predicates().size}</span>
            </div>
        `;
        // Format selection
        new obsidian_1.Setting(contentEl)
            .setName('Export format')
            .setDesc('Choose the RDF serialization format')
            .addDropdown(dropdown => {
            dropdown
                .addOption('turtle', 'Turtle (.ttl)')
                .addOption('ntriples', 'N-Triples (.nt)')
                .addOption('jsonld', 'JSON-LD (.jsonld)')
                .addOption('rdfxml', 'RDF/XML (.rdf)')
                .setValue(this.options.format)
                .onChange(value => {
                this.options.format = value;
                this.updateFileName();
                this.updatePreview();
            });
        });
        // File name setting
        new obsidian_1.Setting(contentEl)
            .setName('File name')
            .setDesc('Name for the exported file (without extension)')
            .addText(text => {
            text
                .setPlaceholder('knowledge-graph')
                .setValue(this.options.fileName || '')
                .onChange(value => {
                this.options.fileName = value || 'knowledge-graph';
            });
        });
        // Base IRI setting
        new obsidian_1.Setting(contentEl)
            .setName('Base IRI')
            .setDesc('Optional base IRI for relative URIs')
            .addText(text => {
            text
                .setPlaceholder('https://example.org/data/')
                .setValue(this.options.baseIRI || '')
                .onChange(value => {
                this.options.baseIRI = value || undefined;
                this.updatePreview();
            });
        });
        // Options
        new obsidian_1.Setting(contentEl)
            .setName('Include comments')
            .setDesc('Add comments with metadata and statistics')
            .addToggle(toggle => {
            toggle
                .setValue(this.options.includeComments)
                .onChange(value => {
                this.options.includeComments = value;
                this.updatePreview();
            });
        });
        new obsidian_1.Setting(contentEl)
            .setName('Pretty print')
            .setDesc('Format output for readability (larger file size)')
            .addToggle(toggle => {
            toggle
                .setValue(this.options.prettyPrint)
                .onChange(value => {
                this.options.prettyPrint = value;
                this.updatePreview();
            });
        });
        new obsidian_1.Setting(contentEl)
            .setName('Save to vault')
            .setDesc('Save file to vault, or download to computer')
            .addToggle(toggle => {
            toggle
                .setValue(this.options.saveToVault)
                .onChange(value => {
                this.options.saveToVault = value;
            });
        });
        // Preview section
        const previewContainer = contentEl.createDiv('export-preview');
        previewContainer.createEl('h3', { text: 'Preview' });
        const previewEl = previewContainer.createEl('pre');
        previewEl.addClass('export-preview-content');
        // Buttons
        const buttonContainer = contentEl.createDiv('export-buttons');
        buttonContainer.addClass('modal-button-container');
        // Export button
        const exportButton = buttonContainer.createEl('button', {
            text: 'Export',
            cls: 'mod-cta'
        });
        exportButton.onclick = () => this.handleExport();
        // Cancel button
        const cancelButton = buttonContainer.createEl('button', { text: 'Cancel' });
        cancelButton.onclick = () => this.close();
        // Initial preview
        this.updatePreview();
        // Add styles
        this.addStyles();
    }
    /**
     * Update file name based on format
     */
    updateFileName() {
        if (this.options.fileName && !this.options.fileName.includes('.')) {
            // File name will get extension added during export
        }
    }
    /**
     * Update preview content
     */
    updatePreview() {
        const previewEl = this.contentEl.querySelector('.export-preview-content');
        if (!previewEl)
            return;
        try {
            // Create a small sample for preview
            const sampleGraph = this.createSampleGraph();
            const serializationOptions = {
                format: this.options.format,
                includeComments: this.options.includeComments,
                prettyPrint: this.options.prettyPrint,
                baseIRI: this.options.baseIRI,
                namespaceManager: this.namespaceManager
            };
            const result = this.serializer.serialize(sampleGraph, serializationOptions);
            if (result.isSuccess) {
                const content = result.getValue().content;
                const lines = content.split('\n');
                const preview = lines.slice(0, 10).join('\n');
                previewEl.textContent = preview + (lines.length > 10 ? '\n... (truncated)' : '');
            }
            else {
                previewEl.textContent = `Preview error: ${result.errorValue()}`;
            }
        }
        catch (error) {
            previewEl.textContent = `Preview error: ${error.message}`;
        }
    }
    /**
     * Create a small sample graph for preview
     */
    createSampleGraph() {
        const sampleTriples = this.graph.toArray().slice(0, 5);
        return new Graph_1.Graph(sampleTriples);
    }
    /**
     * Handle export action
     */
    handleExport() {
        var _a, _b;
        return tslib_1.__awaiter(this, void 0, void 0, function* () {
            try {
                const serializationOptions = {
                    format: this.options.format,
                    includeComments: this.options.includeComments,
                    prettyPrint: this.options.prettyPrint,
                    baseIRI: this.options.baseIRI,
                    namespaceManager: this.namespaceManager
                };
                const result = this.serializer.serialize(this.graph, serializationOptions);
                if (result.isFailure) {
                    new obsidian_1.Notice(`Export failed: ${result.errorValue()}`);
                    return;
                }
                const serializedData = result.getValue();
                const extension = RDFSerializer_1.RDFSerializer.getFileExtension(this.options.format);
                const fileName = `${this.options.fileName || 'knowledge-graph'}${extension}`;
                if (this.options.saveToVault) {
                    // Save to vault
                    yield this.saveToVault(serializedData.content, fileName);
                }
                else {
                    // Download to computer
                    this.downloadFile(serializedData.content, fileName);
                }
                // Call onExport callback if provided
                if (this.onExport) {
                    this.onExport({
                        content: serializedData.content,
                        fileName,
                        format: this.options.format
                    });
                }
                const message = this.options.saveToVault
                    ? `Exported ${serializedData.tripleCount} triples to ${fileName}`
                    : `Downloaded ${serializedData.tripleCount} triples as ${fileName}`;
                new obsidian_1.Notice(message);
                if ((_b = (_a = serializedData.metadata) === null || _a === void 0 ? void 0 : _a.warnings) === null || _b === void 0 ? void 0 : _b.length) {
                    new obsidian_1.Notice(`Warnings: ${serializedData.metadata.warnings.join('; ')}`, 5000);
                }
                this.close();
            }
            catch (error) {
                new obsidian_1.Notice(`Export error: ${error.message}`);
            }
        });
    }
    /**
     * Save content to vault
     */
    saveToVault(content, fileName) {
        return tslib_1.__awaiter(this, void 0, void 0, function* () {
            const filePath = `exports/${fileName}`;
            try {
                // Ensure exports folder exists
                const folder = this.app.vault.getAbstractFileByPath('exports');
                if (!folder) {
                    yield this.app.vault.createFolder('exports');
                }
                // Create or update file
                const existingFile = this.app.vault.getAbstractFileByPath(filePath);
                if (existingFile instanceof obsidian_1.TFile) {
                    yield this.app.vault.modify(existingFile, content);
                }
                else {
                    yield this.app.vault.create(filePath, content);
                }
            }
            catch (error) {
                throw new Error(`Failed to save to vault: ${error.message}`);
            }
        });
    }
    /**
     * Download file to computer
     */
    downloadFile(content, fileName) {
        const blob = new Blob([content], {
            type: RDFSerializer_1.RDFSerializer.getMimeType(this.options.format)
        });
        const url = URL.createObjectURL(blob);
        const link = document.createElement('a');
        link.href = url;
        link.download = fileName;
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
        URL.revokeObjectURL(url);
    }
    /**
     * Add custom styles
     */
    addStyles() {
        const style = document.createElement('style');
        style.textContent = `
            .export-stats {
                display: flex;
                gap: 20px;
                margin-bottom: 20px;
                padding: 10px;
                background: var(--background-secondary);
                border-radius: 6px;
            }
            
            .stat-item {
                display: flex;
                flex-direction: column;
                align-items: center;
            }
            
            .stat-label {
                font-size: 12px;
                color: var(--text-muted);
                margin-bottom: 2px;
            }
            
            .stat-value {
                font-size: 18px;
                font-weight: 600;
                color: var(--text-normal);
            }
            
            .export-preview {
                margin: 20px 0;
            }
            
            .export-preview-content {
                max-height: 200px;
                overflow-y: auto;
                background: var(--background-secondary);
                padding: 10px;
                border-radius: 4px;
                font-family: var(--font-monospace);
                font-size: 12px;
                white-space: pre-wrap;
                margin: 0;
            }
            
            .export-buttons {
                display: flex;
                gap: 10px;
                justify-content: flex-end;
                margin-top: 20px;
                padding-top: 20px;
                border-top: 1px solid var(--background-modifier-border);
            }
            
            .modal-button-container button {
                padding: 8px 16px;
                border-radius: 4px;
                border: 1px solid var(--background-modifier-border);
                background: var(--background-primary);
                color: var(--text-normal);
                cursor: pointer;
            }
            
            .modal-button-container button:hover {
                background: var(--background-secondary);
            }
            
            .modal-button-container button.mod-cta {
                background: var(--interactive-accent);
                color: var(--text-on-accent);
                border-color: var(--interactive-accent);
            }
            
            .modal-button-container button.mod-cta:hover {
                background: var(--interactive-accent-hover);
                border-color: var(--interactive-accent-hover);
            }
        `;
        document.head.appendChild(style);
    }
    onClose() {
        const { contentEl } = this;
        contentEl.empty();
    }
}
exports.ExportRDFModal = ExportRDFModal;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL2tpdGVsZXYvRG9jdW1lbnRzL2V4b2NvcnRleC1vYnNpZGlhbi1wbHVnaW4vc3JjL3ByZXNlbnRhdGlvbi9tb2RhbHMvRXhwb3J0UkRGTW9kYWwudHMiLCJtYXBwaW5ncyI6IjtBQUFBOzs7R0FHRzs7OztBQUVILHVDQUE4RDtBQUM5RCw0REFBeUQ7QUFDekQsNEVBQTBHO0FBQzFHLGtGQUErRTtBQVcvRSxNQUFhLGNBQWUsU0FBUSxnQkFBSztJQWFyQyxZQUNJLEdBQVEsRUFDUixLQUFZLEVBQ1osZ0JBQW1DLEVBQ25DLFFBQXFGO1FBRXJGLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQztRQWpCUCxZQUFPLEdBQWtCO1lBQzdCLE1BQU0sRUFBRSxRQUFRO1lBQ2hCLGVBQWUsRUFBRSxJQUFJO1lBQ3JCLFdBQVcsRUFBRSxJQUFJO1lBQ2pCLFdBQVcsRUFBRSxJQUFJO1lBQ2pCLFFBQVEsRUFBRSxpQkFBaUI7U0FDOUIsQ0FBQztRQVlFLElBQUksQ0FBQyxLQUFLLEdBQUcsS0FBSyxDQUFDO1FBQ25CLElBQUksQ0FBQyxnQkFBZ0IsR0FBRyxnQkFBZ0IsSUFBSSxJQUFJLG1DQUFnQixFQUFFLENBQUM7UUFDbkUsSUFBSSxDQUFDLFVBQVUsR0FBRyxJQUFJLDZCQUFhLENBQUMsSUFBSSxDQUFDLGdCQUFnQixDQUFDLENBQUM7UUFDM0QsSUFBSSxDQUFDLFFBQVEsR0FBRyxRQUFRLENBQUM7SUFDN0IsQ0FBQztJQUVELE1BQU07UUFDRixNQUFNLEVBQUUsU0FBUyxFQUFFLEdBQUcsSUFBSSxDQUFDO1FBQzNCLFNBQVMsQ0FBQyxLQUFLLEVBQUUsQ0FBQztRQUVsQixRQUFRO1FBQ1IsU0FBUyxDQUFDLFFBQVEsQ0FBQyxJQUFJLEVBQUUsRUFBRSxJQUFJLEVBQUUsd0JBQXdCLEVBQUUsQ0FBQyxDQUFDO1FBRTdELGFBQWE7UUFDYixNQUFNLE9BQU8sR0FBRyxTQUFTLENBQUMsU0FBUyxDQUFDLGNBQWMsQ0FBQyxDQUFDO1FBQ3BELE9BQU8sQ0FBQyxTQUFTLEdBQUc7OzsyQ0FH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LENBQUMsQ0FBQztRQUNoQyxJQUFJLENBQUMsS0FBSyxFQUFFLENBQUM7UUFDYixRQUFRLENBQUMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUNoQyxHQUFHLENBQUMsZUFBZSxDQUFDLEdBQUcsQ0FBQyxDQUFDO0lBQzdCLENBQUM7SUFFRDs7T0FFRztJQUNLLFNBQVM7UUFDYixNQUFNLEtBQUssR0FBRyxRQUFRLENBQUMsYUFBYSxDQUFDLE9BQU8sQ0FBQyxDQUFDO1FBQzlDLEtBQUssQ0FBQyxXQUFXLEdBQUc7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7U0E0RW5CLENBQUM7UUFFRixRQUFRLENBQUMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxLQUFLLENBQUMsQ0FBQztJQUNyQyxDQUFDO0lBRUQsT0FBTztRQUNILE1BQU0sRUFBRSxTQUFTLEVBQUUsR0FBRyxJQUFJLENBQUM7UUFDM0IsU0FBUyxDQUFDLEtBQUssRUFBRSxDQUFDO0lBQ3RCLENBQUM7Q0FDSjtBQXBaRCx3Q0FvWkMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL1VzZXJzL2tpdGVsZXYvRG9jdW1lbnRzL2V4b2NvcnRleC1vYnNpZGlhbi1wbHVnaW4vc3JjL3ByZXNlbnRhdGlvbi9tb2RhbHMvRXhwb3J0UkRGTW9kYWwudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBNb2RhbCBmb3IgUkRGIEV4cG9ydCBmdW5jdGlvbmFsaXR5XG4gKiBBbGxvd3MgdXNlcnMgdG8gZXhwb3J0IGtub3dsZWRnZSBncmFwaCBvciBTUEFSUUwgcmVzdWx0cyB0byB2YXJpb3VzIFJERiBmb3JtYXRzXG4gKi9cblxuaW1wb3J0IHsgQXBwLCBNb2RhbCwgU2V0dGluZywgTm90aWNlLCBURmlsZSB9IGZyb20gJ29ic2lkaWFuJztcbmltcG9ydCB7IEdyYXBoIH0gZnJvbSAnLi4vLi4vZG9tYWluL3NlbWFudGljL2NvcmUvR3JhcGgnO1xuaW1wb3J0IHsgUkRGU2VyaWFsaXplciwgUkRGRm9ybWF0LCBTZXJpYWxpemF0aW9uT3B0aW9ucyB9IGZyb20gJy4uLy4uL2FwcGxpY2F0aW9uL3NlcnZpY2VzL1JERlNlcmlhbGl6ZXInO1xuaW1wb3J0IHsgTmFtZXNwYWNlTWFuYWdlciB9IGZyb20gJy4uLy4uL2FwcGxpY2F0aW9uL3NlcnZpY2VzL05hbWVzcGFjZU1hbmFnZXInO1xuXG5leHBvcnQgaW50ZXJmYWNlIEV4cG9ydE9wdGlvbnMge1xuICAgIGZvcm1hdDogUkRGRm9ybWF0O1xuICAgIGluY2x1ZGVDb21tZW50czogYm9vbGVhbjtcbiAgICBwcmV0dHlQcmludDogYm9vbGVhbjtcbiAgICBzYXZlVG9WYXVsdDogYm9vbGVhbjtcbiAgICBmaWxlTmFtZT86IHN0cmluZztcbiAgICBiYXNlSVJJPzogc3RyaW5nO1xufVxuXG5leHBvcnQgY2xhc3MgRXhwb3J0UkRGTW9kYWwgZXh0ZW5kcyBNb2RhbCB7XG4gICAgcHJpdmF0ZSBncmFwaDogR3JhcGg7XG4gICAgcHJpdmF0ZSBvcHRpb25zOiBFeHBvcnRPcHRpb25zID0ge1xuICAgICAgICBmb3JtYXQ6ICd0dXJ0bGUnLFxuICAgICAgICBpbmNsdWRlQ29tbWVudHM6IHRydWUsXG4gICAgICAgIHByZXR0eVByaW50OiB0cnVlLFxuICAgICAgICBzYXZlVG9WYXVsdDogdHJ1ZSxcbiAgICAgICAgZmlsZU5hbWU6ICdrbm93bGVkZ2UtZ3JhcGgnXG4gICAgfTtcbiAgICBwcml2YXRlIHNlcmlhbGl6ZXI6IFJERlNlcmlhbGl6ZXI7XG4gICAgcHJpdmF0ZSBuYW1lc3BhY2VNYW5hZ2VyOiBOYW1lc3BhY2VNYW5hZ2VyO1xuICAgIHByaXZhdGUgb25FeHBvcnQ/OiAocmVzdWx0OiB7IGNvbnRlbnQ6IHN0cmluZzsgZmlsZU5hbWU6IHN0cmluZzsgZm9ybWF0OiBSREZGb3JtYXQgfSkgPT4gdm9pZDtcbiAgICBcbiAgICBjb25zdHJ1Y3RvcihcbiAgICAgICAgYXBwOiBBcHAsIFxuICAgICAgICBncmFwaDogR3JhcGgsIFxuICAgICAgICBuYW1lc3BhY2VNYW5hZ2VyPzogTmFtZXNwYWNlTWFuYWdlcixcbiAgICAgICAgb25FeHBvcnQ/OiAocmVzdWx0OiB7IGNvbnRlbnQ6IHN0cmluZzsgZmlsZU5hbWU6IHN0cmluZzsgZm9ybWF0OiBSREZGb3JtYXQgfSkgPT4gdm9pZFxuICAgICkge1xuICAgICAgICBzdXBlcihhcHApO1xuICAgICAgICB0aGlzLmdyYXBoID0gZ3JhcGg7XG4gICAgICAgIHRoaXMubmFtZXNwYWNlTWFuYWdlciA9IG5hbWVzcGFjZU1hbmFnZXIgfHwgbmV3IE5hbWVzcGFjZU1hbmFnZXIoKTtcbiAgICAgICAgdGhpcy5zZXJpYWxpemVyID0gbmV3IFJERlNlcmlhbGl6ZXIodGhpcy5uYW1lc3BhY2VNYW5hZ2VyKTtcbiAgICAgICAgdGhpcy5vbkV4cG9ydCA9IG9uRXhwb3J0O1xuICAgIH1cbiAgICBcbiAgICBvbk9wZW4oKSB7XG4gICAgICAgIGNvbnN0IHsgY29udGVudEVsIH0gPSB0aGlzO1xuICAgICAgICBjb250ZW50RWwuZW1wdHkoKTtcbiAgICAgICAgXG4gICAgICAgIC8vIFRpdGxlXG4gICAgICAgIGNvbnRlbnRFbC5jcmVhdGVFbCgnaDInLCB7IHRleHQ6ICdFeHBvcnQgS25vd2xlZGdlIEdyYXBoJyB9KTtcbiAgICAgICAgXG4gICAgICAgIC8vIFN0YXRpc3RpY3NcbiAgICAgICAgY29uc3Qgc3RhdHNFbCA9IGNvbnRlbnRFbC5jcmVhdGVEaXYoJ2V4cG9ydC1zdGF0cycpO1xuICAgICAgICBzdGF0c0VsLmlubmVySFRNTCA9IGBcbiAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJzdGF0LWl0ZW1cIj5cbiAgICAgICAgICAgICAgICA8c3BhbiBjbGFzcz1cInN0YXQtbGFiZWxcIj5UcmlwbGVzOjwvc3Bhbj5cbiAgICAgICAgICAgICAgICA8c3BhbiBjbGFzcz1cInN0YXQtdmFsdWVcIj4ke3RoaXMuZ3JhcGguc2l6ZSgpfTwvc3Bhbj5cbiAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgPGRpdiBjbGFzcz1cInN0YXQtaXRlbVwiPlxuICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPVwic3RhdC1sYWJlbFwiPlN1YmplY3RzOjwvc3Bhbj5cbiAgICAgICAgICAgICAgICA8c3BhbiBjbGFzcz1cInN0YXQtdmFsdWVcIj4ke3RoaXMuZ3JhcGguc3ViamVjdHMoKS5zaXplfTwvc3Bhbj5cbiAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgPGRpdiBjbGFzcz1cInN0YXQtaXRlbVwiPlxuICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPVwic3RhdC1sYWJlbFwiPlByZWRpY2F0ZXM6PC9zcGFuPlxuICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPVwic3RhdC12YWx1ZVwiPiR7dGhpcy5ncmFwaC5wcmVkaWNhdGVzKCkuc2l6ZX08L3NwYW4+XG4gICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgYDtcbiAgICAgICAgXG4gICAgICAgIC8vIEZvcm1hdCBzZWxlY3Rpb25cbiAgICAgICAgbmV3IFNldHRpbmcoY29udGVudEVsKVxuICAgICAgICAgICAgLnNldE5hbWUoJ0V4cG9ydCBmb3JtYXQnKVxuICAgICAgICAgICAgLnNldERlc2MoJ0Nob29zZSB0aGUgUkRGIHNlcmlhbGl6YXRpb24gZm9ybWF0JylcbiAgICAgICAgICAgIC5hZGREcm9wZG93bihkcm9wZG93biA9PiB7XG4gICAgICAgICAgICAgICAgZHJvcGRvd25cbiAgICAgICAgICAgICAgICAgICAgLmFkZE9wdGlvbigndHVydGxlJywgJ1R1cnRsZSAoLnR0bCknKVxuICAgICAgICAgICAgICAgICAgICAuYWRkT3B0aW9uKCdudHJpcGxlcycsICdOLVRyaXBsZXMgKC5udCknKVxuICAgICAgICAgICAgICAgICAgICAuYWRkT3B0aW9uKCdqc29ubGQnLCAnSlNPTi1MRCAoLmpzb25sZCknKVxuICAgICAgICAgICAgICAgICAgICAuYWRkT3B0aW9uKCdyZGZ4bWwnLCAnUkRGL1hNTCAoLnJkZiknKVxuICAgICAgICAgICAgICAgICAgICAuc2V0VmFsdWUodGhpcy5vcHRpb25zLmZvcm1hdClcbiAgICAgICAgICAgICAgICAgICAgLm9uQ2hhbmdlKHZhbHVlID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMub3B0aW9ucy5mb3JtYXQgPSB2YWx1ZSBhcyBSREZGb3JtYXQ7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnVwZGF0ZUZpbGVOYW1lKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnVwZGF0ZVByZXZpZXcoKTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgXG4gICAgICAgIC8vIEZpbGUgbmFtZSBzZXR0aW5nXG4gICAgICAgIG5ldyBTZXR0aW5nKGNvbnRlbnRFbClcbiAgICAgICAgICAgIC5zZXROYW1lKCdGaWxlIG5hbWUnKVxuICAgICAgICAgICAgLnNldERlc2MoJ05hbWUgZm9yIHRoZSBleHBvcnRlZCBmaWxlICh3aXRob3V0IGV4dGVuc2lvbiknKVxuICAgICAgICAgICAgLmFkZFRleHQodGV4dCA9PiB7XG4gICAgICAgICAgICAgICAgdGV4dFxuICAgICAgICAgICAgICAgICAgICAuc2V0UGxhY2Vob2xkZXIoJ2tub3dsZWRnZS1ncmFwaCcpXG4gICAgICAgICAgICAgICAgICAgIC5zZXRWYWx1ZSh0aGlzLm9wdGlvbnMuZmlsZU5hbWUgfHwgJycpXG4gICAgICAgICAgICAgICAgICAgIC5vbkNoYW5nZSh2YWx1ZSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLm9wdGlvbnMuZmlsZU5hbWUgPSB2YWx1ZSB8fCAna25vd2xlZGdlLWdyYXBoJztcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgXG4gICAgICAgIC8vIEJhc2UgSVJJIHNldHRpbmdcbiAgICAgICAgbmV3IFNldHRpbmcoY29udGVudEVsKVxuICAgICAgICAgICAgLnNldE5hbWUoJ0Jhc2UgSVJJJylcbiAgICAgICAgICAgIC5zZXREZXNjKCdPcHRpb25hbCBiYXNlIElSSSBmb3IgcmVsYXRpdmUgVVJJcycpXG4gICAgICAgICAgICAuYWRkVGV4dCh0ZXh0ID0+IHtcbiAgICAgICAgICAgICAgICB0ZXh0XG4gICAgICAgICAgICAgICAgICAgIC5zZXRQbGFjZWhvbGRlcignaHR0cHM6Ly9leGFtcGxlLm9yZy9kYXRhLycpXG4gICAgICAgICAgICAgICAgICAgIC5zZXRWYWx1ZSh0aGlzLm9wdGlvbnMuYmFzZUlSSSB8fCAnJylcbiAgICAgICAgICAgICAgICAgICAgLm9uQ2hhbmdlKHZhbHVlID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMub3B0aW9ucy5iYXNlSVJJID0gdmFsdWUgfHwgdW5kZWZpbmVkO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy51cGRhdGVQcmV2aWV3KCk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIFxuICAgICAgICAvLyBPcHRpb25zXG4gICAgICAgIG5ldyBTZXR0aW5nKGNvbnRlbnRFbClcbiAgICAgICAgICAgIC5zZXROYW1lKCdJbmNsdWRlIGNvbW1lbnRzJylcbiAgICAgICAgICAgIC5zZXREZXNjKCdBZGQgY29tbWVudHMgd2l0aCBtZXRhZGF0YSBhbmQgc3RhdGlzdGljcycpXG4gICAgICAgICAgICAuYWRkVG9nZ2xlKHRvZ2dsZSA9PiB7XG4gICAgICAgICAgICAgICAgdG9nZ2xlXG4gICAgICAgICAgICAgICAgICAgIC5zZXRWYWx1ZSh0aGlzLm9wdGlvbnMuaW5jbHVkZUNvbW1lbnRzKVxuICAgICAgICAgICAgICAgICAgICAub25DaGFuZ2UodmFsdWUgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5vcHRpb25zLmluY2x1ZGVDb21tZW50cyA9IHZhbHVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy51cGRhdGVQcmV2aWV3KCk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIFxuICAgICAgICBuZXcgU2V0dGluZyhjb250ZW50RWwpXG4gICAgICAgICAgICAuc2V0TmFtZSgnUHJldHR5IHByaW50JylcbiAgICAgICAgICAgIC5zZXREZXNjKCdGb3JtYXQgb3V0cHV0IGZvciByZWFkYWJpbGl0eSAobGFyZ2VyIGZpbGUgc2l6ZSknKVxuICAgICAgICAgICAgLmFkZFRvZ2dsZSh0b2dnbGUgPT4ge1xuICAgICAgICAgICAgICAgIHRvZ2dsZVxuICAgICAgICAgICAgICAgICAgICAuc2V0VmFsdWUodGhpcy5vcHRpb25zLnByZXR0eVByaW50KVxuICAgICAgICAgICAgICAgICAgICAub25DaGFuZ2UodmFsdWUgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5vcHRpb25zLnByZXR0eVByaW50ID0gdmFsdWU7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnVwZGF0ZVByZXZpZXcoKTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgXG4gICAgICAgIG5ldyBTZXR0aW5nKGNvbnRlbnRFbClcbiAgICAgICAgICAgIC5zZXROYW1lKCdTYXZlIHRvIHZhdWx0JylcbiAgICAgICAgICAgIC5zZXREZXNjKCdTYXZlIGZpbGUgdG8gdmF1bHQsIG9yIGRvd25sb2FkIHRvIGNvbXB1dGVyJylcbiAgICAgICAgICAgIC5hZGRUb2dnbGUodG9nZ2xlID0+IHtcbiAgICAgICAgICAgICAgICB0b2dnbGVcbiAgICAgICAgICAgICAgICAgICAgLnNldFZhbHVlKHRoaXMub3B0aW9ucy5zYXZlVG9WYXVsdClcbiAgICAgICAgICAgICAgICAgICAgLm9uQ2hhbmdlKHZhbHVlID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMub3B0aW9ucy5zYXZlVG9WYXVsdCA9IHZhbHVlO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICBcbiAgICAgICAgLy8gUHJldmlldyBzZWN0aW9uXG4gICAgICAgIGNvbnN0IHByZXZpZXdDb250YWluZXIgPSBjb250ZW50RWwuY3JlYXRlRGl2KCdleHBvcnQtcHJldmlldycpO1xuICAgICAgICBwcmV2aWV3Q29udGFpbmVyLmNyZWF0ZUVsKCdoMycsIHsgdGV4dDogJ1ByZXZpZXcnIH0pO1xuICAgICAgICBcbiAgICAgICAgY29uc3QgcHJldmlld0VsID0gcHJldmlld0NvbnRhaW5lci5jcmVhdGVFbCgncHJlJyk7XG4gICAgICAgIHByZXZpZXdFbC5hZGRDbGFzcygnZXhwb3J0LXByZXZpZXctY29udGVudCcpO1xuICAgICAgICBcbiAgICAgICAgLy8gQnV0dG9uc1xuICAgICAgICBjb25zdCBidXR0b25Db250YWluZXIgPSBjb250ZW50RWwuY3JlYXRlRGl2KCdleHBvcnQtYnV0dG9ucycpO1xuICAgICAgICBidXR0b25Db250YWluZXIuYWRkQ2xhc3MoJ21vZGFsLWJ1dHRvbi1jb250YWluZXInKTtcbiAgICAgICAgXG4gICAgICAgIC8vIEV4cG9ydCBidXR0b25cbiAgICAgICAgY29uc3QgZXhwb3J0QnV0dG9uID0gYnV0dG9uQ29udGFpbmVyLmNyZWF0ZUVsKCdidXR0b24nLCB7IFxuICAgICAgICAgICAgdGV4dDogJ0V4cG9ydCcsXG4gICAgICAgICAgICBjbHM6ICdtb2QtY3RhJ1xuICAgICAgICB9KTtcbiAgICAgICAgZXhwb3J0QnV0dG9uLm9uY2xpY2sgPSAoKSA9PiB0aGlzLmhhbmRsZUV4cG9ydCgpO1xuICAgICAgICBcbiAgICAgICAgLy8gQ2FuY2VsIGJ1dHRvblxuICAgICAgICBjb25zdCBjYW5jZWxCdXR0b24gPSBidXR0b25Db250YWluZXIuY3JlYXRlRWwoJ2J1dHRvbicsIHsgdGV4dDogJ0NhbmNlbCcgfSk7XG4gICAgICAgIGNhbmNlbEJ1dHRvbi5vbmNsaWNrID0gKCkgPT4gdGhpcy5jbG9zZSgpO1xuICAgICAgICBcbiAgICAgICAgLy8gSW5pdGlhbCBwcmV2aWV3XG4gICAgICAgIHRoaXMudXBkYXRlUHJldmlldygpO1xuICAgICAgICBcbiAgICAgICAgLy8gQWRkIHN0eWxlc1xuICAgICAgICB0aGlzLmFkZFN0eWxlcygpO1xuICAgIH1cbiAgICBcbiAgICAvKipcbiAgICAgKiBVcGRhdGUgZmlsZSBuYW1lIGJhc2VkIG9uIGZvcm1hdFxuICAgICAqL1xuICAgIHByaXZhdGUgdXBkYXRlRmlsZU5hbWUoKTogdm9pZCB7XG4gICAgICAgIGlmICh0aGlzLm9wdGlvbnMuZmlsZU5hbWUgJiYgIXRoaXMub3B0aW9ucy5maWxlTmFtZS5pbmNsdWRlcygnLicpKSB7XG4gICAgICAgICAgICAvLyBGaWxlIG5hbWUgd2lsbCBnZXQgZXh0ZW5zaW9uIGFkZGVkIGR1cmluZyBleHBvcnRcbiAgICAgICAgfVxuICAgIH1cbiAgICBcbiAgICAvKipcbiAgICAgKiBVcGRhdGUgcHJldmlldyBjb250ZW50XG4gICAgICovXG4gICAgcHJpdmF0ZSB1cGRhdGVQcmV2aWV3KCk6IHZvaWQge1xuICAgICAgICBjb25zdCBwcmV2aWV3RWwgPSB0aGlzLmNvbnRlbnRFbC5xdWVyeVNlbGVjdG9yKCcuZXhwb3J0LXByZXZpZXctY29udGVudCcpIGFzIEhUTUxFbGVtZW50O1xuICAgICAgICBpZiAoIXByZXZpZXdFbCkgcmV0dXJuO1xuICAgICAgICBcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIC8vIENyZWF0ZSBhIHNtYWxsIHNhbXBsZSBmb3IgcHJldmlld1xuICAgICAgICAgICAgY29uc3Qgc2FtcGxlR3JhcGggPSB0aGlzLmNyZWF0ZVNhbXBsZUdyYXBoKCk7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGNvbnN0IHNlcmlhbGl6YXRpb25PcHRpb25zOiBTZXJpYWxpemF0aW9uT3B0aW9ucyA9IHtcbiAgICAgICAgICAgICAgICBmb3JtYXQ6IHRoaXMub3B0aW9ucy5mb3JtYXQsXG4gICAgICAgICAgICAgICAgaW5jbHVkZUNvbW1lbnRzOiB0aGlzLm9wdGlvbnMuaW5jbHVkZUNvbW1lbnRzLFxuICAgICAgICAgICAgICAgIHByZXR0eVByaW50OiB0aGlzLm9wdGlvbnMucHJldHR5UHJpbnQsXG4gICAgICAgICAgICAgICAgYmFzZUlSSTogdGhpcy5vcHRpb25zLmJhc2VJUkksXG4gICAgICAgICAgICAgICAgbmFtZXNwYWNlTWFuYWdlcjogdGhpcy5uYW1lc3BhY2VNYW5hZ2VyXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgXG4gICAgICAgICAgICBjb25zdCByZXN1bHQgPSB0aGlzLnNlcmlhbGl6ZXIuc2VyaWFsaXplKHNhbXBsZUdyYXBoLCBzZXJpYWxpemF0aW9uT3B0aW9ucyk7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGlmIChyZXN1bHQuaXNTdWNjZXNzKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgY29udGVudCA9IHJlc3VsdC5nZXRWYWx1ZSgpLmNvbnRlbnQ7XG4gICAgICAgICAgICAgICAgY29uc3QgbGluZXMgPSBjb250ZW50LnNwbGl0KCdcXG4nKTtcbiAgICAgICAgICAgICAgICBjb25zdCBwcmV2aWV3ID0gbGluZXMuc2xpY2UoMCwgMTApLmpvaW4oJ1xcbicpO1xuICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgIHByZXZpZXdFbC50ZXh0Q29udGVudCA9IHByZXZpZXcgKyAobGluZXMubGVuZ3RoID4gMTAgPyAnXFxuLi4uICh0cnVuY2F0ZWQpJyA6ICcnKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgcHJldmlld0VsLnRleHRDb250ZW50ID0gYFByZXZpZXcgZXJyb3I6ICR7cmVzdWx0LmVycm9yVmFsdWUoKX1gO1xuICAgICAgICAgICAgfVxuICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgcHJldmlld0VsLnRleHRDb250ZW50ID0gYFByZXZpZXcgZXJyb3I6ICR7ZXJyb3IubWVzc2FnZX1gO1xuICAgICAgICB9XG4gICAgfVxuICAgIFxuICAgIC8qKlxuICAgICAqIENyZWF0ZSBhIHNtYWxsIHNhbXBsZSBncmFwaCBmb3IgcHJldmlld1xuICAgICAqL1xuICAgIHByaXZhdGUgY3JlYXRlU2FtcGxlR3JhcGgoKTogR3JhcGgge1xuICAgICAgICBjb25zdCBzYW1wbGVUcmlwbGVzID0gdGhpcy5ncmFwaC50b0FycmF5KCkuc2xpY2UoMCwgNSk7XG4gICAgICAgIHJldHVybiBuZXcgR3JhcGgoc2FtcGxlVHJpcGxlcyk7XG4gICAgfVxuICAgIFxuICAgIC8qKlxuICAgICAqIEhhbmRsZSBleHBvcnQgYWN0aW9uXG4gICAgICovXG4gICAgcHJpdmF0ZSBhc3luYyBoYW5kbGVFeHBvcnQoKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBjb25zdCBzZXJpYWxpemF0aW9uT3B0aW9uczogU2VyaWFsaXphdGlvbk9wdGlvbnMgPSB7XG4gICAgICAgICAgICAgICAgZm9ybWF0OiB0aGlzLm9wdGlvbnMuZm9ybWF0LFxuICAgICAgICAgICAgICAgIGluY2x1ZGVDb21tZW50czogdGhpcy5vcHRpb25zLmluY2x1ZGVDb21tZW50cyxcbiAgICAgICAgICAgICAgICBwcmV0dHlQcmludDogdGhpcy5vcHRpb25zLnByZXR0eVByaW50LFxuICAgICAgICAgICAgICAgIGJhc2VJUkk6IHRoaXMub3B0aW9ucy5iYXNlSVJJLFxuICAgICAgICAgICAgICAgIG5hbWVzcGFjZU1hbmFnZXI6IHRoaXMubmFtZXNwYWNlTWFuYWdlclxuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgY29uc3QgcmVzdWx0ID0gdGhpcy5zZXJpYWxpemVyLnNlcmlhbGl6ZSh0aGlzLmdyYXBoLCBzZXJpYWxpemF0aW9uT3B0aW9ucyk7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGlmIChyZXN1bHQuaXNGYWlsdXJlKSB7XG4gICAgICAgICAgICAgICAgbmV3IE5vdGljZShgRXhwb3J0IGZhaWxlZDogJHtyZXN1bHQuZXJyb3JWYWx1ZSgpfWApO1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIFxuICAgICAgICAgICAgY29uc3Qgc2VyaWFsaXplZERhdGEgPSByZXN1bHQuZ2V0VmFsdWUoKTtcbiAgICAgICAgICAgIGNvbnN0IGV4dGVuc2lvbiA9IFJERlNlcmlhbGl6ZXIuZ2V0RmlsZUV4dGVuc2lvbih0aGlzLm9wdGlvbnMuZm9ybWF0KTtcbiAgICAgICAgICAgIGNvbnN0IGZpbGVOYW1lID0gYCR7dGhpcy5vcHRpb25zLmZpbGVOYW1lIHx8ICdrbm93bGVkZ2UtZ3JhcGgnfSR7ZXh0ZW5zaW9ufWA7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGlmICh0aGlzLm9wdGlvbnMuc2F2ZVRvVmF1bHQpIHtcbiAgICAgICAgICAgICAgICAvLyBTYXZlIHRvIHZhdWx0XG4gICAgICAgICAgICAgICAgYXdhaXQgdGhpcy5zYXZlVG9WYXVsdChzZXJpYWxpemVkRGF0YS5jb250ZW50LCBmaWxlTmFtZSk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIC8vIERvd25sb2FkIHRvIGNvbXB1dGVyXG4gICAgICAgICAgICAgICAgdGhpcy5kb3dubG9hZEZpbGUoc2VyaWFsaXplZERhdGEuY29udGVudCwgZmlsZU5hbWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgXG4gICAgICAgICAgICAvLyBDYWxsIG9uRXhwb3J0IGNhbGxiYWNrIGlmIHByb3ZpZGVkXG4gICAgICAgICAgICBpZiAodGhpcy5vbkV4cG9ydCkge1xuICAgICAgICAgICAgICAgIHRoaXMub25FeHBvcnQoe1xuICAgICAgICAgICAgICAgICAgICBjb250ZW50OiBzZXJpYWxpemVkRGF0YS5jb250ZW50LFxuICAgICAgICAgICAgICAgICAgICBmaWxlTmFtZSxcbiAgICAgICAgICAgICAgICAgICAgZm9ybWF0OiB0aGlzLm9wdGlvbnMuZm9ybWF0XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGNvbnN0IG1lc3NhZ2UgPSB0aGlzLm9wdGlvbnMuc2F2ZVRvVmF1bHQgXG4gICAgICAgICAgICAgICAgPyBgRXhwb3J0ZWQgJHtzZXJpYWxpemVkRGF0YS50cmlwbGVDb3VudH0gdHJpcGxlcyB0byAke2ZpbGVOYW1lfWAgXG4gICAgICAgICAgICAgICAgOiBgRG93bmxvYWRlZCAke3NlcmlhbGl6ZWREYXRhLnRyaXBsZUNvdW50fSB0cmlwbGVzIGFzICR7ZmlsZU5hbWV9YDtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgbmV3IE5vdGljZShtZXNzYWdlKTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgaWYgKHNlcmlhbGl6ZWREYXRhLm1ldGFkYXRhPy53YXJuaW5ncz8ubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgbmV3IE5vdGljZShgV2FybmluZ3M6ICR7c2VyaWFsaXplZERhdGEubWV0YWRhdGEud2FybmluZ3Muam9pbignOyAnKX1gLCA1MDAwKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIFxuICAgICAgICAgICAgdGhpcy5jbG9zZSgpO1xuICAgICAgICAgICAgXG4gICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICBuZXcgTm90aWNlKGBFeHBvcnQgZXJyb3I6ICR7ZXJyb3IubWVzc2FnZX1gKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBcbiAgICAvKipcbiAgICAgKiBTYXZlIGNvbnRlbnQgdG8gdmF1bHRcbiAgICAgKi9cbiAgICBwcml2YXRlIGFzeW5jIHNhdmVUb1ZhdWx0KGNvbnRlbnQ6IHN0cmluZywgZmlsZU5hbWU6IHN0cmluZyk6IFByb21pc2U8dm9pZD4ge1xuICAgICAgICBjb25zdCBmaWxlUGF0aCA9IGBleHBvcnRzLyR7ZmlsZU5hbWV9YDtcbiAgICAgICAgXG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICAvLyBFbnN1cmUgZXhwb3J0cyBmb2xkZXIgZXhpc3RzXG4gICAgICAgICAgICBjb25zdCBmb2xkZXIgPSB0aGlzLmFwcC52YXVsdC5nZXRBYnN0cmFjdEZpbGVCeVBhdGgoJ2V4cG9ydHMnKTtcbiAgICAgICAgICAgIGlmICghZm9sZGVyKSB7XG4gICAgICAgICAgICAgICAgYXdhaXQgdGhpcy5hcHAudmF1bHQuY3JlYXRlRm9sZGVyKCdleHBvcnRzJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIC8vIENyZWF0ZSBvciB1cGRhdGUgZmlsZVxuICAgICAgICAgICAgY29uc3QgZXhpc3RpbmdGaWxlID0gdGhpcy5hcHAudmF1bHQuZ2V0QWJzdHJhY3RGaWxlQnlQYXRoKGZpbGVQYXRoKTtcbiAgICAgICAgICAgIGlmIChleGlzdGluZ0ZpbGUgaW5zdGFuY2VvZiBURmlsZSkge1xuICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMuYXBwLnZhdWx0Lm1vZGlmeShleGlzdGluZ0ZpbGUsIGNvbnRlbnQpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLmFwcC52YXVsdC5jcmVhdGUoZmlsZVBhdGgsIGNvbnRlbnQpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgXG4gICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYEZhaWxlZCB0byBzYXZlIHRvIHZhdWx0OiAke2Vycm9yLm1lc3NhZ2V9YCk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgXG4gICAgLyoqXG4gICAgICogRG93bmxvYWQgZmlsZSB0byBjb21wdXRlclxuICAgICAqL1xuICAgIHByaXZhdGUgZG93bmxvYWRGaWxlKGNvbnRlbnQ6IHN0cmluZywgZmlsZU5hbWU6IHN0cmluZyk6IHZvaWQge1xuICAgICAgICBjb25zdCBibG9iID0gbmV3IEJsb2IoW2NvbnRlbnRdLCB7IFxuICAgICAgICAgICAgdHlwZTogUkRGU2VyaWFsaXplci5nZXRNaW1lVHlwZSh0aGlzLm9wdGlvbnMuZm9ybWF0KSBcbiAgICAgICAgfSk7XG4gICAgICAgIFxuICAgICAgICBjb25zdCB1cmwgPSBVUkwuY3JlYXRlT2JqZWN0VVJMKGJsb2IpO1xuICAgICAgICBjb25zdCBsaW5rID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYScpO1xuICAgICAgICBsaW5rLmhyZWYgPSB1cmw7XG4gICAgICAgIGxpbmsuZG93bmxvYWQgPSBmaWxlTmFtZTtcbiAgICAgICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChsaW5rKTtcbiAgICAgICAgbGluay5jbGljaygpO1xuICAgICAgICBkb2N1bWVudC5ib2R5LnJlbW92ZUNoaWxkKGxpbmspO1xuICAgICAgICBVUkwucmV2b2tlT2JqZWN0VVJMKHVybCk7XG4gICAgfVxuICAgIFxuICAgIC8qKlxuICAgICAqIEFkZCBjdXN0b20gc3R5bGVzXG4gICAgICovXG4gICAgcHJpdmF0ZSBhZGRTdHlsZXMoKTogdm9pZCB7XG4gICAgICAgIGNvbnN0IHN0eWxlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc3R5bGUnKTtcbiAgICAgICAgc3R5bGUudGV4dENvbnRlbnQgPSBgXG4gICAgICAgICAgICAuZXhwb3J0LXN0YXRzIHtcbiAgICAgICAgICAgICAgICBkaXNwbGF5OiBmbGV4O1xuICAgICAgICAgICAgICAgIGdhcDogMjBweDtcbiAgICAgICAgICAgICAgICBtYXJnaW4tYm90dG9tOiAyMHB4O1xuICAgICAgICAgICAgICAgIHBhZGRpbmc6IDEwcHg7XG4gICAgICAgICAgICAgICAgYmFja2dyb3VuZDogdmFyKC0tYmFja2dyb3VuZC1zZWNvbmRhcnkpO1xuICAgICAgICAgICAgICAgIGJvcmRlci1yYWRpdXM6IDZweDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIFxuICAgICAgICAgICAgLnN0YXQtaXRlbSB7XG4gICAgICAgICAgICAgICAgZGlzcGxheTogZmxleDtcbiAgICAgICAgICAgICAgICBmbGV4LWRpcmVjdGlvbjogY29sdW1uO1xuICAgICAgICAgICAgICAgIGFsaWduLWl0ZW1zOiBjZW50ZXI7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIC5zdGF0LWxhYmVsIHtcbiAgICAgICAgICAgICAgICBmb250LXNpemU6IDEycHg7XG4gICAgICAgICAgICAgICAgY29sb3I6IHZhcigtLXRleHQtbXV0ZWQpO1xuICAgICAgICAgICAgICAgIG1hcmdpbi1ib3R0b206IDJweDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIFxuICAgICAgICAgICAgLnN0YXQtdmFsdWUge1xuICAgICAgICAgICAgICAgIGZvbnQtc2l6ZTogMThweDtcbiAgICAgICAgICAgICAgICBmb250LXdlaWdodDogNjAwO1xuICAgICAgICAgICAgICAgIGNvbG9yOiB2YXIoLS10ZXh0LW5vcm1hbCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIC5leHBvcnQtcHJldmlldyB7XG4gICAgICAgICAgICAgICAgbWFyZ2luOiAyMHB4IDA7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIC5leHBvcnQtcHJldmlldy1jb250ZW50IHtcbiAgICAgICAgICAgICAgICBtYXgtaGVpZ2h0OiAyMDBweDtcbiAgICAgICAgICAgICAgICBvdmVyZmxvdy15OiBhdXRvO1xuICAgICAgICAgICAgICAgIGJhY2tncm91bmQ6IHZhcigtLWJhY2tncm91bmQtc2Vjb25kYXJ5KTtcbiAgICAgICAgICAgICAgICBwYWRkaW5nOiAxMHB4O1xuICAgICAgICAgICAgICAgIGJvcmRlci1yYWRpdXM6IDRweDtcbiAgICAgICAgICAgICAgICBmb250LWZhbWlseTogdmFyKC0tZm9udC1tb25vc3BhY2UpO1xuICAgICAgICAgICAgICAgIGZvbnQtc2l6ZTogMTJweDtcbiAgICAgICAgICAgICAgICB3aGl0ZS1zcGFjZTogcHJlLXdyYXA7XG4gICAgICAgICAgICAgICAgbWFyZ2luOiAwO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgXG4gICAgICAgICAgICAuZXhwb3J0LWJ1dHRvbnMge1xuICAgICAgICAgICAgICAgIGRpc3BsYXk6IGZsZXg7XG4gICAgICAgICAgICAgICAgZ2FwOiAxMHB4O1xuICAgICAgICAgICAgICAgIGp1c3RpZnktY29udGVudDogZmxleC1lbmQ7XG4gICAgICAgICAgICAgICAgbWFyZ2luLXRvcDogMjBweDtcbiAgICAgICAgICAgICAgICBwYWRkaW5nLXRvcDogMjBweDtcbiAgICAgICAgICAgICAgICBib3JkZXItdG9wOiAxcHggc29saWQgdmFyKC0tYmFja2dyb3VuZC1tb2RpZmllci1ib3JkZXIpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgXG4gICAgICAgICAgICAubW9kYWwtYnV0dG9uLWNvbnRhaW5lciBidXR0b24ge1xuICAgICAgICAgICAgICAgIHBhZGRpbmc6IDhweCAxNnB4O1xuICAgICAgICAgICAgICAgIGJvcmRlci1yYWRpdXM6IDRweDtcbiAgICAgICAgICAgICAgICBib3JkZXI6IDFweCBzb2xpZCB2YXIoLS1iYWNrZ3JvdW5kLW1vZGlmaWVyLWJvcmRlcik7XG4gICAgICAgICAgICAgICAgYmFja2dyb3VuZDogdmFyKC0tYmFja2dyb3VuZC1wcmltYXJ5KTtcbiAgICAgICAgICAgICAgICBjb2xvcjogdmFyKC0tdGV4dC1ub3JtYWwpO1xuICAgICAgICAgICAgICAgIGN1cnNvcjogcG9pbnRlcjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIFxuICAgICAgICAgICAgLm1vZGFsLWJ1dHRvbi1jb250YWluZXIgYnV0dG9uOmhvdmVyIHtcbiAgICAgICAgICAgICAgICBiYWNrZ3JvdW5kOiB2YXIoLS1iYWNrZ3JvdW5kLXNlY29uZGFyeSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIC5tb2RhbC1idXR0b24tY29udGFpbmVyIGJ1dHRvbi5tb2QtY3RhIHtcbiAgICAgICAgICAgICAgICBiYWNrZ3JvdW5kOiB2YXIoLS1pbnRlcmFjdGl2ZS1hY2NlbnQpO1xuICAgICAgICAgICAgICAgIGNvbG9yOiB2YXIoLS10ZXh0LW9uLWFjY2VudCk7XG4gICAgICAgICAgICAgICAgYm9yZGVyLWNvbG9yOiB2YXIoLS1pbnRlcmFjdGl2ZS1hY2NlbnQpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgXG4gICAgICAgICAgICAubW9kYWwtYnV0dG9uLWNvbnRhaW5lciBidXR0b24ubW9kLWN0YTpob3ZlciB7XG4gICAgICAgICAgICAgICAgYmFja2dyb3VuZDogdmFyKC0taW50ZXJhY3RpdmUtYWNjZW50LWhvdmVyKTtcbiAgICAgICAgICAgICAgICBib3JkZXItY29sb3I6IHZhcigtLWludGVyYWN0aXZlLWFjY2VudC1ob3Zlcik7XG4gICAgICAgICAgICB9XG4gICAgICAgIGA7XG4gICAgICAgIFxuICAgICAgICBkb2N1bWVudC5oZWFkLmFwcGVuZENoaWxkKHN0eWxlKTtcbiAgICB9XG4gICAgXG4gICAgb25DbG9zZSgpIHtcbiAgICAgICAgY29uc3QgeyBjb250ZW50RWwgfSA9IHRoaXM7XG4gICAgICAgIGNvbnRlbnRFbC5lbXB0eSgpO1xuICAgIH1cbn0iXSwidmVyc2lvbiI6M30=