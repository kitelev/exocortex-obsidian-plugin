0e2879ee5d3ea84b0468d58fb43eb8e1
"use strict";
/**
 * Namespace Manager for handling RDF namespace prefixes and URI expansion
 * Manages common RDF vocabularies and custom namespace prefixes
 */
Object.defineProperty(exports, "__esModule", { value: true });
exports.NamespaceManager = void 0;
const Triple_1 = require("../../domain/semantic/core/Triple");
const Result_1 = require("../../domain/core/Result");
class NamespaceManager {
    constructor() {
        this.bindings = new Map();
        this.reverseBindings = new Map();
        this.initializeDefaultNamespaces();
    }
    /**
     * Initialize common RDF namespace prefixes
     */
    initializeDefaultNamespaces() {
        this.addBinding("rdf", "http://www.w3.org/1999/02/22-rdf-syntax-ns#");
        this.addBinding("rdfs", "http://www.w3.org/2000/01/rdf-schema#");
        this.addBinding("owl", "http://www.w3.org/2002/07/owl#");
        this.addBinding("xsd", "http://www.w3.org/2001/XMLSchema#");
        this.addBinding("dc", "http://purl.org/dc/elements/1.1/");
        this.addBinding("dcterms", "http://purl.org/dc/terms/");
        this.addBinding("foaf", "http://xmlns.com/foaf/0.1/");
        this.addBinding("skos", "http://www.w3.org/2004/02/skos/core#");
        this.addBinding("void", "http://rdfs.org/ns/void#");
        // Exocortex namespaces
        this.addBinding("exo", "https://exocortex.io/ontology/core#");
        this.addBinding("ems", "https://exocortex.io/ontology/ems#");
        this.addBinding("vault", "obsidian://vault/");
    }
    /**
     * Add a namespace binding
     */
    addBinding(prefix, namespace) {
        try {
            const iri = new Triple_1.IRI(namespace);
            this.bindings.set(prefix, iri);
            this.reverseBindings.set(namespace, prefix);
        }
        catch (error) {
            console.warn(`Invalid namespace URI for prefix ${prefix}: ${namespace}`);
        }
    }
    /**
     * Remove a namespace binding
     */
    removeBinding(prefix) {
        const namespace = this.bindings.get(prefix);
        if (namespace) {
            this.bindings.delete(prefix);
            this.reverseBindings.delete(namespace.toString());
        }
    }
    /**
     * Get namespace URI for a prefix
     */
    getNamespace(prefix) {
        return this.bindings.get(prefix);
    }
    /**
     * Get prefix for a namespace URI
     */
    getPrefix(namespace) {
        return this.reverseBindings.get(namespace);
    }
    /**
     * Expand a CURIE (Compact URI) to full IRI
     */
    expandCURIE(curie) {
        const colonIndex = curie.indexOf(":");
        if (colonIndex === -1) {
            return Result_1.Result.fail(`Invalid CURIE format: ${curie}`);
        }
        const prefix = curie.substring(0, colonIndex);
        const localName = curie.substring(colonIndex + 1);
        const namespace = this.bindings.get(prefix);
        if (!namespace) {
            return Result_1.Result.fail(`Unknown prefix: ${prefix}`);
        }
        try {
            const fullIRI = new Triple_1.IRI(namespace.toString() + localName);
            return Result_1.Result.ok(fullIRI);
        }
        catch (error) {
            return Result_1.Result.fail(`Invalid expanded IRI: ${error.message}`);
        }
    }
    /**
     * Compress a full IRI to CURIE if possible
     */
    compressIRI(iri) {
        const iriString = iri.toString();
        // Try to find a matching namespace
        for (const [namespace, prefix] of this.reverseBindings) {
            if (iriString.startsWith(namespace)) {
                const localName = iriString.substring(namespace.length);
                // Only compress if the local name is valid
                if (this.isValidLocalName(localName)) {
                    return `${prefix}:${localName}`;
                }
            }
        }
        // Return full IRI if no compression possible
        return `<${iriString}>`;
    }
    /**
     * Check if a local name is valid for CURIE compression
     */
    isValidLocalName(localName) {
        // Basic validation - should start with letter or underscore
        // and contain only alphanumeric characters, hyphens, underscores
        return /^[a-zA-Z_][a-zA-Z0-9_-]*$/.test(localName);
    }
    /**
     * Parse and add namespace prefixes from RDF content
     */
    parseNamespaces(content, format) {
        const lines = content.split("\n");
        for (const line of lines) {
            const trimmed = line.trim();
            if (format === "turtle" || format === "n3") {
                // Parse @prefix declarations
                const prefixMatch = trimmed.match(/^@prefix\s+(\w+):\s+<([^>]+)>\s*\.\s*$/);
                if (prefixMatch) {
                    const [, prefix, namespace] = prefixMatch;
                    this.addBinding(prefix, namespace);
                    continue;
                }
                // Parse PREFIX declarations (SPARQL style)
                const sparqlPrefixMatch = trimmed.match(/^PREFIX\s+(\w+):\s+<([^>]+)>\s*$/);
                if (sparqlPrefixMatch) {
                    const [, prefix, namespace] = sparqlPrefixMatch;
                    this.addBinding(prefix, namespace);
                }
            }
        }
    }
    /**
     * Generate namespace prefix declarations for a format
     */
    generatePrefixDeclarations(format) {
        const declarations = [];
        for (const [prefix, namespace] of this.bindings) {
            switch (format) {
                case "turtle":
                case "n3":
                    declarations.push(`@prefix ${prefix}: <${namespace.toString()}> .`);
                    break;
                case "sparql":
                    declarations.push(`PREFIX ${prefix}: <${namespace.toString()}>`);
                    break;
            }
        }
        return declarations.join("\n");
    }
    /**
     * Get all namespace bindings
     */
    getAllBindings() {
        return Array.from(this.bindings.entries()).map(([prefix, namespace]) => ({
            prefix,
            namespace,
        }));
    }
    /**
     * Clear all custom bindings (keeps default ones)
     */
    clearCustomBindings() {
        this.bindings.clear();
        this.reverseBindings.clear();
        this.initializeDefaultNamespaces();
    }
    /**
     * Check if a prefix exists
     */
    hasPrefix(prefix) {
        return this.bindings.has(prefix);
    }
    /**
     * Check if a namespace exists
     */
    hasNamespace(namespace) {
        return this.reverseBindings.has(namespace);
    }
    /**
     * Create a copy of the namespace manager
     */
    clone() {
        const clone = new NamespaceManager();
        clone.clearCustomBindings();
        for (const [prefix, namespace] of this.bindings) {
            clone.addBinding(prefix, namespace.toString());
        }
        return clone;
    }
}
exports.NamespaceManager = NamespaceManager;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL2tpdGVsZXYvRG9jdW1lbnRzL2V4b2NvcnRleC1vYnNpZGlhbi1wbHVnaW4vc3JjL2FwcGxpY2F0aW9uL3NlcnZpY2VzL05hbWVzcGFjZU1hbmFnZXIudHMiLCJtYXBwaW5ncyI6IjtBQUFBOzs7R0FHRzs7O0FBRUgsOERBQXdEO0FBQ3hELHFEQUFrRDtBQU9sRCxNQUFhLGdCQUFnQjtJQUkzQjtRQUhRLGFBQVEsR0FBcUIsSUFBSSxHQUFHLEVBQUUsQ0FBQztRQUN2QyxvQkFBZSxHQUF3QixJQUFJLEdBQUcsRUFBRSxDQUFDO1FBR3ZELElBQUksQ0FBQywyQkFBMkIsRUFBRSxDQUFDO0lBQ3JDLENBQUM7SUFFRDs7T0FFRztJQUNLLDJCQUEyQjtRQUNqQyxJQUFJLENBQUMsVUFBVSxDQUFDLEtBQUssRUFBRSw2Q0FBNkMsQ0FBQyxDQUFDO1FBQ3RFLElBQUksQ0FBQyxVQUFVLENBQUMsTUFBTSxFQUFFLHVDQUF1QyxDQUFDLENBQUM7UUFDakUsSUFBSSxDQUFDLFVBQVUsQ0FBQyxLQUFLLEVBQUUsZ0NBQWdDLENBQUMsQ0FBQztRQUN6RCxJQUFJLENBQUMsVUFBVSxDQUFDLEtBQUssRUFBRSxtQ0FBbUMsQ0FBQyxDQUFDO1FBQzVELElBQUksQ0FBQyxVQUFVLENBQUMsSUFBSSxFQUFFLGtDQUFrQyxDQUFDLENBQUM7UUFDMUQsSUFBSSxDQUFDLFVBQVUsQ0FBQyxTQUFTLEVBQUUsMkJBQTJCLENBQUMsQ0FBQztRQUN4RCxJQUFJLENBQUMsVUFBVSxDQUFDLE1BQU0sRUFBRSw0QkFBNEIsQ0FBQyxDQUFDO1FBQ3RELElBQUksQ0FBQyxVQUFVLENBQUMsTUFBTSxFQUFFLHNDQUFzQyxDQUFDLENBQUM7UUFDaEUsSUFBSSxDQUFDLFVBQVUsQ0FBQyxNQUFNLEVBQUUsMEJBQTBCLENBQUMsQ0FBQztRQUVwRCx1QkFBdUI7UUFDdkIsSUFBSSxDQUFDLFVBQVUsQ0FBQyxLQUFLLEVBQUUscUNBQXFDLENBQUMsQ0FBQztRQUM5RCxJQUFJLENBQUMsVUFBVSxDQUFDLEtBQUssRUFB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MkIsRUFBRSxDQUFDO0lBQ3JDLENBQUM7SUFFRDs7T0FFRztJQUNILFNBQVMsQ0FBQyxNQUFjO1FBQ3RCLE9BQU8sSUFBSSxDQUFDLFFBQVEsQ0FBQyxHQUFHLENBQUMsTUFBTSxDQUFDLENBQUM7SUFDbkMsQ0FBQztJQUVEOztPQUVHO0lBQ0gsWUFBWSxDQUFDLFNBQWlCO1FBQzVCLE9BQU8sSUFBSSxDQUFDLGVBQWUsQ0FBQyxHQUFHLENBQUMsU0FBUyxDQUFDLENBQUM7SUFDN0MsQ0FBQztJQUVEOztPQUVHO0lBQ0gsS0FBSztRQUNILE1BQU0sS0FBSyxHQUFHLElBQUksZ0JBQWdCLEVBQUUsQ0FBQztRQUNyQyxLQUFLLENBQUMsbUJBQW1CLEVBQUUsQ0FBQztRQUU1QixLQUFLLE1BQU0sQ0FBQyxNQUFNLEVBQUUsU0FBUyxDQUFDLElBQUksSUFBSSxDQUFDLFFBQVEsRUFBRTtZQUMvQyxLQUFLLENBQUMsVUFBVSxDQUFDLE1BQU0sRUFBRSxTQUFTLENBQUMsUUFBUSxFQUFFLENBQUMsQ0FBQztTQUNoRDtRQUVELE9BQU8sS0FBSyxDQUFDO0lBQ2YsQ0FBQztDQUNGO0FBNU5ELDRDQTROQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyIvVXNlcnMva2l0ZWxldi9Eb2N1bWVudHMvZXhvY29ydGV4LW9ic2lkaWFuLXBsdWdpbi9zcmMvYXBwbGljYXRpb24vc2VydmljZXMvTmFtZXNwYWNlTWFuYWdlci50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIE5hbWVzcGFjZSBNYW5hZ2VyIGZvciBoYW5kbGluZyBSREYgbmFtZXNwYWNlIHByZWZpeGVzIGFuZCBVUkkgZXhwYW5zaW9uXG4gKiBNYW5hZ2VzIGNvbW1vbiBSREYgdm9jYWJ1bGFyaWVzIGFuZCBjdXN0b20gbmFtZXNwYWNlIHByZWZpeGVzXG4gKi9cblxuaW1wb3J0IHsgSVJJIH0gZnJvbSBcIi4uLy4uL2RvbWFpbi9zZW1hbnRpYy9jb3JlL1RyaXBsZVwiO1xuaW1wb3J0IHsgUmVzdWx0IH0gZnJvbSBcIi4uLy4uL2RvbWFpbi9jb3JlL1Jlc3VsdFwiO1xuXG5leHBvcnQgaW50ZXJmYWNlIE5hbWVzcGFjZUJpbmRpbmcge1xuICBwcmVmaXg6IHN0cmluZztcbiAgbmFtZXNwYWNlOiBJUkk7XG59XG5cbmV4cG9ydCBjbGFzcyBOYW1lc3BhY2VNYW5hZ2VyIHtcbiAgcHJpdmF0ZSBiaW5kaW5nczogTWFwPHN0cmluZywgSVJJPiA9IG5ldyBNYXAoKTtcbiAgcHJpdmF0ZSByZXZlcnNlQmluZGluZ3M6IE1hcDxzdHJpbmcsIHN0cmluZz4gPSBuZXcgTWFwKCk7XG5cbiAgY29uc3RydWN0b3IoKSB7XG4gICAgdGhpcy5pbml0aWFsaXplRGVmYXVsdE5hbWVzcGFjZXMoKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBJbml0aWFsaXplIGNvbW1vbiBSREYgbmFtZXNwYWNlIHByZWZpeGVzXG4gICAqL1xuICBwcml2YXRlIGluaXRpYWxpemVEZWZhdWx0TmFtZXNwYWNlcygpOiB2b2lkIHtcbiAgICB0aGlzLmFkZEJpbmRpbmcoXCJyZGZcIiwgXCJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjXCIpO1xuICAgIHRoaXMuYWRkQmluZGluZyhcInJkZnNcIiwgXCJodHRwOi8vd3d3LnczLm9yZy8yMDAwLzAxL3JkZi1zY2hlbWEjXCIpO1xuICAgIHRoaXMuYWRkQmluZGluZyhcIm93bFwiLCBcImh0dHA6Ly93d3cudzMub3JnLzIwMDIvMDcvb3dsI1wiKTtcbiAgICB0aGlzLmFkZEJpbmRpbmcoXCJ4c2RcIiwgXCJodHRwOi8vd3d3LnczLm9yZy8yMDAxL1hNTFNjaGVtYSNcIik7XG4gICAgdGhpcy5hZGRCaW5kaW5nKFwiZGNcIiwgXCJodHRwOi8vcHVybC5vcmcvZGMvZWxlbWVudHMvMS4xL1wiKTtcbiAgICB0aGlzLmFkZEJpbmRpbmcoXCJkY3Rlcm1zXCIsIFwiaHR0cDovL3B1cmwub3JnL2RjL3Rlcm1zL1wiKTtcbiAgICB0aGlzLmFkZEJpbmRpbmcoXCJmb2FmXCIsIFwiaHR0cDovL3htbG5zLmNvbS9mb2FmLzAuMS9cIik7XG4gICAgdGhpcy5hZGRCaW5kaW5nKFwic2tvc1wiLCBcImh0dHA6Ly93d3cudzMub3JnLzIwMDQvMDIvc2tvcy9jb3JlI1wiKTtcbiAgICB0aGlzLmFkZEJpbmRpbmcoXCJ2b2lkXCIsIFwiaHR0cDovL3JkZnMub3JnL25zL3ZvaWQjXCIpO1xuXG4gICAgLy8gRXhvY29ydGV4IG5hbWVzcGFjZXNcbiAgICB0aGlzLmFkZEJpbmRpbmcoXCJleG9cIiwgXCJodHRwczovL2V4b2NvcnRleC5pby9vbnRvbG9neS9jb3JlI1wiKTtcbiAgICB0aGlzLmFkZEJpbmRpbmcoXCJlbXNcIiwgXCJodHRwczovL2V4b2NvcnRleC5pby9vbnRvbG9neS9lbXMjXCIpO1xuICAgIHRoaXMuYWRkQmluZGluZyhcInZhdWx0XCIsIFwib2JzaWRpYW46Ly92YXVsdC9cIik7XG4gIH1cblxuICAvKipcbiAgICogQWRkIGEgbmFtZXNwYWNlIGJpbmRpbmdcbiAgICovXG4gIGFkZEJpbmRpbmcocHJlZml4OiBzdHJpbmcsIG5hbWVzcGFjZTogc3RyaW5nKTogdm9pZCB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IGlyaSA9IG5ldyBJUkkobmFtZXNwYWNlKTtcbiAgICAgIHRoaXMuYmluZGluZ3Muc2V0KHByZWZpeCwgaXJpKTtcbiAgICAgIHRoaXMucmV2ZXJzZUJpbmRpbmdzLnNldChuYW1lc3BhY2UsIHByZWZpeCk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUud2FybihgSW52YWxpZCBuYW1lc3BhY2UgVVJJIGZvciBwcmVmaXggJHtwcmVmaXh9OiAke25hbWVzcGFjZX1gKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogUmVtb3ZlIGEgbmFtZXNwYWNlIGJpbmRpbmdcbiAgICovXG4gIHJlbW92ZUJpbmRpbmcocHJlZml4OiBzdHJpbmcpOiB2b2lkIHtcbiAgICBjb25zdCBuYW1lc3BhY2UgPSB0aGlzLmJpbmRpbmdzLmdldChwcmVmaXgpO1xuICAgIGlmIChuYW1lc3BhY2UpIHtcbiAgICAgIHRoaXMuYmluZGluZ3MuZGVsZXRlKHByZWZpeCk7XG4gICAgICB0aGlzLnJldmVyc2VCaW5kaW5ncy5kZWxldGUobmFtZXNwYWNlLnRvU3RyaW5nKCkpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgbmFtZXNwYWNlIFVSSSBmb3IgYSBwcmVmaXhcbiAgICovXG4gIGdldE5hbWVzcGFjZShwcmVmaXg6IHN0cmluZyk6IElSSSB8IHVuZGVmaW5lZCB7XG4gICAgcmV0dXJuIHRoaXMuYmluZGluZ3MuZ2V0KHByZWZpeCk7XG4gIH1cblxuICAvKipcbiAgICogR2V0IHByZWZpeCBmb3IgYSBuYW1lc3BhY2UgVVJJXG4gICAqL1xuICBnZXRQcmVmaXgobmFtZXNwYWNlOiBzdHJpbmcpOiBzdHJpbmcgfCB1bmRlZmluZWQge1xuICAgIHJldHVybiB0aGlzLnJldmVyc2VCaW5kaW5ncy5nZXQobmFtZXNwYWNlKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBFeHBhbmQgYSBDVVJJRSAoQ29tcGFjdCBVUkkpIHRvIGZ1bGwgSVJJXG4gICAqL1xuICBleHBhbmRDVVJJRShjdXJpZTogc3RyaW5nKTogUmVzdWx0PElSST4ge1xuICAgIGNvbnN0IGNvbG9uSW5kZXggPSBjdXJpZS5pbmRleE9mKFwiOlwiKTtcbiAgICBpZiAoY29sb25JbmRleCA9PT0gLTEpIHtcbiAgICAgIHJldHVybiBSZXN1bHQuZmFpbChgSW52YWxpZCBDVVJJRSBmb3JtYXQ6ICR7Y3VyaWV9YCk7XG4gICAgfVxuXG4gICAgY29uc3QgcHJlZml4ID0gY3VyaWUuc3Vic3RyaW5nKDAsIGNvbG9uSW5kZXgpO1xuICAgIGNvbnN0IGxvY2FsTmFtZSA9IGN1cmllLnN1YnN0cmluZyhjb2xvbkluZGV4ICsgMSk7XG5cbiAgICBjb25zdCBuYW1lc3BhY2UgPSB0aGlzLmJpbmRpbmdzLmdldChwcmVmaXgpO1xuICAgIGlmICghbmFtZXNwYWNlKSB7XG4gICAgICByZXR1cm4gUmVzdWx0LmZhaWwoYFVua25vd24gcHJlZml4OiAke3ByZWZpeH1gKTtcbiAgICB9XG5cbiAgICB0cnkge1xuICAgICAgY29uc3QgZnVsbElSSSA9IG5ldyBJUkkobmFtZXNwYWNlLnRvU3RyaW5nKCkgKyBsb2NhbE5hbWUpO1xuICAgICAgcmV0dXJuIFJlc3VsdC5vayhmdWxsSVJJKTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgcmV0dXJuIFJlc3VsdC5mYWlsKGBJbnZhbGlkIGV4cGFuZGVkIElSSTogJHtlcnJvci5tZXNzYWdlfWApO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBDb21wcmVzcyBhIGZ1bGwgSVJJIHRvIENVUklFIGlmIHBvc3NpYmxlXG4gICAqL1xuICBjb21wcmVzc0lSSShpcmk6IElSSSk6IHN0cmluZyB7XG4gICAgY29uc3QgaXJpU3RyaW5nID0gaXJpLnRvU3RyaW5nKCk7XG5cbiAgICAvLyBUcnkgdG8gZmluZCBhIG1hdGNoaW5nIG5hbWVzcGFjZVxuICAgIGZvciAoY29uc3QgW25hbWVzcGFjZSwgcHJlZml4XSBvZiB0aGlzLnJldmVyc2VCaW5kaW5ncykge1xuICAgICAgaWYgKGlyaVN0cmluZy5zdGFydHNXaXRoKG5hbWVzcGFjZSkpIHtcbiAgICAgICAgY29uc3QgbG9jYWxOYW1lID0gaXJpU3RyaW5nLnN1YnN0cmluZyhuYW1lc3BhY2UubGVuZ3RoKTtcbiAgICAgICAgLy8gT25seSBjb21wcmVzcyBpZiB0aGUgbG9jYWwgbmFtZSBpcyB2YWxpZFxuICAgICAgICBpZiAodGhpcy5pc1ZhbGlkTG9jYWxOYW1lKGxvY2FsTmFtZSkpIHtcbiAgICAgICAgICByZXR1cm4gYCR7cHJlZml4fToke2xvY2FsTmFtZX1gO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8gUmV0dXJuIGZ1bGwgSVJJIGlmIG5vIGNvbXByZXNzaW9uIHBvc3NpYmxlXG4gICAgcmV0dXJuIGA8JHtpcmlTdHJpbmd9PmA7XG4gIH1cblxuICAvKipcbiAgICogQ2hlY2sgaWYgYSBsb2NhbCBuYW1lIGlzIHZhbGlkIGZvciBDVVJJRSBjb21wcmVzc2lvblxuICAgKi9cbiAgcHJpdmF0ZSBpc1ZhbGlkTG9jYWxOYW1lKGxvY2FsTmFtZTogc3RyaW5nKTogYm9vbGVhbiB7XG4gICAgLy8gQmFzaWMgdmFsaWRhdGlvbiAtIHNob3VsZCBzdGFydCB3aXRoIGxldHRlciBvciB1bmRlcnNjb3JlXG4gICAgLy8gYW5kIGNvbnRhaW4gb25seSBhbHBoYW51bWVyaWMgY2hhcmFjdGVycywgaHlwaGVucywgdW5kZXJzY29yZXNcbiAgICByZXR1cm4gL15bYS16QS1aX11bYS16QS1aMC05Xy1dKiQvLnRlc3QobG9jYWxOYW1lKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBQYXJzZSBhbmQgYWRkIG5hbWVzcGFjZSBwcmVmaXhlcyBmcm9tIFJERiBjb250ZW50XG4gICAqL1xuICBwYXJzZU5hbWVzcGFjZXMoY29udGVudDogc3RyaW5nLCBmb3JtYXQ6IFwidHVydGxlXCIgfCBcIm4zXCIpOiB2b2lkIHtcbiAgICBjb25zdCBsaW5lcyA9IGNvbnRlbnQuc3BsaXQoXCJcXG5cIik7XG5cbiAgICBmb3IgKGNvbnN0IGxpbmUgb2YgbGluZXMpIHtcbiAgICAgIGNvbnN0IHRyaW1tZWQgPSBsaW5lLnRyaW0oKTtcblxuICAgICAgaWYgKGZvcm1hdCA9PT0gXCJ0dXJ0bGVcIiB8fCBmb3JtYXQgPT09IFwibjNcIikge1xuICAgICAgICAvLyBQYXJzZSBAcHJlZml4IGRlY2xhcmF0aW9uc1xuICAgICAgICBjb25zdCBwcmVmaXhNYXRjaCA9IHRyaW1tZWQubWF0Y2goXG4gICAgICAgICAgL15AcHJlZml4XFxzKyhcXHcrKTpcXHMrPChbXj5dKyk+XFxzKlxcLlxccyokLyxcbiAgICAgICAgKTtcbiAgICAgICAgaWYgKHByZWZpeE1hdGNoKSB7XG4gICAgICAgICAgY29uc3QgWywgcHJlZml4LCBuYW1lc3BhY2VdID0gcHJlZml4TWF0Y2g7XG4gICAgICAgICAgdGhpcy5hZGRCaW5kaW5nKHByZWZpeCwgbmFtZXNwYWNlKTtcbiAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIFBhcnNlIFBSRUZJWCBkZWNsYXJhdGlvbnMgKFNQQVJRTCBzdHlsZSlcbiAgICAgICAgY29uc3Qgc3BhcnFsUHJlZml4TWF0Y2ggPSB0cmltbWVkLm1hdGNoKFxuICAgICAgICAgIC9eUFJFRklYXFxzKyhcXHcrKTpcXHMrPChbXj5dKyk+XFxzKiQvLFxuICAgICAgICApO1xuICAgICAgICBpZiAoc3BhcnFsUHJlZml4TWF0Y2gpIHtcbiAgICAgICAgICBjb25zdCBbLCBwcmVmaXgsIG5hbWVzcGFjZV0gPSBzcGFycWxQcmVmaXhNYXRjaDtcbiAgICAgICAgICB0aGlzLmFkZEJpbmRpbmcocHJlZml4LCBuYW1lc3BhY2UpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEdlbmVyYXRlIG5hbWVzcGFjZSBwcmVmaXggZGVjbGFyYXRpb25zIGZvciBhIGZvcm1hdFxuICAgKi9cbiAgZ2VuZXJhdGVQcmVmaXhEZWNsYXJhdGlvbnMoZm9ybWF0OiBcInR1cnRsZVwiIHwgXCJuM1wiIHwgXCJzcGFycWxcIik6IHN0cmluZyB7XG4gICAgY29uc3QgZGVjbGFyYXRpb25zOiBzdHJpbmdbXSA9IFtdO1xuXG4gICAgZm9yIChjb25zdCBbcHJlZml4LCBuYW1lc3BhY2VdIG9mIHRoaXMuYmluZGluZ3MpIHtcbiAgICAgIHN3aXRjaCAoZm9ybWF0KSB7XG4gICAgICAgIGNhc2UgXCJ0dXJ0bGVcIjpcbiAgICAgICAgY2FzZSBcIm4zXCI6XG4gICAgICAgICAgZGVjbGFyYXRpb25zLnB1c2goYEBwcmVmaXggJHtwcmVmaXh9OiA8JHtuYW1lc3BhY2UudG9TdHJpbmcoKX0+IC5gKTtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSBcInNwYXJxbFwiOlxuICAgICAgICAgIGRlY2xhcmF0aW9ucy5wdXNoKGBQUkVGSVggJHtwcmVmaXh9OiA8JHtuYW1lc3BhY2UudG9TdHJpbmcoKX0+YCk7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIGRlY2xhcmF0aW9ucy5qb2luKFwiXFxuXCIpO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldCBhbGwgbmFtZXNwYWNlIGJpbmRpbmdzXG4gICAqL1xuICBnZXRBbGxCaW5kaW5ncygpOiBOYW1lc3BhY2VCaW5kaW5nW10ge1xuICAgIHJldHVybiBBcnJheS5mcm9tKHRoaXMuYmluZGluZ3MuZW50cmllcygpKS5tYXAoKFtwcmVmaXgsIG5hbWVzcGFjZV0pID0+ICh7XG4gICAgICBwcmVmaXgsXG4gICAgICBuYW1lc3BhY2UsXG4gICAgfSkpO1xuICB9XG5cbiAgLyoqXG4gICAqIENsZWFyIGFsbCBjdXN0b20gYmluZGluZ3MgKGtlZXBzIGRlZmF1bHQgb25lcylcbiAgICovXG4gIGNsZWFyQ3VzdG9tQmluZGluZ3MoKTogdm9pZCB7XG4gICAgdGhpcy5iaW5kaW5ncy5jbGVhcigpO1xuICAgIHRoaXMucmV2ZXJzZUJpbmRpbmdzLmNsZWFyKCk7XG4gICAgdGhpcy5pbml0aWFsaXplRGVmYXVsdE5hbWVzcGFjZXMoKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDaGVjayBpZiBhIHByZWZpeCBleGlzdHNcbiAgICovXG4gIGhhc1ByZWZpeChwcmVmaXg6IHN0cmluZyk6IGJvb2xlYW4ge1xuICAgIHJldHVybiB0aGlzLmJpbmRpbmdzLmhhcyhwcmVmaXgpO1xuICB9XG5cbiAgLyoqXG4gICAqIENoZWNrIGlmIGEgbmFtZXNwYWNlIGV4aXN0c1xuICAgKi9cbiAgaGFzTmFtZXNwYWNlKG5hbWVzcGFjZTogc3RyaW5nKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIHRoaXMucmV2ZXJzZUJpbmRpbmdzLmhhcyhuYW1lc3BhY2UpO1xuICB9XG5cbiAgLyoqXG4gICAqIENyZWF0ZSBhIGNvcHkgb2YgdGhlIG5hbWVzcGFjZSBtYW5hZ2VyXG4gICAqL1xuICBjbG9uZSgpOiBOYW1lc3BhY2VNYW5hZ2VyIHtcbiAgICBjb25zdCBjbG9uZSA9IG5ldyBOYW1lc3BhY2VNYW5hZ2VyKCk7XG4gICAgY2xvbmUuY2xlYXJDdXN0b21CaW5kaW5ncygpO1xuXG4gICAgZm9yIChjb25zdCBbcHJlZml4LCBuYW1lc3BhY2VdIG9mIHRoaXMuYmluZGluZ3MpIHtcbiAgICAgIGNsb25lLmFkZEJpbmRpbmcocHJlZml4LCBuYW1lc3BhY2UudG9TdHJpbmcoKSk7XG4gICAgfVxuXG4gICAgcmV0dXJuIGNsb25lO1xuICB9XG59XG4iXSwidmVyc2lvbiI6M30=