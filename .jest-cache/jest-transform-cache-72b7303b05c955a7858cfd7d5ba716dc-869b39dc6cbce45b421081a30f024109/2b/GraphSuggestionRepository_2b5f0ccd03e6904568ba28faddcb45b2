4db78010602308cf0df78f6974a90c54
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.GraphSuggestionRepository = void 0;
const SPARQLSuggestion_1 = require("../../domain/autocomplete/SPARQLSuggestion");
const QueryContext_1 = require("../../domain/autocomplete/QueryContext");
const Result_1 = require("../../domain/core/Result");
const KeywordSuggestionProvider_1 = require("../autocomplete/KeywordSuggestionProvider");
class GraphSuggestionRepository {
    constructor(graph) {
        this.graph = graph;
        this.keywordProvider = new KeywordSuggestionProvider_1.KeywordSuggestionProvider();
        this.usageStats = {};
        this.propertyCache = new Map();
        this.classCache = new Map();
        this.cacheTimestamp = 0;
        this.cacheTTL = 60000; // 1 minute
    }
    async findKeywordSuggestions(context) {
        try {
            const suggestions = this.keywordProvider.getSuggestions(context);
            return Result_1.Result.ok(suggestions);
        }
        catch (error) {
            return Result_1.Result.fail(`Failed to get keyword suggestions: ${error}`);
        }
    }
    async findPropertySuggestions(context) {
        try {
            if (this.shouldRefreshCache()) {
                this.refreshPropertyCache();
            }
            const cachedSuggestions = this.propertyCache.get(context.getCurrentToken());
            if (cachedSuggestions) {
                return Result_1.Result.ok(cachedSuggestions);
            }
            const properties = this.extractPropertiesFromGraph();
            const suggestions = properties.map((prop) => this.createPropertySuggestion(prop, context));
            this.propertyCache.set(context.getCurrentToken(), suggestions);
            return Result_1.Result.ok(suggestions);
        }
        catch (error) {
            return Result_1.Result.fail(`Failed to get property suggestions: ${error}`);
        }
    }
    async findClassSuggestions(context) {
        try {
            if (this.shouldRefreshCache()) {
                this.refreshClassCache();
            }
            const cachedSuggestions = this.classCache.get(context.getCurrentToken());
            if (cachedSuggestions) {
                return Result_1.Result.ok(cachedSuggestions);
            }
            const classes = this.extractClassesFromGraph();
            const suggestions = classes.map((cls) => this.createClassSuggestion(cls, context));
            this.classCache.set(context.getCurrentToken(), suggestions);
            return Result_1.Result.ok(suggestions);
        }
        catch (error) {
            return Result_1.Result.fail(`Failed to get class suggestions: ${error}`);
        }
    }
    async findVariableSuggestions(context) {
        try {
            const suggestions = [];
            const existingVariables = context.getVariablesInScope();
            const currentToken = context.getCurrentToken();
            // Suggest reuse of existing variables
            for (const variable of existingVariables) {
                const varName = `?${variable}`;
                if (!currentToken || varName.startsWith(currentToken)) {
                    suggestions.push(SPARQLSuggestion_1.SPARQLSuggestion.create({
                        id: `var_existing_${variable}`,
                        text: varName,
                        insertText: varName,
                        type: SPARQLSuggestion_1.SuggestionType.VARIABLE,
                        confidence: 0.9,
                        contextualScore: 0.95,
                        metadata: {
                            description: "Existing variable in query",
                            usage: "Reuse this variable to join patterns",
                        },
                    }));
                }
            }
            // Suggest common variable names
            const commonVariables = [
                { name: "subject", desc: "Subject of a triple" },
                { name: "predicate", desc: "Predicate/property" },
                { name: "object", desc: "Object value" },
                { name: "type", desc: "RDF type/class" },
                { name: "label", desc: "Human-readable label" },
                { name: "value", desc: "Generic value" },
                { name: "name", desc: "Name property" },
                { name: "id", desc: "Identifier" },
                { name: "date", desc: "Date/time value" },
                { name: "count", desc: "Count aggregate" },
            ];
            for (const { name, desc } of commonVariables) {
                const varName = `?${name}`;
                if (!existingVariables.includes(name) &&
                    (!currentToken || varName.startsWith(currentToken))) {
                    suggestions.push(SPARQLSuggestion_1.SPARQLSuggestion.create({
                        id: `var_common_${name}`,
                        text: varName,
                        insertText: varName,
                        type: SPARQLSuggestion_1.SuggestionType.VARIABLE,
                        confidence: 0.7,
                        contextualScore: 0.6,
                        metadata: {
                            description: desc,
                            usage: `Common variable name for ${desc.toLowerCase()}`,
                        },
                    }));
                }
            }
            return Result_1.Result.ok(suggestions);
        }
        catch (error) {
            return Result_1.Result.fail(`Failed to get variable suggestions: ${error}`);
        }
    }
    async findNamespaceSuggestions(context) {
        try {
            const namespaces = [
                { prefix: "rdf:", uri: "http://www.w3.org/1999/02/22-rdf-syntax-ns#" },
                { prefix: "rdfs:", uri: "http://www.w3.org/2000/01/rdf-schema#" },
                { prefix: "owl:", uri: "http://www.w3.org/2002/07/owl#" },
                { prefix: "xsd:", uri: "http://www.w3.org/2001/XMLSchema#" },
                { prefix: "skos:", uri: "http://www.w3.org/2004/02/skos/core#" },
                { prefix: "foaf:", uri: "http://xmlns.com/foaf/0.1/" },
                { prefix: "dc:", uri: "http://purl.org/dc/elements/1.1/" },
                { prefix: "exo:", uri: "http://example.org/exocortex#" },
            ];
            const suggestions = namespaces
                .filter((ns) => !context.getCurrentToken() ||
                ns.prefix.startsWith(context.getCurrentToken()))
                .map((ns) => SPARQLSuggestion_1.SPARQLSuggestion.create({
                id: `namespace_${ns.prefix}`,
                text: ns.prefix,
                insertText: `PREFIX ${ns.prefix} <${ns.uri}>`,
                type: SPARQLSuggestion_1.SuggestionType.NAMESPACE,
                confidence: 0.85,
                contextualScore: 0.8,
                metadata: {
                    description: `Namespace: ${ns.uri}`,
                    namespace: ns.uri,
                },
            }));
            return Result_1.Result.ok(suggestions);
        }
        catch (error) {
            return Result_1.Result.fail(`Failed to get namespace suggestions: ${error}`);
        }
    }
    async findFunctionSuggestions(context) {
        try {
            const functions = [
                { name: "STR", desc: "Convert to string", example: "STR(?value)" },
                { name: "LANG", desc: "Get language tag", example: "LANG(?label)" },
                {
                    name: "DATATYPE",
                    desc: "Get datatype IRI",
                    example: "DATATYPE(?literal)",
                },
                {
                    name: "BOUND",
                    desc: "Test if variable is bound",
                    example: "BOUND(?var)",
                },
                {
                    name: "REGEX",
                    desc: "Regular expression match",
                    example: 'REGEX(?text, "pattern")',
                },
                {
                    name: "CONTAINS",
                    desc: "String contains",
                    example: 'CONTAINS(?str, "substring")',
                },
                {
                    name: "STRSTARTS",
                    desc: "String starts with",
                    example: 'STRSTARTS(?str, "prefix")',
                },
                {
                    name: "STRENDS",
                    desc: "String ends with",
                    example: 'STRENDS(?str, "suffix")',
                },
                { name: "STRLEN", desc: "String length", example: "STRLEN(?str)" },
                { name: "SUBSTR", desc: "Substring", example: "SUBSTR(?str, 1, 10)" },
                { name: "UCASE", desc: "Convert to uppercase", example: "UCASE(?str)" },
                { name: "LCASE", desc: "Convert to lowercase", example: "LCASE(?str)" },
                { name: "COUNT", desc: "Count aggregate", example: "COUNT(?item)" },
                { name: "SUM", desc: "Sum aggregate", example: "SUM(?value)" },
                { name: "AVG", desc: "Average aggregate", example: "AVG(?value)" },
                { name: "MIN", desc: "Minimum value", example: "MIN(?value)" },
                { name: "MAX", desc: "Maximum value", example: "MAX(?value)" },
                { name: "NOW", desc: "Current date/time", example: "NOW()" },
                { name: "YEAR", desc: "Extract year", example: "YEAR(?date)" },
                { name: "MONTH", desc: "Extract month", example: "MONTH(?date)" },
            ];
            const currentToken = context.getCurrentToken().toUpperCase();
            const suggestions = functions
                .filter((fn) => !currentToken || fn.name.startsWith(currentToken))
                .map((fn) => SPARQLSuggestion_1.SPARQLSuggestion.create({
                id: `function_${fn.name.toLowerCase()}`,
                text: fn.name,
                insertText: fn.name + "(",
                type: SPARQLSuggestion_1.SuggestionType.FUNCTION,
                confidence: 0.8,
                contextualScore: context.isInClause(QueryContext_1.ClauseType.FILTER) ? 0.9 : 0.6,
                metadata: {
                    description: fn.desc,
                    examples: [fn.example],
                },
            }));
            return Result_1.Result.ok(suggestions);
        }
        catch (error) {
            return Result_1.Result.fail(`Failed to get function suggestions: ${error}`);
        }
    }
    async findTemplateSuggestions(context) {
        try {
            const templates = [
                {
                    name: "Basic SELECT Query",
                    template: "SELECT ?subject ?predicate ?object\nWHERE {\n  ?subject ?predicate ?object .\n}\nLIMIT 100",
                    description: "Simple triple pattern query",
                },
                {
                    name: "Find All Classes",
                    template: "SELECT DISTINCT ?class\nWHERE {\n  ?instance rdf:type ?class .\n}\nORDER BY ?class",
                    description: "List all classes in the graph",
                },
                {
                    name: "Find All Properties",
                    template: "SELECT DISTINCT ?property\nWHERE {\n  ?subject ?property ?object .\n}\nORDER BY ?property",
                    description: "List all properties used in the graph",
                },
                {
                    name: "Get Class Instances",
                    template: "SELECT ?instance ?label\nWHERE {\n  ?instance rdf:type <ClassURI> .\n  OPTIONAL { ?instance rdfs:label ?label }\n}",
                    description: "Find all instances of a specific class",
                },
                {
                    name: "Count by Type",
                    template: "SELECT ?type (COUNT(?instance) AS ?count)\nWHERE {\n  ?instance rdf:type ?type .\n}\nGROUP BY ?type\nORDER BY DESC(?count)",
                    description: "Count instances per class",
                },
                {
                    name: "Search by Label",
                    template: 'SELECT ?resource ?label\nWHERE {\n  ?resource rdfs:label ?label .\n  FILTER(CONTAINS(LCASE(?label), "search term"))\n}',
                    description: "Find resources by label text",
                },
            ];
            const suggestions = templates.map((template, index) => SPARQLSuggestion_1.SPARQLSuggestion.create({
                id: `template_${index}`,
                text: template.name,
                insertText: template.template,
                type: SPARQLSuggestion_1.SuggestionType.TEMPLATE,
                confidence: 0.75,
                contextualScore: context.isStartOfQuery() ? 0.9 : 0.3,
                metadata: {
                    description: template.description,
                    documentation: "Query template - customize as needed",
                },
            }));
            return Result_1.Result.ok(suggestions);
        }
        catch (error) {
            return Result_1.Result.fail(`Failed to get template suggestions: ${error}`);
        }
    }
    async updateUsageStatistics(suggestionId, selected) {
        try {
            if (!this.usageStats[suggestionId]) {
                this.usageStats[suggestionId] = { count: 0, lastUsed: 0 };
            }
            if (selected) {
                this.usageStats[suggestionId].count++;
                this.usageStats[suggestionId].lastUsed = Date.now();
            }
            return Result_1.Result.ok();
        }
        catch (error) {
            return Result_1.Result.fail(`Failed to update usage statistics: ${error}`);
        }
    }
    async getPopularSuggestions(limit) {
        try {
            const sortedIds = Object.entries(this.usageStats)
                .sort((a, b) => b[1].count - a[1].count)
                .slice(0, limit)
                .map(([id]) => id);
            // This would need to reconstruct suggestions from IDs
            // For now, return empty array
            return Result_1.Result.ok([]);
        }
        catch (error) {
            return Result_1.Result.fail(`Failed to get popular suggestions: ${error}`);
        }
    }
    extractPropertiesFromGraph() {
        const properties = new Map();
        try {
            // Use match with undefined to get all triples
            const triples = this.graph.match(undefined, undefined, undefined);
            for (const triple of triples) {
                const predicate = triple.getPredicate().toString();
                properties.set(predicate, (properties.get(predicate) || 0) + 1);
            }
        }
        catch (error) {
            console.warn("Failed to extract properties from graph:", error);
        }
        return Array.from(properties.entries())
            .map(([uri, frequency]) => ({ uri, frequency }))
            .sort((a, b) => b.frequency - a.frequency);
    }
    extractClassesFromGraph() {
        const classes = new Map();
        const rdfType = "http://www.w3.org/1999/02/22-rdf-syntax-ns#type";
        try {
            // Use match with undefined to get all triples
            const triples = this.graph.match(undefined, undefined, undefined);
            for (const triple of triples) {
                if (triple.getPredicate().toString() === rdfType) {
                    const classUri = triple.getObject().toString();
                    classes.set(classUri, (classes.get(classUri) || 0) + 1);
                }
            }
        }
        catch (error) {
            console.warn("Failed to extract classes from graph:", error);
        }
        return Array.from(classes.entries())
            .map(([uri, instanceCount]) => ({ uri, instanceCount }))
            .sort((a, b) => b.instanceCount - a.instanceCount);
    }
    createPropertySuggestion(property, context) {
        const shortName = this.getShortName(property.uri);
        const confidence = Math.min(0.9, 0.5 + property.frequency / 100);
        return SPARQLSuggestion_1.SPARQLSuggestion.create({
            id: `property_${property.uri}`,
            text: shortName,
            insertText: shortName,
            type: SPARQLSuggestion_1.SuggestionType.PROPERTY,
            confidence,
            contextualScore: context.isInClause(QueryContext_1.ClauseType.WHERE) ? 0.9 : 0.5,
            metadata: {
                description: `Property (used ${property.frequency} times)`,
                namespace: property.uri,
            },
        });
    }
    createClassSuggestion(cls, context) {
        const shortName = this.getShortName(cls.uri);
        const confidence = Math.min(0.9, 0.5 + cls.instanceCount / 50);
        return SPARQLSuggestion_1.SPARQLSuggestion.create({
            id: `class_${cls.uri}`,
            text: shortName,
            insertText: shortName,
            type: SPARQLSuggestion_1.SuggestionType.CLASS,
            confidence,
            contextualScore: this.isAfterRdfType(context) ? 0.95 : 0.6,
            metadata: {
                description: `Class (${cls.instanceCount} instances)`,
                namespace: cls.uri,
            },
        });
    }
    getShortName(uri) {
        const hashIndex = uri.lastIndexOf("#");
        const slashIndex = uri.lastIndexOf("/");
        const splitIndex = Math.max(hashIndex, slashIndex);
        if (splitIndex > 0 && splitIndex < uri.length - 1) {
            return uri.substring(splitIndex + 1);
        }
        return uri;
    }
    isAfterRdfType(context) {
        const previousTokens = context.getPreviousTokens();
        if (previousTokens.length < 2)
            return false;
        const lastTwo = previousTokens.slice(-2).join(" ").toLowerCase();
        return lastTwo.includes("rdf:type") || lastTwo.includes(" a ");
    }
    shouldRefreshCache() {
        return Date.now() - this.cacheTimestamp > this.cacheTTL;
    }
    refreshPropertyCache() {
        this.propertyCache.clear();
        this.cacheTimestamp = Date.now();
    }
    refreshClassCache() {
        this.classCache.clear();
        this.cacheTimestamp = Date.now();
    }
}
exports.GraphSuggestionRepository = GraphSuggestionRepository;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL2tpdGVsZXYvRG9jdW1lbnRzL2V4b2NvcnRleC1vYnNpZGlhbi1wbHVnaW4vc3JjL2luZnJhc3RydWN0dXJlL3JlcG9zaXRvcmllcy9HcmFwaFN1Z2dlc3Rpb25SZXBvc2l0b3J5LnRzIiwibWFwcGluZ3MiOiI7OztBQUNBLGlGQUdvRDtBQUNwRCx5RUFHZ0Q7QUFDaEQscURBQWtEO0FBRWxELHlGQUFzRjtBQVN0RixNQUFhLHlCQUF5QjtJQVFwQyxZQUE2QixLQUFZO1FBQVosVUFBSyxHQUFMLEtBQUssQ0FBTztRQVBqQyxvQkFBZSxHQUFHLElBQUkscURBQXlCLEVBQUUsQ0FBQztRQUNsRCxlQUFVLEdBQWUsRUFBRSxDQUFDO1FBQzVCLGtCQUFhLEdBQW9DLElBQUksR0FBRyxFQUFFLENBQUM7UUFDM0QsZUFBVSxHQUFvQyxJQUFJLEdBQUcsRUFBRSxDQUFDO1FBQ3hELG1CQUFjLEdBQUcsQ0FBQyxDQUFDO1FBQ1YsYUFBUSxHQUFHLEtBQUssQ0FBQyxDQUFDLFdBQVc7SUFFRixDQUFDO0lBRTdDLEtBQUssQ0FBQyxzQkFBc0IsQ0FDMUIsT0FBcUI7UUFFckIsSUFBSTtZQUNGLE1BQU0sV0FBVyxHQUFHLElBQUksQ0FBQyxlQUFlLENBQUMsY0FBYyxDQUFDLE9BQU8sQ0FBQyxDQUFDO1lBQ2pFLE9BQU8sZUFBTSxDQUFDLEVBQUUsQ0FBQyxXQUFXLENBQUMsQ0FBQztTQUMvQjtRQUFDLE9BQU8sS0FBSyxFQUFFO1lBQ2QsT0FBTyxlQUFNLENBQUMsSUFBSSxDQUFDLHNDQUFzQyxLQUFLLEVBQUUsQ0FBQyxDQUFDO1NBQ25FO0lBQ0gsQ0FBQztJQUVELEtBQUssQ0FBQyx1QkFBdUIsQ0FDM0IsT0FBcUI7UUFFckIsSUFBSTtZQUNGLElBQUksSUFBSSxDQUFDLGtCQUFrQixFQUFFLEVBQUU7Z0JBQzdCLElBQUksQ0FBQyxvQkFBb0IsRUFBRSxDQUFDO2FBQzdCO1lBRUQsTUFBTSxpQkFBaUIsR0FBRyxJQUFJLENBQUMsYUFBYSxDQUFDLEdBQUcsQ0FDOUMsT0FBTyxDQUFD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LE1BQU0sR0FBRyxDQUFDLEVBQUU7WUFDakQsT0FBTyxHQUFHLENBQUMsU0FBUyxDQUFDLFVBQVUsR0FBRyxDQUFDLENBQUMsQ0FBQztTQUN0QztRQUVELE9BQU8sR0FBRyxDQUFDO0lBQ2IsQ0FBQztJQUVPLGNBQWMsQ0FBQyxPQUFxQjtRQUMxQyxNQUFNLGNBQWMsR0FBRyxPQUFPLENBQUMsaUJBQWlCLEVBQUUsQ0FBQztRQUNuRCxJQUFJLGNBQWMsQ0FBQyxNQUFNLEdBQUcsQ0FBQztZQUFFLE9BQU8sS0FBSyxDQUFDO1FBRTVDLE1BQU0sT0FBTyxHQUFHLGNBQWMsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUMsV0FBVyxFQUFFLENBQUM7UUFDakUsT0FBTyxPQUFPLENBQUMsUUFBUSxDQUFDLFVBQVUsQ0FBQyxJQUFJLE9BQU8sQ0FBQyxRQUFRLENBQUMsS0FBSyxDQUFDLENBQUM7SUFDakUsQ0FBQztJQUVPLGtCQUFrQjtRQUN4QixPQUFPLElBQUksQ0FBQyxHQUFHLEVBQUUsR0FBRyxJQUFJLENBQUMsY0FBYyxHQUFHLElBQUksQ0FBQyxRQUFRLENBQUM7SUFDMUQsQ0FBQztJQUVPLG9CQUFvQjtRQUMxQixJQUFJLENBQUMsYUFBYSxDQUFDLEtBQUssRUFBRSxDQUFDO1FBQzNCLElBQUksQ0FBQyxjQUFjLEdBQUcsSUFBSSxDQUFDLEdBQUcsRUFBRSxDQUFDO0lBQ25DLENBQUM7SUFFTyxpQkFBaUI7UUFDdkIsSUFBSSxDQUFDLFVBQVUsQ0FBQyxLQUFLLEVBQUUsQ0FBQztRQUN4QixJQUFJLENBQUMsY0FBYyxHQUFHLElBQUksQ0FBQyxHQUFHLEVBQUUsQ0FBQztJQUNuQyxDQUFDO0NBQ0Y7QUFyZUQsOERBcWVDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIi9Vc2Vycy9raXRlbGV2L0RvY3VtZW50cy9leG9jb3J0ZXgtb2JzaWRpYW4tcGx1Z2luL3NyYy9pbmZyYXN0cnVjdHVyZS9yZXBvc2l0b3JpZXMvR3JhcGhTdWdnZXN0aW9uUmVwb3NpdG9yeS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBJU3VnZ2VzdGlvblJlcG9zaXRvcnkgfSBmcm9tIFwiLi4vLi4vZG9tYWluL3JlcG9zaXRvcmllcy9JU3VnZ2VzdGlvblJlcG9zaXRvcnlcIjtcbmltcG9ydCB7XG4gIFNQQVJRTFN1Z2dlc3Rpb24sXG4gIFN1Z2dlc3Rpb25UeXBlLFxufSBmcm9tIFwiLi4vLi4vZG9tYWluL2F1dG9jb21wbGV0ZS9TUEFSUUxTdWdnZXN0aW9uXCI7XG5pbXBvcnQge1xuICBRdWVyeUNvbnRleHQsXG4gIENsYXVzZVR5cGUsXG59IGZyb20gXCIuLi8uLi9kb21haW4vYXV0b2NvbXBsZXRlL1F1ZXJ5Q29udGV4dFwiO1xuaW1wb3J0IHsgUmVzdWx0IH0gZnJvbSBcIi4uLy4uL2RvbWFpbi9jb3JlL1Jlc3VsdFwiO1xuaW1wb3J0IHsgR3JhcGggfSBmcm9tIFwiLi4vLi4vZG9tYWluL3NlbWFudGljL2NvcmUvR3JhcGhcIjtcbmltcG9ydCB7IEtleXdvcmRTdWdnZXN0aW9uUHJvdmlkZXIgfSBmcm9tIFwiLi4vYXV0b2NvbXBsZXRlL0tleXdvcmRTdWdnZXN0aW9uUHJvdmlkZXJcIjtcblxuaW50ZXJmYWNlIFVzYWdlU3RhdHMge1xuICBba2V5OiBzdHJpbmddOiB7XG4gICAgY291bnQ6IG51bWJlcjtcbiAgICBsYXN0VXNlZDogbnVtYmVyO1xuICB9O1xufVxuXG5leHBvcnQgY2xhc3MgR3JhcGhTdWdnZXN0aW9uUmVwb3NpdG9yeSBpbXBsZW1lbnRzIElTdWdnZXN0aW9uUmVwb3NpdG9yeSB7XG4gIHByaXZhdGUga2V5d29yZFByb3ZpZGVyID0gbmV3IEtleXdvcmRTdWdnZXN0aW9uUHJvdmlkZXIoKTtcbiAgcHJpdmF0ZSB1c2FnZVN0YXRzOiBVc2FnZVN0YXRzID0ge307XG4gIHByaXZhdGUgcHJvcGVydHlDYWNoZTogTWFwPHN0cmluZywgU1BBUlFMU3VnZ2VzdGlvbltdPiA9IG5ldyBNYXAoKTtcbiAgcHJpdmF0ZSBjbGFzc0NhY2hlOiBNYXA8c3RyaW5nLCBTUEFSUUxTdWdnZXN0aW9uW10+ID0gbmV3IE1hcCgpO1xuICBwcml2YXRlIGNhY2hlVGltZXN0YW1wID0gMDtcbiAgcHJpdmF0ZSByZWFkb25seSBjYWNoZVRUTCA9IDYwMDAwOyAvLyAxIG1pbnV0ZVxuXG4gIGNvbnN0cnVjdG9yKHByaXZhdGUgcmVhZG9ubHkgZ3JhcGg6IEdyYXBoKSB7fVxuXG4gIGFzeW5jIGZpbmRLZXl3b3JkU3VnZ2VzdGlvbnMoXG4gICAgY29udGV4dDogUXVlcnlDb250ZXh0LFxuICApOiBQcm9taXNlPFJlc3VsdDxTUEFSUUxTdWdnZXN0aW9uW10+PiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHN1Z2dlc3Rpb25zID0gdGhpcy5rZXl3b3JkUHJvdmlkZXIuZ2V0U3VnZ2VzdGlvbnMoY29udGV4dCk7XG4gICAgICByZXR1cm4gUmVzdWx0Lm9rKHN1Z2dlc3Rpb25zKTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgcmV0dXJuIFJlc3VsdC5mYWlsKGBGYWlsZWQgdG8gZ2V0IGtleXdvcmQgc3VnZ2VzdGlvbnM6ICR7ZXJyb3J9YCk7XG4gICAgfVxuICB9XG5cbiAgYXN5bmMgZmluZFByb3BlcnR5U3VnZ2VzdGlvbnMoXG4gICAgY29udGV4dDogUXVlcnlDb250ZXh0LFxuICApOiBQcm9taXNlPFJlc3VsdDxTUEFSUUxTdWdnZXN0aW9uW10+PiB7XG4gICAgdHJ5IHtcbiAgICAgIGlmICh0aGlzLnNob3VsZFJlZnJlc2hDYWNoZSgpKSB7XG4gICAgICAgIHRoaXMucmVmcmVzaFByb3BlcnR5Q2FjaGUoKTtcbiAgICAgIH1cblxuICAgICAgY29uc3QgY2FjaGVkU3VnZ2VzdGlvbnMgPSB0aGlzLnByb3BlcnR5Q2FjaGUuZ2V0KFxuICAgICAgICBjb250ZXh0LmdldEN1cnJlbnRUb2tlbigpLFxuICAgICAgKTtcbiAgICAgIGlmIChjYWNoZWRTdWdnZXN0aW9ucykge1xuICAgICAgICByZXR1cm4gUmVzdWx0Lm9rKGNhY2hlZFN1Z2dlc3Rpb25zKTtcbiAgICAgIH1cblxuICAgICAgY29uc3QgcHJvcGVydGllcyA9IHRoaXMuZXh0cmFjdFByb3BlcnRpZXNGcm9tR3JhcGgoKTtcbiAgICAgIGNvbnN0IHN1Z2dlc3Rpb25zID0gcHJvcGVydGllcy5tYXAoKHByb3ApID0+XG4gICAgICAgIHRoaXMuY3JlYXRlUHJvcGVydHlTdWdnZXN0aW9uKHByb3AsIGNvbnRleHQpLFxuICAgICAgKTtcblxuICAgICAgdGhpcy5wcm9wZXJ0eUNhY2hlLnNldChjb250ZXh0LmdldEN1cnJlbnRUb2tlbigpLCBzdWdnZXN0aW9ucyk7XG4gICAgICByZXR1cm4gUmVzdWx0Lm9rKHN1Z2dlc3Rpb25zKTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgcmV0dXJuIFJlc3VsdC5mYWlsKGBGYWlsZWQgdG8gZ2V0IHByb3BlcnR5IHN1Z2dlc3Rpb25zOiAke2Vycm9yfWApO1xuICAgIH1cbiAgfVxuXG4gIGFzeW5jIGZpbmRDbGFzc1N1Z2dlc3Rpb25zKFxuICAgIGNvbnRleHQ6IFF1ZXJ5Q29udGV4dCxcbiAgKTogUHJvbWlzZTxSZXN1bHQ8U1BBUlFMU3VnZ2VzdGlvbltdPj4ge1xuICAgIHRyeSB7XG4gICAgICBpZiAodGhpcy5zaG91bGRSZWZyZXNoQ2FjaGUoKSkge1xuICAgICAgICB0aGlzLnJlZnJlc2hDbGFzc0NhY2hlKCk7XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IGNhY2hlZFN1Z2dlc3Rpb25zID0gdGhpcy5jbGFzc0NhY2hlLmdldChjb250ZXh0LmdldEN1cnJlbnRUb2tlbigpKTtcbiAgICAgIGlmIChjYWNoZWRTdWdnZXN0aW9ucykge1xuICAgICAgICByZXR1cm4gUmVzdWx0Lm9rKGNhY2hlZFN1Z2dlc3Rpb25zKTtcbiAgICAgIH1cblxuICAgICAgY29uc3QgY2xhc3NlcyA9IHRoaXMuZXh0cmFjdENsYXNzZXNGcm9tR3JhcGgoKTtcbiAgICAgIGNvbnN0IHN1Z2dlc3Rpb25zID0gY2xhc3Nlcy5tYXAoKGNscykgPT5cbiAgICAgICAgdGhpcy5jcmVhdGVDbGFzc1N1Z2dlc3Rpb24oY2xzLCBjb250ZXh0KSxcbiAgICAgICk7XG5cbiAgICAgIHRoaXMuY2xhc3NDYWNoZS5zZXQoY29udGV4dC5nZXRDdXJyZW50VG9rZW4oKSwgc3VnZ2VzdGlvbnMpO1xuICAgICAgcmV0dXJuIFJlc3VsdC5vayhzdWdnZXN0aW9ucyk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIHJldHVybiBSZXN1bHQuZmFpbChgRmFpbGVkIHRvIGdldCBjbGFzcyBzdWdnZXN0aW9uczogJHtlcnJvcn1gKTtcbiAgICB9XG4gIH1cblxuICBhc3luYyBmaW5kVmFyaWFibGVTdWdnZXN0aW9ucyhcbiAgICBjb250ZXh0OiBRdWVyeUNvbnRleHQsXG4gICk6IFByb21pc2U8UmVzdWx0PFNQQVJRTFN1Z2dlc3Rpb25bXT4+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3Qgc3VnZ2VzdGlvbnM6IFNQQVJRTFN1Z2dlc3Rpb25bXSA9IFtdO1xuICAgICAgY29uc3QgZXhpc3RpbmdWYXJpYWJsZXMgPSBjb250ZXh0LmdldFZhcmlhYmxlc0luU2NvcGUoKTtcbiAgICAgIGNvbnN0IGN1cnJlbnRUb2tlbiA9IGNvbnRleHQuZ2V0Q3VycmVudFRva2VuKCk7XG5cbiAgICAgIC8vIFN1Z2dlc3QgcmV1c2Ugb2YgZXhpc3RpbmcgdmFyaWFibGVzXG4gICAgICBmb3IgKGNvbnN0IHZhcmlhYmxlIG9mIGV4aXN0aW5nVmFyaWFibGVzKSB7XG4gICAgICAgIGNvbnN0IHZhck5hbWUgPSBgPyR7dmFyaWFibGV9YDtcbiAgICAgICAgaWYgKCFjdXJyZW50VG9rZW4gfHwgdmFyTmFtZS5zdGFydHNXaXRoKGN1cnJlbnRUb2tlbikpIHtcbiAgICAgICAgICBzdWdnZXN0aW9ucy5wdXNoKFxuICAgICAgICAgICAgU1BBUlFMU3VnZ2VzdGlvbi5jcmVhdGUoe1xuICAgICAgICAgICAgICBpZDogYHZhcl9leGlzdGluZ18ke3ZhcmlhYmxlfWAsXG4gICAgICAgICAgICAgIHRleHQ6IHZhck5hbWUsXG4gICAgICAgICAgICAgIGluc2VydFRleHQ6IHZhck5hbWUsXG4gICAgICAgICAgICAgIHR5cGU6IFN1Z2dlc3Rpb25UeXBlLlZBUklBQkxFLFxuICAgICAgICAgICAgICBjb25maWRlbmNlOiAwLjksXG4gICAgICAgICAgICAgIGNvbnRleHR1YWxTY29yZTogMC45NSxcbiAgICAgICAgICAgICAgbWV0YWRhdGE6IHtcbiAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbjogXCJFeGlzdGluZyB2YXJpYWJsZSBpbiBxdWVyeVwiLFxuICAgICAgICAgICAgICAgIHVzYWdlOiBcIlJldXNlIHRoaXMgdmFyaWFibGUgdG8gam9pbiBwYXR0ZXJuc1wiLFxuICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgfSksXG4gICAgICAgICAgKTtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICAvLyBTdWdnZXN0IGNvbW1vbiB2YXJpYWJsZSBuYW1lc1xuICAgICAgY29uc3QgY29tbW9uVmFyaWFibGVzID0gW1xuICAgICAgICB7IG5hbWU6IFwic3ViamVjdFwiLCBkZXNjOiBcIlN1YmplY3Qgb2YgYSB0cmlwbGVcIiB9LFxuICAgICAgICB7IG5hbWU6IFwicHJlZGljYXRlXCIsIGRlc2M6IFwiUHJlZGljYXRlL3Byb3BlcnR5XCIgfSxcbiAgICAgICAgeyBuYW1lOiBcIm9iamVjdFwiLCBkZXNjOiBcIk9iamVjdCB2YWx1ZVwiIH0sXG4gICAgICAgIHsgbmFtZTogXCJ0eXBlXCIsIGRlc2M6IFwiUkRGIHR5cGUvY2xhc3NcIiB9LFxuICAgICAgICB7IG5hbWU6IFwibGFiZWxcIiwgZGVzYzogXCJIdW1hbi1yZWFkYWJsZSBsYWJlbFwiIH0sXG4gICAgICAgIHsgbmFtZTogXCJ2YWx1ZVwiLCBkZXNjOiBcIkdlbmVyaWMgdmFsdWVcIiB9LFxuICAgICAgICB7IG5hbWU6IFwibmFtZVwiLCBkZXNjOiBcIk5hbWUgcHJvcGVydHlcIiB9LFxuICAgICAgICB7IG5hbWU6IFwiaWRcIiwgZGVzYzogXCJJZGVudGlmaWVyXCIgfSxcbiAgICAgICAgeyBuYW1lOiBcImRhdGVcIiwgZGVzYzogXCJEYXRlL3RpbWUgdmFsdWVcIiB9LFxuICAgICAgICB7IG5hbWU6IFwiY291bnRcIiwgZGVzYzogXCJDb3VudCBhZ2dyZWdhdGVcIiB9LFxuICAgICAgXTtcblxuICAgICAgZm9yIChjb25zdCB7IG5hbWUsIGRlc2MgfSBvZiBjb21tb25WYXJpYWJsZXMpIHtcbiAgICAgICAgY29uc3QgdmFyTmFtZSA9IGA/JHtuYW1lfWA7XG4gICAgICAgIGlmIChcbiAgICAgICAgICAhZXhpc3RpbmdWYXJpYWJsZXMuaW5jbHVkZXMobmFtZSkgJiZcbiAgICAgICAgICAoIWN1cnJlbnRUb2tlbiB8fCB2YXJOYW1lLnN0YXJ0c1dpdGgoY3VycmVudFRva2VuKSlcbiAgICAgICAgKSB7XG4gICAgICAgICAgc3VnZ2VzdGlvbnMucHVzaChcbiAgICAgICAgICAgIFNQQVJRTFN1Z2dlc3Rpb24uY3JlYXRlKHtcbiAgICAgICAgICAgICAgaWQ6IGB2YXJfY29tbW9uXyR7bmFtZX1gLFxuICAgICAgICAgICAgICB0ZXh0OiB2YXJOYW1lLFxuICAgICAgICAgICAgICBpbnNlcnRUZXh0OiB2YXJOYW1lLFxuICAgICAgICAgICAgICB0eXBlOiBTdWdnZXN0aW9uVHlwZS5WQVJJQUJMRSxcbiAgICAgICAgICAgICAgY29uZmlkZW5jZTogMC43LFxuICAgICAgICAgICAgICBjb250ZXh0dWFsU2NvcmU6IDAuNixcbiAgICAgICAgICAgICAgbWV0YWRhdGE6IHtcbiAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbjogZGVzYyxcbiAgICAgICAgICAgICAgICB1c2FnZTogYENvbW1vbiB2YXJpYWJsZSBuYW1lIGZvciAke2Rlc2MudG9Mb3dlckNhc2UoKX1gLFxuICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgfSksXG4gICAgICAgICAgKTtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICByZXR1cm4gUmVzdWx0Lm9rKHN1Z2dlc3Rpb25zKTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgcmV0dXJuIFJlc3VsdC5mYWlsKGBGYWlsZWQgdG8gZ2V0IHZhcmlhYmxlIHN1Z2dlc3Rpb25zOiAke2Vycm9yfWApO1xuICAgIH1cbiAgfVxuXG4gIGFzeW5jIGZpbmROYW1lc3BhY2VTdWdnZXN0aW9ucyhcbiAgICBjb250ZXh0OiBRdWVyeUNvbnRleHQsXG4gICk6IFByb21pc2U8UmVzdWx0PFNQQVJRTFN1Z2dlc3Rpb25bXT4+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgbmFtZXNwYWNlcyA9IFtcbiAgICAgICAgeyBwcmVmaXg6IFwicmRmOlwiLCB1cmk6IFwiaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zI1wiIH0sXG4gICAgICAgIHsgcHJlZml4OiBcInJkZnM6XCIsIHVyaTogXCJodHRwOi8vd3d3LnczLm9yZy8yMDAwLzAxL3JkZi1zY2hlbWEjXCIgfSxcbiAgICAgICAgeyBwcmVmaXg6IFwib3dsOlwiLCB1cmk6IFwiaHR0cDovL3d3dy53My5vcmcvMjAwMi8wNy9vd2wjXCIgfSxcbiAgICAgICAgeyBwcmVmaXg6IFwieHNkOlwiLCB1cmk6IFwiaHR0cDovL3d3dy53My5vcmcvMjAwMS9YTUxTY2hlbWEjXCIgfSxcbiAgICAgICAgeyBwcmVmaXg6IFwic2tvczpcIiwgdXJpOiBcImh0dHA6Ly93d3cudzMub3JnLzIwMDQvMDIvc2tvcy9jb3JlI1wiIH0sXG4gICAgICAgIHsgcHJlZml4OiBcImZvYWY6XCIsIHVyaTogXCJodHRwOi8veG1sbnMuY29tL2ZvYWYvMC4xL1wiIH0sXG4gICAgICAgIHsgcHJlZml4OiBcImRjOlwiLCB1cmk6IFwiaHR0cDovL3B1cmwub3JnL2RjL2VsZW1lbnRzLzEuMS9cIiB9LFxuICAgICAgICB7IHByZWZpeDogXCJleG86XCIsIHVyaTogXCJodHRwOi8vZXhhbXBsZS5vcmcvZXhvY29ydGV4I1wiIH0sXG4gICAgICBdO1xuXG4gICAgICBjb25zdCBzdWdnZXN0aW9ucyA9IG5hbWVzcGFjZXNcbiAgICAgICAgLmZpbHRlcihcbiAgICAgICAgICAobnMpID0+XG4gICAgICAgICAgICAhY29udGV4dC5nZXRDdXJyZW50VG9rZW4oKSB8fFxuICAgICAgICAgICAgbnMucHJlZml4LnN0YXJ0c1dpdGgoY29udGV4dC5nZXRDdXJyZW50VG9rZW4oKSksXG4gICAgICAgIClcbiAgICAgICAgLm1hcCgobnMpID0+XG4gICAgICAgICAgU1BBUlFMU3VnZ2VzdGlvbi5jcmVhdGUoe1xuICAgICAgICAgICAgaWQ6IGBuYW1lc3BhY2VfJHtucy5wcmVmaXh9YCxcbiAgICAgICAgICAgIHRleHQ6IG5zLnByZWZpeCxcbiAgICAgICAgICAgIGluc2VydFRleHQ6IGBQUkVGSVggJHtucy5wcmVmaXh9IDwke25zLnVyaX0+YCxcbiAgICAgICAgICAgIHR5cGU6IFN1Z2dlc3Rpb25UeXBlLk5BTUVTUEFDRSxcbiAgICAgICAgICAgIGNvbmZpZGVuY2U6IDAuODUsXG4gICAgICAgICAgICBjb250ZXh0dWFsU2NvcmU6IDAuOCxcbiAgICAgICAgICAgIG1ldGFkYXRhOiB7XG4gICAgICAgICAgICAgIGRlc2NyaXB0aW9uOiBgTmFtZXNwYWNlOiAke25zLnVyaX1gLFxuICAgICAgICAgICAgICBuYW1lc3BhY2U6IG5zLnVyaSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgfSksXG4gICAgICAgICk7XG5cbiAgICAgIHJldHVybiBSZXN1bHQub2soc3VnZ2VzdGlvbnMpO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICByZXR1cm4gUmVzdWx0LmZhaWwoYEZhaWxlZCB0byBnZXQgbmFtZXNwYWNlIHN1Z2dlc3Rpb25zOiAke2Vycm9yfWApO1xuICAgIH1cbiAgfVxuXG4gIGFzeW5jIGZpbmRGdW5jdGlvblN1Z2dlc3Rpb25zKFxuICAgIGNvbnRleHQ6IFF1ZXJ5Q29udGV4dCxcbiAgKTogUHJvbWlzZTxSZXN1bHQ8U1BBUlFMU3VnZ2VzdGlvbltdPj4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBmdW5jdGlvbnMgPSBbXG4gICAgICAgIHsgbmFtZTogXCJTVFJcIiwgZGVzYzogXCJDb252ZXJ0IHRvIHN0cmluZ1wiLCBleGFtcGxlOiBcIlNUUig/dmFsdWUpXCIgfSxcbiAgICAgICAgeyBuYW1lOiBcIkxBTkdcIiwgZGVzYzogXCJHZXQgbGFuZ3VhZ2UgdGFnXCIsIGV4YW1wbGU6IFwiTEFORyg/bGFiZWwpXCIgfSxcbiAgICAgICAge1xuICAgICAgICAgIG5hbWU6IFwiREFUQVRZUEVcIixcbiAgICAgICAgICBkZXNjOiBcIkdldCBkYXRhdHlwZSBJUklcIixcbiAgICAgICAgICBleGFtcGxlOiBcIkRBVEFUWVBFKD9saXRlcmFsKVwiLFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgbmFtZTogXCJCT1VORFwiLFxuICAgICAgICAgIGRlc2M6IFwiVGVzdCBpZiB2YXJpYWJsZSBpcyBib3VuZFwiLFxuICAgICAgICAgIGV4YW1wbGU6IFwiQk9VTkQoP3ZhcilcIixcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgIG5hbWU6IFwiUkVHRVhcIixcbiAgICAgICAgICBkZXNjOiBcIlJlZ3VsYXIgZXhwcmVzc2lvbiBtYXRjaFwiLFxuICAgICAgICAgIGV4YW1wbGU6ICdSRUdFWCg/dGV4dCwgXCJwYXR0ZXJuXCIpJyxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgIG5hbWU6IFwiQ09OVEFJTlNcIixcbiAgICAgICAgICBkZXNjOiBcIlN0cmluZyBjb250YWluc1wiLFxuICAgICAgICAgIGV4YW1wbGU6ICdDT05UQUlOUyg/c3RyLCBcInN1YnN0cmluZ1wiKScsXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICBuYW1lOiBcIlNUUlNUQVJUU1wiLFxuICAgICAgICAgIGRlc2M6IFwiU3RyaW5nIHN0YXJ0cyB3aXRoXCIsXG4gICAgICAgICAgZXhhbXBsZTogJ1NUUlNUQVJUUyg/c3RyLCBcInByZWZpeFwiKScsXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICBuYW1lOiBcIlNUUkVORFNcIixcbiAgICAgICAgICBkZXNjOiBcIlN0cmluZyBlbmRzIHdpdGhcIixcbiAgICAgICAgICBleGFtcGxlOiAnU1RSRU5EUyg/c3RyLCBcInN1ZmZpeFwiKScsXG4gICAgICAgIH0sXG4gICAgICAgIHsgbmFtZTogXCJTVFJMRU5cIiwgZGVzYzogXCJTdHJpbmcgbGVuZ3RoXCIsIGV4YW1wbGU6IFwiU1RSTEVOKD9zdHIpXCIgfSxcbiAgICAgICAgeyBuYW1lOiBcIlNVQlNUUlwiLCBkZXNjOiBcIlN1YnN0cmluZ1wiLCBleGFtcGxlOiBcIlNVQlNUUig/c3RyLCAxLCAxMClcIiB9LFxuICAgICAgICB7IG5hbWU6IFwiVUNBU0VcIiwgZGVzYzogXCJDb252ZXJ0IHRvIHVwcGVyY2FzZVwiLCBleGFtcGxlOiBcIlVDQVNFKD9zdHIpXCIgfSxcbiAgICAgICAgeyBuYW1lOiBcIkxDQVNFXCIsIGRlc2M6IFwiQ29udmVydCB0byBsb3dlcmNhc2VcIiwgZXhhbXBsZTogXCJMQ0FTRSg/c3RyKVwiIH0sXG4gICAgICAgIHsgbmFtZTogXCJDT1VOVFwiLCBkZXNjOiBcIkNvdW50IGFnZ3JlZ2F0ZVwiLCBleGFtcGxlOiBcIkNPVU5UKD9pdGVtKVwiIH0sXG4gICAgICAgIHsgbmFtZTogXCJTVU1cIiwgZGVzYzogXCJTdW0gYWdncmVnYXRlXCIsIGV4YW1wbGU6IFwiU1VNKD92YWx1ZSlcIiB9LFxuICAgICAgICB7IG5hbWU6IFwiQVZHXCIsIGRlc2M6IFwiQXZlcmFnZSBhZ2dyZWdhdGVcIiwgZXhhbXBsZTogXCJBVkcoP3ZhbHVlKVwiIH0sXG4gICAgICAgIHsgbmFtZTogXCJNSU5cIiwgZGVzYzogXCJNaW5pbXVtIHZhbHVlXCIsIGV4YW1wbGU6IFwiTUlOKD92YWx1ZSlcIiB9LFxuICAgICAgICB7IG5hbWU6IFwiTUFYXCIsIGRlc2M6IFwiTWF4aW11bSB2YWx1ZVwiLCBleGFtcGxlOiBcIk1BWCg/dmFsdWUpXCIgfSxcbiAgICAgICAgeyBuYW1lOiBcIk5PV1wiLCBkZXNjOiBcIkN1cnJlbnQgZGF0ZS90aW1lXCIsIGV4YW1wbGU6IFwiTk9XKClcIiB9LFxuICAgICAgICB7IG5hbWU6IFwiWUVBUlwiLCBkZXNjOiBcIkV4dHJhY3QgeWVhclwiLCBleGFtcGxlOiBcIllFQVIoP2RhdGUpXCIgfSxcbiAgICAgICAgeyBuYW1lOiBcIk1PTlRIXCIsIGRlc2M6IFwiRXh0cmFjdCBtb250aFwiLCBleGFtcGxlOiBcIk1PTlRIKD9kYXRlKVwiIH0sXG4gICAgICBdO1xuXG4gICAgICBjb25zdCBjdXJyZW50VG9rZW4gPSBjb250ZXh0LmdldEN1cnJlbnRUb2tlbigpLnRvVXBwZXJDYXNlKCk7XG4gICAgICBjb25zdCBzdWdnZXN0aW9ucyA9IGZ1bmN0aW9uc1xuICAgICAgICAuZmlsdGVyKChmbikgPT4gIWN1cnJlbnRUb2tlbiB8fCBmbi5uYW1lLnN0YXJ0c1dpdGgoY3VycmVudFRva2VuKSlcbiAgICAgICAgLm1hcCgoZm4pID0+XG4gICAgICAgICAgU1BBUlFMU3VnZ2VzdGlvbi5jcmVhdGUoe1xuICAgICAgICAgICAgaWQ6IGBmdW5jdGlvbl8ke2ZuLm5hbWUudG9Mb3dlckNhc2UoKX1gLFxuICAgICAgICAgICAgdGV4dDogZm4ubmFtZSxcbiAgICAgICAgICAgIGluc2VydFRleHQ6IGZuLm5hbWUgKyBcIihcIixcbiAgICAgICAgICAgIHR5cGU6IFN1Z2dlc3Rpb25UeXBlLkZVTkNUSU9OLFxuICAgICAgICAgICAgY29uZmlkZW5jZTogMC44LFxuICAgICAgICAgICAgY29udGV4dHVhbFNjb3JlOiBjb250ZXh0LmlzSW5DbGF1c2UoQ2xhdXNlVHlwZS5GSUxURVIpID8gMC45IDogMC42LFxuICAgICAgICAgICAgbWV0YWRhdGE6IHtcbiAgICAgICAgICAgICAgZGVzY3JpcHRpb246IGZuLmRlc2MsXG4gICAgICAgICAgICAgIGV4YW1wbGVzOiBbZm4uZXhhbXBsZV0sXG4gICAgICAgICAgICB9LFxuICAgICAgICAgIH0pLFxuICAgICAgICApO1xuXG4gICAgICByZXR1cm4gUmVzdWx0Lm9rKHN1Z2dlc3Rpb25zKTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgcmV0dXJuIFJlc3VsdC5mYWlsKGBGYWlsZWQgdG8gZ2V0IGZ1bmN0aW9uIHN1Z2dlc3Rpb25zOiAke2Vycm9yfWApO1xuICAgIH1cbiAgfVxuXG4gIGFzeW5jIGZpbmRUZW1wbGF0ZVN1Z2dlc3Rpb25zKFxuICAgIGNvbnRleHQ6IFF1ZXJ5Q29udGV4dCxcbiAgKTogUHJvbWlzZTxSZXN1bHQ8U1BBUlFMU3VnZ2VzdGlvbltdPj4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCB0ZW1wbGF0ZXMgPSBbXG4gICAgICAgIHtcbiAgICAgICAgICBuYW1lOiBcIkJhc2ljIFNFTEVDVCBRdWVyeVwiLFxuICAgICAgICAgIHRlbXBsYXRlOlxuICAgICAgICAgICAgXCJTRUxFQ1QgP3N1YmplY3QgP3ByZWRpY2F0ZSA/b2JqZWN0XFxuV0hFUkUge1xcbiAgP3N1YmplY3QgP3ByZWRpY2F0ZSA/b2JqZWN0IC5cXG59XFxuTElNSVQgMTAwXCIsXG4gICAgICAgICAgZGVzY3JpcHRpb246IFwiU2ltcGxlIHRyaXBsZSBwYXR0ZXJuIHF1ZXJ5XCIsXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICBuYW1lOiBcIkZpbmQgQWxsIENsYXNzZXNcIixcbiAgICAgICAgICB0ZW1wbGF0ZTpcbiAgICAgICAgICAgIFwiU0VMRUNUIERJU1RJTkNUID9jbGFzc1xcbldIRVJFIHtcXG4gID9pbnN0YW5jZSByZGY6dHlwZSA/Y2xhc3MgLlxcbn1cXG5PUkRFUiBCWSA/Y2xhc3NcIixcbiAgICAgICAgICBkZXNjcmlwdGlvbjogXCJMaXN0IGFsbCBjbGFzc2VzIGluIHRoZSBncmFwaFwiLFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgbmFtZTogXCJGaW5kIEFsbCBQcm9wZXJ0aWVzXCIsXG4gICAgICAgICAgdGVtcGxhdGU6XG4gICAgICAgICAgICBcIlNFTEVDVCBESVNUSU5DVCA/cHJvcGVydHlcXG5XSEVSRSB7XFxuICA/c3ViamVjdCA/cHJvcGVydHkgP29iamVjdCAuXFxufVxcbk9SREVSIEJZID9wcm9wZXJ0eVwiLFxuICAgICAgICAgIGRlc2NyaXB0aW9uOiBcIkxpc3QgYWxsIHByb3BlcnRpZXMgdXNlZCBpbiB0aGUgZ3JhcGhcIixcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgIG5hbWU6IFwiR2V0IENsYXNzIEluc3RhbmNlc1wiLFxuICAgICAgICAgIHRlbXBsYXRlOlxuICAgICAgICAgICAgXCJTRUxFQ1QgP2luc3RhbmNlID9sYWJlbFxcbldIRVJFIHtcXG4gID9pbnN0YW5jZSByZGY6dHlwZSA8Q2xhc3NVUkk+IC5cXG4gIE9QVElPTkFMIHsgP2luc3RhbmNlIHJkZnM6bGFiZWwgP2xhYmVsIH1cXG59XCIsXG4gICAgICAgICAgZGVzY3JpcHRpb246IFwiRmluZCBhbGwgaW5zdGFuY2VzIG9mIGEgc3BlY2lmaWMgY2xhc3NcIixcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgIG5hbWU6IFwiQ291bnQgYnkgVHlwZVwiLFxuICAgICAgICAgIHRlbXBsYXRlOlxuICAgICAgICAgICAgXCJTRUxFQ1QgP3R5cGUgKENPVU5UKD9pbnN0YW5jZSkgQVMgP2NvdW50KVxcbldIRVJFIHtcXG4gID9pbnN0YW5jZSByZGY6dHlwZSA/dHlwZSAuXFxufVxcbkdST1VQIEJZID90eXBlXFxuT1JERVIgQlkgREVTQyg/Y291bnQpXCIsXG4gICAgICAgICAgZGVzY3JpcHRpb246IFwiQ291bnQgaW5zdGFuY2VzIHBlciBjbGFzc1wiLFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgbmFtZTogXCJTZWFyY2ggYnkgTGFiZWxcIixcbiAgICAgICAgICB0ZW1wbGF0ZTpcbiAgICAgICAgICAgICdTRUxFQ1QgP3Jlc291cmNlID9sYWJlbFxcbldIRVJFIHtcXG4gID9yZXNvdXJjZSByZGZzOmxhYmVsID9sYWJlbCAuXFxuICBGSUxURVIoQ09OVEFJTlMoTENBU0UoP2xhYmVsKSwgXCJzZWFyY2ggdGVybVwiKSlcXG59JyxcbiAgICAgICAgICBkZXNjcmlwdGlvbjogXCJGaW5kIHJlc291cmNlcyBieSBsYWJlbCB0ZXh0XCIsXG4gICAgICAgIH0sXG4gICAgICBdO1xuXG4gICAgICBjb25zdCBzdWdnZXN0aW9ucyA9IHRlbXBsYXRlcy5tYXAoKHRlbXBsYXRlLCBpbmRleCkgPT5cbiAgICAgICAgU1BBUlFMU3VnZ2VzdGlvbi5jcmVhdGUoe1xuICAgICAgICAgIGlkOiBgdGVtcGxhdGVfJHtpbmRleH1gLFxuICAgICAgICAgIHRleHQ6IHRlbXBsYXRlLm5hbWUsXG4gICAgICAgICAgaW5zZXJ0VGV4dDogdGVtcGxhdGUudGVtcGxhdGUsXG4gICAgICAgICAgdHlwZTogU3VnZ2VzdGlvblR5cGUuVEVNUExBVEUsXG4gICAgICAgICAgY29uZmlkZW5jZTogMC43NSxcbiAgICAgICAgICBjb250ZXh0dWFsU2NvcmU6IGNvbnRleHQuaXNTdGFydE9mUXVlcnkoKSA/IDAuOSA6IDAuMyxcbiAgICAgICAgICBtZXRhZGF0YToge1xuICAgICAgICAgICAgZGVzY3JpcHRpb246IHRlbXBsYXRlLmRlc2NyaXB0aW9uLFxuICAgICAgICAgICAgZG9jdW1lbnRhdGlvbjogXCJRdWVyeSB0ZW1wbGF0ZSAtIGN1c3RvbWl6ZSBhcyBuZWVkZWRcIixcbiAgICAgICAgICB9LFxuICAgICAgICB9KSxcbiAgICAgICk7XG5cbiAgICAgIHJldHVybiBSZXN1bHQub2soc3VnZ2VzdGlvbnMpO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICByZXR1cm4gUmVzdWx0LmZhaWwoYEZhaWxlZCB0byBnZXQgdGVtcGxhdGUgc3VnZ2VzdGlvbnM6ICR7ZXJyb3J9YCk7XG4gICAgfVxuICB9XG5cbiAgYXN5bmMgdXBkYXRlVXNhZ2VTdGF0aXN0aWNzKFxuICAgIHN1Z2dlc3Rpb25JZDogc3RyaW5nLFxuICAgIHNlbGVjdGVkOiBib29sZWFuLFxuICApOiBQcm9taXNlPFJlc3VsdDx2b2lkPj4ge1xuICAgIHRyeSB7XG4gICAgICBpZiAoIXRoaXMudXNhZ2VTdGF0c1tzdWdnZXN0aW9uSWRdKSB7XG4gICAgICAgIHRoaXMudXNhZ2VTdGF0c1tzdWdnZXN0aW9uSWRdID0geyBjb3VudDogMCwgbGFzdFVzZWQ6IDAgfTtcbiAgICAgIH1cblxuICAgICAgaWYgKHNlbGVjdGVkKSB7XG4gICAgICAgIHRoaXMudXNhZ2VTdGF0c1tzdWdnZXN0aW9uSWRdLmNvdW50Kys7XG4gICAgICAgIHRoaXMudXNhZ2VTdGF0c1tzdWdnZXN0aW9uSWRdLmxhc3RVc2VkID0gRGF0ZS5ub3coKTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIFJlc3VsdC5vaygpO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICByZXR1cm4gUmVzdWx0LmZhaWwoYEZhaWxlZCB0byB1cGRhdGUgdXNhZ2Ugc3RhdGlzdGljczogJHtlcnJvcn1gKTtcbiAgICB9XG4gIH1cblxuICBhc3luYyBnZXRQb3B1bGFyU3VnZ2VzdGlvbnMoXG4gICAgbGltaXQ6IG51bWJlcixcbiAgKTogUHJvbWlzZTxSZXN1bHQ8U1BBUlFMU3VnZ2VzdGlvbltdPj4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBzb3J0ZWRJZHMgPSBPYmplY3QuZW50cmllcyh0aGlzLnVzYWdlU3RhdHMpXG4gICAgICAgIC5zb3J0KChhLCBiKSA9PiBiWzFdLmNvdW50IC0gYVsxXS5jb3VudClcbiAgICAgICAgLnNsaWNlKDAsIGxpbWl0KVxuICAgICAgICAubWFwKChbaWRdKSA9PiBpZCk7XG5cbiAgICAgIC8vIFRoaXMgd291bGQgbmVlZCB0byByZWNvbnN0cnVjdCBzdWdnZXN0aW9ucyBmcm9tIElEc1xuICAgICAgLy8gRm9yIG5vdywgcmV0dXJuIGVtcHR5IGFycmF5XG4gICAgICByZXR1cm4gUmVzdWx0Lm9rKFtdKTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgcmV0dXJuIFJlc3VsdC5mYWlsKGBGYWlsZWQgdG8gZ2V0IHBvcHVsYXIgc3VnZ2VzdGlvbnM6ICR7ZXJyb3J9YCk7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBleHRyYWN0UHJvcGVydGllc0Zyb21HcmFwaCgpOiBBcnJheTx7XG4gICAgdXJpOiBzdHJpbmc7XG4gICAgZnJlcXVlbmN5OiBudW1iZXI7XG4gIH0+IHtcbiAgICBjb25zdCBwcm9wZXJ0aWVzID0gbmV3IE1hcDxzdHJpbmcsIG51bWJlcj4oKTtcblxuICAgIHRyeSB7XG4gICAgICAvLyBVc2UgbWF0Y2ggd2l0aCB1bmRlZmluZWQgdG8gZ2V0IGFsbCB0cmlwbGVzXG4gICAgICBjb25zdCB0cmlwbGVzID0gdGhpcy5ncmFwaC5tYXRjaCh1bmRlZmluZWQsIHVuZGVmaW5lZCwgdW5kZWZpbmVkKTtcbiAgICAgIGZvciAoY29uc3QgdHJpcGxlIG9mIHRyaXBsZXMpIHtcbiAgICAgICAgY29uc3QgcHJlZGljYXRlID0gdHJpcGxlLmdldFByZWRpY2F0ZSgpLnRvU3RyaW5nKCk7XG4gICAgICAgIHByb3BlcnRpZXMuc2V0KHByZWRpY2F0ZSwgKHByb3BlcnRpZXMuZ2V0KHByZWRpY2F0ZSkgfHwgMCkgKyAxKTtcbiAgICAgIH1cbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS53YXJuKFwiRmFpbGVkIHRvIGV4dHJhY3QgcHJvcGVydGllcyBmcm9tIGdyYXBoOlwiLCBlcnJvcik7XG4gICAgfVxuXG4gICAgcmV0dXJuIEFycmF5LmZyb20ocHJvcGVydGllcy5lbnRyaWVzKCkpXG4gICAgICAubWFwKChbdXJpLCBmcmVxdWVuY3ldKSA9PiAoeyB1cmksIGZyZXF1ZW5jeSB9KSlcbiAgICAgIC5zb3J0KChhLCBiKSA9PiBiLmZyZXF1ZW5jeSAtIGEuZnJlcXVlbmN5KTtcbiAgfVxuXG4gIHByaXZhdGUgZXh0cmFjdENsYXNzZXNGcm9tR3JhcGgoKTogQXJyYXk8e1xuICAgIHVyaTogc3RyaW5nO1xuICAgIGluc3RhbmNlQ291bnQ6IG51bWJlcjtcbiAgfT4ge1xuICAgIGNvbnN0IGNsYXNzZXMgPSBuZXcgTWFwPHN0cmluZywgbnVtYmVyPigpO1xuICAgIGNvbnN0IHJkZlR5cGUgPSBcImh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyN0eXBlXCI7XG5cbiAgICB0cnkge1xuICAgICAgLy8gVXNlIG1hdGNoIHdpdGggdW5kZWZpbmVkIHRvIGdldCBhbGwgdHJpcGxlc1xuICAgICAgY29uc3QgdHJpcGxlcyA9IHRoaXMuZ3JhcGgubWF0Y2godW5kZWZpbmVkLCB1bmRlZmluZWQsIHVuZGVmaW5lZCk7XG4gICAgICBmb3IgKGNvbnN0IHRyaXBsZSBvZiB0cmlwbGVzKSB7XG4gICAgICAgIGlmICh0cmlwbGUuZ2V0UHJlZGljYXRlKCkudG9TdHJpbmcoKSA9PT0gcmRmVHlwZSkge1xuICAgICAgICAgIGNvbnN0IGNsYXNzVXJpID0gdHJpcGxlLmdldE9iamVjdCgpLnRvU3RyaW5nKCk7XG4gICAgICAgICAgY2xhc3Nlcy5zZXQoY2xhc3NVcmksIChjbGFzc2VzLmdldChjbGFzc1VyaSkgfHwgMCkgKyAxKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLndhcm4oXCJGYWlsZWQgdG8gZXh0cmFjdCBjbGFzc2VzIGZyb20gZ3JhcGg6XCIsIGVycm9yKTtcbiAgICB9XG5cbiAgICByZXR1cm4gQXJyYXkuZnJvbShjbGFzc2VzLmVudHJpZXMoKSlcbiAgICAgIC5tYXAoKFt1cmksIGluc3RhbmNlQ291bnRdKSA9PiAoeyB1cmksIGluc3RhbmNlQ291bnQgfSkpXG4gICAgICAuc29ydCgoYSwgYikgPT4gYi5pbnN0YW5jZUNvdW50IC0gYS5pbnN0YW5jZUNvdW50KTtcbiAgfVxuXG4gIHByaXZhdGUgY3JlYXRlUHJvcGVydHlTdWdnZXN0aW9uKFxuICAgIHByb3BlcnR5OiB7IHVyaTogc3RyaW5nOyBmcmVxdWVuY3k6IG51bWJlciB9LFxuICAgIGNvbnRleHQ6IFF1ZXJ5Q29udGV4dCxcbiAgKTogU1BBUlFMU3VnZ2VzdGlvbiB7XG4gICAgY29uc3Qgc2hvcnROYW1lID0gdGhpcy5nZXRTaG9ydE5hbWUocHJvcGVydHkudXJpKTtcbiAgICBjb25zdCBjb25maWRlbmNlID0gTWF0aC5taW4oMC45LCAwLjUgKyBwcm9wZXJ0eS5mcmVxdWVuY3kgLyAxMDApO1xuXG4gICAgcmV0dXJuIFNQQVJRTFN1Z2dlc3Rpb24uY3JlYXRlKHtcbiAgICAgIGlkOiBgcHJvcGVydHlfJHtwcm9wZXJ0eS51cml9YCxcbiAgICAgIHRleHQ6IHNob3J0TmFtZSxcbiAgICAgIGluc2VydFRleHQ6IHNob3J0TmFtZSxcbiAgICAgIHR5cGU6IFN1Z2dlc3Rpb25UeXBlLlBST1BFUlRZLFxuICAgICAgY29uZmlkZW5jZSxcbiAgICAgIGNvbnRleHR1YWxTY29yZTogY29udGV4dC5pc0luQ2xhdXNlKENsYXVzZVR5cGUuV0hFUkUpID8gMC45IDogMC41LFxuICAgICAgbWV0YWRhdGE6IHtcbiAgICAgICAgZGVzY3JpcHRpb246IGBQcm9wZXJ0eSAodXNlZCAke3Byb3BlcnR5LmZyZXF1ZW5jeX0gdGltZXMpYCxcbiAgICAgICAgbmFtZXNwYWNlOiBwcm9wZXJ0eS51cmksXG4gICAgICB9LFxuICAgIH0pO1xuICB9XG5cbiAgcHJpdmF0ZSBjcmVhdGVDbGFzc1N1Z2dlc3Rpb24oXG4gICAgY2xzOiB7IHVyaTogc3RyaW5nOyBpbnN0YW5jZUNvdW50OiBudW1iZXIgfSxcbiAgICBjb250ZXh0OiBRdWVyeUNvbnRleHQsXG4gICk6IFNQQVJRTFN1Z2dlc3Rpb24ge1xuICAgIGNvbnN0IHNob3J0TmFtZSA9IHRoaXMuZ2V0U2hvcnROYW1lKGNscy51cmkpO1xuICAgIGNvbnN0IGNvbmZpZGVuY2UgPSBNYXRoLm1pbigwLjksIDAuNSArIGNscy5pbnN0YW5jZUNvdW50IC8gNTApO1xuXG4gICAgcmV0dXJuIFNQQVJRTFN1Z2dlc3Rpb24uY3JlYXRlKHtcbiAgICAgIGlkOiBgY2xhc3NfJHtjbHMudXJpfWAsXG4gICAgICB0ZXh0OiBzaG9ydE5hbWUsXG4gICAgICBpbnNlcnRUZXh0OiBzaG9ydE5hbWUsXG4gICAgICB0eXBlOiBTdWdnZXN0aW9uVHlwZS5DTEFTUyxcbiAgICAgIGNvbmZpZGVuY2UsXG4gICAgICBjb250ZXh0dWFsU2NvcmU6IHRoaXMuaXNBZnRlclJkZlR5cGUoY29udGV4dCkgPyAwLjk1IDogMC42LFxuICAgICAgbWV0YWRhdGE6IHtcbiAgICAgICAgZGVzY3JpcHRpb246IGBDbGFzcyAoJHtjbHMuaW5zdGFuY2VDb3VudH0gaW5zdGFuY2VzKWAsXG4gICAgICAgIG5hbWVzcGFjZTogY2xzLnVyaSxcbiAgICAgIH0sXG4gICAgfSk7XG4gIH1cblxuICBwcml2YXRlIGdldFNob3J0TmFtZSh1cmk6IHN0cmluZyk6IHN0cmluZyB7XG4gICAgY29uc3QgaGFzaEluZGV4ID0gdXJpLmxhc3RJbmRleE9mKFwiI1wiKTtcbiAgICBjb25zdCBzbGFzaEluZGV4ID0gdXJpLmxhc3RJbmRleE9mKFwiL1wiKTtcbiAgICBjb25zdCBzcGxpdEluZGV4ID0gTWF0aC5tYXgoaGFzaEluZGV4LCBzbGFzaEluZGV4KTtcblxuICAgIGlmIChzcGxpdEluZGV4ID4gMCAmJiBzcGxpdEluZGV4IDwgdXJpLmxlbmd0aCAtIDEpIHtcbiAgICAgIHJldHVybiB1cmkuc3Vic3RyaW5nKHNwbGl0SW5kZXggKyAxKTtcbiAgICB9XG5cbiAgICByZXR1cm4gdXJpO1xuICB9XG5cbiAgcHJpdmF0ZSBpc0FmdGVyUmRmVHlwZShjb250ZXh0OiBRdWVyeUNvbnRleHQpOiBib29sZWFuIHtcbiAgICBjb25zdCBwcmV2aW91c1Rva2VucyA9IGNvbnRleHQuZ2V0UHJldmlvdXNUb2tlbnMoKTtcbiAgICBpZiAocHJldmlvdXNUb2tlbnMubGVuZ3RoIDwgMikgcmV0dXJuIGZhbHNlO1xuXG4gICAgY29uc3QgbGFzdFR3byA9IHByZXZpb3VzVG9rZW5zLnNsaWNlKC0yKS5qb2luKFwiIFwiKS50b0xvd2VyQ2FzZSgpO1xuICAgIHJldHVybiBsYXN0VHdvLmluY2x1ZGVzKFwicmRmOnR5cGVcIikgfHwgbGFzdFR3by5pbmNsdWRlcyhcIiBhIFwiKTtcbiAgfVxuXG4gIHByaXZhdGUgc2hvdWxkUmVmcmVzaENhY2hlKCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiBEYXRlLm5vdygpIC0gdGhpcy5jYWNoZVRpbWVzdGFtcCA+IHRoaXMuY2FjaGVUVEw7XG4gIH1cblxuICBwcml2YXRlIHJlZnJlc2hQcm9wZXJ0eUNhY2hlKCk6IHZvaWQge1xuICAgIHRoaXMucHJvcGVydHlDYWNoZS5jbGVhcigpO1xuICAgIHRoaXMuY2FjaGVUaW1lc3RhbXAgPSBEYXRlLm5vdygpO1xuICB9XG5cbiAgcHJpdmF0ZSByZWZyZXNoQ2xhc3NDYWNoZSgpOiB2b2lkIHtcbiAgICB0aGlzLmNsYXNzQ2FjaGUuY2xlYXIoKTtcbiAgICB0aGlzLmNhY2hlVGltZXN0YW1wID0gRGF0ZS5ub3coKTtcbiAgfVxufVxuIl0sInZlcnNpb24iOjN9