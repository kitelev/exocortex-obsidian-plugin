756a76aaf1ea410a19bb8beaa18eec74
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.RelationAssetHelper = exports.RELATION_INVERSES = void 0;
const uuid_1 = require("uuid");
/**
 * Relation types with their inverses
 */
exports.RELATION_INVERSES = {
    'exo__Asset_relates': 'exo__Asset_relatedBy',
    'ems__Task_project': 'ems__Project_hasTasks',
    'ems__Task_assignedTo': 'ems__Person_assignedTasks',
    'ems__Area_parent': 'ems__Area_children',
    'exo__subClassOf': 'exo__superClassOf',
    'ems__partOf': 'ems__hasPart',
    'ems__blocks': 'ems__blockedBy',
    'ems__dependsOn': 'ems__requiredBy'
};
/**
 * Helper class for working with relations
 */
class RelationAssetHelper {
    /**
     * Create a new relation asset
     */
    static create(params) {
        return {
            uid: (0, uuid_1.v4)(),
            type: 'adapter__Relation',
            subject: params.subject,
            predicate: params.predicate,
            object: params.object,
            createdAt: new Date(),
            isDefinedBy: params.ontology || this.extractOntology(params.predicate),
            confidence: params.confidence,
            provenance: params.provenance || 'manual'
        };
    }
    /**
     * Create bidirectional relation (returns both relation and its inverse)
     */
    static createBidirectional(params) {
        const forward = this.create(params);
        const inversePredicate = this.getInversePredicate(params.predicate);
        const inverse = this.create({
            subject: params.object,
            predicate: inversePredicate,
            object: params.subject,
            ontology: params.ontology,
            provenance: `inverse of ${forward.uid}`
        });
        forward.inverseOf = inverse.uid;
        inverse.inverseOf = forward.uid;
        return [forward, inverse];
    }
    /**
     * Get inverse predicate name
     */
    static getInversePredicate(predicate) {
        // Check known inverses
        if (exports.RELATION_INVERSES[predicate]) {
            return exports.RELATION_INVERSES[predicate];
        }
        // Check reverse mapping
        for (const [key, value] of Object.entries(exports.RELATION_INVERSES)) {
            if (value === predicate) {
                return key;
            }
        }
        // Generate inverse name
        if (predicate.includes('__')) {
            const parts = predicate.split('__');
            return `${parts[0]}__inverseOf_${parts[1]}`;
        }
        return `inverseOf_${predicate}`;
    }
    /**
     * Extract ontology namespace from predicate
     */
    static extractOntology(predicate) {
        if (predicate.includes('__')) {
            return predicate.split('__')[0];
        }
        if (predicate.includes(':')) {
            return predicate.split(':')[0];
        }
        return 'exo';
    }
    /**
     * Convert relation to markdown frontmatter
     */
    static toFrontmatter(relation) {
        return {
            'exo__Instance_class': '[[adapter__Relation]]',
            'exo__Asset_uid': relation.uid,
            'adapter__Relation_subject': `[[${relation.subject}]]`,
            'adapter__Relation_predicate': relation.predicate,
            'adapter__Relation_object': `[[${relation.object}]]`,
            'exo__Asset_createdAt': relation.createdAt.toISOString(),
            'exo__Asset_isDefinedBy': `[[${relation.isDefinedBy}]]`,
            'adapter__Relation_confidence': relation.confidence || 1.0,
            'adapter__Relation_provenance': relation.provenance,
            'adapter__Relation_inverseOf': relation.inverseOf
        };
    }
    /**
     * Generate filename for relation asset
     */
    static generateFilename(relation) {
        const subjectName = relation.subject.replace(/[^\w-]/g, '_').substring(0, 20);
        const predicateName = relation.predicate.replace(/[^\w-]/g, '_');
        const objectName = relation.object.replace(/[^\w-]/g, '_').substring(0, 20);
        const timestamp = relation.createdAt.getTime();
        return `Relation_${subjectName}_${predicateName}_${objectName}_${timestamp}.md`;
    }
}
exports.RelationAssetHelper = RelationAssetHelper;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL2tpdGVsZXYvRG9jdW1lbnRzL2V4b2NvcnRleC1vYnNpZGlhbi1wbHVnaW4vc3JjL2RvbWFpbi9lbnRpdGllcy9SZWxhdGlvbkFzc2V0LnRzIiwibWFwcGluZ3MiOiI7OztBQUFBLCtCQUFvQztBQWdDcEM7O0dBRUc7QUFDVSxRQUFBLGlCQUFpQixHQUEyQjtJQUNyRCxvQkFBb0IsRUFBRSxzQkFBc0I7SUFDNUMsbUJBQW1CLEVBQUUsdUJBQXVCO0lBQzVDLHNCQUFzQixFQUFFLDJCQUEyQjtJQUNuRCxrQkFBa0IsRUFBRSxvQkFBb0I7SUFDeEMsaUJBQWlCLEVBQUUsbUJBQW1CO0lBQ3RDLGFBQWEsRUFBRSxjQUFjO0lBQzdCLGFBQWEsRUFBRSxnQkFBZ0I7SUFDL0IsZ0JBQWdCLEVBQUUsaUJBQWlCO0NBQ3RDLENBQUM7QUFFRjs7R0FFRztBQUNILE1BQWEsbUJBQW1CO0lBQzVCOztPQUVHO0lBQ0gsTUFBTSxDQUFDLE1BQU0sQ0FBQyxNQU9iO1FBQ0csT0FBTztZQUNILEdBQUcsRUFBRSxJQUFBLFNBQU0sR0FBRTtZQUNiLElBQUksRUFBRSxtQkFBbUI7WUFDekIsT0FBTyxFQUFFLE1BQU0sQ0FBQyxPQUFPO1lBQ3ZCLFNBQVMsRUFBRSxNQUFNLENBQUMsU0FBUztZQUMzQixNQUFNLEVBQUUsTUFBTSxDQUFDLE1BQU07WUFDckIsU0FBUyxFQUFFLElBQUksSUFBSSxFQUFFO1lBQ3JCLFdBQVcsRUFBRSxNQUFNLENBQUMsUUFBUSxJQUFJLElBQUksQ0FBQyxlQUFlLENBQUMsTUFBTSxDQUFDLFNBQVMsQ0FBQztZQUN0RSxVQUFVLEVBQUUsTUFBTSxDQUFDLFVBQVU7WUFDN0IsVUFBVSxFQUFFLE1BQU0sQ0FBQyxVQUFVLElBQUksUUFBUTtTQUM1QyxDQUFDO0lBQ04sQ0FBQztJQUVEOztPQUVHO0lBQ0gsTUFBTSxDQUFDLG1CQUFtQixDQUFDLE1BSzFCO1FBQ0csTUFBTSxPQUFPLEdBQUcsSUFBSSxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsQ0FBQztRQUVwQyxNQUFN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QUFHLENBQUMsQ0FBQyxTQUFTLENBQUMsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxDQUFDO1FBQzlFLE1BQU0sYUFBYSxHQUFHLFFBQVEsQ0FBQyxTQUFTLENBQUMsT0FBTyxDQUFDLFNBQVMsRUFBRSxHQUFHLENBQUMsQ0FBQztRQUNqRSxNQUFNLFVBQVUsR0FBRyxRQUFRLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxTQUFTLEVBQUUsR0FBRyxDQUFDLENBQUMsU0FBUyxDQUFDLENBQUMsRUFBRSxFQUFFLENBQUMsQ0FBQztRQUM1RSxNQUFNLFNBQVMsR0FBRyxRQUFRLENBQUMsU0FBUyxDQUFDLE9BQU8sRUFBRSxDQUFDO1FBRS9DLE9BQU8sWUFBWSxXQUFXLElBQUksYUFBYSxJQUFJLFVBQVUsSUFBSSxTQUFTLEtBQUssQ0FBQztJQUNwRixDQUFDO0NBQ0o7QUF0SEQsa0RBc0hDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIi9Vc2Vycy9raXRlbGV2L0RvY3VtZW50cy9leG9jb3J0ZXgtb2JzaWRpYW4tcGx1Z2luL3NyYy9kb21haW4vZW50aXRpZXMvUmVsYXRpb25Bc3NldC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyB2NCBhcyB1dWlkdjQgfSBmcm9tICd1dWlkJztcblxuLyoqXG4gKiBSZXByZXNlbnRzIGEgcmVsYXRpb24gYmV0d2VlbiBhc3NldHMgYXMgYSBmaXJzdC1jbGFzcyBlbnRpdHlcbiAqIFRoaXMgZW5hYmxlcyBFdmVudCBTb3VyY2luZywgdmVyc2lvbmluZywgYW5kIGZsZXhpYmxlIGFjY2VzcyBjb250cm9sXG4gKi9cbmV4cG9ydCBpbnRlcmZhY2UgUmVsYXRpb25Bc3NldCB7XG4gICAgdWlkOiBzdHJpbmc7XG4gICAgdHlwZTogJ2FkYXB0ZXJfX1JlbGF0aW9uJztcbiAgICBzdWJqZWN0OiBzdHJpbmc7IC8vIFNvdXJjZSBBc3NldCBVSURcbiAgICBwcmVkaWNhdGU6IHN0cmluZzsgLy8gUmVsYXRpb24gdHlwZSAoZS5nLiwgJ2V4b19fQXNzZXRfcmVsYXRlcycsICdlbXNfX1Rhc2tfcHJvamVjdCcpXG4gICAgb2JqZWN0OiBzdHJpbmc7IC8vIFRhcmdldCBBc3NldCBVSUQgb3IgdmFsdWVcbiAgICBjcmVhdGVkQXQ6IERhdGU7XG4gICAgbW9kaWZpZWRBdD86IERhdGU7XG4gICAgaXNEZWZpbmVkQnk6IHN0cmluZzsgLy8gT250b2xvZ3kgbmFtZXNwYWNlXG4gICAgY29uZmlkZW5jZT86IG51bWJlcjsgLy8gMC4wIHRvIDEuMFxuICAgIHByb3ZlbmFuY2U/OiBzdHJpbmc7IC8vIEhvdyB0aGlzIHJlbGF0aW9uIHdhcyBjcmVhdGVkXG4gICAgaW52ZXJzZU9mPzogc3RyaW5nOyAvLyBVSUQgb2YgaW52ZXJzZSByZWxhdGlvblxuICAgIG1ldGFkYXRhPzogUmVjb3JkPHN0cmluZywgYW55Pjtcbn1cblxuLyoqXG4gKiBSZXByZXNlbnRzIE4tYXJ5IHJlbGF0aW9ucyAoY29ubmVjdGluZyBtb3JlIHRoYW4gMiBhc3NldHMpXG4gKi9cbmV4cG9ydCBpbnRlcmZhY2UgTmFyeVJlbGF0aW9uQXNzZXQgZXh0ZW5kcyBPbWl0PFJlbGF0aW9uQXNzZXQsICd0eXBlJz4ge1xuICAgIHR5cGU6ICdhZGFwdGVyX19OYXJ5UmVsYXRpb24nO1xuICAgIHBhcnRpY2lwYW50czogQXJyYXk8e1xuICAgICAgICByb2xlOiBzdHJpbmc7XG4gICAgICAgIGFzc2V0VWlkOiBzdHJpbmc7XG4gICAgfT47XG59XG5cbi8qKlxuICogUmVsYXRpb24gdHlwZXMgd2l0aCB0aGVpciBpbnZlcnNlc1xuICovXG5leHBvcnQgY29uc3QgUkVMQVRJT05fSU5WRVJTRVM6IFJlY29yZDxzdHJpbmcsIHN0cmluZz4gPSB7XG4gICAgJ2V4b19fQXNzZXRfcmVsYXRlcyc6ICdleG9fX0Fzc2V0X3JlbGF0ZWRCeScsXG4gICAgJ2Vtc19fVGFza19wcm9qZWN0JzogJ2Vtc19fUHJvamVjdF9oYXNUYXNrcycsXG4gICAgJ2Vtc19fVGFza19hc3NpZ25lZFRvJzogJ2Vtc19fUGVyc29uX2Fzc2lnbmVkVGFza3MnLFxuICAgICdlbXNfX0FyZWFfcGFyZW50JzogJ2Vtc19fQXJlYV9jaGlsZHJlbicsXG4gICAgJ2V4b19fc3ViQ2xhc3NPZic6ICdleG9fX3N1cGVyQ2xhc3NPZicsXG4gICAgJ2Vtc19fcGFydE9mJzogJ2Vtc19faGFzUGFydCcsXG4gICAgJ2Vtc19fYmxvY2tzJzogJ2Vtc19fYmxvY2tlZEJ5JyxcbiAgICAnZW1zX19kZXBlbmRzT24nOiAnZW1zX19yZXF1aXJlZEJ5J1xufTtcblxuLyoqXG4gKiBIZWxwZXIgY2xhc3MgZm9yIHdvcmtpbmcgd2l0aCByZWxhdGlvbnNcbiAqL1xuZXhwb3J0IGNsYXNzIFJlbGF0aW9uQXNzZXRIZWxwZXIge1xuICAgIC8qKlxuICAgICAqIENyZWF0ZSBhIG5ldyByZWxhdGlvbiBhc3NldFxuICAgICAqL1xuICAgIHN0YXRpYyBjcmVhdGUocGFyYW1zOiB7XG4gICAgICAgIHN1YmplY3Q6IHN0cmluZztcbiAgICAgICAgcHJlZGljYXRlOiBzdHJpbmc7XG4gICAgICAgIG9iamVjdDogc3RyaW5nO1xuICAgICAgICBvbnRvbG9neT86IHN0cmluZztcbiAgICAgICAgY29uZmlkZW5jZT86IG51bWJlcjtcbiAgICAgICAgcHJvdmVuYW5jZT86IHN0cmluZztcbiAgICB9KTogUmVsYXRpb25Bc3NldCB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICB1aWQ6IHV1aWR2NCgpLFxuICAgICAgICAgICAgdHlwZTogJ2FkYXB0ZXJfX1JlbGF0aW9uJyxcbiAgICAgICAgICAgIHN1YmplY3Q6IHBhcmFtcy5zdWJqZWN0LFxuICAgICAgICAgICAgcHJlZGljYXRlOiBwYXJhbXMucHJlZGljYXRlLFxuICAgICAgICAgICAgb2JqZWN0OiBwYXJhbXMub2JqZWN0LFxuICAgICAgICAgICAgY3JlYXRlZEF0OiBuZXcgRGF0ZSgpLFxuICAgICAgICAgICAgaXNEZWZpbmVkQnk6IHBhcmFtcy5vbnRvbG9neSB8fCB0aGlzLmV4dHJhY3RPbnRvbG9neShwYXJhbXMucHJlZGljYXRlKSxcbiAgICAgICAgICAgIGNvbmZpZGVuY2U6IHBhcmFtcy5jb25maWRlbmNlLFxuICAgICAgICAgICAgcHJvdmVuYW5jZTogcGFyYW1zLnByb3ZlbmFuY2UgfHwgJ21hbnVhbCdcbiAgICAgICAgfTtcbiAgICB9XG4gICAgXG4gICAgLyoqXG4gICAgICogQ3JlYXRlIGJpZGlyZWN0aW9uYWwgcmVsYXRpb24gKHJldHVybnMgYm90aCByZWxhdGlvbiBhbmQgaXRzIGludmVyc2UpXG4gICAgICovXG4gICAgc3RhdGljIGNyZWF0ZUJpZGlyZWN0aW9uYWwocGFyYW1zOiB7XG4gICAgICAgIHN1YmplY3Q6IHN0cmluZztcbiAgICAgICAgcHJlZGljYXRlOiBzdHJpbmc7XG4gICAgICAgIG9iamVjdDogc3RyaW5nO1xuICAgICAgICBvbnRvbG9neT86IHN0cmluZztcbiAgICB9KTogW1JlbGF0aW9uQXNzZXQsIFJlbGF0aW9uQXNzZXRdIHtcbiAgICAgICAgY29uc3QgZm9yd2FyZCA9IHRoaXMuY3JlYXRlKHBhcmFtcyk7XG4gICAgICAgIFxuICAgICAgICBjb25zdCBpbnZlcnNlUHJlZGljYXRlID0gdGhpcy5nZXRJbnZlcnNlUHJlZGljYXRlKHBhcmFtcy5wcmVkaWNhdGUpO1xuICAgICAgICBjb25zdCBpbnZlcnNlID0gdGhpcy5jcmVhdGUoe1xuICAgICAgICAgICAgc3ViamVjdDogcGFyYW1zLm9iamVjdCxcbiAgICAgICAgICAgIHByZWRpY2F0ZTogaW52ZXJzZVByZWRpY2F0ZSxcbiAgICAgICAgICAgIG9iamVjdDogcGFyYW1zLnN1YmplY3QsXG4gICAgICAgICAgICBvbnRvbG9neTogcGFyYW1zLm9udG9sb2d5LFxuICAgICAgICAgICAgcHJvdmVuYW5jZTogYGludmVyc2Ugb2YgJHtmb3J3YXJkLnVpZH1gXG4gICAgICAgIH0pO1xuICAgICAgICBcbiAgICAgICAgZm9yd2FyZC5pbnZlcnNlT2YgPSBpbnZlcnNlLnVpZDtcbiAgICAgICAgaW52ZXJzZS5pbnZlcnNlT2YgPSBmb3J3YXJkLnVpZDtcbiAgICAgICAgXG4gICAgICAgIHJldHVybiBbZm9yd2FyZCwgaW52ZXJzZV07XG4gICAgfVxuICAgIFxuICAgIC8qKlxuICAgICAqIEdldCBpbnZlcnNlIHByZWRpY2F0ZSBuYW1lXG4gICAgICovXG4gICAgc3RhdGljIGdldEludmVyc2VQcmVkaWNhdGUocHJlZGljYXRlOiBzdHJpbmcpOiBzdHJpbmcge1xuICAgICAgICAvLyBDaGVjayBrbm93biBpbnZlcnNlc1xuICAgICAgICBpZiAoUkVMQVRJT05fSU5WRVJTRVNbcHJlZGljYXRlXSkge1xuICAgICAgICAgICAgcmV0dXJuIFJFTEFUSU9OX0lOVkVSU0VTW3ByZWRpY2F0ZV07XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIC8vIENoZWNrIHJldmVyc2UgbWFwcGluZ1xuICAgICAgICBmb3IgKGNvbnN0IFtrZXksIHZhbHVlXSBvZiBPYmplY3QuZW50cmllcyhSRUxBVElPTl9JTlZFUlNFUykpIHtcbiAgICAgICAgICAgIGlmICh2YWx1ZSA9PT0gcHJlZGljYXRlKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGtleTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgLy8gR2VuZXJhdGUgaW52ZXJzZSBuYW1lXG4gICAgICAgIGlmIChwcmVkaWNhdGUuaW5jbHVkZXMoJ19fJykpIHtcbiAgICAgICAgICAgIGNvbnN0IHBhcnRzID0gcHJlZGljYXRlLnNwbGl0KCdfXycpO1xuICAgICAgICAgICAgcmV0dXJuIGAke3BhcnRzWzBdfV9faW52ZXJzZU9mXyR7cGFydHNbMV19YDtcbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgcmV0dXJuIGBpbnZlcnNlT2ZfJHtwcmVkaWNhdGV9YDtcbiAgICB9XG4gICAgXG4gICAgLyoqXG4gICAgICogRXh0cmFjdCBvbnRvbG9neSBuYW1lc3BhY2UgZnJvbSBwcmVkaWNhdGVcbiAgICAgKi9cbiAgICBzdGF0aWMgZXh0cmFjdE9udG9sb2d5KHByZWRpY2F0ZTogc3RyaW5nKTogc3RyaW5nIHtcbiAgICAgICAgaWYgKHByZWRpY2F0ZS5pbmNsdWRlcygnX18nKSkge1xuICAgICAgICAgICAgcmV0dXJuIHByZWRpY2F0ZS5zcGxpdCgnX18nKVswXTtcbiAgICAgICAgfVxuICAgICAgICBpZiAocHJlZGljYXRlLmluY2x1ZGVzKCc6JykpIHtcbiAgICAgICAgICAgIHJldHVybiBwcmVkaWNhdGUuc3BsaXQoJzonKVswXTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gJ2V4byc7XG4gICAgfVxuICAgIFxuICAgIC8qKlxuICAgICAqIENvbnZlcnQgcmVsYXRpb24gdG8gbWFya2Rvd24gZnJvbnRtYXR0ZXJcbiAgICAgKi9cbiAgICBzdGF0aWMgdG9Gcm9udG1hdHRlcihyZWxhdGlvbjogUmVsYXRpb25Bc3NldCk6IFJlY29yZDxzdHJpbmcsIGFueT4ge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgJ2V4b19fSW5zdGFuY2VfY2xhc3MnOiAnW1thZGFwdGVyX19SZWxhdGlvbl1dJyxcbiAgICAgICAgICAgICdleG9fX0Fzc2V0X3VpZCc6IHJlbGF0aW9uLnVpZCxcbiAgICAgICAgICAgICdhZGFwdGVyX19SZWxhdGlvbl9zdWJqZWN0JzogYFtbJHtyZWxhdGlvbi5zdWJqZWN0fV1dYCxcbiAgICAgICAgICAgICdhZGFwdGVyX19SZWxhdGlvbl9wcmVkaWNhdGUnOiByZWxhdGlvbi5wcmVkaWNhdGUsXG4gICAgICAgICAgICAnYWRhcHRlcl9fUmVsYXRpb25fb2JqZWN0JzogYFtbJHtyZWxhdGlvbi5vYmplY3R9XV1gLFxuICAgICAgICAgICAgJ2V4b19fQXNzZXRfY3JlYXRlZEF0JzogcmVsYXRpb24uY3JlYXRlZEF0LnRvSVNPU3RyaW5nKCksXG4gICAgICAgICAgICAnZXhvX19Bc3NldF9pc0RlZmluZWRCeSc6IGBbWyR7cmVsYXRpb24uaXNEZWZpbmVkQnl9XV1gLFxuICAgICAgICAgICAgJ2FkYXB0ZXJfX1JlbGF0aW9uX2NvbmZpZGVuY2UnOiByZWxhdGlvbi5jb25maWRlbmNlIHx8IDEuMCxcbiAgICAgICAgICAgICdhZGFwdGVyX19SZWxhdGlvbl9wcm92ZW5hbmNlJzogcmVsYXRpb24ucHJvdmVuYW5jZSxcbiAgICAgICAgICAgICdhZGFwdGVyX19SZWxhdGlvbl9pbnZlcnNlT2YnOiByZWxhdGlvbi5pbnZlcnNlT2ZcbiAgICAgICAgfTtcbiAgICB9XG4gICAgXG4gICAgLyoqXG4gICAgICogR2VuZXJhdGUgZmlsZW5hbWUgZm9yIHJlbGF0aW9uIGFzc2V0XG4gICAgICovXG4gICAgc3RhdGljIGdlbmVyYXRlRmlsZW5hbWUocmVsYXRpb246IFJlbGF0aW9uQXNzZXQpOiBzdHJpbmcge1xuICAgICAgICBjb25zdCBzdWJqZWN0TmFtZSA9IHJlbGF0aW9uLnN1YmplY3QucmVwbGFjZSgvW15cXHctXS9nLCAnXycpLnN1YnN0cmluZygwLCAyMCk7XG4gICAgICAgIGNvbnN0IHByZWRpY2F0ZU5hbWUgPSByZWxhdGlvbi5wcmVkaWNhdGUucmVwbGFjZSgvW15cXHctXS9nLCAnXycpO1xuICAgICAgICBjb25zdCBvYmplY3ROYW1lID0gcmVsYXRpb24ub2JqZWN0LnJlcGxhY2UoL1teXFx3LV0vZywgJ18nKS5zdWJzdHJpbmcoMCwgMjApO1xuICAgICAgICBjb25zdCB0aW1lc3RhbXAgPSByZWxhdGlvbi5jcmVhdGVkQXQuZ2V0VGltZSgpO1xuICAgICAgICBcbiAgICAgICAgcmV0dXJuIGBSZWxhdGlvbl8ke3N1YmplY3ROYW1lfV8ke3ByZWRpY2F0ZU5hbWV9XyR7b2JqZWN0TmFtZX1fJHt0aW1lc3RhbXB9Lm1kYDtcbiAgICB9XG59Il0sInZlcnNpb24iOjN9