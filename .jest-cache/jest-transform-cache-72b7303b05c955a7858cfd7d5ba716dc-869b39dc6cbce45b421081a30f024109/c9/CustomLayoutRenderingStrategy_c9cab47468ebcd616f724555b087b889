2f9596273d13d5a59e4f4bc625ee16dd
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.CustomLayoutRenderingStrategy = void 0;
const Result_1 = require("../../domain/core/Result");
class CustomLayoutRenderingStrategy {
    constructor(blockRendererFactory) {
        this.blockRendererFactory = blockRendererFactory;
    }
    canHandle(layout) {
        return layout !== null && layout !== undefined;
    }
    async render(context, layout) {
        if (!layout) {
            return Result_1.Result.fail("Layout is required for custom rendering strategy");
        }
        if (!context.container) {
            return Result_1.Result.fail("Container is required for rendering");
        }
        if (!context.metadata?.frontmatter) {
            this.renderError(context.container, "No metadata available for this file");
            return Result_1.Result.fail("No metadata available");
        }
        try {
            // Add layout info (hidden metadata)
            this.addLayoutInfo(context.container, layout);
            // Render each visible block
            const visibleBlocks = layout.getVisibleBlocks();
            for (const block of visibleBlocks) {
                const blockResult = await this.renderBlock(context, block, layout);
                if (blockResult.isFailure) {
                    console.error(`Failed to render block ${block.id}:`, blockResult.error);
                    // Continue with other blocks rather than failing completely
                }
            }
            return Result_1.Result.ok();
        }
        catch (error) {
            return Result_1.Result.fail(`Custom layout rendering failed: ${error}`);
        }
    }
    addLayoutInfo(container, layout) {
        const layoutInfo = document.createElement("div");
        layoutInfo.className = "exocortex-layout-info";
        layoutInfo.style.display = "none";
        layoutInfo.setAttribute("data-layout-id", layout.id.toString());
        layoutInfo.setAttribute("data-layout-class", layout.targetClass.value);
        container.appendChild(layoutInfo);
    }
    async renderBlock(context, block, layout) {
        try {
            // Create block container structure
            const blockContainer = document.createElement("div");
            blockContainer.className = `exocortex-block exocortex-block-${block.type}`;
            blockContainer.setAttribute("data-block-id", block.id);
            context.container.appendChild(blockContainer);
            // Add block header if title exists
            if (block.title) {
                const header = document.createElement("h3");
                header.textContent = block.title;
                header.className = "exocortex-block-header";
                blockContainer.appendChild(header);
                // Add collapse toggle if collapsible
                if (block.isCollapsible) {
                    header.classList.add("is-collapsible");
                    header.addEventListener("click", () => {
                        blockContainer.classList.toggle("is-collapsed", !blockContainer.classList.contains("is-collapsed"));
                    });
                }
            }
            // Create content container
            const contentContainer = document.createElement("div");
            contentContainer.className = "exocortex-block-content";
            blockContainer.appendChild(contentContainer);
            // Get appropriate renderer for block type
            const rendererResult = this.blockRendererFactory.createRenderer(block.type);
            if (rendererResult.isFailure) {
                return this.renderBlockError(contentContainer, `Unknown block type: ${block.type}`);
            }
            const renderer = rendererResult.getValue();
            // Create block rendering context
            const blockContext = {
                container: contentContainer,
                config: block.config,
                file: context.file,
                frontmatter: context.metadata.frontmatter,
                dataviewApi: context.dataviewApi,
            };
            // Render block content
            const renderResult = await renderer.render(blockContext);
            if (renderResult.isFailure) {
                return this.renderBlockError(contentContainer, `Error rendering block: ${renderResult.error}`);
            }
            return Result_1.Result.ok();
        }
        catch (error) {
            return Result_1.Result.fail(`Block rendering failed: ${error}`);
        }
    }
    renderError(container, error) {
        const errorDiv = document.createElement("div");
        errorDiv.textContent = `Layout Error: ${error}`;
        errorDiv.className = "exocortex-error notice-error";
        container.appendChild(errorDiv);
    }
    renderBlockError(container, error) {
        const errorP = document.createElement("p");
        errorP.textContent = error;
        errorP.className = "exocortex-error";
        container.appendChild(errorP);
        return Result_1.Result.ok(); // Return ok since we handled the error gracefully
    }
}
exports.CustomLayoutRenderingStrategy = CustomLayoutRenderingStrategy;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL2tpdGVsZXYvRG9jdW1lbnRzL2V4b2NvcnRleC1vYnNpZGlhbi1wbHVnaW4vc3JjL3ByZXNlbnRhdGlvbi9zdHJhdGVnaWVzL0N1c3RvbUxheW91dFJlbmRlcmluZ1N0cmF0ZWd5LnRzIiwibWFwcGluZ3MiOiI7OztBQUFBLHFEQUFrRDtBQVdsRCxNQUFhLDZCQUE2QjtJQUN4QyxZQUE2QixvQkFBMkM7UUFBM0MseUJBQW9CLEdBQXBCLG9CQUFvQixDQUF1QjtJQUFHLENBQUM7SUFFNUUsU0FBUyxDQUFDLE1BQTBCO1FBQ2xDLE9BQU8sTUFBTSxLQUFLLElBQUksSUFBSSxNQUFNLEtBQUssU0FBUyxDQUFDO0lBQ2pELENBQUM7SUFFRCxLQUFLLENBQUMsTUFBTSxDQUNWLE9BQStCLEVBQy9CLE1BQW9CO1FBRXBCLElBQUksQ0FBQyxNQUFNLEVBQUU7WUFDWCxPQUFPLGVBQU0sQ0FBQyxJQUFJLENBQUMsa0RBQWtELENBQUMsQ0FBQztTQUN4RTtRQUVELElBQUksQ0FBQyxPQUFPLENBQUMsU0FBUyxFQUFFO1lBQ3RCLE9BQU8sZUFBTSxDQUFDLElBQUksQ0FBQyxxQ0FBcUMsQ0FBQyxDQUFDO1NBQzNEO1FBRUQsSUFBSSxDQUFDLE9BQU8sQ0FBQyxRQUFRLEVBQUUsV0FBVyxFQUFFO1lBQ2xDLElBQUksQ0FBQyxXQUFXLENBQ2QsT0FBTyxDQUFDLFNBQVMsRUFDakIscUNBQXFDLENBQ3RDLENBQUM7WUFDRixPQUFPLGVBQU0sQ0FBQyxJQUFJLENBQUMsdUJBQXVCLENBQUMsQ0FBQztTQUM3QztRQUVELElBQUk7WUFDRixvQ0FBb0M7WUFDcEMsSUFBSSxDQUFDLGFBQWEsQ0FBQyxPQUFPLENBQUMsU0FBUyxFQUFFLE1BQU0sQ0FBQyxDQUFDO1lBRTlDLDRCQUE0QjtZQUM1QixNQUFNLGFBQWEsR0FBRyxNQUFNLENBQUMsZ0JBQWdCLEVBQUUsQ0FBQztZQUVoRCxLQUFLLE1BQU0sS0FBSyxJQUFJLGFBQWEsRUFBRTtnQkFDakMsTUFBTSxXQUFXLEdBQUcsTUFBTSxJQUFJLENB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LENBQ3RCLFNBQXNCLEVBQ3RCLEtBQWE7UUFFYixNQUFNLE1BQU0sR0FBRyxRQUFRLENBQUMsYUFBYSxDQUFDLEdBQUcsQ0FBQyxDQUFDO1FBQzNDLE1BQU0sQ0FBQyxXQUFXLEdBQUcsS0FBSyxDQUFDO1FBQzNCLE1BQU0sQ0FBQyxTQUFTLEdBQUcsaUJBQWlCLENBQUM7UUFDckMsU0FBUyxDQUFDLFdBQVcsQ0FBQyxNQUFNLENBQUMsQ0FBQztRQUM5QixPQUFPLGVBQU0sQ0FBQyxFQUFFLEVBQUUsQ0FBQyxDQUFDLGtEQUFrRDtJQUN4RSxDQUFDO0NBQ0Y7QUF0SkQsc0VBc0pDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIi9Vc2Vycy9raXRlbGV2L0RvY3VtZW50cy9leG9jb3J0ZXgtb2JzaWRpYW4tcGx1Z2luL3NyYy9wcmVzZW50YXRpb24vc3RyYXRlZ2llcy9DdXN0b21MYXlvdXRSZW5kZXJpbmdTdHJhdGVneS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBSZXN1bHQgfSBmcm9tIFwiLi4vLi4vZG9tYWluL2NvcmUvUmVzdWx0XCI7XG5pbXBvcnQgeyBDbGFzc0xheW91dCB9IGZyb20gXCIuLi8uLi9kb21haW4vZW50aXRpZXMvQ2xhc3NMYXlvdXRcIjtcbmltcG9ydCB7XG4gIElMYXlvdXRSZW5kZXJpbmdTdHJhdGVneSxcbiAgTGF5b3V0UmVuZGVyaW5nQ29udGV4dCxcbn0gZnJvbSBcIi4vSUxheW91dFJlbmRlcmluZ1N0cmF0ZWd5XCI7XG5pbXBvcnQge1xuICBJQmxvY2tSZW5kZXJlckZhY3RvcnksXG4gIEJsb2NrUmVuZGVyaW5nQ29udGV4dCxcbn0gZnJvbSBcIi4uL2ZhY3Rvcmllcy9JQmxvY2tSZW5kZXJlckZhY3RvcnlcIjtcblxuZXhwb3J0IGNsYXNzIEN1c3RvbUxheW91dFJlbmRlcmluZ1N0cmF0ZWd5IGltcGxlbWVudHMgSUxheW91dFJlbmRlcmluZ1N0cmF0ZWd5IHtcbiAgY29uc3RydWN0b3IocHJpdmF0ZSByZWFkb25seSBibG9ja1JlbmRlcmVyRmFjdG9yeTogSUJsb2NrUmVuZGVyZXJGYWN0b3J5KSB7fVxuXG4gIGNhbkhhbmRsZShsYXlvdXQ6IENsYXNzTGF5b3V0IHwgbnVsbCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiBsYXlvdXQgIT09IG51bGwgJiYgbGF5b3V0ICE9PSB1bmRlZmluZWQ7XG4gIH1cblxuICBhc3luYyByZW5kZXIoXG4gICAgY29udGV4dDogTGF5b3V0UmVuZGVyaW5nQ29udGV4dCxcbiAgICBsYXlvdXQ/OiBDbGFzc0xheW91dCxcbiAgKTogUHJvbWlzZTxSZXN1bHQ8dm9pZD4+IHtcbiAgICBpZiAoIWxheW91dCkge1xuICAgICAgcmV0dXJuIFJlc3VsdC5mYWlsKFwiTGF5b3V0IGlzIHJlcXVpcmVkIGZvciBjdXN0b20gcmVuZGVyaW5nIHN0cmF0ZWd5XCIpO1xuICAgIH1cblxuICAgIGlmICghY29udGV4dC5jb250YWluZXIpIHtcbiAgICAgIHJldHVybiBSZXN1bHQuZmFpbChcIkNvbnRhaW5lciBpcyByZXF1aXJlZCBmb3IgcmVuZGVyaW5nXCIpO1xuICAgIH1cblxuICAgIGlmICghY29udGV4dC5tZXRhZGF0YT8uZnJvbnRtYXR0ZXIpIHtcbiAgICAgIHRoaXMucmVuZGVyRXJyb3IoXG4gICAgICAgIGNvbnRleHQuY29udGFpbmVyLFxuICAgICAgICBcIk5vIG1ldGFkYXRhIGF2YWlsYWJsZSBmb3IgdGhpcyBmaWxlXCIsXG4gICAgICApO1xuICAgICAgcmV0dXJuIFJlc3VsdC5mYWlsKFwiTm8gbWV0YWRhdGEgYXZhaWxhYmxlXCIpO1xuICAgIH1cblxuICAgIHRyeSB7XG4gICAgICAvLyBBZGQgbGF5b3V0IGluZm8gKGhpZGRlbiBtZXRhZGF0YSlcbiAgICAgIHRoaXMuYWRkTGF5b3V0SW5mbyhjb250ZXh0LmNvbnRhaW5lciwgbGF5b3V0KTtcblxuICAgICAgLy8gUmVuZGVyIGVhY2ggdmlzaWJsZSBibG9ja1xuICAgICAgY29uc3QgdmlzaWJsZUJsb2NrcyA9IGxheW91dC5nZXRWaXNpYmxlQmxvY2tzKCk7XG5cbiAgICAgIGZvciAoY29uc3QgYmxvY2sgb2YgdmlzaWJsZUJsb2Nrcykge1xuICAgICAgICBjb25zdCBibG9ja1Jlc3VsdCA9IGF3YWl0IHRoaXMucmVuZGVyQmxvY2soY29udGV4dCwgYmxvY2ssIGxheW91dCk7XG4gICAgICAgIGlmIChibG9ja1Jlc3VsdC5pc0ZhaWx1cmUpIHtcbiAgICAgICAgICBjb25zb2xlLmVycm9yKFxuICAgICAgICAgICAgYEZhaWxlZCB0byByZW5kZXIgYmxvY2sgJHtibG9jay5pZH06YCxcbiAgICAgICAgICAgIGJsb2NrUmVzdWx0LmVycm9yLFxuICAgICAgICAgICk7XG4gICAgICAgICAgLy8gQ29udGludWUgd2l0aCBvdGhlciBibG9ja3MgcmF0aGVyIHRoYW4gZmFpbGluZyBjb21wbGV0ZWx5XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgcmV0dXJuIFJlc3VsdC5vaygpO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICByZXR1cm4gUmVzdWx0LmZhaWwoYEN1c3RvbSBsYXlvdXQgcmVuZGVyaW5nIGZhaWxlZDogJHtlcnJvcn1gKTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGFkZExheW91dEluZm8oY29udGFpbmVyOiBIVE1MRWxlbWVudCwgbGF5b3V0OiBDbGFzc0xheW91dCk6IHZvaWQge1xuICAgIGNvbnN0IGxheW91dEluZm8gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuICAgIGxheW91dEluZm8uY2xhc3NOYW1lID0gXCJleG9jb3J0ZXgtbGF5b3V0LWluZm9cIjtcbiAgICBsYXlvdXRJbmZvLnN0eWxlLmRpc3BsYXkgPSBcIm5vbmVcIjtcbiAgICBsYXlvdXRJbmZvLnNldEF0dHJpYnV0ZShcImRhdGEtbGF5b3V0LWlkXCIsIGxheW91dC5pZC50b1N0cmluZygpKTtcbiAgICBsYXlvdXRJbmZvLnNldEF0dHJpYnV0ZShcImRhdGEtbGF5b3V0LWNsYXNzXCIsIGxheW91dC50YXJnZXRDbGFzcy52YWx1ZSk7XG4gICAgY29udGFpbmVyLmFwcGVuZENoaWxkKGxheW91dEluZm8pO1xuICB9XG5cbiAgcHJpdmF0ZSBhc3luYyByZW5kZXJCbG9jayhcbiAgICBjb250ZXh0OiBMYXlvdXRSZW5kZXJpbmdDb250ZXh0LFxuICAgIGJsb2NrOiBhbnksXG4gICAgbGF5b3V0OiBDbGFzc0xheW91dCxcbiAgKTogUHJvbWlzZTxSZXN1bHQ8dm9pZD4+IHtcbiAgICB0cnkge1xuICAgICAgLy8gQ3JlYXRlIGJsb2NrIGNvbnRhaW5lciBzdHJ1Y3R1cmVcbiAgICAgIGNvbnN0IGJsb2NrQ29udGFpbmVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcbiAgICAgIGJsb2NrQ29udGFpbmVyLmNsYXNzTmFtZSA9IGBleG9jb3J0ZXgtYmxvY2sgZXhvY29ydGV4LWJsb2NrLSR7YmxvY2sudHlwZX1gO1xuICAgICAgYmxvY2tDb250YWluZXIuc2V0QXR0cmlidXRlKFwiZGF0YS1ibG9jay1pZFwiLCBibG9jay5pZCk7XG4gICAgICBjb250ZXh0LmNvbnRhaW5lci5hcHBlbmRDaGlsZChibG9ja0NvbnRhaW5lcik7XG5cbiAgICAgIC8vIEFkZCBibG9jayBoZWFkZXIgaWYgdGl0bGUgZXhpc3RzXG4gICAgICBpZiAoYmxvY2sudGl0bGUpIHtcbiAgICAgICAgY29uc3QgaGVhZGVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImgzXCIpO1xuICAgICAgICBoZWFkZXIudGV4dENvbnRlbnQgPSBibG9jay50aXRsZTtcbiAgICAgICAgaGVhZGVyLmNsYXNzTmFtZSA9IFwiZXhvY29ydGV4LWJsb2NrLWhlYWRlclwiO1xuICAgICAgICBibG9ja0NvbnRhaW5lci5hcHBlbmRDaGlsZChoZWFkZXIpO1xuXG4gICAgICAgIC8vIEFkZCBjb2xsYXBzZSB0b2dnbGUgaWYgY29sbGFwc2libGVcbiAgICAgICAgaWYgKGJsb2NrLmlzQ29sbGFwc2libGUpIHtcbiAgICAgICAgICBoZWFkZXIuY2xhc3NMaXN0LmFkZChcImlzLWNvbGxhcHNpYmxlXCIpO1xuICAgICAgICAgIGhlYWRlci5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xuICAgICAgICAgICAgYmxvY2tDb250YWluZXIuY2xhc3NMaXN0LnRvZ2dsZShcbiAgICAgICAgICAgICAgXCJpcy1jb2xsYXBzZWRcIixcbiAgICAgICAgICAgICAgIWJsb2NrQ29udGFpbmVyLmNsYXNzTGlzdC5jb250YWlucyhcImlzLWNvbGxhcHNlZFwiKSxcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgLy8gQ3JlYXRlIGNvbnRlbnQgY29udGFpbmVyXG4gICAgICBjb25zdCBjb250ZW50Q29udGFpbmVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcbiAgICAgIGNvbnRlbnRDb250YWluZXIuY2xhc3NOYW1lID0gXCJleG9jb3J0ZXgtYmxvY2stY29udGVudFwiO1xuICAgICAgYmxvY2tDb250YWluZXIuYXBwZW5kQ2hpbGQoY29udGVudENvbnRhaW5lcik7XG5cbiAgICAgIC8vIEdldCBhcHByb3ByaWF0ZSByZW5kZXJlciBmb3IgYmxvY2sgdHlwZVxuICAgICAgY29uc3QgcmVuZGVyZXJSZXN1bHQgPSB0aGlzLmJsb2NrUmVuZGVyZXJGYWN0b3J5LmNyZWF0ZVJlbmRlcmVyKFxuICAgICAgICBibG9jay50eXBlLFxuICAgICAgKTtcbiAgICAgIGlmIChyZW5kZXJlclJlc3VsdC5pc0ZhaWx1cmUpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMucmVuZGVyQmxvY2tFcnJvcihcbiAgICAgICAgICBjb250ZW50Q29udGFpbmVyLFxuICAgICAgICAgIGBVbmtub3duIGJsb2NrIHR5cGU6ICR7YmxvY2sudHlwZX1gLFxuICAgICAgICApO1xuICAgICAgfVxuXG4gICAgICBjb25zdCByZW5kZXJlciA9IHJlbmRlcmVyUmVzdWx0LmdldFZhbHVlKCk7XG5cbiAgICAgIC8vIENyZWF0ZSBibG9jayByZW5kZXJpbmcgY29udGV4dFxuICAgICAgY29uc3QgYmxvY2tDb250ZXh0OiBCbG9ja1JlbmRlcmluZ0NvbnRleHQgPSB7XG4gICAgICAgIGNvbnRhaW5lcjogY29udGVudENvbnRhaW5lcixcbiAgICAgICAgY29uZmlnOiBibG9jay5jb25maWcsXG4gICAgICAgIGZpbGU6IGNvbnRleHQuZmlsZSxcbiAgICAgICAgZnJvbnRtYXR0ZXI6IGNvbnRleHQubWV0YWRhdGEuZnJvbnRtYXR0ZXIsXG4gICAgICAgIGRhdGF2aWV3QXBpOiBjb250ZXh0LmRhdGF2aWV3QXBpLFxuICAgICAgfTtcblxuICAgICAgLy8gUmVuZGVyIGJsb2NrIGNvbnRlbnRcbiAgICAgIGNvbnN0IHJlbmRlclJlc3VsdCA9IGF3YWl0IHJlbmRlcmVyLnJlbmRlcihibG9ja0NvbnRleHQpO1xuICAgICAgaWYgKHJlbmRlclJlc3VsdC5pc0ZhaWx1cmUpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMucmVuZGVyQmxvY2tFcnJvcihcbiAgICAgICAgICBjb250ZW50Q29udGFpbmVyLFxuICAgICAgICAgIGBFcnJvciByZW5kZXJpbmcgYmxvY2s6ICR7cmVuZGVyUmVzdWx0LmVycm9yfWAsXG4gICAgICAgICk7XG4gICAgICB9XG5cbiAgICAgIHJldHVybiBSZXN1bHQub2soKTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgcmV0dXJuIFJlc3VsdC5mYWlsKGBCbG9jayByZW5kZXJpbmcgZmFpbGVkOiAke2Vycm9yfWApO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgcmVuZGVyRXJyb3IoY29udGFpbmVyOiBIVE1MRWxlbWVudCwgZXJyb3I6IHN0cmluZyk6IHZvaWQge1xuICAgIGNvbnN0IGVycm9yRGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcbiAgICBlcnJvckRpdi50ZXh0Q29udGVudCA9IGBMYXlvdXQgRXJyb3I6ICR7ZXJyb3J9YDtcbiAgICBlcnJvckRpdi5jbGFzc05hbWUgPSBcImV4b2NvcnRleC1lcnJvciBub3RpY2UtZXJyb3JcIjtcbiAgICBjb250YWluZXIuYXBwZW5kQ2hpbGQoZXJyb3JEaXYpO1xuICB9XG5cbiAgcHJpdmF0ZSByZW5kZXJCbG9ja0Vycm9yKFxuICAgIGNvbnRhaW5lcjogSFRNTEVsZW1lbnQsXG4gICAgZXJyb3I6IHN0cmluZyxcbiAgKTogUmVzdWx0PHZvaWQ+IHtcbiAgICBjb25zdCBlcnJvclAgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwicFwiKTtcbiAgICBlcnJvclAudGV4dENvbnRlbnQgPSBlcnJvcjtcbiAgICBlcnJvclAuY2xhc3NOYW1lID0gXCJleG9jb3J0ZXgtZXJyb3JcIjtcbiAgICBjb250YWluZXIuYXBwZW5kQ2hpbGQoZXJyb3JQKTtcbiAgICByZXR1cm4gUmVzdWx0Lm9rKCk7IC8vIFJldHVybiBvayBzaW5jZSB3ZSBoYW5kbGVkIHRoZSBlcnJvciBncmFjZWZ1bGx5XG4gIH1cbn1cbiJdLCJ2ZXJzaW9uIjozfQ==