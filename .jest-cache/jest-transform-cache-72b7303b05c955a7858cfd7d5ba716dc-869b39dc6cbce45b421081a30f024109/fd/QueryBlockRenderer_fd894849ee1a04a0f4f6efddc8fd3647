78156b99d7ee5b422686c5764e30c822
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.QueryBlockRenderer = void 0;
const tslib_1 = require("tslib");
const ExecuteQueryBlockUseCase_1 = require("../../application/use-cases/ExecuteQueryBlockUseCase");
class QueryBlockRenderer {
    constructor(app) {
        this.app = app;
        this.executeQueryUseCase = new ExecuteQueryBlockUseCase_1.ExecuteQueryBlockUseCase(app);
    }
    render(container, config, file, frontmatter, dv) {
        return tslib_1.__awaiter(this, void 0, void 0, function* () {
            try {
                if (!config) {
                    container.createEl('p', {
                        text: 'Query configuration is missing',
                        cls: 'exocortex-error'
                    });
                    return;
                }
                const queryConfig = config;
                // Execute query
                const result = yield this.executeQueryUseCase.execute({
                    blockConfig: queryConfig,
                    currentAssetPath: file.path,
                    currentAssetFrontmatter: frontmatter
                });
                if (result.isFailure) {
                    container.createEl('p', {
                        text: `Query failed: ${result.error}`,
                        cls: 'exocortex-error'
                    });
                    return;
                }
                const { results, totalCount, executionTime } = result.getValue();
                // Show result count and execution time
                const info = container.createDiv({ cls: 'exocortex-query-info' });
                info.createEl('span', {
                    text: `Found ${totalCount} items${results.length < totalCount ? `, showing ${results.length}` : ''} (${executionTime}ms)`,
                    cls: 'exocortex-query-count'
                });
                if (results.length === 0) {
                    container.createEl('p', {
                        text: 'No items found',
                        cls: 'exocortex-empty'
                    });
                    return;
                }
                // Render based on display type
                switch (queryConfig.displayAs) {
                    case 'table':
                        this.renderTable(container, results, dv);
                        break;
                    case 'cards':
                        this.renderCards(container, results);
                        break;
                    case 'list':
                    default:
                        this.renderList(container, results);
                        break;
                }
            }
            catch (error) {
                container.createEl('p', {
                    text: `Error rendering query block: ${error}`,
                    cls: 'exocortex-error'
                });
                console.error('Query block render error:', error);
            }
        });
    }
    renderList(container, files) {
        const list = container.createEl('ul', { cls: 'exocortex-query-list' });
        files.forEach(file => {
            const metadata = this.app.metadataCache.getFileCache(file);
            const frontmatter = (metadata === null || metadata === void 0 ? void 0 : metadata.frontmatter) || {};
            const item = list.createEl('li');
            const link = item.createEl('a', {
                text: frontmatter['exo__Asset_label'] || file.basename,
                href: file.path,
                cls: 'internal-link'
            });
            // Add status or other info if available
            const status = frontmatter['ems__Effort_status'];
            if (status) {
                const statusSpan = item.createEl('span', {
                    text: ` - ${this.cleanValue(status)}`,
                    cls: 'exocortex-status'
                });
            }
        });
    }
    renderTable(container, files, dv) {
        // Collect all unique properties
        const allProps = new Set();
        files.forEach(file => {
            const metadata = this.app.metadataCache.getFileCache(file);
            if (metadata === null || metadata === void 0 ? void 0 : metadata.frontmatter) {
                Object.keys(metadata.frontmatter).forEach(key => {
                    if (!key.startsWith('exo__Instance')) {
                        allProps.add(key);
                    }
                });
            }
        });
        // Select most relevant properties (max 5)
        const relevantProps = Array.from(allProps)
            .filter(p => !p.startsWith('exo__Asset_uid'))
            .slice(0, 5);
        // Create table
        const table = container.createEl('table', { cls: 'exocortex-query-table' });
        // Header
        const thead = table.createEl('thead');
        const headerRow = thead.createEl('tr');
        headerRow.createEl('th', { text: 'Name' });
        relevantProps.forEach(prop => {
            const displayName = prop.replace(/_/g, ' ').replace(/^\w+__/, '');
            headerRow.createEl('th', { text: displayName });
        });
        // Body
        const tbody = table.createEl('tbody');
        files.forEach(file => {
            const metadata = this.app.metadataCache.getFileCache(file);
            const frontmatter = (metadata === null || metadata === void 0 ? void 0 : metadata.frontmatter) || {};
            const row = tbody.createEl('tr');
            // Name cell with link
            const nameCell = row.createEl('td');
            nameCell.createEl('a', {
                text: frontmatter['exo__Asset_label'] || file.basename,
                href: file.path,
                cls: 'internal-link'
            });
            // Property cells
            relevantProps.forEach(prop => {
                const cell = row.createEl('td');
                const value = frontmatter[prop];
                if (value) {
                    cell.setText(this.formatValue(value));
                }
            });
        });
    }
    renderCards(container, files) {
        const cardsContainer = container.createDiv({ cls: 'exocortex-query-cards' });
        files.forEach(file => {
            const metadata = this.app.metadataCache.getFileCache(file);
            const frontmatter = (metadata === null || metadata === void 0 ? void 0 : metadata.frontmatter) || {};
            const card = cardsContainer.createDiv({ cls: 'exocortex-card' });
            // Card header
            const header = card.createDiv({ cls: 'exocortex-card-header' });
            header.createEl('a', {
                text: frontmatter['exo__Asset_label'] || file.basename,
                href: file.path,
                cls: 'internal-link'
            });
            // Card body with key properties
            const body = card.createDiv({ cls: 'exocortex-card-body' });
            // Show status if available
            const status = frontmatter['ems__Effort_status'];
            if (status) {
                body.createEl('div', {
                    text: `Status: ${this.cleanValue(status)}`,
                    cls: 'exocortex-card-status'
                });
            }
            // Show description if available
            const description = frontmatter['exo__Asset_description'];
            if (description) {
                body.createEl('div', {
                    text: description,
                    cls: 'exocortex-card-description'
                });
            }
        });
    }
    cleanValue(value) {
        if (!value)
            return '';
        const str = Array.isArray(value) ? value[0] : value;
        return (str === null || str === void 0 ? void 0 : str.toString().replace(/\[\[|\]\]/g, '')) || '';
    }
    formatValue(value) {
        if (Array.isArray(value)) {
            return value.map(v => this.cleanValue(v)).join(', ');
        }
        return this.cleanValue(value);
    }
}
exports.QueryBlockRenderer = QueryBlockRenderer;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL2tpdGVsZXYvRG9jdW1lbnRzL2V4b2NvcnRleC1vYnNpZGlhbi1wbHVnaW4vc3JjL3ByZXNlbnRhdGlvbi9yZW5kZXJlcnMvUXVlcnlCbG9ja1JlbmRlcmVyLnRzIiwibWFwcGluZ3MiOiI7Ozs7QUFDQSxtR0FBZ0c7QUFHaEcsTUFBYSxrQkFBa0I7SUFHM0IsWUFBb0IsR0FBUTtRQUFSLFFBQUcsR0FBSCxHQUFHLENBQUs7UUFDeEIsSUFBSSxDQUFDLG1CQUFtQixHQUFHLElBQUksbURBQXdCLENBQUMsR0FBRyxDQUFDLENBQUM7SUFDakUsQ0FBQztJQUVLLE1BQU0sQ0FDUixTQUFzQixFQUN0QixNQUFXLEVBQ1gsSUFBVyxFQUNYLFdBQWdCLEVBQ2hCLEVBQU87O1lBRVAsSUFBSTtnQkFDQSxJQUFJLENBQUMsTUFBTSxFQUFFO29CQUNULFNBQVMsQ0FBQyxRQUFRLENBQUMsR0FBRyxFQUFFO3dCQUNwQixJQUFJLEVBQUUsZ0NBQWdDO3dCQUN0QyxHQUFHLEVBQUUsaUJBQWlCO3FCQUN6QixDQUFDLENBQUM7b0JBQ0gsT0FBTztpQkFDVjtnQkFFRCxNQUFNLFdBQVcsR0FBRyxNQUEwQixDQUFDO2dCQUUvQyxnQkFBZ0I7Z0JBQ2hCLE1BQU0sTUFBTSxHQUFHLE1BQU0sSUFBSSxDQUFDLG1CQUFtQixDQUFDLE9BQU8sQ0FBQztvQkFDbEQsV0FBVyxFQUFFLFdBQVc7b0JBQ3hCLGdCQUFnQixFQUFFLElBQUksQ0FBQyxJQUFJO29CQUMzQix1QkFBdUIsRUFBRSxXQUFXO2lCQUN2QyxDQUFDLENBQUM7Z0JBRVAsSUFBSSxNQUFNLENBQUMsU0FBUyxFQUFFO29CQUNsQixTQUFTLENBQUMsUUFBUSxDQUFDLEdBQUcsRUFBRTt3QkFDcEIsSUFBSSxFQUFFLGlCQUFpQixNQUFNLENBQUMsS0FBSyxFQUFFO3dCQUNyQyxHQUFHLEVBQUUsaUJBQWlCO3FCQUN6QixDQUFDLENBQUM7b0JBQ0gsT0FBTztpQkFDVjtnQkFFRCxNQUFNLEVBQUUsT0FBTyxFQUFFLFVBQVUsRUFBRSxhQUFh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QUssQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO1NBQ3hEO1FBQ0QsT0FBTyxJQUFJLENBQUMsVUFBVSxDQUFDLEtBQUssQ0FBQyxDQUFDO0lBQ2xDLENBQUM7Q0FDSjtBQXhORCxnREF3TkMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL1VzZXJzL2tpdGVsZXYvRG9jdW1lbnRzL2V4b2NvcnRleC1vYnNpZGlhbi1wbHVnaW4vc3JjL3ByZXNlbnRhdGlvbi9yZW5kZXJlcnMvUXVlcnlCbG9ja1JlbmRlcmVyLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEFwcCwgVEZpbGUgfSBmcm9tICdvYnNpZGlhbic7XG5pbXBvcnQgeyBFeGVjdXRlUXVlcnlCbG9ja1VzZUNhc2UgfSBmcm9tICcuLi8uLi9hcHBsaWNhdGlvbi91c2UtY2FzZXMvRXhlY3V0ZVF1ZXJ5QmxvY2tVc2VDYXNlJztcbmltcG9ydCB7IFF1ZXJ5QmxvY2tDb25maWcgfSBmcm9tICcuLi8uLi9kb21haW4vZW50aXRpZXMvTGF5b3V0QmxvY2snO1xuXG5leHBvcnQgY2xhc3MgUXVlcnlCbG9ja1JlbmRlcmVyIHtcbiAgICBwcml2YXRlIGV4ZWN1dGVRdWVyeVVzZUNhc2U6IEV4ZWN1dGVRdWVyeUJsb2NrVXNlQ2FzZTtcblxuICAgIGNvbnN0cnVjdG9yKHByaXZhdGUgYXBwOiBBcHApIHtcbiAgICAgICAgdGhpcy5leGVjdXRlUXVlcnlVc2VDYXNlID0gbmV3IEV4ZWN1dGVRdWVyeUJsb2NrVXNlQ2FzZShhcHApO1xuICAgIH1cblxuICAgIGFzeW5jIHJlbmRlcihcbiAgICAgICAgY29udGFpbmVyOiBIVE1MRWxlbWVudCxcbiAgICAgICAgY29uZmlnOiBhbnksXG4gICAgICAgIGZpbGU6IFRGaWxlLFxuICAgICAgICBmcm9udG1hdHRlcjogYW55LFxuICAgICAgICBkdjogYW55XG4gICAgKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBpZiAoIWNvbmZpZykge1xuICAgICAgICAgICAgICAgIGNvbnRhaW5lci5jcmVhdGVFbCgncCcsIHsgXG4gICAgICAgICAgICAgICAgICAgIHRleHQ6ICdRdWVyeSBjb25maWd1cmF0aW9uIGlzIG1pc3NpbmcnLFxuICAgICAgICAgICAgICAgICAgICBjbHM6ICdleG9jb3J0ZXgtZXJyb3InXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBjb25zdCBxdWVyeUNvbmZpZyA9IGNvbmZpZyBhcyBRdWVyeUJsb2NrQ29uZmlnO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICAvLyBFeGVjdXRlIHF1ZXJ5XG4gICAgICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB0aGlzLmV4ZWN1dGVRdWVyeVVzZUNhc2UuZXhlY3V0ZSh7XG4gICAgICAgICAgICAgICAgYmxvY2tDb25maWc6IHF1ZXJ5Q29uZmlnLFxuICAgICAgICAgICAgICAgIGN1cnJlbnRBc3NldFBhdGg6IGZpbGUucGF0aCxcbiAgICAgICAgICAgICAgICBjdXJyZW50QXNzZXRGcm9udG1hdHRlcjogZnJvbnRtYXR0ZXJcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgIGlmIChyZXN1bHQuaXNGYWlsdXJlKSB7XG4gICAgICAgICAgICBjb250YWluZXIuY3JlYXRlRWwoJ3AnLCB7IFxuICAgICAgICAgICAgICAgIHRleHQ6IGBRdWVyeSBmYWlsZWQ6ICR7cmVzdWx0LmVycm9yfWAsXG4gICAgICAgICAgICAgICAgY2xzOiAnZXhvY29ydGV4LWVycm9yJ1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCB7IHJlc3VsdHMsIHRvdGFsQ291bnQsIGV4ZWN1dGlvblRpbWUgfSA9IHJlc3VsdC5nZXRWYWx1ZSgpO1xuXG4gICAgICAgIC8vIFNob3cgcmVzdWx0IGNvdW50IGFuZCBleGVjdXRpb24gdGltZVxuICAgICAgICBjb25zdCBpbmZvID0gY29udGFpbmVyLmNyZWF0ZURpdih7IGNsczogJ2V4b2NvcnRleC1xdWVyeS1pbmZvJyB9KTtcbiAgICAgICAgaW5mby5jcmVhdGVFbCgnc3BhbicsIHsgXG4gICAgICAgICAgICB0ZXh0OiBgRm91bmQgJHt0b3RhbENvdW50fSBpdGVtcyR7cmVzdWx0cy5sZW5ndGggPCB0b3RhbENvdW50ID8gYCwgc2hvd2luZyAke3Jlc3VsdHMubGVuZ3RofWAgOiAnJ30gKCR7ZXhlY3V0aW9uVGltZX1tcylgLFxuICAgICAgICAgICAgY2xzOiAnZXhvY29ydGV4LXF1ZXJ5LWNvdW50J1xuICAgICAgICB9KTtcblxuICAgICAgICBpZiAocmVzdWx0cy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgIGNvbnRhaW5lci5jcmVhdGVFbCgncCcsIHsgXG4gICAgICAgICAgICAgICAgdGV4dDogJ05vIGl0ZW1zIGZvdW5kJyxcbiAgICAgICAgICAgICAgICBjbHM6ICdleG9jb3J0ZXgtZW1wdHknXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIFJlbmRlciBiYXNlZCBvbiBkaXNwbGF5IHR5cGVcbiAgICAgICAgc3dpdGNoIChxdWVyeUNvbmZpZy5kaXNwbGF5QXMpIHtcbiAgICAgICAgICAgIGNhc2UgJ3RhYmxlJzpcbiAgICAgICAgICAgICAgICB0aGlzLnJlbmRlclRhYmxlKGNvbnRhaW5lciwgcmVzdWx0cywgZHYpO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgY2FzZSAnY2FyZHMnOlxuICAgICAgICAgICAgICAgIHRoaXMucmVuZGVyQ2FyZHMoY29udGFpbmVyLCByZXN1bHRzKTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgIGNhc2UgJ2xpc3QnOlxuICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICB0aGlzLnJlbmRlckxpc3QoY29udGFpbmVyLCByZXN1bHRzKTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgY29udGFpbmVyLmNyZWF0ZUVsKCdwJywgeyBcbiAgICAgICAgICAgICAgICB0ZXh0OiBgRXJyb3IgcmVuZGVyaW5nIHF1ZXJ5IGJsb2NrOiAke2Vycm9yfWAsXG4gICAgICAgICAgICAgICAgY2xzOiAnZXhvY29ydGV4LWVycm9yJ1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKCdRdWVyeSBibG9jayByZW5kZXIgZXJyb3I6JywgZXJyb3IpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHJpdmF0ZSByZW5kZXJMaXN0KGNvbnRhaW5lcjogSFRNTEVsZW1lbnQsIGZpbGVzOiBURmlsZVtdKTogdm9pZCB7XG4gICAgICAgIGNvbnN0IGxpc3QgPSBjb250YWluZXIuY3JlYXRlRWwoJ3VsJywgeyBjbHM6ICdleG9jb3J0ZXgtcXVlcnktbGlzdCcgfSk7XG4gICAgICAgIFxuICAgICAgICBmaWxlcy5mb3JFYWNoKGZpbGUgPT4ge1xuICAgICAgICAgICAgY29uc3QgbWV0YWRhdGEgPSB0aGlzLmFwcC5tZXRhZGF0YUNhY2hlLmdldEZpbGVDYWNoZShmaWxlKTtcbiAgICAgICAgICAgIGNvbnN0IGZyb250bWF0dGVyID0gbWV0YWRhdGE/LmZyb250bWF0dGVyIHx8IHt9O1xuICAgICAgICAgICAgXG4gICAgICAgICAgICBjb25zdCBpdGVtID0gbGlzdC5jcmVhdGVFbCgnbGknKTtcbiAgICAgICAgICAgIGNvbnN0IGxpbmsgPSBpdGVtLmNyZWF0ZUVsKCdhJywge1xuICAgICAgICAgICAgICAgIHRleHQ6IGZyb250bWF0dGVyWydleG9fX0Fzc2V0X2xhYmVsJ10gfHwgZmlsZS5iYXNlbmFtZSxcbiAgICAgICAgICAgICAgICBocmVmOiBmaWxlLnBhdGgsXG4gICAgICAgICAgICAgICAgY2xzOiAnaW50ZXJuYWwtbGluaydcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICAvLyBBZGQgc3RhdHVzIG9yIG90aGVyIGluZm8gaWYgYXZhaWxhYmxlXG4gICAgICAgICAgICBjb25zdCBzdGF0dXMgPSBmcm9udG1hdHRlclsnZW1zX19FZmZvcnRfc3RhdHVzJ107XG4gICAgICAgICAgICBpZiAoc3RhdHVzKSB7XG4gICAgICAgICAgICAgICAgY29uc3Qgc3RhdHVzU3BhbiA9IGl0ZW0uY3JlYXRlRWwoJ3NwYW4nLCB7XG4gICAgICAgICAgICAgICAgICAgIHRleHQ6IGAgLSAke3RoaXMuY2xlYW5WYWx1ZShzdGF0dXMpfWAsXG4gICAgICAgICAgICAgICAgICAgIGNsczogJ2V4b2NvcnRleC1zdGF0dXMnXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIHByaXZhdGUgcmVuZGVyVGFibGUoY29udGFpbmVyOiBIVE1MRWxlbWVudCwgZmlsZXM6IFRGaWxlW10sIGR2OiBhbnkpOiB2b2lkIHtcbiAgICAgICAgLy8gQ29sbGVjdCBhbGwgdW5pcXVlIHByb3BlcnRpZXNcbiAgICAgICAgY29uc3QgYWxsUHJvcHMgPSBuZXcgU2V0PHN0cmluZz4oKTtcbiAgICAgICAgZmlsZXMuZm9yRWFjaChmaWxlID0+IHtcbiAgICAgICAgICAgIGNvbnN0IG1ldGFkYXRhID0gdGhpcy5hcHAubWV0YWRhdGFDYWNoZS5nZXRGaWxlQ2FjaGUoZmlsZSk7XG4gICAgICAgICAgICBpZiAobWV0YWRhdGE/LmZyb250bWF0dGVyKSB7XG4gICAgICAgICAgICAgICAgT2JqZWN0LmtleXMobWV0YWRhdGEuZnJvbnRtYXR0ZXIpLmZvckVhY2goa2V5ID0+IHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFrZXkuc3RhcnRzV2l0aCgnZXhvX19JbnN0YW5jZScpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBhbGxQcm9wcy5hZGQoa2V5KTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICAvLyBTZWxlY3QgbW9zdCByZWxldmFudCBwcm9wZXJ0aWVzIChtYXggNSlcbiAgICAgICAgY29uc3QgcmVsZXZhbnRQcm9wcyA9IEFycmF5LmZyb20oYWxsUHJvcHMpXG4gICAgICAgICAgICAuZmlsdGVyKHAgPT4gIXAuc3RhcnRzV2l0aCgnZXhvX19Bc3NldF91aWQnKSlcbiAgICAgICAgICAgIC5zbGljZSgwLCA1KTtcblxuICAgICAgICAvLyBDcmVhdGUgdGFibGVcbiAgICAgICAgY29uc3QgdGFibGUgPSBjb250YWluZXIuY3JlYXRlRWwoJ3RhYmxlJywgeyBjbHM6ICdleG9jb3J0ZXgtcXVlcnktdGFibGUnIH0pO1xuICAgICAgICBcbiAgICAgICAgLy8gSGVhZGVyXG4gICAgICAgIGNvbnN0IHRoZWFkID0gdGFibGUuY3JlYXRlRWwoJ3RoZWFkJyk7XG4gICAgICAgIGNvbnN0IGhlYWRlclJvdyA9IHRoZWFkLmNyZWF0ZUVsKCd0cicpO1xuICAgICAgICBoZWFkZXJSb3cuY3JlYXRlRWwoJ3RoJywgeyB0ZXh0OiAnTmFtZScgfSk7XG4gICAgICAgIHJlbGV2YW50UHJvcHMuZm9yRWFjaChwcm9wID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGRpc3BsYXlOYW1lID0gcHJvcC5yZXBsYWNlKC9fL2csICcgJykucmVwbGFjZSgvXlxcdytfXy8sICcnKTtcbiAgICAgICAgICAgIGhlYWRlclJvdy5jcmVhdGVFbCgndGgnLCB7IHRleHQ6IGRpc3BsYXlOYW1lIH0pO1xuICAgICAgICB9KTtcblxuICAgICAgICAvLyBCb2R5XG4gICAgICAgIGNvbnN0IHRib2R5ID0gdGFibGUuY3JlYXRlRWwoJ3Rib2R5Jyk7XG4gICAgICAgIGZpbGVzLmZvckVhY2goZmlsZSA9PiB7XG4gICAgICAgICAgICBjb25zdCBtZXRhZGF0YSA9IHRoaXMuYXBwLm1ldGFkYXRhQ2FjaGUuZ2V0RmlsZUNhY2hlKGZpbGUpO1xuICAgICAgICAgICAgY29uc3QgZnJvbnRtYXR0ZXIgPSBtZXRhZGF0YT8uZnJvbnRtYXR0ZXIgfHwge307XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGNvbnN0IHJvdyA9IHRib2R5LmNyZWF0ZUVsKCd0cicpO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICAvLyBOYW1lIGNlbGwgd2l0aCBsaW5rXG4gICAgICAgICAgICBjb25zdCBuYW1lQ2VsbCA9IHJvdy5jcmVhdGVFbCgndGQnKTtcbiAgICAgICAgICAgIG5hbWVDZWxsLmNyZWF0ZUVsKCdhJywge1xuICAgICAgICAgICAgICAgIHRleHQ6IGZyb250bWF0dGVyWydleG9fX0Fzc2V0X2xhYmVsJ10gfHwgZmlsZS5iYXNlbmFtZSxcbiAgICAgICAgICAgICAgICBocmVmOiBmaWxlLnBhdGgsXG4gICAgICAgICAgICAgICAgY2xzOiAnaW50ZXJuYWwtbGluaydcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICAvLyBQcm9wZXJ0eSBjZWxsc1xuICAgICAgICAgICAgcmVsZXZhbnRQcm9wcy5mb3JFYWNoKHByb3AgPT4ge1xuICAgICAgICAgICAgICAgIGNvbnN0IGNlbGwgPSByb3cuY3JlYXRlRWwoJ3RkJyk7XG4gICAgICAgICAgICAgICAgY29uc3QgdmFsdWUgPSBmcm9udG1hdHRlcltwcm9wXTtcbiAgICAgICAgICAgICAgICBpZiAodmFsdWUpIHtcbiAgICAgICAgICAgICAgICAgICAgY2VsbC5zZXRUZXh0KHRoaXMuZm9ybWF0VmFsdWUodmFsdWUpKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSByZW5kZXJDYXJkcyhjb250YWluZXI6IEhUTUxFbGVtZW50LCBmaWxlczogVEZpbGVbXSk6IHZvaWQge1xuICAgICAgICBjb25zdCBjYXJkc0NvbnRhaW5lciA9IGNvbnRhaW5lci5jcmVhdGVEaXYoeyBjbHM6ICdleG9jb3J0ZXgtcXVlcnktY2FyZHMnIH0pO1xuICAgICAgICBcbiAgICAgICAgZmlsZXMuZm9yRWFjaChmaWxlID0+IHtcbiAgICAgICAgICAgIGNvbnN0IG1ldGFkYXRhID0gdGhpcy5hcHAubWV0YWRhdGFDYWNoZS5nZXRGaWxlQ2FjaGUoZmlsZSk7XG4gICAgICAgICAgICBjb25zdCBmcm9udG1hdHRlciA9IG1ldGFkYXRhPy5mcm9udG1hdHRlciB8fCB7fTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgY29uc3QgY2FyZCA9IGNhcmRzQ29udGFpbmVyLmNyZWF0ZURpdih7IGNsczogJ2V4b2NvcnRleC1jYXJkJyB9KTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgLy8gQ2FyZCBoZWFkZXJcbiAgICAgICAgICAgIGNvbnN0IGhlYWRlciA9IGNhcmQuY3JlYXRlRGl2KHsgY2xzOiAnZXhvY29ydGV4LWNhcmQtaGVhZGVyJyB9KTtcbiAgICAgICAgICAgIGhlYWRlci5jcmVhdGVFbCgnYScsIHtcbiAgICAgICAgICAgICAgICB0ZXh0OiBmcm9udG1hdHRlclsnZXhvX19Bc3NldF9sYWJlbCddIHx8IGZpbGUuYmFzZW5hbWUsXG4gICAgICAgICAgICAgICAgaHJlZjogZmlsZS5wYXRoLFxuICAgICAgICAgICAgICAgIGNsczogJ2ludGVybmFsLWxpbmsnXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgLy8gQ2FyZCBib2R5IHdpdGgga2V5IHByb3BlcnRpZXNcbiAgICAgICAgICAgIGNvbnN0IGJvZHkgPSBjYXJkLmNyZWF0ZURpdih7IGNsczogJ2V4b2NvcnRleC1jYXJkLWJvZHknIH0pO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICAvLyBTaG93IHN0YXR1cyBpZiBhdmFpbGFibGVcbiAgICAgICAgICAgIGNvbnN0IHN0YXR1cyA9IGZyb250bWF0dGVyWydlbXNfX0VmZm9ydF9zdGF0dXMnXTtcbiAgICAgICAgICAgIGlmIChzdGF0dXMpIHtcbiAgICAgICAgICAgICAgICBib2R5LmNyZWF0ZUVsKCdkaXYnLCB7XG4gICAgICAgICAgICAgICAgICAgIHRleHQ6IGBTdGF0dXM6ICR7dGhpcy5jbGVhblZhbHVlKHN0YXR1cyl9YCxcbiAgICAgICAgICAgICAgICAgICAgY2xzOiAnZXhvY29ydGV4LWNhcmQtc3RhdHVzJ1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgXG4gICAgICAgICAgICAvLyBTaG93IGRlc2NyaXB0aW9uIGlmIGF2YWlsYWJsZVxuICAgICAgICAgICAgY29uc3QgZGVzY3JpcHRpb24gPSBmcm9udG1hdHRlclsnZXhvX19Bc3NldF9kZXNjcmlwdGlvbiddO1xuICAgICAgICAgICAgaWYgKGRlc2NyaXB0aW9uKSB7XG4gICAgICAgICAgICAgICAgYm9keS5jcmVhdGVFbCgnZGl2Jywge1xuICAgICAgICAgICAgICAgICAgICB0ZXh0OiBkZXNjcmlwdGlvbixcbiAgICAgICAgICAgICAgICAgICAgY2xzOiAnZXhvY29ydGV4LWNhcmQtZGVzY3JpcHRpb24nXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIHByaXZhdGUgY2xlYW5WYWx1ZSh2YWx1ZTogYW55KTogc3RyaW5nIHtcbiAgICAgICAgaWYgKCF2YWx1ZSkgcmV0dXJuICcnO1xuICAgICAgICBjb25zdCBzdHIgPSBBcnJheS5pc0FycmF5KHZhbHVlKSA/IHZhbHVlWzBdIDogdmFsdWU7XG4gICAgICAgIHJldHVybiBzdHI/LnRvU3RyaW5nKCkucmVwbGFjZSgvXFxbXFxbfFxcXVxcXS9nLCAnJykgfHwgJyc7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBmb3JtYXRWYWx1ZSh2YWx1ZTogYW55KTogc3RyaW5nIHtcbiAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkodmFsdWUpKSB7XG4gICAgICAgICAgICByZXR1cm4gdmFsdWUubWFwKHYgPT4gdGhpcy5jbGVhblZhbHVlKHYpKS5qb2luKCcsICcpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0aGlzLmNsZWFuVmFsdWUodmFsdWUpO1xuICAgIH1cbn0iXSwidmVyc2lvbiI6M30=