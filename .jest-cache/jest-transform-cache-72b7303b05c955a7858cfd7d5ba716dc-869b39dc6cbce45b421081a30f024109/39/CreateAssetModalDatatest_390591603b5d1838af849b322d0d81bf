cfa26739a4c9b8d30d1cd14afbf88a66
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const tslib_1 = require("tslib");
const CreateAssetModal_1 = require("../../src/presentation/modals/CreateAssetModal");
const obsidian_1 = require("obsidian");
const DIContainer_1 = require("../../src/infrastructure/container/DIContainer");
describe('CreateAssetModal Data Loading', () => {
    let app;
    let plugin;
    let modal;
    let mockFiles;
    beforeEach(() => {
        // Create mock files with proper metadata
        mockFiles = [
            // Ontology files
            {
                name: '!exo.md',
                basename: '!exo',
                path: '!exo.md',
                extension: 'md'
            },
            {
                name: '!ui.md',
                basename: '!ui',
                path: '!ui.md',
                extension: 'md'
            },
            // Class files
            {
                name: 'exo__Asset.md',
                basename: 'exo__Asset',
                path: 'exo__Asset.md',
                extension: 'md'
            },
            {
                name: 'exo__Class.md',
                basename: 'exo__Class',
                path: 'exo__Class.md',
                extension: 'md'
            },
            {
                name: 'ui__Component.md',
                basename: 'ui__Component',
                path: 'ui__Component.md',
                extension: 'md'
            },
            // Property files
            {
                name: 'exo__Property_description.md',
                basename: 'exo__Property_description',
                path: 'exo__Property_description.md',
                extension: 'md'
            }
        ];
        // Mock app with proper vault and metadata
        app = {
            vault: {
                getMarkdownFiles: jest.fn().mockReturnValue(mockFiles),
                getAbstractFileByPath: jest.fn((path) => mockFiles.find(f => f.path === path) || null)
            },
            metadataCache: {
                getFileCache: jest.fn((file) => {
                    // Return appropriate metadata based on file
                    if (file.name.startsWith('!')) {
                        return {
                            frontmatter: {
                                'exo__Ontology_prefix': file.basename.substring(1),
                                'rdfs__label': file.basename.substring(1) === 'exo' ?
                                    'Exocortex Core' : 'User Interface'
                            }
                        };
                    }
                    if (file.basename === 'exo__Asset' || file.basename === 'exo__Class') {
                        return {
                            frontmatter: {
                                'exo__Instance_class': '[[exo__Class]]',
                                'rdfs__label': file.basename.replace('exo__', '')
                            }
                        };
                    }
                    if (file.basename === 'ui__Component') {
                        return {
                            frontmatter: {
                                'exo__Instance_class': '[[exo__Class]]',
                                'rdfs__label': 'Component'
                            }
                        };
                    }
                    if (file.basename.includes('Property')) {
                        return {
                            frontmatter: {
                                'exo__Instance_class': '[[exo__Property]]',
                                'rdfs__domain': '[[exo__Asset]]',
                                'rdfs__label': 'Description',
                                'rdfs__comment': 'Asset description',
                                'rdfs__range': 'text'
                            }
                        };
                    }
                    return { frontmatter: {} };
                })
            }
        };
        // Initialize plugin and DIContainer
        plugin = new obsidian_1.Plugin(app, {});
        DIContainer_1.DIContainer.initialize(app, plugin);
    });
    afterEach(() => {
        jest.clearAllMocks();
    });
    describe('Dropdown Population', () => {
        it('should load ontologies into dropdown', () => tslib_1.__awaiter(void 0, void 0, void 0, function* () {
            modal = new CreateAssetModal_1.CreateAssetModal(app);
            const contentEl = document.createElement('div');
            modal['contentEl'] = contentEl;
            yield modal['setupOntologyField'](contentEl);
            // Check that dropdown was created with options
            const dropdowns = contentEl.querySelectorAll('select');
            expect(dropdowns.length).toBeGreaterThan(0);
            const dropdown = dropdowns[0];
            expect(dropdown.children.length).toBeGreaterThan(0);
            // Should have exo and ui ontologies
            const options = Array.from(dropdown.children).map((opt) => opt.value);
            expect(options).toContain('exo');
            expect(options).toContain('ui');
        }));
        it('should load classes into dropdown', () => tslib_1.__awaiter(void 0, void 0, void 0, function* () {
            modal = new CreateAssetModal_1.CreateAssetModal(app);
            const contentEl = document.createElement('div');
            modal['contentEl'] = contentEl;
            yield modal['setupClassField'](contentEl);
            const dropdowns = contentEl.querySelectorAll('select');
            expect(dropdowns.length).toBeGreaterThan(0);
            const dropdown = dropdowns[0];
            const options = Array.from(dropdown.children).map((opt) => opt.value);
            // Should have the class options
            expect(options).toContain('exo__Asset');
            expect(options).toContain('exo__Class');
            expect(options).toContain('ui__Component');
        }));
        it('should load properties for selected class', () => tslib_1.__awaiter(void 0, void 0, void 0, function* () {
            modal = new CreateAssetModal_1.CreateAssetModal(app);
            const containerEl = document.createElement('div');
            modal['propertiesContainer'] = containerEl;
            yield modal['updatePropertiesForClass']('exo__Asset');
            // Should have properties loaded (either specific or defaults)
            const properties = modal['properties'];
            expect(properties.length).toBeGreaterThan(0);
            // Check that it has the expected properties
            const hasDescription = properties.some((p) => p.name === 'description' ||
                p.name === 'exo__description' ||
                p.name === 'exo__Property_description' ||
                p.label === 'Description');
            expect(hasDescription).toBe(true);
        }));
        it('should use default values when no data found', () => tslib_1.__awaiter(void 0, void 0, void 0, function* () {
            // Mock empty vault
            app.vault.getMarkdownFiles = jest.fn().mockReturnValue([]);
            modal = new CreateAssetModal_1.CreateAssetModal(app);
            const contentEl = document.createElement('div');
            modal['contentEl'] = contentEl;
            yield modal['setupOntologyField'](contentEl);
            const dropdowns = contentEl.querySelectorAll('select');
            const dropdown = dropdowns[0];
            const options = Array.from(dropdown.children).map((opt) => opt.value);
            // Should have default ontologies
            expect(options).toContain('exo');
            expect(options).toContain('ui');
            expect(options).toContain('rdfs');
        }));
    });
    describe('Property Type Mapping', () => {
        it('should map RDF ranges to correct input types', () => {
            modal = new CreateAssetModal_1.CreateAssetModal(app);
            expect(modal['mapRangeToType']('boolean')).toBe('boolean');
            expect(modal['mapRangeToType']('xsd:boolean')).toBe('boolean');
            expect(modal['mapRangeToType']('date')).toBe('date');
            expect(modal['mapRangeToType']('xsd:dateTime')).toBe('date');
            expect(modal['mapRangeToType']('integer')).toBe('number');
            expect(modal['mapRangeToType']('decimal')).toBe('number');
            expect(modal['mapRangeToType']('string[]')).toBe('array');
            expect(modal['mapRangeToType']('text')).toBe('text');
            expect(modal['mapRangeToType']('string')).toBe('string');
            expect(modal['mapRangeToType']('unknown')).toBe('string');
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL2tpdGVsZXYvRG9jdW1lbnRzL2V4b2NvcnRleC1vYnNpZGlhbi1wbHVnaW4vdGVzdHMvdW5pdC9DcmVhdGVBc3NldE1vZGFsRGF0YS50ZXN0LnRzIiwibWFwcGluZ3MiOiI7OztBQUFBLHFGQUFrRjtBQUNsRix1Q0FBOEM7QUFDOUMsZ0ZBQTZFO0FBRTdFLFFBQVEsQ0FBQywrQkFBK0IsRUFBRSxHQUFHLEVBQUU7SUFDM0MsSUFBSSxHQUFRLENBQUM7SUFDYixJQUFJLE1BQWMsQ0FBQztJQUNuQixJQUFJLEtBQXVCLENBQUM7SUFDNUIsSUFBSSxTQUFrQixDQUFDO0lBRXZCLFVBQVUsQ0FBQyxHQUFHLEVBQUU7UUFDWix5Q0FBeUM7UUFDekMsU0FBUyxHQUFHO1lBQ1IsaUJBQWlCO1lBQ2pCO2dCQUNJLElBQUksRUFBRSxTQUFTO2dCQUNmLFFBQVEsRUFBRSxNQUFNO2dCQUNoQixJQUFJLEVBQUUsU0FBUztnQkFDZixTQUFTLEVBQUUsSUFBSTthQUNUO1lBQ1Y7Z0JBQ0ksSUFBSSxFQUFFLFFBQVE7Z0JBQ2QsUUFBUSxFQUFFLEtBQUs7Z0JBQ2YsSUFBSSxFQUFFLFFBQVE7Z0JBQ2QsU0FBUyxFQUFFLElBQUk7YUFDVDtZQUNWLGNBQWM7WUFDZDtnQkFDSSxJQUFJLEVBQUUsZUFBZTtnQkFDckIsUUFBUSxFQUFFLFlBQVk7Z0JBQ3RCLElBQUksRUFBRSxlQUFlO2dCQUNyQixTQUFTLEVBQUUsSUFBSTthQUNUO1lBQ1Y7Z0JBQ0ksSUFBSSxFQUFFLGVBQWU7Z0JBQ3JCLFFBQVEsRUFBRSxZQUFZO2dCQUN0QixJQUFJLEVBQUUsZUFBZTtnQkFDckIsU0FBUyxFQUFFLElBQUk7YUFDVDtZQUNWO2dCQUNJLElBQUksRUFBRSxrQkFBa0I7Z0JBQ3hCLFFBQVEsRUFBRSxlQUFlO2dCQUN6QixJQUFJLEVBQUUsa0JBQWtCO2dCQUN4QixTQUFTLEVBQUUsSUFBSTthQUNUO1lBQ1YsaUJBQWlCO1lBQ2pCO2dCQUNJLElBQUksRUFBRSw4QkFBOEI7Z0JBQ3BDLFFBQVEsRUFBRSwyQkFB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QUFDLEtBQUssQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUFDO1lBQ3pELE1BQU0sQ0FBQyxLQUFLLENBQUMsZ0JBQWdCLENBQUMsQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQztRQUM5RCxDQUFDLENBQUMsQ0FBQztJQUNQLENBQUMsQ0FBQyxDQUFDO0FBQ1AsQ0FBQyxDQUFDLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL1VzZXJzL2tpdGVsZXYvRG9jdW1lbnRzL2V4b2NvcnRleC1vYnNpZGlhbi1wbHVnaW4vdGVzdHMvdW5pdC9DcmVhdGVBc3NldE1vZGFsRGF0YS50ZXN0LnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENyZWF0ZUFzc2V0TW9kYWwgfSBmcm9tICcuLi8uLi9zcmMvcHJlc2VudGF0aW9uL21vZGFscy9DcmVhdGVBc3NldE1vZGFsJztcbmltcG9ydCB7IEFwcCwgVEZpbGUsIFBsdWdpbiB9IGZyb20gJ29ic2lkaWFuJztcbmltcG9ydCB7IERJQ29udGFpbmVyIH0gZnJvbSAnLi4vLi4vc3JjL2luZnJhc3RydWN0dXJlL2NvbnRhaW5lci9ESUNvbnRhaW5lcic7XG5cbmRlc2NyaWJlKCdDcmVhdGVBc3NldE1vZGFsIERhdGEgTG9hZGluZycsICgpID0+IHtcbiAgICBsZXQgYXBwOiBBcHA7XG4gICAgbGV0IHBsdWdpbjogUGx1Z2luO1xuICAgIGxldCBtb2RhbDogQ3JlYXRlQXNzZXRNb2RhbDtcbiAgICBsZXQgbW9ja0ZpbGVzOiBURmlsZVtdO1xuICAgIFxuICAgIGJlZm9yZUVhY2goKCkgPT4ge1xuICAgICAgICAvLyBDcmVhdGUgbW9jayBmaWxlcyB3aXRoIHByb3BlciBtZXRhZGF0YVxuICAgICAgICBtb2NrRmlsZXMgPSBbXG4gICAgICAgICAgICAvLyBPbnRvbG9neSBmaWxlc1xuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIG5hbWU6ICchZXhvLm1kJyxcbiAgICAgICAgICAgICAgICBiYXNlbmFtZTogJyFleG8nLFxuICAgICAgICAgICAgICAgIHBhdGg6ICchZXhvLm1kJyxcbiAgICAgICAgICAgICAgICBleHRlbnNpb246ICdtZCdcbiAgICAgICAgICAgIH0gYXMgVEZpbGUsXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgbmFtZTogJyF1aS5tZCcsXG4gICAgICAgICAgICAgICAgYmFzZW5hbWU6ICchdWknLFxuICAgICAgICAgICAgICAgIHBhdGg6ICchdWkubWQnLFxuICAgICAgICAgICAgICAgIGV4dGVuc2lvbjogJ21kJ1xuICAgICAgICAgICAgfSBhcyBURmlsZSxcbiAgICAgICAgICAgIC8vIENsYXNzIGZpbGVzXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgbmFtZTogJ2V4b19fQXNzZXQubWQnLFxuICAgICAgICAgICAgICAgIGJhc2VuYW1lOiAnZXhvX19Bc3NldCcsXG4gICAgICAgICAgICAgICAgcGF0aDogJ2V4b19fQXNzZXQubWQnLFxuICAgICAgICAgICAgICAgIGV4dGVuc2lvbjogJ21kJ1xuICAgICAgICAgICAgfSBhcyBURmlsZSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBuYW1lOiAnZXhvX19DbGFzcy5tZCcsXG4gICAgICAgICAgICAgICAgYmFzZW5hbWU6ICdleG9fX0NsYXNzJyxcbiAgICAgICAgICAgICAgICBwYXRoOiAnZXhvX19DbGFzcy5tZCcsXG4gICAgICAgICAgICAgICAgZXh0ZW5zaW9uOiAnbWQnXG4gICAgICAgICAgICB9IGFzIFRGaWxlLFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIG5hbWU6ICd1aV9fQ29tcG9uZW50Lm1kJyxcbiAgICAgICAgICAgICAgICBiYXNlbmFtZTogJ3VpX19Db21wb25lbnQnLFxuICAgICAgICAgICAgICAgIHBhdGg6ICd1aV9fQ29tcG9uZW50Lm1kJyxcbiAgICAgICAgICAgICAgICBleHRlbnNpb246ICdtZCdcbiAgICAgICAgICAgIH0gYXMgVEZpbGUsXG4gICAgICAgICAgICAvLyBQcm9wZXJ0eSBmaWxlc1xuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIG5hbWU6ICdleG9fX1Byb3BlcnR5X2Rlc2NyaXB0aW9uLm1kJyxcbiAgICAgICAgICAgICAgICBiYXNlbmFtZTogJ2V4b19fUHJvcGVydHlfZGVzY3JpcHRpb24nLFxuICAgICAgICAgICAgICAgIHBhdGg6ICdleG9fX1Byb3BlcnR5X2Rlc2NyaXB0aW9uLm1kJyxcbiAgICAgICAgICAgICAgICBleHRlbnNpb246ICdtZCdcbiAgICAgICAgICAgIH0gYXMgVEZpbGVcbiAgICAgICAgXTtcbiAgICAgICAgXG4gICAgICAgIC8vIE1vY2sgYXBwIHdpdGggcHJvcGVyIHZhdWx0IGFuZCBtZXRhZGF0YVxuICAgICAgICBhcHAgPSB7XG4gICAgICAgICAgICB2YXVsdDoge1xuICAgICAgICAgICAgICAgIGdldE1hcmtkb3duRmlsZXM6IGplc3QuZm4oKS5tb2NrUmV0dXJuVmFsdWUobW9ja0ZpbGVzKSxcbiAgICAgICAgICAgICAgICBnZXRBYnN0cmFjdEZpbGVCeVBhdGg6IGplc3QuZm4oKHBhdGgpID0+IFxuICAgICAgICAgICAgICAgICAgICBtb2NrRmlsZXMuZmluZChmID0+IGYucGF0aCA9PT0gcGF0aCkgfHwgbnVsbFxuICAgICAgICAgICAgICAgIClcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBtZXRhZGF0YUNhY2hlOiB7XG4gICAgICAgICAgICAgICAgZ2V0RmlsZUNhY2hlOiBqZXN0LmZuKChmaWxlOiBURmlsZSkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAvLyBSZXR1cm4gYXBwcm9wcmlhdGUgbWV0YWRhdGEgYmFzZWQgb24gZmlsZVxuICAgICAgICAgICAgICAgICAgICBpZiAoZmlsZS5uYW1lLnN0YXJ0c1dpdGgoJyEnKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmcm9udG1hdHRlcjoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnZXhvX19PbnRvbG9neV9wcmVmaXgnOiBmaWxlLmJhc2VuYW1lLnN1YnN0cmluZygxKSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3JkZnNfX2xhYmVsJzogZmlsZS5iYXNlbmFtZS5zdWJzdHJpbmcoMSkgPT09ICdleG8nID8gXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnRXhvY29ydGV4IENvcmUnIDogJ1VzZXIgSW50ZXJmYWNlJ1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgaWYgKGZpbGUuYmFzZW5hbWUgPT09ICdleG9fX0Fzc2V0JyB8fCBmaWxlLmJhc2VuYW1lID09PSAnZXhvX19DbGFzcycpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZnJvbnRtYXR0ZXI6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2V4b19fSW5zdGFuY2VfY2xhc3MnOiAnW1tleG9fX0NsYXNzXV0nLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAncmRmc19fbGFiZWwnOiBmaWxlLmJhc2VuYW1lLnJlcGxhY2UoJ2V4b19fJywgJycpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBpZiAoZmlsZS5iYXNlbmFtZSA9PT0gJ3VpX19Db21wb25lbnQnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZyb250bWF0dGVyOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdleG9fX0luc3RhbmNlX2NsYXNzJzogJ1tbZXhvX19DbGFzc11dJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3JkZnNfX2xhYmVsJzogJ0NvbXBvbmVudCdcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGlmIChmaWxlLmJhc2VuYW1lLmluY2x1ZGVzKCdQcm9wZXJ0eScpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZyb250bWF0dGVyOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdleG9fX0luc3RhbmNlX2NsYXNzJzogJ1tbZXhvX19Qcm9wZXJ0eV1dJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3JkZnNfX2RvbWFpbic6ICdbW2V4b19fQXNzZXRdXScsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdyZGZzX19sYWJlbCc6ICdEZXNjcmlwdGlvbicsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdyZGZzX19jb21tZW50JzogJ0Fzc2V0IGRlc2NyaXB0aW9uJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3JkZnNfX3JhbmdlJzogJ3RleHQnXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICByZXR1cm4geyBmcm9udG1hdHRlcjoge30gfTtcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgfVxuICAgICAgICB9IGFzIGFueTtcbiAgICAgICAgXG4gICAgICAgIC8vIEluaXRpYWxpemUgcGx1Z2luIGFuZCBESUNvbnRhaW5lclxuICAgICAgICBwbHVnaW4gPSBuZXcgUGx1Z2luKGFwcCwge30gYXMgYW55KTtcbiAgICAgICAgRElDb250YWluZXIuaW5pdGlhbGl6ZShhcHAsIHBsdWdpbik7XG4gICAgfSk7XG4gICAgXG4gICAgYWZ0ZXJFYWNoKCgpID0+IHtcbiAgICAgICAgamVzdC5jbGVhckFsbE1vY2tzKCk7XG4gICAgfSk7XG4gICAgXG4gICAgZGVzY3JpYmUoJ0Ryb3Bkb3duIFBvcHVsYXRpb24nLCAoKSA9PiB7XG4gICAgICAgIGl0KCdzaG91bGQgbG9hZCBvbnRvbG9naWVzIGludG8gZHJvcGRvd24nLCBhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICBtb2RhbCA9IG5ldyBDcmVhdGVBc3NldE1vZGFsKGFwcCk7XG4gICAgICAgICAgICBjb25zdCBjb250ZW50RWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICAgICAgICAgIG1vZGFsWydjb250ZW50RWwnXSA9IGNvbnRlbnRFbDtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgYXdhaXQgbW9kYWxbJ3NldHVwT250b2xvZ3lGaWVsZCddKGNvbnRlbnRFbCk7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIC8vIENoZWNrIHRoYXQgZHJvcGRvd24gd2FzIGNyZWF0ZWQgd2l0aCBvcHRpb25zXG4gICAgICAgICAgICBjb25zdCBkcm9wZG93bnMgPSBjb250ZW50RWwucXVlcnlTZWxlY3RvckFsbCgnc2VsZWN0Jyk7XG4gICAgICAgICAgICBleHBlY3QoZHJvcGRvd25zLmxlbmd0aCkudG9CZUdyZWF0ZXJUaGFuKDApO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICBjb25zdCBkcm9wZG93biA9IGRyb3Bkb3duc1swXTtcbiAgICAgICAgICAgIGV4cGVjdChkcm9wZG93bi5jaGlsZHJlbi5sZW5ndGgpLnRvQmVHcmVhdGVyVGhhbigwKTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgLy8gU2hvdWxkIGhhdmUgZXhvIGFuZCB1aSBvbnRvbG9naWVzXG4gICAgICAgICAgICBjb25zdCBvcHRpb25zID0gQXJyYXkuZnJvbShkcm9wZG93bi5jaGlsZHJlbikubWFwKChvcHQ6IGFueSkgPT4gb3B0LnZhbHVlKTtcbiAgICAgICAgICAgIGV4cGVjdChvcHRpb25zKS50b0NvbnRhaW4oJ2V4bycpO1xuICAgICAgICAgICAgZXhwZWN0KG9wdGlvbnMpLnRvQ29udGFpbigndWknKTtcbiAgICAgICAgfSk7XG4gICAgICAgIFxuICAgICAgICBpdCgnc2hvdWxkIGxvYWQgY2xhc3NlcyBpbnRvIGRyb3Bkb3duJywgYXN5bmMgKCkgPT4ge1xuICAgICAgICAgICAgbW9kYWwgPSBuZXcgQ3JlYXRlQXNzZXRNb2RhbChhcHApO1xuICAgICAgICAgICAgY29uc3QgY29udGVudEVsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgICAgICAgICBtb2RhbFsnY29udGVudEVsJ10gPSBjb250ZW50RWw7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGF3YWl0IG1vZGFsWydzZXR1cENsYXNzRmllbGQnXShjb250ZW50RWwpO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICBjb25zdCBkcm9wZG93bnMgPSBjb250ZW50RWwucXVlcnlTZWxlY3RvckFsbCgnc2VsZWN0Jyk7XG4gICAgICAgICAgICBleHBlY3QoZHJvcGRvd25zLmxlbmd0aCkudG9CZUdyZWF0ZXJUaGFuKDApO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICBjb25zdCBkcm9wZG93biA9IGRyb3Bkb3duc1swXTtcbiAgICAgICAgICAgIGNvbnN0IG9wdGlvbnMgPSBBcnJheS5mcm9tKGRyb3Bkb3duLmNoaWxkcmVuKS5tYXAoKG9wdDogYW55KSA9PiBvcHQudmFsdWUpO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICAvLyBTaG91bGQgaGF2ZSB0aGUgY2xhc3Mgb3B0aW9uc1xuICAgICAgICAgICAgZXhwZWN0KG9wdGlvbnMpLnRvQ29udGFpbignZXhvX19Bc3NldCcpO1xuICAgICAgICAgICAgZXhwZWN0KG9wdGlvbnMpLnRvQ29udGFpbignZXhvX19DbGFzcycpO1xuICAgICAgICAgICAgZXhwZWN0KG9wdGlvbnMpLnRvQ29udGFpbigndWlfX0NvbXBvbmVudCcpO1xuICAgICAgICB9KTtcbiAgICAgICAgXG4gICAgICAgIGl0KCdzaG91bGQgbG9hZCBwcm9wZXJ0aWVzIGZvciBzZWxlY3RlZCBjbGFzcycsIGFzeW5jICgpID0+IHtcbiAgICAgICAgICAgIG1vZGFsID0gbmV3IENyZWF0ZUFzc2V0TW9kYWwoYXBwKTtcbiAgICAgICAgICAgIGNvbnN0IGNvbnRhaW5lckVsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgICAgICAgICBtb2RhbFsncHJvcGVydGllc0NvbnRhaW5lciddID0gY29udGFpbmVyRWw7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGF3YWl0IG1vZGFsWyd1cGRhdGVQcm9wZXJ0aWVzRm9yQ2xhc3MnXSgnZXhvX19Bc3NldCcpO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICAvLyBTaG91bGQgaGF2ZSBwcm9wZXJ0aWVzIGxvYWRlZCAoZWl0aGVyIHNwZWNpZmljIG9yIGRlZmF1bHRzKVxuICAgICAgICAgICAgY29uc3QgcHJvcGVydGllcyA9IG1vZGFsWydwcm9wZXJ0aWVzJ107XG4gICAgICAgICAgICBleHBlY3QocHJvcGVydGllcy5sZW5ndGgpLnRvQmVHcmVhdGVyVGhhbigwKTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgLy8gQ2hlY2sgdGhhdCBpdCBoYXMgdGhlIGV4cGVjdGVkIHByb3BlcnRpZXNcbiAgICAgICAgICAgIGNvbnN0IGhhc0Rlc2NyaXB0aW9uID0gcHJvcGVydGllcy5zb21lKChwOiBhbnkpID0+IFxuICAgICAgICAgICAgICAgIHAubmFtZSA9PT0gJ2Rlc2NyaXB0aW9uJyB8fCBcbiAgICAgICAgICAgICAgICBwLm5hbWUgPT09ICdleG9fX2Rlc2NyaXB0aW9uJyB8fCBcbiAgICAgICAgICAgICAgICBwLm5hbWUgPT09ICdleG9fX1Byb3BlcnR5X2Rlc2NyaXB0aW9uJyB8fFxuICAgICAgICAgICAgICAgIHAubGFiZWwgPT09ICdEZXNjcmlwdGlvbidcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgICBleHBlY3QoaGFzRGVzY3JpcHRpb24pLnRvQmUodHJ1ZSk7XG4gICAgICAgIH0pO1xuICAgICAgICBcbiAgICAgICAgaXQoJ3Nob3VsZCB1c2UgZGVmYXVsdCB2YWx1ZXMgd2hlbiBubyBkYXRhIGZvdW5kJywgYXN5bmMgKCkgPT4ge1xuICAgICAgICAgICAgLy8gTW9jayBlbXB0eSB2YXVsdFxuICAgICAgICAgICAgYXBwLnZhdWx0LmdldE1hcmtkb3duRmlsZXMgPSBqZXN0LmZuKCkubW9ja1JldHVyblZhbHVlKFtdKTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgbW9kYWwgPSBuZXcgQ3JlYXRlQXNzZXRNb2RhbChhcHApO1xuICAgICAgICAgICAgY29uc3QgY29udGVudEVsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgICAgICAgICBtb2RhbFsnY29udGVudEVsJ10gPSBjb250ZW50RWw7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGF3YWl0IG1vZGFsWydzZXR1cE9udG9sb2d5RmllbGQnXShjb250ZW50RWwpO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICBjb25zdCBkcm9wZG93bnMgPSBjb250ZW50RWwucXVlcnlTZWxlY3RvckFsbCgnc2VsZWN0Jyk7XG4gICAgICAgICAgICBjb25zdCBkcm9wZG93biA9IGRyb3Bkb3duc1swXTtcbiAgICAgICAgICAgIGNvbnN0IG9wdGlvbnMgPSBBcnJheS5mcm9tKGRyb3Bkb3duLmNoaWxkcmVuKS5tYXAoKG9wdDogYW55KSA9PiBvcHQudmFsdWUpO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICAvLyBTaG91bGQgaGF2ZSBkZWZhdWx0IG9udG9sb2dpZXNcbiAgICAgICAgICAgIGV4cGVjdChvcHRpb25zKS50b0NvbnRhaW4oJ2V4bycpO1xuICAgICAgICAgICAgZXhwZWN0KG9wdGlvbnMpLnRvQ29udGFpbigndWknKTtcbiAgICAgICAgICAgIGV4cGVjdChvcHRpb25zKS50b0NvbnRhaW4oJ3JkZnMnKTtcbiAgICAgICAgfSk7XG4gICAgfSk7XG4gICAgXG4gICAgZGVzY3JpYmUoJ1Byb3BlcnR5IFR5cGUgTWFwcGluZycsICgpID0+IHtcbiAgICAgICAgaXQoJ3Nob3VsZCBtYXAgUkRGIHJhbmdlcyB0byBjb3JyZWN0IGlucHV0IHR5cGVzJywgKCkgPT4ge1xuICAgICAgICAgICAgbW9kYWwgPSBuZXcgQ3JlYXRlQXNzZXRNb2RhbChhcHApO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICBleHBlY3QobW9kYWxbJ21hcFJhbmdlVG9UeXBlJ10oJ2Jvb2xlYW4nKSkudG9CZSgnYm9vbGVhbicpO1xuICAgICAgICAgICAgZXhwZWN0KG1vZGFsWydtYXBSYW5nZVRvVHlwZSddKCd4c2Q6Ym9vbGVhbicpKS50b0JlKCdib29sZWFuJyk7XG4gICAgICAgICAgICBleHBlY3QobW9kYWxbJ21hcFJhbmdlVG9UeXBlJ10oJ2RhdGUnKSkudG9CZSgnZGF0ZScpO1xuICAgICAgICAgICAgZXhwZWN0KG1vZGFsWydtYXBSYW5nZVRvVHlwZSddKCd4c2Q6ZGF0ZVRpbWUnKSkudG9CZSgnZGF0ZScpO1xuICAgICAgICAgICAgZXhwZWN0KG1vZGFsWydtYXBSYW5nZVRvVHlwZSddKCdpbnRlZ2VyJykpLnRvQmUoJ251bWJlcicpO1xuICAgICAgICAgICAgZXhwZWN0KG1vZGFsWydtYXBSYW5nZVRvVHlwZSddKCdkZWNpbWFsJykpLnRvQmUoJ251bWJlcicpO1xuICAgICAgICAgICAgZXhwZWN0KG1vZGFsWydtYXBSYW5nZVRvVHlwZSddKCdzdHJpbmdbXScpKS50b0JlKCdhcnJheScpO1xuICAgICAgICAgICAgZXhwZWN0KG1vZGFsWydtYXBSYW5nZVRvVHlwZSddKCd0ZXh0JykpLnRvQmUoJ3RleHQnKTtcbiAgICAgICAgICAgIGV4cGVjdChtb2RhbFsnbWFwUmFuZ2VUb1R5cGUnXSgnc3RyaW5nJykpLnRvQmUoJ3N0cmluZycpO1xuICAgICAgICAgICAgZXhwZWN0KG1vZGFsWydtYXBSYW5nZVRvVHlwZSddKCd1bmtub3duJykpLnRvQmUoJ3N0cmluZycpO1xuICAgICAgICB9KTtcbiAgICB9KTtcbn0pOyJdLCJ2ZXJzaW9uIjozfQ==