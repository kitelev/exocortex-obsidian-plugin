da5643032d298cbbc4ed08da34d9b26e
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const tslib_1 = require("tslib");
const main_1 = tslib_1.__importDefault(require("../../src/main"));
describe.skip('LayoutRenderer Integration (deprecated)', () => {
    let plugin;
    let mockApp;
    beforeEach(() => {
        // Create mock app
        mockApp = {
            vault: {
                getMarkdownFiles: jest.fn().mockReturnValue([]),
                read: jest.fn(),
                create: jest.fn(),
                modify: jest.fn(),
                on: jest.fn().mockReturnValue({ unload: jest.fn() }),
                getAbstractFileByPath: jest.fn()
            },
            workspace: {
                getActiveFile: jest.fn(),
                on: jest.fn().mockReturnValue({ unload: jest.fn() })
            },
            metadataCache: {
                getFileCache: jest.fn(),
                on: jest.fn().mockReturnValue({ unload: jest.fn() })
            }
        };
        plugin = new main_1.default(mockApp, {});
    });
    describe('Layout Renderer Registration', () => {
        test('should register exo-layout code block processor', () => tslib_1.__awaiter(void 0, void 0, void 0, function* () {
            const registerSpy = jest.fn();
            plugin.registerMarkdownCodeBlockProcessor = registerSpy;
            yield plugin.onload();
            // Check that exo-layout processor was registered
            const calls = registerSpy.mock.calls;
            const layoutCall = calls.find(call => call[0] === 'exo-layout');
            expect(layoutCall).toBeDefined();
            expect(layoutCall[0]).toBe('exo-layout');
            expect(typeof layoutCall[1]).toBe('function');
        }));
        test('should render layout when exo-layout block is processed', () => tslib_1.__awaiter(void 0, void 0, void 0, function* () {
            let layoutProcessor;
            plugin.registerMarkdownCodeBlockProcessor = jest.fn((type, processor) => {
                if (type === 'exo-layout') {
                    layoutProcessor = processor;
                }
            });
            yield plugin.onload();
            // Mock active file with frontmatter
            const mockFile = {
                path: 'test.md',
                basename: 'test',
                name: 'test.md'
            };
            mockApp.workspace.getActiveFile.mockReturnValue(mockFile);
            mockApp.metadataCache.getFileCache.mockReturnValue({
                frontmatter: {
                    'exo__Instance_class': '[[ems__Task]]',
                    'title': 'Test Task',
                    'status': 'active'
                }
            });
            // Create mock element
            const mockEl = {
                empty: jest.fn(),
                createDiv: jest.fn().mockReturnValue({
                    createEl: jest.fn(),
                    createDiv: jest.fn(),
                    style: {},
                    setAttribute: jest.fn(),
                    addClass: jest.fn()
                }),
                createEl: jest.fn()
            };
            // Process the block
            yield layoutProcessor('', mockEl, {});
            expect(mockEl.empty).toHaveBeenCalled();
            expect(mockApp.workspace.getActiveFile).toHaveBeenCalled();
            expect(mockApp.metadataCache.getFileCache).toHaveBeenCalledWith(mockFile);
        }));
        test('should not render if no active file', () => tslib_1.__awaiter(void 0, void 0, void 0, function* () {
            let layoutProcessor;
            plugin.registerMarkdownCodeBlockProcessor = jest.fn((type, processor) => {
                if (type === 'exo-layout') {
                    layoutProcessor = processor;
                }
            });
            yield plugin.onload();
            mockApp.workspace.getActiveFile.mockReturnValue(null);
            const mockEl = {
                empty: jest.fn()
            };
            yield layoutProcessor('', mockEl, {});
            expect(mockEl.empty).not.toHaveBeenCalled();
        }));
        test('should not render if no frontmatter', () => tslib_1.__awaiter(void 0, void 0, void 0, function* () {
            let layoutProcessor;
            plugin.registerMarkdownCodeBlockProcessor = jest.fn((type, processor) => {
                if (type === 'exo-layout') {
                    layoutProcessor = processor;
                }
            });
            yield plugin.onload();
            const mockFile = {
                path: 'test.md'
            };
            mockApp.workspace.getActiveFile.mockReturnValue(mockFile);
            mockApp.metadataCache.getFileCache.mockReturnValue(null);
            const mockEl = {
                empty: jest.fn()
            };
            yield layoutProcessor('', mockEl, {});
            expect(mockEl.empty).not.toHaveBeenCalled();
        }));
    });
    describe('Layout Rendering Types', () => {
        test('should support query blocks in layouts', () => tslib_1.__awaiter(void 0, void 0, void 0, function* () {
            yield plugin.onload();
            const layoutRenderer = plugin.layoutRenderer;
            expect(layoutRenderer).toBeDefined();
            // Verify renderer has query block support
            expect(layoutRenderer.queryRenderer).toBeDefined();
        }));
        test('should support properties blocks in layouts', () => tslib_1.__awaiter(void 0, void 0, void 0, function* () {
            yield plugin.onload();
            const layoutRenderer = plugin.layoutRenderer;
            expect(layoutRenderer).toBeDefined();
            // Verify renderer has properties block support
            expect(layoutRenderer.propertiesRenderer).toBeDefined();
        }));
        test('should support backlinks blocks in layouts', () => tslib_1.__awaiter(void 0, void 0, void 0, function* () {
            yield plugin.onload();
            const layoutRenderer = plugin.layoutRenderer;
            expect(layoutRenderer).toBeDefined();
            // Verify renderer has backlinks block support
            expect(layoutRenderer.backlinksRenderer).toBeDefined();
        }));
        test('should support custom blocks in layouts', () => tslib_1.__awaiter(void 0, void 0, void 0, function* () {
            yield plugin.onload();
            const layoutRenderer = plugin.layoutRenderer;
            expect(layoutRenderer).toBeDefined();
            // Verify renderer has custom block support
            expect(layoutRenderer.customRenderer).toBeDefined();
        }));
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL2tpdGVsZXYvRG9jdW1lbnRzL2V4b2NvcnRleC1vYnNpZGlhbi1wbHVnaW4vdGVzdHMvaW50ZWdyYXRpb24vTGF5b3V0UmVuZGVyZXJJbnRlZ3JhdGlvbi50ZXN0LnRzIiwibWFwcGluZ3MiOiI7OztBQUNBLGtFQUE2QztBQUU3QyxRQUFRLENBQUMsSUFBSSxDQUFDLHlDQUF5QyxFQUFFLEdBQUcsRUFBRTtJQUMxRCxJQUFJLE1BQXVCLENBQUM7SUFDNUIsSUFBSSxPQUFZLENBQUM7SUFFakIsVUFBVSxDQUFDLEdBQUcsRUFBRTtRQUNaLGtCQUFrQjtRQUNsQixPQUFPLEdBQUc7WUFDTixLQUFLLEVBQUU7Z0JBQ0gsZ0JBQWdCLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRSxDQUFDLGVBQWUsQ0FBQyxFQUFFLENBQUM7Z0JBQy9DLElBQUksRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO2dCQUNmLE1BQU0sRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO2dCQUNqQixNQUFNLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtnQkFDakIsRUFBRSxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUUsQ0FBQyxlQUFlLENBQUMsRUFBRSxNQUFNLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRSxFQUFFLENBQUM7Z0JBQ3BELHFCQUFxQixFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7YUFDbkM7WUFDRCxTQUFTLEVBQUU7Z0JBQ1AsYUFBYSxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7Z0JBQ3hCLEVBQUUsRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFLENBQUMsZUFBZSxDQUFDLEVBQUUsTUFBTSxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUUsRUFBRSxDQUFDO2FBQ3ZEO1lBQ0QsYUFBYSxFQUFFO2dCQUNYLFlBQVksRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO2dCQUN2QixFQUFFLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRSxDQUFDLGVBQWUsQ0FBQyxFQUFFLE1BQU0sRUFBRSxJQUFJLENBQUMsRUFB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Y0FBc0IsQ0FBQyxrQkFBa0IsQ0FBQyxDQUFDLFdBQVcsRUFBRSxDQUFDO1FBQ3JFLENBQUMsQ0FBQSxDQUFDLENBQUM7UUFFSCxJQUFJLENBQUMsNENBQTRDLEVBQUUsR0FBUyxFQUFFO1lBQzFELE1BQU0sTUFBTSxDQUFDLE1BQU0sRUFBRSxDQUFDO1lBQ3RCLE1BQU0sY0FBYyxHQUFJLE1BQWMsQ0FBQyxjQUFjLENBQUM7WUFDdEQsTUFBTSxDQUFDLGNBQWMsQ0FBQyxDQUFDLFdBQVcsRUFBRSxDQUFDO1lBRXJDLDhDQUE4QztZQUM5QyxNQUFNLENBQUUsY0FBc0IsQ0FBQyxpQkFBaUIsQ0FBQyxDQUFDLFdBQVcsRUFBRSxDQUFDO1FBQ3BFLENBQUMsQ0FBQSxDQUFDLENBQUM7UUFFSCxJQUFJLENBQUMseUNBQXlDLEVBQUUsR0FBUyxFQUFFO1lBQ3ZELE1BQU0sTUFBTSxDQUFDLE1BQU0sRUFBRSxDQUFDO1lBQ3RCLE1BQU0sY0FBYyxHQUFJLE1BQWMsQ0FBQyxjQUFjLENBQUM7WUFDdEQsTUFBTSxDQUFDLGNBQWMsQ0FBQyxDQUFDLFdBQVcsRUFBRSxDQUFDO1lBRXJDLDJDQUEyQztZQUMzQyxNQUFNLENBQUUsY0FBc0IsQ0FBQyxjQUFjLENBQUMsQ0FBQyxXQUFXLEVBQUUsQ0FBQztRQUNqRSxDQUFDLENBQUEsQ0FBQyxDQUFDO0lBQ1AsQ0FBQyxDQUFDLENBQUM7QUFDUCxDQUFDLENBQUMsQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyIvVXNlcnMva2l0ZWxldi9Eb2N1bWVudHMvZXhvY29ydGV4LW9ic2lkaWFuLXBsdWdpbi90ZXN0cy9pbnRlZ3JhdGlvbi9MYXlvdXRSZW5kZXJlckludGVncmF0aW9uLnRlc3QudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQXBwLCBURmlsZSB9IGZyb20gJ29ic2lkaWFuJztcbmltcG9ydCBFeG9jb3J0ZXhQbHVnaW4gZnJvbSAnLi4vLi4vc3JjL21haW4nO1xuXG5kZXNjcmliZS5za2lwKCdMYXlvdXRSZW5kZXJlciBJbnRlZ3JhdGlvbiAoZGVwcmVjYXRlZCknLCAoKSA9PiB7XG4gICAgbGV0IHBsdWdpbjogRXhvY29ydGV4UGx1Z2luO1xuICAgIGxldCBtb2NrQXBwOiBhbnk7XG4gICAgXG4gICAgYmVmb3JlRWFjaCgoKSA9PiB7XG4gICAgICAgIC8vIENyZWF0ZSBtb2NrIGFwcFxuICAgICAgICBtb2NrQXBwID0ge1xuICAgICAgICAgICAgdmF1bHQ6IHtcbiAgICAgICAgICAgICAgICBnZXRNYXJrZG93bkZpbGVzOiBqZXN0LmZuKCkubW9ja1JldHVyblZhbHVlKFtdKSxcbiAgICAgICAgICAgICAgICByZWFkOiBqZXN0LmZuKCksXG4gICAgICAgICAgICAgICAgY3JlYXRlOiBqZXN0LmZuKCksXG4gICAgICAgICAgICAgICAgbW9kaWZ5OiBqZXN0LmZuKCksXG4gICAgICAgICAgICAgICAgb246IGplc3QuZm4oKS5tb2NrUmV0dXJuVmFsdWUoeyB1bmxvYWQ6IGplc3QuZm4oKSB9KSxcbiAgICAgICAgICAgICAgICBnZXRBYnN0cmFjdEZpbGVCeVBhdGg6IGplc3QuZm4oKVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHdvcmtzcGFjZToge1xuICAgICAgICAgICAgICAgIGdldEFjdGl2ZUZpbGU6IGplc3QuZm4oKSxcbiAgICAgICAgICAgICAgICBvbjogamVzdC5mbigpLm1vY2tSZXR1cm5WYWx1ZSh7IHVubG9hZDogamVzdC5mbigpIH0pXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgbWV0YWRhdGFDYWNoZToge1xuICAgICAgICAgICAgICAgIGdldEZpbGVDYWNoZTogamVzdC5mbigpLFxuICAgICAgICAgICAgICAgIG9uOiBqZXN0LmZuKCkubW9ja1JldHVyblZhbHVlKHsgdW5sb2FkOiBqZXN0LmZuKCkgfSlcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgICAgXG4gICAgICAgIHBsdWdpbiA9IG5ldyBFeG9jb3J0ZXhQbHVnaW4obW9ja0FwcCwge30gYXMgYW55KTtcbiAgICB9KTtcbiAgICBcbiAgICBkZXNjcmliZSgnTGF5b3V0IFJlbmRlcmVyIFJlZ2lzdHJhdGlvbicsICgpID0+IHtcbiAgICAgICAgdGVzdCgnc2hvdWxkIHJlZ2lzdGVyIGV4by1sYXlvdXQgY29kZSBibG9jayBwcm9jZXNzb3InLCBhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCByZWdpc3RlclNweSA9IGplc3QuZm4oKTtcbiAgICAgICAgICAgIHBsdWdpbi5yZWdpc3Rlck1hcmtkb3duQ29kZUJsb2NrUHJvY2Vzc29yID0gcmVnaXN0ZXJTcHk7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGF3YWl0IHBsdWdpbi5vbmxvYWQoKTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgLy8gQ2hlY2sgdGhhdCBleG8tbGF5b3V0IHByb2Nlc3NvciB3YXMgcmVnaXN0ZXJlZFxuICAgICAgICAgICAgY29uc3QgY2FsbHMgPSByZWdpc3RlclNweS5tb2NrLmNhbGxzO1xuICAgICAgICAgICAgY29uc3QgbGF5b3V0Q2FsbCA9IGNhbGxzLmZpbmQoY2FsbCA9PiBjYWxsWzBdID09PSAnZXhvLWxheW91dCcpO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICBleHBlY3QobGF5b3V0Q2FsbCkudG9CZURlZmluZWQoKTtcbiAgICAgICAgICAgIGV4cGVjdChsYXlvdXRDYWxsWzBdKS50b0JlKCdleG8tbGF5b3V0Jyk7XG4gICAgICAgICAgICBleHBlY3QodHlwZW9mIGxheW91dENhbGxbMV0pLnRvQmUoJ2Z1bmN0aW9uJyk7XG4gICAgICAgIH0pO1xuICAgICAgICBcbiAgICAgICAgdGVzdCgnc2hvdWxkIHJlbmRlciBsYXlvdXQgd2hlbiBleG8tbGF5b3V0IGJsb2NrIGlzIHByb2Nlc3NlZCcsIGFzeW5jICgpID0+IHtcbiAgICAgICAgICAgIGxldCBsYXlvdXRQcm9jZXNzb3I6IGFueTtcbiAgICAgICAgICAgIHBsdWdpbi5yZWdpc3Rlck1hcmtkb3duQ29kZUJsb2NrUHJvY2Vzc29yID0gamVzdC5mbigodHlwZSwgcHJvY2Vzc29yKSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKHR5cGUgPT09ICdleG8tbGF5b3V0Jykge1xuICAgICAgICAgICAgICAgICAgICBsYXlvdXRQcm9jZXNzb3IgPSBwcm9jZXNzb3I7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGF3YWl0IHBsdWdpbi5vbmxvYWQoKTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgLy8gTW9jayBhY3RpdmUgZmlsZSB3aXRoIGZyb250bWF0dGVyXG4gICAgICAgICAgICBjb25zdCBtb2NrRmlsZSA9IHtcbiAgICAgICAgICAgICAgICBwYXRoOiAndGVzdC5tZCcsXG4gICAgICAgICAgICAgICAgYmFzZW5hbWU6ICd0ZXN0JyxcbiAgICAgICAgICAgICAgICBuYW1lOiAndGVzdC5tZCdcbiAgICAgICAgICAgIH0gYXMgVEZpbGU7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIG1vY2tBcHAud29ya3NwYWNlLmdldEFjdGl2ZUZpbGUubW9ja1JldHVyblZhbHVlKG1vY2tGaWxlKTtcbiAgICAgICAgICAgIG1vY2tBcHAubWV0YWRhdGFDYWNoZS5nZXRGaWxlQ2FjaGUubW9ja1JldHVyblZhbHVlKHtcbiAgICAgICAgICAgICAgICBmcm9udG1hdHRlcjoge1xuICAgICAgICAgICAgICAgICAgICAnZXhvX19JbnN0YW5jZV9jbGFzcyc6ICdbW2Vtc19fVGFza11dJyxcbiAgICAgICAgICAgICAgICAgICAgJ3RpdGxlJzogJ1Rlc3QgVGFzaycsXG4gICAgICAgICAgICAgICAgICAgICdzdGF0dXMnOiAnYWN0aXZlJ1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICAvLyBDcmVhdGUgbW9jayBlbGVtZW50XG4gICAgICAgICAgICBjb25zdCBtb2NrRWwgPSB7XG4gICAgICAgICAgICAgICAgZW1wdHk6IGplc3QuZm4oKSxcbiAgICAgICAgICAgICAgICBjcmVhdGVEaXY6IGplc3QuZm4oKS5tb2NrUmV0dXJuVmFsdWUoe1xuICAgICAgICAgICAgICAgICAgICBjcmVhdGVFbDogamVzdC5mbigpLFxuICAgICAgICAgICAgICAgICAgICBjcmVhdGVEaXY6IGplc3QuZm4oKSxcbiAgICAgICAgICAgICAgICAgICAgc3R5bGU6IHt9LFxuICAgICAgICAgICAgICAgICAgICBzZXRBdHRyaWJ1dGU6IGplc3QuZm4oKSxcbiAgICAgICAgICAgICAgICAgICAgYWRkQ2xhc3M6IGplc3QuZm4oKVxuICAgICAgICAgICAgICAgIH0pLFxuICAgICAgICAgICAgICAgIGNyZWF0ZUVsOiBqZXN0LmZuKClcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIC8vIFByb2Nlc3MgdGhlIGJsb2NrXG4gICAgICAgICAgICBhd2FpdCBsYXlvdXRQcm9jZXNzb3IoJycsIG1vY2tFbCwge30pO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICBleHBlY3QobW9ja0VsLmVtcHR5KS50b0hhdmVCZWVuQ2FsbGVkKCk7XG4gICAgICAgICAgICBleHBlY3QobW9ja0FwcC53b3Jrc3BhY2UuZ2V0QWN0aXZlRmlsZSkudG9IYXZlQmVlbkNhbGxlZCgpO1xuICAgICAgICAgICAgZXhwZWN0KG1vY2tBcHAubWV0YWRhdGFDYWNoZS5nZXRGaWxlQ2FjaGUpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKG1vY2tGaWxlKTtcbiAgICAgICAgfSk7XG4gICAgICAgIFxuICAgICAgICB0ZXN0KCdzaG91bGQgbm90IHJlbmRlciBpZiBubyBhY3RpdmUgZmlsZScsIGFzeW5jICgpID0+IHtcbiAgICAgICAgICAgIGxldCBsYXlvdXRQcm9jZXNzb3I6IGFueTtcbiAgICAgICAgICAgIHBsdWdpbi5yZWdpc3Rlck1hcmtkb3duQ29kZUJsb2NrUHJvY2Vzc29yID0gamVzdC5mbigodHlwZSwgcHJvY2Vzc29yKSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKHR5cGUgPT09ICdleG8tbGF5b3V0Jykge1xuICAgICAgICAgICAgICAgICAgICBsYXlvdXRQcm9jZXNzb3IgPSBwcm9jZXNzb3I7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGF3YWl0IHBsdWdpbi5vbmxvYWQoKTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgbW9ja0FwcC53b3Jrc3BhY2UuZ2V0QWN0aXZlRmlsZS5tb2NrUmV0dXJuVmFsdWUobnVsbCk7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGNvbnN0IG1vY2tFbCA9IHtcbiAgICAgICAgICAgICAgICBlbXB0eTogamVzdC5mbigpXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgXG4gICAgICAgICAgICBhd2FpdCBsYXlvdXRQcm9jZXNzb3IoJycsIG1vY2tFbCwge30pO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICBleHBlY3QobW9ja0VsLmVtcHR5KS5ub3QudG9IYXZlQmVlbkNhbGxlZCgpO1xuICAgICAgICB9KTtcbiAgICAgICAgXG4gICAgICAgIHRlc3QoJ3Nob3VsZCBub3QgcmVuZGVyIGlmIG5vIGZyb250bWF0dGVyJywgYXN5bmMgKCkgPT4ge1xuICAgICAgICAgICAgbGV0IGxheW91dFByb2Nlc3NvcjogYW55O1xuICAgICAgICAgICAgcGx1Z2luLnJlZ2lzdGVyTWFya2Rvd25Db2RlQmxvY2tQcm9jZXNzb3IgPSBqZXN0LmZuKCh0eXBlLCBwcm9jZXNzb3IpID0+IHtcbiAgICAgICAgICAgICAgICBpZiAodHlwZSA9PT0gJ2V4by1sYXlvdXQnKSB7XG4gICAgICAgICAgICAgICAgICAgIGxheW91dFByb2Nlc3NvciA9IHByb2Nlc3NvcjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgYXdhaXQgcGx1Z2luLm9ubG9hZCgpO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICBjb25zdCBtb2NrRmlsZSA9IHtcbiAgICAgICAgICAgICAgICBwYXRoOiAndGVzdC5tZCdcbiAgICAgICAgICAgIH0gYXMgVEZpbGU7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIG1vY2tBcHAud29ya3NwYWNlLmdldEFjdGl2ZUZpbGUubW9ja1JldHVyblZhbHVlKG1vY2tGaWxlKTtcbiAgICAgICAgICAgIG1vY2tBcHAubWV0YWRhdGFDYWNoZS5nZXRGaWxlQ2FjaGUubW9ja1JldHVyblZhbHVlKG51bGwpO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICBjb25zdCBtb2NrRWwgPSB7XG4gICAgICAgICAgICAgICAgZW1wdHk6IGplc3QuZm4oKVxuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgYXdhaXQgbGF5b3V0UHJvY2Vzc29yKCcnLCBtb2NrRWwsIHt9KTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgZXhwZWN0KG1vY2tFbC5lbXB0eSkubm90LnRvSGF2ZUJlZW5DYWxsZWQoKTtcbiAgICAgICAgfSk7XG4gICAgfSk7XG4gICAgXG4gICAgZGVzY3JpYmUoJ0xheW91dCBSZW5kZXJpbmcgVHlwZXMnLCAoKSA9PiB7XG4gICAgICAgIHRlc3QoJ3Nob3VsZCBzdXBwb3J0IHF1ZXJ5IGJsb2NrcyBpbiBsYXlvdXRzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgICAgICAgYXdhaXQgcGx1Z2luLm9ubG9hZCgpO1xuICAgICAgICAgICAgY29uc3QgbGF5b3V0UmVuZGVyZXIgPSAocGx1Z2luIGFzIGFueSkubGF5b3V0UmVuZGVyZXI7XG4gICAgICAgICAgICBleHBlY3QobGF5b3V0UmVuZGVyZXIpLnRvQmVEZWZpbmVkKCk7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIC8vIFZlcmlmeSByZW5kZXJlciBoYXMgcXVlcnkgYmxvY2sgc3VwcG9ydFxuICAgICAgICAgICAgZXhwZWN0KChsYXlvdXRSZW5kZXJlciBhcyBhbnkpLnF1ZXJ5UmVuZGVyZXIpLnRvQmVEZWZpbmVkKCk7XG4gICAgICAgIH0pO1xuICAgICAgICBcbiAgICAgICAgdGVzdCgnc2hvdWxkIHN1cHBvcnQgcHJvcGVydGllcyBibG9ja3MgaW4gbGF5b3V0cycsIGFzeW5jICgpID0+IHtcbiAgICAgICAgICAgIGF3YWl0IHBsdWdpbi5vbmxvYWQoKTtcbiAgICAgICAgICAgIGNvbnN0IGxheW91dFJlbmRlcmVyID0gKHBsdWdpbiBhcyBhbnkpLmxheW91dFJlbmRlcmVyO1xuICAgICAgICAgICAgZXhwZWN0KGxheW91dFJlbmRlcmVyKS50b0JlRGVmaW5lZCgpO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICAvLyBWZXJpZnkgcmVuZGVyZXIgaGFzIHByb3BlcnRpZXMgYmxvY2sgc3VwcG9ydFxuICAgICAgICAgICAgZXhwZWN0KChsYXlvdXRSZW5kZXJlciBhcyBhbnkpLnByb3BlcnRpZXNSZW5kZXJlcikudG9CZURlZmluZWQoKTtcbiAgICAgICAgfSk7XG4gICAgICAgIFxuICAgICAgICB0ZXN0KCdzaG91bGQgc3VwcG9ydCBiYWNrbGlua3MgYmxvY2tzIGluIGxheW91dHMnLCBhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICBhd2FpdCBwbHVnaW4ub25sb2FkKCk7XG4gICAgICAgICAgICBjb25zdCBsYXlvdXRSZW5kZXJlciA9IChwbHVnaW4gYXMgYW55KS5sYXlvdXRSZW5kZXJlcjtcbiAgICAgICAgICAgIGV4cGVjdChsYXlvdXRSZW5kZXJlcikudG9CZURlZmluZWQoKTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgLy8gVmVyaWZ5IHJlbmRlcmVyIGhhcyBiYWNrbGlua3MgYmxvY2sgc3VwcG9ydFxuICAgICAgICAgICAgZXhwZWN0KChsYXlvdXRSZW5kZXJlciBhcyBhbnkpLmJhY2tsaW5rc1JlbmRlcmVyKS50b0JlRGVmaW5lZCgpO1xuICAgICAgICB9KTtcbiAgICAgICAgXG4gICAgICAgIHRlc3QoJ3Nob3VsZCBzdXBwb3J0IGN1c3RvbSBibG9ja3MgaW4gbGF5b3V0cycsIGFzeW5jICgpID0+IHtcbiAgICAgICAgICAgIGF3YWl0IHBsdWdpbi5vbmxvYWQoKTtcbiAgICAgICAgICAgIGNvbnN0IGxheW91dFJlbmRlcmVyID0gKHBsdWdpbiBhcyBhbnkpLmxheW91dFJlbmRlcmVyO1xuICAgICAgICAgICAgZXhwZWN0KGxheW91dFJlbmRlcmVyKS50b0JlRGVmaW5lZCgpO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICAvLyBWZXJpZnkgcmVuZGVyZXIgaGFzIGN1c3RvbSBibG9jayBzdXBwb3J0XG4gICAgICAgICAgICBleHBlY3QoKGxheW91dFJlbmRlcmVyIGFzIGFueSkuY3VzdG9tUmVuZGVyZXIpLnRvQmVEZWZpbmVkKCk7XG4gICAgICAgIH0pO1xuICAgIH0pO1xufSk7Il0sInZlcnNpb24iOjN9