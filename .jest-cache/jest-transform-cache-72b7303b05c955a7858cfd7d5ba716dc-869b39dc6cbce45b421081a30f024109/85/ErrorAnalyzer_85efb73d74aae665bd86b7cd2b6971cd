998102e06e3b66da9cf13257489990a2
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.ErrorAnalyzer = void 0;
const ExocortexError_1 = require("./ExocortexError");
class ErrorAnalyzer {
    static analyze(error) {
        const errorMessage = typeof error === "string" ? error : error.message;
        const stackTrace = error instanceof Error ? error.stack : undefined;
        for (const pattern of this.patterns) {
            const match = errorMessage.match(pattern.pattern);
            if (match) {
                return ExocortexError_1.ErrorBuilder.create()
                    .withSeverity(pattern.severity)
                    .withCategory(pattern.category)
                    .withTitle(pattern.title)
                    .withMessage(pattern.getUserMessage(match))
                    .withContext({
                    operation: "Error Analysis",
                    timestamp: new Date(),
                })
                    .withTechnicalDetails(errorMessage)
                    .withSuggestions(pattern.getSuggestions(match))
                    .withRecoverable(pattern.recoverable)
                    .withStackTrace(stackTrace || "")
                    .build();
            }
        }
        return ExocortexError_1.ErrorBuilder.create()
            .withSeverity(ExocortexError_1.ErrorSeverity.ERROR)
            .withCategory(ExocortexError_1.ErrorCategory.SYSTEM)
            .withTitle("Unknown Error")
            .withMessage("An unexpected error occurred. Please check the technical details for more information.")
            .withContext({
            operation: "Error Analysis",
            timestamp: new Date(),
        })
            .withTechnicalDetails(errorMessage)
            .withRecoverable(false)
            .withStackTrace(stackTrace || "")
            .build();
    }
    static getSPARQLErrorLocation(query, errorPosition) {
        if (!errorPosition || errorPosition < 0)
            return undefined;
        const lines = query.split("\n");
        let currentPosition = 0;
        for (let lineIndex = 0; lineIndex < lines.length; lineIndex++) {
            const lineLength = lines[lineIndex].length;
            if (currentPosition + lineLength >= errorPosition) {
                return {
                    line: lineIndex + 1,
                    column: errorPosition - currentPosition + 1,
                };
            }
            currentPosition += lineLength + 1; // +1 for the newline character
        }
        return undefined;
    }
    static addPattern(pattern) {
        this.patterns.push(pattern);
    }
    static clearPatterns() {
        this.patterns = [];
    }
}
exports.ErrorAnalyzer = ErrorAnalyzer;
ErrorAnalyzer.patterns = [
    {
        pattern: /Unexpected token '([^']+)' at position (\d+)/i,
        severity: ExocortexError_1.ErrorSeverity.ERROR,
        category: ExocortexError_1.ErrorCategory.SYNTAX,
        title: "SPARQL Syntax Error",
        getUserMessage: (match) => `Unexpected '${match[1]}' at position ${match[2]}. Check for missing brackets or incorrect syntax.`,
        getSuggestions: (match) => [
            {
                title: "Check Syntax",
                description: `The character '${match[1]}' was not expected at this position.`,
                confidence: 0.9,
            },
            {
                title: "Common Fixes",
                description: "Ensure all brackets are closed and keywords are spelled correctly.",
                confidence: 0.7,
                learnMore: {
                    url: "https://www.w3.org/TR/sparql11-query/",
                    title: "SPARQL Syntax Guide",
                },
            },
        ],
        recoverable: true,
    },
    {
        pattern: /Unknown prefix: ([^\s]+)/i,
        severity: ExocortexError_1.ErrorSeverity.ERROR,
        category: ExocortexError_1.ErrorCategory.SEMANTIC,
        title: "Unknown Prefix",
        getUserMessage: (match) => `The prefix '${match[1]}' is not defined. Add a PREFIX declaration at the beginning of your query.`,
        getSuggestions: (match) => [
            {
                title: "Add PREFIX Declaration",
                description: `Add: PREFIX ${match[1]} <http://example.org/${match[1].replace(":", "")}#> at the beginning`,
                confidence: 0.95,
                action: {
                    label: "Add PREFIX",
                    handler: () => console.log("Adding prefix..."),
                },
            },
        ],
        recoverable: true,
    },
    {
        pattern: /Query timeout after (\d+)ms/i,
        severity: ExocortexError_1.ErrorSeverity.WARNING,
        category: ExocortexError_1.ErrorCategory.SYSTEM,
        title: "Query Timeout",
        getUserMessage: (match) => `Your query took longer than ${match[1]}ms and was cancelled. Try simplifying the query or adding limits.`,
        getSuggestions: () => [
            {
                title: "Add LIMIT Clause",
                description: "Restrict the number of results with LIMIT 100",
                confidence: 0.8,
                action: {
                    label: "Add LIMIT",
                    handler: () => console.log("Adding limit..."),
                },
            },
            {
                title: "Optimize Query",
                description: "Simplify triple patterns or reduce the scope",
                confidence: 0.7,
                learnMore: {
                    url: "https://docs.exocortex.com/query-optimization",
                    title: "Query Optimization Guide",
                },
            },
        ],
        recoverable: true,
    },
    {
        pattern: /Invalid IRI: ([^\s]+)/i,
        severity: ExocortexError_1.ErrorSeverity.ERROR,
        category: ExocortexError_1.ErrorCategory.VALIDATION,
        title: "Invalid IRI",
        getUserMessage: (match) => `'${match[1]}' is not a valid IRI. IRIs must be absolute URIs enclosed in angle brackets.`,
        getSuggestions: (match) => {
            const suggestions = [];
            if (!match[1].startsWith("<") || !match[1].endsWith(">")) {
                suggestions.push({
                    title: "Add Angle Brackets",
                    description: `Enclose the IRI in angle brackets: <${match[1]}>`,
                    confidence: 0.9,
                });
            }
            if (!match[1].includes("://")) {
                suggestions.push({
                    title: "Use Absolute IRI",
                    description: "IRIs must be absolute URLs, e.g., <http://example.org/resource>",
                    confidence: 0.85,
                });
            }
            return suggestions;
        },
        recoverable: true,
    },
    {
        pattern: /Empty result set/i,
        severity: ExocortexError_1.ErrorSeverity.INFO,
        category: ExocortexError_1.ErrorCategory.SEMANTIC,
        title: "No Results Found",
        getUserMessage: () => "Your query executed successfully but returned no results. This might be expected, or you may need to adjust your query criteria.",
        getSuggestions: () => [
            {
                title: "Check Triple Patterns",
                description: "Ensure your triple patterns match existing data",
                confidence: 0.6,
            },
            {
                title: "Broaden Search Criteria",
                description: "Try using more general patterns or OPTIONAL clauses",
                confidence: 0.5,
            },
        ],
        recoverable: true,
    },
    {
        pattern: /Circular reference detected/i,
        severity: ExocortexError_1.ErrorSeverity.WARNING,
        category: ExocortexError_1.ErrorCategory.SEMANTIC,
        title: "Circular Reference",
        getUserMessage: () => "A circular reference was detected in your ontology. This may cause infinite loops in reasoning.",
        getSuggestions: () => [
            {
                title: "Review Ontology Structure",
                description: "Check for classes that reference themselves directly or indirectly",
                confidence: 0.7,
            },
            {
                title: "Use Reasoning Limits",
                description: "Set maximum inference depth to prevent infinite loops",
                confidence: 0.8,
            },
        ],
        recoverable: true,
    },
];
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL2tpdGVsZXYvRG9jdW1lbnRzL2V4b2NvcnRleC1vYnNpZGlhbi1wbHVnaW4vc3JjL2RvbWFpbi9lcnJvcnMvRXJyb3JBbmFseXplci50cyIsIm1hcHBpbmdzIjoiOzs7QUFBQSxxREFNMEI7QUFZMUIsTUFBYSxhQUFhO0lBeUp4QixNQUFNLENBQUMsT0FBTyxDQUFDLEtBQXFCO1FBQ2xDLE1BQU0sWUFBWSxHQUFHLE9BQU8sS0FBSyxLQUFLLFFBQVEsQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUMsT0FBTyxDQUFDO1FBQ3ZFLE1BQU0sVUFBVSxHQUFHLEtBQUssWUFBWSxLQUFLLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLFNBQVMsQ0FBQztRQUVwRSxLQUFLLE1BQU0sT0FBTyxJQUFJLElBQUksQ0FBQyxRQUFRLEVBQUU7WUFDbkMsTUFBTSxLQUFLLEdBQUcsWUFBWSxDQUFDLEtBQUssQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFDLENBQUM7WUFDbEQsSUFBSSxLQUFLLEVBQUU7Z0JBQ1QsT0FBTyw2QkFBWSxDQUFDLE1BQU0sRUFBRTtxQkFDekIsWUFBWSxDQUFDLE9BQU8sQ0FBQyxRQUFRLENBQUM7cUJBQzlCLFlBQVksQ0FBQyxPQUFPLENBQUMsUUFBUSxDQUFDO3FCQUM5QixTQUFTLENBQUMsT0FBTyxDQUFDLEtBQUssQ0FBQztxQkFDeEIsV0FBVyxDQUFDLE9BQU8sQ0FBQyxjQUFjLENBQUMsS0FBSyxDQUFDLENBQUM7cUJBQzFDLFdBQVcsQ0FBQztvQkFDWCxTQUFTLEVBQUUsZ0JBQWdCO29CQUMzQixTQUFTLEVBQUUsSUFBSSxJQUFJLEVBQUU7aUJBQ3RCLENBQUM7cUJBQ0Qsb0JBQW9CLENBQUMsWUFBWSxDQUFDO3FCQUNsQyxlQUFlLENBQUMsT0FBTyxDQUFDLGNBQWMsQ0FBQyxLQUFLLENBQUMsQ0FBQztxQkFDOUMsZUFBZSxDQUFDLE9BQU8sQ0FBQyxXQUFXLENBQUM7cUJBQ3BDLGNBQWMs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TyxFQUFFLG1CQUFtQjtRQUM1QixRQUFRLEVBQUUsOEJBQWEsQ0FBQyxJQUFJO1FBQzVCLFFBQVEsRUFBRSw4QkFBYSxDQUFDLFFBQVE7UUFDaEMsS0FBSyxFQUFFLGtCQUFrQjtRQUN6QixjQUFjLEVBQUUsR0FBRyxFQUFFLENBQ25CLGtJQUFrSTtRQUNwSSxjQUFjLEVBQUUsR0FBRyxFQUFFLENBQUM7WUFDcEI7Z0JBQ0UsS0FBSyxFQUFFLHVCQUF1QjtnQkFDOUIsV0FBVyxFQUFFLGlEQUFpRDtnQkFDOUQsVUFBVSxFQUFFLEdBQUc7YUFDaEI7WUFDRDtnQkFDRSxLQUFLLEVBQUUseUJBQXlCO2dCQUNoQyxXQUFXLEVBQUUscURBQXFEO2dCQUNsRSxVQUFVLEVBQUUsR0FBRzthQUNoQjtTQUNGO1FBQ0QsV0FBVyxFQUFFLElBQUk7S0FDbEI7SUFDRDtRQUNFLE9BQU8sRUFBRSw4QkFBOEI7UUFDdkMsUUFBUSxFQUFFLDhCQUFhLENBQUMsT0FBTztRQUMvQixRQUFRLEVBQUUsOEJBQWEsQ0FBQyxRQUFRO1FBQ2hDLEtBQUssRUFBRSxvQkFBb0I7UUFDM0IsY0FBYyxFQUFFLEdBQUcsRUFBRSxDQUNuQixpR0FBaUc7UUFDbkcsY0FBYyxFQUFFLEdBQUcsRUFBRSxDQUFDO1lBQ3BCO2dCQUNFLEtBQUssRUFBRSwyQkFBMkI7Z0JBQ2xDLFdBQVcsRUFDVCxvRUFBb0U7Z0JBQ3RFLFVBQVUsRUFBRSxHQUFHO2FBQ2hCO1lBQ0Q7Z0JBQ0UsS0FBSyxFQUFFLHNCQUFzQjtnQkFDN0IsV0FBVyxFQUFFLHVEQUF1RDtnQkFDcEUsVUFBVSxFQUFFLEdBQUc7YUFDaEI7U0FDRjtRQUNELFdBQVcsRUFBRSxJQUFJO0tBQ2xCO0NBQ0YsQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyIvVXNlcnMva2l0ZWxldi9Eb2N1bWVudHMvZXhvY29ydGV4LW9ic2lkaWFuLXBsdWdpbi9zcmMvZG9tYWluL2Vycm9ycy9FcnJvckFuYWx5emVyLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XG4gIEVycm9yU2V2ZXJpdHksXG4gIEVycm9yQ2F0ZWdvcnksXG4gIEV4b2NvcnRleEVycm9yLFxuICBGaXhTdWdnZXN0aW9uLFxuICBFcnJvckJ1aWxkZXIsXG59IGZyb20gXCIuL0V4b2NvcnRleEVycm9yXCI7XG5cbmV4cG9ydCBpbnRlcmZhY2UgRXJyb3JQYXR0ZXJuIHtcbiAgcGF0dGVybjogUmVnRXhwO1xuICBzZXZlcml0eTogRXJyb3JTZXZlcml0eTtcbiAgY2F0ZWdvcnk6IEVycm9yQ2F0ZWdvcnk7XG4gIHRpdGxlOiBzdHJpbmc7XG4gIGdldFVzZXJNZXNzYWdlOiAobWF0Y2g6IFJlZ0V4cE1hdGNoQXJyYXkpID0+IHN0cmluZztcbiAgZ2V0U3VnZ2VzdGlvbnM6IChtYXRjaDogUmVnRXhwTWF0Y2hBcnJheSkgPT4gRml4U3VnZ2VzdGlvbltdO1xuICByZWNvdmVyYWJsZTogYm9vbGVhbjtcbn1cblxuZXhwb3J0IGNsYXNzIEVycm9yQW5hbHl6ZXIge1xuICBwcml2YXRlIHN0YXRpYyBwYXR0ZXJuczogRXJyb3JQYXR0ZXJuW10gPSBbXG4gICAge1xuICAgICAgcGF0dGVybjogL1VuZXhwZWN0ZWQgdG9rZW4gJyhbXiddKyknIGF0IHBvc2l0aW9uIChcXGQrKS9pLFxuICAgICAgc2V2ZXJpdHk6IEVycm9yU2V2ZXJpdHkuRVJST1IsXG4gICAgICBjYXRlZ29yeTogRXJyb3JDYXRlZ29yeS5TWU5UQVgsXG4gICAgICB0aXRsZTogXCJTUEFSUUwgU3ludGF4IEVycm9yXCIsXG4gICAgICBnZXRVc2VyTWVzc2FnZTogKG1hdGNoKSA9PlxuICAgICAgICBgVW5leHBlY3RlZCAnJHttYXRjaFsxXX0nIGF0IHBvc2l0aW9uICR7bWF0Y2hbMl19LiBDaGVjayBmb3IgbWlzc2luZyBicmFja2V0cyBvciBpbmNvcnJlY3Qgc3ludGF4LmAsXG4gICAgICBnZXRTdWdnZXN0aW9uczogKG1hdGNoKSA9PiBbXG4gICAgICAgIHtcbiAgICAgICAgICB0aXRsZTogXCJDaGVjayBTeW50YXhcIixcbiAgICAgICAgICBkZXNjcmlwdGlvbjogYFRoZSBjaGFyYWN0ZXIgJyR7bWF0Y2hbMV19JyB3YXMgbm90IGV4cGVjdGVkIGF0IHRoaXMgcG9zaXRpb24uYCxcbiAgICAgICAgICBjb25maWRlbmNlOiAwLjksXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICB0aXRsZTogXCJDb21tb24gRml4ZXNcIixcbiAgICAgICAgICBkZXNjcmlwdGlvbjpcbiAgICAgICAgICAgIFwiRW5zdXJlIGFsbCBicmFja2V0cyBhcmUgY2xvc2VkIGFuZCBrZXl3b3JkcyBhcmUgc3BlbGxlZCBjb3JyZWN0bHkuXCIsXG4gICAgICAgICAgY29uZmlkZW5jZTogMC43LFxuICAgICAgICAgIGxlYXJuTW9yZToge1xuICAgICAgICAgICAgdXJsOiBcImh0dHBzOi8vd3d3LnczLm9yZy9UUi9zcGFycWwxMS1xdWVyeS9cIixcbiAgICAgICAgICAgIHRpdGxlOiBcIlNQQVJRTCBTeW50YXggR3VpZGVcIixcbiAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgXSxcbiAgICAgIHJlY292ZXJhYmxlOiB0cnVlLFxuICAgIH0sXG4gICAge1xuICAgICAgcGF0dGVybjogL1Vua25vd24gcHJlZml4OiAoW15cXHNdKykvaSxcbiAgICAgIHNldmVyaXR5OiBFcnJvclNldmVyaXR5LkVSUk9SLFxuICAgICAgY2F0ZWdvcnk6IEVycm9yQ2F0ZWdvcnkuU0VNQU5USUMsXG4gICAgICB0aXRsZTogXCJVbmtub3duIFByZWZpeFwiLFxuICAgICAgZ2V0VXNlck1lc3NhZ2U6IChtYXRjaCkgPT5cbiAgICAgICAgYFRoZSBwcmVmaXggJyR7bWF0Y2hbMV19JyBpcyBub3QgZGVmaW5lZC4gQWRkIGEgUFJFRklYIGRlY2xhcmF0aW9uIGF0IHRoZSBiZWdpbm5pbmcgb2YgeW91ciBxdWVyeS5gLFxuICAgICAgZ2V0U3VnZ2VzdGlvbnM6IChtYXRjaCkgPT4gW1xuICAgICAgICB7XG4gICAgICAgICAgdGl0bGU6IFwiQWRkIFBSRUZJWCBEZWNsYXJhdGlvblwiLFxuICAgICAgICAgIGRlc2NyaXB0aW9uOiBgQWRkOiBQUkVGSVggJHttYXRjaFsxXX0gPGh0dHA6Ly9leGFtcGxlLm9yZy8ke21hdGNoWzFdLnJlcGxhY2UoXCI6XCIsIFwiXCIpfSM+IGF0IHRoZSBiZWdpbm5pbmdgLFxuICAgICAgICAgIGNvbmZpZGVuY2U6IDAuOTUsXG4gICAgICAgICAgYWN0aW9uOiB7XG4gICAgICAgICAgICBsYWJlbDogXCJBZGQgUFJFRklYXCIsXG4gICAgICAgICAgICBoYW5kbGVyOiAoKSA9PiBjb25zb2xlLmxvZyhcIkFkZGluZyBwcmVmaXguLi5cIiksXG4gICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgIF0sXG4gICAgICByZWNvdmVyYWJsZTogdHJ1ZSxcbiAgICB9LFxuICAgIHtcbiAgICAgIHBhdHRlcm46IC9RdWVyeSB0aW1lb3V0IGFmdGVyIChcXGQrKW1zL2ksXG4gICAgICBzZXZlcml0eTogRXJyb3JTZXZlcml0eS5XQVJOSU5HLFxuICAgICAgY2F0ZWdvcnk6IEVycm9yQ2F0ZWdvcnkuU1lTVEVNLFxuICAgICAgdGl0bGU6IFwiUXVlcnkgVGltZW91dFwiLFxuICAgICAgZ2V0VXNlck1lc3NhZ2U6IChtYXRjaCkgPT5cbiAgICAgICAgYFlvdXIgcXVlcnkgdG9vayBsb25nZXIgdGhhbiAke21hdGNoWzFdfW1zIGFuZCB3YXMgY2FuY2VsbGVkLiBUcnkgc2ltcGxpZnlpbmcgdGhlIHF1ZXJ5IG9yIGFkZGluZyBsaW1pdHMuYCxcbiAgICAgIGdldFN1Z2dlc3Rpb25zOiAoKSA9PiBbXG4gICAgICAgIHtcbiAgICAgICAgICB0aXRsZTogXCJBZGQgTElNSVQgQ2xhdXNlXCIsXG4gICAgICAgICAgZGVzY3JpcHRpb246IFwiUmVzdHJpY3QgdGhlIG51bWJlciBvZiByZXN1bHRzIHdpdGggTElNSVQgMTAwXCIsXG4gICAgICAgICAgY29uZmlkZW5jZTogMC44LFxuICAgICAgICAgIGFjdGlvbjoge1xuICAgICAgICAgICAgbGFiZWw6IFwiQWRkIExJTUlUXCIsXG4gICAgICAgICAgICBoYW5kbGVyOiAoKSA9PiBjb25zb2xlLmxvZyhcIkFkZGluZyBsaW1pdC4uLlwiKSxcbiAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgdGl0bGU6IFwiT3B0aW1pemUgUXVlcnlcIixcbiAgICAgICAgICBkZXNjcmlwdGlvbjogXCJTaW1wbGlmeSB0cmlwbGUgcGF0dGVybnMgb3IgcmVkdWNlIHRoZSBzY29wZVwiLFxuICAgICAgICAgIGNvbmZpZGVuY2U6IDAuNyxcbiAgICAgICAgICBsZWFybk1vcmU6IHtcbiAgICAgICAgICAgIHVybDogXCJodHRwczovL2RvY3MuZXhvY29ydGV4LmNvbS9xdWVyeS1vcHRpbWl6YXRpb25cIixcbiAgICAgICAgICAgIHRpdGxlOiBcIlF1ZXJ5IE9wdGltaXphdGlvbiBHdWlkZVwiLFxuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICBdLFxuICAgICAgcmVjb3ZlcmFibGU6IHRydWUsXG4gICAgfSxcbiAgICB7XG4gICAgICBwYXR0ZXJuOiAvSW52YWxpZCBJUkk6IChbXlxcc10rKS9pLFxuICAgICAgc2V2ZXJpdHk6IEVycm9yU2V2ZXJpdHkuRVJST1IsXG4gICAgICBjYXRlZ29yeTogRXJyb3JDYXRlZ29yeS5WQUxJREFUSU9OLFxuICAgICAgdGl0bGU6IFwiSW52YWxpZCBJUklcIixcbiAgICAgIGdldFVzZXJNZXNzYWdlOiAobWF0Y2gpID0+XG4gICAgICAgIGAnJHttYXRjaFsxXX0nIGlzIG5vdCBhIHZhbGlkIElSSS4gSVJJcyBtdXN0IGJlIGFic29sdXRlIFVSSXMgZW5jbG9zZWQgaW4gYW5nbGUgYnJhY2tldHMuYCxcbiAgICAgIGdldFN1Z2dlc3Rpb25zOiAobWF0Y2gpID0+IHtcbiAgICAgICAgY29uc3Qgc3VnZ2VzdGlvbnM6IEZpeFN1Z2dlc3Rpb25bXSA9IFtdO1xuXG4gICAgICAgIGlmICghbWF0Y2hbMV0uc3RhcnRzV2l0aChcIjxcIikgfHwgIW1hdGNoWzFdLmVuZHNXaXRoKFwiPlwiKSkge1xuICAgICAgICAgIHN1Z2dlc3Rpb25zLnB1c2goe1xuICAgICAgICAgICAgdGl0bGU6IFwiQWRkIEFuZ2xlIEJyYWNrZXRzXCIsXG4gICAgICAgICAgICBkZXNjcmlwdGlvbjogYEVuY2xvc2UgdGhlIElSSSBpbiBhbmdsZSBicmFja2V0czogPCR7bWF0Y2hbMV19PmAsXG4gICAgICAgICAgICBjb25maWRlbmNlOiAwLjksXG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoIW1hdGNoWzFdLmluY2x1ZGVzKFwiOi8vXCIpKSB7XG4gICAgICAgICAgc3VnZ2VzdGlvbnMucHVzaCh7XG4gICAgICAgICAgICB0aXRsZTogXCJVc2UgQWJzb2x1dGUgSVJJXCIsXG4gICAgICAgICAgICBkZXNjcmlwdGlvbjpcbiAgICAgICAgICAgICAgXCJJUklzIG11c3QgYmUgYWJzb2x1dGUgVVJMcywgZS5nLiwgPGh0dHA6Ly9leGFtcGxlLm9yZy9yZXNvdXJjZT5cIixcbiAgICAgICAgICAgIGNvbmZpZGVuY2U6IDAuODUsXG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gc3VnZ2VzdGlvbnM7XG4gICAgICB9LFxuICAgICAgcmVjb3ZlcmFibGU6IHRydWUsXG4gICAgfSxcbiAgICB7XG4gICAgICBwYXR0ZXJuOiAvRW1wdHkgcmVzdWx0IHNldC9pLFxuICAgICAgc2V2ZXJpdHk6IEVycm9yU2V2ZXJpdHkuSU5GTyxcbiAgICAgIGNhdGVnb3J5OiBFcnJvckNhdGVnb3J5LlNFTUFOVElDLFxuICAgICAgdGl0bGU6IFwiTm8gUmVzdWx0cyBGb3VuZFwiLFxuICAgICAgZ2V0VXNlck1lc3NhZ2U6ICgpID0+XG4gICAgICAgIFwiWW91ciBxdWVyeSBleGVjdXRlZCBzdWNjZXNzZnVsbHkgYnV0IHJldHVybmVkIG5vIHJlc3VsdHMuIFRoaXMgbWlnaHQgYmUgZXhwZWN0ZWQsIG9yIHlvdSBtYXkgbmVlZCB0byBhZGp1c3QgeW91ciBxdWVyeSBjcml0ZXJpYS5cIixcbiAgICAgIGdldFN1Z2dlc3Rpb25zOiAoKSA9PiBbXG4gICAgICAgIHtcbiAgICAgICAgICB0aXRsZTogXCJDaGVjayBUcmlwbGUgUGF0dGVybnNcIixcbiAgICAgICAgICBkZXNjcmlwdGlvbjogXCJFbnN1cmUgeW91ciB0cmlwbGUgcGF0dGVybnMgbWF0Y2ggZXhpc3RpbmcgZGF0YVwiLFxuICAgICAgICAgIGNvbmZpZGVuY2U6IDAuNixcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgIHRpdGxlOiBcIkJyb2FkZW4gU2VhcmNoIENyaXRlcmlhXCIsXG4gICAgICAgICAgZGVzY3JpcHRpb246IFwiVHJ5IHVzaW5nIG1vcmUgZ2VuZXJhbCBwYXR0ZXJucyBvciBPUFRJT05BTCBjbGF1c2VzXCIsXG4gICAgICAgICAgY29uZmlkZW5jZTogMC41LFxuICAgICAgICB9LFxuICAgICAgXSxcbiAgICAgIHJlY292ZXJhYmxlOiB0cnVlLFxuICAgIH0sXG4gICAge1xuICAgICAgcGF0dGVybjogL0NpcmN1bGFyIHJlZmVyZW5jZSBkZXRlY3RlZC9pLFxuICAgICAgc2V2ZXJpdHk6IEVycm9yU2V2ZXJpdHkuV0FSTklORyxcbiAgICAgIGNhdGVnb3J5OiBFcnJvckNhdGVnb3J5LlNFTUFOVElDLFxuICAgICAgdGl0bGU6IFwiQ2lyY3VsYXIgUmVmZXJlbmNlXCIsXG4gICAgICBnZXRVc2VyTWVzc2FnZTogKCkgPT5cbiAgICAgICAgXCJBIGNpcmN1bGFyIHJlZmVyZW5jZSB3YXMgZGV0ZWN0ZWQgaW4geW91ciBvbnRvbG9neS4gVGhpcyBtYXkgY2F1c2UgaW5maW5pdGUgbG9vcHMgaW4gcmVhc29uaW5nLlwiLFxuICAgICAgZ2V0U3VnZ2VzdGlvbnM6ICgpID0+IFtcbiAgICAgICAge1xuICAgICAgICAgIHRpdGxlOiBcIlJldmlldyBPbnRvbG9neSBTdHJ1Y3R1cmVcIixcbiAgICAgICAgICBkZXNjcmlwdGlvbjpcbiAgICAgICAgICAgIFwiQ2hlY2sgZm9yIGNsYXNzZXMgdGhhdCByZWZlcmVuY2UgdGhlbXNlbHZlcyBkaXJlY3RseSBvciBpbmRpcmVjdGx5XCIsXG4gICAgICAgICAgY29uZmlkZW5jZTogMC43LFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgdGl0bGU6IFwiVXNlIFJlYXNvbmluZyBMaW1pdHNcIixcbiAgICAgICAgICBkZXNjcmlwdGlvbjogXCJTZXQgbWF4aW11bSBpbmZlcmVuY2UgZGVwdGggdG8gcHJldmVudCBpbmZpbml0ZSBsb29wc1wiLFxuICAgICAgICAgIGNvbmZpZGVuY2U6IDAuOCxcbiAgICAgICAgfSxcbiAgICAgIF0sXG4gICAgICByZWNvdmVyYWJsZTogdHJ1ZSxcbiAgICB9LFxuICBdO1xuXG4gIHN0YXRpYyBhbmFseXplKGVycm9yOiBFcnJvciB8IHN0cmluZyk6IEV4b2NvcnRleEVycm9yIHtcbiAgICBjb25zdCBlcnJvck1lc3NhZ2UgPSB0eXBlb2YgZXJyb3IgPT09IFwic3RyaW5nXCIgPyBlcnJvciA6IGVycm9yLm1lc3NhZ2U7XG4gICAgY29uc3Qgc3RhY2tUcmFjZSA9IGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5zdGFjayA6IHVuZGVmaW5lZDtcblxuICAgIGZvciAoY29uc3QgcGF0dGVybiBvZiB0aGlzLnBhdHRlcm5zKSB7XG4gICAgICBjb25zdCBtYXRjaCA9IGVycm9yTWVzc2FnZS5tYXRjaChwYXR0ZXJuLnBhdHRlcm4pO1xuICAgICAgaWYgKG1hdGNoKSB7XG4gICAgICAgIHJldHVybiBFcnJvckJ1aWxkZXIuY3JlYXRlKClcbiAgICAgICAgICAud2l0aFNldmVyaXR5KHBhdHRlcm4uc2V2ZXJpdHkpXG4gICAgICAgICAgLndpdGhDYXRlZ29yeShwYXR0ZXJuLmNhdGVnb3J5KVxuICAgICAgICAgIC53aXRoVGl0bGUocGF0dGVybi50aXRsZSlcbiAgICAgICAgICAud2l0aE1lc3NhZ2UocGF0dGVybi5nZXRVc2VyTWVzc2FnZShtYXRjaCkpXG4gICAgICAgICAgLndpdGhDb250ZXh0KHtcbiAgICAgICAgICAgIG9wZXJhdGlvbjogXCJFcnJvciBBbmFseXNpc1wiLFxuICAgICAgICAgICAgdGltZXN0YW1wOiBuZXcgRGF0ZSgpLFxuICAgICAgICAgIH0pXG4gICAgICAgICAgLndpdGhUZWNobmljYWxEZXRhaWxzKGVycm9yTWVzc2FnZSlcbiAgICAgICAgICAud2l0aFN1Z2dlc3Rpb25zKHBhdHRlcm4uZ2V0U3VnZ2VzdGlvbnMobWF0Y2gpKVxuICAgICAgICAgIC53aXRoUmVjb3ZlcmFibGUocGF0dGVybi5yZWNvdmVyYWJsZSlcbiAgICAgICAgICAud2l0aFN0YWNrVHJhY2Uoc3RhY2tUcmFjZSB8fCBcIlwiKVxuICAgICAgICAgIC5idWlsZCgpO1xuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiBFcnJvckJ1aWxkZXIuY3JlYXRlKClcbiAgICAgIC53aXRoU2V2ZXJpdHkoRXJyb3JTZXZlcml0eS5FUlJPUilcbiAgICAgIC53aXRoQ2F0ZWdvcnkoRXJyb3JDYXRlZ29yeS5TWVNURU0pXG4gICAgICAud2l0aFRpdGxlKFwiVW5rbm93biBFcnJvclwiKVxuICAgICAgLndpdGhNZXNzYWdlKFxuICAgICAgICBcIkFuIHVuZXhwZWN0ZWQgZXJyb3Igb2NjdXJyZWQuIFBsZWFzZSBjaGVjayB0aGUgdGVjaG5pY2FsIGRldGFpbHMgZm9yIG1vcmUgaW5mb3JtYXRpb24uXCIsXG4gICAgICApXG4gICAgICAud2l0aENvbnRleHQoe1xuICAgICAgICBvcGVyYXRpb246IFwiRXJyb3IgQW5hbHlzaXNcIixcbiAgICAgICAgdGltZXN0YW1wOiBuZXcgRGF0ZSgpLFxuICAgICAgfSlcbiAgICAgIC53aXRoVGVjaG5pY2FsRGV0YWlscyhlcnJvck1lc3NhZ2UpXG4gICAgICAud2l0aFJlY292ZXJhYmxlKGZhbHNlKVxuICAgICAgLndpdGhTdGFja1RyYWNlKHN0YWNrVHJhY2UgfHwgXCJcIilcbiAgICAgIC5idWlsZCgpO1xuICB9XG5cbiAgc3RhdGljIGdldFNQQVJRTEVycm9yTG9jYXRpb24oXG4gICAgcXVlcnk6IHN0cmluZyxcbiAgICBlcnJvclBvc2l0aW9uPzogbnVtYmVyLFxuICApOiB7IGxpbmU6IG51bWJlcjsgY29sdW1uOiBudW1iZXIgfSB8IHVuZGVmaW5lZCB7XG4gICAgaWYgKCFlcnJvclBvc2l0aW9uIHx8IGVycm9yUG9zaXRpb24gPCAwKSByZXR1cm4gdW5kZWZpbmVkO1xuXG4gICAgY29uc3QgbGluZXMgPSBxdWVyeS5zcGxpdChcIlxcblwiKTtcbiAgICBsZXQgY3VycmVudFBvc2l0aW9uID0gMDtcblxuICAgIGZvciAobGV0IGxpbmVJbmRleCA9IDA7IGxpbmVJbmRleCA8IGxpbmVzLmxlbmd0aDsgbGluZUluZGV4KyspIHtcbiAgICAgIGNvbnN0IGxpbmVMZW5ndGggPSBsaW5lc1tsaW5lSW5kZXhdLmxlbmd0aDtcblxuICAgICAgaWYgKGN1cnJlbnRQb3NpdGlvbiArIGxpbmVMZW5ndGggPj0gZXJyb3JQb3NpdGlvbikge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIGxpbmU6IGxpbmVJbmRleCArIDEsXG4gICAgICAgICAgY29sdW1uOiBlcnJvclBvc2l0aW9uIC0gY3VycmVudFBvc2l0aW9uICsgMSxcbiAgICAgICAgfTtcbiAgICAgIH1cblxuICAgICAgY3VycmVudFBvc2l0aW9uICs9IGxpbmVMZW5ndGggKyAxOyAvLyArMSBmb3IgdGhlIG5ld2xpbmUgY2hhcmFjdGVyXG4gICAgfVxuXG4gICAgcmV0dXJuIHVuZGVmaW5lZDtcbiAgfVxuXG4gIHN0YXRpYyBhZGRQYXR0ZXJuKHBhdHRlcm46IEVycm9yUGF0dGVybik6IHZvaWQge1xuICAgIHRoaXMucGF0dGVybnMucHVzaChwYXR0ZXJuKTtcbiAgfVxuXG4gIHN0YXRpYyBjbGVhclBhdHRlcm5zKCk6IHZvaWQge1xuICAgIHRoaXMucGF0dGVybnMgPSBbXTtcbiAgfVxufVxuIl0sInZlcnNpb24iOjN9