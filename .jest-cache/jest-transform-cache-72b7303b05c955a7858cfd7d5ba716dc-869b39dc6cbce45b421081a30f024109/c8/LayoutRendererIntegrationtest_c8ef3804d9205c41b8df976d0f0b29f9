1ac0dc5ada68a8b66cffa56dd1330430
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const tslib_1 = require("tslib");
const main_1 = tslib_1.__importDefault(require("../../main"));
describe.skip('LayoutRenderer Integration (deprecated)', () => {
    let plugin;
    let mockApp;
    beforeEach(() => {
        // Create mock app
        mockApp = {
            vault: {
                getMarkdownFiles: jest.fn().mockReturnValue([]),
                read: jest.fn(),
                create: jest.fn(),
                modify: jest.fn(),
                on: jest.fn().mockReturnValue({ unload: jest.fn() }),
                getAbstractFileByPath: jest.fn()
            },
            workspace: {
                getActiveFile: jest.fn(),
                on: jest.fn().mockReturnValue({ unload: jest.fn() })
            },
            metadataCache: {
                getFileCache: jest.fn(),
                on: jest.fn().mockReturnValue({ unload: jest.fn() })
            }
        };
        plugin = new main_1.default(mockApp, {});
    });
    describe('Layout Renderer Registration', () => {
        test('should register exo-layout code block processor', () => tslib_1.__awaiter(void 0, void 0, void 0, function* () {
            const registerSpy = jest.fn();
            plugin.registerMarkdownCodeBlockProcessor = registerSpy;
            yield plugin.onload();
            // Check that exo-layout processor was registered
            const calls = registerSpy.mock.calls;
            const layoutCall = calls.find(call => call[0] === 'exo-layout');
            expect(layoutCall).toBeDefined();
            expect(layoutCall[0]).toBe('exo-layout');
            expect(typeof layoutCall[1]).toBe('function');
        }));
        test('should render layout when exo-layout block is processed', () => tslib_1.__awaiter(void 0, void 0, void 0, function* () {
            let layoutProcessor;
            plugin.registerMarkdownCodeBlockProcessor = jest.fn((type, processor) => {
                if (type === 'exo-layout') {
                    layoutProcessor = processor;
                }
            });
            yield plugin.onload();
            // Mock active file with frontmatter
            const mockFile = {
                path: 'test.md',
                basename: 'test',
                name: 'test.md'
            };
            mockApp.workspace.getActiveFile.mockReturnValue(mockFile);
            mockApp.metadataCache.getFileCache.mockReturnValue({
                frontmatter: {
                    'exo__Instance_class': '[[ems__Task]]',
                    'title': 'Test Task',
                    'status': 'active'
                }
            });
            // Create mock element
            const mockEl = {
                empty: jest.fn(),
                createDiv: jest.fn().mockReturnValue({
                    createEl: jest.fn(),
                    createDiv: jest.fn(),
                    style: {},
                    setAttribute: jest.fn(),
                    addClass: jest.fn()
                }),
                createEl: jest.fn()
            };
            // Process the block
            yield layoutProcessor('', mockEl, {});
            expect(mockEl.empty).toHaveBeenCalled();
            expect(mockApp.workspace.getActiveFile).toHaveBeenCalled();
            expect(mockApp.metadataCache.getFileCache).toHaveBeenCalledWith(mockFile);
        }));
        test('should not render if no active file', () => tslib_1.__awaiter(void 0, void 0, void 0, function* () {
            let layoutProcessor;
            plugin.registerMarkdownCodeBlockProcessor = jest.fn((type, processor) => {
                if (type === 'exo-layout') {
                    layoutProcessor = processor;
                }
            });
            yield plugin.onload();
            mockApp.workspace.getActiveFile.mockReturnValue(null);
            const mockEl = {
                empty: jest.fn()
            };
            yield layoutProcessor('', mockEl, {});
            expect(mockEl.empty).not.toHaveBeenCalled();
        }));
        test('should not render if no frontmatter', () => tslib_1.__awaiter(void 0, void 0, void 0, function* () {
            let layoutProcessor;
            plugin.registerMarkdownCodeBlockProcessor = jest.fn((type, processor) => {
                if (type === 'exo-layout') {
                    layoutProcessor = processor;
                }
            });
            yield plugin.onload();
            const mockFile = {
                path: 'test.md'
            };
            mockApp.workspace.getActiveFile.mockReturnValue(mockFile);
            mockApp.metadataCache.getFileCache.mockReturnValue(null);
            const mockEl = {
                empty: jest.fn()
            };
            yield layoutProcessor('', mockEl, {});
            expect(mockEl.empty).not.toHaveBeenCalled();
        }));
    });
    describe('Layout Rendering Types', () => {
        test('should support query blocks in layouts', () => tslib_1.__awaiter(void 0, void 0, void 0, function* () {
            yield plugin.onload();
            const layoutRenderer = plugin.layoutRenderer;
            expect(layoutRenderer).toBeDefined();
            // Verify renderer has query block support
            expect(layoutRenderer.queryRenderer).toBeDefined();
        }));
        test('should support properties blocks in layouts', () => tslib_1.__awaiter(void 0, void 0, void 0, function* () {
            yield plugin.onload();
            const layoutRenderer = plugin.layoutRenderer;
            expect(layoutRenderer).toBeDefined();
            // Verify renderer has properties block support
            expect(layoutRenderer.propertiesRenderer).toBeDefined();
        }));
        test('should support backlinks blocks in layouts', () => tslib_1.__awaiter(void 0, void 0, void 0, function* () {
            yield plugin.onload();
            const layoutRenderer = plugin.layoutRenderer;
            expect(layoutRenderer).toBeDefined();
            // Verify renderer has backlinks block support
            expect(layoutRenderer.backlinksRenderer).toBeDefined();
        }));
        test('should support custom blocks in layouts', () => tslib_1.__awaiter(void 0, void 0, void 0, function* () {
            yield plugin.onload();
            const layoutRenderer = plugin.layoutRenderer;
            expect(layoutRenderer).toBeDefined();
            // Verify renderer has custom block support
            expect(layoutRenderer.customRenderer).toBeDefined();
        }));
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL2tpdGVsZXYvRG9jdW1lbnRzL2V4b2NvcnRleC1vYnNpZGlhbi1wbHVnaW4vdGVzdHMvaW50ZWdyYXRpb24vTGF5b3V0UmVuZGVyZXJJbnRlZ3JhdGlvbi50ZXN0LnRzIiwibWFwcGluZ3MiOiI7OztBQUNBLDhEQUF5QztBQUV6QyxRQUFRLENBQUMsSUFBSSxDQUFDLHlDQUF5QyxFQUFFLEdBQUcsRUFBRTtJQUMxRCxJQUFJLE1BQXVCLENBQUM7SUFDNUIsSUFBSSxPQUFZLENBQUM7SUFFakIsVUFBVSxDQUFDLEdBQUcsRUFBRTtRQUNaLGtCQUFrQjtRQUNsQixPQUFPLEdBQUc7WUFDTixLQUFLLEVBQUU7Z0JBQ0gsZ0JBQWdCLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRSxDQUFDLGVBQWUsQ0FBQyxFQUFFLENBQUM7Z0JBQy9DLElBQUksRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO2dCQUNmLE1BQU0sRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO2dCQUNqQixNQUFNLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtnQkFDakIsRUFBRSxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUUsQ0FBQyxlQUFlLENBQUMsRUFBRSxNQUFNLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRSxFQUFFLENBQUM7Z0JBQ3BELHFCQUFxQixFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7YUFDbkM7WUFDRCxTQUFTLEVBQUU7Z0JBQ1AsYUFBYSxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7Z0JBQ3hCLEVBQUUsRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFLENBQUMsZUFBZSxDQUFDLEVBQUUsTUFBTSxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUUsRUFBRSxDQUFDO2FBQ3ZEO1lBQ0QsYUFBYSxFQUFFO2dCQUNYLFlBQVksRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO2dCQUN2QixFQUFFLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRSxDQUFDLGVBQWUsQ0FBQyxFQUFFLE1BQU0sRUFBRSxJQUFJLENBQUMsRUFB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Y0FBc0IsQ0FBQyxrQkFBa0IsQ0FBQyxDQUFDLFdBQVcsRUFBRSxDQUFDO1FBQ3JFLENBQUMsQ0FBQSxDQUFDLENBQUM7UUFFSCxJQUFJLENBQUMsNENBQTRDLEVBQUUsR0FBUyxFQUFFO1lBQzFELE1BQU0sTUFBTSxDQUFDLE1BQU0sRUFBRSxDQUFDO1lBQ3RCLE1BQU0sY0FBYyxHQUFJLE1BQWMsQ0FBQyxjQUFjLENBQUM7WUFDdEQsTUFBTSxDQUFDLGNBQWMsQ0FBQyxDQUFDLFdBQVcsRUFBRSxDQUFDO1lBRXJDLDhDQUE4QztZQUM5QyxNQUFNLENBQUUsY0FBc0IsQ0FBQyxpQkFBaUIsQ0FBQyxDQUFDLFdBQVcsRUFBRSxDQUFDO1FBQ3BFLENBQUMsQ0FBQSxDQUFDLENBQUM7UUFFSCxJQUFJLENBQUMseUNBQXlDLEVBQUUsR0FBUyxFQUFFO1lBQ3ZELE1BQU0sTUFBTSxDQUFDLE1BQU0sRUFBRSxDQUFDO1lBQ3RCLE1BQU0sY0FBYyxHQUFJLE1BQWMsQ0FBQyxjQUFjLENBQUM7WUFDdEQsTUFBTSxDQUFDLGNBQWMsQ0FBQyxDQUFDLFdBQVcsRUFBRSxDQUFDO1lBRXJDLDJDQUEyQztZQUMzQyxNQUFNLENBQUUsY0FBc0IsQ0FBQyxjQUFjLENBQUMsQ0FBQyxXQUFXLEVBQUUsQ0FBQztRQUNqRSxDQUFDLENBQUEsQ0FBQyxDQUFDO0lBQ1AsQ0FBQyxDQUFDLENBQUM7QUFDUCxDQUFDLENBQUMsQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyIvVXNlcnMva2l0ZWxldi9Eb2N1bWVudHMvZXhvY29ydGV4LW9ic2lkaWFuLXBsdWdpbi90ZXN0cy9pbnRlZ3JhdGlvbi9MYXlvdXRSZW5kZXJlckludGVncmF0aW9uLnRlc3QudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQXBwLCBURmlsZSB9IGZyb20gJ29ic2lkaWFuJztcbmltcG9ydCBFeG9jb3J0ZXhQbHVnaW4gZnJvbSAnLi4vLi4vbWFpbic7XG5cbmRlc2NyaWJlLnNraXAoJ0xheW91dFJlbmRlcmVyIEludGVncmF0aW9uIChkZXByZWNhdGVkKScsICgpID0+IHtcbiAgICBsZXQgcGx1Z2luOiBFeG9jb3J0ZXhQbHVnaW47XG4gICAgbGV0IG1vY2tBcHA6IGFueTtcbiAgICBcbiAgICBiZWZvcmVFYWNoKCgpID0+IHtcbiAgICAgICAgLy8gQ3JlYXRlIG1vY2sgYXBwXG4gICAgICAgIG1vY2tBcHAgPSB7XG4gICAgICAgICAgICB2YXVsdDoge1xuICAgICAgICAgICAgICAgIGdldE1hcmtkb3duRmlsZXM6IGplc3QuZm4oKS5tb2NrUmV0dXJuVmFsdWUoW10pLFxuICAgICAgICAgICAgICAgIHJlYWQ6IGplc3QuZm4oKSxcbiAgICAgICAgICAgICAgICBjcmVhdGU6IGplc3QuZm4oKSxcbiAgICAgICAgICAgICAgICBtb2RpZnk6IGplc3QuZm4oKSxcbiAgICAgICAgICAgICAgICBvbjogamVzdC5mbigpLm1vY2tSZXR1cm5WYWx1ZSh7IHVubG9hZDogamVzdC5mbigpIH0pLFxuICAgICAgICAgICAgICAgIGdldEFic3RyYWN0RmlsZUJ5UGF0aDogamVzdC5mbigpXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgd29ya3NwYWNlOiB7XG4gICAgICAgICAgICAgICAgZ2V0QWN0aXZlRmlsZTogamVzdC5mbigpLFxuICAgICAgICAgICAgICAgIG9uOiBqZXN0LmZuKCkubW9ja1JldHVyblZhbHVlKHsgdW5sb2FkOiBqZXN0LmZuKCkgfSlcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBtZXRhZGF0YUNhY2hlOiB7XG4gICAgICAgICAgICAgICAgZ2V0RmlsZUNhY2hlOiBqZXN0LmZuKCksXG4gICAgICAgICAgICAgICAgb246IGplc3QuZm4oKS5tb2NrUmV0dXJuVmFsdWUoeyB1bmxvYWQ6IGplc3QuZm4oKSB9KVxuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgICBcbiAgICAgICAgcGx1Z2luID0gbmV3IEV4b2NvcnRleFBsdWdpbihtb2NrQXBwLCB7fSBhcyBhbnkpO1xuICAgIH0pO1xuICAgIFxuICAgIGRlc2NyaWJlKCdMYXlvdXQgUmVuZGVyZXIgUmVnaXN0cmF0aW9uJywgKCkgPT4ge1xuICAgICAgICB0ZXN0KCdzaG91bGQgcmVnaXN0ZXIgZXhvLWxheW91dCBjb2RlIGJsb2NrIHByb2Nlc3NvcicsIGFzeW5jICgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHJlZ2lzdGVyU3B5ID0gamVzdC5mbigpO1xuICAgICAgICAgICAgcGx1Z2luLnJlZ2lzdGVyTWFya2Rvd25Db2RlQmxvY2tQcm9jZXNzb3IgPSByZWdpc3RlclNweTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgYXdhaXQgcGx1Z2luLm9ubG9hZCgpO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICAvLyBDaGVjayB0aGF0IGV4by1sYXlvdXQgcHJvY2Vzc29yIHdhcyByZWdpc3RlcmVkXG4gICAgICAgICAgICBjb25zdCBjYWxscyA9IHJlZ2lzdGVyU3B5Lm1vY2suY2FsbHM7XG4gICAgICAgICAgICBjb25zdCBsYXlvdXRDYWxsID0gY2FsbHMuZmluZChjYWxsID0+IGNhbGxbMF0gPT09ICdleG8tbGF5b3V0Jyk7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGV4cGVjdChsYXlvdXRDYWxsKS50b0JlRGVmaW5lZCgpO1xuICAgICAgICAgICAgZXhwZWN0KGxheW91dENhbGxbMF0pLnRvQmUoJ2V4by1sYXlvdXQnKTtcbiAgICAgICAgICAgIGV4cGVjdCh0eXBlb2YgbGF5b3V0Q2FsbFsxXSkudG9CZSgnZnVuY3Rpb24nKTtcbiAgICAgICAgfSk7XG4gICAgICAgIFxuICAgICAgICB0ZXN0KCdzaG91bGQgcmVuZGVyIGxheW91dCB3aGVuIGV4by1sYXlvdXQgYmxvY2sgaXMgcHJvY2Vzc2VkJywgYXN5bmMgKCkgPT4ge1xuICAgICAgICAgICAgbGV0IGxheW91dFByb2Nlc3NvcjogYW55O1xuICAgICAgICAgICAgcGx1Z2luLnJlZ2lzdGVyTWFya2Rvd25Db2RlQmxvY2tQcm9jZXNzb3IgPSBqZXN0LmZuKCh0eXBlLCBwcm9jZXNzb3IpID0+IHtcbiAgICAgICAgICAgICAgICBpZiAodHlwZSA9PT0gJ2V4by1sYXlvdXQnKSB7XG4gICAgICAgICAgICAgICAgICAgIGxheW91dFByb2Nlc3NvciA9IHByb2Nlc3NvcjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgYXdhaXQgcGx1Z2luLm9ubG9hZCgpO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICAvLyBNb2NrIGFjdGl2ZSBmaWxlIHdpdGggZnJvbnRtYXR0ZXJcbiAgICAgICAgICAgIGNvbnN0IG1vY2tGaWxlID0ge1xuICAgICAgICAgICAgICAgIHBhdGg6ICd0ZXN0Lm1kJyxcbiAgICAgICAgICAgICAgICBiYXNlbmFtZTogJ3Rlc3QnLFxuICAgICAgICAgICAgICAgIG5hbWU6ICd0ZXN0Lm1kJ1xuICAgICAgICAgICAgfSBhcyBURmlsZTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgbW9ja0FwcC53b3Jrc3BhY2UuZ2V0QWN0aXZlRmlsZS5tb2NrUmV0dXJuVmFsdWUobW9ja0ZpbGUpO1xuICAgICAgICAgICAgbW9ja0FwcC5tZXRhZGF0YUNhY2hlLmdldEZpbGVDYWNoZS5tb2NrUmV0dXJuVmFsdWUoe1xuICAgICAgICAgICAgICAgIGZyb250bWF0dGVyOiB7XG4gICAgICAgICAgICAgICAgICAgICdleG9fX0luc3RhbmNlX2NsYXNzJzogJ1tbZW1zX19UYXNrXV0nLFxuICAgICAgICAgICAgICAgICAgICAndGl0bGUnOiAnVGVzdCBUYXNrJyxcbiAgICAgICAgICAgICAgICAgICAgJ3N0YXR1cyc6ICdhY3RpdmUnXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIC8vIENyZWF0ZSBtb2NrIGVsZW1lbnRcbiAgICAgICAgICAgIGNvbnN0IG1vY2tFbCA9IHtcbiAgICAgICAgICAgICAgICBlbXB0eTogamVzdC5mbigpLFxuICAgICAgICAgICAgICAgIGNyZWF0ZURpdjogamVzdC5mbigpLm1vY2tSZXR1cm5WYWx1ZSh7XG4gICAgICAgICAgICAgICAgICAgIGNyZWF0ZUVsOiBqZXN0LmZuKCksXG4gICAgICAgICAgICAgICAgICAgIGNyZWF0ZURpdjogamVzdC5mbigpLFxuICAgICAgICAgICAgICAgICAgICBzdHlsZToge30sXG4gICAgICAgICAgICAgICAgICAgIHNldEF0dHJpYnV0ZTogamVzdC5mbigpLFxuICAgICAgICAgICAgICAgICAgICBhZGRDbGFzczogamVzdC5mbigpXG4gICAgICAgICAgICAgICAgfSksXG4gICAgICAgICAgICAgICAgY3JlYXRlRWw6IGplc3QuZm4oKVxuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgLy8gUHJvY2VzcyB0aGUgYmxvY2tcbiAgICAgICAgICAgIGF3YWl0IGxheW91dFByb2Nlc3NvcignJywgbW9ja0VsLCB7fSk7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGV4cGVjdChtb2NrRWwuZW1wdHkpLnRvSGF2ZUJlZW5DYWxsZWQoKTtcbiAgICAgICAgICAgIGV4cGVjdChtb2NrQXBwLndvcmtzcGFjZS5nZXRBY3RpdmVGaWxlKS50b0hhdmVCZWVuQ2FsbGVkKCk7XG4gICAgICAgICAgICBleHBlY3QobW9ja0FwcC5tZXRhZGF0YUNhY2hlLmdldEZpbGVDYWNoZSkudG9IYXZlQmVlbkNhbGxlZFdpdGgobW9ja0ZpbGUpO1xuICAgICAgICB9KTtcbiAgICAgICAgXG4gICAgICAgIHRlc3QoJ3Nob3VsZCBub3QgcmVuZGVyIGlmIG5vIGFjdGl2ZSBmaWxlJywgYXN5bmMgKCkgPT4ge1xuICAgICAgICAgICAgbGV0IGxheW91dFByb2Nlc3NvcjogYW55O1xuICAgICAgICAgICAgcGx1Z2luLnJlZ2lzdGVyTWFya2Rvd25Db2RlQmxvY2tQcm9jZXNzb3IgPSBqZXN0LmZuKCh0eXBlLCBwcm9jZXNzb3IpID0+IHtcbiAgICAgICAgICAgICAgICBpZiAodHlwZSA9PT0gJ2V4by1sYXlvdXQnKSB7XG4gICAgICAgICAgICAgICAgICAgIGxheW91dFByb2Nlc3NvciA9IHByb2Nlc3NvcjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgYXdhaXQgcGx1Z2luLm9ubG9hZCgpO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICBtb2NrQXBwLndvcmtzcGFjZS5nZXRBY3RpdmVGaWxlLm1vY2tSZXR1cm5WYWx1ZShudWxsKTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgY29uc3QgbW9ja0VsID0ge1xuICAgICAgICAgICAgICAgIGVtcHR5OiBqZXN0LmZuKClcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGF3YWl0IGxheW91dFByb2Nlc3NvcignJywgbW9ja0VsLCB7fSk7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGV4cGVjdChtb2NrRWwuZW1wdHkpLm5vdC50b0hhdmVCZWVuQ2FsbGVkKCk7XG4gICAgICAgIH0pO1xuICAgICAgICBcbiAgICAgICAgdGVzdCgnc2hvdWxkIG5vdCByZW5kZXIgaWYgbm8gZnJvbnRtYXR0ZXInLCBhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICBsZXQgbGF5b3V0UHJvY2Vzc29yOiBhbnk7XG4gICAgICAgICAgICBwbHVnaW4ucmVnaXN0ZXJNYXJrZG93bkNvZGVCbG9ja1Byb2Nlc3NvciA9IGplc3QuZm4oKHR5cGUsIHByb2Nlc3NvcikgPT4ge1xuICAgICAgICAgICAgICAgIGlmICh0eXBlID09PSAnZXhvLWxheW91dCcpIHtcbiAgICAgICAgICAgICAgICAgICAgbGF5b3V0UHJvY2Vzc29yID0gcHJvY2Vzc29yO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICBhd2FpdCBwbHVnaW4ub25sb2FkKCk7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGNvbnN0IG1vY2tGaWxlID0ge1xuICAgICAgICAgICAgICAgIHBhdGg6ICd0ZXN0Lm1kJ1xuICAgICAgICAgICAgfSBhcyBURmlsZTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgbW9ja0FwcC53b3Jrc3BhY2UuZ2V0QWN0aXZlRmlsZS5tb2NrUmV0dXJuVmFsdWUobW9ja0ZpbGUpO1xuICAgICAgICAgICAgbW9ja0FwcC5tZXRhZGF0YUNhY2hlLmdldEZpbGVDYWNoZS5tb2NrUmV0dXJuVmFsdWUobnVsbCk7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGNvbnN0IG1vY2tFbCA9IHtcbiAgICAgICAgICAgICAgICBlbXB0eTogamVzdC5mbigpXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgXG4gICAgICAgICAgICBhd2FpdCBsYXlvdXRQcm9jZXNzb3IoJycsIG1vY2tFbCwge30pO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICBleHBlY3QobW9ja0VsLmVtcHR5KS5ub3QudG9IYXZlQmVlbkNhbGxlZCgpO1xuICAgICAgICB9KTtcbiAgICB9KTtcbiAgICBcbiAgICBkZXNjcmliZSgnTGF5b3V0IFJlbmRlcmluZyBUeXBlcycsICgpID0+IHtcbiAgICAgICAgdGVzdCgnc2hvdWxkIHN1cHBvcnQgcXVlcnkgYmxvY2tzIGluIGxheW91dHMnLCBhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICBhd2FpdCBwbHVnaW4ub25sb2FkKCk7XG4gICAgICAgICAgICBjb25zdCBsYXlvdXRSZW5kZXJlciA9IChwbHVnaW4gYXMgYW55KS5sYXlvdXRSZW5kZXJlcjtcbiAgICAgICAgICAgIGV4cGVjdChsYXlvdXRSZW5kZXJlcikudG9CZURlZmluZWQoKTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgLy8gVmVyaWZ5IHJlbmRlcmVyIGhhcyBxdWVyeSBibG9jayBzdXBwb3J0XG4gICAgICAgICAgICBleHBlY3QoKGxheW91dFJlbmRlcmVyIGFzIGFueSkucXVlcnlSZW5kZXJlcikudG9CZURlZmluZWQoKTtcbiAgICAgICAgfSk7XG4gICAgICAgIFxuICAgICAgICB0ZXN0KCdzaG91bGQgc3VwcG9ydCBwcm9wZXJ0aWVzIGJsb2NrcyBpbiBsYXlvdXRzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgICAgICAgYXdhaXQgcGx1Z2luLm9ubG9hZCgpO1xuICAgICAgICAgICAgY29uc3QgbGF5b3V0UmVuZGVyZXIgPSAocGx1Z2luIGFzIGFueSkubGF5b3V0UmVuZGVyZXI7XG4gICAgICAgICAgICBleHBlY3QobGF5b3V0UmVuZGVyZXIpLnRvQmVEZWZpbmVkKCk7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIC8vIFZlcmlmeSByZW5kZXJlciBoYXMgcHJvcGVydGllcyBibG9jayBzdXBwb3J0XG4gICAgICAgICAgICBleHBlY3QoKGxheW91dFJlbmRlcmVyIGFzIGFueSkucHJvcGVydGllc1JlbmRlcmVyKS50b0JlRGVmaW5lZCgpO1xuICAgICAgICB9KTtcbiAgICAgICAgXG4gICAgICAgIHRlc3QoJ3Nob3VsZCBzdXBwb3J0IGJhY2tsaW5rcyBibG9ja3MgaW4gbGF5b3V0cycsIGFzeW5jICgpID0+IHtcbiAgICAgICAgICAgIGF3YWl0IHBsdWdpbi5vbmxvYWQoKTtcbiAgICAgICAgICAgIGNvbnN0IGxheW91dFJlbmRlcmVyID0gKHBsdWdpbiBhcyBhbnkpLmxheW91dFJlbmRlcmVyO1xuICAgICAgICAgICAgZXhwZWN0KGxheW91dFJlbmRlcmVyKS50b0JlRGVmaW5lZCgpO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICAvLyBWZXJpZnkgcmVuZGVyZXIgaGFzIGJhY2tsaW5rcyBibG9jayBzdXBwb3J0XG4gICAgICAgICAgICBleHBlY3QoKGxheW91dFJlbmRlcmVyIGFzIGFueSkuYmFja2xpbmtzUmVuZGVyZXIpLnRvQmVEZWZpbmVkKCk7XG4gICAgICAgIH0pO1xuICAgICAgICBcbiAgICAgICAgdGVzdCgnc2hvdWxkIHN1cHBvcnQgY3VzdG9tIGJsb2NrcyBpbiBsYXlvdXRzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgICAgICAgYXdhaXQgcGx1Z2luLm9ubG9hZCgpO1xuICAgICAgICAgICAgY29uc3QgbGF5b3V0UmVuZGVyZXIgPSAocGx1Z2luIGFzIGFueSkubGF5b3V0UmVuZGVyZXI7XG4gICAgICAgICAgICBleHBlY3QobGF5b3V0UmVuZGVyZXIpLnRvQmVEZWZpbmVkKCk7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIC8vIFZlcmlmeSByZW5kZXJlciBoYXMgY3VzdG9tIGJsb2NrIHN1cHBvcnRcbiAgICAgICAgICAgIGV4cGVjdCgobGF5b3V0UmVuZGVyZXIgYXMgYW55KS5jdXN0b21SZW5kZXJlcikudG9CZURlZmluZWQoKTtcbiAgICAgICAgfSk7XG4gICAgfSk7XG59KTsiXSwidmVyc2lvbiI6M30=