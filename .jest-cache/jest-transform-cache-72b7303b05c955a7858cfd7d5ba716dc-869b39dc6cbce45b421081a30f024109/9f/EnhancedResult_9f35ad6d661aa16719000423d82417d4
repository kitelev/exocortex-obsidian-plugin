3a20bbcb6d1a6caa93125dd29d9d2202
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.EnhancedResult = void 0;
const Result_1 = require("./Result");
const ExocortexError_1 = require("../errors/ExocortexError");
class EnhancedResult {
    constructor(result, errorDetails) {
        this._result = result;
        this._errorDetails = errorDetails;
    }
    get isSuccess() {
        return this._result.isSuccess;
    }
    get isFailure() {
        return this._result.isFailure;
    }
    get error() {
        return this._result.error;
    }
    getValue() {
        return this._result.getValue();
    }
    errorValue() {
        return this._result.errorValue();
    }
    getErrorDetails() {
        return this._errorDetails;
    }
    static okEnhanced(value) {
        const result = Result_1.Result.ok(value);
        return new EnhancedResult(result);
    }
    static failEnhanced(error) {
        let errorMessage;
        let errorDetails;
        if (typeof error === "string") {
            errorMessage = error;
            errorDetails = ExocortexError_1.ErrorBuilder.create()
                .withTitle("Operation Failed")
                .withMessage(error)
                .withSeverity(ExocortexError_1.ErrorSeverity.ERROR)
                .withCategory(ExocortexError_1.ErrorCategory.SYSTEM)
                .withContext({
                operation: "Unknown",
                timestamp: new Date(),
            })
                .build();
        }
        else {
            errorMessage = error.message;
            errorDetails = error;
        }
        const result = Result_1.Result.fail(errorMessage);
        return new EnhancedResult(result, errorDetails);
    }
    mapError(fn) {
        if (this.isSuccess) {
            return this;
        }
        const currentError = this._errorDetails ||
            ExocortexError_1.ErrorBuilder.create()
                .withMessage(this.error)
                .withSeverity(ExocortexError_1.ErrorSeverity.ERROR)
                .withCategory(ExocortexError_1.ErrorCategory.SYSTEM)
                .withContext({
                operation: "Unknown",
                timestamp: new Date(),
            })
                .build();
        const mappedError = fn(currentError);
        return EnhancedResult.failEnhanced(mappedError);
    }
    chain(fn) {
        if (this.isFailure) {
            return EnhancedResult.failEnhanced(this._errorDetails || this.error);
        }
        return fn(this.getValue());
    }
    static combineEnhanced(results) {
        const errors = [];
        for (const result of results) {
            if (result.isFailure) {
                const errorDetails = result.getErrorDetails();
                if (errorDetails) {
                    errors.push(errorDetails);
                }
            }
        }
        if (errors.length > 0) {
            const combinedError = ExocortexError_1.ErrorBuilder.create()
                .withTitle("Multiple Errors Occurred")
                .withMessage(`${errors.length} error(s) occurred during operation`)
                .withSeverity(ExocortexError_1.ErrorSeverity.ERROR)
                .withCategory(ExocortexError_1.ErrorCategory.SYSTEM)
                .withContext({
                operation: "Combined Operation",
                timestamp: new Date(),
                metadata: {
                    errorCount: errors.length,
                    errors: errors.map((e) => ({ id: e.id, title: e.title })),
                },
            })
                .withInnerError(errors[0])
                .build();
            return EnhancedResult.failEnhanced(combinedError);
        }
        return EnhancedResult.okEnhanced();
    }
    withContext(context) {
        if (this.isSuccess) {
            return this;
        }
        const currentError = this._errorDetails;
        if (!currentError) {
            return this;
        }
        const updatedError = {
            ...currentError,
            context: {
                ...currentError.context,
                ...context,
            },
        };
        return EnhancedResult.failEnhanced(updatedError);
    }
}
exports.EnhancedResult = EnhancedResult;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL2tpdGVsZXYvRG9jdW1lbnRzL2V4b2NvcnRleC1vYnNpZGlhbi1wbHVnaW4vc3JjL2RvbWFpbi9jb3JlL0VuaGFuY2VkUmVzdWx0LnRzIiwibWFwcGluZ3MiOiI7OztBQUFBLHFDQUFrQztBQUNsQyw2REFLa0M7QUFFbEMsTUFBYSxjQUFjO0lBSXpCLFlBQW9CLE1BQWlCLEVBQUUsWUFBNkI7UUFDbEUsSUFBSSxDQUFDLE9BQU8sR0FBRyxNQUFNLENBQUM7UUFDdEIsSUFBSSxDQUFDLGFBQWEsR0FBRyxZQUFZLENBQUM7SUFDcEMsQ0FBQztJQUVELElBQUksU0FBUztRQUNYLE9BQU8sSUFBSSxDQUFDLE9BQU8sQ0FBQyxTQUFTLENBQUM7SUFDaEMsQ0FBQztJQUVELElBQUksU0FBUztRQUNYLE9BQU8sSUFBSSxDQUFDLE9BQU8sQ0FBQyxTQUFTLENBQUM7SUFDaEMsQ0FBQztJQUVELElBQUksS0FBSztRQUNQLE9BQU8sSUFBSSxDQUFDLE9BQU8sQ0FBQyxLQUFLLENBQUM7SUFDNUIsQ0FBQztJQUVNLFFBQVE7UUFDYixPQUFPLElBQUksQ0FBQyxPQUFPLENBQUMsUUFBUSxFQUFFLENBQUM7SUFDakMsQ0FBQztJQUVNLFVBQVU7UUFDZixPQUFPLElBQUksQ0FBQyxPQUFPLENBQUMsVUFBVSxFQUFFLENBQUM7SUFDbkMsQ0FBQztJQUVNLGVBQWU7UUFDcEIsT0FBTyxJQUFJLENBQUMsYUFBYSxDQUFDO0lBQzVCLENBQUM7SUFFTSxNQUFNLENBQUMsVUFBVSxDQUFJLEtBQVM7UUFDbkMsTUFBTSxNQUFNLEdBQUcsZUFBTSxDQUFDLEVBQUUsQ0FBSSxLQUFLLENBQUMsQ0FBQztRQUNuQyxPQUFPLElBQUksY0FBYyxDQUFDLE1BQU0sQ0FBQyxDQUFDO0lBQ3BDLENBQUM7SUFFTSxNQUFNLENBQUMsWUFBWSxDQUN4QixLQUE4QjtRQUU5QixJQUFJLFlBQW9CLENBQUM7UUFDekIsSUFBSSxZQUF3QyxDQUFDO1FBRTdDLElBQUksT0FBTyxLQUFLLEtBQUssUUFBUSxFQUFFO1lBQzdC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LEVBQUUsRUFBRSxDQUFDLENBQUMsRUFBRSxFQUFFLEVBQUUsQ0FBQyxDQUFDLEVBQUUsRUFBRSxLQUFLLEVBQUUsQ0FBQyxDQUFDLEtBQUssRUFBRSxDQUFDLENBQUM7aUJBQzFEO2FBQ0YsQ0FBQztpQkFDRCxjQUFjLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUFDO2lCQUN6QixLQUFLLEVBQUUsQ0FBQztZQUVYLE9BQU8sY0FBYyxDQUFDLFlBQVksQ0FBQyxhQUFhLENBQUMsQ0FBQztTQUNuRDtRQUVELE9BQU8sY0FBYyxDQUFDLFVBQVUsRUFBRSxDQUFDO0lBQ3JDLENBQUM7SUFFTSxXQUFXLENBQ2hCLE9BQTJDO1FBRTNDLElBQUksSUFBSSxDQUFDLFNBQVMsRUFBRTtZQUNsQixPQUFPLElBQUksQ0FBQztTQUNiO1FBRUQsTUFBTSxZQUFZLEdBQUcsSUFBSSxDQUFDLGFBQWEsQ0FBQztRQUN4QyxJQUFJLENBQUMsWUFBWSxFQUFFO1lBQ2pCLE9BQU8sSUFBSSxDQUFDO1NBQ2I7UUFFRCxNQUFNLFlBQVksR0FBRztZQUNuQixHQUFHLFlBQVk7WUFDZixPQUFPLEVBQUU7Z0JBQ1AsR0FBRyxZQUFZLENBQUMsT0FBTztnQkFDdkIsR0FBRyxPQUFPO2FBQ1g7U0FDRixDQUFDO1FBRUYsT0FBTyxjQUFjLENBQUMsWUFBWSxDQUFJLFlBQVksQ0FBQyxDQUFDO0lBQ3RELENBQUM7Q0FDRjtBQTFKRCx3Q0EwSkMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL1VzZXJzL2tpdGVsZXYvRG9jdW1lbnRzL2V4b2NvcnRleC1vYnNpZGlhbi1wbHVnaW4vc3JjL2RvbWFpbi9jb3JlL0VuaGFuY2VkUmVzdWx0LnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFJlc3VsdCB9IGZyb20gXCIuL1Jlc3VsdFwiO1xuaW1wb3J0IHtcbiAgRXhvY29ydGV4RXJyb3IsXG4gIEVycm9yQnVpbGRlcixcbiAgRXJyb3JTZXZlcml0eSxcbiAgRXJyb3JDYXRlZ29yeSxcbn0gZnJvbSBcIi4uL2Vycm9ycy9FeG9jb3J0ZXhFcnJvclwiO1xuXG5leHBvcnQgY2xhc3MgRW5oYW5jZWRSZXN1bHQ8VD4ge1xuICBwcml2YXRlIF9yZXN1bHQ6IFJlc3VsdDxUPjtcbiAgcHJpdmF0ZSBfZXJyb3JEZXRhaWxzPzogRXhvY29ydGV4RXJyb3I7XG5cbiAgcHJpdmF0ZSBjb25zdHJ1Y3RvcihyZXN1bHQ6IFJlc3VsdDxUPiwgZXJyb3JEZXRhaWxzPzogRXhvY29ydGV4RXJyb3IpIHtcbiAgICB0aGlzLl9yZXN1bHQgPSByZXN1bHQ7XG4gICAgdGhpcy5fZXJyb3JEZXRhaWxzID0gZXJyb3JEZXRhaWxzO1xuICB9XG5cbiAgZ2V0IGlzU3VjY2VzcygpOiBib29sZWFuIHtcbiAgICByZXR1cm4gdGhpcy5fcmVzdWx0LmlzU3VjY2VzcztcbiAgfVxuXG4gIGdldCBpc0ZhaWx1cmUoKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIHRoaXMuX3Jlc3VsdC5pc0ZhaWx1cmU7XG4gIH1cblxuICBnZXQgZXJyb3IoKTogc3RyaW5nIHtcbiAgICByZXR1cm4gdGhpcy5fcmVzdWx0LmVycm9yO1xuICB9XG5cbiAgcHVibGljIGdldFZhbHVlKCk6IFQge1xuICAgIHJldHVybiB0aGlzLl9yZXN1bHQuZ2V0VmFsdWUoKTtcbiAgfVxuXG4gIHB1YmxpYyBlcnJvclZhbHVlKCk6IHN0cmluZyB7XG4gICAgcmV0dXJuIHRoaXMuX3Jlc3VsdC5lcnJvclZhbHVlKCk7XG4gIH1cblxuICBwdWJsaWMgZ2V0RXJyb3JEZXRhaWxzKCk6IEV4b2NvcnRleEVycm9yIHwgdW5kZWZpbmVkIHtcbiAgICByZXR1cm4gdGhpcy5fZXJyb3JEZXRhaWxzO1xuICB9XG5cbiAgcHVibGljIHN0YXRpYyBva0VuaGFuY2VkPFU+KHZhbHVlPzogVSk6IEVuaGFuY2VkUmVzdWx0PFU+IHtcbiAgICBjb25zdCByZXN1bHQgPSBSZXN1bHQub2s8VT4odmFsdWUpO1xuICAgIHJldHVybiBuZXcgRW5oYW5jZWRSZXN1bHQocmVzdWx0KTtcbiAgfVxuXG4gIHB1YmxpYyBzdGF0aWMgZmFpbEVuaGFuY2VkPFU+KFxuICAgIGVycm9yOiBzdHJpbmcgfCBFeG9jb3J0ZXhFcnJvcixcbiAgKTogRW5oYW5jZWRSZXN1bHQ8VT4ge1xuICAgIGxldCBlcnJvck1lc3NhZ2U6IHN0cmluZztcbiAgICBsZXQgZXJyb3JEZXRhaWxzOiBFeG9jb3J0ZXhFcnJvciB8IHVuZGVmaW5lZDtcblxuICAgIGlmICh0eXBlb2YgZXJyb3IgPT09IFwic3RyaW5nXCIpIHtcbiAgICAgIGVycm9yTWVzc2FnZSA9IGVycm9yO1xuICAgICAgZXJyb3JEZXRhaWxzID0gRXJyb3JCdWlsZGVyLmNyZWF0ZSgpXG4gICAgICAgIC53aXRoVGl0bGUoXCJPcGVyYXRpb24gRmFpbGVkXCIpXG4gICAgICAgIC53aXRoTWVzc2FnZShlcnJvcilcbiAgICAgICAgLndpdGhTZXZlcml0eShFcnJvclNldmVyaXR5LkVSUk9SKVxuICAgICAgICAud2l0aENhdGVnb3J5KEVycm9yQ2F0ZWdvcnkuU1lTVEVNKVxuICAgICAgICAud2l0aENvbnRleHQoe1xuICAgICAgICAgIG9wZXJhdGlvbjogXCJVbmtub3duXCIsXG4gICAgICAgICAgdGltZXN0YW1wOiBuZXcgRGF0ZSgpLFxuICAgICAgICB9KVxuICAgICAgICAuYnVpbGQoKTtcbiAgICB9IGVsc2Uge1xuICAgICAgZXJyb3JNZXNzYWdlID0gZXJyb3IubWVzc2FnZTtcbiAgICAgIGVycm9yRGV0YWlscyA9IGVycm9yO1xuICAgIH1cblxuICAgIGNvbnN0IHJlc3VsdCA9IFJlc3VsdC5mYWlsPFU+KGVycm9yTWVzc2FnZSk7XG4gICAgcmV0dXJuIG5ldyBFbmhhbmNlZFJlc3VsdChyZXN1bHQsIGVycm9yRGV0YWlscyk7XG4gIH1cblxuICBwdWJsaWMgbWFwRXJyb3IoXG4gICAgZm46IChlcnJvcjogRXhvY29ydGV4RXJyb3IpID0+IEV4b2NvcnRleEVycm9yLFxuICApOiBFbmhhbmNlZFJlc3VsdDxUPiB7XG4gICAgaWYgKHRoaXMuaXNTdWNjZXNzKSB7XG4gICAgICByZXR1cm4gdGhpcztcbiAgICB9XG5cbiAgICBjb25zdCBjdXJyZW50RXJyb3IgPVxuICAgICAgdGhpcy5fZXJyb3JEZXRhaWxzIHx8XG4gICAgICBFcnJvckJ1aWxkZXIuY3JlYXRlKClcbiAgICAgICAgLndpdGhNZXNzYWdlKHRoaXMuZXJyb3IpXG4gICAgICAgIC53aXRoU2V2ZXJpdHkoRXJyb3JTZXZlcml0eS5FUlJPUilcbiAgICAgICAgLndpdGhDYXRlZ29yeShFcnJvckNhdGVnb3J5LlNZU1RFTSlcbiAgICAgICAgLndpdGhDb250ZXh0KHtcbiAgICAgICAgICBvcGVyYXRpb246IFwiVW5rbm93blwiLFxuICAgICAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKSxcbiAgICAgICAgfSlcbiAgICAgICAgLmJ1aWxkKCk7XG5cbiAgICBjb25zdCBtYXBwZWRFcnJvciA9IGZuKGN1cnJlbnRFcnJvcik7XG4gICAgcmV0dXJuIEVuaGFuY2VkUmVzdWx0LmZhaWxFbmhhbmNlZDxUPihtYXBwZWRFcnJvcik7XG4gIH1cblxuICBwdWJsaWMgY2hhaW48VT4oZm46ICh2YWx1ZTogVCkgPT4gRW5oYW5jZWRSZXN1bHQ8VT4pOiBFbmhhbmNlZFJlc3VsdDxVPiB7XG4gICAgaWYgKHRoaXMuaXNGYWlsdXJlKSB7XG4gICAgICByZXR1cm4gRW5oYW5jZWRSZXN1bHQuZmFpbEVuaGFuY2VkPFU+KHRoaXMuX2Vycm9yRGV0YWlscyB8fCB0aGlzLmVycm9yKTtcbiAgICB9XG4gICAgcmV0dXJuIGZuKHRoaXMuZ2V0VmFsdWUoKSk7XG4gIH1cblxuICBwdWJsaWMgc3RhdGljIGNvbWJpbmVFbmhhbmNlZChcbiAgICByZXN1bHRzOiBFbmhhbmNlZFJlc3VsdDxhbnk+W10sXG4gICk6IEVuaGFuY2VkUmVzdWx0PGFueT4ge1xuICAgIGNvbnN0IGVycm9yczogRXhvY29ydGV4RXJyb3JbXSA9IFtdO1xuXG4gICAgZm9yIChjb25zdCByZXN1bHQgb2YgcmVzdWx0cykge1xuICAgICAgaWYgKHJlc3VsdC5pc0ZhaWx1cmUpIHtcbiAgICAgICAgY29uc3QgZXJyb3JEZXRhaWxzID0gcmVzdWx0LmdldEVycm9yRGV0YWlscygpO1xuICAgICAgICBpZiAoZXJyb3JEZXRhaWxzKSB7XG4gICAgICAgICAgZXJyb3JzLnB1c2goZXJyb3JEZXRhaWxzKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIGlmIChlcnJvcnMubGVuZ3RoID4gMCkge1xuICAgICAgY29uc3QgY29tYmluZWRFcnJvciA9IEVycm9yQnVpbGRlci5jcmVhdGUoKVxuICAgICAgICAud2l0aFRpdGxlKFwiTXVsdGlwbGUgRXJyb3JzIE9jY3VycmVkXCIpXG4gICAgICAgIC53aXRoTWVzc2FnZShgJHtlcnJvcnMubGVuZ3RofSBlcnJvcihzKSBvY2N1cnJlZCBkdXJpbmcgb3BlcmF0aW9uYClcbiAgICAgICAgLndpdGhTZXZlcml0eShFcnJvclNldmVyaXR5LkVSUk9SKVxuICAgICAgICAud2l0aENhdGVnb3J5KEVycm9yQ2F0ZWdvcnkuU1lTVEVNKVxuICAgICAgICAud2l0aENvbnRleHQoe1xuICAgICAgICAgIG9wZXJhdGlvbjogXCJDb21iaW5lZCBPcGVyYXRpb25cIixcbiAgICAgICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCksXG4gICAgICAgICAgbWV0YWRhdGE6IHtcbiAgICAgICAgICAgIGVycm9yQ291bnQ6IGVycm9ycy5sZW5ndGgsXG4gICAgICAgICAgICBlcnJvcnM6IGVycm9ycy5tYXAoKGUpID0+ICh7IGlkOiBlLmlkLCB0aXRsZTogZS50aXRsZSB9KSksXG4gICAgICAgICAgfSxcbiAgICAgICAgfSlcbiAgICAgICAgLndpdGhJbm5lckVycm9yKGVycm9yc1swXSlcbiAgICAgICAgLmJ1aWxkKCk7XG5cbiAgICAgIHJldHVybiBFbmhhbmNlZFJlc3VsdC5mYWlsRW5oYW5jZWQoY29tYmluZWRFcnJvcik7XG4gICAgfVxuXG4gICAgcmV0dXJuIEVuaGFuY2VkUmVzdWx0Lm9rRW5oYW5jZWQoKTtcbiAgfVxuXG4gIHB1YmxpYyB3aXRoQ29udGV4dChcbiAgICBjb250ZXh0OiBQYXJ0aWFsPEV4b2NvcnRleEVycm9yW1wiY29udGV4dFwiXT4sXG4gICk6IEVuaGFuY2VkUmVzdWx0PFQ+IHtcbiAgICBpZiAodGhpcy5pc1N1Y2Nlc3MpIHtcbiAgICAgIHJldHVybiB0aGlzO1xuICAgIH1cblxuICAgIGNvbnN0IGN1cnJlbnRFcnJvciA9IHRoaXMuX2Vycm9yRGV0YWlscztcbiAgICBpZiAoIWN1cnJlbnRFcnJvcikge1xuICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfVxuXG4gICAgY29uc3QgdXBkYXRlZEVycm9yID0ge1xuICAgICAgLi4uY3VycmVudEVycm9yLFxuICAgICAgY29udGV4dDoge1xuICAgICAgICAuLi5jdXJyZW50RXJyb3IuY29udGV4dCxcbiAgICAgICAgLi4uY29udGV4dCxcbiAgICAgIH0sXG4gICAgfTtcblxuICAgIHJldHVybiBFbmhhbmNlZFJlc3VsdC5mYWlsRW5oYW5jZWQ8VD4odXBkYXRlZEVycm9yKTtcbiAgfVxufVxuIl0sInZlcnNpb24iOjN9