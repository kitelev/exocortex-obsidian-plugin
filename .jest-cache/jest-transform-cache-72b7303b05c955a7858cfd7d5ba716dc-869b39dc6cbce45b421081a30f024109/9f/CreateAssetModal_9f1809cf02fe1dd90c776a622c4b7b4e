4b39246ebeb15afbce551be1397c1268
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.CreateAssetModal = void 0;
const tslib_1 = require("tslib");
const obsidian_1 = require("obsidian");
const DIContainer_1 = require("../../infrastructure/container/DIContainer");
/**
 * Modal for creating new ExoAssets
 * Presentation layer component that delegates to use cases
 */
class CreateAssetModal extends obsidian_1.Modal {
    constructor(app) {
        super(app);
        this.assetTitle = '';
        this.assetClass = 'exo__Asset';
        this.assetOntology = '';
        this.propertyValues = new Map();
        this.propertiesContainer = null;
        this.properties = []; // Store current properties for testing
        this.container = DIContainer_1.DIContainer.getInstance();
        this.createAssetUseCase = this.container.getCreateAssetUseCase();
        this.ontologyRepository = this.container.resolve('IOntologyRepository');
        this.classViewRepository = this.container.resolve('IClassViewRepository');
    }
    onOpen() {
        return tslib_1.__awaiter(this, void 0, void 0, function* () {
            const { contentEl } = this;
            contentEl.createEl("h2", { text: "Create ExoAsset" });
            yield this.setupTitleField(contentEl);
            yield this.setupClassField(contentEl);
            yield this.setupOntologyField(contentEl);
            yield this.setupPropertiesSection(contentEl);
            this.setupActionButtons(contentEl);
        });
    }
    setupTitleField(containerEl) {
        return tslib_1.__awaiter(this, void 0, void 0, function* () {
            new obsidian_1.Setting(containerEl)
                .setName("Title")
                .setDesc("Asset title")
                .addText(text => text
                .setPlaceholder("Enter asset title")
                .setValue(this.assetTitle)
                .onChange(value => this.assetTitle = value));
        });
    }
    setupClassField(containerEl) {
        return tslib_1.__awaiter(this, void 0, void 0, function* () {
            // Get all class files from the vault
            const files = this.app.vault.getMarkdownFiles();
            const classes = [];
            // Find all class definitions (files with exo__Class frontmatter)
            for (const file of files) {
                const cache = this.app.metadataCache.getFileCache(file);
                if (cache === null || cache === void 0 ? void 0 : cache.frontmatter) {
                    const instanceClass = cache.frontmatter['exo__Instance_class'];
                    if (instanceClass === '[[exo__Class]]' || instanceClass === 'exo__Class') {
                        const className = file.basename;
                        const displayName = cache.frontmatter['rdfs__label'] || className;
                        classes.push({ className, displayName });
                    }
                }
            }
            // Add default classes if none found
            if (classes.length === 0) {
                classes.push({ className: 'exo__Asset', displayName: 'Asset' }, { className: 'exo__Class', displayName: 'Class' }, { className: 'exo__Property', displayName: 'Property' });
            }
            new obsidian_1.Setting(containerEl)
                .setName("Class")
                .setDesc("Select the type of asset")
                .addDropdown(dropdown => {
                for (const classInfo of classes) {
                    dropdown.addOption(classInfo.className, classInfo.displayName);
                }
                dropdown.setValue(this.assetClass);
                dropdown.onChange((value) => tslib_1.__awaiter(this, void 0, void 0, function* () {
                    this.assetClass = value;
                    yield this.updatePropertiesForClass(value);
                }));
            });
        });
    }
    setupOntologyField(containerEl) {
        return tslib_1.__awaiter(this, void 0, void 0, function* () {
            // Get all ontology files from the vault
            const files = this.app.vault.getMarkdownFiles();
            const ontologies = [];
            // Find all ontology definitions (files starting with ! or having exo__Ontology_prefix)
            for (const file of files) {
                if (file.name.startsWith('!')) {
                    const cache = this.app.metadataCache.getFileCache(file);
                    if (cache === null || cache === void 0 ? void 0 : cache.frontmatter) {
                        const prefix = cache.frontmatter['exo__Ontology_prefix'] || file.basename.substring(1);
                        const displayName = cache.frontmatter['rdfs__label'] || prefix;
                        ontologies.push({ prefix, displayName });
                    }
                }
            }
            // Add default ontologies if none found
            if (ontologies.length === 0) {
                ontologies.push({ prefix: 'exo', displayName: 'Exocortex Core' }, { prefix: 'ui', displayName: 'User Interface' }, { prefix: 'rdfs', displayName: 'RDF Schema' });
            }
            const defaultOntology = 'exo';
            // Set default ontology when no ontologies found in vault
            if (ontologies.length > 0 && !this.assetOntology) {
                this.assetOntology = defaultOntology;
            }
            new obsidian_1.Setting(containerEl)
                .setName("Ontology")
                .setDesc("Select which knowledge graph this asset belongs to")
                .addDropdown(dropdown => {
                for (const ontology of ontologies) {
                    dropdown.addOption(ontology.prefix, ontology.displayName);
                }
                // Set default ontology
                if (defaultOntology && ontologies.some((o) => o.prefix === defaultOntology)) {
                    this.assetOntology = defaultOntology;
                    dropdown.setValue(defaultOntology);
                }
                else if (ontologies.length > 0) {
                    this.assetOntology = ontologies[0].prefix;
                    dropdown.setValue(ontologies[0].prefix);
                }
                dropdown.onChange(value => {
                    this.assetOntology = value;
                });
            });
        });
    }
    setupPropertiesSection(containerEl) {
        return tslib_1.__awaiter(this, void 0, void 0, function* () {
            containerEl.createEl("h3", {
                text: "Properties",
                cls: "exocortex-properties-header"
            });
            this.propertiesContainer = containerEl.createDiv({
                cls: "exocortex-properties-container"
            });
            yield this.updatePropertiesForClass(this.assetClass);
        });
    }
    updatePropertiesForClass(className) {
        return tslib_1.__awaiter(this, void 0, void 0, function* () {
            if (!this.propertiesContainer)
                return;
            console.log(`Updating properties for class: ${className}`);
            // Clear the container - try Obsidian method first, fallback to DOM
            if ('empty' in this.propertiesContainer && typeof this.propertiesContainer.empty === 'function') {
                this.propertiesContainer.empty();
            }
            else {
                // Fallback to standard DOM method - use innerHTML for complete cleanup
                this.propertiesContainer.innerHTML = '';
            }
            this.propertyValues.clear();
            // Get properties for this class
            this.properties = [];
            const files = this.app.vault.getMarkdownFiles();
            console.log(`Scanning ${files.length} files for properties...`);
            // Find all property definitions related to this class
            for (const file of files) {
                const cache = this.app.metadataCache.getFileCache(file);
                if (cache === null || cache === void 0 ? void 0 : cache.frontmatter) {
                    const instanceClass = cache.frontmatter['exo__Instance_class'];
                    if (instanceClass === '[[exo__Property]]' || instanceClass === 'exo__Property') {
                        const domain = cache.frontmatter['rdfs__domain'];
                        // Check if this property belongs to the current class
                        if (domain === `[[${className}]]` || domain === className ||
                            (Array.isArray(domain) && (domain.includes(className) || domain.includes(`[[${className}]]`)))) {
                            const propertyName = file.basename;
                            const label = cache.frontmatter['rdfs__label'] || propertyName;
                            const description = cache.frontmatter['rdfs__comment'] || '';
                            const range = cache.frontmatter['rdfs__range'] || 'string';
                            const isRequired = cache.frontmatter['exo__Property_isRequired'] || false;
                            const options = cache.frontmatter['exo__Property_options'] || null;
                            console.log(`Found property ${propertyName} for class ${className}`);
                            // Determine property type based on range and options
                            let type = this.mapRangeToType(range);
                            if (options && Array.isArray(options)) {
                                type = 'enum';
                            }
                            else if (range === 'select' && options) {
                                type = 'enum';
                            }
                            this.properties.push({
                                name: propertyName,
                                label: label,
                                description: description,
                                type: type,
                                isRequired: isRequired,
                                range: range,
                                options: options
                            });
                        }
                    }
                }
            }
            console.log(`Found ${this.properties.length} properties for class ${className}`);
            // Add some default properties for common classes
            if (this.properties.length === 0 && className === 'exo__Asset') {
                this.properties.push({
                    name: 'description',
                    label: 'Description',
                    description: 'A brief description of the asset',
                    type: 'text',
                    isRequired: false
                }, {
                    name: 'tags',
                    label: 'Tags',
                    description: 'Tags for categorization',
                    type: 'array',
                    isRequired: false
                });
            }
            if (this.properties.length === 0) {
                this.propertiesContainer.createEl("p", {
                    text: "No specific properties for this class",
                    cls: "exocortex-no-properties"
                });
                return;
            }
            // Create fields for all properties (including defaults)
            for (const prop of this.properties) {
                this.createPropertyField(prop);
            }
        });
    }
    mapRangeToType(range) {
        // Map RDF/OWL ranges to input types
        if (range === 'select')
            return 'enum';
        if (range.includes('boolean'))
            return 'boolean';
        if (range.includes('date') || range.includes('Date'))
            return 'date';
        if (range.includes('integer') || range.includes('decimal') || range.includes('float'))
            return 'number';
        if (range.includes('string') && range.includes('[]'))
            return 'array';
        if (range.includes('text') || range.includes('Text'))
            return 'text';
        return 'string'; // default
    }
    createPropertyField(property) {
        if (!this.propertiesContainer)
            return;
        const setting = new obsidian_1.Setting(this.propertiesContainer)
            .setName(property.label + (property.isRequired ? ' *' : ''))
            .setDesc(property.description);
        // Create appropriate input based on property type
        switch (property.type) {
            case 'enum':
                this.createEnumField(setting, property);
                break;
            case 'boolean':
                this.createBooleanField(setting, property);
                break;
            case 'date':
                this.createDateField(setting, property);
                break;
            case 'number':
                this.createNumberField(setting, property);
                break;
            case 'text':
                this.createTextAreaField(setting, property);
                break;
            case 'array':
                this.createArrayField(setting, property);
                break;
            default:
                this.createTextField(setting, property);
        }
    }
    createEnumField(setting, property) {
        setting.addDropdown(dropdown => {
            dropdown.addOption('', '-- Select --');
            for (const option of property.options) {
                dropdown.addOption(option, option);
            }
            dropdown.onChange(value => {
                if (value) {
                    this.propertyValues.set(property.name, value);
                }
                else {
                    this.propertyValues.delete(property.name);
                }
            });
        });
    }
    createBooleanField(setting, property) {
        setting.addToggle(toggle => {
            toggle.onChange(value => {
                this.propertyValues.set(property.name, value);
            });
        });
    }
    createDateField(setting, property) {
        setting.addText(text => {
            text.setPlaceholder('YYYY-MM-DD')
                .onChange(value => {
                if (value) {
                    this.propertyValues.set(property.name, value);
                }
                else {
                    this.propertyValues.delete(property.name);
                }
            });
            // Set the input type to date
            text.inputEl.type = 'date';
        });
    }
    createNumberField(setting, property) {
        setting.addText(text => {
            text.setPlaceholder('Enter number')
                .onChange(value => {
                if (value) {
                    const num = parseFloat(value);
                    if (!isNaN(num)) {
                        this.propertyValues.set(property.name, num);
                    }
                }
                else {
                    this.propertyValues.delete(property.name);
                }
            });
        });
    }
    createTextAreaField(setting, property) {
        setting.addTextArea(text => {
            text.setPlaceholder('Enter ' + property.label.toLowerCase())
                .onChange(value => {
                if (value) {
                    this.propertyValues.set(property.name, value);
                }
                else {
                    this.propertyValues.delete(property.name);
                }
            });
        });
    }
    createArrayField(setting, property) {
        setting.addText(text => {
            text.setPlaceholder('Comma-separated values or [[links]]')
                .onChange(value => {
                if (value) {
                    if (value.includes('[[')) {
                        const links = value.match(/\[\[([^\]]+)\]\]/g) || [];
                        this.propertyValues.set(property.name, links);
                    }
                    else {
                        const items = value.split(',').map(s => s.trim()).filter(s => s);
                        this.propertyValues.set(property.name, items);
                    }
                }
                else {
                    this.propertyValues.delete(property.name);
                }
            });
        });
    }
    createTextField(setting, property) {
        setting.addText(text => {
            text.setPlaceholder('Enter ' + property.label.toLowerCase())
                .onChange(value => {
                if (value) {
                    this.propertyValues.set(property.name, value);
                }
                else {
                    this.propertyValues.delete(property.name);
                }
            });
        });
    }
    setupActionButtons(containerEl) {
        new obsidian_1.Setting(containerEl)
            .addButton(btn => btn
            .setButtonText("Create")
            .setCta()
            .onClick(() => tslib_1.__awaiter(this, void 0, void 0, function* () {
            yield this.createAsset();
        })));
    }
    createAsset() {
        return tslib_1.__awaiter(this, void 0, void 0, function* () {
            try {
                // Convert property values to plain object
                const properties = {};
                for (const [key, value] of this.propertyValues) {
                    properties[key] = value;
                }
                // Execute use case
                const response = yield this.createAssetUseCase.execute({
                    title: this.assetTitle,
                    className: this.assetClass,
                    ontologyPrefix: this.assetOntology,
                    properties
                });
                if (response.success) {
                    new obsidian_1.Notice(response.message);
                    this.close();
                }
                else {
                    new obsidian_1.Notice(`Failed to create asset`);
                }
            }
            catch (error) {
                new obsidian_1.Notice(`Error: ${error.message}`);
            }
        });
    }
    onClose() {
        const { contentEl } = this;
        // Clear content - try Obsidian method first, fallback to DOM
        if ('empty' in contentEl && typeof contentEl.empty === 'function') {
            contentEl.empty();
        }
        else {
            // Fallback to standard DOM method - use innerHTML for complete cleanup
            contentEl.innerHTML = '';
        }
    }
}
exports.CreateAssetModal = CreateAssetModal;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL2tpdGVsZXYvRG9jdW1lbnRzL2V4b2NvcnRleC1vYnNpZGlhbi1wbHVnaW4vc3JjL3ByZXNlbnRhdGlvbi9tb2RhbHMvQ3JlYXRlQXNzZXRNb2RhbC50cyIsIm1hcHBpbmdzIjoiOzs7O0FBQUEsdUNBQThEO0FBRTlELDRFQUF5RTtBQUl6RTs7O0dBR0c7QUFDSCxNQUFhLGdCQUFpQixTQUFRLGdCQUFLO0lBYXpDLFlBQVksR0FBUTtRQUNsQixLQUFLLENBQUMsR0FBRyxDQUFDLENBQUM7UUFiTCxlQUFVLEdBQVcsRUFBRSxDQUFDO1FBQ3hCLGVBQVUsR0FBVyxZQUFZLENBQUM7UUFDbEMsa0JBQWEsR0FBVyxFQUFFLENBQUM7UUFDM0IsbUJBQWMsR0FBcUIsSUFBSSxHQUFHLEVBQUUsQ0FBQztRQUM3Qyx3QkFBbUIsR0FBdUIsSUFBSSxDQUFDO1FBQy9DLGVBQVUsR0FBVSxFQUFFLENBQUMsQ0FBQyx1Q0FBdUM7UUFTckUsSUFBSSxDQUFDLFNBQVMsR0FBRyx5QkFBVyxDQUFDLFdBQVcsRUFBRSxDQUFDO1FBQzNDLElBQUksQ0FBQyxrQkFBa0IsR0FBRyxJQUFJLENBQUMsU0FBUyxDQUFDLHFCQUFxQixFQUFFLENBQUM7UUFDakUsSUFBSSxDQUFDLGtCQUFrQixHQUFHLElBQUksQ0FBQyxTQUFTLENBQUMsT0FBTyxDQUFzQixxQkFBcUIsQ0FBQyxDQUFDO1FBQzdGLElBQUksQ0FBQyxtQkFBbUIsR0FBRyxJQUFJLENBQUMsU0FBUyxDQUFDLE9BQU8sQ0FBdUIsc0JBQXNCLENBQUMsQ0FBQztJQUNsRyxDQUFDO0lBRUssTUFBTTs7WUFDVixNQUFNLEVBQUUsU0FBUyxFQUFFLEdBQUcsSUFBSSxDQUFDO1lBQzNCLFNBQVMsQ0FBQyxRQUFRLENBQUMsSUFBSSxFQUFFLEVBQUUsSUFBSSxFQUFFLGlCQUFpQixFQUFFLENBQUMsQ0FBQztZQUV0RCxNQUFNLElBQUksQ0FBQyxlQUFlLENBQUMsU0FBUyxDQUFDLENBQUM7WUFDdEMsTUFBTSxJQUFJLENBQUMsZUFBZSxDQUFDLFNB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ekI7Z0JBRUQsbUJBQW1CO2dCQUNuQixNQUFNLFFBQVEsR0FBRyxNQUFNLElBQUksQ0FBQyxrQkFBa0IsQ0FBQyxPQUFPLENBQUM7b0JBQ3JELEtBQUssRUFBRSxJQUFJLENBQUMsVUFBVTtvQkFDdEIsU0FBUyxFQUFFLElBQUksQ0FBQyxVQUFVO29CQUMxQixjQUFjLEVBQUUsSUFBSSxDQUFDLGFBQWE7b0JBQ2xDLFVBQVU7aUJBQ1gsQ0FBQyxDQUFDO2dCQUVILElBQUksUUFBUSxDQUFDLE9BQU8sRUFBRTtvQkFDcEIsSUFBSSxpQkFBTSxDQUFDLFFBQVEsQ0FBQyxPQUFPLENBQUMsQ0FBQztvQkFDN0IsSUFBSSxDQUFDLEtBQUssRUFBRSxDQUFDO2lCQUNkO3FCQUFNO29CQUNMLElBQUksaUJBQU0sQ0FBQyx3QkFBd0IsQ0FBQyxDQUFDO2lCQUN0QzthQUNGO1lBQUMsT0FBTyxLQUFVLEVBQUU7Z0JBQ25CLElBQUksaUJBQU0sQ0FBQyxVQUFVLEtBQUssQ0FBQyxPQUFPLEVBQUUsQ0FBQyxDQUFDO2FBQ3ZDO1FBQ0gsQ0FBQztLQUFBO0lBRUQsT0FBTztRQUNMLE1BQU0sRUFBRSxTQUFTLEVBQUUsR0FBRyxJQUFJLENBQUM7UUFDM0IsNkRBQTZEO1FBQzdELElBQUksT0FBTyxJQUFJLFNBQVMsSUFBSSxPQUFRLFNBQWlCLENBQUMsS0FBSyxLQUFLLFVBQVUsRUFBRTtZQUN6RSxTQUFpQixDQUFDLEtBQUssRUFBRSxDQUFDO1NBQzVCO2FBQU07WUFDTCx1RUFBdUU7WUFDdkUsU0FBUyxDQUFDLFNBQVMsR0FBRyxFQUFFLENBQUM7U0FDMUI7SUFDSCxDQUFDO0NBQ0Y7QUF6YkQsNENBeWJDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIi9Vc2Vycy9raXRlbGV2L0RvY3VtZW50cy9leG9jb3J0ZXgtb2JzaWRpYW4tcGx1Z2luL3NyYy9wcmVzZW50YXRpb24vbW9kYWxzL0NyZWF0ZUFzc2V0TW9kYWwudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQXBwLCBNb2RhbCwgU2V0dGluZywgTm90aWNlLCBURmlsZSB9IGZyb20gJ29ic2lkaWFuJztcbmltcG9ydCB7IENyZWF0ZUFzc2V0VXNlQ2FzZSB9IGZyb20gJy4uLy4uL2FwcGxpY2F0aW9uL3VzZS1jYXNlcy9DcmVhdGVBc3NldFVzZUNhc2UnO1xuaW1wb3J0IHsgRElDb250YWluZXIgfSBmcm9tICcuLi8uLi9pbmZyYXN0cnVjdHVyZS9jb250YWluZXIvRElDb250YWluZXInO1xuaW1wb3J0IHsgSU9udG9sb2d5UmVwb3NpdG9yeSB9IGZyb20gJy4uLy4uL2RvbWFpbi9yZXBvc2l0b3JpZXMvSU9udG9sb2d5UmVwb3NpdG9yeSc7XG5pbXBvcnQgeyBJQ2xhc3NWaWV3UmVwb3NpdG9yeSB9IGZyb20gJy4uLy4uL2RvbWFpbi9yZXBvc2l0b3JpZXMvSUNsYXNzVmlld1JlcG9zaXRvcnknO1xuXG4vKipcbiAqIE1vZGFsIGZvciBjcmVhdGluZyBuZXcgRXhvQXNzZXRzXG4gKiBQcmVzZW50YXRpb24gbGF5ZXIgY29tcG9uZW50IHRoYXQgZGVsZWdhdGVzIHRvIHVzZSBjYXNlc1xuICovXG5leHBvcnQgY2xhc3MgQ3JlYXRlQXNzZXRNb2RhbCBleHRlbmRzIE1vZGFsIHtcbiAgcHJpdmF0ZSBhc3NldFRpdGxlOiBzdHJpbmcgPSAnJztcbiAgcHJpdmF0ZSBhc3NldENsYXNzOiBzdHJpbmcgPSAnZXhvX19Bc3NldCc7XG4gIHByaXZhdGUgYXNzZXRPbnRvbG9neTogc3RyaW5nID0gJyc7XG4gIHByaXZhdGUgcHJvcGVydHlWYWx1ZXM6IE1hcDxzdHJpbmcsIGFueT4gPSBuZXcgTWFwKCk7XG4gIHByaXZhdGUgcHJvcGVydGllc0NvbnRhaW5lcjogSFRNTEVsZW1lbnQgfCBudWxsID0gbnVsbDtcbiAgcHJpdmF0ZSBwcm9wZXJ0aWVzOiBhbnlbXSA9IFtdOyAvLyBTdG9yZSBjdXJyZW50IHByb3BlcnRpZXMgZm9yIHRlc3RpbmdcbiAgXG4gIHByaXZhdGUgY3JlYXRlQXNzZXRVc2VDYXNlOiBDcmVhdGVBc3NldFVzZUNhc2U7XG4gIHByaXZhdGUgY29udGFpbmVyOiBESUNvbnRhaW5lcjtcbiAgcHJpdmF0ZSBvbnRvbG9neVJlcG9zaXRvcnk6IElPbnRvbG9neVJlcG9zaXRvcnk7XG4gIHByaXZhdGUgY2xhc3NWaWV3UmVwb3NpdG9yeTogSUNsYXNzVmlld1JlcG9zaXRvcnk7XG5cbiAgY29uc3RydWN0b3IoYXBwOiBBcHApIHtcbiAgICBzdXBlcihhcHApO1xuICAgIHRoaXMuY29udGFpbmVyID0gRElDb250YWluZXIuZ2V0SW5zdGFuY2UoKTtcbiAgICB0aGlzLmNyZWF0ZUFzc2V0VXNlQ2FzZSA9IHRoaXMuY29udGFpbmVyLmdldENyZWF0ZUFzc2V0VXNlQ2FzZSgpO1xuICAgIHRoaXMub250b2xvZ3lSZXBvc2l0b3J5ID0gdGhpcy5jb250YWluZXIucmVzb2x2ZTxJT250b2xvZ3lSZXBvc2l0b3J5PignSU9udG9sb2d5UmVwb3NpdG9yeScpO1xuICAgIHRoaXMuY2xhc3NWaWV3UmVwb3NpdG9yeSA9IHRoaXMuY29udGFpbmVyLnJlc29sdmU8SUNsYXNzVmlld1JlcG9zaXRvcnk+KCdJQ2xhc3NWaWV3UmVwb3NpdG9yeScpO1xuICB9XG5cbiAgYXN5bmMgb25PcGVuKCkge1xuICAgIGNvbnN0IHsgY29udGVudEVsIH0gPSB0aGlzO1xuICAgIGNvbnRlbnRFbC5jcmVhdGVFbChcImgyXCIsIHsgdGV4dDogXCJDcmVhdGUgRXhvQXNzZXRcIiB9KTtcblxuICAgIGF3YWl0IHRoaXMuc2V0dXBUaXRsZUZpZWxkKGNvbnRlbnRFbCk7XG4gICAgYXdhaXQgdGhpcy5zZXR1cENsYXNzRmllbGQoY29udGVudEVsKTtcbiAgICBhd2FpdCB0aGlzLnNldHVwT250b2xvZ3lGaWVsZChjb250ZW50RWwpO1xuICAgIGF3YWl0IHRoaXMuc2V0dXBQcm9wZXJ0aWVzU2VjdGlvbihjb250ZW50RWwpO1xuICAgIHRoaXMuc2V0dXBBY3Rpb25CdXR0b25zKGNvbnRlbnRFbCk7XG4gIH1cblxuICBwcml2YXRlIGFzeW5jIHNldHVwVGl0bGVGaWVsZChjb250YWluZXJFbDogSFRNTEVsZW1lbnQpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBuZXcgU2V0dGluZyhjb250YWluZXJFbClcbiAgICAgIC5zZXROYW1lKFwiVGl0bGVcIilcbiAgICAgIC5zZXREZXNjKFwiQXNzZXQgdGl0bGVcIilcbiAgICAgIC5hZGRUZXh0KHRleHQgPT4gdGV4dFxuICAgICAgICAuc2V0UGxhY2Vob2xkZXIoXCJFbnRlciBhc3NldCB0aXRsZVwiKVxuICAgICAgICAuc2V0VmFsdWUodGhpcy5hc3NldFRpdGxlKVxuICAgICAgICAub25DaGFuZ2UodmFsdWUgPT4gdGhpcy5hc3NldFRpdGxlID0gdmFsdWUpKTtcbiAgfVxuXG4gIHByaXZhdGUgYXN5bmMgc2V0dXBDbGFzc0ZpZWxkKGNvbnRhaW5lckVsOiBIVE1MRWxlbWVudCk6IFByb21pc2U8dm9pZD4ge1xuICAgIC8vIEdldCBhbGwgY2xhc3MgZmlsZXMgZnJvbSB0aGUgdmF1bHRcbiAgICBjb25zdCBmaWxlcyA9IHRoaXMuYXBwLnZhdWx0LmdldE1hcmtkb3duRmlsZXMoKTtcbiAgICBjb25zdCBjbGFzc2VzOiB7IGNsYXNzTmFtZTogc3RyaW5nOyBkaXNwbGF5TmFtZTogc3RyaW5nIH1bXSA9IFtdO1xuICAgIFxuICAgIC8vIEZpbmQgYWxsIGNsYXNzIGRlZmluaXRpb25zIChmaWxlcyB3aXRoIGV4b19fQ2xhc3MgZnJvbnRtYXR0ZXIpXG4gICAgZm9yIChjb25zdCBmaWxlIG9mIGZpbGVzKSB7XG4gICAgICBjb25zdCBjYWNoZSA9IHRoaXMuYXBwLm1ldGFkYXRhQ2FjaGUuZ2V0RmlsZUNhY2hlKGZpbGUpO1xuICAgICAgaWYgKGNhY2hlPy5mcm9udG1hdHRlcikge1xuICAgICAgICBjb25zdCBpbnN0YW5jZUNsYXNzID0gY2FjaGUuZnJvbnRtYXR0ZXJbJ2V4b19fSW5zdGFuY2VfY2xhc3MnXTtcbiAgICAgICAgaWYgKGluc3RhbmNlQ2xhc3MgPT09ICdbW2V4b19fQ2xhc3NdXScgfHwgaW5zdGFuY2VDbGFzcyA9PT0gJ2V4b19fQ2xhc3MnKSB7XG4gICAgICAgICAgY29uc3QgY2xhc3NOYW1lID0gZmlsZS5iYXNlbmFtZTtcbiAgICAgICAgICBjb25zdCBkaXNwbGF5TmFtZSA9IGNhY2hlLmZyb250bWF0dGVyWydyZGZzX19sYWJlbCddIHx8IGNsYXNzTmFtZTtcbiAgICAgICAgICBjbGFzc2VzLnB1c2goeyBjbGFzc05hbWUsIGRpc3BsYXlOYW1lIH0pO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICAgIFxuICAgIC8vIEFkZCBkZWZhdWx0IGNsYXNzZXMgaWYgbm9uZSBmb3VuZFxuICAgIGlmIChjbGFzc2VzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgY2xhc3Nlcy5wdXNoKFxuICAgICAgICB7IGNsYXNzTmFtZTogJ2V4b19fQXNzZXQnLCBkaXNwbGF5TmFtZTogJ0Fzc2V0JyB9LFxuICAgICAgICB7IGNsYXNzTmFtZTogJ2V4b19fQ2xhc3MnLCBkaXNwbGF5TmFtZTogJ0NsYXNzJyB9LFxuICAgICAgICB7IGNsYXNzTmFtZTogJ2V4b19fUHJvcGVydHknLCBkaXNwbGF5TmFtZTogJ1Byb3BlcnR5JyB9XG4gICAgICApO1xuICAgIH1cblxuICAgIG5ldyBTZXR0aW5nKGNvbnRhaW5lckVsKVxuICAgICAgLnNldE5hbWUoXCJDbGFzc1wiKVxuICAgICAgLnNldERlc2MoXCJTZWxlY3QgdGhlIHR5cGUgb2YgYXNzZXRcIilcbiAgICAgIC5hZGREcm9wZG93bihkcm9wZG93biA9PiB7XG4gICAgICAgIGZvciAoY29uc3QgY2xhc3NJbmZvIG9mIGNsYXNzZXMpIHtcbiAgICAgICAgICBkcm9wZG93bi5hZGRPcHRpb24oY2xhc3NJbmZvLmNsYXNzTmFtZSwgY2xhc3NJbmZvLmRpc3BsYXlOYW1lKTtcbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgZHJvcGRvd24uc2V0VmFsdWUodGhpcy5hc3NldENsYXNzKTtcbiAgICAgICAgZHJvcGRvd24ub25DaGFuZ2UoYXN5bmMgdmFsdWUgPT4ge1xuICAgICAgICAgIHRoaXMuYXNzZXRDbGFzcyA9IHZhbHVlO1xuICAgICAgICAgIGF3YWl0IHRoaXMudXBkYXRlUHJvcGVydGllc0ZvckNsYXNzKHZhbHVlKTtcbiAgICAgICAgfSk7XG4gICAgICB9KTtcbiAgfVxuXG4gIHByaXZhdGUgYXN5bmMgc2V0dXBPbnRvbG9neUZpZWxkKGNvbnRhaW5lckVsOiBIVE1MRWxlbWVudCk6IFByb21pc2U8dm9pZD4ge1xuICAgIC8vIEdldCBhbGwgb250b2xvZ3kgZmlsZXMgZnJvbSB0aGUgdmF1bHRcbiAgICBjb25zdCBmaWxlcyA9IHRoaXMuYXBwLnZhdWx0LmdldE1hcmtkb3duRmlsZXMoKTtcbiAgICBjb25zdCBvbnRvbG9naWVzOiB7IHByZWZpeDogc3RyaW5nOyBkaXNwbGF5TmFtZTogc3RyaW5nIH1bXSA9IFtdO1xuICAgIFxuICAgIC8vIEZpbmQgYWxsIG9udG9sb2d5IGRlZmluaXRpb25zIChmaWxlcyBzdGFydGluZyB3aXRoICEgb3IgaGF2aW5nIGV4b19fT250b2xvZ3lfcHJlZml4KVxuICAgIGZvciAoY29uc3QgZmlsZSBvZiBmaWxlcykge1xuICAgICAgaWYgKGZpbGUubmFtZS5zdGFydHNXaXRoKCchJykpIHtcbiAgICAgICAgY29uc3QgY2FjaGUgPSB0aGlzLmFwcC5tZXRhZGF0YUNhY2hlLmdldEZpbGVDYWNoZShmaWxlKTtcbiAgICAgICAgaWYgKGNhY2hlPy5mcm9udG1hdHRlcikge1xuICAgICAgICAgIGNvbnN0IHByZWZpeCA9IGNhY2hlLmZyb250bWF0dGVyWydleG9fX09udG9sb2d5X3ByZWZpeCddIHx8IGZpbGUuYmFzZW5hbWUuc3Vic3RyaW5nKDEpO1xuICAgICAgICAgIGNvbnN0IGRpc3BsYXlOYW1lID0gY2FjaGUuZnJvbnRtYXR0ZXJbJ3JkZnNfX2xhYmVsJ10gfHwgcHJlZml4O1xuICAgICAgICAgIG9udG9sb2dpZXMucHVzaCh7IHByZWZpeCwgZGlzcGxheU5hbWUgfSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gICAgXG4gICAgLy8gQWRkIGRlZmF1bHQgb250b2xvZ2llcyBpZiBub25lIGZvdW5kXG4gICAgaWYgKG9udG9sb2dpZXMubGVuZ3RoID09PSAwKSB7XG4gICAgICBvbnRvbG9naWVzLnB1c2goXG4gICAgICAgIHsgcHJlZml4OiAnZXhvJywgZGlzcGxheU5hbWU6ICdFeG9jb3J0ZXggQ29yZScgfSxcbiAgICAgICAgeyBwcmVmaXg6ICd1aScsIGRpc3BsYXlOYW1lOiAnVXNlciBJbnRlcmZhY2UnIH0sXG4gICAgICAgIHsgcHJlZml4OiAncmRmcycsIGRpc3BsYXlOYW1lOiAnUkRGIFNjaGVtYScgfVxuICAgICAgKTtcbiAgICB9XG4gICAgXG4gICAgY29uc3QgZGVmYXVsdE9udG9sb2d5ID0gJ2V4byc7XG4gICAgXG4gICAgLy8gU2V0IGRlZmF1bHQgb250b2xvZ3kgd2hlbiBubyBvbnRvbG9naWVzIGZvdW5kIGluIHZhdWx0XG4gICAgaWYgKG9udG9sb2dpZXMubGVuZ3RoID4gMCAmJiAhdGhpcy5hc3NldE9udG9sb2d5KSB7XG4gICAgICB0aGlzLmFzc2V0T250b2xvZ3kgPSBkZWZhdWx0T250b2xvZ3k7XG4gICAgfVxuXG4gICAgbmV3IFNldHRpbmcoY29udGFpbmVyRWwpXG4gICAgICAuc2V0TmFtZShcIk9udG9sb2d5XCIpXG4gICAgICAuc2V0RGVzYyhcIlNlbGVjdCB3aGljaCBrbm93bGVkZ2UgZ3JhcGggdGhpcyBhc3NldCBiZWxvbmdzIHRvXCIpXG4gICAgICAuYWRkRHJvcGRvd24oZHJvcGRvd24gPT4ge1xuICAgICAgICBmb3IgKGNvbnN0IG9udG9sb2d5IG9mIG9udG9sb2dpZXMpIHtcbiAgICAgICAgICBkcm9wZG93bi5hZGRPcHRpb24ob250b2xvZ3kucHJlZml4LCBvbnRvbG9neS5kaXNwbGF5TmFtZSk7XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIC8vIFNldCBkZWZhdWx0IG9udG9sb2d5XG4gICAgICAgIGlmIChkZWZhdWx0T250b2xvZ3kgJiYgb250b2xvZ2llcy5zb21lKChvOiBhbnkpID0+IG8ucHJlZml4ID09PSBkZWZhdWx0T250b2xvZ3kpKSB7XG4gICAgICAgICAgdGhpcy5hc3NldE9udG9sb2d5ID0gZGVmYXVsdE9udG9sb2d5O1xuICAgICAgICAgIGRyb3Bkb3duLnNldFZhbHVlKGRlZmF1bHRPbnRvbG9neSk7XG4gICAgICAgIH0gZWxzZSBpZiAob250b2xvZ2llcy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgdGhpcy5hc3NldE9udG9sb2d5ID0gb250b2xvZ2llc1swXS5wcmVmaXg7XG4gICAgICAgICAgZHJvcGRvd24uc2V0VmFsdWUob250b2xvZ2llc1swXS5wcmVmaXgpO1xuICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICBkcm9wZG93bi5vbkNoYW5nZSh2YWx1ZSA9PiB7XG4gICAgICAgICAgdGhpcy5hc3NldE9udG9sb2d5ID0gdmFsdWU7XG4gICAgICAgIH0pO1xuICAgICAgfSk7XG4gIH1cblxuICBwcml2YXRlIGFzeW5jIHNldHVwUHJvcGVydGllc1NlY3Rpb24oY29udGFpbmVyRWw6IEhUTUxFbGVtZW50KTogUHJvbWlzZTx2b2lkPiB7XG4gICAgY29udGFpbmVyRWwuY3JlYXRlRWwoXCJoM1wiLCB7IFxuICAgICAgdGV4dDogXCJQcm9wZXJ0aWVzXCIsIFxuICAgICAgY2xzOiBcImV4b2NvcnRleC1wcm9wZXJ0aWVzLWhlYWRlclwiIFxuICAgIH0pO1xuICAgIFxuICAgIHRoaXMucHJvcGVydGllc0NvbnRhaW5lciA9IGNvbnRhaW5lckVsLmNyZWF0ZURpdih7IFxuICAgICAgY2xzOiBcImV4b2NvcnRleC1wcm9wZXJ0aWVzLWNvbnRhaW5lclwiIFxuICAgIH0pO1xuICAgIFxuICAgIGF3YWl0IHRoaXMudXBkYXRlUHJvcGVydGllc0ZvckNsYXNzKHRoaXMuYXNzZXRDbGFzcyk7XG4gIH1cblxuICBwcml2YXRlIGFzeW5jIHVwZGF0ZVByb3BlcnRpZXNGb3JDbGFzcyhjbGFzc05hbWU6IHN0cmluZyk6IFByb21pc2U8dm9pZD4ge1xuICAgIGlmICghdGhpcy5wcm9wZXJ0aWVzQ29udGFpbmVyKSByZXR1cm47XG4gICAgXG4gICAgY29uc29sZS5sb2coYFVwZGF0aW5nIHByb3BlcnRpZXMgZm9yIGNsYXNzOiAke2NsYXNzTmFtZX1gKTtcbiAgICBcbiAgICAvLyBDbGVhciB0aGUgY29udGFpbmVyIC0gdHJ5IE9ic2lkaWFuIG1ldGhvZCBmaXJzdCwgZmFsbGJhY2sgdG8gRE9NXG4gICAgaWYgKCdlbXB0eScgaW4gdGhpcy5wcm9wZXJ0aWVzQ29udGFpbmVyICYmIHR5cGVvZiAodGhpcy5wcm9wZXJ0aWVzQ29udGFpbmVyIGFzIGFueSkuZW1wdHkgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICh0aGlzLnByb3BlcnRpZXNDb250YWluZXIgYXMgYW55KS5lbXB0eSgpO1xuICAgIH0gZWxzZSB7XG4gICAgICAvLyBGYWxsYmFjayB0byBzdGFuZGFyZCBET00gbWV0aG9kIC0gdXNlIGlubmVySFRNTCBmb3IgY29tcGxldGUgY2xlYW51cFxuICAgICAgdGhpcy5wcm9wZXJ0aWVzQ29udGFpbmVyLmlubmVySFRNTCA9ICcnO1xuICAgIH1cbiAgICB0aGlzLnByb3BlcnR5VmFsdWVzLmNsZWFyKCk7XG4gICAgXG4gICAgLy8gR2V0IHByb3BlcnRpZXMgZm9yIHRoaXMgY2xhc3NcbiAgICB0aGlzLnByb3BlcnRpZXMgPSBbXTtcbiAgICBjb25zdCBmaWxlcyA9IHRoaXMuYXBwLnZhdWx0LmdldE1hcmtkb3duRmlsZXMoKTtcbiAgICBcbiAgICBjb25zb2xlLmxvZyhgU2Nhbm5pbmcgJHtmaWxlcy5sZW5ndGh9IGZpbGVzIGZvciBwcm9wZXJ0aWVzLi4uYCk7XG4gICAgXG4gICAgLy8gRmluZCBhbGwgcHJvcGVydHkgZGVmaW5pdGlvbnMgcmVsYXRlZCB0byB0aGlzIGNsYXNzXG4gICAgZm9yIChjb25zdCBmaWxlIG9mIGZpbGVzKSB7XG4gICAgICBjb25zdCBjYWNoZSA9IHRoaXMuYXBwLm1ldGFkYXRhQ2FjaGUuZ2V0RmlsZUNhY2hlKGZpbGUpO1xuICAgICAgaWYgKGNhY2hlPy5mcm9udG1hdHRlcikge1xuICAgICAgICBjb25zdCBpbnN0YW5jZUNsYXNzID0gY2FjaGUuZnJvbnRtYXR0ZXJbJ2V4b19fSW5zdGFuY2VfY2xhc3MnXTtcbiAgICAgICAgaWYgKGluc3RhbmNlQ2xhc3MgPT09ICdbW2V4b19fUHJvcGVydHldXScgfHwgaW5zdGFuY2VDbGFzcyA9PT0gJ2V4b19fUHJvcGVydHknKSB7XG4gICAgICAgICAgY29uc3QgZG9tYWluID0gY2FjaGUuZnJvbnRtYXR0ZXJbJ3JkZnNfX2RvbWFpbiddO1xuICAgICAgICAgIC8vIENoZWNrIGlmIHRoaXMgcHJvcGVydHkgYmVsb25ncyB0byB0aGUgY3VycmVudCBjbGFzc1xuICAgICAgICAgIGlmIChkb21haW4gPT09IGBbWyR7Y2xhc3NOYW1lfV1dYCB8fCBkb21haW4gPT09IGNsYXNzTmFtZSB8fCBcbiAgICAgICAgICAgICAgKEFycmF5LmlzQXJyYXkoZG9tYWluKSAmJiAoZG9tYWluLmluY2x1ZGVzKGNsYXNzTmFtZSkgfHwgZG9tYWluLmluY2x1ZGVzKGBbWyR7Y2xhc3NOYW1lfV1dYCkpKSkge1xuICAgICAgICAgICAgY29uc3QgcHJvcGVydHlOYW1lID0gZmlsZS5iYXNlbmFtZTtcbiAgICAgICAgICAgIGNvbnN0IGxhYmVsID0gY2FjaGUuZnJvbnRtYXR0ZXJbJ3JkZnNfX2xhYmVsJ10gfHwgcHJvcGVydHlOYW1lO1xuICAgICAgICAgICAgY29uc3QgZGVzY3JpcHRpb24gPSBjYWNoZS5mcm9udG1hdHRlclsncmRmc19fY29tbWVudCddIHx8ICcnO1xuICAgICAgICAgICAgY29uc3QgcmFuZ2UgPSBjYWNoZS5mcm9udG1hdHRlclsncmRmc19fcmFuZ2UnXSB8fCAnc3RyaW5nJztcbiAgICAgICAgICAgIGNvbnN0IGlzUmVxdWlyZWQgPSBjYWNoZS5mcm9udG1hdHRlclsnZXhvX19Qcm9wZXJ0eV9pc1JlcXVpcmVkJ10gfHwgZmFsc2U7XG4gICAgICAgICAgICBjb25zdCBvcHRpb25zID0gY2FjaGUuZnJvbnRtYXR0ZXJbJ2V4b19fUHJvcGVydHlfb3B0aW9ucyddIHx8IG51bGw7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKGBGb3VuZCBwcm9wZXJ0eSAke3Byb3BlcnR5TmFtZX0gZm9yIGNsYXNzICR7Y2xhc3NOYW1lfWApO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICAvLyBEZXRlcm1pbmUgcHJvcGVydHkgdHlwZSBiYXNlZCBvbiByYW5nZSBhbmQgb3B0aW9uc1xuICAgICAgICAgICAgbGV0IHR5cGUgPSB0aGlzLm1hcFJhbmdlVG9UeXBlKHJhbmdlKTtcbiAgICAgICAgICAgIGlmIChvcHRpb25zICYmIEFycmF5LmlzQXJyYXkob3B0aW9ucykpIHtcbiAgICAgICAgICAgICAgdHlwZSA9ICdlbnVtJztcbiAgICAgICAgICAgIH0gZWxzZSBpZiAocmFuZ2UgPT09ICdzZWxlY3QnICYmIG9wdGlvbnMpIHtcbiAgICAgICAgICAgICAgdHlwZSA9ICdlbnVtJztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIFxuICAgICAgICAgICAgdGhpcy5wcm9wZXJ0aWVzLnB1c2goe1xuICAgICAgICAgICAgICBuYW1lOiBwcm9wZXJ0eU5hbWUsXG4gICAgICAgICAgICAgIGxhYmVsOiBsYWJlbCxcbiAgICAgICAgICAgICAgZGVzY3JpcHRpb246IGRlc2NyaXB0aW9uLFxuICAgICAgICAgICAgICB0eXBlOiB0eXBlLFxuICAgICAgICAgICAgICBpc1JlcXVpcmVkOiBpc1JlcXVpcmVkLFxuICAgICAgICAgICAgICByYW5nZTogcmFuZ2UsXG4gICAgICAgICAgICAgIG9wdGlvbnM6IG9wdGlvbnNcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgICBcbiAgICBjb25zb2xlLmxvZyhgRm91bmQgJHt0aGlzLnByb3BlcnRpZXMubGVuZ3RofSBwcm9wZXJ0aWVzIGZvciBjbGFzcyAke2NsYXNzTmFtZX1gKTtcbiAgICBcbiAgICAvLyBBZGQgc29tZSBkZWZhdWx0IHByb3BlcnRpZXMgZm9yIGNvbW1vbiBjbGFzc2VzXG4gICAgaWYgKHRoaXMucHJvcGVydGllcy5sZW5ndGggPT09IDAgJiYgY2xhc3NOYW1lID09PSAnZXhvX19Bc3NldCcpIHtcbiAgICAgIHRoaXMucHJvcGVydGllcy5wdXNoKFxuICAgICAgICB7XG4gICAgICAgICAgbmFtZTogJ2Rlc2NyaXB0aW9uJyxcbiAgICAgICAgICBsYWJlbDogJ0Rlc2NyaXB0aW9uJyxcbiAgICAgICAgICBkZXNjcmlwdGlvbjogJ0EgYnJpZWYgZGVzY3JpcHRpb24gb2YgdGhlIGFzc2V0JyxcbiAgICAgICAgICB0eXBlOiAndGV4dCcsXG4gICAgICAgICAgaXNSZXF1aXJlZDogZmFsc2VcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgIG5hbWU6ICd0YWdzJyxcbiAgICAgICAgICBsYWJlbDogJ1RhZ3MnLFxuICAgICAgICAgIGRlc2NyaXB0aW9uOiAnVGFncyBmb3IgY2F0ZWdvcml6YXRpb24nLFxuICAgICAgICAgIHR5cGU6ICdhcnJheScsXG4gICAgICAgICAgaXNSZXF1aXJlZDogZmFsc2VcbiAgICAgICAgfVxuICAgICAgKTtcbiAgICB9XG4gICAgXG4gICAgaWYgKHRoaXMucHJvcGVydGllcy5sZW5ndGggPT09IDApIHtcbiAgICAgIHRoaXMucHJvcGVydGllc0NvbnRhaW5lci5jcmVhdGVFbChcInBcIiwge1xuICAgICAgICB0ZXh0OiBcIk5vIHNwZWNpZmljIHByb3BlcnRpZXMgZm9yIHRoaXMgY2xhc3NcIixcbiAgICAgICAgY2xzOiBcImV4b2NvcnRleC1uby1wcm9wZXJ0aWVzXCJcbiAgICAgIH0pO1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBcbiAgICAvLyBDcmVhdGUgZmllbGRzIGZvciBhbGwgcHJvcGVydGllcyAoaW5jbHVkaW5nIGRlZmF1bHRzKVxuICAgIGZvciAoY29uc3QgcHJvcCBvZiB0aGlzLnByb3BlcnRpZXMpIHtcbiAgICAgIHRoaXMuY3JlYXRlUHJvcGVydHlGaWVsZChwcm9wKTtcbiAgICB9XG4gIH1cbiAgXG4gIHByaXZhdGUgbWFwUmFuZ2VUb1R5cGUocmFuZ2U6IHN0cmluZyk6IHN0cmluZyB7XG4gICAgLy8gTWFwIFJERi9PV0wgcmFuZ2VzIHRvIGlucHV0IHR5cGVzXG4gICAgaWYgKHJhbmdlID09PSAnc2VsZWN0JykgcmV0dXJuICdlbnVtJztcbiAgICBpZiAocmFuZ2UuaW5jbHVkZXMoJ2Jvb2xlYW4nKSkgcmV0dXJuICdib29sZWFuJztcbiAgICBpZiAocmFuZ2UuaW5jbHVkZXMoJ2RhdGUnKSB8fCByYW5nZS5pbmNsdWRlcygnRGF0ZScpKSByZXR1cm4gJ2RhdGUnO1xuICAgIGlmIChyYW5nZS5pbmNsdWRlcygnaW50ZWdlcicpIHx8IHJhbmdlLmluY2x1ZGVzKCdkZWNpbWFsJykgfHwgcmFuZ2UuaW5jbHVkZXMoJ2Zsb2F0JykpIHJldHVybiAnbnVtYmVyJztcbiAgICBpZiAocmFuZ2UuaW5jbHVkZXMoJ3N0cmluZycpICYmIHJhbmdlLmluY2x1ZGVzKCdbXScpKSByZXR1cm4gJ2FycmF5JztcbiAgICBpZiAocmFuZ2UuaW5jbHVkZXMoJ3RleHQnKSB8fCByYW5nZS5pbmNsdWRlcygnVGV4dCcpKSByZXR1cm4gJ3RleHQnO1xuICAgIHJldHVybiAnc3RyaW5nJzsgLy8gZGVmYXVsdFxuICB9XG5cbiAgcHJpdmF0ZSBjcmVhdGVQcm9wZXJ0eUZpZWxkKHByb3BlcnR5OiBhbnkpOiB2b2lkIHtcbiAgICBpZiAoIXRoaXMucHJvcGVydGllc0NvbnRhaW5lcikgcmV0dXJuO1xuICAgIFxuICAgIGNvbnN0IHNldHRpbmcgPSBuZXcgU2V0dGluZyh0aGlzLnByb3BlcnRpZXNDb250YWluZXIpXG4gICAgICAuc2V0TmFtZShwcm9wZXJ0eS5sYWJlbCArIChwcm9wZXJ0eS5pc1JlcXVpcmVkID8gJyAqJyA6ICcnKSlcbiAgICAgIC5zZXREZXNjKHByb3BlcnR5LmRlc2NyaXB0aW9uKTtcbiAgICBcbiAgICAvLyBDcmVhdGUgYXBwcm9wcmlhdGUgaW5wdXQgYmFzZWQgb24gcHJvcGVydHkgdHlwZVxuICAgIHN3aXRjaCAocHJvcGVydHkudHlwZSkge1xuICAgICAgY2FzZSAnZW51bSc6XG4gICAgICAgIHRoaXMuY3JlYXRlRW51bUZpZWxkKHNldHRpbmcsIHByb3BlcnR5KTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlICdib29sZWFuJzpcbiAgICAgICAgdGhpcy5jcmVhdGVCb29sZWFuRmllbGQoc2V0dGluZywgcHJvcGVydHkpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgJ2RhdGUnOlxuICAgICAgICB0aGlzLmNyZWF0ZURhdGVGaWVsZChzZXR0aW5nLCBwcm9wZXJ0eSk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAnbnVtYmVyJzpcbiAgICAgICAgdGhpcy5jcmVhdGVOdW1iZXJGaWVsZChzZXR0aW5nLCBwcm9wZXJ0eSk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAndGV4dCc6XG4gICAgICAgIHRoaXMuY3JlYXRlVGV4dEFyZWFGaWVsZChzZXR0aW5nLCBwcm9wZXJ0eSk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAnYXJyYXknOlxuICAgICAgICB0aGlzLmNyZWF0ZUFycmF5RmllbGQoc2V0dGluZywgcHJvcGVydHkpO1xuICAgICAgICBicmVhaztcbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIHRoaXMuY3JlYXRlVGV4dEZpZWxkKHNldHRpbmcsIHByb3BlcnR5KTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGNyZWF0ZUVudW1GaWVsZChzZXR0aW5nOiBTZXR0aW5nLCBwcm9wZXJ0eTogYW55KTogdm9pZCB7XG4gICAgc2V0dGluZy5hZGREcm9wZG93bihkcm9wZG93biA9PiB7XG4gICAgICBkcm9wZG93bi5hZGRPcHRpb24oJycsICctLSBTZWxlY3QgLS0nKTtcbiAgICAgIGZvciAoY29uc3Qgb3B0aW9uIG9mIHByb3BlcnR5Lm9wdGlvbnMpIHtcbiAgICAgICAgZHJvcGRvd24uYWRkT3B0aW9uKG9wdGlvbiwgb3B0aW9uKTtcbiAgICAgIH1cbiAgICAgIGRyb3Bkb3duLm9uQ2hhbmdlKHZhbHVlID0+IHtcbiAgICAgICAgaWYgKHZhbHVlKSB7XG4gICAgICAgICAgdGhpcy5wcm9wZXJ0eVZhbHVlcy5zZXQocHJvcGVydHkubmFtZSwgdmFsdWUpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHRoaXMucHJvcGVydHlWYWx1ZXMuZGVsZXRlKHByb3BlcnR5Lm5hbWUpO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9KTtcbiAgfVxuXG4gIHByaXZhdGUgY3JlYXRlQm9vbGVhbkZpZWxkKHNldHRpbmc6IFNldHRpbmcsIHByb3BlcnR5OiBhbnkpOiB2b2lkIHtcbiAgICBzZXR0aW5nLmFkZFRvZ2dsZSh0b2dnbGUgPT4ge1xuICAgICAgdG9nZ2xlLm9uQ2hhbmdlKHZhbHVlID0+IHtcbiAgICAgICAgdGhpcy5wcm9wZXJ0eVZhbHVlcy5zZXQocHJvcGVydHkubmFtZSwgdmFsdWUpO1xuICAgICAgfSk7XG4gICAgfSk7XG4gIH1cblxuICBwcml2YXRlIGNyZWF0ZURhdGVGaWVsZChzZXR0aW5nOiBTZXR0aW5nLCBwcm9wZXJ0eTogYW55KTogdm9pZCB7XG4gICAgc2V0dGluZy5hZGRUZXh0KHRleHQgPT4ge1xuICAgICAgdGV4dC5zZXRQbGFjZWhvbGRlcignWVlZWS1NTS1ERCcpXG4gICAgICAgIC5vbkNoYW5nZSh2YWx1ZSA9PiB7XG4gICAgICAgICAgaWYgKHZhbHVlKSB7XG4gICAgICAgICAgICB0aGlzLnByb3BlcnR5VmFsdWVzLnNldChwcm9wZXJ0eS5uYW1lLCB2YWx1ZSk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMucHJvcGVydHlWYWx1ZXMuZGVsZXRlKHByb3BlcnR5Lm5hbWUpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAvLyBTZXQgdGhlIGlucHV0IHR5cGUgdG8gZGF0ZVxuICAgICAgdGV4dC5pbnB1dEVsLnR5cGUgPSAnZGF0ZSc7XG4gICAgfSk7XG4gIH1cblxuICBwcml2YXRlIGNyZWF0ZU51bWJlckZpZWxkKHNldHRpbmc6IFNldHRpbmcsIHByb3BlcnR5OiBhbnkpOiB2b2lkIHtcbiAgICBzZXR0aW5nLmFkZFRleHQodGV4dCA9PiB7XG4gICAgICB0ZXh0LnNldFBsYWNlaG9sZGVyKCdFbnRlciBudW1iZXInKVxuICAgICAgICAub25DaGFuZ2UodmFsdWUgPT4ge1xuICAgICAgICAgIGlmICh2YWx1ZSkge1xuICAgICAgICAgICAgY29uc3QgbnVtID0gcGFyc2VGbG9hdCh2YWx1ZSk7XG4gICAgICAgICAgICBpZiAoIWlzTmFOKG51bSkpIHtcbiAgICAgICAgICAgICAgdGhpcy5wcm9wZXJ0eVZhbHVlcy5zZXQocHJvcGVydHkubmFtZSwgbnVtKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5wcm9wZXJ0eVZhbHVlcy5kZWxldGUocHJvcGVydHkubmFtZSk7XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9KTtcbiAgfVxuXG4gIHByaXZhdGUgY3JlYXRlVGV4dEFyZWFGaWVsZChzZXR0aW5nOiBTZXR0aW5nLCBwcm9wZXJ0eTogYW55KTogdm9pZCB7XG4gICAgc2V0dGluZy5hZGRUZXh0QXJlYSh0ZXh0ID0+IHtcbiAgICAgIHRleHQuc2V0UGxhY2Vob2xkZXIoJ0VudGVyICcgKyBwcm9wZXJ0eS5sYWJlbC50b0xvd2VyQ2FzZSgpKVxuICAgICAgICAub25DaGFuZ2UodmFsdWUgPT4ge1xuICAgICAgICAgIGlmICh2YWx1ZSkge1xuICAgICAgICAgICAgdGhpcy5wcm9wZXJ0eVZhbHVlcy5zZXQocHJvcGVydHkubmFtZSwgdmFsdWUpO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aGlzLnByb3BlcnR5VmFsdWVzLmRlbGV0ZShwcm9wZXJ0eS5uYW1lKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH0pO1xuICB9XG5cbiAgcHJpdmF0ZSBjcmVhdGVBcnJheUZpZWxkKHNldHRpbmc6IFNldHRpbmcsIHByb3BlcnR5OiBhbnkpOiB2b2lkIHtcbiAgICBzZXR0aW5nLmFkZFRleHQodGV4dCA9PiB7XG4gICAgICB0ZXh0LnNldFBsYWNlaG9sZGVyKCdDb21tYS1zZXBhcmF0ZWQgdmFsdWVzIG9yIFtbbGlua3NdXScpXG4gICAgICAgIC5vbkNoYW5nZSh2YWx1ZSA9PiB7XG4gICAgICAgICAgaWYgKHZhbHVlKSB7XG4gICAgICAgICAgICBpZiAodmFsdWUuaW5jbHVkZXMoJ1tbJykpIHtcbiAgICAgICAgICAgICAgY29uc3QgbGlua3MgPSB2YWx1ZS5tYXRjaCgvXFxbXFxbKFteXFxdXSspXFxdXFxdL2cpIHx8IFtdO1xuICAgICAgICAgICAgICB0aGlzLnByb3BlcnR5VmFsdWVzLnNldChwcm9wZXJ0eS5uYW1lLCBsaW5rcyk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICBjb25zdCBpdGVtcyA9IHZhbHVlLnNwbGl0KCcsJykubWFwKHMgPT4gcy50cmltKCkpLmZpbHRlcihzID0+IHMpO1xuICAgICAgICAgICAgICB0aGlzLnByb3BlcnR5VmFsdWVzLnNldChwcm9wZXJ0eS5uYW1lLCBpdGVtcyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMucHJvcGVydHlWYWx1ZXMuZGVsZXRlKHByb3BlcnR5Lm5hbWUpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfSk7XG4gIH1cblxuICBwcml2YXRlIGNyZWF0ZVRleHRGaWVsZChzZXR0aW5nOiBTZXR0aW5nLCBwcm9wZXJ0eTogYW55KTogdm9pZCB7XG4gICAgc2V0dGluZy5hZGRUZXh0KHRleHQgPT4ge1xuICAgICAgdGV4dC5zZXRQbGFjZWhvbGRlcignRW50ZXIgJyArIHByb3BlcnR5LmxhYmVsLnRvTG93ZXJDYXNlKCkpXG4gICAgICAgIC5vbkNoYW5nZSh2YWx1ZSA9PiB7XG4gICAgICAgICAgaWYgKHZhbHVlKSB7XG4gICAgICAgICAgICB0aGlzLnByb3BlcnR5VmFsdWVzLnNldChwcm9wZXJ0eS5uYW1lLCB2YWx1ZSk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMucHJvcGVydHlWYWx1ZXMuZGVsZXRlKHByb3BlcnR5Lm5hbWUpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfSk7XG4gIH1cblxuICBwcml2YXRlIHNldHVwQWN0aW9uQnV0dG9ucyhjb250YWluZXJFbDogSFRNTEVsZW1lbnQpOiB2b2lkIHtcbiAgICBuZXcgU2V0dGluZyhjb250YWluZXJFbClcbiAgICAgIC5hZGRCdXR0b24oYnRuID0+IGJ0blxuICAgICAgICAuc2V0QnV0dG9uVGV4dChcIkNyZWF0ZVwiKVxuICAgICAgICAuc2V0Q3RhKClcbiAgICAgICAgLm9uQ2xpY2soYXN5bmMgKCkgPT4ge1xuICAgICAgICAgIGF3YWl0IHRoaXMuY3JlYXRlQXNzZXQoKTtcbiAgICAgICAgfSkpO1xuICB9XG5cbiAgcHJpdmF0ZSBhc3luYyBjcmVhdGVBc3NldCgpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICB0cnkge1xuICAgICAgLy8gQ29udmVydCBwcm9wZXJ0eSB2YWx1ZXMgdG8gcGxhaW4gb2JqZWN0XG4gICAgICBjb25zdCBwcm9wZXJ0aWVzOiBSZWNvcmQ8c3RyaW5nLCBhbnk+ID0ge307XG4gICAgICBmb3IgKGNvbnN0IFtrZXksIHZhbHVlXSBvZiB0aGlzLnByb3BlcnR5VmFsdWVzKSB7XG4gICAgICAgIHByb3BlcnRpZXNba2V5XSA9IHZhbHVlO1xuICAgICAgfVxuICAgICAgXG4gICAgICAvLyBFeGVjdXRlIHVzZSBjYXNlXG4gICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IHRoaXMuY3JlYXRlQXNzZXRVc2VDYXNlLmV4ZWN1dGUoe1xuICAgICAgICB0aXRsZTogdGhpcy5hc3NldFRpdGxlLFxuICAgICAgICBjbGFzc05hbWU6IHRoaXMuYXNzZXRDbGFzcyxcbiAgICAgICAgb250b2xvZ3lQcmVmaXg6IHRoaXMuYXNzZXRPbnRvbG9neSxcbiAgICAgICAgcHJvcGVydGllc1xuICAgICAgfSk7XG4gICAgICBcbiAgICAgIGlmIChyZXNwb25zZS5zdWNjZXNzKSB7XG4gICAgICAgIG5ldyBOb3RpY2UocmVzcG9uc2UubWVzc2FnZSk7XG4gICAgICAgIHRoaXMuY2xvc2UoKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIG5ldyBOb3RpY2UoYEZhaWxlZCB0byBjcmVhdGUgYXNzZXRgKTtcbiAgICAgIH1cbiAgICB9IGNhdGNoIChlcnJvcjogYW55KSB7XG4gICAgICBuZXcgTm90aWNlKGBFcnJvcjogJHtlcnJvci5tZXNzYWdlfWApO1xuICAgIH1cbiAgfVxuXG4gIG9uQ2xvc2UoKSB7XG4gICAgY29uc3QgeyBjb250ZW50RWwgfSA9IHRoaXM7XG4gICAgLy8gQ2xlYXIgY29udGVudCAtIHRyeSBPYnNpZGlhbiBtZXRob2QgZmlyc3QsIGZhbGxiYWNrIHRvIERPTVxuICAgIGlmICgnZW1wdHknIGluIGNvbnRlbnRFbCAmJiB0eXBlb2YgKGNvbnRlbnRFbCBhcyBhbnkpLmVtcHR5ID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAoY29udGVudEVsIGFzIGFueSkuZW1wdHkoKTtcbiAgICB9IGVsc2Uge1xuICAgICAgLy8gRmFsbGJhY2sgdG8gc3RhbmRhcmQgRE9NIG1ldGhvZCAtIHVzZSBpbm5lckhUTUwgZm9yIGNvbXBsZXRlIGNsZWFudXBcbiAgICAgIGNvbnRlbnRFbC5pbm5lckhUTUwgPSAnJztcbiAgICB9XG4gIH1cbn0iXSwidmVyc2lvbiI6M30=