654cad80128f1217ca1ebfce144c7f3c
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.PlatformDetector = void 0;
/**
 * Platform Detector
 * Detects device capabilities and platform-specific features
 */
class PlatformDetector {
    /**
     * Get platform information with caching
     */
    static getPlatformInfo() {
        if (!this.cachedInfo) {
            this.cachedInfo = this.detectPlatform();
        }
        return this.cachedInfo;
    }
    /**
     * Check if running on mobile device
     */
    static isMobile() {
        return this.getPlatformInfo().isMobile;
    }
    /**
     * Check if running on iOS
     */
    static isIOS() {
        return this.getPlatformInfo().isIOS;
    }
    /**
     * Check if running on Android
     */
    static isAndroid() {
        return this.getPlatformInfo().isAndroid;
    }
    /**
     * Check if touch is available
     */
    static hasTouch() {
        return this.getPlatformInfo().hasTouch;
    }
    /**
     * Check if running in Obsidian mobile app
     */
    static isObsidianMobile() {
        return this.getPlatformInfo().isObsidianMobile;
    }
    /**
     * Check if running on tablet device
     */
    static isTablet() {
        return this.getPlatformInfo().isTablet;
    }
    /**
     * Check if device has limited memory
     */
    static hasLimitedMemory() {
        const info = this.getPlatformInfo();
        return info.isMobile || (info.memory !== undefined && info.memory < 4096); // < 4GB
    }
    /**
     * Check if should use mobile optimizations
     */
    static shouldUseMobileOptimizations() {
        const info = this.getPlatformInfo();
        return info.isMobile || info.isTablet || this.hasLimitedMemory();
    }
    /**
     * Get recommended batch size based on device capabilities
     */
    static getRecommendedBatchSize() {
        const info = this.getPlatformInfo();
        if (info.isMobile) {
            return 25; // Small batches for mobile
        }
        if (info.isTablet) {
            return 50; // Medium batches for tablets
        }
        if (info.memory && info.memory < 8192) {
            // < 8GB
            return 75;
        }
        return 100; // Large batches for powerful devices
    }
    /**
     * Get recommended cache size based on memory constraints
     */
    static getRecommendedCacheSize() {
        const info = this.getPlatformInfo();
        if (info.isMobile) {
            return 100; // Small cache for mobile
        }
        if (info.isTablet) {
            return 250; // Medium cache for tablets
        }
        if (info.memory && info.memory < 8192) {
            return 500;
        }
        return 1000; // Large cache for powerful devices
    }
    /**
     * Check if virtual scrolling should be enabled
     */
    static shouldUseVirtualScrolling(itemCount) {
        const info = this.getPlatformInfo();
        if (info.isMobile && itemCount > 50) {
            return true;
        }
        if (info.isTablet && itemCount > 100) {
            return true;
        }
        return itemCount > 200;
    }
    /**
     * Force refresh of platform detection
     */
    static refresh() {
        this.cachedInfo = undefined;
    }
    static detectPlatform() {
        const userAgent = navigator.userAgent.toLowerCase();
        const platform = navigator.platform?.toLowerCase() || "";
        // Detect operating system
        let os = "unknown";
        if (/iphone|ipad|ipod/.test(userAgent)) {
            os = "ios";
        }
        else if (/android/.test(userAgent)) {
            os = "android";
        }
        else if (/mac/.test(platform)) {
            os = "macos";
        }
        else if (/win/.test(platform)) {
            os = "windows";
        }
        else if (/linux/.test(platform)) {
            os = "linux";
        }
        // Detect mobile devices
        const isMobileUA = /mobile|android|iphone|ipad|phone|blackberry|opera mini|iemobile|wpdesktop/.test(userAgent);
        const isTabletUA = /tablet|ipad|playbook|silk/.test(userAgent);
        const isTouchDevice = "ontouchstart" in window ||
            navigator.maxTouchPoints > 0 ||
            navigator.msMaxTouchPoints > 0;
        // More sophisticated mobile detection
        const isSmallScreen = window.innerWidth <= 768 || window.innerHeight <= 768;
        const isIOS = /iphone|ipad|ipod/.test(userAgent);
        const isAndroid = /android/.test(userAgent);
        // Detect if running in mobile app (heuristics)
        const isObsidianMobile = this.detectObsidianMobile();
        const isMobile = isMobileUA || (isSmallScreen && isTouchDevice) || isObsidianMobile;
        const isTablet = isTabletUA && !isMobile;
        const isDesktop = !isMobile && !isTablet;
        // Get memory information if available
        let memory;
        const deviceMemory = navigator.deviceMemory; // in GB
        const performanceMemory = performance.memory?.jsHeapSizeLimit; // in bytes
        if (deviceMemory) {
            // deviceMemory is in GB, convert to MB for consistent comparison
            memory = deviceMemory * 1024;
        }
        else if (performanceMemory) {
            // performanceMemory is in bytes, convert to MB
            memory = performanceMemory / 1024 / 1024;
        }
        // Get connection information if available
        let connection;
        const connectionInfo = navigator.connection ||
            navigator.mozConnection ||
            navigator.webkitConnection;
        if (connectionInfo) {
            connection = connectionInfo.effectiveType || connectionInfo.type;
        }
        return {
            isMobile,
            isIOS,
            isAndroid,
            isTablet,
            isDesktop,
            hasTouch: isTouchDevice,
            screenWidth: window.innerWidth,
            screenHeight: window.innerHeight,
            devicePixelRatio: window.devicePixelRatio || 1,
            memory,
            connection,
            isObsidianMobile,
            os,
        };
    }
    static detectObsidianMobile() {
        // Check for Obsidian mobile app indicators
        // Check for Capacitor (which Obsidian mobile uses)
        if (window.Capacitor) {
            return true;
        }
        // Check for mobile-specific Obsidian APIs
        if (window.ObsidianMobile) {
            return true;
        }
        // Check user agent for Obsidian mobile
        const userAgent = navigator.userAgent.toLowerCase();
        if (userAgent.includes("obsidian") &&
            (userAgent.includes("mobile") ||
                userAgent.includes("ios") ||
                userAgent.includes("android"))) {
            return true;
        }
        // Check for file system access patterns typical of mobile apps
        const hasFileSystemAccess = "showOpenFilePicker" in window || "webkitRequestFileSystem" in window;
        const isMobileEnvironment = /mobile|android|iphone|ipad/.test(userAgent);
        if (!hasFileSystemAccess && isMobileEnvironment) {
            return true;
        }
        // Check for specific mobile app characteristics
        const isStandalone = window.matchMedia?.("(display-mode: standalone)")?.matches || false;
        const isFullscreen = window.matchMedia?.("(display-mode: fullscreen)")?.matches || false;
        if ((isStandalone || isFullscreen) && isMobileEnvironment) {
            return true;
        }
        return false;
    }
    /**
     * Get CSS media query for mobile detection
     */
    static getMobileMediaQuery() {
        return "(max-width: 768px), (pointer: coarse)";
    }
    /**
     * Get CSS media query for touch detection
     */
    static getTouchMediaQuery() {
        return "(pointer: coarse)";
    }
    /**
     * Check if reduced motion is preferred
     */
    static prefersReducedMotion() {
        return (window.matchMedia?.("(prefers-reduced-motion: reduce)")?.matches || false);
    }
    /**
     * Check if dark mode is preferred
     */
    static prefersDarkMode() {
        return (window.matchMedia?.("(prefers-color-scheme: dark)")?.matches || false);
    }
    /**
     * Get safe area insets (for devices with notches)
     */
    static getSafeAreaInsets() {
        const style = getComputedStyle(document.documentElement);
        return {
            top: parseInt(style.getPropertyValue("env(safe-area-inset-top)") || "0", 10),
            right: parseInt(style.getPropertyValue("env(safe-area-inset-right)") || "0", 10),
            bottom: parseInt(style.getPropertyValue("env(safe-area-inset-bottom)") || "0", 10),
            left: parseInt(style.getPropertyValue("env(safe-area-inset-left)") || "0", 10),
        };
    }
    /**
     * Create a media query listener for platform changes
     */
    static createPlatformListener(callback) {
        if (!window.matchMedia) {
            // Return no-op cleanup function if matchMedia is not available
            return () => { };
        }
        const mediaQueries = [
            window.matchMedia("(max-width: 768px)"),
            window.matchMedia("(orientation: portrait)"),
            window.matchMedia("(pointer: coarse)"),
        ];
        const handleChange = () => {
            this.refresh();
            callback(this.getPlatformInfo());
        };
        mediaQueries.forEach((mq) => mq?.addEventListener?.("change", handleChange));
        // Return cleanup function
        return () => {
            mediaQueries.forEach((mq) => mq?.removeEventListener?.("change", handleChange));
        };
    }
}
exports.PlatformDetector = PlatformDetector;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL2tpdGVsZXYvRG9jdW1lbnRzL2V4b2NvcnRleC1vYnNpZGlhbi1wbHVnaW4vc3JjL2luZnJhc3RydWN0dXJlL3V0aWxzL1BsYXRmb3JtRGV0ZWN0b3IudHMiLCJtYXBwaW5ncyI6Ijs7O0FBZ0NBOzs7R0FHRztBQUNILE1BQWEsZ0JBQWdCO0lBRzNCOztPQUVHO0lBQ0ksTUFBTSxDQUFDLGVBQWU7UUFDM0IsSUFBSSxDQUFDLElBQUksQ0FBQyxVQUFVLEVBQUU7WUFDcEIsSUFBSSxDQUFDLFVBQVUsR0FBRyxJQUFJLENBQUMsY0FBYyxFQUFFLENBQUM7U0FDekM7UUFDRCxPQUFPLElBQUksQ0FBQyxVQUFVLENBQUM7SUFDekIsQ0FBQztJQUVEOztPQUVHO0lBQ0ksTUFBTSxDQUFDLFFBQVE7UUFDcEIsT0FBTyxJQUFJLENBQUMsZUFBZSxFQUFFLENBQUMsUUFBUSxDQUFDO0lBQ3pDLENBQUM7SUFFRDs7T0FFRztJQUNJLE1BQU0sQ0FBQyxLQUFLO1FBQ2pCLE9BQU8sSUFBSSxDQUFDLGVBQWUsRUFBRSxDQUFDLEtBQUssQ0FBQztJQUN0QyxDQUFDO0lBRUQ7O09BRUc7SUFDSSxNQUFNLENBQUMsU0FBUztRQUNyQixPQUFPLElBQUksQ0FBQyxlQUFlLEVBQUUsQ0FBQyxTQUFTLENBQUM7SUFDMUMsQ0FBQztJQUVEOztPQUVHO0lBQ0ksTUFBTSxDQUFDLFFBQVE7UUFDcEIsT0FBTyxJQUFJLENBQUMsZUFBZSxFQUFFLENBQUMsUUFBUSxDQUFDO0lBQ3pDLENBQUM7SUFFRDs7T0FFRztJQUNJLE1BQU0sQ0FBQyxnQkFBZ0I7UUFDNUIsT0FBTyxJQUFJLENBQUMsZUFBZSxFQUFFLENBQUMsZ0JBQWdCLENBQUM7SUFDakQsQ0FBQztJQUVEOztPQUVHO0lBQ0ksTUFBTSxDQUFDLFFBQVE7UUFDcEIsT0FBTyxJQUFJLENBQUMsZUFBZSxFQUFFLENBQUMsUUFBUSxDQUFDO0lBQ3pDLENBQUM7SUFFRDs7T0FFRztJQUNJLE1BQU0sQ0FBQyxnQkFBZ0I7UUFDNUIsTUFBTSxJQUFJLEdBQUcsSUFBSSxDQUFDLGVBQWUsRUFBRSxDQUFDO1FBQ3BDLE9BQU8sSUFBSSxDQUFDLFFBQVEsSUFBSSxDQUFDLElBQUksQ0FBQyxNQUFNLEtBQUssU0FBUyxJQUFJLElBQUksQ0FBQyxNQUFNLEdBQUcsSUFBSSxDQUFDLENBQUMsQ0FBQyxRQUFRO0lBQ3JGLENBQUM7SUFFRDs7T0FFRztJQUNJLE1BQU0sQ0FBQyw0QkFBNEI7UUFDeEMsTUFBTSxJQUFJLEdBQUcsSUFBSSxDQUFDLGVBQWUsRUFBRSxDQUFDO1FBQ3BDLE9BQU8sSUFBSSxDQUFDLFFBQVEsSUFBSSxJQUFJLENBQUMsUUFBUSxJQUFJLElBQUksQ0FBQyxnQkFBZ0IsRUFBRSxDQUFDO0lBQ25FLENBQUM7SUFFRDs7T0FFRztJQUNJLE1BQU0sQ0FBQyx1QkFBdUI7UUFDbkMsTUFBTSxJQUFJLEdBQUcsSUFBSSxDQUFDLGVBQWUsRUFBRSxDQUFDO1FBRXBDLElBQUksSUFBSSxDQUFDLFFBQVEsRUFBRTtZQUNqQixPQUFPLEVBQUUsQ0FBQyxDQUFDLDJCQUEyQjtTQUN2QztRQUVELElBQUksSUFBSSxDQUFDLFFBQVEsRUFBRTtZQUNqQixPQUFPLEVBQUUsQ0FBQyxDQUFDLDZCQUE2QjtTQUN6QztRQUVELElBQUksSUFBSSxDQUFDLE1BQU0sSUFBSSxJQUFJLENBQUMsTUFBTSxHQUFHLElBQUksRUFBRTtZQUNyQyxRQUFRO1lBQ1IsT0FBTyxFQUFFLENBQUM7U0FDWDtRQUVELE9BQU8sR0FBRyxDQUFDLENBQUMscUNBQXFDO0lBQ25ELENBQUM7SUFFRDs7T0FFRztJQUNJLE1BQU0sQ0FBQyx1QkFBdUI7UUFDbkMsTUFBTSxJQUFJLEdBQUcsSUFBSSxDQUFDLGVBQWUsRUFBRSxDQUFDO1FBRXBDLElBQUksSUFBSSxDQUFDLFFBQVEsRUFBRTtZQUNqQixPQUFPLEdBQUcsQ0FBQyxDQUFDLHlCQUF5QjtTQUN0QztRQUVELElBQUksSUFBSSxDQUFDLFFBQVEsRUFBRTtZQUNqQixPQUFPLEdBQUcsQ0FBQyxDQUFDLDJCQUEyQjtTQUN4QztRQUVELElBQUksSUFBSSxDQUFDLE1BQU0sSUFBSSxJQUFJLENBQUMsTUFBTSxHQUFHLElBQUksRUFBRTtZQUNyQyxPQUFPLEdBQUcsQ0FBQztTQUNaO1FBRUQsT0FBTyxJQUFJLENBQUMsQ0FBQyxtQ0FBbUM7SUFDbEQsQ0FBQztJQUVEOztPQUVHO0lBQ0ksTUFBTSxDQUFDLHlCQUF5QixDQUFDLFNBQWlCO1FBQ3ZELE1BQU0sSUFBSSxHQUFHLElBQUksQ0FBQyxlQUFlLEVBQUUsQ0FBQztRQUVwQyxJQUFJLElBQUksQ0FBQyxRQUFRLElBQUksU0FBUyxHQUFHLEVBQUUsRUFBRTtZQUNuQyxPQUFPLElBQUksQ0FBQztTQUNiO1FBRUQsSUFBSSxJQUFJLENBQUMsUUFBUSxJQUFJLFNBQVMsR0FBRyxHQUFHLEVBQUU7WUFDcEMsT0FBTyxJQUFJLENBQUM7U0FDYjtRQUVELE9BQU8sU0FBUyxHQUFHLEdBQUcsQ0FBQztJQUN6QixDQUFDO0lBRUQ7O09BRUc7SUFDSSxNQUFNLENBQUMsT0FBTztRQUNuQixJQUFJLENBQUMsVUFBVSxHQUFHLFNBQVMsQ0FBQztJQUM5QixDQUFDO0lBRU8sTUFBTSxDQUFDLGNBQWM7UUFDM0IsTUFBTSxTQUFTLEdBQUcsU0FBUyxDQUFDLFNBQVMsQ0FBQyxXQUFXLEVBQUUsQ0FBQztRQUNwRCxNQUFNLFFBQVEsR0FBRyxTQUFTLENBQUMsUUFBUSxFQUFFLFdBQVcsRUFBRSxJQUFJLEVBQUUsQ0FBQztRQUV6RCwwQkFBMEI7UUFDMUIsSUFBSSxFQUFFLEdBQXVCLFNBQVMsQ0FBQztRQUN2QyxJQUFJLGtCQUFrQixDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsRUFBRTtZQUN0QyxFQUFFLEdBQUcsS0FBSyxDQUFDO1NBQ1o7YUFBTSxJQUFJLFNBQVMsQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLEVBQUU7WUFDcEMsRUFBRSxHQUFHLFNBQVMsQ0FBQztTQUNoQjthQUFNLElBQUksS0FBSyxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsRUFBRTtZQUMvQixFQUFFLEdBQUcsT0FBTyxDQUFDO1NBQ2Q7YUFBTSxJQUFJLEtBQUssQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLEVBQUU7WUFDL0IsRUFBRSxHQUFHLFNBQVMsQ0FBQztTQUNoQjthQUFNLElBQUksT0FBTyxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsRUFBRTtZQUNqQyxFQUFFLEdBQUcsT0FBTyxDQUFDO1NBQ2Q7UUFFRCx3QkFBd0I7UUFDeEIsTUFBTSxVQUFVLEdBQ2QsMkVBQTJFLENBQUMsSUFBSSxDQUM5RSxTQUFTLENBQ1YsQ0FBQztRQUNKLE1BQU0sVUFBVSxHQUFHLDJCQUEyQixDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsQ0FBQztRQUMvRCxNQUFNLGFBQWEsR0FDakIsY0FBYyxJQUFJLE1BQU07WUFDeEIsU0FBUyxDQUFDLGNBQWMsR0FBRyxDQUFDO1lBQzNCLFNBQWlCLENBQUMsZ0JBQWdCLEdBQUcsQ0FBQyxDQUFDO1FBRTFDLHNDQUFzQztRQUN0QyxNQUFNLGFBQWEsR0FBRyxNQUFNLENBQUMsVUFBVSxJQUFJLEdBQUcsSUFBSSxNQUFNLENBQUMsV0FBVyxJQUFJLEdBQUcsQ0FBQztRQUM1RSxNQUFNLEtBQUssR0FBRyxrQkFBa0IsQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLENBQUM7UUFDakQsTUFBTSxTQUFTLEdBQUcsU0FBUyxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsQ0FBQztRQUU1QywrQ0FBK0M7UUFDL0MsTUFBTSxnQkFBZ0IsR0FBRyxJQUFJLENBQUMsb0JBQW9CLEVBQUUsQ0FBQztRQUVyRCxNQUFNLFFBQVEsR0FDWixVQUFVLElBQUksQ0FBQyxhQUFhLElBQUksYUFBYSxDQUFDLElBQUksZ0JBQWdCLENBQUM7UUFDckUsTUFBTSxRQUFRLEdBQUcsVUFBVSxJQUFJLENBQUMsUUFBUSxDQUFDO1FBQ3pDLE1BQU0sU0FBUyxHQUFHLENBQUMsUUFBUSxJQUFJLENBQUMsUUFBUSxDQUFDO1FBRXpDLHNDQUFzQztRQUN0QyxJQUFJLE1BQTBCLENBQUM7UUFDL0IsTUFBTSxZQUFZLEdBQUksU0FBaUIsQ0FBQyxZQUFZLENBQUMsQ0FBQyxRQUFRO1FBQzlELE1BQU0saUJBQWlCLEdBQUksV0FBbUIsQ0FBQyxNQUFNLEVBQUUsZUFBZSxDQUFDLENBQUMsV0FBVztRQUVuRixJQUFJLFlBQVksRUFBRTtZQUNoQixpRUFBaUU7WUFDakUsTUFBTSxHQUFHLFlBQVksR0FBRyxJQUFJLENBQUM7U0FDOUI7YUFBTSxJQUFJLGlCQUFpQixFQUFFO1lBQzVCLCtDQUErQztZQUMvQyxNQUFNLEdBQUcsaUJBQWlCLEdBQUcsSUFBSSxHQUFHLElBQUksQ0FBQztTQUMxQztRQUVELDBDQUEwQztRQUMxQyxJQUFJLFVBQThCLENBQUM7UUFDbkMsTUFBTSxjQUFjLEdBQ2pCLFNBQWlCLENBQUMsVUFBVTtZQUM1QixTQUFpQixDQUFDLGFBQWE7WUFDL0IsU0FBaUIsQ0FBQyxnQkFBZ0IsQ0FBQztRQUN0QyxJQUFJLGNBQWMsRUFBRTtZQUNsQixVQUFVLEdBQUcsY0FBYyxDQUFDLGFBQWEsSUFBSSxjQUFjLENBQUMsSUFBSSxDQUFDO1NBQ2xFO1FBRUQsT0FBTztZQUNMLFFBQVE7WUFDUixLQUFLO1lBQ0wsU0FBUztZQUNULFFBQVE7WUFDUixTQUFTO1lBQ1QsUUFBUSxFQUFFLGFBQWE7WUFDdkIsV0FBVyxFQUFFLE1BQU0sQ0FBQyxVQUFVO1lBQzlCLFlBQVksRUFBRSxNQUFNLENBQUMsV0FBVztZQUNoQyxnQkFBZ0IsRUFBRSxNQUFNLENBQUMsZ0JBQWdCLElBQUksQ0FBQztZQUM5QyxNQUFNO1lBQ04sVUFBVTtZQUNWLGdCQUFnQjtZQUNoQixFQUFFO1NBQ0gsQ0FBQztJQUNKLENBQUM7SUFFTyxNQUFNLENBQUMsb0JBQW9CO1FBQ2pDLDJDQUEyQztRQUUzQyxtREFBbUQ7UUFDbkQsSUFBSyxNQUFjLENBQUMsU0FBUyxFQUFFO1lBQzdCLE9BQU8sSUFBSSxDQUFDO1NBQ2I7UUFFRCwwQ0FBMEM7UUFDMUMsSUFBSyxNQUFjLENBQUMsY0FBYyxFQUFFO1lBQ2xDLE9BQU8sSUFBSSxDQUFDO1NBQ2I7UUFFRCx1Q0FBdUM7UUFDdkMsTUFBTSxTQUFTLEdBQUcsU0FBUyxDQUFDLFNBQVMsQ0FBQyxXQUFXLEVBQUUsQ0FBQztRQUNwRCxJQUNFLFNBQVMsQ0FBQyxRQUFRLENBQUMsVUFBVSxDQUFDO1lBQzlCLENBQUMsU0FBUyxDQUFDLFFBQVEsQ0FBQyxRQUFRLENBQUM7Z0JBQzNCLFNBQVMsQ0FBQyxRQUFRLENBQUMsS0FBSyxDQUFDO2dCQUN6QixTQUFTLENBQUMsUUFBUSxDQUFDLFNBQVMsQ0FBQyxDQUFDLEVBQ2hDO1lBQ0EsT0FBTyxJQUFJLENBQUM7U0FDYjtRQUVELCtEQUErRDtRQUMvRCxNQUFNLG1CQUFtQixHQUN2QixvQkFBb0IsSUFBSSxNQUFNLElBQUkseUJBQXlCLElBQUksTUFBTSxDQUFDO1FBQ3hFLE1BQU0sbUJBQW1CLEdBQUcsNEJBQTRCLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxDQUFDO1FBRXpFLElBQUksQ0FBQyxtQkFBbUIsSUFBSSxtQkFBbUIsRUFBRTtZQUMvQyxPQUFPLElBQUksQ0FBQztTQUNiO1FBRUQsZ0RBQWdEO1FBQ2hELE1BQU0sWUFBWSxHQUNoQixNQUFNLENBQUMsVUFBVSxFQUFFLENBQUMsNEJBQTRCLENBQUMsRUFBRSxPQUFPLElBQUksS0FBSyxDQUFDO1FBQ3RFLE1BQU0sWUFBWSxHQUNoQixNQUFNLENBQUMsVUFBVSxFQUFFLENBQUMsNEJBQTRCLENBQUMsRUFBRSxPQUFPLElBQUksS0FBSyxDQUFDO1FBRXRFLElBQUksQ0FBQyxZQUFZLElBQUksWUFBWSxDQUFDLElBQUksbUJBQW1CLEVBQUU7WUFDekQsT0FBTyxJQUFJLENBQUM7U0FDYjtRQUVELE9BQU8sS0FBSyxDQUFDO0lBQ2YsQ0FBQztJQUVEOztPQUVHO0lBQ0ksTUFBTSxDQUFDLG1CQUFtQjtRQUMvQixPQUFPLHVDQUF1QyxDQUFDO0lBQ2pELENBQUM7SUFFRDs7T0FFRztJQUNJLE1BQU0sQ0FBQyxrQkFBa0I7UUFDOUIsT0FBTyxtQkFBbUIsQ0FBQztJQUM3QixDQUFDO0lBRUQ7O09BRUc7SUFDSSxNQUFNLENBQUMsb0JBQW9CO1FBQ2hDLE9BQU8sQ0FDTCxNQUFNLENBQUMsVUFBVSxFQUFFLENBQUMsa0NBQWtDLENBQUMsRUFBRSxPQUFPLElBQUksS0FBSyxDQUMxRSxDQUFDO0lBQ0osQ0FBQztJQUVEOztPQUVHO0lBQ0ksTUFBTSxDQUFDLGVBQWU7UUFDM0IsT0FBTyxDQUNMLE1BQU0sQ0FBQyxVQUFVLEVBQUUsQ0FBQyw4QkFBOEIsQ0FBQyxFQUFFLE9BQU8sSUFBSSxLQUFLLENBQ3RFLENBQUM7SUFDSixDQUFDO0lBRUQ7O09BRUc7SUFDSSxNQUFNLENBQUMsaUJBQWlCO1FBTTdCLE1BQU0sS0FBSyxHQUFHLGdCQUFnQixDQUFDLFFBQVEsQ0FBQyxlQUFlLENBQUMsQ0FBQztRQUV6RCxPQUFPO1lBQ0wsR0FBRyxFQUFFLFFBQVEsQ0FDWCxLQUFLLENBQUMsZ0JBQWdCLENBQUMsMEJBQTBCLENBQUMsSUFBSSxHQUFHLEVBQ3pELEVBQUUsQ0FDSDtZQUNELEtBQUssRUFBRSxRQUFRLENBQ2IsS0FBSyxDQUFDLGdCQUFnQixDQUFDLDRCQUE0QixDQUFDLElBQUksR0FBRyxFQUMzRCxFQUFFLENBQ0g7WUFDRCxNQUFNLEVBQUUsUUFBUSxDQUNkLEtBQUssQ0FBQyxnQkFBZ0IsQ0FBQyw2QkFBNkIsQ0FBQyxJQUFJLEdBQUcsRUFDNUQsRUFBRSxDQUNIO1lBQ0QsSUFBSSxFQUFFLFFBQVEsQ0FDWixLQUFLLENBQUMsZ0JBQWdCLENBQUMsMkJBQTJCLENBQUMsSUFBSSxHQUFHLEVBQzFELEVBQUUsQ0FDSDtTQUNGLENBQUM7SUFDSixDQUFDO0lBRUQ7O09BRUc7SUFDSSxNQUFNLENBQUMsc0JBQXNCLENBQ2xDLFFBQXNDO1FBRXRDLElBQUksQ0FBQyxNQUFNLENBQUMsVUFBVSxFQUFFO1lBQ3RCLCtEQUErRDtZQUMvRCxPQUFPLEdBQUcsRUFBRSxHQUFFLENBQUMsQ0FBQztTQUNqQjtRQUVELE1BQU0sWUFBWSxHQUFHO1lBQ25CLE1BQU0sQ0FBQyxVQUFVLENBQUMsb0JBQW9CLENBQUM7WUFDdkMsTUFBTSxDQUFDLFVBQVUsQ0FBQyx5QkFBeUIsQ0FBQztZQUM1QyxNQUFNLENBQUMsVUFBVSxDQUFDLG1CQUFtQixDQUFDO1NBQ3ZDLENBQUM7UUFFRixNQUFNLFlBQVksR0FBRyxHQUFHLEVBQUU7WUFDeEIsSUFBSSxDQUFDLE9BQU8sRUFBRSxDQUFDO1lBQ2YsUUFBUSxDQUFDLElBQUksQ0FBQyxlQUFlLEVBQUUsQ0FBQyxDQUFDO1FBQ25DLENBQUMsQ0FBQztRQUVGLFlBQVksQ0FBQyxPQUFPLENBQUMsQ0FBQyxFQUFFLEVBQUUsRUFBRSxDQUMxQixFQUFFLEVBQUUsZ0JBQWdCLEVBQUUsQ0FBQyxRQUFRLEVBQUUsWUFBWSxDQUFDLENBQy9DLENBQUM7UUFFRiwwQkFBMEI7UUFDMUIsT0FBTyxHQUFHLEVBQUU7WUFDVixZQUFZLENBQUMsT0FBTyxDQUFDLENBQUMsRUFBRSxFQUFFLEVBQUUsQ0FDMUIsRUFBRSxFQUFFLG1CQUFtQixFQUFFLENBQUMsUUFBUSxFQUFFLFlBQVksQ0FBQyxDQUNsRCxDQUFDO1FBQ0osQ0FBQyxDQUFDO0lBQ0osQ0FBQztDQUNGO0FBMVdELDRDQTBXQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyIvVXNlcnMva2l0ZWxldi9Eb2N1bWVudHMvZXhvY29ydGV4LW9ic2lkaWFuLXBsdWdpbi9zcmMvaW5mcmFzdHJ1Y3R1cmUvdXRpbHMvUGxhdGZvcm1EZXRlY3Rvci50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIFBsYXRmb3JtIEluZm9ybWF0aW9uXG4gKi9cbmV4cG9ydCBpbnRlcmZhY2UgUGxhdGZvcm1JbmZvIHtcbiAgLyoqIElzIHJ1bm5pbmcgb24gbW9iaWxlIGRldmljZSAqL1xuICBpc01vYmlsZTogYm9vbGVhbjtcbiAgLyoqIElzIHJ1bm5pbmcgb24gaU9TICovXG4gIGlzSU9TOiBib29sZWFuO1xuICAvKiogSXMgcnVubmluZyBvbiBBbmRyb2lkICovXG4gIGlzQW5kcm9pZDogYm9vbGVhbjtcbiAgLyoqIElzIHJ1bm5pbmcgb24gdGFibGV0ICovXG4gIGlzVGFibGV0OiBib29sZWFuO1xuICAvKiogSXMgcnVubmluZyBvbiBkZXNrdG9wICovXG4gIGlzRGVza3RvcDogYm9vbGVhbjtcbiAgLyoqIElzIHRvdWNoLWVuYWJsZWQgZGV2aWNlICovXG4gIGhhc1RvdWNoOiBib29sZWFuO1xuICAvKiogU2NyZWVuIHdpZHRoIGluIHBpeGVscyAqL1xuICBzY3JlZW5XaWR0aDogbnVtYmVyO1xuICAvKiogU2NyZWVuIGhlaWdodCBpbiBwaXhlbHMgKi9cbiAgc2NyZWVuSGVpZ2h0OiBudW1iZXI7XG4gIC8qKiBEZXZpY2UgcGl4ZWwgcmF0aW8gKi9cbiAgZGV2aWNlUGl4ZWxSYXRpbzogbnVtYmVyO1xuICAvKiogQXZhaWxhYmxlIG1lbW9yeSAoaWYgc3VwcG9ydGVkKSAqL1xuICBtZW1vcnk/OiBudW1iZXI7XG4gIC8qKiBDb25uZWN0aW9uIHR5cGUgKGlmIHN1cHBvcnRlZCkgKi9cbiAgY29ubmVjdGlvbj86IHN0cmluZztcbiAgLyoqIElzIHJ1bm5pbmcgaW4gT2JzaWRpYW4gbW9iaWxlIGFwcCAqL1xuICBpc09ic2lkaWFuTW9iaWxlOiBib29sZWFuO1xuICAvKiogT3BlcmF0aW5nIHN5c3RlbSAqL1xuICBvczogXCJpb3NcIiB8IFwiYW5kcm9pZFwiIHwgXCJtYWNvc1wiIHwgXCJ3aW5kb3dzXCIgfCBcImxpbnV4XCIgfCBcInVua25vd25cIjtcbn1cblxuLyoqXG4gKiBQbGF0Zm9ybSBEZXRlY3RvclxuICogRGV0ZWN0cyBkZXZpY2UgY2FwYWJpbGl0aWVzIGFuZCBwbGF0Zm9ybS1zcGVjaWZpYyBmZWF0dXJlc1xuICovXG5leHBvcnQgY2xhc3MgUGxhdGZvcm1EZXRlY3RvciB7XG4gIHByaXZhdGUgc3RhdGljIGNhY2hlZEluZm8/OiBQbGF0Zm9ybUluZm87XG5cbiAgLyoqXG4gICAqIEdldCBwbGF0Zm9ybSBpbmZvcm1hdGlvbiB3aXRoIGNhY2hpbmdcbiAgICovXG4gIHB1YmxpYyBzdGF0aWMgZ2V0UGxhdGZvcm1JbmZvKCk6IFBsYXRmb3JtSW5mbyB7XG4gICAgaWYgKCF0aGlzLmNhY2hlZEluZm8pIHtcbiAgICAgIHRoaXMuY2FjaGVkSW5mbyA9IHRoaXMuZGV0ZWN0UGxhdGZvcm0oKTtcbiAgICB9XG4gICAgcmV0dXJuIHRoaXMuY2FjaGVkSW5mbztcbiAgfVxuXG4gIC8qKlxuICAgKiBDaGVjayBpZiBydW5uaW5nIG9uIG1vYmlsZSBkZXZpY2VcbiAgICovXG4gIHB1YmxpYyBzdGF0aWMgaXNNb2JpbGUoKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIHRoaXMuZ2V0UGxhdGZvcm1JbmZvKCkuaXNNb2JpbGU7XG4gIH1cblxuICAvKipcbiAgICogQ2hlY2sgaWYgcnVubmluZyBvbiBpT1NcbiAgICovXG4gIHB1YmxpYyBzdGF0aWMgaXNJT1MoKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIHRoaXMuZ2V0UGxhdGZvcm1JbmZvKCkuaXNJT1M7XG4gIH1cblxuICAvKipcbiAgICogQ2hlY2sgaWYgcnVubmluZyBvbiBBbmRyb2lkXG4gICAqL1xuICBwdWJsaWMgc3RhdGljIGlzQW5kcm9pZCgpOiBib29sZWFuIHtcbiAgICByZXR1cm4gdGhpcy5nZXRQbGF0Zm9ybUluZm8oKS5pc0FuZHJvaWQ7XG4gIH1cblxuICAvKipcbiAgICogQ2hlY2sgaWYgdG91Y2ggaXMgYXZhaWxhYmxlXG4gICAqL1xuICBwdWJsaWMgc3RhdGljIGhhc1RvdWNoKCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiB0aGlzLmdldFBsYXRmb3JtSW5mbygpLmhhc1RvdWNoO1xuICB9XG5cbiAgLyoqXG4gICAqIENoZWNrIGlmIHJ1bm5pbmcgaW4gT2JzaWRpYW4gbW9iaWxlIGFwcFxuICAgKi9cbiAgcHVibGljIHN0YXRpYyBpc09ic2lkaWFuTW9iaWxlKCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiB0aGlzLmdldFBsYXRmb3JtSW5mbygpLmlzT2JzaWRpYW5Nb2JpbGU7XG4gIH1cblxuICAvKipcbiAgICogQ2hlY2sgaWYgcnVubmluZyBvbiB0YWJsZXQgZGV2aWNlXG4gICAqL1xuICBwdWJsaWMgc3RhdGljIGlzVGFibGV0KCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiB0aGlzLmdldFBsYXRmb3JtSW5mbygpLmlzVGFibGV0O1xuICB9XG5cbiAgLyoqXG4gICAqIENoZWNrIGlmIGRldmljZSBoYXMgbGltaXRlZCBtZW1vcnlcbiAgICovXG4gIHB1YmxpYyBzdGF0aWMgaGFzTGltaXRlZE1lbW9yeSgpOiBib29sZWFuIHtcbiAgICBjb25zdCBpbmZvID0gdGhpcy5nZXRQbGF0Zm9ybUluZm8oKTtcbiAgICByZXR1cm4gaW5mby5pc01vYmlsZSB8fCAoaW5mby5tZW1vcnkgIT09IHVuZGVmaW5lZCAmJiBpbmZvLm1lbW9yeSA8IDQwOTYpOyAvLyA8IDRHQlxuICB9XG5cbiAgLyoqXG4gICAqIENoZWNrIGlmIHNob3VsZCB1c2UgbW9iaWxlIG9wdGltaXphdGlvbnNcbiAgICovXG4gIHB1YmxpYyBzdGF0aWMgc2hvdWxkVXNlTW9iaWxlT3B0aW1pemF0aW9ucygpOiBib29sZWFuIHtcbiAgICBjb25zdCBpbmZvID0gdGhpcy5nZXRQbGF0Zm9ybUluZm8oKTtcbiAgICByZXR1cm4gaW5mby5pc01vYmlsZSB8fCBpbmZvLmlzVGFibGV0IHx8IHRoaXMuaGFzTGltaXRlZE1lbW9yeSgpO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldCByZWNvbW1lbmRlZCBiYXRjaCBzaXplIGJhc2VkIG9uIGRldmljZSBjYXBhYmlsaXRpZXNcbiAgICovXG4gIHB1YmxpYyBzdGF0aWMgZ2V0UmVjb21tZW5kZWRCYXRjaFNpemUoKTogbnVtYmVyIHtcbiAgICBjb25zdCBpbmZvID0gdGhpcy5nZXRQbGF0Zm9ybUluZm8oKTtcblxuICAgIGlmIChpbmZvLmlzTW9iaWxlKSB7XG4gICAgICByZXR1cm4gMjU7IC8vIFNtYWxsIGJhdGNoZXMgZm9yIG1vYmlsZVxuICAgIH1cblxuICAgIGlmIChpbmZvLmlzVGFibGV0KSB7XG4gICAgICByZXR1cm4gNTA7IC8vIE1lZGl1bSBiYXRjaGVzIGZvciB0YWJsZXRzXG4gICAgfVxuXG4gICAgaWYgKGluZm8ubWVtb3J5ICYmIGluZm8ubWVtb3J5IDwgODE5Mikge1xuICAgICAgLy8gPCA4R0JcbiAgICAgIHJldHVybiA3NTtcbiAgICB9XG5cbiAgICByZXR1cm4gMTAwOyAvLyBMYXJnZSBiYXRjaGVzIGZvciBwb3dlcmZ1bCBkZXZpY2VzXG4gIH1cblxuICAvKipcbiAgICogR2V0IHJlY29tbWVuZGVkIGNhY2hlIHNpemUgYmFzZWQgb24gbWVtb3J5IGNvbnN0cmFpbnRzXG4gICAqL1xuICBwdWJsaWMgc3RhdGljIGdldFJlY29tbWVuZGVkQ2FjaGVTaXplKCk6IG51bWJlciB7XG4gICAgY29uc3QgaW5mbyA9IHRoaXMuZ2V0UGxhdGZvcm1JbmZvKCk7XG5cbiAgICBpZiAoaW5mby5pc01vYmlsZSkge1xuICAgICAgcmV0dXJuIDEwMDsgLy8gU21hbGwgY2FjaGUgZm9yIG1vYmlsZVxuICAgIH1cblxuICAgIGlmIChpbmZvLmlzVGFibGV0KSB7XG4gICAgICByZXR1cm4gMjUwOyAvLyBNZWRpdW0gY2FjaGUgZm9yIHRhYmxldHNcbiAgICB9XG5cbiAgICBpZiAoaW5mby5tZW1vcnkgJiYgaW5mby5tZW1vcnkgPCA4MTkyKSB7XG4gICAgICByZXR1cm4gNTAwO1xuICAgIH1cblxuICAgIHJldHVybiAxMDAwOyAvLyBMYXJnZSBjYWNoZSBmb3IgcG93ZXJmdWwgZGV2aWNlc1xuICB9XG5cbiAgLyoqXG4gICAqIENoZWNrIGlmIHZpcnR1YWwgc2Nyb2xsaW5nIHNob3VsZCBiZSBlbmFibGVkXG4gICAqL1xuICBwdWJsaWMgc3RhdGljIHNob3VsZFVzZVZpcnR1YWxTY3JvbGxpbmcoaXRlbUNvdW50OiBudW1iZXIpOiBib29sZWFuIHtcbiAgICBjb25zdCBpbmZvID0gdGhpcy5nZXRQbGF0Zm9ybUluZm8oKTtcblxuICAgIGlmIChpbmZvLmlzTW9iaWxlICYmIGl0ZW1Db3VudCA+IDUwKSB7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG5cbiAgICBpZiAoaW5mby5pc1RhYmxldCAmJiBpdGVtQ291bnQgPiAxMDApIHtcbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cblxuICAgIHJldHVybiBpdGVtQ291bnQgPiAyMDA7XG4gIH1cblxuICAvKipcbiAgICogRm9yY2UgcmVmcmVzaCBvZiBwbGF0Zm9ybSBkZXRlY3Rpb25cbiAgICovXG4gIHB1YmxpYyBzdGF0aWMgcmVmcmVzaCgpOiB2b2lkIHtcbiAgICB0aGlzLmNhY2hlZEluZm8gPSB1bmRlZmluZWQ7XG4gIH1cblxuICBwcml2YXRlIHN0YXRpYyBkZXRlY3RQbGF0Zm9ybSgpOiBQbGF0Zm9ybUluZm8ge1xuICAgIGNvbnN0IHVzZXJBZ2VudCA9IG5hdmlnYXRvci51c2VyQWdlbnQudG9Mb3dlckNhc2UoKTtcbiAgICBjb25zdCBwbGF0Zm9ybSA9IG5hdmlnYXRvci5wbGF0Zm9ybT8udG9Mb3dlckNhc2UoKSB8fCBcIlwiO1xuXG4gICAgLy8gRGV0ZWN0IG9wZXJhdGluZyBzeXN0ZW1cbiAgICBsZXQgb3M6IFBsYXRmb3JtSW5mb1tcIm9zXCJdID0gXCJ1bmtub3duXCI7XG4gICAgaWYgKC9pcGhvbmV8aXBhZHxpcG9kLy50ZXN0KHVzZXJBZ2VudCkpIHtcbiAgICAgIG9zID0gXCJpb3NcIjtcbiAgICB9IGVsc2UgaWYgKC9hbmRyb2lkLy50ZXN0KHVzZXJBZ2VudCkpIHtcbiAgICAgIG9zID0gXCJhbmRyb2lkXCI7XG4gICAgfSBlbHNlIGlmICgvbWFjLy50ZXN0KHBsYXRmb3JtKSkge1xuICAgICAgb3MgPSBcIm1hY29zXCI7XG4gICAgfSBlbHNlIGlmICgvd2luLy50ZXN0KHBsYXRmb3JtKSkge1xuICAgICAgb3MgPSBcIndpbmRvd3NcIjtcbiAgICB9IGVsc2UgaWYgKC9saW51eC8udGVzdChwbGF0Zm9ybSkpIHtcbiAgICAgIG9zID0gXCJsaW51eFwiO1xuICAgIH1cblxuICAgIC8vIERldGVjdCBtb2JpbGUgZGV2aWNlc1xuICAgIGNvbnN0IGlzTW9iaWxlVUEgPVxuICAgICAgL21vYmlsZXxhbmRyb2lkfGlwaG9uZXxpcGFkfHBob25lfGJsYWNrYmVycnl8b3BlcmEgbWluaXxpZW1vYmlsZXx3cGRlc2t0b3AvLnRlc3QoXG4gICAgICAgIHVzZXJBZ2VudCxcbiAgICAgICk7XG4gICAgY29uc3QgaXNUYWJsZXRVQSA9IC90YWJsZXR8aXBhZHxwbGF5Ym9va3xzaWxrLy50ZXN0KHVzZXJBZ2VudCk7XG4gICAgY29uc3QgaXNUb3VjaERldmljZSA9XG4gICAgICBcIm9udG91Y2hzdGFydFwiIGluIHdpbmRvdyB8fFxuICAgICAgbmF2aWdhdG9yLm1heFRvdWNoUG9pbnRzID4gMCB8fFxuICAgICAgKG5hdmlnYXRvciBhcyBhbnkpLm1zTWF4VG91Y2hQb2ludHMgPiAwO1xuXG4gICAgLy8gTW9yZSBzb3BoaXN0aWNhdGVkIG1vYmlsZSBkZXRlY3Rpb25cbiAgICBjb25zdCBpc1NtYWxsU2NyZWVuID0gd2luZG93LmlubmVyV2lkdGggPD0gNzY4IHx8IHdpbmRvdy5pbm5lckhlaWdodCA8PSA3Njg7XG4gICAgY29uc3QgaXNJT1MgPSAvaXBob25lfGlwYWR8aXBvZC8udGVzdCh1c2VyQWdlbnQpO1xuICAgIGNvbnN0IGlzQW5kcm9pZCA9IC9hbmRyb2lkLy50ZXN0KHVzZXJBZ2VudCk7XG5cbiAgICAvLyBEZXRlY3QgaWYgcnVubmluZyBpbiBtb2JpbGUgYXBwIChoZXVyaXN0aWNzKVxuICAgIGNvbnN0IGlzT2JzaWRpYW5Nb2JpbGUgPSB0aGlzLmRldGVjdE9ic2lkaWFuTW9iaWxlKCk7XG5cbiAgICBjb25zdCBpc01vYmlsZSA9XG4gICAgICBpc01vYmlsZVVBIHx8IChpc1NtYWxsU2NyZWVuICYmIGlzVG91Y2hEZXZpY2UpIHx8IGlzT2JzaWRpYW5Nb2JpbGU7XG4gICAgY29uc3QgaXNUYWJsZXQgPSBpc1RhYmxldFVBICYmICFpc01vYmlsZTtcbiAgICBjb25zdCBpc0Rlc2t0b3AgPSAhaXNNb2JpbGUgJiYgIWlzVGFibGV0O1xuXG4gICAgLy8gR2V0IG1lbW9yeSBpbmZvcm1hdGlvbiBpZiBhdmFpbGFibGVcbiAgICBsZXQgbWVtb3J5OiBudW1iZXIgfCB1bmRlZmluZWQ7XG4gICAgY29uc3QgZGV2aWNlTWVtb3J5ID0gKG5hdmlnYXRvciBhcyBhbnkpLmRldmljZU1lbW9yeTsgLy8gaW4gR0JcbiAgICBjb25zdCBwZXJmb3JtYW5jZU1lbW9yeSA9IChwZXJmb3JtYW5jZSBhcyBhbnkpLm1lbW9yeT8uanNIZWFwU2l6ZUxpbWl0OyAvLyBpbiBieXRlc1xuXG4gICAgaWYgKGRldmljZU1lbW9yeSkge1xuICAgICAgLy8gZGV2aWNlTWVtb3J5IGlzIGluIEdCLCBjb252ZXJ0IHRvIE1CIGZvciBjb25zaXN0ZW50IGNvbXBhcmlzb25cbiAgICAgIG1lbW9yeSA9IGRldmljZU1lbW9yeSAqIDEwMjQ7XG4gICAgfSBlbHNlIGlmIChwZXJmb3JtYW5jZU1lbW9yeSkge1xuICAgICAgLy8gcGVyZm9ybWFuY2VNZW1vcnkgaXMgaW4gYnl0ZXMsIGNvbnZlcnQgdG8gTUJcbiAgICAgIG1lbW9yeSA9IHBlcmZvcm1hbmNlTWVtb3J5IC8gMTAyNCAvIDEwMjQ7XG4gICAgfVxuXG4gICAgLy8gR2V0IGNvbm5lY3Rpb24gaW5mb3JtYXRpb24gaWYgYXZhaWxhYmxlXG4gICAgbGV0IGNvbm5lY3Rpb246IHN0cmluZyB8IHVuZGVmaW5lZDtcbiAgICBjb25zdCBjb25uZWN0aW9uSW5mbyA9XG4gICAgICAobmF2aWdhdG9yIGFzIGFueSkuY29ubmVjdGlvbiB8fFxuICAgICAgKG5hdmlnYXRvciBhcyBhbnkpLm1vekNvbm5lY3Rpb24gfHxcbiAgICAgIChuYXZpZ2F0b3IgYXMgYW55KS53ZWJraXRDb25uZWN0aW9uO1xuICAgIGlmIChjb25uZWN0aW9uSW5mbykge1xuICAgICAgY29ubmVjdGlvbiA9IGNvbm5lY3Rpb25JbmZvLmVmZmVjdGl2ZVR5cGUgfHwgY29ubmVjdGlvbkluZm8udHlwZTtcbiAgICB9XG5cbiAgICByZXR1cm4ge1xuICAgICAgaXNNb2JpbGUsXG4gICAgICBpc0lPUyxcbiAgICAgIGlzQW5kcm9pZCxcbiAgICAgIGlzVGFibGV0LFxuICAgICAgaXNEZXNrdG9wLFxuICAgICAgaGFzVG91Y2g6IGlzVG91Y2hEZXZpY2UsXG4gICAgICBzY3JlZW5XaWR0aDogd2luZG93LmlubmVyV2lkdGgsXG4gICAgICBzY3JlZW5IZWlnaHQ6IHdpbmRvdy5pbm5lckhlaWdodCxcbiAgICAgIGRldmljZVBpeGVsUmF0aW86IHdpbmRvdy5kZXZpY2VQaXhlbFJhdGlvIHx8IDEsXG4gICAgICBtZW1vcnksXG4gICAgICBjb25uZWN0aW9uLFxuICAgICAgaXNPYnNpZGlhbk1vYmlsZSxcbiAgICAgIG9zLFxuICAgIH07XG4gIH1cblxuICBwcml2YXRlIHN0YXRpYyBkZXRlY3RPYnNpZGlhbk1vYmlsZSgpOiBib29sZWFuIHtcbiAgICAvLyBDaGVjayBmb3IgT2JzaWRpYW4gbW9iaWxlIGFwcCBpbmRpY2F0b3JzXG5cbiAgICAvLyBDaGVjayBmb3IgQ2FwYWNpdG9yICh3aGljaCBPYnNpZGlhbiBtb2JpbGUgdXNlcylcbiAgICBpZiAoKHdpbmRvdyBhcyBhbnkpLkNhcGFjaXRvcikge1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuXG4gICAgLy8gQ2hlY2sgZm9yIG1vYmlsZS1zcGVjaWZpYyBPYnNpZGlhbiBBUElzXG4gICAgaWYgKCh3aW5kb3cgYXMgYW55KS5PYnNpZGlhbk1vYmlsZSkge1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuXG4gICAgLy8gQ2hlY2sgdXNlciBhZ2VudCBmb3IgT2JzaWRpYW4gbW9iaWxlXG4gICAgY29uc3QgdXNlckFnZW50ID0gbmF2aWdhdG9yLnVzZXJBZ2VudC50b0xvd2VyQ2FzZSgpO1xuICAgIGlmIChcbiAgICAgIHVzZXJBZ2VudC5pbmNsdWRlcyhcIm9ic2lkaWFuXCIpICYmXG4gICAgICAodXNlckFnZW50LmluY2x1ZGVzKFwibW9iaWxlXCIpIHx8XG4gICAgICAgIHVzZXJBZ2VudC5pbmNsdWRlcyhcImlvc1wiKSB8fFxuICAgICAgICB1c2VyQWdlbnQuaW5jbHVkZXMoXCJhbmRyb2lkXCIpKVxuICAgICkge1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuXG4gICAgLy8gQ2hlY2sgZm9yIGZpbGUgc3lzdGVtIGFjY2VzcyBwYXR0ZXJucyB0eXBpY2FsIG9mIG1vYmlsZSBhcHBzXG4gICAgY29uc3QgaGFzRmlsZVN5c3RlbUFjY2VzcyA9XG4gICAgICBcInNob3dPcGVuRmlsZVBpY2tlclwiIGluIHdpbmRvdyB8fCBcIndlYmtpdFJlcXVlc3RGaWxlU3lzdGVtXCIgaW4gd2luZG93O1xuICAgIGNvbnN0IGlzTW9iaWxlRW52aXJvbm1lbnQgPSAvbW9iaWxlfGFuZHJvaWR8aXBob25lfGlwYWQvLnRlc3QodXNlckFnZW50KTtcblxuICAgIGlmICghaGFzRmlsZVN5c3RlbUFjY2VzcyAmJiBpc01vYmlsZUVudmlyb25tZW50KSB7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG5cbiAgICAvLyBDaGVjayBmb3Igc3BlY2lmaWMgbW9iaWxlIGFwcCBjaGFyYWN0ZXJpc3RpY3NcbiAgICBjb25zdCBpc1N0YW5kYWxvbmUgPVxuICAgICAgd2luZG93Lm1hdGNoTWVkaWE/LihcIihkaXNwbGF5LW1vZGU6IHN0YW5kYWxvbmUpXCIpPy5tYXRjaGVzIHx8IGZhbHNlO1xuICAgIGNvbnN0IGlzRnVsbHNjcmVlbiA9XG4gICAgICB3aW5kb3cubWF0Y2hNZWRpYT8uKFwiKGRpc3BsYXktbW9kZTogZnVsbHNjcmVlbilcIik/Lm1hdGNoZXMgfHwgZmFsc2U7XG5cbiAgICBpZiAoKGlzU3RhbmRhbG9uZSB8fCBpc0Z1bGxzY3JlZW4pICYmIGlzTW9iaWxlRW52aXJvbm1lbnQpIHtcbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cblxuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgQ1NTIG1lZGlhIHF1ZXJ5IGZvciBtb2JpbGUgZGV0ZWN0aW9uXG4gICAqL1xuICBwdWJsaWMgc3RhdGljIGdldE1vYmlsZU1lZGlhUXVlcnkoKTogc3RyaW5nIHtcbiAgICByZXR1cm4gXCIobWF4LXdpZHRoOiA3NjhweCksIChwb2ludGVyOiBjb2Fyc2UpXCI7XG4gIH1cblxuICAvKipcbiAgICogR2V0IENTUyBtZWRpYSBxdWVyeSBmb3IgdG91Y2ggZGV0ZWN0aW9uXG4gICAqL1xuICBwdWJsaWMgc3RhdGljIGdldFRvdWNoTWVkaWFRdWVyeSgpOiBzdHJpbmcge1xuICAgIHJldHVybiBcIihwb2ludGVyOiBjb2Fyc2UpXCI7XG4gIH1cblxuICAvKipcbiAgICogQ2hlY2sgaWYgcmVkdWNlZCBtb3Rpb24gaXMgcHJlZmVycmVkXG4gICAqL1xuICBwdWJsaWMgc3RhdGljIHByZWZlcnNSZWR1Y2VkTW90aW9uKCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiAoXG4gICAgICB3aW5kb3cubWF0Y2hNZWRpYT8uKFwiKHByZWZlcnMtcmVkdWNlZC1tb3Rpb246IHJlZHVjZSlcIik/Lm1hdGNoZXMgfHwgZmFsc2VcbiAgICApO1xuICB9XG5cbiAgLyoqXG4gICAqIENoZWNrIGlmIGRhcmsgbW9kZSBpcyBwcmVmZXJyZWRcbiAgICovXG4gIHB1YmxpYyBzdGF0aWMgcHJlZmVyc0RhcmtNb2RlKCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiAoXG4gICAgICB3aW5kb3cubWF0Y2hNZWRpYT8uKFwiKHByZWZlcnMtY29sb3Itc2NoZW1lOiBkYXJrKVwiKT8ubWF0Y2hlcyB8fCBmYWxzZVxuICAgICk7XG4gIH1cblxuICAvKipcbiAgICogR2V0IHNhZmUgYXJlYSBpbnNldHMgKGZvciBkZXZpY2VzIHdpdGggbm90Y2hlcylcbiAgICovXG4gIHB1YmxpYyBzdGF0aWMgZ2V0U2FmZUFyZWFJbnNldHMoKToge1xuICAgIHRvcDogbnVtYmVyO1xuICAgIHJpZ2h0OiBudW1iZXI7XG4gICAgYm90dG9tOiBudW1iZXI7XG4gICAgbGVmdDogbnVtYmVyO1xuICB9IHtcbiAgICBjb25zdCBzdHlsZSA9IGdldENvbXB1dGVkU3R5bGUoZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50KTtcblxuICAgIHJldHVybiB7XG4gICAgICB0b3A6IHBhcnNlSW50KFxuICAgICAgICBzdHlsZS5nZXRQcm9wZXJ0eVZhbHVlKFwiZW52KHNhZmUtYXJlYS1pbnNldC10b3ApXCIpIHx8IFwiMFwiLFxuICAgICAgICAxMCxcbiAgICAgICksXG4gICAgICByaWdodDogcGFyc2VJbnQoXG4gICAgICAgIHN0eWxlLmdldFByb3BlcnR5VmFsdWUoXCJlbnYoc2FmZS1hcmVhLWluc2V0LXJpZ2h0KVwiKSB8fCBcIjBcIixcbiAgICAgICAgMTAsXG4gICAgICApLFxuICAgICAgYm90dG9tOiBwYXJzZUludChcbiAgICAgICAgc3R5bGUuZ2V0UHJvcGVydHlWYWx1ZShcImVudihzYWZlLWFyZWEtaW5zZXQtYm90dG9tKVwiKSB8fCBcIjBcIixcbiAgICAgICAgMTAsXG4gICAgICApLFxuICAgICAgbGVmdDogcGFyc2VJbnQoXG4gICAgICAgIHN0eWxlLmdldFByb3BlcnR5VmFsdWUoXCJlbnYoc2FmZS1hcmVhLWluc2V0LWxlZnQpXCIpIHx8IFwiMFwiLFxuICAgICAgICAxMCxcbiAgICAgICksXG4gICAgfTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDcmVhdGUgYSBtZWRpYSBxdWVyeSBsaXN0ZW5lciBmb3IgcGxhdGZvcm0gY2hhbmdlc1xuICAgKi9cbiAgcHVibGljIHN0YXRpYyBjcmVhdGVQbGF0Zm9ybUxpc3RlbmVyKFxuICAgIGNhbGxiYWNrOiAoaW5mbzogUGxhdGZvcm1JbmZvKSA9PiB2b2lkLFxuICApOiAoKSA9PiB2b2lkIHtcbiAgICBpZiAoIXdpbmRvdy5tYXRjaE1lZGlhKSB7XG4gICAgICAvLyBSZXR1cm4gbm8tb3AgY2xlYW51cCBmdW5jdGlvbiBpZiBtYXRjaE1lZGlhIGlzIG5vdCBhdmFpbGFibGVcbiAgICAgIHJldHVybiAoKSA9PiB7fTtcbiAgICB9XG5cbiAgICBjb25zdCBtZWRpYVF1ZXJpZXMgPSBbXG4gICAgICB3aW5kb3cubWF0Y2hNZWRpYShcIihtYXgtd2lkdGg6IDc2OHB4KVwiKSxcbiAgICAgIHdpbmRvdy5tYXRjaE1lZGlhKFwiKG9yaWVudGF0aW9uOiBwb3J0cmFpdClcIiksXG4gICAgICB3aW5kb3cubWF0Y2hNZWRpYShcIihwb2ludGVyOiBjb2Fyc2UpXCIpLFxuICAgIF07XG5cbiAgICBjb25zdCBoYW5kbGVDaGFuZ2UgPSAoKSA9PiB7XG4gICAgICB0aGlzLnJlZnJlc2goKTtcbiAgICAgIGNhbGxiYWNrKHRoaXMuZ2V0UGxhdGZvcm1JbmZvKCkpO1xuICAgIH07XG5cbiAgICBtZWRpYVF1ZXJpZXMuZm9yRWFjaCgobXEpID0+XG4gICAgICBtcT8uYWRkRXZlbnRMaXN0ZW5lcj8uKFwiY2hhbmdlXCIsIGhhbmRsZUNoYW5nZSksXG4gICAgKTtcblxuICAgIC8vIFJldHVybiBjbGVhbnVwIGZ1bmN0aW9uXG4gICAgcmV0dXJuICgpID0+IHtcbiAgICAgIG1lZGlhUXVlcmllcy5mb3JFYWNoKChtcSkgPT5cbiAgICAgICAgbXE/LnJlbW92ZUV2ZW50TGlzdGVuZXI/LihcImNoYW5nZVwiLCBoYW5kbGVDaGFuZ2UpLFxuICAgICAgKTtcbiAgICB9O1xuICB9XG59XG4iXSwidmVyc2lvbiI6M30=