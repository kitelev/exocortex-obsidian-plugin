6e194a91199bab06356888a42a36bfcf
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.ButtonRenderer = void 0;
const tslib_1 = require("tslib");
const obsidian_1 = require("obsidian");
/**
 * Presentation layer component for rendering buttons in asset views
 * Following Clean Architecture - this is a framework-specific adapter
 */
class ButtonRenderer {
    constructor(app, renderButtonsUseCase, executeCommandUseCase) {
        this.app = app;
        this.renderButtonsUseCase = renderButtonsUseCase;
        this.executeCommandUseCase = executeCommandUseCase;
    }
    /**
     * Render buttons for a class view
     */
    render(container, className, assetId, context) {
        return tslib_1.__awaiter(this, void 0, void 0, function* () {
            // Get buttons from use case
            const result = yield this.renderButtonsUseCase.execute({
                className,
                assetId,
                context
            });
            if (result.isFailure) {
                console.error(`Failed to render buttons: ${result.error}`);
                return;
            }
            const response = result.getValue();
            if (!response.displayOptions.showButtons || response.buttons.length === 0) {
                return;
            }
            // Create button container
            const buttonContainer = container.createDiv({
                cls: `exocortex-button-container exocortex-buttons-${response.displayOptions.position}`
            });
            // Render each button
            for (const buttonData of response.buttons) {
                this.renderButton(buttonContainer, buttonData, assetId, context);
            }
        });
    }
    /**
     * Render individual button
     */
    renderButton(container, buttonData, assetId, context) {
        const button = new obsidian_1.ButtonComponent(container)
            .setButtonText(buttonData.label)
            .onClick(() => tslib_1.__awaiter(this, void 0, void 0, function* () {
            yield this.handleButtonClick(buttonData, assetId, context);
        }));
        if (buttonData.tooltip) {
            button.setTooltip(buttonData.tooltip);
        }
        if (!buttonData.isEnabled) {
            button.setDisabled(true);
        }
        // Add custom CSS class for styling
        button.buttonEl.addClass('exocortex-ui-button');
        button.buttonEl.setAttribute('data-button-id', buttonData.buttonId);
        button.buttonEl.setAttribute('data-order', buttonData.order.toString());
    }
    /**
     * Handle button click
     */
    handleButtonClick(buttonData, assetId, context) {
        return tslib_1.__awaiter(this, void 0, void 0, function* () {
            // First execution attempt without parameters
            const result = yield this.executeCommandUseCase.execute({
                buttonId: buttonData.buttonId,
                assetId,
                context
            });
            if (result.isFailure) {
                console.error(`Button execution failed: ${result.error}`);
                // Show error notification
                this.showNotification(`Error: ${result.error}`, 'error');
                return;
            }
            const response = result.getValue();
            // Check if input is required
            if (response.requiresInput && response.inputSchema) {
                // Open input modal
                const modal = new CommandInputModal(this.app, response.inputSchema, (inputValues) => tslib_1.__awaiter(this, void 0, void 0, function* () {
                    // Execute with parameters
                    const execResult = yield this.executeCommandUseCase.execute({
                        buttonId: buttonData.buttonId,
                        assetId,
                        inputParameters: inputValues,
                        context
                    });
                    if (execResult.isFailure) {
                        this.showNotification(`Error: ${execResult.error}`, 'error');
                    }
                    else {
                        const execResponse = execResult.getValue();
                        if (execResponse.success) {
                            this.showNotification(execResponse.message || 'Command executed successfully', 'success');
                        }
                    }
                }));
                modal.open();
            }
            else if (response.success) {
                // Command executed successfully
                this.showNotification(response.message || 'Command executed successfully', 'success');
            }
        });
    }
    /**
     * Show notification to user
     */
    showNotification(message, type) {
        // In Obsidian, we use Notice for notifications
        // @ts-ignore - Notice is available in Obsidian
        new Notice(message, type === 'error' ? 5000 : 3000);
    }
}
exports.ButtonRenderer = ButtonRenderer;
/**
 * Modal for collecting command input parameters
 */
class CommandInputModal extends obsidian_1.Modal {
    constructor(app, schema, onSubmit) {
        super(app);
        this.schema = schema;
        this.onSubmit = onSubmit;
        this.inputValues = {};
    }
    onOpen() {
        const { contentEl } = this;
        // Add title
        contentEl.createEl('h2', { text: this.schema.title });
        // Add description if present
        if (this.schema.description) {
            contentEl.createEl('p', {
                text: this.schema.description,
                cls: 'exocortex-modal-description'
            });
        }
        // Create form
        const formEl = contentEl.createDiv({ cls: 'exocortex-command-form' });
        // Add input for each parameter
        for (const param of this.schema.parameters) {
            this.createParameterInput(formEl, param);
        }
        // Add buttons
        const buttonContainer = contentEl.createDiv({ cls: 'modal-button-container' });
        new obsidian_1.Setting(buttonContainer)
            .addButton(btn => btn
            .setButtonText('Cancel')
            .onClick(() => this.close()))
            .addButton(btn => btn
            .setButtonText('Execute')
            .setCta()
            .onClick(() => {
            // Validate required fields
            const errors = this.validateInputs();
            if (errors.length > 0) {
                this.showErrors(errors);
                return;
            }
            this.onSubmit(this.inputValues);
            this.close();
        }));
    }
    createParameterInput(container, param) {
        const setting = new obsidian_1.Setting(container)
            .setName(param.label || param.name)
            .setDesc(param.description || '');
        // Mark required fields
        if (param.required) {
            setting.nameEl.createSpan({ text: ' *', cls: 'required-indicator' });
        }
        // Create appropriate input based on type
        switch (param.type) {
            case 'string':
                setting.addText(text => {
                    text.setPlaceholder(param.label || param.name);
                    if (param.defaultValue) {
                        text.setValue(param.defaultValue);
                        this.inputValues[param.name] = param.defaultValue;
                    }
                    text.onChange(value => {
                        this.inputValues[param.name] = value;
                    });
                });
                break;
            case 'number':
                setting.addText(text => {
                    text.inputEl.type = 'number';
                    if (param.defaultValue !== undefined) {
                        text.setValue(String(param.defaultValue));
                        this.inputValues[param.name] = param.defaultValue;
                    }
                    text.onChange(value => {
                        this.inputValues[param.name] = Number(value);
                    });
                });
                break;
            case 'boolean':
                setting.addToggle(toggle => {
                    if (param.defaultValue !== undefined) {
                        toggle.setValue(param.defaultValue);
                        this.inputValues[param.name] = param.defaultValue;
                    }
                    toggle.onChange(value => {
                        this.inputValues[param.name] = value;
                    });
                });
                break;
            case 'date':
                setting.addText(text => {
                    text.inputEl.type = 'date';
                    if (param.defaultValue) {
                        text.setValue(param.defaultValue);
                        this.inputValues[param.name] = param.defaultValue;
                    }
                    text.onChange(value => {
                        this.inputValues[param.name] = value;
                    });
                });
                break;
            case 'asset':
                setting.addText(text => {
                    text.setPlaceholder('[[Asset Name]]');
                    if (param.defaultValue) {
                        text.setValue(param.defaultValue);
                        this.inputValues[param.name] = param.defaultValue;
                    }
                    text.onChange(value => {
                        // Ensure it's in wiki link format
                        if (value && !value.startsWith('[[')) {
                            value = `[[${value}]]`;
                        }
                        this.inputValues[param.name] = value;
                    });
                });
                break;
            case 'array':
                setting.addTextArea(textarea => {
                    textarea.setPlaceholder('One item per line');
                    if (param.defaultValue) {
                        const defaultText = Array.isArray(param.defaultValue)
                            ? param.defaultValue.join('\n')
                            : param.defaultValue;
                        textarea.setValue(defaultText);
                        this.inputValues[param.name] = param.defaultValue;
                    }
                    textarea.onChange(value => {
                        this.inputValues[param.name] = value.split('\n').filter(v => v.trim());
                    });
                });
                break;
            default:
                // Default to text input
                setting.addText(text => {
                    text.onChange(value => {
                        this.inputValues[param.name] = value;
                    });
                });
        }
    }
    validateInputs() {
        const errors = [];
        for (const param of this.schema.parameters) {
            if (param.required) {
                const value = this.inputValues[param.name];
                if (value === undefined || value === null || value === '') {
                    errors.push(`${param.label || param.name} is required`);
                }
            }
            // Custom validation if provided
            if (param.validation && this.inputValues[param.name]) {
                try {
                    const regex = new RegExp(param.validation);
                    if (!regex.test(String(this.inputValues[param.name]))) {
                        errors.push(`${param.label || param.name} format is invalid`);
                    }
                }
                catch (e) {
                    // Invalid regex, skip validation
                }
            }
        }
        return errors;
    }
    showErrors(errors) {
        // Show errors in a notice
        const errorMessage = 'Please fix the following errors:\n' + errors.join('\n');
        // @ts-ignore
        new Notice(errorMessage, 5000);
    }
    onClose() {
        const { contentEl } = this;
        contentEl.empty();
    }
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL2tpdGVsZXYvRG9jdW1lbnRzL2V4b2NvcnRleC1vYnNpZGlhbi1wbHVnaW4vc3JjL3ByZXNlbnRhdGlvbi9jb21wb25lbnRzL0J1dHRvblJlbmRlcmVyLnRzIiwibWFwcGluZ3MiOiI7Ozs7QUFBQSx1Q0FBZ0U7QUFLaEU7OztHQUdHO0FBQ0gsTUFBYSxjQUFjO0lBQ3ZCLFlBQ1ksR0FBUSxFQUNSLG9CQUErQyxFQUMvQyxxQkFBa0Q7UUFGbEQsUUFBRyxHQUFILEdBQUcsQ0FBSztRQUNSLHlCQUFvQixHQUFwQixvQkFBb0IsQ0FBMkI7UUFDL0MsMEJBQXFCLEdBQXJCLHFCQUFxQixDQUE2QjtJQUMzRCxDQUFDO0lBRUo7O09BRUc7SUFDRyxNQUFNLENBQ1IsU0FBc0IsRUFDdEIsU0FBaUIsRUFDakIsT0FBZ0IsRUFDaEIsT0FBYTs7WUFFYiw0QkFBNEI7WUFDNUIsTUFBTSxNQUFNLEdBQUcsTUFBTSxJQUFJLENBQUMsb0JBQW9CLENBQUMsT0FBTyxDQUFDO2dCQUNuRCxTQUFTO2dCQUNULE9BQU87Z0JBQ1AsT0FBTzthQUNWLENBQUMsQ0FBQztZQUVILElBQUksTUFBTSxDQUFDLFNBQVMsRUFBRTtnQkFDbEIsT0FBTyxDQUFDLEtBQUssQ0FBQyw2QkFBNkIsTUFBTSxDQUFDLEtBQUssRUFBRSxDQUFDLENBQUM7Z0JBQzNELE9BQU87YUFDVjtZQUVELE1BQU0sUUFBUSxHQUFHLE1BQU0sQ0FBQyxRQUFRLEVBQUUsQ0FBQztZQUVuQyxJQUFJLENBQUMsUUFBUSxDQUFDLGNBQWMsQ0FBQyxXQUFXLElBQUksUUFBUSxDQUFDLE9BQU8sQ0FBQyxNQUFNLEtBQUssQ0FBQyxFQUFFO2dCQUN2RSxPQUFPO2FBQ1Y7WUFFRCwwQkFBMEI7WUFDMUIsTUFBTSxlQUFlLEdBQUcsU0FBUyxDQUFDLFNBQVMsQ0FBQztnQkFDeEMsR0FBRyxFQUFFLGdEQUFnRCxRQUFRLENBQUMsY0FBYyxDQUFDLFFBQVEsRUFBRTthQUMxRixDQUFDLENBQUM7WUFFSCxxQkFBcUI7WUFDckIsS0FBSyxNQUFN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SSxDQUFDLENBQUM7SUFDbkMsQ0FBQztJQUVELE9BQU87UUFDSCxNQUFNLEVBQUUsU0FBUyxFQUFFLEdBQUcsSUFBSSxDQUFDO1FBQzNCLFNBQVMsQ0FBQyxLQUFLLEVBQUUsQ0FBQztJQUN0QixDQUFDO0NBQ0oiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL1VzZXJzL2tpdGVsZXYvRG9jdW1lbnRzL2V4b2NvcnRleC1vYnNpZGlhbi1wbHVnaW4vc3JjL3ByZXNlbnRhdGlvbi9jb21wb25lbnRzL0J1dHRvblJlbmRlcmVyLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEJ1dHRvbkNvbXBvbmVudCwgTW9kYWwsIEFwcCwgU2V0dGluZyB9IGZyb20gJ29ic2lkaWFuJztcbmltcG9ydCB7IFJlbmRlckNsYXNzQnV0dG9uc1VzZUNhc2UsIEJ1dHRvblJlbmRlckRhdGEgfSBmcm9tICcuLi8uLi9hcHBsaWNhdGlvbi91c2UtY2FzZXMvUmVuZGVyQ2xhc3NCdXR0b25zVXNlQ2FzZSc7XG5pbXBvcnQgeyBFeGVjdXRlQnV0dG9uQ29tbWFuZFVzZUNhc2UgfSBmcm9tICcuLi8uLi9hcHBsaWNhdGlvbi91c2UtY2FzZXMvRXhlY3V0ZUJ1dHRvbkNvbW1hbmRVc2VDYXNlJztcbmltcG9ydCB7IENvbW1hbmRQYXJhbWV0ZXIgfSBmcm9tICcuLi8uLi9kb21haW4vZW50aXRpZXMvQnV0dG9uQ29tbWFuZCc7XG5cbi8qKlxuICogUHJlc2VudGF0aW9uIGxheWVyIGNvbXBvbmVudCBmb3IgcmVuZGVyaW5nIGJ1dHRvbnMgaW4gYXNzZXQgdmlld3NcbiAqIEZvbGxvd2luZyBDbGVhbiBBcmNoaXRlY3R1cmUgLSB0aGlzIGlzIGEgZnJhbWV3b3JrLXNwZWNpZmljIGFkYXB0ZXJcbiAqL1xuZXhwb3J0IGNsYXNzIEJ1dHRvblJlbmRlcmVyIHtcbiAgICBjb25zdHJ1Y3RvcihcbiAgICAgICAgcHJpdmF0ZSBhcHA6IEFwcCxcbiAgICAgICAgcHJpdmF0ZSByZW5kZXJCdXR0b25zVXNlQ2FzZTogUmVuZGVyQ2xhc3NCdXR0b25zVXNlQ2FzZSxcbiAgICAgICAgcHJpdmF0ZSBleGVjdXRlQ29tbWFuZFVzZUNhc2U6IEV4ZWN1dGVCdXR0b25Db21tYW5kVXNlQ2FzZVxuICAgICkge31cblxuICAgIC8qKlxuICAgICAqIFJlbmRlciBidXR0b25zIGZvciBhIGNsYXNzIHZpZXdcbiAgICAgKi9cbiAgICBhc3luYyByZW5kZXIoXG4gICAgICAgIGNvbnRhaW5lcjogSFRNTEVsZW1lbnQsXG4gICAgICAgIGNsYXNzTmFtZTogc3RyaW5nLFxuICAgICAgICBhc3NldElkPzogc3RyaW5nLFxuICAgICAgICBjb250ZXh0PzogYW55XG4gICAgKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgICAgIC8vIEdldCBidXR0b25zIGZyb20gdXNlIGNhc2VcbiAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdGhpcy5yZW5kZXJCdXR0b25zVXNlQ2FzZS5leGVjdXRlKHtcbiAgICAgICAgICAgIGNsYXNzTmFtZSxcbiAgICAgICAgICAgIGFzc2V0SWQsXG4gICAgICAgICAgICBjb250ZXh0XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGlmIChyZXN1bHQuaXNGYWlsdXJlKSB7XG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKGBGYWlsZWQgdG8gcmVuZGVyIGJ1dHRvbnM6ICR7cmVzdWx0LmVycm9yfWApO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgcmVzcG9uc2UgPSByZXN1bHQuZ2V0VmFsdWUoKTtcbiAgICAgICAgXG4gICAgICAgIGlmICghcmVzcG9uc2UuZGlzcGxheU9wdGlvbnMuc2hvd0J1dHRvbnMgfHwgcmVzcG9uc2UuYnV0dG9ucy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIENyZWF0ZSBidXR0b24gY29udGFpbmVyXG4gICAgICAgIGNvbnN0IGJ1dHRvbkNvbnRhaW5lciA9IGNvbnRhaW5lci5jcmVhdGVEaXYoe1xuICAgICAgICAgICAgY2xzOiBgZXhvY29ydGV4LWJ1dHRvbi1jb250YWluZXIgZXhvY29ydGV4LWJ1dHRvbnMtJHtyZXNwb25zZS5kaXNwbGF5T3B0aW9ucy5wb3NpdGlvbn1gXG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vIFJlbmRlciBlYWNoIGJ1dHRvblxuICAgICAgICBmb3IgKGNvbnN0IGJ1dHRvbkRhdGEgb2YgcmVzcG9uc2UuYnV0dG9ucykge1xuICAgICAgICAgICAgdGhpcy5yZW5kZXJCdXR0b24oYnV0dG9uQ29udGFpbmVyLCBidXR0b25EYXRhLCBhc3NldElkLCBjb250ZXh0KTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFJlbmRlciBpbmRpdmlkdWFsIGJ1dHRvblxuICAgICAqL1xuICAgIHByaXZhdGUgcmVuZGVyQnV0dG9uKFxuICAgICAgICBjb250YWluZXI6IEhUTUxFbGVtZW50LFxuICAgICAgICBidXR0b25EYXRhOiBCdXR0b25SZW5kZXJEYXRhLFxuICAgICAgICBhc3NldElkPzogc3RyaW5nLFxuICAgICAgICBjb250ZXh0PzogYW55XG4gICAgKTogdm9pZCB7XG4gICAgICAgIGNvbnN0IGJ1dHRvbiA9IG5ldyBCdXR0b25Db21wb25lbnQoY29udGFpbmVyKVxuICAgICAgICAgICAgLnNldEJ1dHRvblRleHQoYnV0dG9uRGF0YS5sYWJlbClcbiAgICAgICAgICAgIC5vbkNsaWNrKGFzeW5jICgpID0+IHtcbiAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLmhhbmRsZUJ1dHRvbkNsaWNrKGJ1dHRvbkRhdGEsIGFzc2V0SWQsIGNvbnRleHQpO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgaWYgKGJ1dHRvbkRhdGEudG9vbHRpcCkge1xuICAgICAgICAgICAgYnV0dG9uLnNldFRvb2x0aXAoYnV0dG9uRGF0YS50b29sdGlwKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICghYnV0dG9uRGF0YS5pc0VuYWJsZWQpIHtcbiAgICAgICAgICAgIGJ1dHRvbi5zZXREaXNhYmxlZCh0cnVlKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIEFkZCBjdXN0b20gQ1NTIGNsYXNzIGZvciBzdHlsaW5nXG4gICAgICAgIGJ1dHRvbi5idXR0b25FbC5hZGRDbGFzcygnZXhvY29ydGV4LXVpLWJ1dHRvbicpO1xuICAgICAgICBidXR0b24uYnV0dG9uRWwuc2V0QXR0cmlidXRlKCdkYXRhLWJ1dHRvbi1pZCcsIGJ1dHRvbkRhdGEuYnV0dG9uSWQpO1xuICAgICAgICBidXR0b24uYnV0dG9uRWwuc2V0QXR0cmlidXRlKCdkYXRhLW9yZGVyJywgYnV0dG9uRGF0YS5vcmRlci50b1N0cmluZygpKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBIYW5kbGUgYnV0dG9uIGNsaWNrXG4gICAgICovXG4gICAgcHJpdmF0ZSBhc3luYyBoYW5kbGVCdXR0b25DbGljayhcbiAgICAgICAgYnV0dG9uRGF0YTogQnV0dG9uUmVuZGVyRGF0YSxcbiAgICAgICAgYXNzZXRJZD86IHN0cmluZyxcbiAgICAgICAgY29udGV4dD86IGFueVxuICAgICk6IFByb21pc2U8dm9pZD4ge1xuICAgICAgICAvLyBGaXJzdCBleGVjdXRpb24gYXR0ZW1wdCB3aXRob3V0IHBhcmFtZXRlcnNcbiAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdGhpcy5leGVjdXRlQ29tbWFuZFVzZUNhc2UuZXhlY3V0ZSh7XG4gICAgICAgICAgICBidXR0b25JZDogYnV0dG9uRGF0YS5idXR0b25JZCxcbiAgICAgICAgICAgIGFzc2V0SWQsXG4gICAgICAgICAgICBjb250ZXh0XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGlmIChyZXN1bHQuaXNGYWlsdXJlKSB7XG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKGBCdXR0b24gZXhlY3V0aW9uIGZhaWxlZDogJHtyZXN1bHQuZXJyb3J9YCk7XG4gICAgICAgICAgICAvLyBTaG93IGVycm9yIG5vdGlmaWNhdGlvblxuICAgICAgICAgICAgdGhpcy5zaG93Tm90aWZpY2F0aW9uKGBFcnJvcjogJHtyZXN1bHQuZXJyb3J9YCwgJ2Vycm9yJyk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCByZXNwb25zZSA9IHJlc3VsdC5nZXRWYWx1ZSgpO1xuXG4gICAgICAgIC8vIENoZWNrIGlmIGlucHV0IGlzIHJlcXVpcmVkXG4gICAgICAgIGlmIChyZXNwb25zZS5yZXF1aXJlc0lucHV0ICYmIHJlc3BvbnNlLmlucHV0U2NoZW1hKSB7XG4gICAgICAgICAgICAvLyBPcGVuIGlucHV0IG1vZGFsXG4gICAgICAgICAgICBjb25zdCBtb2RhbCA9IG5ldyBDb21tYW5kSW5wdXRNb2RhbChcbiAgICAgICAgICAgICAgICB0aGlzLmFwcCxcbiAgICAgICAgICAgICAgICByZXNwb25zZS5pbnB1dFNjaGVtYSxcbiAgICAgICAgICAgICAgICBhc3luYyAoaW5wdXRWYWx1ZXMpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgLy8gRXhlY3V0ZSB3aXRoIHBhcmFtZXRlcnNcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgZXhlY1Jlc3VsdCA9IGF3YWl0IHRoaXMuZXhlY3V0ZUNvbW1hbmRVc2VDYXNlLmV4ZWN1dGUoe1xuICAgICAgICAgICAgICAgICAgICAgICAgYnV0dG9uSWQ6IGJ1dHRvbkRhdGEuYnV0dG9uSWQsXG4gICAgICAgICAgICAgICAgICAgICAgICBhc3NldElkLFxuICAgICAgICAgICAgICAgICAgICAgICAgaW5wdXRQYXJhbWV0ZXJzOiBpbnB1dFZhbHVlcyxcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRleHRcbiAgICAgICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKGV4ZWNSZXN1bHQuaXNGYWlsdXJlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNob3dOb3RpZmljYXRpb24oYEVycm9yOiAke2V4ZWNSZXN1bHQuZXJyb3J9YCwgJ2Vycm9yJyk7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBleGVjUmVzcG9uc2UgPSBleGVjUmVzdWx0LmdldFZhbHVlKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoZXhlY1Jlc3BvbnNlLnN1Y2Nlc3MpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNob3dOb3RpZmljYXRpb24oXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4ZWNSZXNwb25zZS5tZXNzYWdlIHx8ICdDb21tYW5kIGV4ZWN1dGVkIHN1Y2Nlc3NmdWxseScsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdzdWNjZXNzJ1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICApO1xuICAgICAgICAgICAgbW9kYWwub3BlbigpO1xuICAgICAgICB9IGVsc2UgaWYgKHJlc3BvbnNlLnN1Y2Nlc3MpIHtcbiAgICAgICAgICAgIC8vIENvbW1hbmQgZXhlY3V0ZWQgc3VjY2Vzc2Z1bGx5XG4gICAgICAgICAgICB0aGlzLnNob3dOb3RpZmljYXRpb24oXG4gICAgICAgICAgICAgICAgcmVzcG9uc2UubWVzc2FnZSB8fCAnQ29tbWFuZCBleGVjdXRlZCBzdWNjZXNzZnVsbHknLFxuICAgICAgICAgICAgICAgICdzdWNjZXNzJ1xuICAgICAgICAgICAgKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFNob3cgbm90aWZpY2F0aW9uIHRvIHVzZXJcbiAgICAgKi9cbiAgICBwcml2YXRlIHNob3dOb3RpZmljYXRpb24obWVzc2FnZTogc3RyaW5nLCB0eXBlOiAnc3VjY2VzcycgfCAnZXJyb3InIHwgJ2luZm8nKTogdm9pZCB7XG4gICAgICAgIC8vIEluIE9ic2lkaWFuLCB3ZSB1c2UgTm90aWNlIGZvciBub3RpZmljYXRpb25zXG4gICAgICAgIC8vIEB0cy1pZ25vcmUgLSBOb3RpY2UgaXMgYXZhaWxhYmxlIGluIE9ic2lkaWFuXG4gICAgICAgIG5ldyBOb3RpY2UobWVzc2FnZSwgdHlwZSA9PT0gJ2Vycm9yJyA/IDUwMDAgOiAzMDAwKTtcbiAgICB9XG59XG5cbi8qKlxuICogTW9kYWwgZm9yIGNvbGxlY3RpbmcgY29tbWFuZCBpbnB1dCBwYXJhbWV0ZXJzXG4gKi9cbmNsYXNzIENvbW1hbmRJbnB1dE1vZGFsIGV4dGVuZHMgTW9kYWwge1xuICAgIHByaXZhdGUgaW5wdXRWYWx1ZXM6IFJlY29yZDxzdHJpbmcsIGFueT4gPSB7fTtcblxuICAgIGNvbnN0cnVjdG9yKFxuICAgICAgICBhcHA6IEFwcCxcbiAgICAgICAgcHJpdmF0ZSBzY2hlbWE6IHtcbiAgICAgICAgICAgIHRpdGxlOiBzdHJpbmc7XG4gICAgICAgICAgICBkZXNjcmlwdGlvbj86IHN0cmluZztcbiAgICAgICAgICAgIHBhcmFtZXRlcnM6IENvbW1hbmRQYXJhbWV0ZXJbXTtcbiAgICAgICAgfSxcbiAgICAgICAgcHJpdmF0ZSBvblN1Ym1pdDogKHZhbHVlczogUmVjb3JkPHN0cmluZywgYW55PikgPT4gdm9pZFxuICAgICkge1xuICAgICAgICBzdXBlcihhcHApO1xuICAgIH1cblxuICAgIG9uT3BlbigpOiB2b2lkIHtcbiAgICAgICAgY29uc3QgeyBjb250ZW50RWwgfSA9IHRoaXM7XG4gICAgICAgIFxuICAgICAgICAvLyBBZGQgdGl0bGVcbiAgICAgICAgY29udGVudEVsLmNyZWF0ZUVsKCdoMicsIHsgdGV4dDogdGhpcy5zY2hlbWEudGl0bGUgfSk7XG4gICAgICAgIFxuICAgICAgICAvLyBBZGQgZGVzY3JpcHRpb24gaWYgcHJlc2VudFxuICAgICAgICBpZiAodGhpcy5zY2hlbWEuZGVzY3JpcHRpb24pIHtcbiAgICAgICAgICAgIGNvbnRlbnRFbC5jcmVhdGVFbCgncCcsIHsgXG4gICAgICAgICAgICAgICAgdGV4dDogdGhpcy5zY2hlbWEuZGVzY3JpcHRpb24sXG4gICAgICAgICAgICAgICAgY2xzOiAnZXhvY29ydGV4LW1vZGFsLWRlc2NyaXB0aW9uJ1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBDcmVhdGUgZm9ybVxuICAgICAgICBjb25zdCBmb3JtRWwgPSBjb250ZW50RWwuY3JlYXRlRGl2KHsgY2xzOiAnZXhvY29ydGV4LWNvbW1hbmQtZm9ybScgfSk7XG5cbiAgICAgICAgLy8gQWRkIGlucHV0IGZvciBlYWNoIHBhcmFtZXRlclxuICAgICAgICBmb3IgKGNvbnN0IHBhcmFtIG9mIHRoaXMuc2NoZW1hLnBhcmFtZXRlcnMpIHtcbiAgICAgICAgICAgIHRoaXMuY3JlYXRlUGFyYW1ldGVySW5wdXQoZm9ybUVsLCBwYXJhbSk7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBBZGQgYnV0dG9uc1xuICAgICAgICBjb25zdCBidXR0b25Db250YWluZXIgPSBjb250ZW50RWwuY3JlYXRlRGl2KHsgY2xzOiAnbW9kYWwtYnV0dG9uLWNvbnRhaW5lcicgfSk7XG4gICAgICAgIFxuICAgICAgICBuZXcgU2V0dGluZyhidXR0b25Db250YWluZXIpXG4gICAgICAgICAgICAuYWRkQnV0dG9uKGJ0biA9PiBidG5cbiAgICAgICAgICAgICAgICAuc2V0QnV0dG9uVGV4dCgnQ2FuY2VsJylcbiAgICAgICAgICAgICAgICAub25DbGljaygoKSA9PiB0aGlzLmNsb3NlKCkpKVxuICAgICAgICAgICAgLmFkZEJ1dHRvbihidG4gPT4gYnRuXG4gICAgICAgICAgICAgICAgLnNldEJ1dHRvblRleHQoJ0V4ZWN1dGUnKVxuICAgICAgICAgICAgICAgIC5zZXRDdGEoKVxuICAgICAgICAgICAgICAgIC5vbkNsaWNrKCgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgLy8gVmFsaWRhdGUgcmVxdWlyZWQgZmllbGRzXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGVycm9ycyA9IHRoaXMudmFsaWRhdGVJbnB1dHMoKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGVycm9ycy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNob3dFcnJvcnMoZXJyb3JzKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5vblN1Ym1pdCh0aGlzLmlucHV0VmFsdWVzKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5jbG9zZSgpO1xuICAgICAgICAgICAgICAgIH0pKTtcbiAgICB9XG5cbiAgICBwcml2YXRlIGNyZWF0ZVBhcmFtZXRlcklucHV0KGNvbnRhaW5lcjogSFRNTEVsZW1lbnQsIHBhcmFtOiBDb21tYW5kUGFyYW1ldGVyKTogdm9pZCB7XG4gICAgICAgIGNvbnN0IHNldHRpbmcgPSBuZXcgU2V0dGluZyhjb250YWluZXIpXG4gICAgICAgICAgICAuc2V0TmFtZShwYXJhbS5sYWJlbCB8fCBwYXJhbS5uYW1lKVxuICAgICAgICAgICAgLnNldERlc2MocGFyYW0uZGVzY3JpcHRpb24gfHwgJycpO1xuXG4gICAgICAgIC8vIE1hcmsgcmVxdWlyZWQgZmllbGRzXG4gICAgICAgIGlmIChwYXJhbS5yZXF1aXJlZCkge1xuICAgICAgICAgICAgc2V0dGluZy5uYW1lRWwuY3JlYXRlU3Bhbih7IHRleHQ6ICcgKicsIGNsczogJ3JlcXVpcmVkLWluZGljYXRvcicgfSk7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBDcmVhdGUgYXBwcm9wcmlhdGUgaW5wdXQgYmFzZWQgb24gdHlwZVxuICAgICAgICBzd2l0Y2ggKHBhcmFtLnR5cGUpIHtcbiAgICAgICAgICAgIGNhc2UgJ3N0cmluZyc6XG4gICAgICAgICAgICAgICAgc2V0dGluZy5hZGRUZXh0KHRleHQgPT4ge1xuICAgICAgICAgICAgICAgICAgICB0ZXh0LnNldFBsYWNlaG9sZGVyKHBhcmFtLmxhYmVsIHx8IHBhcmFtLm5hbWUpO1xuICAgICAgICAgICAgICAgICAgICBpZiAocGFyYW0uZGVmYXVsdFZhbHVlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0ZXh0LnNldFZhbHVlKHBhcmFtLmRlZmF1bHRWYWx1ZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmlucHV0VmFsdWVzW3BhcmFtLm5hbWVdID0gcGFyYW0uZGVmYXVsdFZhbHVlO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHRleHQub25DaGFuZ2UodmFsdWUgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5pbnB1dFZhbHVlc1twYXJhbS5uYW1lXSA9IHZhbHVlO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgY2FzZSAnbnVtYmVyJzpcbiAgICAgICAgICAgICAgICBzZXR0aW5nLmFkZFRleHQodGV4dCA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHRleHQuaW5wdXRFbC50eXBlID0gJ251bWJlcic7XG4gICAgICAgICAgICAgICAgICAgIGlmIChwYXJhbS5kZWZhdWx0VmFsdWUgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGV4dC5zZXRWYWx1ZShTdHJpbmcocGFyYW0uZGVmYXVsdFZhbHVlKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmlucHV0VmFsdWVzW3BhcmFtLm5hbWVdID0gcGFyYW0uZGVmYXVsdFZhbHVlO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHRleHQub25DaGFuZ2UodmFsdWUgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5pbnB1dFZhbHVlc1twYXJhbS5uYW1lXSA9IE51bWJlcih2YWx1ZSk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICBjYXNlICdib29sZWFuJzpcbiAgICAgICAgICAgICAgICBzZXR0aW5nLmFkZFRvZ2dsZSh0b2dnbGUgPT4ge1xuICAgICAgICAgICAgICAgICAgICBpZiAocGFyYW0uZGVmYXVsdFZhbHVlICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRvZ2dsZS5zZXRWYWx1ZShwYXJhbS5kZWZhdWx0VmFsdWUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5pbnB1dFZhbHVlc1twYXJhbS5uYW1lXSA9IHBhcmFtLmRlZmF1bHRWYWx1ZTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB0b2dnbGUub25DaGFuZ2UodmFsdWUgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5pbnB1dFZhbHVlc1twYXJhbS5uYW1lXSA9IHZhbHVlO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgY2FzZSAnZGF0ZSc6XG4gICAgICAgICAgICAgICAgc2V0dGluZy5hZGRUZXh0KHRleHQgPT4ge1xuICAgICAgICAgICAgICAgICAgICB0ZXh0LmlucHV0RWwudHlwZSA9ICdkYXRlJztcbiAgICAgICAgICAgICAgICAgICAgaWYgKHBhcmFtLmRlZmF1bHRWYWx1ZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGV4dC5zZXRWYWx1ZShwYXJhbS5kZWZhdWx0VmFsdWUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5pbnB1dFZhbHVlc1twYXJhbS5uYW1lXSA9IHBhcmFtLmRlZmF1bHRWYWx1ZTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB0ZXh0Lm9uQ2hhbmdlKHZhbHVlID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuaW5wdXRWYWx1ZXNbcGFyYW0ubmFtZV0gPSB2YWx1ZTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgIGNhc2UgJ2Fzc2V0JzpcbiAgICAgICAgICAgICAgICBzZXR0aW5nLmFkZFRleHQodGV4dCA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHRleHQuc2V0UGxhY2Vob2xkZXIoJ1tbQXNzZXQgTmFtZV1dJyk7XG4gICAgICAgICAgICAgICAgICAgIGlmIChwYXJhbS5kZWZhdWx0VmFsdWUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRleHQuc2V0VmFsdWUocGFyYW0uZGVmYXVsdFZhbHVlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuaW5wdXRWYWx1ZXNbcGFyYW0ubmFtZV0gPSBwYXJhbS5kZWZhdWx0VmFsdWU7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgdGV4dC5vbkNoYW5nZSh2YWx1ZSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBFbnN1cmUgaXQncyBpbiB3aWtpIGxpbmsgZm9ybWF0XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodmFsdWUgJiYgIXZhbHVlLnN0YXJ0c1dpdGgoJ1tbJykpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZSA9IGBbWyR7dmFsdWV9XV1gO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5pbnB1dFZhbHVlc1twYXJhbS5uYW1lXSA9IHZhbHVlO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgY2FzZSAnYXJyYXknOlxuICAgICAgICAgICAgICAgIHNldHRpbmcuYWRkVGV4dEFyZWEodGV4dGFyZWEgPT4ge1xuICAgICAgICAgICAgICAgICAgICB0ZXh0YXJlYS5zZXRQbGFjZWhvbGRlcignT25lIGl0ZW0gcGVyIGxpbmUnKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHBhcmFtLmRlZmF1bHRWYWx1ZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgZGVmYXVsdFRleHQgPSBBcnJheS5pc0FycmF5KHBhcmFtLmRlZmF1bHRWYWx1ZSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA/IHBhcmFtLmRlZmF1bHRWYWx1ZS5qb2luKCdcXG4nKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIDogcGFyYW0uZGVmYXVsdFZhbHVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGV4dGFyZWEuc2V0VmFsdWUoZGVmYXVsdFRleHQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5pbnB1dFZhbHVlc1twYXJhbS5uYW1lXSA9IHBhcmFtLmRlZmF1bHRWYWx1ZTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB0ZXh0YXJlYS5vbkNoYW5nZSh2YWx1ZSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmlucHV0VmFsdWVzW3BhcmFtLm5hbWVdID0gdmFsdWUuc3BsaXQoJ1xcbicpLmZpbHRlcih2ID0+IHYudHJpbSgpKTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgLy8gRGVmYXVsdCB0byB0ZXh0IGlucHV0XG4gICAgICAgICAgICAgICAgc2V0dGluZy5hZGRUZXh0KHRleHQgPT4ge1xuICAgICAgICAgICAgICAgICAgICB0ZXh0Lm9uQ2hhbmdlKHZhbHVlID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuaW5wdXRWYWx1ZXNbcGFyYW0ubmFtZV0gPSB2YWx1ZTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwcml2YXRlIHZhbGlkYXRlSW5wdXRzKCk6IHN0cmluZ1tdIHtcbiAgICAgICAgY29uc3QgZXJyb3JzOiBzdHJpbmdbXSA9IFtdO1xuICAgICAgICBcbiAgICAgICAgZm9yIChjb25zdCBwYXJhbSBvZiB0aGlzLnNjaGVtYS5wYXJhbWV0ZXJzKSB7XG4gICAgICAgICAgICBpZiAocGFyYW0ucmVxdWlyZWQpIHtcbiAgICAgICAgICAgICAgICBjb25zdCB2YWx1ZSA9IHRoaXMuaW5wdXRWYWx1ZXNbcGFyYW0ubmFtZV07XG4gICAgICAgICAgICAgICAgaWYgKHZhbHVlID09PSB1bmRlZmluZWQgfHwgdmFsdWUgPT09IG51bGwgfHwgdmFsdWUgPT09ICcnKSB7XG4gICAgICAgICAgICAgICAgICAgIGVycm9ycy5wdXNoKGAke3BhcmFtLmxhYmVsIHx8IHBhcmFtLm5hbWV9IGlzIHJlcXVpcmVkYCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBDdXN0b20gdmFsaWRhdGlvbiBpZiBwcm92aWRlZFxuICAgICAgICAgICAgaWYgKHBhcmFtLnZhbGlkYXRpb24gJiYgdGhpcy5pbnB1dFZhbHVlc1twYXJhbS5uYW1lXSkge1xuICAgICAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHJlZ2V4ID0gbmV3IFJlZ0V4cChwYXJhbS52YWxpZGF0aW9uKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFyZWdleC50ZXN0KFN0cmluZyh0aGlzLmlucHV0VmFsdWVzW3BhcmFtLm5hbWVdKSkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGVycm9ycy5wdXNoKGAke3BhcmFtLmxhYmVsIHx8IHBhcmFtLm5hbWV9IGZvcm1hdCBpcyBpbnZhbGlkYCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIEludmFsaWQgcmVnZXgsIHNraXAgdmFsaWRhdGlvblxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBlcnJvcnM7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBzaG93RXJyb3JzKGVycm9yczogc3RyaW5nW10pOiB2b2lkIHtcbiAgICAgICAgLy8gU2hvdyBlcnJvcnMgaW4gYSBub3RpY2VcbiAgICAgICAgY29uc3QgZXJyb3JNZXNzYWdlID0gJ1BsZWFzZSBmaXggdGhlIGZvbGxvd2luZyBlcnJvcnM6XFxuJyArIGVycm9ycy5qb2luKCdcXG4nKTtcbiAgICAgICAgLy8gQHRzLWlnbm9yZVxuICAgICAgICBuZXcgTm90aWNlKGVycm9yTWVzc2FnZSwgNTAwMCk7XG4gICAgfVxuXG4gICAgb25DbG9zZSgpOiB2b2lkIHtcbiAgICAgICAgY29uc3QgeyBjb250ZW50RWwgfSA9IHRoaXM7XG4gICAgICAgIGNvbnRlbnRFbC5lbXB0eSgpO1xuICAgIH1cbn0iXSwidmVyc2lvbiI6M30=