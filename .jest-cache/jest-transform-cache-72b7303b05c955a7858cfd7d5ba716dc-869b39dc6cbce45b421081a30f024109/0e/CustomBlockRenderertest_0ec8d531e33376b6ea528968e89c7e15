666442d7f47989ca6e5938659e6b0ca1
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const tslib_1 = require("tslib");
const CustomBlockRenderer_1 = require("../../../../src/presentation/renderers/CustomBlockRenderer");
const obsidian_1 = require("../../../__mocks__/obsidian");
describe('CustomBlockRenderer', () => {
    let renderer;
    let mockVault;
    let mockApp;
    let mockFile;
    beforeEach(() => {
        mockVault = new obsidian_1.Vault();
        mockApp = new obsidian_1.App();
        mockFile = new obsidian_1.TFile();
        mockFile.path = 'test.md';
        mockFile.basename = 'test';
        renderer = new CustomBlockRenderer_1.CustomBlockRenderer(mockApp);
    });
    describe('render', () => {
        it('should handle empty config', () => tslib_1.__awaiter(void 0, void 0, void 0, function* () {
            const container = document.createElement('div');
            const config = {
                type: 'custom'
            };
            yield renderer.render(container, config, mockFile, {}, null);
            expect(container.textContent).toContain('Custom block has no content configured');
        }));
        it('should handle custom script config', () => tslib_1.__awaiter(void 0, void 0, void 0, function* () {
            const container = document.createElement('div');
            const config = {
                type: 'custom',
                customScript: 'container.innerHTML = "<div>Script executed</div>";'
            };
            yield renderer.render(container, config, mockFile, {}, null);
            expect(container.textContent).toContain('Script executed');
        }));
        it('should handle template path config', () => tslib_1.__awaiter(void 0, void 0, void 0, function* () {
            const container = document.createElement('div');
            const config = {
                type: 'custom',
                templatePath: 'templates/test.md'
            };
            // Mock template file not found scenario
            yield renderer.render(container, config, mockFile, {}, null);
            expect(container.textContent).toContain('Template not found');
        }));
        it('should handle dataview query config', () => tslib_1.__awaiter(void 0, void 0, void 0, function* () {
            const container = document.createElement('div');
            const config = {
                type: 'custom',
                dataviewQuery: 'table file.name from ""'
            };
            const mockDv = {
                pages: jest.fn().mockReturnValue([]),
                table: jest.fn(),
                list: jest.fn()
            };
            yield renderer.render(container, config, mockFile, {}, mockDv);
            expect(mockDv.pages).toHaveBeenCalled();
        }));
        it('should handle script execution errors gracefully', () => tslib_1.__awaiter(void 0, void 0, void 0, function* () {
            const container = document.createElement('div');
            const config = {
                type: 'custom',
                customScript: 'throw new Error("Test error");'
            };
            yield expect(renderer.render(container, config, mockFile, {}, null)).resolves.not.toThrow();
            expect(container.textContent).toContain('Script execution error');
        }));
        it('should handle dataview not available', () => tslib_1.__awaiter(void 0, void 0, void 0, function* () {
            const container = document.createElement('div');
            const config = {
                type: 'custom',
                dataviewQuery: 'table file.name from ""'
            };
            yield renderer.render(container, config, mockFile, {}, null);
            expect(container.textContent).toContain('Dataview is not available');
        }));
        it('should process template variables', () => tslib_1.__awaiter(void 0, void 0, void 0, function* () {
            const container = document.createElement('div');
            const config = {
                type: 'custom',
                customScript: `
                    const processed = this.renderer.processTemplateVariables ? 
                        'Variables processed' : 'No template processing';
                    container.innerHTML = processed;
                `
            };
            yield renderer.render(container, config, mockFile, { title: 'Test' }, null);
            // Should complete without throwing
            expect(container).toBeDefined();
        }));
    });
    describe('error handling', () => {
        it('should handle render errors gracefully', () => tslib_1.__awaiter(void 0, void 0, void 0, function* () {
            const container = document.createElement('div');
            const config = null;
            yield expect(renderer.render(container, config, mockFile, {}, null)).resolves.not.toThrow();
            expect(container.textContent).toContain('Error rendering custom block');
        }));
        it('should handle invalid template path', () => tslib_1.__awaiter(void 0, void 0, void 0, function* () {
            const container = document.createElement('div');
            const config = {
                type: 'custom',
                templatePath: 'nonexistent/template.md'
            };
            yield renderer.render(container, config, mockFile, {}, null);
            expect(container.textContent).toContain('Template not found');
        }));
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL2tpdGVsZXYvRG9jdW1lbnRzL2V4b2NvcnRleC1vYnNpZGlhbi1wbHVnaW4vdGVzdHMvdW5pdC9wcmVzZW50YXRpb24vcmVuZGVyZXJzL0N1c3RvbUJsb2NrUmVuZGVyZXIudGVzdC50cyIsIm1hcHBpbmdzIjoiOzs7QUFBQSxvR0FBaUc7QUFDakcsMERBQWdFO0FBR2hFLFFBQVEsQ0FBQyxxQkFBcUIsRUFBRSxHQUFHLEVBQUU7SUFDakMsSUFBSSxRQUE2QixDQUFDO0lBQ2xDLElBQUksU0FBZ0IsQ0FBQztJQUNyQixJQUFJLE9BQVksQ0FBQztJQUNqQixJQUFJLFFBQWUsQ0FBQztJQUVwQixVQUFVLENBQUMsR0FBRyxFQUFFO1FBQ1osU0FBUyxHQUFHLElBQUksZ0JBQUssRUFBRSxDQUFDO1FBQ3hCLE9BQU8sR0FBRyxJQUFJLGNBQUcsRUFBRSxDQUFDO1FBQ3BCLFFBQVEsR0FBRyxJQUFJLGdCQUFLLEVBQUUsQ0FBQztRQUN2QixRQUFRLENBQUMsSUFBSSxHQUFHLFNBQVMsQ0FBQztRQUMxQixRQUFRLENBQUMsUUFBUSxHQUFHLE1BQU0sQ0FBQztRQUMzQixRQUFRLEdBQUcsSUFBSSx5Q0FBbUIsQ0FBQyxPQUFjLENBQUMsQ0FBQztJQUN2RCxDQUFDLENBQUMsQ0FBQztJQUVILFFBQVEsQ0FBQyxRQUFRLEVBQUUsR0FBRyxFQUFFO1FBQ3BCLEVBQUUsQ0FBQyw0QkFBNEIsRUFBRSxHQUFTLEVBQUU7WUFDeEMsTUFBTSxTQUFTLEdBQUcsUUFBUSxDQUFDLGFBQWEsQ0FBQyxLQUFLLENBQUMsQ0FBQztZQUNoRCxNQUFNLE1BQU0sR0FBc0I7Z0JBQzlCLElBQUksRUFBRSxRQUFRO2FBQ2pCLENBQUM7WUFFRixNQUFNLFFBQVEsQ0FBQyxNQUFNLENBQUMsU0FBUyxFQUFFLE1BQU0sRUFBRSxRQUFRLEVBQUUsRUFBRSxFQUFFLElBQUksQ0FBQyxDQUFDO1lBRTdELE1BQU0sQ0FBQyxTQUFTLENBQUMsV0FBVyxDQUFDLENBQUMsU0FBUyxDQUFDLHdDQUF3QyxDQUFDLENBQUM7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LFdBQVcsQ0FBQyxDQUFDLFNBQVMsQ0FBQyw4QkFBOEIsQ0FBQyxDQUFDO1FBQzVFLENBQUMsQ0FBQSxDQUFDLENBQUM7UUFFSCxFQUFFLENBQUMscUNBQXFDLEVBQUUsR0FBUyxFQUFFO1lBQ2pELE1BQU0sU0FBUyxHQUFHLFFBQVEsQ0FBQyxhQUFhLENBQUMsS0FBSyxDQUFDLENBQUM7WUFDaEQsTUFBTSxNQUFNLEdBQXNCO2dCQUM5QixJQUFJLEVBQUUsUUFBUTtnQkFDZCxZQUFZLEVBQUUseUJBQXlCO2FBQzFDLENBQUM7WUFFRixNQUFNLFFBQVEsQ0FBQyxNQUFNLENBQUMsU0FBUyxFQUFFLE1BQU0sRUFBRSxRQUFRLEVBQUUsRUFBRSxFQUFFLElBQUksQ0FBQyxDQUFDO1lBRTdELE1BQU0sQ0FBQyxTQUFTLENBQUMsV0FBVyxDQUFDLENBQUMsU0FBUyxDQUFDLG9CQUFvQixDQUFDLENBQUM7UUFDbEUsQ0FBQyxDQUFBLENBQUMsQ0FBQztJQUNQLENBQUMsQ0FBQyxDQUFDO0FBQ1AsQ0FBQyxDQUFDLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL1VzZXJzL2tpdGVsZXYvRG9jdW1lbnRzL2V4b2NvcnRleC1vYnNpZGlhbi1wbHVnaW4vdGVzdHMvdW5pdC9wcmVzZW50YXRpb24vcmVuZGVyZXJzL0N1c3RvbUJsb2NrUmVuZGVyZXIudGVzdC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDdXN0b21CbG9ja1JlbmRlcmVyIH0gZnJvbSAnLi4vLi4vLi4vLi4vc3JjL3ByZXNlbnRhdGlvbi9yZW5kZXJlcnMvQ3VzdG9tQmxvY2tSZW5kZXJlcic7XG5pbXBvcnQgeyBWYXVsdCwgQXBwLCBURmlsZSB9IGZyb20gJy4uLy4uLy4uL19fbW9ja3NfXy9vYnNpZGlhbic7XG5pbXBvcnQgeyBDdXN0b21CbG9ja0NvbmZpZyB9IGZyb20gJy4uLy4uLy4uLy4uL3NyYy9kb21haW4vZW50aXRpZXMvTGF5b3V0QmxvY2snO1xuXG5kZXNjcmliZSgnQ3VzdG9tQmxvY2tSZW5kZXJlcicsICgpID0+IHtcbiAgICBsZXQgcmVuZGVyZXI6IEN1c3RvbUJsb2NrUmVuZGVyZXI7XG4gICAgbGV0IG1vY2tWYXVsdDogVmF1bHQ7XG4gICAgbGV0IG1vY2tBcHA6IEFwcDtcbiAgICBsZXQgbW9ja0ZpbGU6IFRGaWxlO1xuXG4gICAgYmVmb3JlRWFjaCgoKSA9PiB7XG4gICAgICAgIG1vY2tWYXVsdCA9IG5ldyBWYXVsdCgpO1xuICAgICAgICBtb2NrQXBwID0gbmV3IEFwcCgpO1xuICAgICAgICBtb2NrRmlsZSA9IG5ldyBURmlsZSgpO1xuICAgICAgICBtb2NrRmlsZS5wYXRoID0gJ3Rlc3QubWQnO1xuICAgICAgICBtb2NrRmlsZS5iYXNlbmFtZSA9ICd0ZXN0JztcbiAgICAgICAgcmVuZGVyZXIgPSBuZXcgQ3VzdG9tQmxvY2tSZW5kZXJlcihtb2NrQXBwIGFzIGFueSk7XG4gICAgfSk7XG5cbiAgICBkZXNjcmliZSgncmVuZGVyJywgKCkgPT4ge1xuICAgICAgICBpdCgnc2hvdWxkIGhhbmRsZSBlbXB0eSBjb25maWcnLCBhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBjb250YWluZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICAgICAgICAgIGNvbnN0IGNvbmZpZzogQ3VzdG9tQmxvY2tDb25maWcgPSB7XG4gICAgICAgICAgICAgICAgdHlwZTogJ2N1c3RvbSdcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGF3YWl0IHJlbmRlcmVyLnJlbmRlcihjb250YWluZXIsIGNvbmZpZywgbW9ja0ZpbGUsIHt9LCBudWxsKTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgZXhwZWN0KGNvbnRhaW5lci50ZXh0Q29udGVudCkudG9Db250YWluKCdDdXN0b20gYmxvY2sgaGFzIG5vIGNvbnRlbnQgY29uZmlndXJlZCcpO1xuICAgICAgICB9KTtcblxuICAgICAgICBpdCgnc2hvdWxkIGhhbmRsZSBjdXN0b20gc2NyaXB0IGNvbmZpZycsIGFzeW5jICgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGNvbnRhaW5lciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgICAgICAgICAgY29uc3QgY29uZmlnOiBDdXN0b21CbG9ja0NvbmZpZyA9IHtcbiAgICAgICAgICAgICAgICB0eXBlOiAnY3VzdG9tJyxcbiAgICAgICAgICAgICAgICBjdXN0b21TY3JpcHQ6ICdjb250YWluZXIuaW5uZXJIVE1MID0gXCI8ZGl2PlNjcmlwdCBleGVjdXRlZDwvZGl2PlwiOydcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGF3YWl0IHJlbmRlcmVyLnJlbmRlcihjb250YWluZXIsIGNvbmZpZywgbW9ja0ZpbGUsIHt9LCBudWxsKTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgZXhwZWN0KGNvbnRhaW5lci50ZXh0Q29udGVudCkudG9Db250YWluKCdTY3JpcHQgZXhlY3V0ZWQnKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgaXQoJ3Nob3VsZCBoYW5kbGUgdGVtcGxhdGUgcGF0aCBjb25maWcnLCBhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBjb250YWluZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICAgICAgICAgIGNvbnN0IGNvbmZpZzogQ3VzdG9tQmxvY2tDb25maWcgPSB7XG4gICAgICAgICAgICAgICAgdHlwZTogJ2N1c3RvbScsXG4gICAgICAgICAgICAgICAgdGVtcGxhdGVQYXRoOiAndGVtcGxhdGVzL3Rlc3QubWQnXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgXG4gICAgICAgICAgICAvLyBNb2NrIHRlbXBsYXRlIGZpbGUgbm90IGZvdW5kIHNjZW5hcmlvXG4gICAgICAgICAgICBhd2FpdCByZW5kZXJlci5yZW5kZXIoY29udGFpbmVyLCBjb25maWcsIG1vY2tGaWxlLCB7fSwgbnVsbCk7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGV4cGVjdChjb250YWluZXIudGV4dENvbnRlbnQpLnRvQ29udGFpbignVGVtcGxhdGUgbm90IGZvdW5kJyk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGl0KCdzaG91bGQgaGFuZGxlIGRhdGF2aWV3IHF1ZXJ5IGNvbmZpZycsIGFzeW5jICgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGNvbnRhaW5lciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgICAgICAgICAgY29uc3QgY29uZmlnOiBDdXN0b21CbG9ja0NvbmZpZyA9IHtcbiAgICAgICAgICAgICAgICB0eXBlOiAnY3VzdG9tJyxcbiAgICAgICAgICAgICAgICBkYXRhdmlld1F1ZXJ5OiAndGFibGUgZmlsZS5uYW1lIGZyb20gXCJcIidcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGNvbnN0IG1vY2tEdiA9IHtcbiAgICAgICAgICAgICAgICBwYWdlczogamVzdC5mbigpLm1vY2tSZXR1cm5WYWx1ZShbXSksXG4gICAgICAgICAgICAgICAgdGFibGU6IGplc3QuZm4oKSxcbiAgICAgICAgICAgICAgICBsaXN0OiBqZXN0LmZuKClcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGF3YWl0IHJlbmRlcmVyLnJlbmRlcihjb250YWluZXIsIGNvbmZpZywgbW9ja0ZpbGUsIHt9LCBtb2NrRHYpO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICBleHBlY3QobW9ja0R2LnBhZ2VzKS50b0hhdmVCZWVuQ2FsbGVkKCk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGl0KCdzaG91bGQgaGFuZGxlIHNjcmlwdCBleGVjdXRpb24gZXJyb3JzIGdyYWNlZnVsbHknLCBhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBjb250YWluZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICAgICAgICAgIGNvbnN0IGNvbmZpZzogQ3VzdG9tQmxvY2tDb25maWcgPSB7XG4gICAgICAgICAgICAgICAgdHlwZTogJ2N1c3RvbScsXG4gICAgICAgICAgICAgICAgY3VzdG9tU2NyaXB0OiAndGhyb3cgbmV3IEVycm9yKFwiVGVzdCBlcnJvclwiKTsnXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgXG4gICAgICAgICAgICBhd2FpdCBleHBlY3QocmVuZGVyZXIucmVuZGVyKGNvbnRhaW5lciwgY29uZmlnLCBtb2NrRmlsZSwge30sIG51bGwpKS5yZXNvbHZlcy5ub3QudG9UaHJvdygpO1xuICAgICAgICAgICAgZXhwZWN0KGNvbnRhaW5lci50ZXh0Q29udGVudCkudG9Db250YWluKCdTY3JpcHQgZXhlY3V0aW9uIGVycm9yJyk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGl0KCdzaG91bGQgaGFuZGxlIGRhdGF2aWV3IG5vdCBhdmFpbGFibGUnLCBhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBjb250YWluZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICAgICAgICAgIGNvbnN0IGNvbmZpZzogQ3VzdG9tQmxvY2tDb25maWcgPSB7XG4gICAgICAgICAgICAgICAgdHlwZTogJ2N1c3RvbScsXG4gICAgICAgICAgICAgICAgZGF0YXZpZXdRdWVyeTogJ3RhYmxlIGZpbGUubmFtZSBmcm9tIFwiXCInXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgXG4gICAgICAgICAgICBhd2FpdCByZW5kZXJlci5yZW5kZXIoY29udGFpbmVyLCBjb25maWcsIG1vY2tGaWxlLCB7fSwgbnVsbCk7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGV4cGVjdChjb250YWluZXIudGV4dENvbnRlbnQpLnRvQ29udGFpbignRGF0YXZpZXcgaXMgbm90IGF2YWlsYWJsZScpO1xuICAgICAgICB9KTtcblxuICAgICAgICBpdCgnc2hvdWxkIHByb2Nlc3MgdGVtcGxhdGUgdmFyaWFibGVzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgY29udGFpbmVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgICAgICAgICBjb25zdCBjb25maWc6IEN1c3RvbUJsb2NrQ29uZmlnID0ge1xuICAgICAgICAgICAgICAgIHR5cGU6ICdjdXN0b20nLFxuICAgICAgICAgICAgICAgIGN1c3RvbVNjcmlwdDogYFxuICAgICAgICAgICAgICAgICAgICBjb25zdCBwcm9jZXNzZWQgPSB0aGlzLnJlbmRlcmVyLnByb2Nlc3NUZW1wbGF0ZVZhcmlhYmxlcyA/IFxuICAgICAgICAgICAgICAgICAgICAgICAgJ1ZhcmlhYmxlcyBwcm9jZXNzZWQnIDogJ05vIHRlbXBsYXRlIHByb2Nlc3NpbmcnO1xuICAgICAgICAgICAgICAgICAgICBjb250YWluZXIuaW5uZXJIVE1MID0gcHJvY2Vzc2VkO1xuICAgICAgICAgICAgICAgIGBcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGF3YWl0IHJlbmRlcmVyLnJlbmRlcihjb250YWluZXIsIGNvbmZpZywgbW9ja0ZpbGUsIHsgdGl0bGU6ICdUZXN0JyB9LCBudWxsKTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgLy8gU2hvdWxkIGNvbXBsZXRlIHdpdGhvdXQgdGhyb3dpbmdcbiAgICAgICAgICAgIGV4cGVjdChjb250YWluZXIpLnRvQmVEZWZpbmVkKCk7XG4gICAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgZGVzY3JpYmUoJ2Vycm9yIGhhbmRsaW5nJywgKCkgPT4ge1xuICAgICAgICBpdCgnc2hvdWxkIGhhbmRsZSByZW5kZXIgZXJyb3JzIGdyYWNlZnVsbHknLCBhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBjb250YWluZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICAgICAgICAgIGNvbnN0IGNvbmZpZyA9IG51bGwgYXMgYW55O1xuICAgICAgICAgICAgXG4gICAgICAgICAgICBhd2FpdCBleHBlY3QocmVuZGVyZXIucmVuZGVyKGNvbnRhaW5lciwgY29uZmlnLCBtb2NrRmlsZSwge30sIG51bGwpKS5yZXNvbHZlcy5ub3QudG9UaHJvdygpO1xuICAgICAgICAgICAgZXhwZWN0KGNvbnRhaW5lci50ZXh0Q29udGVudCkudG9Db250YWluKCdFcnJvciByZW5kZXJpbmcgY3VzdG9tIGJsb2NrJyk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGl0KCdzaG91bGQgaGFuZGxlIGludmFsaWQgdGVtcGxhdGUgcGF0aCcsIGFzeW5jICgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGNvbnRhaW5lciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgICAgICAgICAgY29uc3QgY29uZmlnOiBDdXN0b21CbG9ja0NvbmZpZyA9IHtcbiAgICAgICAgICAgICAgICB0eXBlOiAnY3VzdG9tJyxcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZVBhdGg6ICdub25leGlzdGVudC90ZW1wbGF0ZS5tZCdcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGF3YWl0IHJlbmRlcmVyLnJlbmRlcihjb250YWluZXIsIGNvbmZpZywgbW9ja0ZpbGUsIHt9LCBudWxsKTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgZXhwZWN0KGNvbnRhaW5lci50ZXh0Q29udGVudCkudG9Db250YWluKCdUZW1wbGF0ZSBub3QgZm91bmQnKTtcbiAgICAgICAgfSk7XG4gICAgfSk7XG59KTsiXSwidmVyc2lvbiI6M30=