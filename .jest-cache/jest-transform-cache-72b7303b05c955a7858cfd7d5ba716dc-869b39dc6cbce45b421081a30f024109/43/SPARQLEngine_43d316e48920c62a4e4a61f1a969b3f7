eceba338037374e62dd507c4b05b5b78
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.SPARQLEngine = void 0;
const Triple_1 = require("../domain/semantic/core/Triple");
const QueryCache_1 = require("./services/QueryCache");
class SPARQLEngine {
    constructor(graph, cacheConfig) {
        this.graph = graph;
        this.queryCache = new QueryCache_1.QueryCache(cacheConfig);
    }
    /**
     * Execute CONSTRUCT query to generate new triples
     */
    construct(query) {
        // Check cache first
        const cacheKey = this.queryCache.createCacheKey(`CONSTRUCT:${query}`);
        const cachedResult = this.queryCache.get(cacheKey);
        if (cachedResult) {
            return Object.assign(Object.assign({}, cachedResult), { cached: true });
        }
        // Parse CONSTRUCT query
        const constructMatch = query.match(/CONSTRUCT\s*\{(.*?)\}\s*WHERE\s*\{(.*?)\}/is);
        if (!constructMatch) {
            throw new Error('Invalid CONSTRUCT query format');
        }
        const template = this.parseConstructTemplate(constructMatch[1]);
        const patterns = this.parsePatterns(constructMatch[2]);
        if (patterns.length === 0) {
            return { triples: [], provenance: `CONSTRUCT query at ${new Date().toISOString()}` };
        }
        const generatedTriples = [];
        // Handle multiple patterns by joining results
        if (patterns.length === 1) {
            // Single pattern - simple case
            const pattern = patterns[0];
            // Convert pattern strings to proper types
            const subject = pattern.subject.startsWith('?') ? null : new Triple_1.IRI(pattern.subject);
            const predicate = pattern.predicate.startsWith('?') ? null : new Triple_1.IRI(pattern.predicate);
            const object = pattern.object.startsWith('?') ? null :
                (pattern.object.startsWith('"') ?
                    Triple_1.Literal.string(pattern.object.replace(/^"|"$/g, '')) :
                    new Triple_1.IRI(pattern.object));
            const matchedTriples = this.graph.match(subject, predicate, object);
            for (const triple of matchedTriples) {
                const binding = this.createBinding(pattern, triple);
                const newTriples = this.instantiateTemplate(template, binding);
                generatedTriples.push(...newTriples);
            }
        }
        else {
            // Multiple patterns - need to join bindings
            const bindings = this.executeWhereClause(patterns);
            for (const binding of bindings) {
                const newTriples = this.instantiateTemplate(template, binding);
                generatedTriples.push(...newTriples);
            }
        }
        // Apply LIMIT if present
        const limitMatch = query.match(/LIMIT\s+(\d+)/i);
        let result;
        if (limitMatch) {
            const limit = parseInt(limitMatch[1]);
            result = {
                triples: generatedTriples.slice(0, limit),
                provenance: `CONSTRUCT query at ${new Date().toISOString()}`,
                cached: false
            };
        }
        else {
            result = {
                triples: generatedTriples,
                provenance: `CONSTRUCT query at ${new Date().toISOString()}`,
                cached: false
            };
        }
        // Cache the result
        this.queryCache.set(cacheKey, result);
        return result;
    }
    parseConstructTemplate(templateClause) {
        const templates = [];
        // Split by period followed by whitespace or newline, not just any period
        const lines = templateClause.trim().split(/\.\s*(?:\n|\s|$)/);
        for (const line of lines) {
            const trimmed = line.trim();
            if (!trimmed)
                continue;
            const parts = trimmed.split(/\s+/);
            if (parts.length >= 3) {
                // Preserve quotes for literals
                let object = parts.slice(2).join(' ');
                templates.push({
                    subject: parts[0],
                    predicate: parts[1],
                    object: object
                });
            }
        }
        return templates;
    }
    createBinding(pattern, triple) {
        const binding = {};
        if (pattern.subject.startsWith('?')) {
            binding[pattern.subject.substring(1)] = triple.getSubject().toString();
        }
        if (pattern.predicate.startsWith('?')) {
            binding[pattern.predicate.substring(1)] = triple.getPredicate().toString();
        }
        if (pattern.object.startsWith('?')) {
            binding[pattern.object.substring(1)] = triple.getObject().toString();
        }
        return binding;
    }
    instantiateTemplate(template, binding) {
        const triples = [];
        for (const t of template) {
            const subjectStr = this.resolveValue(t.subject, binding);
            const predicateStr = this.resolveValue(t.predicate, binding);
            const objectStr = this.resolveValue(t.object, binding);
            if (subjectStr && predicateStr && objectStr) {
                // Create proper Triple objects
                const subject = subjectStr.startsWith('_:') ? new Triple_1.BlankNode(subjectStr) : new Triple_1.IRI(subjectStr);
                const predicate = new Triple_1.IRI(predicateStr);
                // Handle different object types
                let object;
                if (objectStr.startsWith('"')) {
                    // It's a literal
                    object = Triple_1.Literal.string(objectStr.replace(/^"|"$/g, ''));
                }
                else if (objectStr === 'true' || objectStr === 'false') {
                    // Boolean literal
                    object = Triple_1.Literal.boolean(objectStr === 'true');
                }
                else if (objectStr.startsWith('_:')) {
                    // Blank node
                    object = new Triple_1.BlankNode(objectStr);
                }
                else if (/^\d+$/.test(objectStr)) {
                    // Integer literal
                    object = Triple_1.Literal.integer(parseInt(objectStr));
                }
                else if (/^\d+\.\d+$/.test(objectStr)) {
                    // Double literal
                    object = Triple_1.Literal.double(parseFloat(objectStr));
                }
                else {
                    // IRI
                    object = new Triple_1.IRI(objectStr);
                }
                triples.push(new Triple_1.Triple(subject, predicate, object));
            }
        }
        return triples;
    }
    resolveValue(value, binding) {
        if (value.startsWith('?')) {
            const varName = value.substring(1);
            return binding[varName] || null;
        }
        return value;
    }
    executeWhereClause(patterns) {
        if (patterns.length === 0)
            return [];
        // Start with first pattern
        const firstPattern = patterns[0];
        const firstTriples = this.graph.match(firstPattern.subject.startsWith('?') ? null : firstPattern.subject, firstPattern.predicate.startsWith('?') ? null : firstPattern.predicate, firstPattern.object.startsWith('?') ? null : firstPattern.object);
        let bindings = [];
        for (const triple of firstTriples) {
            bindings.push(this.createBinding(firstPattern, triple));
        }
        // Join with subsequent patterns
        for (let i = 1; i < patterns.length; i++) {
            const pattern = patterns[i];
            const newBindings = [];
            for (const binding of bindings) {
                // Resolve pattern with current binding
                const subjectStr = pattern.subject.startsWith('?')
                    ? (binding[pattern.subject.substring(1)] || null)
                    : pattern.subject;
                const predicateStr = pattern.predicate.startsWith('?')
                    ? (binding[pattern.predicate.substring(1)] || null)
                    : pattern.predicate;
                const objectStr = pattern.object.startsWith('?')
                    ? (binding[pattern.object.substring(1)] || null)
                    : pattern.object;
                // Convert strings to proper types for match
                const subject = subjectStr ? new Triple_1.IRI(subjectStr) : null;
                const predicate = predicateStr ? new Triple_1.IRI(predicateStr) : null;
                const object = objectStr ?
                    (objectStr.startsWith('"') ? Triple_1.Literal.string(objectStr.replace(/^"|"$/g, '')) : new Triple_1.IRI(objectStr))
                    : null;
                // Find matching triples
                const matches = this.graph.match(subject, predicate, object);
                for (const triple of matches) {
                    const extendedBinding = Object.assign({}, binding);
                    // Add new variable bindings
                    if (pattern.subject.startsWith('?') && !subjectStr) {
                        extendedBinding[pattern.subject.substring(1)] = triple.getSubject().toString();
                    }
                    if (pattern.predicate.startsWith('?') && !predicateStr) {
                        extendedBinding[pattern.predicate.substring(1)] = triple.getPredicate().toString();
                    }
                    if (pattern.object.startsWith('?') && !objectStr) {
                        extendedBinding[pattern.object.substring(1)] = triple.getObject().toString();
                    }
                    newBindings.push(extendedBinding);
                }
            }
            bindings = newBindings;
        }
        return bindings;
    }
    select(query) {
        // Check cache first
        const cacheKey = this.queryCache.createCacheKey(`SELECT:${query}`);
        const cachedResult = this.queryCache.get(cacheKey);
        if (cachedResult) {
            return Object.assign(Object.assign({}, cachedResult), { cached: true });
        }
        // Very basic SPARQL SELECT implementation for MVP
        const results = [];
        // Parse basic SELECT ?var WHERE { ?s ?p ?o } pattern
        const selectMatch = query.match(/SELECT\s+(.*?)\s+WHERE\s*\{(.*?)\}/is);
        if (!selectMatch) {
            throw new Error('Invalid SPARQL query format');
        }
        const variables = this.parseVariables(selectMatch[1]);
        const patterns = this.parsePatterns(selectMatch[2]);
        if (patterns.length === 0) {
            const emptyResult = { results: [], cached: false };
            this.queryCache.set(cacheKey, emptyResult);
            return emptyResult;
        }
        // Execute first pattern (MVP - single pattern support)
        const pattern = patterns[0];
        // Convert string patterns to proper types for match
        const subject = pattern.subject.startsWith('?') ? null : new Triple_1.IRI(pattern.subject);
        const predicate = pattern.predicate.startsWith('?') ? null : new Triple_1.IRI(pattern.predicate);
        const object = pattern.object.startsWith('?') ? null :
            (pattern.object.startsWith('"') ? Triple_1.Literal.string(pattern.object.replace(/^"|"$/g, '')) : new Triple_1.IRI(pattern.object));
        const triples = this.graph.match(subject, predicate, object);
        // Bind variables
        for (const triple of triples) {
            const binding = {};
            if (pattern.subject.startsWith('?')) {
                const varName = pattern.subject.substring(1);
                if (variables.includes('*') || variables.includes(varName)) {
                    binding[varName] = triple.getSubject().toString();
                }
            }
            if (pattern.predicate.startsWith('?')) {
                const varName = pattern.predicate.substring(1);
                if (variables.includes('*') || variables.includes(varName)) {
                    binding[varName] = triple.getPredicate().toString();
                }
            }
            if (pattern.object.startsWith('?')) {
                const varName = pattern.object.substring(1);
                if (variables.includes('*') || variables.includes(varName)) {
                    binding[varName] = triple.getObject().toString();
                }
            }
            if (Object.keys(binding).length > 0) {
                results.push(binding);
            }
        }
        // Apply LIMIT if present
        const limitMatch = query.match(/LIMIT\s+(\d+)/i);
        let result;
        if (limitMatch) {
            const limit = parseInt(limitMatch[1]);
            result = { results: results.slice(0, limit), cached: false };
        }
        else {
            result = { results, cached: false };
        }
        // Cache the result
        this.queryCache.set(cacheKey, result);
        return result;
    }
    parseVariables(selectClause) {
        const trimmed = selectClause.trim();
        if (trimmed === '*') {
            return ['*'];
        }
        const variables = [];
        const varPattern = /\?(\w+)/g;
        let match;
        while ((match = varPattern.exec(trimmed)) !== null) {
            variables.push(match[1]);
        }
        return variables;
    }
    parsePatterns(whereClause) {
        const patterns = [];
        // Simple triple pattern: ?s ?p ?o or with literals
        // Split by period followed by whitespace/newline, not dots inside quotes
        const lines = whereClause.trim().split(/\.\s*(?:\n|\s|$)/);
        for (const line of lines) {
            const trimmed = line.trim();
            if (!trimmed)
                continue;
            // Match triple pattern (very basic)
            const parts = trimmed.split(/\s+/);
            if (parts.length >= 3) {
                patterns.push({
                    subject: parts[0],
                    predicate: parts[1],
                    object: parts.slice(2).join(' ') // Keep quotes for proper matching
                });
            }
        }
        return patterns;
    }
    /**
     * Get cache statistics
     */
    getCacheStatistics() {
        return this.queryCache.getStatistics();
    }
    /**
     * Invalidate all cached queries
     */
    invalidateCache() {
        this.queryCache.invalidateAll();
    }
    /**
     * Update cache configuration
     */
    updateCacheConfig(config) {
        this.queryCache.updateConfig(config);
    }
    /**
     * Get current cache configuration
     */
    getCacheConfig() {
        return this.queryCache.getConfig();
    }
    /**
     * Cleanup expired cache entries
     */
    cleanupCache() {
        return this.queryCache.cleanup();
    }
    /**
     * Destroy cache and cleanup resources
     */
    destroy() {
        this.queryCache.destroy();
    }
}
exports.SPARQLEngine = SPARQLEngine;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL2tpdGVsZXYvRG9jdW1lbnRzL2V4b2NvcnRleC1vYnNpZGlhbi1wbHVnaW4vc3JjL2FwcGxpY2F0aW9uL1NQQVJRTEVuZ2luZS50cyIsIm1hcHBpbmdzIjoiOzs7QUFDQSwyREFBaUY7QUFDakYsc0RBQXFFO0FBYXJFLE1BQWEsWUFBWTtJQUdyQixZQUFvQixLQUFZLEVBQUUsV0FBdUM7UUFBckQsVUFBSyxHQUFMLEtBQUssQ0FBTztRQUM1QixJQUFJLENBQUMsVUFBVSxHQUFHLElBQUksdUJBQVUsQ0FBQyxXQUFXLENBQUMsQ0FBQztJQUNsRCxDQUFDO0lBRUQ7O09BRUc7SUFDSCxTQUFTLENBQUMsS0FBYTtRQUNuQixvQkFBb0I7UUFDcEIsTUFBTSxRQUFRLEdBQUcsSUFBSSxDQUFDLFVBQVUsQ0FBQyxjQUFjLENBQUMsYUFBYSxLQUFLLEVBQUUsQ0FBQyxDQUFDO1FBQ3RFLE1BQU0sWUFBWSxHQUFHLElBQUksQ0FBQyxVQUFVLENBQUMsR0FBRyxDQUFrQixRQUFRLENBQUMsQ0FBQztRQUVwRSxJQUFJLFlBQVksRUFBRTtZQUNkLHVDQUFZLFlBQVksS0FBRSxNQUFNLEVBQUUsSUFBSSxJQUFHO1NBQzVDO1FBQ0Qsd0JBQXdCO1FBQ3hCLE1BQU0sY0FBYyxHQUFHLEtBQUssQ0FBQyxLQUFLLENBQUMsNkNBQTZDLENBQUMsQ0FBQztRQUNsRixJQUFJLENBQUMsY0FBYyxFQUFFO1lBQ2pCLE1BQU0sSUFBSSxLQUFLLENBQUMsZ0NBQWdDLENBQUMsQ0FBQztTQUNyRDtRQUVELE1BQU0sUUFBUSxHQUFHLElBQUksQ0FBQyxzQkFBc0IsQ0FBQyxjQUFjLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUNoRSxNQUFNLFFBQVEsR0FBRyxJQUFJLENBQUMsYUFBYSxDQUFDLGNBQWMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBRXZELElBQUksUUFBUSxDQUFDLE1BQU0sS0FBSyxDQUFDLEVBQUU7WUFDdkIsT0FBTyxFQUFFLE9BQU8sRUFBRSxFQUFFLEVBQUUsVUFBVSxFQUFF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QUFhLEVBQUUsQ0FBQztJQUNwQyxDQUFDO0lBRUQ7O09BRUc7SUFDSCxpQkFBaUIsQ0FBQyxNQUFpQztRQUMvQyxJQUFJLENBQUMsVUFBVSxDQUFDLFlBQVksQ0FBQyxNQUFNLENBQUMsQ0FBQztJQUN6QyxDQUFDO0lBRUQ7O09BRUc7SUFDSCxjQUFjO1FBQ1YsT0FBTyxJQUFJLENBQUMsVUFBVSxDQUFDLFNBQVMsRUFBRSxDQUFDO0lBQ3ZDLENBQUM7SUFFRDs7T0FFRztJQUNILFlBQVk7UUFDUixPQUFPLElBQUksQ0FBQyxVQUFVLENBQUMsT0FBTyxFQUFFLENBQUM7SUFDckMsQ0FBQztJQUVEOztPQUVHO0lBQ0gsT0FBTztRQUNILElBQUksQ0FBQyxVQUFVLENBQUMsT0FBTyxFQUFFLENBQUM7SUFDOUIsQ0FBQztDQUNKO0FBM1pELG9DQTJaQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyIvVXNlcnMva2l0ZWxldi9Eb2N1bWVudHMvZXhvY29ydGV4LW9ic2lkaWFuLXBsdWdpbi9zcmMvYXBwbGljYXRpb24vU1BBUlFMRW5naW5lLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEdyYXBoIH0gZnJvbSAnLi4vZG9tYWluL3NlbWFudGljL2NvcmUvR3JhcGgnO1xuaW1wb3J0IHsgVHJpcGxlLCBJUkksIExpdGVyYWwsIEJsYW5rTm9kZSB9IGZyb20gJy4uL2RvbWFpbi9zZW1hbnRpYy9jb3JlL1RyaXBsZSc7XG5pbXBvcnQgeyBRdWVyeUNhY2hlLCBRdWVyeUNhY2hlQ29uZmlnIH0gZnJvbSAnLi9zZXJ2aWNlcy9RdWVyeUNhY2hlJztcblxuZXhwb3J0IGludGVyZmFjZSBDb25zdHJ1Y3RSZXN1bHQge1xuICAgIHRyaXBsZXM6IFRyaXBsZVtdO1xuICAgIHByb3ZlbmFuY2U6IHN0cmluZztcbiAgICBjYWNoZWQ/OiBib29sZWFuO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIFNlbGVjdFJlc3VsdCB7XG4gICAgcmVzdWx0czogYW55W107XG4gICAgY2FjaGVkPzogYm9vbGVhbjtcbn1cblxuZXhwb3J0IGNsYXNzIFNQQVJRTEVuZ2luZSB7XG4gICAgcHJpdmF0ZSBxdWVyeUNhY2hlOiBRdWVyeUNhY2hlO1xuXG4gICAgY29uc3RydWN0b3IocHJpdmF0ZSBncmFwaDogR3JhcGgsIGNhY2hlQ29uZmlnPzogUGFydGlhbDxRdWVyeUNhY2hlQ29uZmlnPikge1xuICAgICAgICB0aGlzLnF1ZXJ5Q2FjaGUgPSBuZXcgUXVlcnlDYWNoZShjYWNoZUNvbmZpZyk7XG4gICAgfVxuICAgIFxuICAgIC8qKlxuICAgICAqIEV4ZWN1dGUgQ09OU1RSVUNUIHF1ZXJ5IHRvIGdlbmVyYXRlIG5ldyB0cmlwbGVzXG4gICAgICovXG4gICAgY29uc3RydWN0KHF1ZXJ5OiBzdHJpbmcpOiBDb25zdHJ1Y3RSZXN1bHQge1xuICAgICAgICAvLyBDaGVjayBjYWNoZSBmaXJzdFxuICAgICAgICBjb25zdCBjYWNoZUtleSA9IHRoaXMucXVlcnlDYWNoZS5jcmVhdGVDYWNoZUtleShgQ09OU1RSVUNUOiR7cXVlcnl9YCk7XG4gICAgICAgIGNvbnN0IGNhY2hlZFJlc3VsdCA9IHRoaXMucXVlcnlDYWNoZS5nZXQ8Q29uc3RydWN0UmVzdWx0PihjYWNoZUtleSk7XG4gICAgICAgIFxuICAgICAgICBpZiAoY2FjaGVkUmVzdWx0KSB7XG4gICAgICAgICAgICByZXR1cm4geyAuLi5jYWNoZWRSZXN1bHQsIGNhY2hlZDogdHJ1ZSB9O1xuICAgICAgICB9XG4gICAgICAgIC8vIFBhcnNlIENPTlNUUlVDVCBxdWVyeVxuICAgICAgICBjb25zdCBjb25zdHJ1Y3RNYXRjaCA9IHF1ZXJ5Lm1hdGNoKC9DT05TVFJVQ1RcXHMqXFx7KC4qPylcXH1cXHMqV0hFUkVcXHMqXFx7KC4qPylcXH0vaXMpO1xuICAgICAgICBpZiAoIWNvbnN0cnVjdE1hdGNoKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0ludmFsaWQgQ09OU1RSVUNUIHF1ZXJ5IGZvcm1hdCcpO1xuICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICBjb25zdCB0ZW1wbGF0ZSA9IHRoaXMucGFyc2VDb25zdHJ1Y3RUZW1wbGF0ZShjb25zdHJ1Y3RNYXRjaFsxXSk7XG4gICAgICAgIGNvbnN0IHBhdHRlcm5zID0gdGhpcy5wYXJzZVBhdHRlcm5zKGNvbnN0cnVjdE1hdGNoWzJdKTtcbiAgICAgICAgXG4gICAgICAgIGlmIChwYXR0ZXJucy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgIHJldHVybiB7IHRyaXBsZXM6IFtdLCBwcm92ZW5hbmNlOiBgQ09OU1RSVUNUIHF1ZXJ5IGF0ICR7bmV3IERhdGUoKS50b0lTT1N0cmluZygpfWAgfTtcbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgY29uc3QgZ2VuZXJhdGVkVHJpcGxlczogVHJpcGxlW10gPSBbXTtcbiAgICAgICAgXG4gICAgICAgIC8vIEhhbmRsZSBtdWx0aXBsZSBwYXR0ZXJucyBieSBqb2luaW5nIHJlc3VsdHNcbiAgICAgICAgaWYgKHBhdHRlcm5zLmxlbmd0aCA9PT0gMSkge1xuICAgICAgICAgICAgLy8gU2luZ2xlIHBhdHRlcm4gLSBzaW1wbGUgY2FzZVxuICAgICAgICAgICAgY29uc3QgcGF0dGVybiA9IHBhdHRlcm5zWzBdO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICAvLyBDb252ZXJ0IHBhdHRlcm4gc3RyaW5ncyB0byBwcm9wZXIgdHlwZXNcbiAgICAgICAgICAgIGNvbnN0IHN1YmplY3QgPSBwYXR0ZXJuLnN1YmplY3Quc3RhcnRzV2l0aCgnPycpID8gbnVsbCA6IG5ldyBJUkkocGF0dGVybi5zdWJqZWN0KTtcbiAgICAgICAgICAgIGNvbnN0IHByZWRpY2F0ZSA9IHBhdHRlcm4ucHJlZGljYXRlLnN0YXJ0c1dpdGgoJz8nKSA/IG51bGwgOiBuZXcgSVJJKHBhdHRlcm4ucHJlZGljYXRlKTtcbiAgICAgICAgICAgIGNvbnN0IG9iamVjdCA9IHBhdHRlcm4ub2JqZWN0LnN0YXJ0c1dpdGgoJz8nKSA/IG51bGwgOiBcbiAgICAgICAgICAgICAgICAocGF0dGVybi5vYmplY3Quc3RhcnRzV2l0aCgnXCInKSA/IFxuICAgICAgICAgICAgICAgICAgICBMaXRlcmFsLnN0cmluZyhwYXR0ZXJuLm9iamVjdC5yZXBsYWNlKC9eXCJ8XCIkL2csICcnKSkgOiBcbiAgICAgICAgICAgICAgICAgICAgbmV3IElSSShwYXR0ZXJuLm9iamVjdCkpO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICBjb25zdCBtYXRjaGVkVHJpcGxlcyA9IHRoaXMuZ3JhcGgubWF0Y2goc3ViamVjdCwgcHJlZGljYXRlLCBvYmplY3QpO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICBmb3IgKGNvbnN0IHRyaXBsZSBvZiBtYXRjaGVkVHJpcGxlcykge1xuICAgICAgICAgICAgICAgIGNvbnN0IGJpbmRpbmcgPSB0aGlzLmNyZWF0ZUJpbmRpbmcocGF0dGVybiwgdHJpcGxlKTtcbiAgICAgICAgICAgICAgICBjb25zdCBuZXdUcmlwbGVzID0gdGhpcy5pbnN0YW50aWF0ZVRlbXBsYXRlKHRlbXBsYXRlLCBiaW5kaW5nKTtcbiAgICAgICAgICAgICAgICBnZW5lcmF0ZWRUcmlwbGVzLnB1c2goLi4ubmV3VHJpcGxlcyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAvLyBNdWx0aXBsZSBwYXR0ZXJucyAtIG5lZWQgdG8gam9pbiBiaW5kaW5nc1xuICAgICAgICAgICAgY29uc3QgYmluZGluZ3MgPSB0aGlzLmV4ZWN1dGVXaGVyZUNsYXVzZShwYXR0ZXJucyk7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGZvciAoY29uc3QgYmluZGluZyBvZiBiaW5kaW5ncykge1xuICAgICAgICAgICAgICAgIGNvbnN0IG5ld1RyaXBsZXMgPSB0aGlzLmluc3RhbnRpYXRlVGVtcGxhdGUodGVtcGxhdGUsIGJpbmRpbmcpO1xuICAgICAgICAgICAgICAgIGdlbmVyYXRlZFRyaXBsZXMucHVzaCguLi5uZXdUcmlwbGVzKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgLy8gQXBwbHkgTElNSVQgaWYgcHJlc2VudFxuICAgICAgICBjb25zdCBsaW1pdE1hdGNoID0gcXVlcnkubWF0Y2goL0xJTUlUXFxzKyhcXGQrKS9pKTtcbiAgICAgICAgbGV0IHJlc3VsdDogQ29uc3RydWN0UmVzdWx0O1xuICAgICAgICBcbiAgICAgICAgaWYgKGxpbWl0TWF0Y2gpIHtcbiAgICAgICAgICAgIGNvbnN0IGxpbWl0ID0gcGFyc2VJbnQobGltaXRNYXRjaFsxXSk7XG4gICAgICAgICAgICByZXN1bHQgPSB7XG4gICAgICAgICAgICAgICAgdHJpcGxlczogZ2VuZXJhdGVkVHJpcGxlcy5zbGljZSgwLCBsaW1pdCksXG4gICAgICAgICAgICAgICAgcHJvdmVuYW5jZTogYENPTlNUUlVDVCBxdWVyeSBhdCAke25ldyBEYXRlKCkudG9JU09TdHJpbmcoKX1gLFxuICAgICAgICAgICAgICAgIGNhY2hlZDogZmFsc2VcbiAgICAgICAgICAgIH07XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZXN1bHQgPSB7XG4gICAgICAgICAgICAgICAgdHJpcGxlczogZ2VuZXJhdGVkVHJpcGxlcyxcbiAgICAgICAgICAgICAgICBwcm92ZW5hbmNlOiBgQ09OU1RSVUNUIHF1ZXJ5IGF0ICR7bmV3IERhdGUoKS50b0lTT1N0cmluZygpfWAsXG4gICAgICAgICAgICAgICAgY2FjaGVkOiBmYWxzZVxuICAgICAgICAgICAgfTtcbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgLy8gQ2FjaGUgdGhlIHJlc3VsdFxuICAgICAgICB0aGlzLnF1ZXJ5Q2FjaGUuc2V0KGNhY2hlS2V5LCByZXN1bHQpO1xuICAgICAgICBcbiAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICB9XG4gICAgXG4gICAgcHJpdmF0ZSBwYXJzZUNvbnN0cnVjdFRlbXBsYXRlKHRlbXBsYXRlQ2xhdXNlOiBzdHJpbmcpOiBhbnlbXSB7XG4gICAgICAgIGNvbnN0IHRlbXBsYXRlczogYW55W10gPSBbXTtcbiAgICAgICAgLy8gU3BsaXQgYnkgcGVyaW9kIGZvbGxvd2VkIGJ5IHdoaXRlc3BhY2Ugb3IgbmV3bGluZSwgbm90IGp1c3QgYW55IHBlcmlvZFxuICAgICAgICBjb25zdCBsaW5lcyA9IHRlbXBsYXRlQ2xhdXNlLnRyaW0oKS5zcGxpdCgvXFwuXFxzKig/OlxcbnxcXHN8JCkvKTtcbiAgICAgICAgXG4gICAgICAgIGZvciAoY29uc3QgbGluZSBvZiBsaW5lcykge1xuICAgICAgICAgICAgY29uc3QgdHJpbW1lZCA9IGxpbmUudHJpbSgpO1xuICAgICAgICAgICAgaWYgKCF0cmltbWVkKSBjb250aW51ZTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgY29uc3QgcGFydHMgPSB0cmltbWVkLnNwbGl0KC9cXHMrLyk7XG4gICAgICAgICAgICBpZiAocGFydHMubGVuZ3RoID49IDMpIHtcbiAgICAgICAgICAgICAgICAvLyBQcmVzZXJ2ZSBxdW90ZXMgZm9yIGxpdGVyYWxzXG4gICAgICAgICAgICAgICAgbGV0IG9iamVjdCA9IHBhcnRzLnNsaWNlKDIpLmpvaW4oJyAnKTtcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZXMucHVzaCh7XG4gICAgICAgICAgICAgICAgICAgIHN1YmplY3Q6IHBhcnRzWzBdLFxuICAgICAgICAgICAgICAgICAgICBwcmVkaWNhdGU6IHBhcnRzWzFdLFxuICAgICAgICAgICAgICAgICAgICBvYmplY3Q6IG9iamVjdFxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICByZXR1cm4gdGVtcGxhdGVzO1xuICAgIH1cbiAgICBcbiAgICBwcml2YXRlIGNyZWF0ZUJpbmRpbmcocGF0dGVybjogYW55LCB0cmlwbGU6IFRyaXBsZSk6IFJlY29yZDxzdHJpbmcsIHN0cmluZz4ge1xuICAgICAgICBjb25zdCBiaW5kaW5nOiBSZWNvcmQ8c3RyaW5nLCBzdHJpbmc+ID0ge307XG4gICAgICAgIFxuICAgICAgICBpZiAocGF0dGVybi5zdWJqZWN0LnN0YXJ0c1dpdGgoJz8nKSkge1xuICAgICAgICAgICAgYmluZGluZ1twYXR0ZXJuLnN1YmplY3Quc3Vic3RyaW5nKDEpXSA9IHRyaXBsZS5nZXRTdWJqZWN0KCkudG9TdHJpbmcoKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAocGF0dGVybi5wcmVkaWNhdGUuc3RhcnRzV2l0aCgnPycpKSB7XG4gICAgICAgICAgICBiaW5kaW5nW3BhdHRlcm4ucHJlZGljYXRlLnN1YnN0cmluZygxKV0gPSB0cmlwbGUuZ2V0UHJlZGljYXRlKCkudG9TdHJpbmcoKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAocGF0dGVybi5vYmplY3Quc3RhcnRzV2l0aCgnPycpKSB7XG4gICAgICAgICAgICBiaW5kaW5nW3BhdHRlcm4ub2JqZWN0LnN1YnN0cmluZygxKV0gPSB0cmlwbGUuZ2V0T2JqZWN0KCkudG9TdHJpbmcoKTtcbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgcmV0dXJuIGJpbmRpbmc7XG4gICAgfVxuICAgIFxuICAgIHByaXZhdGUgaW5zdGFudGlhdGVUZW1wbGF0ZSh0ZW1wbGF0ZTogYW55W10sIGJpbmRpbmc6IFJlY29yZDxzdHJpbmcsIHN0cmluZz4pOiBUcmlwbGVbXSB7XG4gICAgICAgIGNvbnN0IHRyaXBsZXM6IFRyaXBsZVtdID0gW107XG4gICAgICAgIFxuICAgICAgICBmb3IgKGNvbnN0IHQgb2YgdGVtcGxhdGUpIHtcbiAgICAgICAgICAgIGNvbnN0IHN1YmplY3RTdHIgPSB0aGlzLnJlc29sdmVWYWx1ZSh0LnN1YmplY3QsIGJpbmRpbmcpO1xuICAgICAgICAgICAgY29uc3QgcHJlZGljYXRlU3RyID0gdGhpcy5yZXNvbHZlVmFsdWUodC5wcmVkaWNhdGUsIGJpbmRpbmcpO1xuICAgICAgICAgICAgY29uc3Qgb2JqZWN0U3RyID0gdGhpcy5yZXNvbHZlVmFsdWUodC5vYmplY3QsIGJpbmRpbmcpO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICBpZiAoc3ViamVjdFN0ciAmJiBwcmVkaWNhdGVTdHIgJiYgb2JqZWN0U3RyKSB7XG4gICAgICAgICAgICAgICAgLy8gQ3JlYXRlIHByb3BlciBUcmlwbGUgb2JqZWN0c1xuICAgICAgICAgICAgICAgIGNvbnN0IHN1YmplY3QgPSBzdWJqZWN0U3RyLnN0YXJ0c1dpdGgoJ186JykgPyBuZXcgQmxhbmtOb2RlKHN1YmplY3RTdHIpIDogbmV3IElSSShzdWJqZWN0U3RyKTtcbiAgICAgICAgICAgICAgICBjb25zdCBwcmVkaWNhdGUgPSBuZXcgSVJJKHByZWRpY2F0ZVN0cik7XG4gICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgLy8gSGFuZGxlIGRpZmZlcmVudCBvYmplY3QgdHlwZXNcbiAgICAgICAgICAgICAgICBsZXQgb2JqZWN0OiBJUkkgfCBCbGFua05vZGUgfCBMaXRlcmFsO1xuICAgICAgICAgICAgICAgIGlmIChvYmplY3RTdHIuc3RhcnRzV2l0aCgnXCInKSkge1xuICAgICAgICAgICAgICAgICAgICAvLyBJdCdzIGEgbGl0ZXJhbFxuICAgICAgICAgICAgICAgICAgICBvYmplY3QgPSBMaXRlcmFsLnN0cmluZyhvYmplY3RTdHIucmVwbGFjZSgvXlwifFwiJC9nLCAnJykpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAob2JqZWN0U3RyID09PSAndHJ1ZScgfHwgb2JqZWN0U3RyID09PSAnZmFsc2UnKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIEJvb2xlYW4gbGl0ZXJhbFxuICAgICAgICAgICAgICAgICAgICBvYmplY3QgPSBMaXRlcmFsLmJvb2xlYW4ob2JqZWN0U3RyID09PSAndHJ1ZScpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAob2JqZWN0U3RyLnN0YXJ0c1dpdGgoJ186JykpIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gQmxhbmsgbm9kZVxuICAgICAgICAgICAgICAgICAgICBvYmplY3QgPSBuZXcgQmxhbmtOb2RlKG9iamVjdFN0cik7XG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmICgvXlxcZCskLy50ZXN0KG9iamVjdFN0cikpIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gSW50ZWdlciBsaXRlcmFsXG4gICAgICAgICAgICAgICAgICAgIG9iamVjdCA9IExpdGVyYWwuaW50ZWdlcihwYXJzZUludChvYmplY3RTdHIpKTtcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKC9eXFxkK1xcLlxcZCskLy50ZXN0KG9iamVjdFN0cikpIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gRG91YmxlIGxpdGVyYWxcbiAgICAgICAgICAgICAgICAgICAgb2JqZWN0ID0gTGl0ZXJhbC5kb3VibGUocGFyc2VGbG9hdChvYmplY3RTdHIpKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAvLyBJUklcbiAgICAgICAgICAgICAgICAgICAgb2JqZWN0ID0gbmV3IElSSShvYmplY3RTdHIpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICB0cmlwbGVzLnB1c2gobmV3IFRyaXBsZShzdWJqZWN0LCBwcmVkaWNhdGUsIG9iamVjdCkpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICByZXR1cm4gdHJpcGxlcztcbiAgICB9XG4gICAgXG4gICAgcHJpdmF0ZSByZXNvbHZlVmFsdWUodmFsdWU6IHN0cmluZywgYmluZGluZzogUmVjb3JkPHN0cmluZywgc3RyaW5nPik6IHN0cmluZyB8IG51bGwge1xuICAgICAgICBpZiAodmFsdWUuc3RhcnRzV2l0aCgnPycpKSB7XG4gICAgICAgICAgICBjb25zdCB2YXJOYW1lID0gdmFsdWUuc3Vic3RyaW5nKDEpO1xuICAgICAgICAgICAgcmV0dXJuIGJpbmRpbmdbdmFyTmFtZV0gfHwgbnVsbDtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdmFsdWU7XG4gICAgfVxuICAgIFxuICAgIHByaXZhdGUgZXhlY3V0ZVdoZXJlQ2xhdXNlKHBhdHRlcm5zOiBhbnlbXSk6IFJlY29yZDxzdHJpbmcsIHN0cmluZz5bXSB7XG4gICAgICAgIGlmIChwYXR0ZXJucy5sZW5ndGggPT09IDApIHJldHVybiBbXTtcbiAgICAgICAgXG4gICAgICAgIC8vIFN0YXJ0IHdpdGggZmlyc3QgcGF0dGVyblxuICAgICAgICBjb25zdCBmaXJzdFBhdHRlcm4gPSBwYXR0ZXJuc1swXTtcbiAgICAgICAgY29uc3QgZmlyc3RUcmlwbGVzID0gdGhpcy5ncmFwaC5tYXRjaChcbiAgICAgICAgICAgIGZpcnN0UGF0dGVybi5zdWJqZWN0LnN0YXJ0c1dpdGgoJz8nKSA/IG51bGwgOiBmaXJzdFBhdHRlcm4uc3ViamVjdCxcbiAgICAgICAgICAgIGZpcnN0UGF0dGVybi5wcmVkaWNhdGUuc3RhcnRzV2l0aCgnPycpID8gbnVsbCA6IGZpcnN0UGF0dGVybi5wcmVkaWNhdGUsXG4gICAgICAgICAgICBmaXJzdFBhdHRlcm4ub2JqZWN0LnN0YXJ0c1dpdGgoJz8nKSA/IG51bGwgOiBmaXJzdFBhdHRlcm4ub2JqZWN0XG4gICAgICAgICk7XG4gICAgICAgIFxuICAgICAgICBsZXQgYmluZGluZ3M6IFJlY29yZDxzdHJpbmcsIHN0cmluZz5bXSA9IFtdO1xuICAgICAgICBmb3IgKGNvbnN0IHRyaXBsZSBvZiBmaXJzdFRyaXBsZXMpIHtcbiAgICAgICAgICAgIGJpbmRpbmdzLnB1c2godGhpcy5jcmVhdGVCaW5kaW5nKGZpcnN0UGF0dGVybiwgdHJpcGxlKSk7XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIC8vIEpvaW4gd2l0aCBzdWJzZXF1ZW50IHBhdHRlcm5zXG4gICAgICAgIGZvciAobGV0IGkgPSAxOyBpIDwgcGF0dGVybnMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIGNvbnN0IHBhdHRlcm4gPSBwYXR0ZXJuc1tpXTtcbiAgICAgICAgICAgIGNvbnN0IG5ld0JpbmRpbmdzOiBSZWNvcmQ8c3RyaW5nLCBzdHJpbmc+W10gPSBbXTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgZm9yIChjb25zdCBiaW5kaW5nIG9mIGJpbmRpbmdzKSB7XG4gICAgICAgICAgICAgICAgLy8gUmVzb2x2ZSBwYXR0ZXJuIHdpdGggY3VycmVudCBiaW5kaW5nXG4gICAgICAgICAgICAgICAgY29uc3Qgc3ViamVjdFN0ciA9IHBhdHRlcm4uc3ViamVjdC5zdGFydHNXaXRoKCc/JykgXG4gICAgICAgICAgICAgICAgICAgID8gKGJpbmRpbmdbcGF0dGVybi5zdWJqZWN0LnN1YnN0cmluZygxKV0gfHwgbnVsbClcbiAgICAgICAgICAgICAgICAgICAgOiBwYXR0ZXJuLnN1YmplY3Q7XG4gICAgICAgICAgICAgICAgY29uc3QgcHJlZGljYXRlU3RyID0gcGF0dGVybi5wcmVkaWNhdGUuc3RhcnRzV2l0aCgnPycpXG4gICAgICAgICAgICAgICAgICAgID8gKGJpbmRpbmdbcGF0dGVybi5wcmVkaWNhdGUuc3Vic3RyaW5nKDEpXSB8fCBudWxsKVxuICAgICAgICAgICAgICAgICAgICA6IHBhdHRlcm4ucHJlZGljYXRlO1xuICAgICAgICAgICAgICAgIGNvbnN0IG9iamVjdFN0ciA9IHBhdHRlcm4ub2JqZWN0LnN0YXJ0c1dpdGgoJz8nKVxuICAgICAgICAgICAgICAgICAgICA/IChiaW5kaW5nW3BhdHRlcm4ub2JqZWN0LnN1YnN0cmluZygxKV0gfHwgbnVsbClcbiAgICAgICAgICAgICAgICAgICAgOiBwYXR0ZXJuLm9iamVjdDtcbiAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAvLyBDb252ZXJ0IHN0cmluZ3MgdG8gcHJvcGVyIHR5cGVzIGZvciBtYXRjaFxuICAgICAgICAgICAgICAgIGNvbnN0IHN1YmplY3QgPSBzdWJqZWN0U3RyID8gbmV3IElSSShzdWJqZWN0U3RyKSA6IG51bGw7XG4gICAgICAgICAgICAgICAgY29uc3QgcHJlZGljYXRlID0gcHJlZGljYXRlU3RyID8gbmV3IElSSShwcmVkaWNhdGVTdHIpIDogbnVsbDtcbiAgICAgICAgICAgICAgICBjb25zdCBvYmplY3QgPSBvYmplY3RTdHIgPyBcbiAgICAgICAgICAgICAgICAgICAgKG9iamVjdFN0ci5zdGFydHNXaXRoKCdcIicpID8gTGl0ZXJhbC5zdHJpbmcob2JqZWN0U3RyLnJlcGxhY2UoL15cInxcIiQvZywgJycpKSA6IG5ldyBJUkkob2JqZWN0U3RyKSlcbiAgICAgICAgICAgICAgICAgICAgOiBudWxsO1xuICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgIC8vIEZpbmQgbWF0Y2hpbmcgdHJpcGxlc1xuICAgICAgICAgICAgICAgIGNvbnN0IG1hdGNoZXMgPSB0aGlzLmdyYXBoLm1hdGNoKHN1YmplY3QsIHByZWRpY2F0ZSwgb2JqZWN0KTtcbiAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IHRyaXBsZSBvZiBtYXRjaGVzKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGV4dGVuZGVkQmluZGluZyA9IHsgLi4uYmluZGluZyB9O1xuICAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAgICAgLy8gQWRkIG5ldyB2YXJpYWJsZSBiaW5kaW5nc1xuICAgICAgICAgICAgICAgICAgICBpZiAocGF0dGVybi5zdWJqZWN0LnN0YXJ0c1dpdGgoJz8nKSAmJiAhc3ViamVjdFN0cikge1xuICAgICAgICAgICAgICAgICAgICAgICAgZXh0ZW5kZWRCaW5kaW5nW3BhdHRlcm4uc3ViamVjdC5zdWJzdHJpbmcoMSldID0gdHJpcGxlLmdldFN1YmplY3QoKS50b1N0cmluZygpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGlmIChwYXR0ZXJuLnByZWRpY2F0ZS5zdGFydHNXaXRoKCc/JykgJiYgIXByZWRpY2F0ZVN0cikge1xuICAgICAgICAgICAgICAgICAgICAgICAgZXh0ZW5kZWRCaW5kaW5nW3BhdHRlcm4ucHJlZGljYXRlLnN1YnN0cmluZygxKV0gPSB0cmlwbGUuZ2V0UHJlZGljYXRlKCkudG9TdHJpbmcoKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBpZiAocGF0dGVybi5vYmplY3Quc3RhcnRzV2l0aCgnPycpICYmICFvYmplY3RTdHIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGV4dGVuZGVkQmluZGluZ1twYXR0ZXJuLm9iamVjdC5zdWJzdHJpbmcoMSldID0gdHJpcGxlLmdldE9iamVjdCgpLnRvU3RyaW5nKCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgICAgIG5ld0JpbmRpbmdzLnB1c2goZXh0ZW5kZWRCaW5kaW5nKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGJpbmRpbmdzID0gbmV3QmluZGluZ3M7XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIHJldHVybiBiaW5kaW5ncztcbiAgICB9XG4gICAgXG4gICAgc2VsZWN0KHF1ZXJ5OiBzdHJpbmcpOiBTZWxlY3RSZXN1bHQge1xuICAgICAgICAvLyBDaGVjayBjYWNoZSBmaXJzdFxuICAgICAgICBjb25zdCBjYWNoZUtleSA9IHRoaXMucXVlcnlDYWNoZS5jcmVhdGVDYWNoZUtleShgU0VMRUNUOiR7cXVlcnl9YCk7XG4gICAgICAgIGNvbnN0IGNhY2hlZFJlc3VsdCA9IHRoaXMucXVlcnlDYWNoZS5nZXQ8U2VsZWN0UmVzdWx0PihjYWNoZUtleSk7XG4gICAgICAgIFxuICAgICAgICBpZiAoY2FjaGVkUmVzdWx0KSB7XG4gICAgICAgICAgICByZXR1cm4geyAuLi5jYWNoZWRSZXN1bHQsIGNhY2hlZDogdHJ1ZSB9O1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gVmVyeSBiYXNpYyBTUEFSUUwgU0VMRUNUIGltcGxlbWVudGF0aW9uIGZvciBNVlBcbiAgICAgICAgY29uc3QgcmVzdWx0czogYW55W10gPSBbXTtcbiAgICAgICAgXG4gICAgICAgIC8vIFBhcnNlIGJhc2ljIFNFTEVDVCA/dmFyIFdIRVJFIHsgP3MgP3AgP28gfSBwYXR0ZXJuXG4gICAgICAgIGNvbnN0IHNlbGVjdE1hdGNoID0gcXVlcnkubWF0Y2goL1NFTEVDVFxccysoLio/KVxccytXSEVSRVxccypcXHsoLio/KVxcfS9pcyk7XG4gICAgICAgIGlmICghc2VsZWN0TWF0Y2gpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignSW52YWxpZCBTUEFSUUwgcXVlcnkgZm9ybWF0Jyk7XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIGNvbnN0IHZhcmlhYmxlcyA9IHRoaXMucGFyc2VWYXJpYWJsZXMoc2VsZWN0TWF0Y2hbMV0pO1xuICAgICAgICBjb25zdCBwYXR0ZXJucyA9IHRoaXMucGFyc2VQYXR0ZXJucyhzZWxlY3RNYXRjaFsyXSk7XG4gICAgICAgIFxuICAgICAgICBpZiAocGF0dGVybnMubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICBjb25zdCBlbXB0eVJlc3VsdDogU2VsZWN0UmVzdWx0ID0geyByZXN1bHRzOiBbXSwgY2FjaGVkOiBmYWxzZSB9O1xuICAgICAgICAgICAgdGhpcy5xdWVyeUNhY2hlLnNldChjYWNoZUtleSwgZW1wdHlSZXN1bHQpO1xuICAgICAgICAgICAgcmV0dXJuIGVtcHR5UmVzdWx0O1xuICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICAvLyBFeGVjdXRlIGZpcnN0IHBhdHRlcm4gKE1WUCAtIHNpbmdsZSBwYXR0ZXJuIHN1cHBvcnQpXG4gICAgICAgIGNvbnN0IHBhdHRlcm4gPSBwYXR0ZXJuc1swXTtcbiAgICAgICAgXG4gICAgICAgIC8vIENvbnZlcnQgc3RyaW5nIHBhdHRlcm5zIHRvIHByb3BlciB0eXBlcyBmb3IgbWF0Y2hcbiAgICAgICAgY29uc3Qgc3ViamVjdCA9IHBhdHRlcm4uc3ViamVjdC5zdGFydHNXaXRoKCc/JykgPyBudWxsIDogbmV3IElSSShwYXR0ZXJuLnN1YmplY3QpO1xuICAgICAgICBjb25zdCBwcmVkaWNhdGUgPSBwYXR0ZXJuLnByZWRpY2F0ZS5zdGFydHNXaXRoKCc/JykgPyBudWxsIDogbmV3IElSSShwYXR0ZXJuLnByZWRpY2F0ZSk7XG4gICAgICAgIGNvbnN0IG9iamVjdCA9IHBhdHRlcm4ub2JqZWN0LnN0YXJ0c1dpdGgoJz8nKSA/IG51bGwgOiBcbiAgICAgICAgICAgIChwYXR0ZXJuLm9iamVjdC5zdGFydHNXaXRoKCdcIicpID8gTGl0ZXJhbC5zdHJpbmcocGF0dGVybi5vYmplY3QucmVwbGFjZSgvXlwifFwiJC9nLCAnJykpIDogbmV3IElSSShwYXR0ZXJuLm9iamVjdCkpO1xuICAgICAgICBcbiAgICAgICAgY29uc3QgdHJpcGxlcyA9IHRoaXMuZ3JhcGgubWF0Y2goc3ViamVjdCwgcHJlZGljYXRlLCBvYmplY3QpO1xuICAgICAgICBcbiAgICAgICAgLy8gQmluZCB2YXJpYWJsZXNcbiAgICAgICAgZm9yIChjb25zdCB0cmlwbGUgb2YgdHJpcGxlcykge1xuICAgICAgICAgICAgY29uc3QgYmluZGluZzogYW55ID0ge307XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGlmIChwYXR0ZXJuLnN1YmplY3Quc3RhcnRzV2l0aCgnPycpKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgdmFyTmFtZSA9IHBhdHRlcm4uc3ViamVjdC5zdWJzdHJpbmcoMSk7XG4gICAgICAgICAgICAgICAgaWYgKHZhcmlhYmxlcy5pbmNsdWRlcygnKicpIHx8IHZhcmlhYmxlcy5pbmNsdWRlcyh2YXJOYW1lKSkge1xuICAgICAgICAgICAgICAgICAgICBiaW5kaW5nW3Zhck5hbWVdID0gdHJpcGxlLmdldFN1YmplY3QoKS50b1N0cmluZygpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIFxuICAgICAgICAgICAgaWYgKHBhdHRlcm4ucHJlZGljYXRlLnN0YXJ0c1dpdGgoJz8nKSkge1xuICAgICAgICAgICAgICAgIGNvbnN0IHZhck5hbWUgPSBwYXR0ZXJuLnByZWRpY2F0ZS5zdWJzdHJpbmcoMSk7XG4gICAgICAgICAgICAgICAgaWYgKHZhcmlhYmxlcy5pbmNsdWRlcygnKicpIHx8IHZhcmlhYmxlcy5pbmNsdWRlcyh2YXJOYW1lKSkge1xuICAgICAgICAgICAgICAgICAgICBiaW5kaW5nW3Zhck5hbWVdID0gdHJpcGxlLmdldFByZWRpY2F0ZSgpLnRvU3RyaW5nKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgXG4gICAgICAgICAgICBpZiAocGF0dGVybi5vYmplY3Quc3RhcnRzV2l0aCgnPycpKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgdmFyTmFtZSA9IHBhdHRlcm4ub2JqZWN0LnN1YnN0cmluZygxKTtcbiAgICAgICAgICAgICAgICBpZiAodmFyaWFibGVzLmluY2x1ZGVzKCcqJykgfHwgdmFyaWFibGVzLmluY2x1ZGVzKHZhck5hbWUpKSB7XG4gICAgICAgICAgICAgICAgICAgIGJpbmRpbmdbdmFyTmFtZV0gPSB0cmlwbGUuZ2V0T2JqZWN0KCkudG9TdHJpbmcoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGlmIChPYmplY3Qua2V5cyhiaW5kaW5nKS5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgcmVzdWx0cy5wdXNoKGJpbmRpbmcpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICAvLyBBcHBseSBMSU1JVCBpZiBwcmVzZW50XG4gICAgICAgIGNvbnN0IGxpbWl0TWF0Y2ggPSBxdWVyeS5tYXRjaCgvTElNSVRcXHMrKFxcZCspL2kpO1xuICAgICAgICBsZXQgcmVzdWx0OiBTZWxlY3RSZXN1bHQ7XG4gICAgICAgIFxuICAgICAgICBpZiAobGltaXRNYXRjaCkge1xuICAgICAgICAgICAgY29uc3QgbGltaXQgPSBwYXJzZUludChsaW1pdE1hdGNoWzFdKTtcbiAgICAgICAgICAgIHJlc3VsdCA9IHsgcmVzdWx0czogcmVzdWx0cy5zbGljZSgwLCBsaW1pdCksIGNhY2hlZDogZmFsc2UgfTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJlc3VsdCA9IHsgcmVzdWx0cywgY2FjaGVkOiBmYWxzZSB9O1xuICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICAvLyBDYWNoZSB0aGUgcmVzdWx0XG4gICAgICAgIHRoaXMucXVlcnlDYWNoZS5zZXQoY2FjaGVLZXksIHJlc3VsdCk7XG4gICAgICAgIFxuICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgIH1cbiAgICBcbiAgICBwcml2YXRlIHBhcnNlVmFyaWFibGVzKHNlbGVjdENsYXVzZTogc3RyaW5nKTogc3RyaW5nW10ge1xuICAgICAgICBjb25zdCB0cmltbWVkID0gc2VsZWN0Q2xhdXNlLnRyaW0oKTtcbiAgICAgICAgaWYgKHRyaW1tZWQgPT09ICcqJykge1xuICAgICAgICAgICAgcmV0dXJuIFsnKiddO1xuICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICBjb25zdCB2YXJpYWJsZXM6IHN0cmluZ1tdID0gW107XG4gICAgICAgIGNvbnN0IHZhclBhdHRlcm4gPSAvXFw/KFxcdyspL2c7XG4gICAgICAgIGxldCBtYXRjaDtcbiAgICAgICAgd2hpbGUgKChtYXRjaCA9IHZhclBhdHRlcm4uZXhlYyh0cmltbWVkKSkgIT09IG51bGwpIHtcbiAgICAgICAgICAgIHZhcmlhYmxlcy5wdXNoKG1hdGNoWzFdKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdmFyaWFibGVzO1xuICAgIH1cbiAgICBcbiAgICBwcml2YXRlIHBhcnNlUGF0dGVybnMod2hlcmVDbGF1c2U6IHN0cmluZyk6IGFueVtdIHtcbiAgICAgICAgY29uc3QgcGF0dGVybnM6IGFueVtdID0gW107XG4gICAgICAgIFxuICAgICAgICAvLyBTaW1wbGUgdHJpcGxlIHBhdHRlcm46ID9zID9wID9vIG9yIHdpdGggbGl0ZXJhbHNcbiAgICAgICAgLy8gU3BsaXQgYnkgcGVyaW9kIGZvbGxvd2VkIGJ5IHdoaXRlc3BhY2UvbmV3bGluZSwgbm90IGRvdHMgaW5zaWRlIHF1b3Rlc1xuICAgICAgICBjb25zdCBsaW5lcyA9IHdoZXJlQ2xhdXNlLnRyaW0oKS5zcGxpdCgvXFwuXFxzKig/OlxcbnxcXHN8JCkvKTtcbiAgICAgICAgXG4gICAgICAgIGZvciAoY29uc3QgbGluZSBvZiBsaW5lcykge1xuICAgICAgICAgICAgY29uc3QgdHJpbW1lZCA9IGxpbmUudHJpbSgpO1xuICAgICAgICAgICAgaWYgKCF0cmltbWVkKSBjb250aW51ZTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgLy8gTWF0Y2ggdHJpcGxlIHBhdHRlcm4gKHZlcnkgYmFzaWMpXG4gICAgICAgICAgICBjb25zdCBwYXJ0cyA9IHRyaW1tZWQuc3BsaXQoL1xccysvKTtcbiAgICAgICAgICAgIGlmIChwYXJ0cy5sZW5ndGggPj0gMykge1xuICAgICAgICAgICAgICAgIHBhdHRlcm5zLnB1c2goe1xuICAgICAgICAgICAgICAgICAgICBzdWJqZWN0OiBwYXJ0c1swXSxcbiAgICAgICAgICAgICAgICAgICAgcHJlZGljYXRlOiBwYXJ0c1sxXSxcbiAgICAgICAgICAgICAgICAgICAgb2JqZWN0OiBwYXJ0cy5zbGljZSgyKS5qb2luKCcgJykgIC8vIEtlZXAgcXVvdGVzIGZvciBwcm9wZXIgbWF0Y2hpbmdcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgcmV0dXJuIHBhdHRlcm5zO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEdldCBjYWNoZSBzdGF0aXN0aWNzXG4gICAgICovXG4gICAgZ2V0Q2FjaGVTdGF0aXN0aWNzKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5xdWVyeUNhY2hlLmdldFN0YXRpc3RpY3MoKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBJbnZhbGlkYXRlIGFsbCBjYWNoZWQgcXVlcmllc1xuICAgICAqL1xuICAgIGludmFsaWRhdGVDYWNoZSgpOiB2b2lkIHtcbiAgICAgICAgdGhpcy5xdWVyeUNhY2hlLmludmFsaWRhdGVBbGwoKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBVcGRhdGUgY2FjaGUgY29uZmlndXJhdGlvblxuICAgICAqL1xuICAgIHVwZGF0ZUNhY2hlQ29uZmlnKGNvbmZpZzogUGFydGlhbDxRdWVyeUNhY2hlQ29uZmlnPik6IHZvaWQge1xuICAgICAgICB0aGlzLnF1ZXJ5Q2FjaGUudXBkYXRlQ29uZmlnKGNvbmZpZyk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogR2V0IGN1cnJlbnQgY2FjaGUgY29uZmlndXJhdGlvblxuICAgICAqL1xuICAgIGdldENhY2hlQ29uZmlnKCk6IFF1ZXJ5Q2FjaGVDb25maWcge1xuICAgICAgICByZXR1cm4gdGhpcy5xdWVyeUNhY2hlLmdldENvbmZpZygpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIENsZWFudXAgZXhwaXJlZCBjYWNoZSBlbnRyaWVzXG4gICAgICovXG4gICAgY2xlYW51cENhY2hlKCk6IG51bWJlciB7XG4gICAgICAgIHJldHVybiB0aGlzLnF1ZXJ5Q2FjaGUuY2xlYW51cCgpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIERlc3Ryb3kgY2FjaGUgYW5kIGNsZWFudXAgcmVzb3VyY2VzXG4gICAgICovXG4gICAgZGVzdHJveSgpOiB2b2lkIHtcbiAgICAgICAgdGhpcy5xdWVyeUNhY2hlLmRlc3Ryb3koKTtcbiAgICB9XG59XG4iXSwidmVyc2lvbiI6M30=