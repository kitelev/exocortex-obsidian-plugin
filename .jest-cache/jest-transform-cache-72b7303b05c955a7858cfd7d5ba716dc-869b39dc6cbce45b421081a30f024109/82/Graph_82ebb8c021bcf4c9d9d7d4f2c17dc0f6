ab97a18da88105494eb07186c7ebd1e0
"use strict";
/**
 * RDF Graph implementation for managing collections of triples
 * Provides efficient querying and manipulation of semantic data
 */
Object.defineProperty(exports, "__esModule", { value: true });
exports.Graph = void 0;
/**
 * RDF Graph - A collection of RDF triples
 */
class Graph {
    constructor(triples = []) {
        this.triples = new Set();
        this.spo = new Map();
        this.pos = new Map();
        this.osp = new Map();
        for (const triple of triples) {
            this.add(triple);
        }
    }
    /**
     * Add a triple to the graph
     */
    add(triple) {
        if (this.has(triple))
            return;
        this.triples.add(triple);
        const s = triple.getSubject().toString();
        const p = triple.getPredicate().toString();
        const o = triple.getObject().toString();
        // Update SPO index
        if (!this.spo.has(s))
            this.spo.set(s, new Map());
        if (!this.spo.get(s).has(p))
            this.spo.get(s).set(p, new Set());
        this.spo.get(s).get(p).add(o);
        // Update POS index
        if (!this.pos.has(p))
            this.pos.set(p, new Map());
        if (!this.pos.get(p).has(o))
            this.pos.get(p).set(o, new Set());
        this.pos.get(p).get(o).add(s);
        // Update OSP index
        if (!this.osp.has(o))
            this.osp.set(o, new Map());
        if (!this.osp.get(o).has(s))
            this.osp.get(o).set(s, new Set());
        this.osp.get(o).get(s).add(p);
    }
    /**
     * Remove a triple from the graph
     */
    remove(triple) {
        var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k, _l, _m, _o, _p, _q, _r, _s, _t;
        if (!this.has(triple))
            return;
        this.triples.delete(triple);
        const s = triple.getSubject().toString();
        const p = triple.getPredicate().toString();
        const o = triple.getObject().toString();
        // Update SPO index
        (_b = (_a = this.spo.get(s)) === null || _a === void 0 ? void 0 : _a.get(p)) === null || _b === void 0 ? void 0 : _b.delete(o);
        if (((_d = (_c = this.spo.get(s)) === null || _c === void 0 ? void 0 : _c.get(p)) === null || _d === void 0 ? void 0 : _d.size) === 0) {
            (_e = this.spo.get(s)) === null || _e === void 0 ? void 0 : _e.delete(p);
        }
        if (((_f = this.spo.get(s)) === null || _f === void 0 ? void 0 : _f.size) === 0) {
            this.spo.delete(s);
        }
        // Update POS index
        (_h = (_g = this.pos.get(p)) === null || _g === void 0 ? void 0 : _g.get(o)) === null || _h === void 0 ? void 0 : _h.delete(s);
        if (((_k = (_j = this.pos.get(p)) === null || _j === void 0 ? void 0 : _j.get(o)) === null || _k === void 0 ? void 0 : _k.size) === 0) {
            (_l = this.pos.get(p)) === null || _l === void 0 ? void 0 : _l.delete(o);
        }
        if (((_m = this.pos.get(p)) === null || _m === void 0 ? void 0 : _m.size) === 0) {
            this.pos.delete(p);
        }
        // Update OSP index
        (_p = (_o = this.osp.get(o)) === null || _o === void 0 ? void 0 : _o.get(s)) === null || _p === void 0 ? void 0 : _p.delete(p);
        if (((_r = (_q = this.osp.get(o)) === null || _q === void 0 ? void 0 : _q.get(s)) === null || _r === void 0 ? void 0 : _r.size) === 0) {
            (_s = this.osp.get(o)) === null || _s === void 0 ? void 0 : _s.delete(s);
        }
        if (((_t = this.osp.get(o)) === null || _t === void 0 ? void 0 : _t.size) === 0) {
            this.osp.delete(o);
        }
    }
    /**
     * Check if the graph contains a triple
     */
    has(triple) {
        var _a, _b, _c;
        const s = triple.getSubject().toString();
        const p = triple.getPredicate().toString();
        const o = triple.getObject().toString();
        return (_c = (_b = (_a = this.spo.get(s)) === null || _a === void 0 ? void 0 : _a.get(p)) === null || _b === void 0 ? void 0 : _b.has(o)) !== null && _c !== void 0 ? _c : false;
    }
    /**
     * Get all triples matching a pattern
     * null values act as wildcards
     */
    match(subject = null, predicate = null, object = null) {
        var _a, _b, _c;
        const results = [];
        if (subject && predicate && object) {
            // Exact match
            for (const triple of this.triples) {
                if (triple.getSubject().toString() === subject.toString() &&
                    triple.getPredicate().toString() === predicate.toString() &&
                    triple.getObject().toString() === object.toString()) {
                    results.push(triple);
                }
            }
        }
        else if (subject && predicate) {
            // S P ?
            const objects = (_a = this.spo.get(subject.toString())) === null || _a === void 0 ? void 0 : _a.get(predicate.toString());
            if (objects) {
                for (const triple of this.triples) {
                    if (triple.getSubject().toString() === subject.toString() &&
                        triple.getPredicate().toString() === predicate.toString()) {
                        results.push(triple);
                    }
                }
            }
        }
        else if (predicate && object) {
            // ? P O
            const subjects = (_b = this.pos.get(predicate.toString())) === null || _b === void 0 ? void 0 : _b.get(object.toString());
            if (subjects) {
                for (const triple of this.triples) {
                    if (triple.getPredicate().toString() === predicate.toString() &&
                        triple.getObject().toString() === object.toString()) {
                        results.push(triple);
                    }
                }
            }
        }
        else if (subject && object) {
            // S ? O
            const predicates = (_c = this.osp.get(object.toString())) === null || _c === void 0 ? void 0 : _c.get(subject.toString());
            if (predicates) {
                for (const triple of this.triples) {
                    if (triple.getSubject().toString() === subject.toString() &&
                        triple.getObject().toString() === object.toString()) {
                        results.push(triple);
                    }
                }
            }
        }
        else if (subject) {
            // S ? ?
            for (const triple of this.triples) {
                if (triple.getSubject().toString() === subject.toString()) {
                    results.push(triple);
                }
            }
        }
        else if (predicate) {
            // ? P ?
            for (const triple of this.triples) {
                if (triple.getPredicate().toString() === predicate.toString()) {
                    results.push(triple);
                }
            }
        }
        else if (object) {
            // ? ? O
            for (const triple of this.triples) {
                if (triple.getObject().toString() === object.toString()) {
                    results.push(triple);
                }
            }
        }
        else {
            // ? ? ? - return all
            return Array.from(this.triples);
        }
        return results;
    }
    /**
     * Get all subjects in the graph
     */
    subjects() {
        const subjects = new Set();
        for (const triple of this.triples) {
            subjects.add(triple.getSubject());
        }
        return subjects;
    }
    /**
     * Get all predicates in the graph
     */
    predicates() {
        const predicates = new Set();
        for (const triple of this.triples) {
            predicates.add(triple.getPredicate());
        }
        return predicates;
    }
    /**
     * Get all objects in the graph
     */
    objects() {
        const objects = new Set();
        for (const triple of this.triples) {
            objects.add(triple.getObject());
        }
        return objects;
    }
    /**
     * Get the size of the graph (number of triples)
     */
    size() {
        return this.triples.size;
    }
    /**
     * Check if the graph is empty
     */
    isEmpty() {
        return this.triples.size === 0;
    }
    /**
     * Clear all triples from the graph
     */
    clear() {
        this.triples.clear();
        this.spo.clear();
        this.pos.clear();
        this.osp.clear();
    }
    /**
     * Merge another graph into this one
     */
    merge(other) {
        for (const triple of other.toArray()) {
            this.add(triple);
        }
    }
    /**
     * Create a new graph with triples matching a pattern
     */
    filter(subject = null, predicate = null, object = null) {
        return new Graph(this.match(subject, predicate, object));
    }
    /**
     * Convert the graph to an array of triples
     */
    toArray() {
        return Array.from(this.triples);
    }
    /**
     * Create a human-readable string representation
     */
    toString() {
        return Array.from(this.triples)
            .map(t => t.toString())
            .join('\n');
    }
    /**
     * Create a copy of this graph
     */
    clone() {
        return new Graph(this.toArray());
    }
    /**
     * Check if two graphs are equal
     */
    equals(other) {
        if (this.size() !== other.size())
            return false;
        for (const triple of this.triples) {
            if (!other.has(triple))
                return false;
        }
        return true;
    }
}
exports.Graph = Graph;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL2tpdGVsZXYvRG9jdW1lbnRzL2V4b2NvcnRleC1vYnNpZGlhbi1wbHVnaW4vc3JjL2RvbWFpbi9zZW1hbnRpYy9jb3JlL0dyYXBoLnRzIiwibWFwcGluZ3MiOiI7QUFBQTs7O0dBR0c7OztBQVVIOztHQUVHO0FBQ0gsTUFBYSxLQUFLO0lBTWhCLFlBQVksVUFBb0IsRUFBRTtRQUwxQixZQUFPLEdBQWdCLElBQUksR0FBRyxFQUFFLENBQUM7UUFDakMsUUFBRyxHQUEwQyxJQUFJLEdBQUcsRUFBRSxDQUFDO1FBQ3ZELFFBQUcsR0FBMEMsSUFBSSxHQUFHLEVBQUUsQ0FBQztRQUN2RCxRQUFHLEdBQTBDLElBQUksR0FBRyxFQUFFLENBQUM7UUFHN0QsS0FBSyxNQUFNLE1BQU0sSUFBSSxPQUFPLEVBQUU7WUFDNUIsSUFBSSxDQUFDLEdBQUcsQ0FBQyxNQUFNLENBQUMsQ0FBQztTQUNsQjtJQUNILENBQUM7SUFFRDs7T0FFRztJQUNILEdBQUcsQ0FBQyxNQUFjO1FBQ2hCLElBQUksSUFBSSxDQUFDLEdBQUcsQ0FBQyxNQUFNLENBQUM7WUFBRSxPQUFPO1FBRTdCLElBQUksQ0FBQyxPQUFPLENBQUMsR0FBRyxDQUFDLE1BQU0sQ0FBQyxDQUFDO1FBRXpCLE1BQU0sQ0FBQyxHQUFHLE1BQU0sQ0FBQyxVQUFVLEVBQUUsQ0FBQyxRQUFRLEVBQUUsQ0FBQztRQUN6QyxNQUFNLENBQUMsR0FBRyxNQUFNLENBQUMsWUFBWSxFQUFFLENBQUMsUUFBUSxFQUFFLENBQUM7UUFDM0MsTUFBTSxDQUFDLEdBQUcsTUFBTSxDQUFDLFNBQVMsRUFBRSxDQUFDLFFBQVEsRUFBRSxDQUFDO1FBRXhDLG1CQUFtQjtRQUNuQixJQUFJLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDO1lBQUUsSUFBSSxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsQ0FBQyxFQUFFLElBQUksR0FBRyxFQUFFLENBQUMsQ0FBQztRQUNqRCxJQUFJLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFFLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQztZQUFFLElBQUksQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBRSxDQUFDLEdBQUcsQ0FBQyxDQUFDLEVBQUUsSUFBSSxHQUFHLEVBQUUsQ0FBQyxDQUFDO1FBQ2pFLElBQUksQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBRSxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUUsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFFaEMsbUJBQW1CO1FBQ25CLElBQUksQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUM7WUFBRSxJQUFJLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxDQUFDLEVBQUUsSUFBSSxHQUFHLEVBQUUsQ0FBQyxDQUFDO1FBQ2pELElBQUksQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUUsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDO1lBQUUsSUFBSSxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFFLENBQUMsR0FBRyxDQUFDLENBQUMsRUFBRSxJQUFJLEdBQUcsRUFBRSxDQUFDLENBQUM7UUFDakUsSUFBSSxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFFLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBRSxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUVoQyxtQkFBbUI7UUFDbkIsSUFBSSxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQztZQUFFLElBQUksQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDLENBQUMsRUFBRSxJQUFJLEdBQUcsRUFBRSxDQUFDLENBQUM7UUFDakQsSUFBSSxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBRSxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUM7WUFBRSxJQUFJLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUUsQ0FBQyxHQUFHLENBQUMsQ0FBQyxFQUFFLElBQUksR0FBRyxFQUFFLENBQUMsQ0FBQztRQUNqRSxJQUFJLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUUsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFFLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDO0lBQ2xDLENBQUM7SUFFRDs7T0FFRztJQUNILE1BQU0sQ0FBQyxNQUFjOztRQUNuQixJQUFJLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxNQUFNLENBQUM7WUFBRSxPQUFPO1FBRTlCLElBQUksQ0FBQyxPQUFPLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxDQUFDO1FBRTVCLE1BQU0sQ0FBQyxHQUFHLE1BQU0sQ0FBQyxVQUFVLEVBQUUsQ0FBQyxRQUFRLEVBQUUsQ0FBQztRQUN6QyxNQUFNLENBQUMsR0FBRyxNQUFNLENBQUMsWUFBWSxFQUFFLENBQUMsUUFBUSxFQUFFLENBQUM7UUFDM0MsTUFBTSxDQUFDLEdBQUcsTUFBTSxDQUFDLFNBQVMsRUFBRSxDQUFDLFFBQVEsRUFBRSxDQUFDO1FBRXhDLG1CQUFtQjtRQUNuQixNQUFBLE1BQUEsSUFBSSxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLDBDQUFFLEdBQUcsQ0FBQyxDQUFDLENBQUMsMENBQUUsTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQ25DLElBQUksQ0FBQSxNQUFBLE1BQUEsSUFBSSxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLDBDQUFFLEdBQUcsQ0FBQyxDQUFDLENBQUMsMENBQUUsSUFBSSxNQUFLLENBQUMsRUFBRTtZQUN2QyxNQUFBLElBQUksQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQywwQ0FBRSxNQUFNLENBQUMsQ0FBQyxDQUFDLENBQUM7U0FDNUI7UUFDRCxJQUFJLENBQUEsTUFBQSxJQUFJLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsMENBQUUsSUFBSSxNQUFLLENBQUMsRUFBRTtZQUMvQixJQUFJLENBQUMsR0FBRyxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsQ0FBQztTQUNwQjtRQUVELG1CQUFtQjtRQUNuQixNQUFBLE1BQUEsSUFBSSxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLDBDQUFFLEdBQUcsQ0FBQyxDQUFDLENBQUMsMENBQUUsTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQ25DLElBQUksQ0FBQSxNQUFBLE1BQUEsSUFBSSxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLDBDQUFFLEdBQUcsQ0FBQyxDQUFDLENBQUMsMENBQUUsSUFBSSxNQUFLLENBQUMsRUFBRTtZQUN2QyxNQUFBLElBQUksQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQywwQ0FBRSxNQUFNLENBQUMsQ0FBQyxDQUFDLENBQUM7U0FDNUI7UUFDRCxJQUFJLENBQUEsTUFBQSxJQUFJLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsMENBQUUsSUFBSSxNQUFLLENBQUMsRUFBRTtZQUMvQixJQUFJLENBQUMsR0FBRyxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsQ0FBQztTQUNwQjtRQUVELG1CQUFtQjtRQUNuQixNQUFBLE1BQUEsSUFBSSxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLDBDQUFFLEdBQUcsQ0FBQyxDQUFDLENBQUMsMENBQUUsTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQ25DLElBQUksQ0FBQSxNQUFBLE1BQUEsSUFBSSxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLDBDQUFFLEdBQUcsQ0FBQyxDQUFDLENBQUMsMENBQUUsSUFBSSxNQUFLLENBQUMsRUFBRTtZQUN2QyxNQUFBLElBQUksQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQywwQ0FBRSxNQUFNLENBQUMsQ0FBQyxDQUFDLENBQUM7U0FDNUI7UUFDRCxJQUFJLENB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QyxDQUFDLFFBQVEsRUFBRSxDQUFDO2FBQ3RCLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztJQUNoQixDQUFDO0lBRUQ7O09BRUc7SUFDSCxLQUFLO1FBQ0gsT0FBTyxJQUFJLEtBQUssQ0FBQyxJQUFJLENBQUMsT0FBTyxFQUFFLENBQUMsQ0FBQztJQUNuQyxDQUFDO0lBR0Q7O09BRUc7SUFDSCxNQUFNLENBQUMsS0FBWTtRQUNqQixJQUFJLElBQUksQ0FBQyxJQUFJLEVBQUUsS0FBSyxLQUFLLENBQUMsSUFBSSxFQUFFO1lBQUUsT0FBTyxLQUFLLENBQUM7UUFFL0MsS0FBSyxNQUFNLE1BQU0sSUFBSSxJQUFJLENBQUMsT0FBTyxFQUFFO1lBQ2pDLElBQUksQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLE1BQU0sQ0FBQztnQkFBRSxPQUFPLEtBQUssQ0FBQztTQUN0QztRQUVELE9BQU8sSUFBSSxDQUFDO0lBQ2QsQ0FBQztDQUNGO0FBdFNELHNCQXNTQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyIvVXNlcnMva2l0ZWxldi9Eb2N1bWVudHMvZXhvY29ydGV4LW9ic2lkaWFuLXBsdWdpbi9zcmMvZG9tYWluL3NlbWFudGljL2NvcmUvR3JhcGgudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBSREYgR3JhcGggaW1wbGVtZW50YXRpb24gZm9yIG1hbmFnaW5nIGNvbGxlY3Rpb25zIG9mIHRyaXBsZXNcbiAqIFByb3ZpZGVzIGVmZmljaWVudCBxdWVyeWluZyBhbmQgbWFuaXB1bGF0aW9uIG9mIHNlbWFudGljIGRhdGFcbiAqL1xuXG5pbXBvcnQgeyBUcmlwbGUsIElSSSwgQmxhbmtOb2RlLCBMaXRlcmFsIH0gZnJvbSAnLi9UcmlwbGUnO1xuaW1wb3J0IHsgUmVzdWx0IH0gZnJvbSAnLi4vLi4vY29yZS9SZXN1bHQnO1xuXG5leHBvcnQgdHlwZSBOb2RlID0gSVJJIHwgQmxhbmtOb2RlIHwgTGl0ZXJhbDtcbmV4cG9ydCB0eXBlIFN1YmplY3QgPSBJUkkgfCBCbGFua05vZGU7XG5leHBvcnQgdHlwZSBQcmVkaWNhdGUgPSBJUkk7XG5leHBvcnQgdHlwZSBPYmplY3QgPSBOb2RlO1xuXG4vKipcbiAqIFJERiBHcmFwaCAtIEEgY29sbGVjdGlvbiBvZiBSREYgdHJpcGxlc1xuICovXG5leHBvcnQgY2xhc3MgR3JhcGgge1xuICBwcml2YXRlIHRyaXBsZXM6IFNldDxUcmlwbGU+ID0gbmV3IFNldCgpO1xuICBwcml2YXRlIHNwbzogTWFwPHN0cmluZywgTWFwPHN0cmluZywgU2V0PHN0cmluZz4+PiA9IG5ldyBNYXAoKTtcbiAgcHJpdmF0ZSBwb3M6IE1hcDxzdHJpbmcsIE1hcDxzdHJpbmcsIFNldDxzdHJpbmc+Pj4gPSBuZXcgTWFwKCk7XG4gIHByaXZhdGUgb3NwOiBNYXA8c3RyaW5nLCBNYXA8c3RyaW5nLCBTZXQ8c3RyaW5nPj4+ID0gbmV3IE1hcCgpO1xuXG4gIGNvbnN0cnVjdG9yKHRyaXBsZXM6IFRyaXBsZVtdID0gW10pIHtcbiAgICBmb3IgKGNvbnN0IHRyaXBsZSBvZiB0cmlwbGVzKSB7XG4gICAgICB0aGlzLmFkZCh0cmlwbGUpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBBZGQgYSB0cmlwbGUgdG8gdGhlIGdyYXBoXG4gICAqL1xuICBhZGQodHJpcGxlOiBUcmlwbGUpOiB2b2lkIHtcbiAgICBpZiAodGhpcy5oYXModHJpcGxlKSkgcmV0dXJuO1xuICAgIFxuICAgIHRoaXMudHJpcGxlcy5hZGQodHJpcGxlKTtcbiAgICBcbiAgICBjb25zdCBzID0gdHJpcGxlLmdldFN1YmplY3QoKS50b1N0cmluZygpO1xuICAgIGNvbnN0IHAgPSB0cmlwbGUuZ2V0UHJlZGljYXRlKCkudG9TdHJpbmcoKTtcbiAgICBjb25zdCBvID0gdHJpcGxlLmdldE9iamVjdCgpLnRvU3RyaW5nKCk7XG4gICAgXG4gICAgLy8gVXBkYXRlIFNQTyBpbmRleFxuICAgIGlmICghdGhpcy5zcG8uaGFzKHMpKSB0aGlzLnNwby5zZXQocywgbmV3IE1hcCgpKTtcbiAgICBpZiAoIXRoaXMuc3BvLmdldChzKSEuaGFzKHApKSB0aGlzLnNwby5nZXQocykhLnNldChwLCBuZXcgU2V0KCkpO1xuICAgIHRoaXMuc3BvLmdldChzKSEuZ2V0KHApIS5hZGQobyk7XG4gICAgXG4gICAgLy8gVXBkYXRlIFBPUyBpbmRleFxuICAgIGlmICghdGhpcy5wb3MuaGFzKHApKSB0aGlzLnBvcy5zZXQocCwgbmV3IE1hcCgpKTtcbiAgICBpZiAoIXRoaXMucG9zLmdldChwKSEuaGFzKG8pKSB0aGlzLnBvcy5nZXQocCkhLnNldChvLCBuZXcgU2V0KCkpO1xuICAgIHRoaXMucG9zLmdldChwKSEuZ2V0KG8pIS5hZGQocyk7XG4gICAgXG4gICAgLy8gVXBkYXRlIE9TUCBpbmRleFxuICAgIGlmICghdGhpcy5vc3AuaGFzKG8pKSB0aGlzLm9zcC5zZXQobywgbmV3IE1hcCgpKTtcbiAgICBpZiAoIXRoaXMub3NwLmdldChvKSEuaGFzKHMpKSB0aGlzLm9zcC5nZXQobykhLnNldChzLCBuZXcgU2V0KCkpO1xuICAgIHRoaXMub3NwLmdldChvKSEuZ2V0KHMpIS5hZGQocCk7XG4gIH1cblxuICAvKipcbiAgICogUmVtb3ZlIGEgdHJpcGxlIGZyb20gdGhlIGdyYXBoXG4gICAqL1xuICByZW1vdmUodHJpcGxlOiBUcmlwbGUpOiB2b2lkIHtcbiAgICBpZiAoIXRoaXMuaGFzKHRyaXBsZSkpIHJldHVybjtcbiAgICBcbiAgICB0aGlzLnRyaXBsZXMuZGVsZXRlKHRyaXBsZSk7XG4gICAgXG4gICAgY29uc3QgcyA9IHRyaXBsZS5nZXRTdWJqZWN0KCkudG9TdHJpbmcoKTtcbiAgICBjb25zdCBwID0gdHJpcGxlLmdldFByZWRpY2F0ZSgpLnRvU3RyaW5nKCk7XG4gICAgY29uc3QgbyA9IHRyaXBsZS5nZXRPYmplY3QoKS50b1N0cmluZygpO1xuICAgIFxuICAgIC8vIFVwZGF0ZSBTUE8gaW5kZXhcbiAgICB0aGlzLnNwby5nZXQocyk/LmdldChwKT8uZGVsZXRlKG8pO1xuICAgIGlmICh0aGlzLnNwby5nZXQocyk/LmdldChwKT8uc2l6ZSA9PT0gMCkge1xuICAgICAgdGhpcy5zcG8uZ2V0KHMpPy5kZWxldGUocCk7XG4gICAgfVxuICAgIGlmICh0aGlzLnNwby5nZXQocyk/LnNpemUgPT09IDApIHtcbiAgICAgIHRoaXMuc3BvLmRlbGV0ZShzKTtcbiAgICB9XG4gICAgXG4gICAgLy8gVXBkYXRlIFBPUyBpbmRleFxuICAgIHRoaXMucG9zLmdldChwKT8uZ2V0KG8pPy5kZWxldGUocyk7XG4gICAgaWYgKHRoaXMucG9zLmdldChwKT8uZ2V0KG8pPy5zaXplID09PSAwKSB7XG4gICAgICB0aGlzLnBvcy5nZXQocCk/LmRlbGV0ZShvKTtcbiAgICB9XG4gICAgaWYgKHRoaXMucG9zLmdldChwKT8uc2l6ZSA9PT0gMCkge1xuICAgICAgdGhpcy5wb3MuZGVsZXRlKHApO1xuICAgIH1cbiAgICBcbiAgICAvLyBVcGRhdGUgT1NQIGluZGV4XG4gICAgdGhpcy5vc3AuZ2V0KG8pPy5nZXQocyk/LmRlbGV0ZShwKTtcbiAgICBpZiAodGhpcy5vc3AuZ2V0KG8pPy5nZXQocyk/LnNpemUgPT09IDApIHtcbiAgICAgIHRoaXMub3NwLmdldChvKT8uZGVsZXRlKHMpO1xuICAgIH1cbiAgICBpZiAodGhpcy5vc3AuZ2V0KG8pPy5zaXplID09PSAwKSB7XG4gICAgICB0aGlzLm9zcC5kZWxldGUobyk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIENoZWNrIGlmIHRoZSBncmFwaCBjb250YWlucyBhIHRyaXBsZVxuICAgKi9cbiAgaGFzKHRyaXBsZTogVHJpcGxlKTogYm9vbGVhbiB7XG4gICAgY29uc3QgcyA9IHRyaXBsZS5nZXRTdWJqZWN0KCkudG9TdHJpbmcoKTtcbiAgICBjb25zdCBwID0gdHJpcGxlLmdldFByZWRpY2F0ZSgpLnRvU3RyaW5nKCk7XG4gICAgY29uc3QgbyA9IHRyaXBsZS5nZXRPYmplY3QoKS50b1N0cmluZygpO1xuICAgIFxuICAgIHJldHVybiB0aGlzLnNwby5nZXQocyk/LmdldChwKT8uaGFzKG8pID8/IGZhbHNlO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldCBhbGwgdHJpcGxlcyBtYXRjaGluZyBhIHBhdHRlcm5cbiAgICogbnVsbCB2YWx1ZXMgYWN0IGFzIHdpbGRjYXJkc1xuICAgKi9cbiAgbWF0Y2goXG4gICAgc3ViamVjdDogU3ViamVjdCB8IG51bGwgPSBudWxsLFxuICAgIHByZWRpY2F0ZTogUHJlZGljYXRlIHwgbnVsbCA9IG51bGwsXG4gICAgb2JqZWN0OiBPYmplY3QgfCBudWxsID0gbnVsbFxuICApOiBUcmlwbGVbXSB7XG4gICAgY29uc3QgcmVzdWx0czogVHJpcGxlW10gPSBbXTtcbiAgICBcbiAgICBpZiAoc3ViamVjdCAmJiBwcmVkaWNhdGUgJiYgb2JqZWN0KSB7XG4gICAgICAvLyBFeGFjdCBtYXRjaFxuICAgICAgZm9yIChjb25zdCB0cmlwbGUgb2YgdGhpcy50cmlwbGVzKSB7XG4gICAgICAgIGlmIChcbiAgICAgICAgICB0cmlwbGUuZ2V0U3ViamVjdCgpLnRvU3RyaW5nKCkgPT09IHN1YmplY3QudG9TdHJpbmcoKSAmJlxuICAgICAgICAgIHRyaXBsZS5nZXRQcmVkaWNhdGUoKS50b1N0cmluZygpID09PSBwcmVkaWNhdGUudG9TdHJpbmcoKSAmJlxuICAgICAgICAgIHRyaXBsZS5nZXRPYmplY3QoKS50b1N0cmluZygpID09PSBvYmplY3QudG9TdHJpbmcoKVxuICAgICAgICApIHtcbiAgICAgICAgICByZXN1bHRzLnB1c2godHJpcGxlKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0gZWxzZSBpZiAoc3ViamVjdCAmJiBwcmVkaWNhdGUpIHtcbiAgICAgIC8vIFMgUCA/XG4gICAgICBjb25zdCBvYmplY3RzID0gdGhpcy5zcG8uZ2V0KHN1YmplY3QudG9TdHJpbmcoKSk/LmdldChwcmVkaWNhdGUudG9TdHJpbmcoKSk7XG4gICAgICBpZiAob2JqZWN0cykge1xuICAgICAgICBmb3IgKGNvbnN0IHRyaXBsZSBvZiB0aGlzLnRyaXBsZXMpIHtcbiAgICAgICAgICBpZiAoXG4gICAgICAgICAgICB0cmlwbGUuZ2V0U3ViamVjdCgpLnRvU3RyaW5nKCkgPT09IHN1YmplY3QudG9TdHJpbmcoKSAmJlxuICAgICAgICAgICAgdHJpcGxlLmdldFByZWRpY2F0ZSgpLnRvU3RyaW5nKCkgPT09IHByZWRpY2F0ZS50b1N0cmluZygpXG4gICAgICAgICAgKSB7XG4gICAgICAgICAgICByZXN1bHRzLnB1c2godHJpcGxlKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9IGVsc2UgaWYgKHByZWRpY2F0ZSAmJiBvYmplY3QpIHtcbiAgICAgIC8vID8gUCBPXG4gICAgICBjb25zdCBzdWJqZWN0cyA9IHRoaXMucG9zLmdldChwcmVkaWNhdGUudG9TdHJpbmcoKSk/LmdldChvYmplY3QudG9TdHJpbmcoKSk7XG4gICAgICBpZiAoc3ViamVjdHMpIHtcbiAgICAgICAgZm9yIChjb25zdCB0cmlwbGUgb2YgdGhpcy50cmlwbGVzKSB7XG4gICAgICAgICAgaWYgKFxuICAgICAgICAgICAgdHJpcGxlLmdldFByZWRpY2F0ZSgpLnRvU3RyaW5nKCkgPT09IHByZWRpY2F0ZS50b1N0cmluZygpICYmXG4gICAgICAgICAgICB0cmlwbGUuZ2V0T2JqZWN0KCkudG9TdHJpbmcoKSA9PT0gb2JqZWN0LnRvU3RyaW5nKClcbiAgICAgICAgICApIHtcbiAgICAgICAgICAgIHJlc3VsdHMucHVzaCh0cmlwbGUpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0gZWxzZSBpZiAoc3ViamVjdCAmJiBvYmplY3QpIHtcbiAgICAgIC8vIFMgPyBPXG4gICAgICBjb25zdCBwcmVkaWNhdGVzID0gdGhpcy5vc3AuZ2V0KG9iamVjdC50b1N0cmluZygpKT8uZ2V0KHN1YmplY3QudG9TdHJpbmcoKSk7XG4gICAgICBpZiAocHJlZGljYXRlcykge1xuICAgICAgICBmb3IgKGNvbnN0IHRyaXBsZSBvZiB0aGlzLnRyaXBsZXMpIHtcbiAgICAgICAgICBpZiAoXG4gICAgICAgICAgICB0cmlwbGUuZ2V0U3ViamVjdCgpLnRvU3RyaW5nKCkgPT09IHN1YmplY3QudG9TdHJpbmcoKSAmJlxuICAgICAgICAgICAgdHJpcGxlLmdldE9iamVjdCgpLnRvU3RyaW5nKCkgPT09IG9iamVjdC50b1N0cmluZygpXG4gICAgICAgICAgKSB7XG4gICAgICAgICAgICByZXN1bHRzLnB1c2godHJpcGxlKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9IGVsc2UgaWYgKHN1YmplY3QpIHtcbiAgICAgIC8vIFMgPyA/XG4gICAgICBmb3IgKGNvbnN0IHRyaXBsZSBvZiB0aGlzLnRyaXBsZXMpIHtcbiAgICAgICAgaWYgKHRyaXBsZS5nZXRTdWJqZWN0KCkudG9TdHJpbmcoKSA9PT0gc3ViamVjdC50b1N0cmluZygpKSB7XG4gICAgICAgICAgcmVzdWx0cy5wdXNoKHRyaXBsZSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9IGVsc2UgaWYgKHByZWRpY2F0ZSkge1xuICAgICAgLy8gPyBQID9cbiAgICAgIGZvciAoY29uc3QgdHJpcGxlIG9mIHRoaXMudHJpcGxlcykge1xuICAgICAgICBpZiAodHJpcGxlLmdldFByZWRpY2F0ZSgpLnRvU3RyaW5nKCkgPT09IHByZWRpY2F0ZS50b1N0cmluZygpKSB7XG4gICAgICAgICAgcmVzdWx0cy5wdXNoKHRyaXBsZSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9IGVsc2UgaWYgKG9iamVjdCkge1xuICAgICAgLy8gPyA/IE9cbiAgICAgIGZvciAoY29uc3QgdHJpcGxlIG9mIHRoaXMudHJpcGxlcykge1xuICAgICAgICBpZiAodHJpcGxlLmdldE9iamVjdCgpLnRvU3RyaW5nKCkgPT09IG9iamVjdC50b1N0cmluZygpKSB7XG4gICAgICAgICAgcmVzdWx0cy5wdXNoKHRyaXBsZSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgLy8gPyA/ID8gLSByZXR1cm4gYWxsXG4gICAgICByZXR1cm4gQXJyYXkuZnJvbSh0aGlzLnRyaXBsZXMpO1xuICAgIH1cbiAgICBcbiAgICByZXR1cm4gcmVzdWx0cztcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgYWxsIHN1YmplY3RzIGluIHRoZSBncmFwaFxuICAgKi9cbiAgc3ViamVjdHMoKTogU2V0PFN1YmplY3Q+IHtcbiAgICBjb25zdCBzdWJqZWN0cyA9IG5ldyBTZXQ8U3ViamVjdD4oKTtcbiAgICBmb3IgKGNvbnN0IHRyaXBsZSBvZiB0aGlzLnRyaXBsZXMpIHtcbiAgICAgIHN1YmplY3RzLmFkZCh0cmlwbGUuZ2V0U3ViamVjdCgpKTtcbiAgICB9XG4gICAgcmV0dXJuIHN1YmplY3RzO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldCBhbGwgcHJlZGljYXRlcyBpbiB0aGUgZ3JhcGhcbiAgICovXG4gIHByZWRpY2F0ZXMoKTogU2V0PFByZWRpY2F0ZT4ge1xuICAgIGNvbnN0IHByZWRpY2F0ZXMgPSBuZXcgU2V0PFByZWRpY2F0ZT4oKTtcbiAgICBmb3IgKGNvbnN0IHRyaXBsZSBvZiB0aGlzLnRyaXBsZXMpIHtcbiAgICAgIHByZWRpY2F0ZXMuYWRkKHRyaXBsZS5nZXRQcmVkaWNhdGUoKSk7XG4gICAgfVxuICAgIHJldHVybiBwcmVkaWNhdGVzO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldCBhbGwgb2JqZWN0cyBpbiB0aGUgZ3JhcGhcbiAgICovXG4gIG9iamVjdHMoKTogU2V0PE9iamVjdD4ge1xuICAgIGNvbnN0IG9iamVjdHMgPSBuZXcgU2V0PE9iamVjdD4oKTtcbiAgICBmb3IgKGNvbnN0IHRyaXBsZSBvZiB0aGlzLnRyaXBsZXMpIHtcbiAgICAgIG9iamVjdHMuYWRkKHRyaXBsZS5nZXRPYmplY3QoKSk7XG4gICAgfVxuICAgIHJldHVybiBvYmplY3RzO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldCB0aGUgc2l6ZSBvZiB0aGUgZ3JhcGggKG51bWJlciBvZiB0cmlwbGVzKVxuICAgKi9cbiAgc2l6ZSgpOiBudW1iZXIge1xuICAgIHJldHVybiB0aGlzLnRyaXBsZXMuc2l6ZTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDaGVjayBpZiB0aGUgZ3JhcGggaXMgZW1wdHlcbiAgICovXG4gIGlzRW1wdHkoKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIHRoaXMudHJpcGxlcy5zaXplID09PSAwO1xuICB9XG5cbiAgLyoqXG4gICAqIENsZWFyIGFsbCB0cmlwbGVzIGZyb20gdGhlIGdyYXBoXG4gICAqL1xuICBjbGVhcigpOiB2b2lkIHtcbiAgICB0aGlzLnRyaXBsZXMuY2xlYXIoKTtcbiAgICB0aGlzLnNwby5jbGVhcigpO1xuICAgIHRoaXMucG9zLmNsZWFyKCk7XG4gICAgdGhpcy5vc3AuY2xlYXIoKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBNZXJnZSBhbm90aGVyIGdyYXBoIGludG8gdGhpcyBvbmVcbiAgICovXG4gIG1lcmdlKG90aGVyOiBHcmFwaCk6IHZvaWQge1xuICAgIGZvciAoY29uc3QgdHJpcGxlIG9mIG90aGVyLnRvQXJyYXkoKSkge1xuICAgICAgdGhpcy5hZGQodHJpcGxlKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogQ3JlYXRlIGEgbmV3IGdyYXBoIHdpdGggdHJpcGxlcyBtYXRjaGluZyBhIHBhdHRlcm5cbiAgICovXG4gIGZpbHRlcihcbiAgICBzdWJqZWN0OiBTdWJqZWN0IHwgbnVsbCA9IG51bGwsXG4gICAgcHJlZGljYXRlOiBQcmVkaWNhdGUgfCBudWxsID0gbnVsbCxcbiAgICBvYmplY3Q6IE9iamVjdCB8IG51bGwgPSBudWxsXG4gICk6IEdyYXBoIHtcbiAgICByZXR1cm4gbmV3IEdyYXBoKHRoaXMubWF0Y2goc3ViamVjdCwgcHJlZGljYXRlLCBvYmplY3QpKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDb252ZXJ0IHRoZSBncmFwaCB0byBhbiBhcnJheSBvZiB0cmlwbGVzXG4gICAqL1xuICB0b0FycmF5KCk6IFRyaXBsZVtdIHtcbiAgICByZXR1cm4gQXJyYXkuZnJvbSh0aGlzLnRyaXBsZXMpO1xuICB9XG5cbiAgLyoqXG4gICAqIENyZWF0ZSBhIGh1bWFuLXJlYWRhYmxlIHN0cmluZyByZXByZXNlbnRhdGlvblxuICAgKi9cbiAgdG9TdHJpbmcoKTogc3RyaW5nIHtcbiAgICByZXR1cm4gQXJyYXkuZnJvbSh0aGlzLnRyaXBsZXMpXG4gICAgICAubWFwKHQgPT4gdC50b1N0cmluZygpKVxuICAgICAgLmpvaW4oJ1xcbicpO1xuICB9XG5cbiAgLyoqXG4gICAqIENyZWF0ZSBhIGNvcHkgb2YgdGhpcyBncmFwaFxuICAgKi9cbiAgY2xvbmUoKTogR3JhcGgge1xuICAgIHJldHVybiBuZXcgR3JhcGgodGhpcy50b0FycmF5KCkpO1xuICB9XG5cblxuICAvKipcbiAgICogQ2hlY2sgaWYgdHdvIGdyYXBocyBhcmUgZXF1YWxcbiAgICovXG4gIGVxdWFscyhvdGhlcjogR3JhcGgpOiBib29sZWFuIHtcbiAgICBpZiAodGhpcy5zaXplKCkgIT09IG90aGVyLnNpemUoKSkgcmV0dXJuIGZhbHNlO1xuICAgIFxuICAgIGZvciAoY29uc3QgdHJpcGxlIG9mIHRoaXMudHJpcGxlcykge1xuICAgICAgaWYgKCFvdGhlci5oYXModHJpcGxlKSkgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICBcbiAgICByZXR1cm4gdHJ1ZTtcbiAgfVxufSJdLCJ2ZXJzaW9uIjozfQ==