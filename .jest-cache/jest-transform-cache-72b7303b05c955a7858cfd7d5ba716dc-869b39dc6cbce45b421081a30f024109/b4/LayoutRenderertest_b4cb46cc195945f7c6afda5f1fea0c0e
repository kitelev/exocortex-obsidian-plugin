872f616b8d7f60737b408fce4936807c
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const LayoutRenderer_1 = require("../../../../src/presentation/renderers/LayoutRenderer");
const obsidian_1 = require("../../../__mocks__/obsidian");
const ClassLayout_1 = require("../../../../src/domain/entities/ClassLayout");
const Result_1 = require("../../../../src/domain/core/Result");
describe("LayoutRenderer", () => {
    let renderer;
    let mockVault;
    let mockApp;
    beforeEach(() => {
        mockVault = new obsidian_1.Vault();
        mockApp = new obsidian_1.App();
        const mockLayoutRepository = {
            findByClassName: jest
                .fn()
                .mockResolvedValue(Result_1.Result.fail("No layout found")),
            save: jest.fn().mockResolvedValue(Result_1.Result.ok(undefined)),
            findAll: jest.fn().mockResolvedValue(Result_1.Result.ok([])),
        };
        const mockPropertyRenderer = {
            renderPropertiesBlock: jest.fn(),
        };
        renderer = new LayoutRenderer_1.LayoutRenderer(mockApp, mockLayoutRepository, mockPropertyRenderer);
    });
    describe("renderLayout", () => {
        it("should render empty layout for null input", () => {
            const container = document.createElement("div");
            renderer.renderLayout(null, container);
            expect(container.children.length).toBe(0);
        });
        it("should render basic layout structure", () => {
            const container = document.createElement("div");
            const layout = ClassLayout_1.ClassLayout.create({
                id: "test-layout",
                className: "TestClass",
                config: {
                    blocks: [
                        {
                            id: "block1",
                            type: "properties",
                            title: "Properties",
                            config: {},
                        },
                    ],
                },
            });
            if (layout.isSuccess) {
                renderer.renderLayout(layout.value, container);
                expect(container.children.length).toBeGreaterThan(0);
                expect(container.querySelector('[data-block-id="block1"]')).toBeTruthy();
            }
        });
        it("should handle blocks with different types", () => {
            const container = document.createElement("div");
            const layout = ClassLayout_1.ClassLayout.create({
                id: "test-layout",
                className: "TestClass",
                config: {
                    blocks: [
                        {
                            id: "props",
                            type: "properties",
                            title: "Properties",
                            config: {},
                        },
                        {
                            id: "backlinks",
                            type: "backlinks",
                            title: "Backlinks",
                            config: {},
                        },
                        {
                            id: "query",
                            type: "query",
                            title: "Query",
                            config: { query: "SELECT * WHERE { ?s ?p ?o }" },
                        },
                    ],
                },
            });
            if (layout.isSuccess) {
                renderer.renderLayout(layout.value, container);
                expect(container.querySelector('[data-block-id="props"]')).toBeTruthy();
                expect(container.querySelector('[data-block-id="backlinks"]')).toBeTruthy();
                expect(container.querySelector('[data-block-id="query"]')).toBeTruthy();
            }
        });
        it("should handle block rendering errors gracefully", () => {
            const container = document.createElement("div");
            const layout = ClassLayout_1.ClassLayout.create({
                id: "test-layout",
                className: "TestClass",
                config: {
                    blocks: [
                        {
                            id: "invalid-block",
                            type: "nonexistent-type",
                            title: "Invalid",
                            config: {},
                        },
                    ],
                },
            });
            if (layout.isSuccess) {
                expect(() => {
                    renderer.renderLayout(layout.value, container);
                }).not.toThrow();
                // Should still create container for the block even if rendering fails
                expect(container.children.length).toBeGreaterThan(0);
            }
        });
        it("should apply custom CSS classes", () => {
            const container = document.createElement("div");
            const layout = ClassLayout_1.ClassLayout.create({
                id: "test-layout",
                className: "TestClass",
                config: {
                    cssClass: "custom-layout-class",
                    blocks: [],
                },
            });
            if (layout.isSuccess) {
                renderer.renderLayout(layout.value, container);
                expect(container.classList.contains("custom-layout-class")).toBe(true);
            }
        });
        it("should handle empty blocks array", () => {
            const container = document.createElement("div");
            const layout = ClassLayout_1.ClassLayout.create({
                id: "test-layout",
                className: "TestClass",
                config: {
                    blocks: [],
                },
            });
            if (layout.isSuccess) {
                renderer.renderLayout(layout.value, container);
                expect(container.children.length).toBe(0);
            }
        });
    });
    describe("block rendering", () => {
        it("should render properties block", () => {
            const container = document.createElement("div");
            const layout = ClassLayout_1.ClassLayout.create({
                id: "test-layout",
                className: "TestClass",
                config: {
                    blocks: [
                        {
                            id: "props",
                            type: "properties",
                            title: "Test Properties",
                            config: {
                                properties: ["name", "description", "type"],
                            },
                        },
                    ],
                },
            });
            if (layout.isSuccess) {
                renderer.renderLayout(layout.value, container);
                const blockElement = container.querySelector('[data-block-id="props"]');
                expect(blockElement).toBeTruthy();
                expect(blockElement?.textContent).toContain("Test Properties");
            }
        });
        it("should render backlinks block", () => {
            const container = document.createElement("div");
            const layout = ClassLayout_1.ClassLayout.create({
                id: "test-layout",
                className: "TestClass",
                config: {
                    blocks: [
                        {
                            id: "backlinks",
                            type: "backlinks",
                            title: "Related Notes",
                            config: {},
                        },
                    ],
                },
            });
            if (layout.isSuccess) {
                renderer.renderLayout(layout.value, container);
                const blockElement = container.querySelector('[data-block-id="backlinks"]');
                expect(blockElement).toBeTruthy();
                expect(blockElement?.textContent).toContain("Related Notes");
            }
        });
        it("should render query block with SPARQL", () => {
            const container = document.createElement("div");
            const layout = ClassLayout_1.ClassLayout.create({
                id: "test-layout",
                className: "TestClass",
                config: {
                    blocks: [
                        {
                            id: "query",
                            type: "query",
                            title: "SPARQL Results",
                            config: {
                                query: "SELECT ?s ?p ?o WHERE { ?s ?p ?o } LIMIT 10",
                            },
                        },
                    ],
                },
            });
            if (layout.isSuccess) {
                renderer.renderLayout(layout.value, container);
                const blockElement = container.querySelector('[data-block-id="query"]');
                expect(blockElement).toBeTruthy();
                expect(blockElement?.textContent).toContain("SPARQL Results");
            }
        });
    });
    describe("error handling", () => {
        it("should handle undefined container", () => {
            const layout = ClassLayout_1.ClassLayout.create({
                id: "test-layout",
                className: "TestClass",
                config: { blocks: [] },
            });
            if (layout.isSuccess) {
                expect(() => {
                    renderer.renderLayout(layout.value, undefined);
                }).not.toThrow();
            }
        });
        it("should handle malformed layout config", () => {
            const container = document.createElement("div");
            expect(() => {
                renderer.renderLayout({}, container);
            }).not.toThrow();
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL2tpdGVsZXYvRG9jdW1lbnRzL2V4b2NvcnRleC1vYnNpZGlhbi1wbHVnaW4vdGVzdHMvdW5pdC9wcmVzZW50YXRpb24vcmVuZGVyZXJzL0xheW91dFJlbmRlcmVyLnRlc3QudHMiLCJtYXBwaW5ncyI6Ijs7QUFBQSwwRkFBdUY7QUFDdkYsMERBQXlEO0FBQ3pELDZFQUEwRTtBQUMxRSwrREFBNEQ7QUFFNUQsUUFBUSxDQUFDLGdCQUFnQixFQUFFLEdBQUcsRUFBRTtJQUM5QixJQUFJLFFBQXdCLENBQUM7SUFDN0IsSUFBSSxTQUFnQixDQUFDO0lBQ3JCLElBQUksT0FBWSxDQUFDO0lBRWpCLFVBQVUsQ0FBQyxHQUFHLEVBQUU7UUFDZCxTQUFTLEdBQUcsSUFBSSxnQkFBSyxFQUFFLENBQUM7UUFDeEIsT0FBTyxHQUFHLElBQUksY0FBRyxFQUFFLENBQUM7UUFDcEIsTUFBTSxvQkFBb0IsR0FBRztZQUMzQixlQUFlLEVBQUUsSUFBSTtpQkFDbEIsRUFBRSxFQUFFO2lCQUNKLGlCQUFpQixDQUFDLGVBQU0sQ0FBQyxJQUFJLENBQUMsaUJBQWlCLENBQUMsQ0FBQztZQUNwRCxJQUFJLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRSxDQUFDLGlCQUFpQixDQUFDLGVBQU0sQ0FBQyxFQUFFLENBQUMsU0FBUyxDQUFDLENBQUM7WUFDdkQsT0FBTyxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUUsQ0FBQyxpQkFBaUIsQ0FBQyxlQUFNLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFDO1NBQ3BELENBQUM7UUFDRixNQUFNLG9CQUFvQixHQUFHO1lBQzNCLHFCQUFxQixFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7U0FDakMsQ0FBQztRQUNGLFFBQVEsR0FBRyxJQUFJLCtCQUFjLENBQzNCLE9BQWMsRUFDZCxvQkFBMkIsRUFDM0Isb0JBQTJCLENBQzVCLENBQUM7SUFDSixDQUFDLENBQUMsQ0FBQztJQUVILFFBQVEsQ0FBQyxjQUFjLEVBQUUsR0FBRyxFQUFFO1FBQzVCLEVBQUUsQ0FB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Ryx5QkFBVyxDQUFDLE1BQU0sQ0FBQztnQkFDaEMsRUFBRSxFQUFFLGFBQWE7Z0JBQ2pCLFNBQVMsRUFBRSxXQUFXO2dCQUN0QixNQUFNLEVBQUUsRUFBRSxNQUFNLEVBQUUsRUFBRSxFQUFFO2FBQ3ZCLENBQUMsQ0FBQztZQUVILElBQUksTUFBTSxDQUFDLFNBQVMsRUFBRTtnQkFDcEIsTUFBTSxDQUFDLEdBQUcsRUFBRTtvQkFDVixRQUFRLENBQUMsWUFBWSxDQUFDLE1BQU0sQ0FBQyxLQUFLLEVBQUUsU0FBZ0IsQ0FBQyxDQUFDO2dCQUN4RCxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsT0FBTyxFQUFFLENBQUM7YUFDbEI7UUFDSCxDQUFDLENBQUMsQ0FBQztRQUVILEVBQUUsQ0FBQyx1Q0FBdUMsRUFBRSxHQUFHLEVBQUU7WUFDL0MsTUFBTSxTQUFTLEdBQUcsUUFBUSxDQUFDLGFBQWEsQ0FBQyxLQUFLLENBQUMsQ0FBQztZQUVoRCxNQUFNLENBQUMsR0FBRyxFQUFFO2dCQUNWLFFBQVEsQ0FBQyxZQUFZLENBQUMsRUFBUyxFQUFFLFNBQVMsQ0FBQyxDQUFDO1lBQzlDLENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxPQUFPLEVBQUUsQ0FBQztRQUNuQixDQUFDLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0FBQ0wsQ0FBQyxDQUFDLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL1VzZXJzL2tpdGVsZXYvRG9jdW1lbnRzL2V4b2NvcnRleC1vYnNpZGlhbi1wbHVnaW4vdGVzdHMvdW5pdC9wcmVzZW50YXRpb24vcmVuZGVyZXJzL0xheW91dFJlbmRlcmVyLnRlc3QudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgTGF5b3V0UmVuZGVyZXIgfSBmcm9tIFwiLi4vLi4vLi4vLi4vc3JjL3ByZXNlbnRhdGlvbi9yZW5kZXJlcnMvTGF5b3V0UmVuZGVyZXJcIjtcbmltcG9ydCB7IFZhdWx0LCBBcHAgfSBmcm9tIFwiLi4vLi4vLi4vX19tb2Nrc19fL29ic2lkaWFuXCI7XG5pbXBvcnQgeyBDbGFzc0xheW91dCB9IGZyb20gXCIuLi8uLi8uLi8uLi9zcmMvZG9tYWluL2VudGl0aWVzL0NsYXNzTGF5b3V0XCI7XG5pbXBvcnQgeyBSZXN1bHQgfSBmcm9tIFwiLi4vLi4vLi4vLi4vc3JjL2RvbWFpbi9jb3JlL1Jlc3VsdFwiO1xuXG5kZXNjcmliZShcIkxheW91dFJlbmRlcmVyXCIsICgpID0+IHtcbiAgbGV0IHJlbmRlcmVyOiBMYXlvdXRSZW5kZXJlcjtcbiAgbGV0IG1vY2tWYXVsdDogVmF1bHQ7XG4gIGxldCBtb2NrQXBwOiBBcHA7XG5cbiAgYmVmb3JlRWFjaCgoKSA9PiB7XG4gICAgbW9ja1ZhdWx0ID0gbmV3IFZhdWx0KCk7XG4gICAgbW9ja0FwcCA9IG5ldyBBcHAoKTtcbiAgICBjb25zdCBtb2NrTGF5b3V0UmVwb3NpdG9yeSA9IHtcbiAgICAgIGZpbmRCeUNsYXNzTmFtZTogamVzdFxuICAgICAgICAuZm4oKVxuICAgICAgICAubW9ja1Jlc29sdmVkVmFsdWUoUmVzdWx0LmZhaWwoXCJObyBsYXlvdXQgZm91bmRcIikpLFxuICAgICAgc2F2ZTogamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKFJlc3VsdC5vayh1bmRlZmluZWQpKSxcbiAgICAgIGZpbmRBbGw6IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZShSZXN1bHQub2soW10pKSxcbiAgICB9O1xuICAgIGNvbnN0IG1vY2tQcm9wZXJ0eVJlbmRlcmVyID0ge1xuICAgICAgcmVuZGVyUHJvcGVydGllc0Jsb2NrOiBqZXN0LmZuKCksXG4gICAgfTtcbiAgICByZW5kZXJlciA9IG5ldyBMYXlvdXRSZW5kZXJlcihcbiAgICAgIG1vY2tBcHAgYXMgYW55LFxuICAgICAgbW9ja0xheW91dFJlcG9zaXRvcnkgYXMgYW55LFxuICAgICAgbW9ja1Byb3BlcnR5UmVuZGVyZXIgYXMgYW55LFxuICAgICk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKFwicmVuZGVyTGF5b3V0XCIsICgpID0+IHtcbiAgICBpdChcInNob3VsZCByZW5kZXIgZW1wdHkgbGF5b3V0IGZvciBudWxsIGlucHV0XCIsICgpID0+IHtcbiAgICAgIGNvbnN0IGNvbnRhaW5lciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG5cbiAgICAgIHJlbmRlcmVyLnJlbmRlckxheW91dChudWxsLCBjb250YWluZXIpO1xuXG4gICAgICBleHBlY3QoY29udGFpbmVyLmNoaWxkcmVuLmxlbmd0aCkudG9CZSgwKTtcbiAgICB9KTtcblxuICAgIGl0KFwic2hvdWxkIHJlbmRlciBiYXNpYyBsYXlvdXQgc3RydWN0dXJlXCIsICgpID0+IHtcbiAgICAgIGNvbnN0IGNvbnRhaW5lciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG4gICAgICBjb25zdCBsYXlvdXQgPSBDbGFzc0xheW91dC5jcmVhdGUoe1xuICAgICAgICBpZDogXCJ0ZXN0LWxheW91dFwiLFxuICAgICAgICBjbGFzc05hbWU6IFwiVGVzdENsYXNzXCIsXG4gICAgICAgIGNvbmZpZzoge1xuICAgICAgICAgIGJsb2NrczogW1xuICAgICAgICAgICAge1xuICAgICAgICAgICAgICBpZDogXCJibG9jazFcIixcbiAgICAgICAgICAgICAgdHlwZTogXCJwcm9wZXJ0aWVzXCIsXG4gICAgICAgICAgICAgIHRpdGxlOiBcIlByb3BlcnRpZXNcIixcbiAgICAgICAgICAgICAgY29uZmlnOiB7fSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgXSxcbiAgICAgICAgfSxcbiAgICAgIH0pO1xuXG4gICAgICBpZiAobGF5b3V0LmlzU3VjY2Vzcykge1xuICAgICAgICByZW5kZXJlci5yZW5kZXJMYXlvdXQobGF5b3V0LnZhbHVlLCBjb250YWluZXIpO1xuXG4gICAgICAgIGV4cGVjdChjb250YWluZXIuY2hpbGRyZW4ubGVuZ3RoKS50b0JlR3JlYXRlclRoYW4oMCk7XG4gICAgICAgIGV4cGVjdChcbiAgICAgICAgICBjb250YWluZXIucXVlcnlTZWxlY3RvcignW2RhdGEtYmxvY2staWQ9XCJibG9jazFcIl0nKSxcbiAgICAgICAgKS50b0JlVHJ1dGh5KCk7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICBpdChcInNob3VsZCBoYW5kbGUgYmxvY2tzIHdpdGggZGlmZmVyZW50IHR5cGVzXCIsICgpID0+IHtcbiAgICAgIGNvbnN0IGNvbnRhaW5lciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG4gICAgICBjb25zdCBsYXlvdXQgPSBDbGFzc0xheW91dC5jcmVhdGUoe1xuICAgICAgICBpZDogXCJ0ZXN0LWxheW91dFwiLFxuICAgICAgICBjbGFzc05hbWU6IFwiVGVzdENsYXNzXCIsXG4gICAgICAgIGNvbmZpZzoge1xuICAgICAgICAgIGJsb2NrczogW1xuICAgICAgICAgICAge1xuICAgICAgICAgICAgICBpZDogXCJwcm9wc1wiLFxuICAgICAgICAgICAgICB0eXBlOiBcInByb3BlcnRpZXNcIixcbiAgICAgICAgICAgICAgdGl0bGU6IFwiUHJvcGVydGllc1wiLFxuICAgICAgICAgICAgICBjb25maWc6IHt9LFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgaWQ6IFwiYmFja2xpbmtzXCIsXG4gICAgICAgICAgICAgIHR5cGU6IFwiYmFja2xpbmtzXCIsXG4gICAgICAgICAgICAgIHRpdGxlOiBcIkJhY2tsaW5rc1wiLFxuICAgICAgICAgICAgICBjb25maWc6IHt9LFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgaWQ6IFwicXVlcnlcIixcbiAgICAgICAgICAgICAgdHlwZTogXCJxdWVyeVwiLFxuICAgICAgICAgICAgICB0aXRsZTogXCJRdWVyeVwiLFxuICAgICAgICAgICAgICBjb25maWc6IHsgcXVlcnk6IFwiU0VMRUNUICogV0hFUkUgeyA/cyA/cCA/byB9XCIgfSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgXSxcbiAgICAgICAgfSxcbiAgICAgIH0pO1xuXG4gICAgICBpZiAobGF5b3V0LmlzU3VjY2Vzcykge1xuICAgICAgICByZW5kZXJlci5yZW5kZXJMYXlvdXQobGF5b3V0LnZhbHVlLCBjb250YWluZXIpO1xuXG4gICAgICAgIGV4cGVjdChjb250YWluZXIucXVlcnlTZWxlY3RvcignW2RhdGEtYmxvY2staWQ9XCJwcm9wc1wiXScpKS50b0JlVHJ1dGh5KCk7XG4gICAgICAgIGV4cGVjdChcbiAgICAgICAgICBjb250YWluZXIucXVlcnlTZWxlY3RvcignW2RhdGEtYmxvY2staWQ9XCJiYWNrbGlua3NcIl0nKSxcbiAgICAgICAgKS50b0JlVHJ1dGh5KCk7XG4gICAgICAgIGV4cGVjdChjb250YWluZXIucXVlcnlTZWxlY3RvcignW2RhdGEtYmxvY2staWQ9XCJxdWVyeVwiXScpKS50b0JlVHJ1dGh5KCk7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICBpdChcInNob3VsZCBoYW5kbGUgYmxvY2sgcmVuZGVyaW5nIGVycm9ycyBncmFjZWZ1bGx5XCIsICgpID0+IHtcbiAgICAgIGNvbnN0IGNvbnRhaW5lciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG4gICAgICBjb25zdCBsYXlvdXQgPSBDbGFzc0xheW91dC5jcmVhdGUoe1xuICAgICAgICBpZDogXCJ0ZXN0LWxheW91dFwiLFxuICAgICAgICBjbGFzc05hbWU6IFwiVGVzdENsYXNzXCIsXG4gICAgICAgIGNvbmZpZzoge1xuICAgICAgICAgIGJsb2NrczogW1xuICAgICAgICAgICAge1xuICAgICAgICAgICAgICBpZDogXCJpbnZhbGlkLWJsb2NrXCIsXG4gICAgICAgICAgICAgIHR5cGU6IFwibm9uZXhpc3RlbnQtdHlwZVwiIGFzIGFueSxcbiAgICAgICAgICAgICAgdGl0bGU6IFwiSW52YWxpZFwiLFxuICAgICAgICAgICAgICBjb25maWc6IHt9LFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICBdLFxuICAgICAgICB9LFxuICAgICAgfSk7XG5cbiAgICAgIGlmIChsYXlvdXQuaXNTdWNjZXNzKSB7XG4gICAgICAgIGV4cGVjdCgoKSA9PiB7XG4gICAgICAgICAgcmVuZGVyZXIucmVuZGVyTGF5b3V0KGxheW91dC52YWx1ZSwgY29udGFpbmVyKTtcbiAgICAgICAgfSkubm90LnRvVGhyb3coKTtcblxuICAgICAgICAvLyBTaG91bGQgc3RpbGwgY3JlYXRlIGNvbnRhaW5lciBmb3IgdGhlIGJsb2NrIGV2ZW4gaWYgcmVuZGVyaW5nIGZhaWxzXG4gICAgICAgIGV4cGVjdChjb250YWluZXIuY2hpbGRyZW4ubGVuZ3RoKS50b0JlR3JlYXRlclRoYW4oMCk7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICBpdChcInNob3VsZCBhcHBseSBjdXN0b20gQ1NTIGNsYXNzZXNcIiwgKCkgPT4ge1xuICAgICAgY29uc3QgY29udGFpbmVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcbiAgICAgIGNvbnN0IGxheW91dCA9IENsYXNzTGF5b3V0LmNyZWF0ZSh7XG4gICAgICAgIGlkOiBcInRlc3QtbGF5b3V0XCIsXG4gICAgICAgIGNsYXNzTmFtZTogXCJUZXN0Q2xhc3NcIixcbiAgICAgICAgY29uZmlnOiB7XG4gICAgICAgICAgY3NzQ2xhc3M6IFwiY3VzdG9tLWxheW91dC1jbGFzc1wiLFxuICAgICAgICAgIGJsb2NrczogW10sXG4gICAgICAgIH0sXG4gICAgICB9KTtcblxuICAgICAgaWYgKGxheW91dC5pc1N1Y2Nlc3MpIHtcbiAgICAgICAgcmVuZGVyZXIucmVuZGVyTGF5b3V0KGxheW91dC52YWx1ZSwgY29udGFpbmVyKTtcblxuICAgICAgICBleHBlY3QoY29udGFpbmVyLmNsYXNzTGlzdC5jb250YWlucyhcImN1c3RvbS1sYXlvdXQtY2xhc3NcIikpLnRvQmUodHJ1ZSk7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICBpdChcInNob3VsZCBoYW5kbGUgZW1wdHkgYmxvY2tzIGFycmF5XCIsICgpID0+IHtcbiAgICAgIGNvbnN0IGNvbnRhaW5lciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG4gICAgICBjb25zdCBsYXlvdXQgPSBDbGFzc0xheW91dC5jcmVhdGUoe1xuICAgICAgICBpZDogXCJ0ZXN0LWxheW91dFwiLFxuICAgICAgICBjbGFzc05hbWU6IFwiVGVzdENsYXNzXCIsXG4gICAgICAgIGNvbmZpZzoge1xuICAgICAgICAgIGJsb2NrczogW10sXG4gICAgICAgIH0sXG4gICAgICB9KTtcblxuICAgICAgaWYgKGxheW91dC5pc1N1Y2Nlc3MpIHtcbiAgICAgICAgcmVuZGVyZXIucmVuZGVyTGF5b3V0KGxheW91dC52YWx1ZSwgY29udGFpbmVyKTtcblxuICAgICAgICBleHBlY3QoY29udGFpbmVyLmNoaWxkcmVuLmxlbmd0aCkudG9CZSgwKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoXCJibG9jayByZW5kZXJpbmdcIiwgKCkgPT4ge1xuICAgIGl0KFwic2hvdWxkIHJlbmRlciBwcm9wZXJ0aWVzIGJsb2NrXCIsICgpID0+IHtcbiAgICAgIGNvbnN0IGNvbnRhaW5lciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG4gICAgICBjb25zdCBsYXlvdXQgPSBDbGFzc0xheW91dC5jcmVhdGUoe1xuICAgICAgICBpZDogXCJ0ZXN0LWxheW91dFwiLFxuICAgICAgICBjbGFzc05hbWU6IFwiVGVzdENsYXNzXCIsXG4gICAgICAgIGNvbmZpZzoge1xuICAgICAgICAgIGJsb2NrczogW1xuICAgICAgICAgICAge1xuICAgICAgICAgICAgICBpZDogXCJwcm9wc1wiLFxuICAgICAgICAgICAgICB0eXBlOiBcInByb3BlcnRpZXNcIixcbiAgICAgICAgICAgICAgdGl0bGU6IFwiVGVzdCBQcm9wZXJ0aWVzXCIsXG4gICAgICAgICAgICAgIGNvbmZpZzoge1xuICAgICAgICAgICAgICAgIHByb3BlcnRpZXM6IFtcIm5hbWVcIiwgXCJkZXNjcmlwdGlvblwiLCBcInR5cGVcIl0sXG4gICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB9LFxuICAgICAgICAgIF0sXG4gICAgICAgIH0sXG4gICAgICB9KTtcblxuICAgICAgaWYgKGxheW91dC5pc1N1Y2Nlc3MpIHtcbiAgICAgICAgcmVuZGVyZXIucmVuZGVyTGF5b3V0KGxheW91dC52YWx1ZSwgY29udGFpbmVyKTtcblxuICAgICAgICBjb25zdCBibG9ja0VsZW1lbnQgPSBjb250YWluZXIucXVlcnlTZWxlY3RvcignW2RhdGEtYmxvY2staWQ9XCJwcm9wc1wiXScpO1xuICAgICAgICBleHBlY3QoYmxvY2tFbGVtZW50KS50b0JlVHJ1dGh5KCk7XG4gICAgICAgIGV4cGVjdChibG9ja0VsZW1lbnQ/LnRleHRDb250ZW50KS50b0NvbnRhaW4oXCJUZXN0IFByb3BlcnRpZXNcIik7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICBpdChcInNob3VsZCByZW5kZXIgYmFja2xpbmtzIGJsb2NrXCIsICgpID0+IHtcbiAgICAgIGNvbnN0IGNvbnRhaW5lciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG4gICAgICBjb25zdCBsYXlvdXQgPSBDbGFzc0xheW91dC5jcmVhdGUoe1xuICAgICAgICBpZDogXCJ0ZXN0LWxheW91dFwiLFxuICAgICAgICBjbGFzc05hbWU6IFwiVGVzdENsYXNzXCIsXG4gICAgICAgIGNvbmZpZzoge1xuICAgICAgICAgIGJsb2NrczogW1xuICAgICAgICAgICAge1xuICAgICAgICAgICAgICBpZDogXCJiYWNrbGlua3NcIixcbiAgICAgICAgICAgICAgdHlwZTogXCJiYWNrbGlua3NcIixcbiAgICAgICAgICAgICAgdGl0bGU6IFwiUmVsYXRlZCBOb3Rlc1wiLFxuICAgICAgICAgICAgICBjb25maWc6IHt9LFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICBdLFxuICAgICAgICB9LFxuICAgICAgfSk7XG5cbiAgICAgIGlmIChsYXlvdXQuaXNTdWNjZXNzKSB7XG4gICAgICAgIHJlbmRlcmVyLnJlbmRlckxheW91dChsYXlvdXQudmFsdWUsIGNvbnRhaW5lcik7XG5cbiAgICAgICAgY29uc3QgYmxvY2tFbGVtZW50ID0gY29udGFpbmVyLnF1ZXJ5U2VsZWN0b3IoXG4gICAgICAgICAgJ1tkYXRhLWJsb2NrLWlkPVwiYmFja2xpbmtzXCJdJyxcbiAgICAgICAgKTtcbiAgICAgICAgZXhwZWN0KGJsb2NrRWxlbWVudCkudG9CZVRydXRoeSgpO1xuICAgICAgICBleHBlY3QoYmxvY2tFbGVtZW50Py50ZXh0Q29udGVudCkudG9Db250YWluKFwiUmVsYXRlZCBOb3Rlc1wiKTtcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIGl0KFwic2hvdWxkIHJlbmRlciBxdWVyeSBibG9jayB3aXRoIFNQQVJRTFwiLCAoKSA9PiB7XG4gICAgICBjb25zdCBjb250YWluZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuICAgICAgY29uc3QgbGF5b3V0ID0gQ2xhc3NMYXlvdXQuY3JlYXRlKHtcbiAgICAgICAgaWQ6IFwidGVzdC1sYXlvdXRcIixcbiAgICAgICAgY2xhc3NOYW1lOiBcIlRlc3RDbGFzc1wiLFxuICAgICAgICBjb25maWc6IHtcbiAgICAgICAgICBibG9ja3M6IFtcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgaWQ6IFwicXVlcnlcIixcbiAgICAgICAgICAgICAgdHlwZTogXCJxdWVyeVwiLFxuICAgICAgICAgICAgICB0aXRsZTogXCJTUEFSUUwgUmVzdWx0c1wiLFxuICAgICAgICAgICAgICBjb25maWc6IHtcbiAgICAgICAgICAgICAgICBxdWVyeTogXCJTRUxFQ1QgP3MgP3AgP28gV0hFUkUgeyA/cyA/cCA/byB9IExJTUlUIDEwXCIsXG4gICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB9LFxuICAgICAgICAgIF0sXG4gICAgICAgIH0sXG4gICAgICB9KTtcblxuICAgICAgaWYgKGxheW91dC5pc1N1Y2Nlc3MpIHtcbiAgICAgICAgcmVuZGVyZXIucmVuZGVyTGF5b3V0KGxheW91dC52YWx1ZSwgY29udGFpbmVyKTtcblxuICAgICAgICBjb25zdCBibG9ja0VsZW1lbnQgPSBjb250YWluZXIucXVlcnlTZWxlY3RvcignW2RhdGEtYmxvY2staWQ9XCJxdWVyeVwiXScpO1xuICAgICAgICBleHBlY3QoYmxvY2tFbGVtZW50KS50b0JlVHJ1dGh5KCk7XG4gICAgICAgIGV4cGVjdChibG9ja0VsZW1lbnQ/LnRleHRDb250ZW50KS50b0NvbnRhaW4oXCJTUEFSUUwgUmVzdWx0c1wiKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoXCJlcnJvciBoYW5kbGluZ1wiLCAoKSA9PiB7XG4gICAgaXQoXCJzaG91bGQgaGFuZGxlIHVuZGVmaW5lZCBjb250YWluZXJcIiwgKCkgPT4ge1xuICAgICAgY29uc3QgbGF5b3V0ID0gQ2xhc3NMYXlvdXQuY3JlYXRlKHtcbiAgICAgICAgaWQ6IFwidGVzdC1sYXlvdXRcIixcbiAgICAgICAgY2xhc3NOYW1lOiBcIlRlc3RDbGFzc1wiLFxuICAgICAgICBjb25maWc6IHsgYmxvY2tzOiBbXSB9LFxuICAgICAgfSk7XG5cbiAgICAgIGlmIChsYXlvdXQuaXNTdWNjZXNzKSB7XG4gICAgICAgIGV4cGVjdCgoKSA9PiB7XG4gICAgICAgICAgcmVuZGVyZXIucmVuZGVyTGF5b3V0KGxheW91dC52YWx1ZSwgdW5kZWZpbmVkIGFzIGFueSk7XG4gICAgICAgIH0pLm5vdC50b1Rocm93KCk7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICBpdChcInNob3VsZCBoYW5kbGUgbWFsZm9ybWVkIGxheW91dCBjb25maWdcIiwgKCkgPT4ge1xuICAgICAgY29uc3QgY29udGFpbmVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcblxuICAgICAgZXhwZWN0KCgpID0+IHtcbiAgICAgICAgcmVuZGVyZXIucmVuZGVyTGF5b3V0KHt9IGFzIGFueSwgY29udGFpbmVyKTtcbiAgICAgIH0pLm5vdC50b1Rocm93KCk7XG4gICAgfSk7XG4gIH0pO1xufSk7XG4iXSwidmVyc2lvbiI6M30=