92bb6048261c54e0593c6437b895e8cf
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.QuickTaskModal = void 0;
const obsidian_1 = require("obsidian");
/**
 * Modal for quick task creation with project context
 * Provides streamlined UI for creating tasks linked to current project
 */
class QuickTaskModal extends obsidian_1.Modal {
    constructor(app, createTaskUseCase, getCurrentProjectUseCase, activeFile) {
        super(app);
        this.createTaskUseCase = createTaskUseCase;
        this.getCurrentProjectUseCase = getCurrentProjectUseCase;
        this.activeFile = activeFile;
        this.taskTitle = "";
        this.taskDescription = "";
        this.taskPriority = "medium";
        this.taskStatus = "todo";
        this.taskDueDate = "";
        this.taskTags = [];
        this.availableProjects = [];
    }
    async onOpen() {
        const { contentEl } = this;
        contentEl.empty();
        // Add modal title
        contentEl.createEl("h2", { text: "Create New Task" });
        // Load current project context
        await this.loadProjectContext();
        // Project selection
        if (this.currentProject) {
            const projectDiv = contentEl.createDiv({ cls: "quick-task-project" });
            projectDiv.createEl("div", {
                text: `Project: ${this.currentProject.title}`,
                cls: "quick-task-project-current",
            });
            this.selectedProjectId = this.currentProject.id;
        }
        // Show available projects if multiple found
        if (this.availableProjects.length > 1) {
            new obsidian_1.Setting(contentEl)
                .setName("Project")
                .setDesc("Select the project for this task")
                .addDropdown((dropdown) => {
                // Add empty option
                dropdown.addOption("", "No project");
                // Add all available projects
                this.availableProjects.forEach((project) => {
                    dropdown.addOption(project.id, project.title);
                });
                // Set current selection
                if (this.currentProject) {
                    dropdown.setValue(this.currentProject.id);
                }
                dropdown.onChange((value) => {
                    this.selectedProjectId = value || undefined;
                });
            });
        }
        // Task title
        new obsidian_1.Setting(contentEl)
            .setName("Title")
            .setDesc("Enter the task title (required)")
            .addText((text) => {
            text.inputEl.addClass("quick-task-title-input");
            text.setPlaceholder("Task title...");
            text.onChange((value) => {
                this.taskTitle = value;
            });
            // Focus on title input
            text.inputEl.focus();
            // Select all text for quick replacement
            text.inputEl.select();
        });
        // Task description
        new obsidian_1.Setting(contentEl)
            .setName("Description")
            .setDesc("Optional task description")
            .addTextArea((text) => {
            text.inputEl.addClass("quick-task-description-input");
            text.setPlaceholder("Task description...");
            text.inputEl.rows = 3;
            text.onChange((value) => {
                this.taskDescription = value;
            });
        });
        // Priority and Status row
        const priorityStatusDiv = contentEl.createDiv({ cls: "quick-task-row" });
        // Priority
        new obsidian_1.Setting(priorityStatusDiv)
            .setName("Priority")
            .addDropdown((dropdown) => {
            dropdown
                .addOption("low", "ðŸŸ¢ Low")
                .addOption("medium", "ðŸŸ¡ Medium")
                .addOption("high", "ðŸŸ  High")
                .addOption("urgent", "ðŸ”´ Urgent")
                .setValue(this.taskPriority)
                .onChange((value) => {
                this.taskPriority = value;
            });
        });
        // Status
        new obsidian_1.Setting(priorityStatusDiv).setName("Status").addDropdown((dropdown) => {
            dropdown
                .addOption("todo", "ðŸ“‹ Todo")
                .addOption("in-progress", "ðŸ”„ In Progress")
                .addOption("done", "âœ… Done")
                .addOption("cancelled", "âŒ Cancelled")
                .setValue(this.taskStatus)
                .onChange((value) => {
                this.taskStatus = value;
            });
        });
        // Due date and estimated hours row
        const dateHoursDiv = contentEl.createDiv({ cls: "quick-task-row" });
        // Due date
        new obsidian_1.Setting(dateHoursDiv).setName("Due Date").addText((text) => {
            text.inputEl.type = "date";
            text.onChange((value) => {
                this.taskDueDate = value;
            });
            // Set default to tomorrow
            const tomorrow = new Date();
            tomorrow.setDate(tomorrow.getDate() + 1);
            text.setValue(tomorrow.toISOString().split("T")[0]);
            this.taskDueDate = tomorrow.toISOString().split("T")[0];
        });
        // Estimated hours
        new obsidian_1.Setting(dateHoursDiv).setName("Est. Hours").addText((text) => {
            text.inputEl.type = "number";
            text.inputEl.min = "0";
            text.inputEl.step = "0.5";
            text.setPlaceholder("0");
            text.onChange((value) => {
                const hours = parseFloat(value);
                this.taskEstimatedHours = isNaN(hours) ? undefined : hours;
            });
        });
        // Tags
        new obsidian_1.Setting(contentEl)
            .setName("Tags")
            .setDesc("Enter tags separated by commas")
            .addText((text) => {
            text.inputEl.addClass("quick-task-tags-input");
            text.setPlaceholder("tag1, tag2, tag3");
            text.onChange((value) => {
                this.taskTags = value
                    .split(",")
                    .map((tag) => tag.trim())
                    .filter((tag) => tag.length > 0);
            });
        });
        // Action buttons
        const buttonDiv = contentEl.createDiv({ cls: "quick-task-buttons" });
        // Create button
        const createBtn = buttonDiv.createEl("button", {
            text: "Create Task",
            cls: "mod-cta",
        });
        createBtn.addEventListener("click", async () => {
            await this.createTask();
        });
        // Create and continue button
        const createContinueBtn = buttonDiv.createEl("button", {
            text: "Create & Continue",
            cls: "mod-primary",
        });
        createContinueBtn.addEventListener("click", async () => {
            const success = await this.createTask();
            if (success) {
                // Clear form for next task
                this.resetForm();
                // Reopen modal
                this.onOpen();
            }
        });
        // Cancel button
        const cancelBtn = buttonDiv.createEl("button", {
            text: "Cancel",
        });
        cancelBtn.addEventListener("click", () => {
            this.close();
        });
        // Add styles
        this.addStyles();
        // Handle Enter key to create task
        contentEl.addEventListener("keydown", async (e) => {
            if (e.key === "Enter" && e.ctrlKey) {
                await this.createTask();
            }
        });
    }
    onClose() {
        const { contentEl } = this;
        contentEl.empty();
    }
    /**
     * Load current project context
     */
    async loadProjectContext() {
        try {
            const response = await this.getCurrentProjectUseCase.execute({
                activeFile: this.activeFile,
                preferences: {
                    includeCompleted: false,
                    maxResults: 10,
                    selectionStrategy: "context",
                },
            });
            if (response.success && response.currentProject) {
                this.currentProject = response.currentProject;
            }
            if (response.availableProjects && response.availableProjects.length > 0) {
                this.availableProjects = response.availableProjects;
            }
        }
        catch (error) {
            console.error("Failed to load project context:", error);
        }
    }
    /**
     * Create the task
     */
    async createTask() {
        // Validate required fields
        if (!this.taskTitle || this.taskTitle.trim().length === 0) {
            new obsidian_1.Notice("Task title is required");
            return false;
        }
        try {
            // Build request
            const request = {
                title: this.taskTitle.trim(),
                description: this.taskDescription.trim() || undefined,
                priority: this.taskPriority,
                status: this.taskStatus,
                projectId: this.selectedProjectId,
                dueDate: this.taskDueDate || undefined,
                estimatedHours: this.taskEstimatedHours,
                tags: this.taskTags,
                context: {
                    activeFile: this.activeFile,
                },
            };
            // Execute use case
            const response = await this.createTaskUseCase.execute(request);
            if (response.success) {
                new obsidian_1.Notice(`Task "${response.task?.title}" created successfully`);
                this.close();
                return true;
            }
            else {
                new obsidian_1.Notice(`Failed to create task: ${response.message}`);
                console.error("Task creation failed:", response.errors);
                return false;
            }
        }
        catch (error) {
            new obsidian_1.Notice(`Error creating task: ${error.message}`);
            console.error("Task creation error:", error);
            return false;
        }
    }
    /**
     * Reset form fields
     */
    resetForm() {
        this.taskTitle = "";
        this.taskDescription = "";
        this.taskPriority = "medium";
        this.taskStatus = "todo";
        this.taskDueDate = "";
        this.taskEstimatedHours = undefined;
        this.taskTags = [];
        // Keep project context
    }
    /**
     * Add custom styles
     */
    addStyles() {
        const style = document.createElement("style");
        style.textContent = `
      .quick-task-project {
        padding: 10px;
        margin-bottom: 15px;
        background: var(--background-secondary);
        border-radius: 5px;
      }

      .quick-task-project-current {
        font-weight: bold;
        color: var(--text-accent);
      }

      .quick-task-row {
        display: flex;
        gap: 15px;
        margin-bottom: 15px;
      }

      .quick-task-row .setting-item {
        flex: 1;
        margin-bottom: 0;
      }

      .quick-task-title-input {
        font-size: 1.1em;
        font-weight: bold;
      }

      .quick-task-description-input {
        font-family: var(--font-monospace);
        min-height: 60px;
      }

      .quick-task-tags-input {
        font-family: var(--font-monospace);
      }

      .quick-task-buttons {
        display: flex;
        justify-content: flex-end;
        gap: 10px;
        margin-top: 20px;
        padding-top: 15px;
        border-top: 1px solid var(--background-modifier-border);
      }

      .quick-task-buttons button {
        padding: 8px 16px;
      }
    `;
        document.head.appendChild(style);
    }
}
exports.QuickTaskModal = QuickTaskModal;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL2tpdGVsZXYvRG9jdW1lbnRzL2V4b2NvcnRleC1vYnNpZGlhbi1wbHVnaW4vc3JjL3ByZXNlbnRhdGlvbi9tb2RhbHMvUXVpY2tUYXNrTW9kYWwudHMiLCJtYXBwaW5ncyI6Ijs7O0FBQUEsdUNBQXVEO0FBUXZEOzs7R0FHRztBQUNILE1BQWEsY0FBZSxTQUFRLGdCQUFLO0lBZXZDLFlBQ0UsR0FBUSxFQUNTLGlCQUErQyxFQUMvQyx3QkFBa0QsRUFDbEQsVUFBbUI7UUFFcEMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxDQUFDO1FBSk0sc0JBQWlCLEdBQWpCLGlCQUFpQixDQUE4QjtRQUMvQyw2QkFBd0IsR0FBeEIsd0JBQXdCLENBQTBCO1FBQ2xELGVBQVUsR0FBVixVQUFVLENBQVM7UUFsQjlCLGNBQVMsR0FBVyxFQUFFLENBQUM7UUFDdkIsb0JBQWUsR0FBVyxFQUFFLENBQUM7UUFDN0IsaUJBQVksR0FBeUMsUUFBUSxDQUFDO1FBQzlELGVBQVUsR0FBa0QsTUFBTSxDQUFDO1FBQ25FLGdCQUFXLEdBQVcsRUFBRSxDQUFDO1FBRXpCLGFBQVEsR0FBYSxFQUFFLENBQUM7UUFLeEIsc0JBQWlCLEdBQ3ZCLEVBQUUsQ0FBQztJQVNMLENBQUM7SUFFRCxLQUFLLENBQUMsTUFBTTtRQUNWLE1BQU0sRUFBRSxTQUFTLEVBQUUsR0FBRyxJQUFJLENBQUM7UUFDM0IsU0FBUyxDQUFDLEtBQUssRUFBRSxDQUFDO1FBRWxCLGtCQUFrQjtRQUNsQixTQUFTLENBQUMsUUFBUSxDQUFDLElBQUksRUFBRSxFQUFFLElBQUksRUFBRSxpQkFBaUIsRUFBRSxDQUFDLENBQUM7UUFFdEQsK0JBQStCO1FBQy9CLE1BQU0sSUFBSSxDQUFDLGtCQUFrQixFQUFFLENBQUM7UUFFaEMsb0JBQW9CO1FBQ3BCLElBQUksSUFBSSxDQUFDLGNBQWMsRUFBRTtZQUN2QixNQUFNLFVBQVUsR0FBRyxTQUFTLENBQUMsU0FBUyxDQUFDLEVBQUUsR0FBRyxFQUFFLG9CQUFvQixFQUFFLENBQUMsQ0FBQztZQUN0RSxV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LEtBQUssQ0FBQyxPQUFPLEVBQUUsQ0FBQyxDQUFDO1lBQ3BELE9BQU8sQ0FBQyxLQUFLLENBQUMsc0JBQXNCLEVBQUUsS0FBSyxDQUFDLENBQUM7WUFDN0MsT0FBTyxLQUFLLENBQUM7U0FDZDtJQUNILENBQUM7SUFFRDs7T0FFRztJQUNLLFNBQVM7UUFDZixJQUFJLENBQUMsU0FBUyxHQUFHLEVBQUUsQ0FBQztRQUNwQixJQUFJLENBQUMsZUFBZSxHQUFHLEVBQUUsQ0FBQztRQUMxQixJQUFJLENBQUMsWUFBWSxHQUFHLFFBQVEsQ0FBQztRQUM3QixJQUFJLENBQUMsVUFBVSxHQUFHLE1BQU0sQ0FBQztRQUN6QixJQUFJLENBQUMsV0FBVyxHQUFHLEVBQUUsQ0FBQztRQUN0QixJQUFJLENBQUMsa0JBQWtCLEdBQUcsU0FBUyxDQUFDO1FBQ3BDLElBQUksQ0FBQyxRQUFRLEdBQUcsRUFBRSxDQUFDO1FBQ25CLHVCQUF1QjtJQUN6QixDQUFDO0lBRUQ7O09BRUc7SUFDSyxTQUFTO1FBQ2YsTUFBTSxLQUFLLEdBQUcsUUFBUSxDQUFDLGFBQWEsQ0FBQyxPQUFPLENBQUMsQ0FBQztRQUM5QyxLQUFLLENBQUMsV0FBVyxHQUFHOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztLQWtEbkIsQ0FBQztRQUNGLFFBQVEsQ0FBQyxJQUFJLENBQUMsV0FBVyxDQUFDLEtBQUssQ0FBQyxDQUFDO0lBQ25DLENBQUM7Q0FDRjtBQTlXRCx3Q0E4V0MiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL1VzZXJzL2tpdGVsZXYvRG9jdW1lbnRzL2V4b2NvcnRleC1vYnNpZGlhbi1wbHVnaW4vc3JjL3ByZXNlbnRhdGlvbi9tb2RhbHMvUXVpY2tUYXNrTW9kYWwudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQXBwLCBNb2RhbCwgU2V0dGluZywgTm90aWNlIH0gZnJvbSBcIm9ic2lkaWFuXCI7XG5pbXBvcnQgeyBDcmVhdGVUYXNrRnJvbVByb2plY3RVc2VDYXNlIH0gZnJvbSBcIi4uLy4uL2FwcGxpY2F0aW9uL3VzZS1jYXNlcy9DcmVhdGVUYXNrRnJvbVByb2plY3RVc2VDYXNlXCI7XG5pbXBvcnQgeyBHZXRDdXJyZW50UHJvamVjdFVzZUNhc2UgfSBmcm9tIFwiLi4vLi4vYXBwbGljYXRpb24vdXNlLWNhc2VzL0dldEN1cnJlbnRQcm9qZWN0VXNlQ2FzZVwiO1xuaW1wb3J0IHtcbiAgQ3JlYXRlVGFza1JlcXVlc3QsXG4gIEdldEN1cnJlbnRQcm9qZWN0UmVzcG9uc2UsXG59IGZyb20gXCIuLi8uLi9hcHBsaWNhdGlvbi9kdG9zL0NyZWF0ZVRhc2tSZXF1ZXN0XCI7XG5cbi8qKlxuICogTW9kYWwgZm9yIHF1aWNrIHRhc2sgY3JlYXRpb24gd2l0aCBwcm9qZWN0IGNvbnRleHRcbiAqIFByb3ZpZGVzIHN0cmVhbWxpbmVkIFVJIGZvciBjcmVhdGluZyB0YXNrcyBsaW5rZWQgdG8gY3VycmVudCBwcm9qZWN0XG4gKi9cbmV4cG9ydCBjbGFzcyBRdWlja1Rhc2tNb2RhbCBleHRlbmRzIE1vZGFsIHtcbiAgcHJpdmF0ZSB0YXNrVGl0bGU6IHN0cmluZyA9IFwiXCI7XG4gIHByaXZhdGUgdGFza0Rlc2NyaXB0aW9uOiBzdHJpbmcgPSBcIlwiO1xuICBwcml2YXRlIHRhc2tQcmlvcml0eTogXCJsb3dcIiB8IFwibWVkaXVtXCIgfCBcImhpZ2hcIiB8IFwidXJnZW50XCIgPSBcIm1lZGl1bVwiO1xuICBwcml2YXRlIHRhc2tTdGF0dXM6IFwidG9kb1wiIHwgXCJpbi1wcm9ncmVzc1wiIHwgXCJkb25lXCIgfCBcImNhbmNlbGxlZFwiID0gXCJ0b2RvXCI7XG4gIHByaXZhdGUgdGFza0R1ZURhdGU6IHN0cmluZyA9IFwiXCI7XG4gIHByaXZhdGUgdGFza0VzdGltYXRlZEhvdXJzOiBudW1iZXIgfCB1bmRlZmluZWQ7XG4gIHByaXZhdGUgdGFza1RhZ3M6IHN0cmluZ1tdID0gW107XG4gIHByaXZhdGUgY3VycmVudFByb2plY3Q6XG4gICAgfCBHZXRDdXJyZW50UHJvamVjdFJlc3BvbnNlW1wiY3VycmVudFByb2plY3RcIl1cbiAgICB8IHVuZGVmaW5lZDtcbiAgcHJpdmF0ZSBzZWxlY3RlZFByb2plY3RJZDogc3RyaW5nIHwgdW5kZWZpbmVkO1xuICBwcml2YXRlIGF2YWlsYWJsZVByb2plY3RzOiBHZXRDdXJyZW50UHJvamVjdFJlc3BvbnNlW1wiYXZhaWxhYmxlUHJvamVjdHNcIl0gPVxuICAgIFtdO1xuXG4gIGNvbnN0cnVjdG9yKFxuICAgIGFwcDogQXBwLFxuICAgIHByaXZhdGUgcmVhZG9ubHkgY3JlYXRlVGFza1VzZUNhc2U6IENyZWF0ZVRhc2tGcm9tUHJvamVjdFVzZUNhc2UsXG4gICAgcHJpdmF0ZSByZWFkb25seSBnZXRDdXJyZW50UHJvamVjdFVzZUNhc2U6IEdldEN1cnJlbnRQcm9qZWN0VXNlQ2FzZSxcbiAgICBwcml2YXRlIHJlYWRvbmx5IGFjdGl2ZUZpbGU/OiBzdHJpbmcsXG4gICkge1xuICAgIHN1cGVyKGFwcCk7XG4gIH1cblxuICBhc3luYyBvbk9wZW4oKSB7XG4gICAgY29uc3QgeyBjb250ZW50RWwgfSA9IHRoaXM7XG4gICAgY29udGVudEVsLmVtcHR5KCk7XG5cbiAgICAvLyBBZGQgbW9kYWwgdGl0bGVcbiAgICBjb250ZW50RWwuY3JlYXRlRWwoXCJoMlwiLCB7IHRleHQ6IFwiQ3JlYXRlIE5ldyBUYXNrXCIgfSk7XG5cbiAgICAvLyBMb2FkIGN1cnJlbnQgcHJvamVjdCBjb250ZXh0XG4gICAgYXdhaXQgdGhpcy5sb2FkUHJvamVjdENvbnRleHQoKTtcblxuICAgIC8vIFByb2plY3Qgc2VsZWN0aW9uXG4gICAgaWYgKHRoaXMuY3VycmVudFByb2plY3QpIHtcbiAgICAgIGNvbnN0IHByb2plY3REaXYgPSBjb250ZW50RWwuY3JlYXRlRGl2KHsgY2xzOiBcInF1aWNrLXRhc2stcHJvamVjdFwiIH0pO1xuICAgICAgcHJvamVjdERpdi5jcmVhdGVFbChcImRpdlwiLCB7XG4gICAgICAgIHRleHQ6IGBQcm9qZWN0OiAke3RoaXMuY3VycmVudFByb2plY3QudGl0bGV9YCxcbiAgICAgICAgY2xzOiBcInF1aWNrLXRhc2stcHJvamVjdC1jdXJyZW50XCIsXG4gICAgICB9KTtcbiAgICAgIHRoaXMuc2VsZWN0ZWRQcm9qZWN0SWQgPSB0aGlzLmN1cnJlbnRQcm9qZWN0LmlkO1xuICAgIH1cblxuICAgIC8vIFNob3cgYXZhaWxhYmxlIHByb2plY3RzIGlmIG11bHRpcGxlIGZvdW5kXG4gICAgaWYgKHRoaXMuYXZhaWxhYmxlUHJvamVjdHMubGVuZ3RoID4gMSkge1xuICAgICAgbmV3IFNldHRpbmcoY29udGVudEVsKVxuICAgICAgICAuc2V0TmFtZShcIlByb2plY3RcIilcbiAgICAgICAgLnNldERlc2MoXCJTZWxlY3QgdGhlIHByb2plY3QgZm9yIHRoaXMgdGFza1wiKVxuICAgICAgICAuYWRkRHJvcGRvd24oKGRyb3Bkb3duKSA9PiB7XG4gICAgICAgICAgLy8gQWRkIGVtcHR5IG9wdGlvblxuICAgICAgICAgIGRyb3Bkb3duLmFkZE9wdGlvbihcIlwiLCBcIk5vIHByb2plY3RcIik7XG5cbiAgICAgICAgICAvLyBBZGQgYWxsIGF2YWlsYWJsZSBwcm9qZWN0c1xuICAgICAgICAgIHRoaXMuYXZhaWxhYmxlUHJvamVjdHMuZm9yRWFjaCgocHJvamVjdCkgPT4ge1xuICAgICAgICAgICAgZHJvcGRvd24uYWRkT3B0aW9uKHByb2plY3QuaWQsIHByb2plY3QudGl0bGUpO1xuICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgLy8gU2V0IGN1cnJlbnQgc2VsZWN0aW9uXG4gICAgICAgICAgaWYgKHRoaXMuY3VycmVudFByb2plY3QpIHtcbiAgICAgICAgICAgIGRyb3Bkb3duLnNldFZhbHVlKHRoaXMuY3VycmVudFByb2plY3QuaWQpO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIGRyb3Bkb3duLm9uQ2hhbmdlKCh2YWx1ZSkgPT4ge1xuICAgICAgICAgICAgdGhpcy5zZWxlY3RlZFByb2plY3RJZCA9IHZhbHVlIHx8IHVuZGVmaW5lZDtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgLy8gVGFzayB0aXRsZVxuICAgIG5ldyBTZXR0aW5nKGNvbnRlbnRFbClcbiAgICAgIC5zZXROYW1lKFwiVGl0bGVcIilcbiAgICAgIC5zZXREZXNjKFwiRW50ZXIgdGhlIHRhc2sgdGl0bGUgKHJlcXVpcmVkKVwiKVxuICAgICAgLmFkZFRleHQoKHRleHQpID0+IHtcbiAgICAgICAgdGV4dC5pbnB1dEVsLmFkZENsYXNzKFwicXVpY2stdGFzay10aXRsZS1pbnB1dFwiKTtcbiAgICAgICAgdGV4dC5zZXRQbGFjZWhvbGRlcihcIlRhc2sgdGl0bGUuLi5cIik7XG4gICAgICAgIHRleHQub25DaGFuZ2UoKHZhbHVlKSA9PiB7XG4gICAgICAgICAgdGhpcy50YXNrVGl0bGUgPSB2YWx1ZTtcbiAgICAgICAgfSk7XG4gICAgICAgIC8vIEZvY3VzIG9uIHRpdGxlIGlucHV0XG4gICAgICAgIHRleHQuaW5wdXRFbC5mb2N1cygpO1xuICAgICAgICAvLyBTZWxlY3QgYWxsIHRleHQgZm9yIHF1aWNrIHJlcGxhY2VtZW50XG4gICAgICAgIHRleHQuaW5wdXRFbC5zZWxlY3QoKTtcbiAgICAgIH0pO1xuXG4gICAgLy8gVGFzayBkZXNjcmlwdGlvblxuICAgIG5ldyBTZXR0aW5nKGNvbnRlbnRFbClcbiAgICAgIC5zZXROYW1lKFwiRGVzY3JpcHRpb25cIilcbiAgICAgIC5zZXREZXNjKFwiT3B0aW9uYWwgdGFzayBkZXNjcmlwdGlvblwiKVxuICAgICAgLmFkZFRleHRBcmVhKCh0ZXh0KSA9PiB7XG4gICAgICAgIHRleHQuaW5wdXRFbC5hZGRDbGFzcyhcInF1aWNrLXRhc2stZGVzY3JpcHRpb24taW5wdXRcIik7XG4gICAgICAgIHRleHQuc2V0UGxhY2Vob2xkZXIoXCJUYXNrIGRlc2NyaXB0aW9uLi4uXCIpO1xuICAgICAgICB0ZXh0LmlucHV0RWwucm93cyA9IDM7XG4gICAgICAgIHRleHQub25DaGFuZ2UoKHZhbHVlKSA9PiB7XG4gICAgICAgICAgdGhpcy50YXNrRGVzY3JpcHRpb24gPSB2YWx1ZTtcbiAgICAgICAgfSk7XG4gICAgICB9KTtcblxuICAgIC8vIFByaW9yaXR5IGFuZCBTdGF0dXMgcm93XG4gICAgY29uc3QgcHJpb3JpdHlTdGF0dXNEaXYgPSBjb250ZW50RWwuY3JlYXRlRGl2KHsgY2xzOiBcInF1aWNrLXRhc2stcm93XCIgfSk7XG5cbiAgICAvLyBQcmlvcml0eVxuICAgIG5ldyBTZXR0aW5nKHByaW9yaXR5U3RhdHVzRGl2KVxuICAgICAgLnNldE5hbWUoXCJQcmlvcml0eVwiKVxuICAgICAgLmFkZERyb3Bkb3duKChkcm9wZG93bikgPT4ge1xuICAgICAgICBkcm9wZG93blxuICAgICAgICAgIC5hZGRPcHRpb24oXCJsb3dcIiwgXCLwn5+iIExvd1wiKVxuICAgICAgICAgIC5hZGRPcHRpb24oXCJtZWRpdW1cIiwgXCLwn5+hIE1lZGl1bVwiKVxuICAgICAgICAgIC5hZGRPcHRpb24oXCJoaWdoXCIsIFwi8J+foCBIaWdoXCIpXG4gICAgICAgICAgLmFkZE9wdGlvbihcInVyZ2VudFwiLCBcIvCflLQgVXJnZW50XCIpXG4gICAgICAgICAgLnNldFZhbHVlKHRoaXMudGFza1ByaW9yaXR5KVxuICAgICAgICAgIC5vbkNoYW5nZSgodmFsdWUpID0+IHtcbiAgICAgICAgICAgIHRoaXMudGFza1ByaW9yaXR5ID0gdmFsdWUgYXMgYW55O1xuICAgICAgICAgIH0pO1xuICAgICAgfSk7XG5cbiAgICAvLyBTdGF0dXNcbiAgICBuZXcgU2V0dGluZyhwcmlvcml0eVN0YXR1c0Rpdikuc2V0TmFtZShcIlN0YXR1c1wiKS5hZGREcm9wZG93bigoZHJvcGRvd24pID0+IHtcbiAgICAgIGRyb3Bkb3duXG4gICAgICAgIC5hZGRPcHRpb24oXCJ0b2RvXCIsIFwi8J+TiyBUb2RvXCIpXG4gICAgICAgIC5hZGRPcHRpb24oXCJpbi1wcm9ncmVzc1wiLCBcIvCflIQgSW4gUHJvZ3Jlc3NcIilcbiAgICAgICAgLmFkZE9wdGlvbihcImRvbmVcIiwgXCLinIUgRG9uZVwiKVxuICAgICAgICAuYWRkT3B0aW9uKFwiY2FuY2VsbGVkXCIsIFwi4p2MIENhbmNlbGxlZFwiKVxuICAgICAgICAuc2V0VmFsdWUodGhpcy50YXNrU3RhdHVzKVxuICAgICAgICAub25DaGFuZ2UoKHZhbHVlKSA9PiB7XG4gICAgICAgICAgdGhpcy50YXNrU3RhdHVzID0gdmFsdWUgYXMgYW55O1xuICAgICAgICB9KTtcbiAgICB9KTtcblxuICAgIC8vIER1ZSBkYXRlIGFuZCBlc3RpbWF0ZWQgaG91cnMgcm93XG4gICAgY29uc3QgZGF0ZUhvdXJzRGl2ID0gY29udGVudEVsLmNyZWF0ZURpdih7IGNsczogXCJxdWljay10YXNrLXJvd1wiIH0pO1xuXG4gICAgLy8gRHVlIGRhdGVcbiAgICBuZXcgU2V0dGluZyhkYXRlSG91cnNEaXYpLnNldE5hbWUoXCJEdWUgRGF0ZVwiKS5hZGRUZXh0KCh0ZXh0KSA9PiB7XG4gICAgICB0ZXh0LmlucHV0RWwudHlwZSA9IFwiZGF0ZVwiO1xuICAgICAgdGV4dC5vbkNoYW5nZSgodmFsdWUpID0+IHtcbiAgICAgICAgdGhpcy50YXNrRHVlRGF0ZSA9IHZhbHVlO1xuICAgICAgfSk7XG4gICAgICAvLyBTZXQgZGVmYXVsdCB0byB0b21vcnJvd1xuICAgICAgY29uc3QgdG9tb3Jyb3cgPSBuZXcgRGF0ZSgpO1xuICAgICAgdG9tb3Jyb3cuc2V0RGF0ZSh0b21vcnJvdy5nZXREYXRlKCkgKyAxKTtcbiAgICAgIHRleHQuc2V0VmFsdWUodG9tb3Jyb3cudG9JU09TdHJpbmcoKS5zcGxpdChcIlRcIilbMF0pO1xuICAgICAgdGhpcy50YXNrRHVlRGF0ZSA9IHRvbW9ycm93LnRvSVNPU3RyaW5nKCkuc3BsaXQoXCJUXCIpWzBdO1xuICAgIH0pO1xuXG4gICAgLy8gRXN0aW1hdGVkIGhvdXJzXG4gICAgbmV3IFNldHRpbmcoZGF0ZUhvdXJzRGl2KS5zZXROYW1lKFwiRXN0LiBIb3Vyc1wiKS5hZGRUZXh0KCh0ZXh0KSA9PiB7XG4gICAgICB0ZXh0LmlucHV0RWwudHlwZSA9IFwibnVtYmVyXCI7XG4gICAgICB0ZXh0LmlucHV0RWwubWluID0gXCIwXCI7XG4gICAgICB0ZXh0LmlucHV0RWwuc3RlcCA9IFwiMC41XCI7XG4gICAgICB0ZXh0LnNldFBsYWNlaG9sZGVyKFwiMFwiKTtcbiAgICAgIHRleHQub25DaGFuZ2UoKHZhbHVlKSA9PiB7XG4gICAgICAgIGNvbnN0IGhvdXJzID0gcGFyc2VGbG9hdCh2YWx1ZSk7XG4gICAgICAgIHRoaXMudGFza0VzdGltYXRlZEhvdXJzID0gaXNOYU4oaG91cnMpID8gdW5kZWZpbmVkIDogaG91cnM7XG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIC8vIFRhZ3NcbiAgICBuZXcgU2V0dGluZyhjb250ZW50RWwpXG4gICAgICAuc2V0TmFtZShcIlRhZ3NcIilcbiAgICAgIC5zZXREZXNjKFwiRW50ZXIgdGFncyBzZXBhcmF0ZWQgYnkgY29tbWFzXCIpXG4gICAgICAuYWRkVGV4dCgodGV4dCkgPT4ge1xuICAgICAgICB0ZXh0LmlucHV0RWwuYWRkQ2xhc3MoXCJxdWljay10YXNrLXRhZ3MtaW5wdXRcIik7XG4gICAgICAgIHRleHQuc2V0UGxhY2Vob2xkZXIoXCJ0YWcxLCB0YWcyLCB0YWczXCIpO1xuICAgICAgICB0ZXh0Lm9uQ2hhbmdlKCh2YWx1ZSkgPT4ge1xuICAgICAgICAgIHRoaXMudGFza1RhZ3MgPSB2YWx1ZVxuICAgICAgICAgICAgLnNwbGl0KFwiLFwiKVxuICAgICAgICAgICAgLm1hcCgodGFnKSA9PiB0YWcudHJpbSgpKVxuICAgICAgICAgICAgLmZpbHRlcigodGFnKSA9PiB0YWcubGVuZ3RoID4gMCk7XG4gICAgICAgIH0pO1xuICAgICAgfSk7XG5cbiAgICAvLyBBY3Rpb24gYnV0dG9uc1xuICAgIGNvbnN0IGJ1dHRvbkRpdiA9IGNvbnRlbnRFbC5jcmVhdGVEaXYoeyBjbHM6IFwicXVpY2stdGFzay1idXR0b25zXCIgfSk7XG5cbiAgICAvLyBDcmVhdGUgYnV0dG9uXG4gICAgY29uc3QgY3JlYXRlQnRuID0gYnV0dG9uRGl2LmNyZWF0ZUVsKFwiYnV0dG9uXCIsIHtcbiAgICAgIHRleHQ6IFwiQ3JlYXRlIFRhc2tcIixcbiAgICAgIGNsczogXCJtb2QtY3RhXCIsXG4gICAgfSk7XG4gICAgY3JlYXRlQnRuLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBhc3luYyAoKSA9PiB7XG4gICAgICBhd2FpdCB0aGlzLmNyZWF0ZVRhc2soKTtcbiAgICB9KTtcblxuICAgIC8vIENyZWF0ZSBhbmQgY29udGludWUgYnV0dG9uXG4gICAgY29uc3QgY3JlYXRlQ29udGludWVCdG4gPSBidXR0b25EaXYuY3JlYXRlRWwoXCJidXR0b25cIiwge1xuICAgICAgdGV4dDogXCJDcmVhdGUgJiBDb250aW51ZVwiLFxuICAgICAgY2xzOiBcIm1vZC1wcmltYXJ5XCIsXG4gICAgfSk7XG4gICAgY3JlYXRlQ29udGludWVCdG4uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHN1Y2Nlc3MgPSBhd2FpdCB0aGlzLmNyZWF0ZVRhc2soKTtcbiAgICAgIGlmIChzdWNjZXNzKSB7XG4gICAgICAgIC8vIENsZWFyIGZvcm0gZm9yIG5leHQgdGFza1xuICAgICAgICB0aGlzLnJlc2V0Rm9ybSgpO1xuICAgICAgICAvLyBSZW9wZW4gbW9kYWxcbiAgICAgICAgdGhpcy5vbk9wZW4oKTtcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIC8vIENhbmNlbCBidXR0b25cbiAgICBjb25zdCBjYW5jZWxCdG4gPSBidXR0b25EaXYuY3JlYXRlRWwoXCJidXR0b25cIiwge1xuICAgICAgdGV4dDogXCJDYW5jZWxcIixcbiAgICB9KTtcbiAgICBjYW5jZWxCdG4uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcbiAgICAgIHRoaXMuY2xvc2UoKTtcbiAgICB9KTtcblxuICAgIC8vIEFkZCBzdHlsZXNcbiAgICB0aGlzLmFkZFN0eWxlcygpO1xuXG4gICAgLy8gSGFuZGxlIEVudGVyIGtleSB0byBjcmVhdGUgdGFza1xuICAgIGNvbnRlbnRFbC5hZGRFdmVudExpc3RlbmVyKFwia2V5ZG93blwiLCBhc3luYyAoZTogS2V5Ym9hcmRFdmVudCkgPT4ge1xuICAgICAgaWYgKGUua2V5ID09PSBcIkVudGVyXCIgJiYgZS5jdHJsS2V5KSB7XG4gICAgICAgIGF3YWl0IHRoaXMuY3JlYXRlVGFzaygpO1xuICAgICAgfVxuICAgIH0pO1xuICB9XG5cbiAgb25DbG9zZSgpIHtcbiAgICBjb25zdCB7IGNvbnRlbnRFbCB9ID0gdGhpcztcbiAgICBjb250ZW50RWwuZW1wdHkoKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBMb2FkIGN1cnJlbnQgcHJvamVjdCBjb250ZXh0XG4gICAqL1xuICBwcml2YXRlIGFzeW5jIGxvYWRQcm9qZWN0Q29udGV4dCgpIHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCB0aGlzLmdldEN1cnJlbnRQcm9qZWN0VXNlQ2FzZS5leGVjdXRlKHtcbiAgICAgICAgYWN0aXZlRmlsZTogdGhpcy5hY3RpdmVGaWxlLFxuICAgICAgICBwcmVmZXJlbmNlczoge1xuICAgICAgICAgIGluY2x1ZGVDb21wbGV0ZWQ6IGZhbHNlLFxuICAgICAgICAgIG1heFJlc3VsdHM6IDEwLFxuICAgICAgICAgIHNlbGVjdGlvblN0cmF0ZWd5OiBcImNvbnRleHRcIixcbiAgICAgICAgfSxcbiAgICAgIH0pO1xuXG4gICAgICBpZiAocmVzcG9uc2Uuc3VjY2VzcyAmJiByZXNwb25zZS5jdXJyZW50UHJvamVjdCkge1xuICAgICAgICB0aGlzLmN1cnJlbnRQcm9qZWN0ID0gcmVzcG9uc2UuY3VycmVudFByb2plY3Q7XG4gICAgICB9XG5cbiAgICAgIGlmIChyZXNwb25zZS5hdmFpbGFibGVQcm9qZWN0cyAmJiByZXNwb25zZS5hdmFpbGFibGVQcm9qZWN0cy5sZW5ndGggPiAwKSB7XG4gICAgICAgIHRoaXMuYXZhaWxhYmxlUHJvamVjdHMgPSByZXNwb25zZS5hdmFpbGFibGVQcm9qZWN0cztcbiAgICAgIH1cbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcihcIkZhaWxlZCB0byBsb2FkIHByb2plY3QgY29udGV4dDpcIiwgZXJyb3IpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBDcmVhdGUgdGhlIHRhc2tcbiAgICovXG4gIHByaXZhdGUgYXN5bmMgY3JlYXRlVGFzaygpOiBQcm9taXNlPGJvb2xlYW4+IHtcbiAgICAvLyBWYWxpZGF0ZSByZXF1aXJlZCBmaWVsZHNcbiAgICBpZiAoIXRoaXMudGFza1RpdGxlIHx8IHRoaXMudGFza1RpdGxlLnRyaW0oKS5sZW5ndGggPT09IDApIHtcbiAgICAgIG5ldyBOb3RpY2UoXCJUYXNrIHRpdGxlIGlzIHJlcXVpcmVkXCIpO1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cblxuICAgIHRyeSB7XG4gICAgICAvLyBCdWlsZCByZXF1ZXN0XG4gICAgICBjb25zdCByZXF1ZXN0OiBDcmVhdGVUYXNrUmVxdWVzdCA9IHtcbiAgICAgICAgdGl0bGU6IHRoaXMudGFza1RpdGxlLnRyaW0oKSxcbiAgICAgICAgZGVzY3JpcHRpb246IHRoaXMudGFza0Rlc2NyaXB0aW9uLnRyaW0oKSB8fCB1bmRlZmluZWQsXG4gICAgICAgIHByaW9yaXR5OiB0aGlzLnRhc2tQcmlvcml0eSxcbiAgICAgICAgc3RhdHVzOiB0aGlzLnRhc2tTdGF0dXMsXG4gICAgICAgIHByb2plY3RJZDogdGhpcy5zZWxlY3RlZFByb2plY3RJZCxcbiAgICAgICAgZHVlRGF0ZTogdGhpcy50YXNrRHVlRGF0ZSB8fCB1bmRlZmluZWQsXG4gICAgICAgIGVzdGltYXRlZEhvdXJzOiB0aGlzLnRhc2tFc3RpbWF0ZWRIb3VycyxcbiAgICAgICAgdGFnczogdGhpcy50YXNrVGFncyxcbiAgICAgICAgY29udGV4dDoge1xuICAgICAgICAgIGFjdGl2ZUZpbGU6IHRoaXMuYWN0aXZlRmlsZSxcbiAgICAgICAgfSxcbiAgICAgIH07XG5cbiAgICAgIC8vIEV4ZWN1dGUgdXNlIGNhc2VcbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgdGhpcy5jcmVhdGVUYXNrVXNlQ2FzZS5leGVjdXRlKHJlcXVlc3QpO1xuXG4gICAgICBpZiAocmVzcG9uc2Uuc3VjY2Vzcykge1xuICAgICAgICBuZXcgTm90aWNlKGBUYXNrIFwiJHtyZXNwb25zZS50YXNrPy50aXRsZX1cIiBjcmVhdGVkIHN1Y2Nlc3NmdWxseWApO1xuICAgICAgICB0aGlzLmNsb3NlKCk7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgbmV3IE5vdGljZShgRmFpbGVkIHRvIGNyZWF0ZSB0YXNrOiAke3Jlc3BvbnNlLm1lc3NhZ2V9YCk7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJUYXNrIGNyZWF0aW9uIGZhaWxlZDpcIiwgcmVzcG9uc2UuZXJyb3JzKTtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgfVxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBuZXcgTm90aWNlKGBFcnJvciBjcmVhdGluZyB0YXNrOiAke2Vycm9yLm1lc3NhZ2V9YCk7XG4gICAgICBjb25zb2xlLmVycm9yKFwiVGFzayBjcmVhdGlvbiBlcnJvcjpcIiwgZXJyb3IpO1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBSZXNldCBmb3JtIGZpZWxkc1xuICAgKi9cbiAgcHJpdmF0ZSByZXNldEZvcm0oKSB7XG4gICAgdGhpcy50YXNrVGl0bGUgPSBcIlwiO1xuICAgIHRoaXMudGFza0Rlc2NyaXB0aW9uID0gXCJcIjtcbiAgICB0aGlzLnRhc2tQcmlvcml0eSA9IFwibWVkaXVtXCI7XG4gICAgdGhpcy50YXNrU3RhdHVzID0gXCJ0b2RvXCI7XG4gICAgdGhpcy50YXNrRHVlRGF0ZSA9IFwiXCI7XG4gICAgdGhpcy50YXNrRXN0aW1hdGVkSG91cnMgPSB1bmRlZmluZWQ7XG4gICAgdGhpcy50YXNrVGFncyA9IFtdO1xuICAgIC8vIEtlZXAgcHJvamVjdCBjb250ZXh0XG4gIH1cblxuICAvKipcbiAgICogQWRkIGN1c3RvbSBzdHlsZXNcbiAgICovXG4gIHByaXZhdGUgYWRkU3R5bGVzKCkge1xuICAgIGNvbnN0IHN0eWxlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInN0eWxlXCIpO1xuICAgIHN0eWxlLnRleHRDb250ZW50ID0gYFxuICAgICAgLnF1aWNrLXRhc2stcHJvamVjdCB7XG4gICAgICAgIHBhZGRpbmc6IDEwcHg7XG4gICAgICAgIG1hcmdpbi1ib3R0b206IDE1cHg7XG4gICAgICAgIGJhY2tncm91bmQ6IHZhcigtLWJhY2tncm91bmQtc2Vjb25kYXJ5KTtcbiAgICAgICAgYm9yZGVyLXJhZGl1czogNXB4O1xuICAgICAgfVxuXG4gICAgICAucXVpY2stdGFzay1wcm9qZWN0LWN1cnJlbnQge1xuICAgICAgICBmb250LXdlaWdodDogYm9sZDtcbiAgICAgICAgY29sb3I6IHZhcigtLXRleHQtYWNjZW50KTtcbiAgICAgIH1cblxuICAgICAgLnF1aWNrLXRhc2stcm93IHtcbiAgICAgICAgZGlzcGxheTogZmxleDtcbiAgICAgICAgZ2FwOiAxNXB4O1xuICAgICAgICBtYXJnaW4tYm90dG9tOiAxNXB4O1xuICAgICAgfVxuXG4gICAgICAucXVpY2stdGFzay1yb3cgLnNldHRpbmctaXRlbSB7XG4gICAgICAgIGZsZXg6IDE7XG4gICAgICAgIG1hcmdpbi1ib3R0b206IDA7XG4gICAgICB9XG5cbiAgICAgIC5xdWljay10YXNrLXRpdGxlLWlucHV0IHtcbiAgICAgICAgZm9udC1zaXplOiAxLjFlbTtcbiAgICAgICAgZm9udC13ZWlnaHQ6IGJvbGQ7XG4gICAgICB9XG5cbiAgICAgIC5xdWljay10YXNrLWRlc2NyaXB0aW9uLWlucHV0IHtcbiAgICAgICAgZm9udC1mYW1pbHk6IHZhcigtLWZvbnQtbW9ub3NwYWNlKTtcbiAgICAgICAgbWluLWhlaWdodDogNjBweDtcbiAgICAgIH1cblxuICAgICAgLnF1aWNrLXRhc2stdGFncy1pbnB1dCB7XG4gICAgICAgIGZvbnQtZmFtaWx5OiB2YXIoLS1mb250LW1vbm9zcGFjZSk7XG4gICAgICB9XG5cbiAgICAgIC5xdWljay10YXNrLWJ1dHRvbnMge1xuICAgICAgICBkaXNwbGF5OiBmbGV4O1xuICAgICAgICBqdXN0aWZ5LWNvbnRlbnQ6IGZsZXgtZW5kO1xuICAgICAgICBnYXA6IDEwcHg7XG4gICAgICAgIG1hcmdpbi10b3A6IDIwcHg7XG4gICAgICAgIHBhZGRpbmctdG9wOiAxNXB4O1xuICAgICAgICBib3JkZXItdG9wOiAxcHggc29saWQgdmFyKC0tYmFja2dyb3VuZC1tb2RpZmllci1ib3JkZXIpO1xuICAgICAgfVxuXG4gICAgICAucXVpY2stdGFzay1idXR0b25zIGJ1dHRvbiB7XG4gICAgICAgIHBhZGRpbmc6IDhweCAxNnB4O1xuICAgICAgfVxuICAgIGA7XG4gICAgZG9jdW1lbnQuaGVhZC5hcHBlbmRDaGlsZChzdHlsZSk7XG4gIH1cbn1cbiJdLCJ2ZXJzaW9uIjozfQ==