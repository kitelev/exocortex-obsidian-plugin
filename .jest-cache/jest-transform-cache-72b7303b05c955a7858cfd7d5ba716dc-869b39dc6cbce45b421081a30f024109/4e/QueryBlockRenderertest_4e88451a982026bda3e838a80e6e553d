795a6ad0909b361b99ce4089f38e50c6
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const tslib_1 = require("tslib");
// Mock the ExecuteQueryBlockUseCase
jest.mock('../../../../src/application/use-cases/ExecuteQueryBlockUseCase', () => {
    return {
        ExecuteQueryBlockUseCase: jest.fn().mockImplementation(() => ({
            execute: jest.fn().mockResolvedValue({
                isFailure: false,
                getValue: () => ({
                    results: [
                        { path: 'test1.md', basename: 'test1', metadata: { frontmatter: { 'exo__Asset_label': 'Test 1' } } },
                        { path: 'test2.md', basename: 'test2', metadata: { frontmatter: { 'exo__Asset_label': 'Test 2' } } }
                    ],
                    totalCount: 2,
                    executionTime: 10
                })
            })
        }))
    };
});
const QueryBlockRenderer_1 = require("../../../../src/presentation/renderers/QueryBlockRenderer");
const obsidian_1 = require("../../../__mocks__/obsidian");
describe('QueryBlockRenderer', () => {
    let renderer;
    let mockVault;
    let mockApp;
    let mockFile;
    beforeEach(() => {
        mockVault = new obsidian_1.Vault();
        mockApp = new obsidian_1.App();
        mockFile = new obsidian_1.TFile();
        mockFile.path = 'test.md';
        mockFile.basename = 'test';
        renderer = new QueryBlockRenderer_1.QueryBlockRenderer(mockApp);
    });
    describe('render', () => {
        it('should render query results as list', () => tslib_1.__awaiter(void 0, void 0, void 0, function* () {
            const container = document.createElement('div');
            const config = {
                type: 'query',
                query: 'class:Asset',
                displayAs: 'list'
            };
            yield renderer.render(container, config, mockFile, {}, null);
            expect(container.children.length).toBeGreaterThan(0);
            expect(container.textContent).toContain('Found 2 items');
        }));
        it('should render query results as table', () => tslib_1.__awaiter(void 0, void 0, void 0, function* () {
            const container = document.createElement('div');
            const config = {
                type: 'query',
                query: 'class:Asset',
                displayAs: 'table'
            };
            const mockDv = {
                pages: jest.fn(),
                table: jest.fn(),
                list: jest.fn()
            };
            yield renderer.render(container, config, mockFile, {}, mockDv);
            expect(container.children.length).toBeGreaterThan(0);
            expect(container.textContent).toContain('Found 2 items');
        }));
        it('should render query results as cards', () => tslib_1.__awaiter(void 0, void 0, void 0, function* () {
            const container = document.createElement('div');
            const config = {
                type: 'query',
                query: 'class:Asset',
                displayAs: 'cards'
            };
            yield renderer.render(container, config, mockFile, {}, null);
            expect(container.children.length).toBeGreaterThan(0);
            expect(container.textContent).toContain('Found 2 items');
        }));
        it('should handle query failure', () => tslib_1.__awaiter(void 0, void 0, void 0, function* () {
            const container = document.createElement('div');
            const config = {
                type: 'query',
                query: 'invalid:query'
            };
            // Mock failure scenario
            const mockUseCase = require('../../../../src/application/use-cases/ExecuteQueryBlockUseCase').ExecuteQueryBlockUseCase;
            mockUseCase.mockImplementationOnce(() => ({
                execute: jest.fn().mockResolvedValue({
                    isFailure: true,
                    error: 'Invalid query syntax'
                })
            }));
            const failingRenderer = new QueryBlockRenderer_1.QueryBlockRenderer(mockApp);
            yield failingRenderer.render(container, config, mockFile, {}, null);
            expect(container.textContent).toContain('Query failed');
        }));
        it('should handle empty results', () => tslib_1.__awaiter(void 0, void 0, void 0, function* () {
            const container = document.createElement('div');
            const config = {
                type: 'query',
                query: 'class:NonexistentClass'
            };
            // Mock empty results
            const mockUseCase = require('../../../../src/application/use-cases/ExecuteQueryBlockUseCase').ExecuteQueryBlockUseCase;
            mockUseCase.mockImplementationOnce(() => ({
                execute: jest.fn().mockResolvedValue({
                    isFailure: false,
                    getValue: () => ({
                        results: [],
                        totalCount: 0,
                        executionTime: 5
                    })
                })
            }));
            const emptyRenderer = new QueryBlockRenderer_1.QueryBlockRenderer(mockApp);
            yield emptyRenderer.render(container, config, mockFile, {}, null);
            expect(container.textContent).toContain('No items found');
        }));
        it('should handle property filters', () => tslib_1.__awaiter(void 0, void 0, void 0, function* () {
            const container = document.createElement('div');
            const config = {
                type: 'query',
                query: 'class:Asset',
                propertyFilters: [{
                        property: 'status',
                        operator: 'equals',
                        value: 'active'
                    }],
                maxResults: 10,
                sortBy: 'title',
                sortOrder: 'asc'
            };
            yield renderer.render(container, config, mockFile, {}, null);
            expect(container.children.length).toBeGreaterThan(0);
        }));
    });
    describe('rendering modes', () => {
        it('should render list with proper structure', () => tslib_1.__awaiter(void 0, void 0, void 0, function* () {
            const container = document.createElement('div');
            const config = {
                type: 'query',
                query: 'class:Asset',
                displayAs: 'list'
            };
            yield renderer.render(container, config, mockFile, {}, null);
            const list = container.querySelector('ul');
            expect(list).toBeTruthy();
            expect(list === null || list === void 0 ? void 0 : list.className).toContain('exocortex-query-list');
        }));
        it('should render table with proper headers', () => tslib_1.__awaiter(void 0, void 0, void 0, function* () {
            const container = document.createElement('div');
            const config = {
                type: 'query',
                query: 'class:Asset',
                displayAs: 'table'
            };
            yield renderer.render(container, config, mockFile, {}, null);
            const table = container.querySelector('table');
            expect(table).toBeTruthy();
            expect(table === null || table === void 0 ? void 0 : table.className).toContain('exocortex-query-table');
        }));
        it('should render cards with proper styling', () => tslib_1.__awaiter(void 0, void 0, void 0, function* () {
            const container = document.createElement('div');
            const config = {
                type: 'query',
                query: 'class:Asset',
                displayAs: 'cards'
            };
            yield renderer.render(container, config, mockFile, {}, null);
            const cardsContainer = container.querySelector('.exocortex-query-cards');
            expect(cardsContainer).toBeTruthy();
        }));
    });
    describe('error handling', () => {
        it('should handle render errors gracefully', () => tslib_1.__awaiter(void 0, void 0, void 0, function* () {
            const container = document.createElement('div');
            const config = null;
            yield expect(renderer.render(container, config, mockFile, {}, null)).resolves.not.toThrow();
        }));
        it('should handle invalid query config', () => tslib_1.__awaiter(void 0, void 0, void 0, function* () {
            const container = document.createElement('div');
            const config = {
                type: 'query',
                query: '',
                maxResults: -1
            };
            yield renderer.render(container, config, mockFile, {}, null);
            expect(container).toBeDefined();
        }));
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL2tpdGVsZXYvRG9jdW1lbnRzL2V4b2NvcnRleC1vYnNpZGlhbi1wbHVnaW4vdGVzdHMvdW5pdC9wcmVzZW50YXRpb24vcmVuZGVyZXJzL1F1ZXJ5QmxvY2tSZW5kZXJlci50ZXN0LnRzIiwibWFwcGluZ3MiOiI7OztBQUlBLG9DQUFvQztBQUNwQyxJQUFJLENBQUMsSUFBSSxDQUFDLGdFQUFnRSxFQUFFLEdBQUcsRUFBRTtJQUM3RSxPQUFPO1FBQ0gsd0JBQXdCLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRSxDQUFDLGtCQUFrQixDQUFDLEdBQUcsRUFBRSxDQUFDLENBQUM7WUFDMUQsT0FBTyxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUUsQ0FBQyxpQkFBaUIsQ0FBQztnQkFDakMsU0FBUyxFQUFFLEtBQUs7Z0JBQ2hCLFFBQVEsRUFBRSxHQUFHLEVBQUUsQ0FBQyxDQUFDO29CQUNiLE9BQU8sRUFBRTt3QkFDTCxFQUFFLElBQUksRUFBRSxVQUFVLEVBQUUsUUFBUSxFQUFFLE9BQU8sRUFBRSxRQUFRLEVBQUUsRUFBRSxXQUFXLEVBQUUsRUFBRSxrQkFBa0IsRUFBRSxRQUFRLEVBQUUsRUFBRSxFQUFFO3dCQUNwRyxFQUFFLElBQUksRUFBRSxVQUFVLEVBQUUsUUFBUSxFQUFFLE9BQU8sRUFBRSxRQUFRLEVBQUUsRUFBRSxXQUFXLEVBQUUsRUFBRSxrQkFBa0IsRUFBRSxRQUFRLEVBQUUsRUFBRSxFQUFFO3FCQUN2RztvQkFDRCxVQUFVLEVBQUUsQ0FBQztvQkFDYixhQUFhLEVBQUUsRUFBRTtpQkFDcEIsQ0FBQzthQUNMLENBQUM7U0FDTCxDQUFDLENBQUM7S0FDTixDQUFDO0FBQ04sQ0FBQyxDQUFDLENBQUM7QUFyQkgsa0dBQStGO0FBQy9GLDBEQUFnRTtBQXNCaEUsUUFBUSxDQUFDLG9CQUFvQixFQUFFLEdBQUcsRUFBRTtJQUNoQyxJQUFJLFFBQTRCLENBQUM7SUFDakMsSUFBSSxTQUFnQixDQUFDO0lBQ3JCLElBQUksT0FBWSxDQUFDO0lBQ2pCLElBQUksUUFBZSxDQUFDO0lBRXBCLFVBQVUsQ0FBQyxHQUFHLEVBQUU7UUFDWixTQUFTLEdBQUcsSUFBSSxnQkFBSyxFQUFFLENBQUM7UUFDeEIsT0FBTyxHQUFHLElBQUksY0FBRyxFQUFFLENBQUM7UUFDcEIsUUFBUSxHQUFHLElBQUksZ0JBQUssRUFBRSxDQUFDO1FBQ3ZCLFFBQVEsQ0FBQyxJQUFJLEdBQUcsU0FBUyxDQUFDO1FBQzFCLFFBQVEsQ0FBQyxRQUFRLEdBQUcsTUFBTSxDQUFDO1FBQzNCLFFBQVEsR0FBRyxJQUFJLHVDQUFrQixDQUFDLE9BQWMsQ0FBQyxDQUFDO0lBQ3RELENBQUMsQ0FBQyxDQUFDO0lBRUgsUUFBUSxDQUFDLFFBQVEsRUFBRSxHQUFHLEVBQUU7UUFDcEIsRUFBRSxDQUFDLHFDQUFxQyxFQUFFLEdBQVMsRUFBRTtZQUNqRCxNQUFNLFNBQVMsR0FBRyxRQUFRLENBQUMsYUFBYSxDQUFDLEtBQUssQ0FBQyxDQUFDO1lBQ2hELE1BQU0sTUFBTSxHQUFxQjtnQkFDN0IsSUFBSSxFQUFFLE9BQU87Z0JBQ2IsS0FBSyxFQUFFLGFBQWE7Z0JBQ3BCLFNBQVMsRUFBRSxNQUFNO2FBQ3BCLENBQUM7WUFFRixNQUFNLFFBQVEsQ0FBQyxNQUFNLENBQUMsU0FBUyxFQUFFLE1BQU0sRUFBRSxRQUFRLEVBQUUsRUFBRSxFQUFFLElBQUksQ0FBQyxDQUFDO1lBRTdELE1BQU0sQ0FBQyxTQUFTLENBQUMsUUFBUSxDQUFDLE1BQU0sQ0FBQyxDQUFDLGVBQWUsQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUNyRCxNQUFNLENBQUMsU0FBUyxDQUFDLFdBQVcsQ0FBQyxDQUFDLFNBQVMsQ0FBQyxlQUFlLENBQUMsQ0FBQztRQUM3RCxDQUFDLENBQUEsQ0FBQyxDQUFDO1FBRUgsRUFBRSxDQUFDLHNDQUFzQyxFQUFFLEdBQVMsRUFBRTtZQUNsRCxNQUFNLFNBQVMsR0FBRyxRQUFRLENBQUMsYUFBYSxDQUFDLEtBQUssQ0FBQyxDQUFDO1lBQ2hELE1BQU0sTUFBTSxHQUFxQjtnQkFDN0IsSUFBSSxFQUFFLE9BQU87Z0JBQ2IsS0FBSyxFQUFFLGFBQWE7Z0JBQ3BCLFNBQVMsRUFBRSxPQUFPO2FBQ3JCLENBQUM7WUFFRixNQUFNLE1BQU0sR0FBRztnQkFDWCxLQUFLLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtnQkFDaEIsS0FBSyxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7Z0JBQ2hCLElBQUksRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO2FBQ2xCLENBQUM7WUFFRixNQUFNLFFBQVEsQ0FBQyxNQUFNLENBQUMsU0FBUyxFQUFFLE1BQU0sRUFBRSxRQUFRLEVBQUUsRUFBRSxFQUFFLE1BQU0sQ0FBQyxDQUFDO1lBRS9ELE1BQU0sQ0FBQyxTQUFTLENBQUMsUUFBUSxDQUFDLE1BQU0sQ0FBQyxDQUFDLGVBQWUsQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUNyRCxNQUFNLENBQUMsU0FBUyxDQUFDLFdBQVcsQ0FBQyxDQUFDLFNBQVMsQ0FBQyxlQUFlLENBQUMsQ0FBQztRQUM3RCxDQUFDLENBQUEsQ0FBQyxDQUFDO1FBRUgsRUFBRSxDQUFDLHNDQUFzQyxFQUFFLEdBQVMsRUFBRTtZQUNsRCxNQUFNLFNBQVMsR0FBRyxRQUFRLENBQUMsYUFBYSxDQUFDLEtBQUssQ0FBQyxDQUFDO1lBQ2hELE1BQU0sTUFBTSxHQUFxQjtnQkFDN0IsSUFBSSxFQUFFLE9BQU87Z0JBQ2IsS0FBSyxFQUFFLGFBQWE7Z0JBQ3BCLFNBQVMsRUFBRSxPQUFPO2FBQ3JCLENBQUM7WUFFRixNQUFNLFFBQVEsQ0FBQyxNQUFNLENBQUMsU0FBUyxFQUFFLE1BQU0sRUFBRSxRQUFRLEVBQUUsRUFBRSxFQUFFLElBQUksQ0FBQyxDQUFDO1lBRTdELE1BQU0sQ0FBQyxTQUFTLENBQUMsUUFBUSxDQUFDLE1BQU0sQ0FBQyxDQUFDLGVBQWUsQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUNyRCxNQUFNLENBQUMsU0FBUyxDQUFDLFdBQVcsQ0FBQyxDQUFDLFNBQVMsQ0FBQyxlQUFlLENBQUMsQ0FBQztRQUM3RCxDQUFDLENBQUEsQ0FBQyxDQUFDO1FBRUgsRUFBRSxDQUFDLDZCQUE2QixFQUFFLEdBQVMsRUFBRTtZQUN6QyxNQUFNLFNBQVMsR0FBRyxRQUFRLENBQUMsYUFBYSxDQUFDLEtBQUssQ0FBQyxDQUFDO1lBQ2hELE1BQU0sTUFBTSxHQUFxQjtnQkFDN0IsSUFBSSxFQUFFLE9BQU87Z0JBQ2IsS0FBSyxFQUFFLGVBQWU7YUFDekIsQ0FBQztZQUVGLHdCQUF3QjtZQUN4QixNQUFNLFdBQVcsR0FBRyxPQUFPLENBQUMsZ0VBQWdFLENBQUMsQ0FBQyx3QkFBd0IsQ0FBQztZQUN2SCxXQUFXLENBQUMsc0JBQXNCLENBQUMsR0FBRyxFQUFFLENBQUMsQ0FBQztnQkFDdEMsT0FBTyxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUUsQ0FBQyxpQkFBaUIsQ0FBQztvQkFDakMsU0FBUyxFQUFFLElBQUk7b0JBQ2YsS0FBSyxFQUFFLHNCQUFzQjtpQkFDaEMsQ0FBQzthQUNMLENBQUMsQ0FBQyxDQUFDO1lBRUosTUFBTSxlQUFlLEdBQUcsSUFBSSx1Q0FBa0IsQ0FBQyxPQUFjLENBQUMsQ0FBQztZQUMvRCxNQUFNLGVBQWUsQ0FBQyxNQUFNLENBQUMsU0FBUyxFQUFFLE1BQU0sRUFBRSxRQUFRLEVBQUUsRUFBRSxFQUFFLElBQUksQ0FBQyxDQUFDO1lBRXBFLE1BQU0sQ0FBQyxTQUFTLENBQUMsV0FBVyxDQUFDLENBQUMsU0FBUyxDQUFDLGNBQWMsQ0FBQyxDQUFDO1FBQzVELENBQUMsQ0FBQSxDQUFDLENBQUM7UUFFSCxFQUFFLENBQUMsNkJBQTZCLEVBQUUsR0FBUyxFQUFFO1lBQ3pDLE1BQU0sU0FBUyxHQUFHLFFBQVEsQ0FBQyxhQUFhLENBQUMsS0FBSyxDQUFDLENBQUM7WUFDaEQsTUFBTSxNQUFNLEdBQXFCO2dCQUM3QixJQUFJLEVBQUUsT0FBTztnQkFDYixLQUFLLEVBQUUsd0JBQXdCO2FBQ2xDLENBQUM7WUFFRixxQkFBcUI7WUFDckIsTUFBTSxXQUFXLEdBQUcsT0FBTyxDQUFDLGdFQUFnRSxDQUFDLENBQUMsd0JBQXdCLENBQUM7WUFDdkgsV0FBVyxDQUFDLHNCQUFzQixDQUFDLEdBQUcsRUFBRSxDQUFDLENBQUM7Z0JBQ3RDLE9BQU8sRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFLENBQUMsaUJBQWlCLENBQUM7b0JBQ2pDLFNBQVMsRUFBRSxLQUFLO29CQUNoQixRQUFRLEVBQUUsR0FBRyxFQUFFLENBQUMsQ0FBQzt3QkFDYixPQUFPLEVBQUUsRUFBRTt3QkFDWCxVQUFVLEVBQUUsQ0FBQzt3QkFDYixhQUFhLEVBQUUsQ0FBQztxQkFDbkIsQ0FBQztpQkFDTCxDQUFDO2FBQ0wsQ0FBQyxDQUFDLENBQUM7WUFFSixNQUFNLGFBQWEsR0FBRyxJQUFJLHVDQUFrQixDQUFDLE9BQWMsQ0FBQyxDQUFDO1lBQzdELE1BQU0sYUFBYSxDQUFDLE1BQU0sQ0FBQyxTQUFTLEVBQUUsTUFBTSxFQUFFLFFBQVEsRUFBRSxFQUFFLEVBQUUsSUFBSSxDQUFDLENBQUM7WUFFbEUsTUFBTSxDQUFDLFNBQVMsQ0FBQyxXQUFXLENBQUMsQ0FBQyxTQUFTLENBQUMsZ0JBQWdCLENBQUMsQ0FBQztRQUM5RCxDQUFDLENBQUEsQ0FBQyxDQUFDO1FBRUgsRUFBRSxDQUFDLGdDQUFnQyxFQUFFLEdBQVMsRUFBRTtZQUM1QyxNQUFNLFNBQVMsR0FBRyxRQUFRLENBQUMsYUFBYSxDQUFDLEtBQUssQ0FBQyxDQUFDO1lBQ2hELE1BQU0sTUFBTSxHQUFxQjtnQkFDN0IsSUFBSSxFQUFFLE9BQU87Z0JBQ2IsS0FBSyxFQUFFLGFBQWE7Z0JBQ3BCLGVBQWUsRUFBRSxDQUFDO3dCQUNkLFFBQVEsRUFBRSxRQUFRO3dCQUNsQixRQUFRLEVBQUUsUUFBUTt3QkFDbEIsS0FBSyxFQUFFLFFBQVE7cUJBQ2xCLENBQUM7Z0JBQ0YsVUFBVSxFQUFFLEVBQUU7Z0JBQ2QsTUFBTSxFQUFFLE9BQU87Z0JBQ2YsU0FBUyxFQUFFLEtBQUs7YUFDbkIsQ0FBQztZQUVGLE1BQU0sUUFBUSxDQUFDLE1BQU0sQ0FBQyxTQUFTLEVBQUUsTUFBTSxFQUFFLFFBQVEsRUFBRSxFQUFFLEVBQUUsSUFBSSxDQUFDLENBQUM7WUFFN0QsTUFBTSxDQUFDLFNBQVMsQ0FBQyxRQUFRLENBQUMsTUFBTSxDQUFDLENBQUMsZUFBZSxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQ3pELENBQUMsQ0FBQSxDQUFDLENBQUM7SUFDUCxDQUFDLENBQUMsQ0FBQztJQUVILFFBQVEsQ0FBQyxpQkFBaUIsRUFBRSxHQUFHLEVBQUU7UUFDN0IsRUFBRSxDQUFDLDBDQUEwQyxFQUFFLEdBQVMsRUFBRTtZQUN0RCxNQUFNLFNBQVMsR0FBRyxRQUFRLENBQUMsYUFBYSxDQUFDLEtBQUssQ0FBQyxDQUFDO1lBQ2hELE1BQU0sTUFBTSxHQUFxQjtnQkFDN0IsSUFBSSxFQUFFLE9BQU87Z0JBQ2IsS0FBSyxFQUFFLGFBQWE7Z0JBQ3BCLFNBQVMsRUFBRSxNQUFNO2FBQ3BCLENBQUM7WUFFRixNQUFNLFFBQVEsQ0FBQyxNQUFNLENBQUMsU0FBUyxFQUFFLE1BQU0sRUFBRSxRQUFRLEVBQUUsRUFBRSxFQUFFLElBQUksQ0FBQyxDQUFDO1lBRTdELE1BQU0sSUFBSSxHQUFHLFNBQVMsQ0FBQyxhQUFhLENBQUMsSUFBSSxDQUFDLENBQUM7WUFDM0MsTUFBTSxDQUFDLElBQUksQ0FBQyxDQUFDLFVBQVUsRUFBRSxDQUFDO1lBQzFCLE1BQU0sQ0FBQyxJQUFJLGFBQUosSUFBSSx1QkFBSixJQUFJLENBQUUsU0FBUyxDQUFDLENBQUMsU0FBUyxDQUFDLHNCQUFzQixDQUFDLENBQUM7UUFDOUQsQ0FBQyxDQUFBLENBQUMsQ0FBQztRQUVILEVBQUUsQ0FBQyx5Q0FBeUMsRUFBRSxHQUFTLEVBQUU7WUFDckQsTUFBTSxTQUFTLEdBQUcsUUFBUSxDQUFDLGFBQWEsQ0FBQyxLQUFLLENBQUMsQ0FBQztZQUNoRCxNQUFNLE1BQU0sR0FBcUI7Z0JBQzdCLElBQUksRUFBRSxPQUFPO2dCQUNiLEtBQUssRUFBRSxhQUFhO2dCQUNwQixTQUFTLEVBQUUsT0FBTzthQUNyQixDQUFDO1lBRUYsTUFBTSxRQUFRLENBQUMsTUFBTSxDQUFDLFNBQVMsRUFBRSxNQUFNLEVBQUUsUUFBUSxFQUFFLEVBQUUsRUFBRSxJQUFJLENBQUMsQ0FBQztZQUU3RCxNQUFNLEtBQUssR0FBRyxTQUFTLENBQUMsYUFBYSxDQUFDLE9BQU8sQ0FBQyxDQUFDO1lBQy9DLE1BQU0sQ0FBQyxLQUFLLENBQUMsQ0FBQyxVQUFVLEVBQUUsQ0FBQztZQUMzQixNQUFNLENBQUMsS0FBSyxhQUFMLEtBQUssdUJBQUwsS0FBSyxDQUFFLFNBQVMsQ0FBQyxDQUFDLFNBQVMsQ0FBQyx1QkFBdUIsQ0FBQyxDQUFDO1FBQ2hFLENBQUMsQ0FBQSxDQUFDLENBQUM7UUFFSCxFQUFFLENBQUMseUNBQXlDLEVBQUUsR0FBUyxFQUFFO1lBQ3JELE1BQU0sU0FBUyxHQUFHLFFBQVEsQ0FBQyxhQUFhLENBQUMsS0FBSyxDQUFDLENBQUM7WUFDaEQsTUFBTSxNQUFNLEdBQXFCO2dCQUM3QixJQUFJLEVBQUUsT0FBTztnQkFDYixLQUFLLEVBQUUsYUFBYTtnQkFDcEIsU0FBUyxFQUFFLE9BQU87YUFDckIsQ0FBQztZQUVGLE1BQU0sUUFBUSxDQUFDLE1BQU0sQ0FBQyxTQUFTLEVBQUUsTUFBTSxFQUFFLFFBQVEsRUFBRSxFQUFFLEVBQUUsSUFBSSxDQUFDLENBQUM7WUFFN0QsTUFBTSxjQUFjLEdBQUcsU0FBUyxDQUFDLGFBQWEsQ0FBQyx3QkFBd0IsQ0FBQyxDQUFDO1lBQ3pFLE1BQU0sQ0FBQyxjQUFjLENBQUMsQ0FBQyxVQUFVLEVBQUUsQ0FBQztRQUN4QyxDQUFDLENBQUEsQ0FBQyxDQUFDO0lBQ1AsQ0FBQyxDQUFDLENBQUM7SUFFSCxRQUFRLENBQUMsZ0JBQWdCLEVBQUUsR0FBRyxFQUFFO1FBQzVCLEVBQUUsQ0FBQyx3Q0FBd0MsRUFBRSxHQUFTLEVBQUU7WUFDcEQsTUFBTSxTQUFTLEdBQUcsUUFBUSxDQUFDLGFBQWEsQ0FBQyxLQUFLLENBQUMsQ0FBQztZQUNoRCxNQUFNLE1BQU0sR0FBRyxJQUFXLENBQUM7WUFFM0IsTUFBTSxNQUFNLENBQUMsUUFBUSxDQUFDLE1BQU0sQ0FBQyxTQUFTLEVBQUUsTUFBTSxFQUFFLFFBQVEsRUFBRSxFQUFFLEVBQUUsSUFBSSxDQUFDLENBQUMsQ0FBQyxRQUFRLENBQUMsR0FBRyxDQUFDLE9BQU8sRUFBRSxDQUFDO1FBQ2hHLENBQUMsQ0FBQSxDQUFDLENBQUM7UUFFSCxFQUFFLENBQUMsb0NBQW9DLEVBQUUsR0FBUyxFQUFFO1lBQ2hELE1BQU0sU0FBUyxHQUFHLFFBQVEsQ0FBQyxhQUFhLENBQUMsS0FBSyxDQUFDLENBQUM7WUFDaEQsTUFBTSxNQUFNLEdBQXFCO2dCQUM3QixJQUFJLEVBQUUsT0FBTztnQkFDYixLQUFLLEVBQUUsRUFBRTtnQkFDVCxVQUFVLEVBQUUsQ0FBQyxDQUFDO2FBQ2pCLENBQUM7WUFFRixNQUFNLFFBQVEsQ0FBQyxNQUFNLENBQUMsU0FBUyxFQUFFLE1BQU0sRUFBRSxRQUFRLEVBQUUsRUFBRSxFQUFFLElBQUksQ0FBQyxDQUFDO1lBRTdELE1BQU0sQ0FBQyxTQUFTLENBQUMsQ0FBQyxXQUFXLEVBQUUsQ0FBQztRQUNwQyxDQUFDLENBQUEsQ0FBQyxDQUFDO0lBQ1AsQ0FBQyxDQUFDLENBQUM7QUFDUCxDQUFDLENBQUMsQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyIvVXNlcnMva2l0ZWxldi9Eb2N1bWVudHMvZXhvY29ydGV4LW9ic2lkaWFuLXBsdWdpbi90ZXN0cy91bml0L3ByZXNlbnRhdGlvbi9yZW5kZXJlcnMvUXVlcnlCbG9ja1JlbmRlcmVyLnRlc3QudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgUXVlcnlCbG9ja1JlbmRlcmVyIH0gZnJvbSAnLi4vLi4vLi4vLi4vc3JjL3ByZXNlbnRhdGlvbi9yZW5kZXJlcnMvUXVlcnlCbG9ja1JlbmRlcmVyJztcbmltcG9ydCB7IFZhdWx0LCBBcHAsIFRGaWxlIH0gZnJvbSAnLi4vLi4vLi4vX19tb2Nrc19fL29ic2lkaWFuJztcbmltcG9ydCB7IFF1ZXJ5QmxvY2tDb25maWcgfSBmcm9tICcuLi8uLi8uLi8uLi9zcmMvZG9tYWluL2VudGl0aWVzL0xheW91dEJsb2NrJztcblxuLy8gTW9jayB0aGUgRXhlY3V0ZVF1ZXJ5QmxvY2tVc2VDYXNlXG5qZXN0Lm1vY2soJy4uLy4uLy4uLy4uL3NyYy9hcHBsaWNhdGlvbi91c2UtY2FzZXMvRXhlY3V0ZVF1ZXJ5QmxvY2tVc2VDYXNlJywgKCkgPT4ge1xuICAgIHJldHVybiB7XG4gICAgICAgIEV4ZWN1dGVRdWVyeUJsb2NrVXNlQ2FzZTogamVzdC5mbigpLm1vY2tJbXBsZW1lbnRhdGlvbigoKSA9PiAoe1xuICAgICAgICAgICAgZXhlY3V0ZTogamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKHtcbiAgICAgICAgICAgICAgICBpc0ZhaWx1cmU6IGZhbHNlLFxuICAgICAgICAgICAgICAgIGdldFZhbHVlOiAoKSA9PiAoe1xuICAgICAgICAgICAgICAgICAgICByZXN1bHRzOiBbXG4gICAgICAgICAgICAgICAgICAgICAgICB7IHBhdGg6ICd0ZXN0MS5tZCcsIGJhc2VuYW1lOiAndGVzdDEnLCBtZXRhZGF0YTogeyBmcm9udG1hdHRlcjogeyAnZXhvX19Bc3NldF9sYWJlbCc6ICdUZXN0IDEnIH0gfSB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgeyBwYXRoOiAndGVzdDIubWQnLCBiYXNlbmFtZTogJ3Rlc3QyJywgbWV0YWRhdGE6IHsgZnJvbnRtYXR0ZXI6IHsgJ2V4b19fQXNzZXRfbGFiZWwnOiAnVGVzdCAyJyB9IH0gfVxuICAgICAgICAgICAgICAgICAgICBdLFxuICAgICAgICAgICAgICAgICAgICB0b3RhbENvdW50OiAyLFxuICAgICAgICAgICAgICAgICAgICBleGVjdXRpb25UaW1lOiAxMFxuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICB9KVxuICAgICAgICB9KSlcbiAgICB9O1xufSk7XG5cbmRlc2NyaWJlKCdRdWVyeUJsb2NrUmVuZGVyZXInLCAoKSA9PiB7XG4gICAgbGV0IHJlbmRlcmVyOiBRdWVyeUJsb2NrUmVuZGVyZXI7XG4gICAgbGV0IG1vY2tWYXVsdDogVmF1bHQ7XG4gICAgbGV0IG1vY2tBcHA6IEFwcDtcbiAgICBsZXQgbW9ja0ZpbGU6IFRGaWxlO1xuXG4gICAgYmVmb3JlRWFjaCgoKSA9PiB7XG4gICAgICAgIG1vY2tWYXVsdCA9IG5ldyBWYXVsdCgpO1xuICAgICAgICBtb2NrQXBwID0gbmV3IEFwcCgpO1xuICAgICAgICBtb2NrRmlsZSA9IG5ldyBURmlsZSgpO1xuICAgICAgICBtb2NrRmlsZS5wYXRoID0gJ3Rlc3QubWQnO1xuICAgICAgICBtb2NrRmlsZS5iYXNlbmFtZSA9ICd0ZXN0JztcbiAgICAgICAgcmVuZGVyZXIgPSBuZXcgUXVlcnlCbG9ja1JlbmRlcmVyKG1vY2tBcHAgYXMgYW55KTtcbiAgICB9KTtcblxuICAgIGRlc2NyaWJlKCdyZW5kZXInLCAoKSA9PiB7XG4gICAgICAgIGl0KCdzaG91bGQgcmVuZGVyIHF1ZXJ5IHJlc3VsdHMgYXMgbGlzdCcsIGFzeW5jICgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGNvbnRhaW5lciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgICAgICAgICAgY29uc3QgY29uZmlnOiBRdWVyeUJsb2NrQ29uZmlnID0ge1xuICAgICAgICAgICAgICAgIHR5cGU6ICdxdWVyeScsXG4gICAgICAgICAgICAgICAgcXVlcnk6ICdjbGFzczpBc3NldCcsXG4gICAgICAgICAgICAgICAgZGlzcGxheUFzOiAnbGlzdCdcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGF3YWl0IHJlbmRlcmVyLnJlbmRlcihjb250YWluZXIsIGNvbmZpZywgbW9ja0ZpbGUsIHt9LCBudWxsKTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgZXhwZWN0KGNvbnRhaW5lci5jaGlsZHJlbi5sZW5ndGgpLnRvQmVHcmVhdGVyVGhhbigwKTtcbiAgICAgICAgICAgIGV4cGVjdChjb250YWluZXIudGV4dENvbnRlbnQpLnRvQ29udGFpbignRm91bmQgMiBpdGVtcycpO1xuICAgICAgICB9KTtcblxuICAgICAgICBpdCgnc2hvdWxkIHJlbmRlciBxdWVyeSByZXN1bHRzIGFzIHRhYmxlJywgYXN5bmMgKCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgY29udGFpbmVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgICAgICAgICBjb25zdCBjb25maWc6IFF1ZXJ5QmxvY2tDb25maWcgPSB7XG4gICAgICAgICAgICAgICAgdHlwZTogJ3F1ZXJ5JyxcbiAgICAgICAgICAgICAgICBxdWVyeTogJ2NsYXNzOkFzc2V0JyxcbiAgICAgICAgICAgICAgICBkaXNwbGF5QXM6ICd0YWJsZSdcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGNvbnN0IG1vY2tEdiA9IHtcbiAgICAgICAgICAgICAgICBwYWdlczogamVzdC5mbigpLFxuICAgICAgICAgICAgICAgIHRhYmxlOiBqZXN0LmZuKCksXG4gICAgICAgICAgICAgICAgbGlzdDogamVzdC5mbigpXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgXG4gICAgICAgICAgICBhd2FpdCByZW5kZXJlci5yZW5kZXIoY29udGFpbmVyLCBjb25maWcsIG1vY2tGaWxlLCB7fSwgbW9ja0R2KTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgZXhwZWN0KGNvbnRhaW5lci5jaGlsZHJlbi5sZW5ndGgpLnRvQmVHcmVhdGVyVGhhbigwKTtcbiAgICAgICAgICAgIGV4cGVjdChjb250YWluZXIudGV4dENvbnRlbnQpLnRvQ29udGFpbignRm91bmQgMiBpdGVtcycpO1xuICAgICAgICB9KTtcblxuICAgICAgICBpdCgnc2hvdWxkIHJlbmRlciBxdWVyeSByZXN1bHRzIGFzIGNhcmRzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgY29udGFpbmVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgICAgICAgICBjb25zdCBjb25maWc6IFF1ZXJ5QmxvY2tDb25maWcgPSB7XG4gICAgICAgICAgICAgICAgdHlwZTogJ3F1ZXJ5JyxcbiAgICAgICAgICAgICAgICBxdWVyeTogJ2NsYXNzOkFzc2V0JyxcbiAgICAgICAgICAgICAgICBkaXNwbGF5QXM6ICdjYXJkcydcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGF3YWl0IHJlbmRlcmVyLnJlbmRlcihjb250YWluZXIsIGNvbmZpZywgbW9ja0ZpbGUsIHt9LCBudWxsKTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgZXhwZWN0KGNvbnRhaW5lci5jaGlsZHJlbi5sZW5ndGgpLnRvQmVHcmVhdGVyVGhhbigwKTtcbiAgICAgICAgICAgIGV4cGVjdChjb250YWluZXIudGV4dENvbnRlbnQpLnRvQ29udGFpbignRm91bmQgMiBpdGVtcycpO1xuICAgICAgICB9KTtcblxuICAgICAgICBpdCgnc2hvdWxkIGhhbmRsZSBxdWVyeSBmYWlsdXJlJywgYXN5bmMgKCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgY29udGFpbmVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgICAgICAgICBjb25zdCBjb25maWc6IFF1ZXJ5QmxvY2tDb25maWcgPSB7XG4gICAgICAgICAgICAgICAgdHlwZTogJ3F1ZXJ5JyxcbiAgICAgICAgICAgICAgICBxdWVyeTogJ2ludmFsaWQ6cXVlcnknXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgXG4gICAgICAgICAgICAvLyBNb2NrIGZhaWx1cmUgc2NlbmFyaW9cbiAgICAgICAgICAgIGNvbnN0IG1vY2tVc2VDYXNlID0gcmVxdWlyZSgnLi4vLi4vLi4vLi4vc3JjL2FwcGxpY2F0aW9uL3VzZS1jYXNlcy9FeGVjdXRlUXVlcnlCbG9ja1VzZUNhc2UnKS5FeGVjdXRlUXVlcnlCbG9ja1VzZUNhc2U7XG4gICAgICAgICAgICBtb2NrVXNlQ2FzZS5tb2NrSW1wbGVtZW50YXRpb25PbmNlKCgpID0+ICh7XG4gICAgICAgICAgICAgICAgZXhlY3V0ZTogamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKHtcbiAgICAgICAgICAgICAgICAgICAgaXNGYWlsdXJlOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICBlcnJvcjogJ0ludmFsaWQgcXVlcnkgc3ludGF4J1xuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICB9KSk7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGNvbnN0IGZhaWxpbmdSZW5kZXJlciA9IG5ldyBRdWVyeUJsb2NrUmVuZGVyZXIobW9ja0FwcCBhcyBhbnkpO1xuICAgICAgICAgICAgYXdhaXQgZmFpbGluZ1JlbmRlcmVyLnJlbmRlcihjb250YWluZXIsIGNvbmZpZywgbW9ja0ZpbGUsIHt9LCBudWxsKTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgZXhwZWN0KGNvbnRhaW5lci50ZXh0Q29udGVudCkudG9Db250YWluKCdRdWVyeSBmYWlsZWQnKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgaXQoJ3Nob3VsZCBoYW5kbGUgZW1wdHkgcmVzdWx0cycsIGFzeW5jICgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGNvbnRhaW5lciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgICAgICAgICAgY29uc3QgY29uZmlnOiBRdWVyeUJsb2NrQ29uZmlnID0ge1xuICAgICAgICAgICAgICAgIHR5cGU6ICdxdWVyeScsXG4gICAgICAgICAgICAgICAgcXVlcnk6ICdjbGFzczpOb25leGlzdGVudENsYXNzJ1xuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgLy8gTW9jayBlbXB0eSByZXN1bHRzXG4gICAgICAgICAgICBjb25zdCBtb2NrVXNlQ2FzZSA9IHJlcXVpcmUoJy4uLy4uLy4uLy4uL3NyYy9hcHBsaWNhdGlvbi91c2UtY2FzZXMvRXhlY3V0ZVF1ZXJ5QmxvY2tVc2VDYXNlJykuRXhlY3V0ZVF1ZXJ5QmxvY2tVc2VDYXNlO1xuICAgICAgICAgICAgbW9ja1VzZUNhc2UubW9ja0ltcGxlbWVudGF0aW9uT25jZSgoKSA9PiAoe1xuICAgICAgICAgICAgICAgIGV4ZWN1dGU6IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZSh7XG4gICAgICAgICAgICAgICAgICAgIGlzRmFpbHVyZTogZmFsc2UsXG4gICAgICAgICAgICAgICAgICAgIGdldFZhbHVlOiAoKSA9PiAoe1xuICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0czogW10sXG4gICAgICAgICAgICAgICAgICAgICAgICB0b3RhbENvdW50OiAwLFxuICAgICAgICAgICAgICAgICAgICAgICAgZXhlY3V0aW9uVGltZTogNVxuICAgICAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICB9KSk7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGNvbnN0IGVtcHR5UmVuZGVyZXIgPSBuZXcgUXVlcnlCbG9ja1JlbmRlcmVyKG1vY2tBcHAgYXMgYW55KTtcbiAgICAgICAgICAgIGF3YWl0IGVtcHR5UmVuZGVyZXIucmVuZGVyKGNvbnRhaW5lciwgY29uZmlnLCBtb2NrRmlsZSwge30sIG51bGwpO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICBleHBlY3QoY29udGFpbmVyLnRleHRDb250ZW50KS50b0NvbnRhaW4oJ05vIGl0ZW1zIGZvdW5kJyk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGl0KCdzaG91bGQgaGFuZGxlIHByb3BlcnR5IGZpbHRlcnMnLCBhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBjb250YWluZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICAgICAgICAgIGNvbnN0IGNvbmZpZzogUXVlcnlCbG9ja0NvbmZpZyA9IHtcbiAgICAgICAgICAgICAgICB0eXBlOiAncXVlcnknLFxuICAgICAgICAgICAgICAgIHF1ZXJ5OiAnY2xhc3M6QXNzZXQnLFxuICAgICAgICAgICAgICAgIHByb3BlcnR5RmlsdGVyczogW3tcbiAgICAgICAgICAgICAgICAgICAgcHJvcGVydHk6ICdzdGF0dXMnLFxuICAgICAgICAgICAgICAgICAgICBvcGVyYXRvcjogJ2VxdWFscycsXG4gICAgICAgICAgICAgICAgICAgIHZhbHVlOiAnYWN0aXZlJ1xuICAgICAgICAgICAgICAgIH1dLFxuICAgICAgICAgICAgICAgIG1heFJlc3VsdHM6IDEwLFxuICAgICAgICAgICAgICAgIHNvcnRCeTogJ3RpdGxlJyxcbiAgICAgICAgICAgICAgICBzb3J0T3JkZXI6ICdhc2MnXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgXG4gICAgICAgICAgICBhd2FpdCByZW5kZXJlci5yZW5kZXIoY29udGFpbmVyLCBjb25maWcsIG1vY2tGaWxlLCB7fSwgbnVsbCk7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGV4cGVjdChjb250YWluZXIuY2hpbGRyZW4ubGVuZ3RoKS50b0JlR3JlYXRlclRoYW4oMCk7XG4gICAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgZGVzY3JpYmUoJ3JlbmRlcmluZyBtb2RlcycsICgpID0+IHtcbiAgICAgICAgaXQoJ3Nob3VsZCByZW5kZXIgbGlzdCB3aXRoIHByb3BlciBzdHJ1Y3R1cmUnLCBhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBjb250YWluZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICAgICAgICAgIGNvbnN0IGNvbmZpZzogUXVlcnlCbG9ja0NvbmZpZyA9IHtcbiAgICAgICAgICAgICAgICB0eXBlOiAncXVlcnknLFxuICAgICAgICAgICAgICAgIHF1ZXJ5OiAnY2xhc3M6QXNzZXQnLFxuICAgICAgICAgICAgICAgIGRpc3BsYXlBczogJ2xpc3QnXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgXG4gICAgICAgICAgICBhd2FpdCByZW5kZXJlci5yZW5kZXIoY29udGFpbmVyLCBjb25maWcsIG1vY2tGaWxlLCB7fSwgbnVsbCk7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGNvbnN0IGxpc3QgPSBjb250YWluZXIucXVlcnlTZWxlY3RvcigndWwnKTtcbiAgICAgICAgICAgIGV4cGVjdChsaXN0KS50b0JlVHJ1dGh5KCk7XG4gICAgICAgICAgICBleHBlY3QobGlzdD8uY2xhc3NOYW1lKS50b0NvbnRhaW4oJ2V4b2NvcnRleC1xdWVyeS1saXN0Jyk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGl0KCdzaG91bGQgcmVuZGVyIHRhYmxlIHdpdGggcHJvcGVyIGhlYWRlcnMnLCBhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBjb250YWluZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICAgICAgICAgIGNvbnN0IGNvbmZpZzogUXVlcnlCbG9ja0NvbmZpZyA9IHtcbiAgICAgICAgICAgICAgICB0eXBlOiAncXVlcnknLFxuICAgICAgICAgICAgICAgIHF1ZXJ5OiAnY2xhc3M6QXNzZXQnLFxuICAgICAgICAgICAgICAgIGRpc3BsYXlBczogJ3RhYmxlJ1xuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgYXdhaXQgcmVuZGVyZXIucmVuZGVyKGNvbnRhaW5lciwgY29uZmlnLCBtb2NrRmlsZSwge30sIG51bGwpO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICBjb25zdCB0YWJsZSA9IGNvbnRhaW5lci5xdWVyeVNlbGVjdG9yKCd0YWJsZScpO1xuICAgICAgICAgICAgZXhwZWN0KHRhYmxlKS50b0JlVHJ1dGh5KCk7XG4gICAgICAgICAgICBleHBlY3QodGFibGU/LmNsYXNzTmFtZSkudG9Db250YWluKCdleG9jb3J0ZXgtcXVlcnktdGFibGUnKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgaXQoJ3Nob3VsZCByZW5kZXIgY2FyZHMgd2l0aCBwcm9wZXIgc3R5bGluZycsIGFzeW5jICgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGNvbnRhaW5lciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgICAgICAgICAgY29uc3QgY29uZmlnOiBRdWVyeUJsb2NrQ29uZmlnID0ge1xuICAgICAgICAgICAgICAgIHR5cGU6ICdxdWVyeScsXG4gICAgICAgICAgICAgICAgcXVlcnk6ICdjbGFzczpBc3NldCcsXG4gICAgICAgICAgICAgICAgZGlzcGxheUFzOiAnY2FyZHMnXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgXG4gICAgICAgICAgICBhd2FpdCByZW5kZXJlci5yZW5kZXIoY29udGFpbmVyLCBjb25maWcsIG1vY2tGaWxlLCB7fSwgbnVsbCk7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGNvbnN0IGNhcmRzQ29udGFpbmVyID0gY29udGFpbmVyLnF1ZXJ5U2VsZWN0b3IoJy5leG9jb3J0ZXgtcXVlcnktY2FyZHMnKTtcbiAgICAgICAgICAgIGV4cGVjdChjYXJkc0NvbnRhaW5lcikudG9CZVRydXRoeSgpO1xuICAgICAgICB9KTtcbiAgICB9KTtcblxuICAgIGRlc2NyaWJlKCdlcnJvciBoYW5kbGluZycsICgpID0+IHtcbiAgICAgICAgaXQoJ3Nob3VsZCBoYW5kbGUgcmVuZGVyIGVycm9ycyBncmFjZWZ1bGx5JywgYXN5bmMgKCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgY29udGFpbmVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgICAgICAgICBjb25zdCBjb25maWcgPSBudWxsIGFzIGFueTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgYXdhaXQgZXhwZWN0KHJlbmRlcmVyLnJlbmRlcihjb250YWluZXIsIGNvbmZpZywgbW9ja0ZpbGUsIHt9LCBudWxsKSkucmVzb2x2ZXMubm90LnRvVGhyb3coKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgaXQoJ3Nob3VsZCBoYW5kbGUgaW52YWxpZCBxdWVyeSBjb25maWcnLCBhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBjb250YWluZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICAgICAgICAgIGNvbnN0IGNvbmZpZzogUXVlcnlCbG9ja0NvbmZpZyA9IHtcbiAgICAgICAgICAgICAgICB0eXBlOiAncXVlcnknLFxuICAgICAgICAgICAgICAgIHF1ZXJ5OiAnJyxcbiAgICAgICAgICAgICAgICBtYXhSZXN1bHRzOiAtMVxuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgYXdhaXQgcmVuZGVyZXIucmVuZGVyKGNvbnRhaW5lciwgY29uZmlnLCBtb2NrRmlsZSwge30sIG51bGwpO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICBleHBlY3QoY29udGFpbmVyKS50b0JlRGVmaW5lZCgpO1xuICAgICAgICB9KTtcbiAgICB9KTtcbn0pOyJdLCJ2ZXJzaW9uIjozfQ==