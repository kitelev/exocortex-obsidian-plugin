c3465de8ebb9a8540da3d9bf19ceb9c8
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.SPARQLEngine = void 0;
const Triple_1 = require("../domain/semantic/core/Triple");
const QueryCache_1 = require("./services/QueryCache");
class SPARQLEngine {
    constructor(graph, cacheConfig) {
        this.graph = graph;
        this.queryCache = new QueryCache_1.QueryCache(cacheConfig);
    }
    /**
     * Execute CONSTRUCT query to generate new triples
     */
    construct(query) {
        // Check cache first
        const cacheKey = this.queryCache.createCacheKey(`CONSTRUCT:${query}`);
        const cachedResult = this.queryCache.get(cacheKey);
        if (cachedResult) {
            return Object.assign(Object.assign({}, cachedResult), { cached: true });
        }
        // Parse CONSTRUCT query
        const constructMatch = query.match(/CONSTRUCT\s*\{(.*?)\}\s*WHERE\s*\{(.*?)\}/is);
        if (!constructMatch) {
            throw new Error('Invalid CONSTRUCT query format');
        }
        const template = this.parseConstructTemplate(constructMatch[1]);
        const patterns = this.parsePatterns(constructMatch[2]);
        if (patterns.length === 0) {
            return { triples: [], provenance: `CONSTRUCT query at ${new Date().toISOString()}` };
        }
        const generatedTriples = [];
        // Handle multiple patterns by joining results
        if (patterns.length === 1) {
            // Single pattern - simple case
            const pattern = patterns[0];
            // Convert pattern strings to proper types, stripping angle brackets from IRIs
            const subject = pattern.subject.startsWith('?') ? null :
                new Triple_1.IRI(pattern.subject.replace(/^<|>$/g, ''));
            const predicate = pattern.predicate.startsWith('?') ? null :
                new Triple_1.IRI(pattern.predicate.replace(/^<|>$/g, ''));
            const object = pattern.object.startsWith('?') ? null : this.parseObjectForMatching(pattern.object);
            const matchedTriples = this.graph.match(subject, predicate, object);
            for (const triple of matchedTriples) {
                const binding = this.createBinding(pattern, triple);
                const newTriples = this.instantiateTemplate(template, binding);
                generatedTriples.push(...newTriples);
            }
        }
        else {
            // Multiple patterns - need to join bindings
            const bindings = this.executeWhereClause(patterns);
            for (const binding of bindings) {
                const newTriples = this.instantiateTemplate(template, binding);
                generatedTriples.push(...newTriples);
            }
        }
        // Apply LIMIT if present
        const limitMatch = query.match(/LIMIT\s+(\d+)/i);
        let result;
        if (limitMatch) {
            const limit = parseInt(limitMatch[1]);
            result = {
                triples: generatedTriples.slice(0, limit),
                provenance: `CONSTRUCT query at ${new Date().toISOString()}`,
                cached: false
            };
        }
        else {
            result = {
                triples: generatedTriples,
                provenance: `CONSTRUCT query at ${new Date().toISOString()}`,
                cached: false
            };
        }
        // Cache the result
        this.queryCache.set(cacheKey, result);
        return result;
    }
    parseConstructTemplate(templateClause) {
        const templates = [];
        // Split by period followed by whitespace or newline, not just any period
        const lines = templateClause.trim().split(/\.\s*(?:\n|\s|$)/);
        for (const line of lines) {
            const trimmed = line.trim();
            if (!trimmed)
                continue;
            const parts = trimmed.split(/\s+/);
            if (parts.length >= 3) {
                // Preserve quotes for literals
                let object = parts.slice(2).join(' ');
                templates.push({
                    subject: parts[0],
                    predicate: parts[1],
                    object: object
                });
            }
        }
        return templates;
    }
    createBinding(pattern, triple) {
        const binding = {};
        if (pattern.subject.startsWith('?')) {
            binding[pattern.subject.substring(1)] = this.formatForBinding(triple.getSubject());
        }
        if (pattern.predicate.startsWith('?')) {
            binding[pattern.predicate.substring(1)] = this.formatForBinding(triple.getPredicate());
        }
        if (pattern.object.startsWith('?')) {
            binding[pattern.object.substring(1)] = this.formatForBinding(triple.getObject());
        }
        return binding;
    }
    formatForBinding(node) {
        // For SELECT query results, return user-friendly string representation
        if (node.getValue) {
            // It's a Literal - return just the quoted value for user-friendly display
            return `"${node.getValue()}"`;
        }
        // For IRIs and BlankNodes, use standard toString
        return node.toString();
    }
    instantiateTemplate(template, binding) {
        const triples = [];
        for (const t of template) {
            const subjectStr = this.resolveValue(t.subject, binding);
            const predicateStr = this.resolveValue(t.predicate, binding);
            const objectStr = this.resolveValue(t.object, binding);
            if (subjectStr && predicateStr && objectStr) {
                // Create proper Triple objects
                const subject = subjectStr.startsWith('_:') ? new Triple_1.BlankNode(subjectStr) : new Triple_1.IRI(subjectStr.replace(/^<|>$/g, ''));
                const predicate = new Triple_1.IRI(predicateStr.replace(/^<|>$/g, ''));
                // Handle different object types
                let object;
                if (objectStr.startsWith('"')) {
                    // It's a string literal - create typed literal with datatype
                    object = Triple_1.Literal.string(objectStr.replace(/^"|"$/g, ''));
                }
                else if (objectStr === 'true' || objectStr === 'false') {
                    // Boolean literal
                    object = Triple_1.Literal.boolean(objectStr === 'true');
                }
                else if (objectStr.startsWith('_:')) {
                    // Blank node
                    object = new Triple_1.BlankNode(objectStr);
                }
                else if (/^\d+$/.test(objectStr)) {
                    // Integer literal
                    object = Triple_1.Literal.integer(parseInt(objectStr));
                }
                else if (/^\d+\.\d+$/.test(objectStr)) {
                    // Double literal
                    object = Triple_1.Literal.double(parseFloat(objectStr));
                }
                else {
                    // IRI
                    object = new Triple_1.IRI(objectStr.replace(/^<|>$/g, ''));
                }
                triples.push(new Triple_1.Triple(subject, predicate, object));
            }
        }
        return triples;
    }
    resolveValue(value, binding) {
        if (value.startsWith('?')) {
            const varName = value.substring(1);
            return binding[varName] || null;
        }
        return value;
    }
    executeWhereClause(patterns) {
        if (patterns.length === 0)
            return [];
        // Start with first pattern
        const firstPattern = patterns[0];
        const firstTriples = this.graph.match(firstPattern.subject.startsWith('?') ? null : new Triple_1.IRI(firstPattern.subject.replace(/^<|>$/g, '')), firstPattern.predicate.startsWith('?') ? null : new Triple_1.IRI(firstPattern.predicate.replace(/^<|>$/g, '')), firstPattern.object.startsWith('?') ? null :
            (firstPattern.object.startsWith('"') ?
                new Triple_1.Literal(firstPattern.object.replace(/^"|"$/g, '')) :
                new Triple_1.IRI(firstPattern.object.replace(/^<|>$/g, ''))));
        let bindings = [];
        for (const triple of firstTriples) {
            bindings.push(this.createBinding(firstPattern, triple));
        }
        // Join with subsequent patterns
        for (let i = 1; i < patterns.length; i++) {
            const pattern = patterns[i];
            const newBindings = [];
            for (const binding of bindings) {
                // Resolve pattern with current binding
                const subjectStr = pattern.subject.startsWith('?')
                    ? (binding[pattern.subject.substring(1)] || null)
                    : pattern.subject;
                const predicateStr = pattern.predicate.startsWith('?')
                    ? (binding[pattern.predicate.substring(1)] || null)
                    : pattern.predicate;
                const objectStr = pattern.object.startsWith('?')
                    ? (binding[pattern.object.substring(1)] || null)
                    : pattern.object;
                // Convert strings to proper types for match
                const subject = subjectStr ? new Triple_1.IRI(subjectStr.replace(/^<|>$/g, '')) : null;
                const predicate = predicateStr ? new Triple_1.IRI(predicateStr.replace(/^<|>$/g, '')) : null;
                const object = objectStr ? this.parseObjectForMatching(objectStr) : null;
                // Find matching triples
                const matches = this.graph.match(subject, predicate, object);
                for (const triple of matches) {
                    const extendedBinding = Object.assign({}, binding);
                    // Add new variable bindings
                    if (pattern.subject.startsWith('?') && !subjectStr) {
                        extendedBinding[pattern.subject.substring(1)] = this.formatForBinding(triple.getSubject());
                    }
                    if (pattern.predicate.startsWith('?') && !predicateStr) {
                        extendedBinding[pattern.predicate.substring(1)] = this.formatForBinding(triple.getPredicate());
                    }
                    if (pattern.object.startsWith('?') && !objectStr) {
                        extendedBinding[pattern.object.substring(1)] = this.formatForBinding(triple.getObject());
                    }
                    newBindings.push(extendedBinding);
                }
            }
            bindings = newBindings;
        }
        return bindings;
    }
    select(query) {
        // Check cache first
        const cacheKey = this.queryCache.createCacheKey(`SELECT:${query}`);
        const cachedResult = this.queryCache.get(cacheKey);
        if (cachedResult) {
            return Object.assign(Object.assign({}, cachedResult), { cached: true });
        }
        // Parse basic SELECT ?var WHERE { ?s ?p ?o } pattern
        const selectMatch = query.match(/SELECT\s+(.*?)\s+WHERE\s*\{(.*?)\}/is);
        if (!selectMatch) {
            throw new Error('Invalid SPARQL query format');
        }
        const variables = this.parseVariables(selectMatch[1]);
        const patterns = this.parsePatterns(selectMatch[2]);
        if (patterns.length === 0) {
            const emptyResult = { results: [], cached: false };
            this.queryCache.set(cacheKey, emptyResult);
            return emptyResult;
        }
        let results = [];
        if (patterns.length === 1) {
            // Single pattern - simple case
            const pattern = patterns[0];
            // Convert string patterns to proper types for match
            const subject = pattern.subject.startsWith('?') ? null : new Triple_1.IRI(pattern.subject.replace(/^<|>$/g, ''));
            const predicate = pattern.predicate.startsWith('?') ? null : new Triple_1.IRI(pattern.predicate.replace(/^<|>$/g, ''));
            const object = pattern.object.startsWith('?') ? null : this.parseObjectForMatching(pattern.object);
            const triples = this.graph.match(subject, predicate, object);
            // Bind variables
            for (const triple of triples) {
                const binding = {};
                if (pattern.subject.startsWith('?')) {
                    const varName = pattern.subject.substring(1);
                    if (variables.includes('*') || variables.includes(varName)) {
                        binding[varName] = this.formatForBinding(triple.getSubject());
                    }
                }
                if (pattern.predicate.startsWith('?')) {
                    const varName = pattern.predicate.substring(1);
                    if (variables.includes('*') || variables.includes(varName)) {
                        binding[varName] = this.formatForBinding(triple.getPredicate());
                    }
                }
                if (pattern.object.startsWith('?')) {
                    const varName = pattern.object.substring(1);
                    if (variables.includes('*') || variables.includes(varName)) {
                        binding[varName] = this.formatForBinding(triple.getObject());
                    }
                }
                if (Object.keys(binding).length > 0) {
                    results.push(binding);
                }
            }
        }
        else {
            // Multiple patterns - need to join bindings
            const bindings = this.executeWhereClauseForSelect(patterns);
            for (const binding of bindings) {
                const filteredBinding = {};
                // Only include requested variables
                for (const [key, value] of Object.entries(binding)) {
                    if (variables.includes('*') || variables.includes(key)) {
                        filteredBinding[key] = value;
                    }
                }
                if (Object.keys(filteredBinding).length > 0) {
                    results.push(filteredBinding);
                }
            }
        }
        // Apply LIMIT if present
        const limitMatch = query.match(/LIMIT\s+(\d+)/i);
        let result;
        if (limitMatch) {
            const limit = parseInt(limitMatch[1]);
            result = { results: results.slice(0, limit), cached: false };
        }
        else {
            result = { results, cached: false };
        }
        // Cache the result
        this.queryCache.set(cacheKey, result);
        return result;
    }
    parseVariables(selectClause) {
        const trimmed = selectClause.trim();
        if (trimmed === '*') {
            return ['*'];
        }
        const variables = [];
        const varPattern = /\?(\w+)/g;
        let match;
        while ((match = varPattern.exec(trimmed)) !== null) {
            variables.push(match[1]);
        }
        return variables;
    }
    parseObjectForMatching(objectStr) {
        if (objectStr.startsWith('"')) {
            // It's a string literal - create proper Literal for matching
            const content = objectStr.replace(/^"|"$/g, '');
            return Triple_1.Literal.string(content);
        }
        else {
            // It's an IRI
            return new Triple_1.IRI(objectStr.replace(/^<|>$/g, ''));
        }
    }
    executeWhereClauseForSelect(patterns) {
        if (patterns.length === 0)
            return [];
        // Start with first pattern
        const firstPattern = patterns[0];
        const firstTriples = this.graph.match(firstPattern.subject.startsWith('?') ? null : new Triple_1.IRI(firstPattern.subject.replace(/^<|>$/g, '')), firstPattern.predicate.startsWith('?') ? null : new Triple_1.IRI(firstPattern.predicate.replace(/^<|>$/g, '')), firstPattern.object.startsWith('?') ? null : this.parseObjectForMatching(firstPattern.object));
        let bindings = [];
        for (const triple of firstTriples) {
            bindings.push(this.createBinding(firstPattern, triple));
        }
        // Join with subsequent patterns
        for (let i = 1; i < patterns.length; i++) {
            const pattern = patterns[i];
            const newBindings = [];
            for (const binding of bindings) {
                // Resolve pattern with current binding
                const subjectStr = pattern.subject.startsWith('?')
                    ? (binding[pattern.subject.substring(1)] || null)
                    : pattern.subject;
                const predicateStr = pattern.predicate.startsWith('?')
                    ? (binding[pattern.predicate.substring(1)] || null)
                    : pattern.predicate;
                const objectStr = pattern.object.startsWith('?')
                    ? (binding[pattern.object.substring(1)] || null)
                    : pattern.object;
                // Convert strings to proper types for match
                const subject = subjectStr ? new Triple_1.IRI(subjectStr.replace(/^<|>$/g, '')) : null;
                const predicate = predicateStr ? new Triple_1.IRI(predicateStr.replace(/^<|>$/g, '')) : null;
                const object = objectStr ? this.parseObjectForMatching(objectStr) : null;
                // Find matching triples
                const matches = this.graph.match(subject, predicate, object);
                for (const triple of matches) {
                    const extendedBinding = Object.assign({}, binding);
                    // Add new variable bindings
                    if (pattern.subject.startsWith('?') && !subjectStr) {
                        extendedBinding[pattern.subject.substring(1)] = this.formatForBinding(triple.getSubject());
                    }
                    if (pattern.predicate.startsWith('?') && !predicateStr) {
                        extendedBinding[pattern.predicate.substring(1)] = this.formatForBinding(triple.getPredicate());
                    }
                    if (pattern.object.startsWith('?') && !objectStr) {
                        extendedBinding[pattern.object.substring(1)] = this.formatForBinding(triple.getObject());
                    }
                    newBindings.push(extendedBinding);
                }
            }
            bindings = newBindings;
        }
        return bindings;
    }
    parsePatterns(whereClause) {
        const patterns = [];
        // Simple triple pattern: ?s ?p ?o or with literals
        // Split by period followed by whitespace/newline, not dots inside quotes
        const lines = whereClause.trim().split(/\.\s*(?:\n|\s|$)/);
        for (const line of lines) {
            const trimmed = line.trim();
            if (!trimmed)
                continue;
            // Match triple pattern (very basic)
            const parts = trimmed.split(/\s+/);
            if (parts.length >= 3) {
                patterns.push({
                    subject: parts[0],
                    predicate: parts[1],
                    object: parts.slice(2).join(' ') // Keep quotes for proper matching
                });
            }
        }
        return patterns;
    }
    /**
     * Get cache statistics
     */
    getCacheStatistics() {
        return this.queryCache.getStatistics();
    }
    /**
     * Invalidate all cached queries
     */
    invalidateCache() {
        this.queryCache.invalidateAll();
    }
    /**
     * Update cache configuration
     */
    updateCacheConfig(config) {
        this.queryCache.updateConfig(config);
    }
    /**
     * Get current cache configuration
     */
    getCacheConfig() {
        return this.queryCache.getConfig();
    }
    /**
     * Cleanup expired cache entries
     */
    cleanupCache() {
        return this.queryCache.cleanup();
    }
    /**
     * Destroy cache and cleanup resources
     */
    destroy() {
        this.queryCache.destroy();
    }
}
exports.SPARQLEngine = SPARQLEngine;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL2tpdGVsZXYvRG9jdW1lbnRzL2V4b2NvcnRleC1vYnNpZGlhbi1wbHVnaW4vc3JjL2FwcGxpY2F0aW9uL1NQQVJRTEVuZ2luZS50cyIsIm1hcHBpbmdzIjoiOzs7QUFDQSwyREFBaUY7QUFDakYsc0RBQXFFO0FBYXJFLE1BQWEsWUFBWTtJQUdyQixZQUFvQixLQUFZLEVBQUUsV0FBdUM7UUFBckQsVUFBSyxHQUFMLEtBQUssQ0FBTztRQUM1QixJQUFJLENBQUMsVUFBVSxHQUFHLElBQUksdUJBQVUsQ0FBQyxXQUFXLENBQUMsQ0FBQztJQUNsRCxDQUFDO0lBRUQ7O09BRUc7SUFDSCxTQUFTLENBQUMsS0FBYTtRQUNuQixvQkFBb0I7UUFDcEIsTUFBTSxRQUFRLEdBQUcsSUFBSSxDQUFDLFVBQVUsQ0FBQyxjQUFjLENBQUMsYUFBYSxLQUFLLEVBQUUsQ0FBQyxDQUFDO1FBQ3RFLE1BQU0sWUFBWSxHQUFHLElBQUksQ0FBQyxVQUFVLENBQUMsR0FBRyxDQUFrQixRQUFRLENBQUMsQ0FBQztRQUVwRSxJQUFJLFlBQVksRUFBRTtZQUNkLHVDQUFZLFlBQVksS0FBRSxNQUFNLEVBQUUsSUFBSSxJQUFHO1NBQzVDO1FBQ0Qsd0JBQXdCO1FBQ3hCLE1BQU0sY0FBYyxHQUFHLEtBQUssQ0FBQyxLQUFLLENBQUMsNkNBQTZDLENBQUMsQ0FBQztRQUNsRixJQUFJLENBQUMsY0FBYyxFQUFFO1lBQ2pCLE1BQU0sSUFBSSxLQUFLLENBQUMsZ0NBQWdDLENBQUMsQ0FBQztTQUNyRDtRQUVELE1BQU0sUUFBUSxHQUFHLElBQUksQ0FBQyxzQkFBc0IsQ0FBQyxjQUFjLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUNoRSxNQUFNLFFBQVEsR0FBRyxJQUFJLENBQUMsYUFBYSxDQUFDLGNBQWMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBRXZELElBQUksUUFBUSxDQUFDLE1BQU0sS0FBSyxDQUFDLEVBQUU7WUFDdkIsT0FBTyxFQUFFLE9BQU8sRUFBRSxFQUFFLEVBQUUsVUFBVSxFQUFF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TyxFQUFFLENBQUM7SUFDOUIsQ0FBQztDQUNKO0FBbmdCRCxvQ0FtZ0JDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIi9Vc2Vycy9raXRlbGV2L0RvY3VtZW50cy9leG9jb3J0ZXgtb2JzaWRpYW4tcGx1Z2luL3NyYy9hcHBsaWNhdGlvbi9TUEFSUUxFbmdpbmUudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgR3JhcGggfSBmcm9tICcuLi9kb21haW4vc2VtYW50aWMvY29yZS9HcmFwaCc7XG5pbXBvcnQgeyBUcmlwbGUsIElSSSwgTGl0ZXJhbCwgQmxhbmtOb2RlIH0gZnJvbSAnLi4vZG9tYWluL3NlbWFudGljL2NvcmUvVHJpcGxlJztcbmltcG9ydCB7IFF1ZXJ5Q2FjaGUsIFF1ZXJ5Q2FjaGVDb25maWcgfSBmcm9tICcuL3NlcnZpY2VzL1F1ZXJ5Q2FjaGUnO1xuXG5leHBvcnQgaW50ZXJmYWNlIENvbnN0cnVjdFJlc3VsdCB7XG4gICAgdHJpcGxlczogVHJpcGxlW107XG4gICAgcHJvdmVuYW5jZTogc3RyaW5nO1xuICAgIGNhY2hlZD86IGJvb2xlYW47XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgU2VsZWN0UmVzdWx0IHtcbiAgICByZXN1bHRzOiBhbnlbXTtcbiAgICBjYWNoZWQ/OiBib29sZWFuO1xufVxuXG5leHBvcnQgY2xhc3MgU1BBUlFMRW5naW5lIHtcbiAgICBwcml2YXRlIHF1ZXJ5Q2FjaGU6IFF1ZXJ5Q2FjaGU7XG5cbiAgICBjb25zdHJ1Y3Rvcihwcml2YXRlIGdyYXBoOiBHcmFwaCwgY2FjaGVDb25maWc/OiBQYXJ0aWFsPFF1ZXJ5Q2FjaGVDb25maWc+KSB7XG4gICAgICAgIHRoaXMucXVlcnlDYWNoZSA9IG5ldyBRdWVyeUNhY2hlKGNhY2hlQ29uZmlnKTtcbiAgICB9XG4gICAgXG4gICAgLyoqXG4gICAgICogRXhlY3V0ZSBDT05TVFJVQ1QgcXVlcnkgdG8gZ2VuZXJhdGUgbmV3IHRyaXBsZXNcbiAgICAgKi9cbiAgICBjb25zdHJ1Y3QocXVlcnk6IHN0cmluZyk6IENvbnN0cnVjdFJlc3VsdCB7XG4gICAgICAgIC8vIENoZWNrIGNhY2hlIGZpcnN0XG4gICAgICAgIGNvbnN0IGNhY2hlS2V5ID0gdGhpcy5xdWVyeUNhY2hlLmNyZWF0ZUNhY2hlS2V5KGBDT05TVFJVQ1Q6JHtxdWVyeX1gKTtcbiAgICAgICAgY29uc3QgY2FjaGVkUmVzdWx0ID0gdGhpcy5xdWVyeUNhY2hlLmdldDxDb25zdHJ1Y3RSZXN1bHQ+KGNhY2hlS2V5KTtcbiAgICAgICAgXG4gICAgICAgIGlmIChjYWNoZWRSZXN1bHQpIHtcbiAgICAgICAgICAgIHJldHVybiB7IC4uLmNhY2hlZFJlc3VsdCwgY2FjaGVkOiB0cnVlIH07XG4gICAgICAgIH1cbiAgICAgICAgLy8gUGFyc2UgQ09OU1RSVUNUIHF1ZXJ5XG4gICAgICAgIGNvbnN0IGNvbnN0cnVjdE1hdGNoID0gcXVlcnkubWF0Y2goL0NPTlNUUlVDVFxccypcXHsoLio/KVxcfVxccypXSEVSRVxccypcXHsoLio/KVxcfS9pcyk7XG4gICAgICAgIGlmICghY29uc3RydWN0TWF0Y2gpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignSW52YWxpZCBDT05TVFJVQ1QgcXVlcnkgZm9ybWF0Jyk7XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIGNvbnN0IHRlbXBsYXRlID0gdGhpcy5wYXJzZUNvbnN0cnVjdFRlbXBsYXRlKGNvbnN0cnVjdE1hdGNoWzFdKTtcbiAgICAgICAgY29uc3QgcGF0dGVybnMgPSB0aGlzLnBhcnNlUGF0dGVybnMoY29uc3RydWN0TWF0Y2hbMl0pO1xuICAgICAgICBcbiAgICAgICAgaWYgKHBhdHRlcm5zLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgcmV0dXJuIHsgdHJpcGxlczogW10sIHByb3ZlbmFuY2U6IGBDT05TVFJVQ1QgcXVlcnkgYXQgJHtuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCl9YCB9O1xuICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICBjb25zdCBnZW5lcmF0ZWRUcmlwbGVzOiBUcmlwbGVbXSA9IFtdO1xuICAgICAgICBcbiAgICAgICAgLy8gSGFuZGxlIG11bHRpcGxlIHBhdHRlcm5zIGJ5IGpvaW5pbmcgcmVzdWx0c1xuICAgICAgICBpZiAocGF0dGVybnMubGVuZ3RoID09PSAxKSB7XG4gICAgICAgICAgICAvLyBTaW5nbGUgcGF0dGVybiAtIHNpbXBsZSBjYXNlXG4gICAgICAgICAgICBjb25zdCBwYXR0ZXJuID0gcGF0dGVybnNbMF07XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIC8vIENvbnZlcnQgcGF0dGVybiBzdHJpbmdzIHRvIHByb3BlciB0eXBlcywgc3RyaXBwaW5nIGFuZ2xlIGJyYWNrZXRzIGZyb20gSVJJc1xuICAgICAgICAgICAgY29uc3Qgc3ViamVjdCA9IHBhdHRlcm4uc3ViamVjdC5zdGFydHNXaXRoKCc/JykgPyBudWxsIDogXG4gICAgICAgICAgICAgICAgbmV3IElSSShwYXR0ZXJuLnN1YmplY3QucmVwbGFjZSgvXjx8PiQvZywgJycpKTtcbiAgICAgICAgICAgIGNvbnN0IHByZWRpY2F0ZSA9IHBhdHRlcm4ucHJlZGljYXRlLnN0YXJ0c1dpdGgoJz8nKSA/IG51bGwgOiBcbiAgICAgICAgICAgICAgICBuZXcgSVJJKHBhdHRlcm4ucHJlZGljYXRlLnJlcGxhY2UoL148fD4kL2csICcnKSk7XG4gICAgICAgICAgICBjb25zdCBvYmplY3QgPSBwYXR0ZXJuLm9iamVjdC5zdGFydHNXaXRoKCc/JykgPyBudWxsIDogdGhpcy5wYXJzZU9iamVjdEZvck1hdGNoaW5nKHBhdHRlcm4ub2JqZWN0KTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgY29uc3QgbWF0Y2hlZFRyaXBsZXMgPSB0aGlzLmdyYXBoLm1hdGNoKHN1YmplY3QsIHByZWRpY2F0ZSwgb2JqZWN0KTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgZm9yIChjb25zdCB0cmlwbGUgb2YgbWF0Y2hlZFRyaXBsZXMpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBiaW5kaW5nID0gdGhpcy5jcmVhdGVCaW5kaW5nKHBhdHRlcm4sIHRyaXBsZSk7XG4gICAgICAgICAgICAgICAgY29uc3QgbmV3VHJpcGxlcyA9IHRoaXMuaW5zdGFudGlhdGVUZW1wbGF0ZSh0ZW1wbGF0ZSwgYmluZGluZyk7XG4gICAgICAgICAgICAgICAgZ2VuZXJhdGVkVHJpcGxlcy5wdXNoKC4uLm5ld1RyaXBsZXMpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgLy8gTXVsdGlwbGUgcGF0dGVybnMgLSBuZWVkIHRvIGpvaW4gYmluZGluZ3NcbiAgICAgICAgICAgIGNvbnN0IGJpbmRpbmdzID0gdGhpcy5leGVjdXRlV2hlcmVDbGF1c2UocGF0dGVybnMpO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICBmb3IgKGNvbnN0IGJpbmRpbmcgb2YgYmluZGluZ3MpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBuZXdUcmlwbGVzID0gdGhpcy5pbnN0YW50aWF0ZVRlbXBsYXRlKHRlbXBsYXRlLCBiaW5kaW5nKTtcbiAgICAgICAgICAgICAgICBnZW5lcmF0ZWRUcmlwbGVzLnB1c2goLi4ubmV3VHJpcGxlcyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIC8vIEFwcGx5IExJTUlUIGlmIHByZXNlbnRcbiAgICAgICAgY29uc3QgbGltaXRNYXRjaCA9IHF1ZXJ5Lm1hdGNoKC9MSU1JVFxccysoXFxkKykvaSk7XG4gICAgICAgIGxldCByZXN1bHQ6IENvbnN0cnVjdFJlc3VsdDtcbiAgICAgICAgXG4gICAgICAgIGlmIChsaW1pdE1hdGNoKSB7XG4gICAgICAgICAgICBjb25zdCBsaW1pdCA9IHBhcnNlSW50KGxpbWl0TWF0Y2hbMV0pO1xuICAgICAgICAgICAgcmVzdWx0ID0ge1xuICAgICAgICAgICAgICAgIHRyaXBsZXM6IGdlbmVyYXRlZFRyaXBsZXMuc2xpY2UoMCwgbGltaXQpLFxuICAgICAgICAgICAgICAgIHByb3ZlbmFuY2U6IGBDT05TVFJVQ1QgcXVlcnkgYXQgJHtuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCl9YCxcbiAgICAgICAgICAgICAgICBjYWNoZWQ6IGZhbHNlXG4gICAgICAgICAgICB9O1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmVzdWx0ID0ge1xuICAgICAgICAgICAgICAgIHRyaXBsZXM6IGdlbmVyYXRlZFRyaXBsZXMsXG4gICAgICAgICAgICAgICAgcHJvdmVuYW5jZTogYENPTlNUUlVDVCBxdWVyeSBhdCAke25ldyBEYXRlKCkudG9JU09TdHJpbmcoKX1gLFxuICAgICAgICAgICAgICAgIGNhY2hlZDogZmFsc2VcbiAgICAgICAgICAgIH07XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIC8vIENhY2hlIHRoZSByZXN1bHRcbiAgICAgICAgdGhpcy5xdWVyeUNhY2hlLnNldChjYWNoZUtleSwgcmVzdWx0KTtcbiAgICAgICAgXG4gICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgfVxuICAgIFxuICAgIHByaXZhdGUgcGFyc2VDb25zdHJ1Y3RUZW1wbGF0ZSh0ZW1wbGF0ZUNsYXVzZTogc3RyaW5nKTogYW55W10ge1xuICAgICAgICBjb25zdCB0ZW1wbGF0ZXM6IGFueVtdID0gW107XG4gICAgICAgIC8vIFNwbGl0IGJ5IHBlcmlvZCBmb2xsb3dlZCBieSB3aGl0ZXNwYWNlIG9yIG5ld2xpbmUsIG5vdCBqdXN0IGFueSBwZXJpb2RcbiAgICAgICAgY29uc3QgbGluZXMgPSB0ZW1wbGF0ZUNsYXVzZS50cmltKCkuc3BsaXQoL1xcLlxccyooPzpcXG58XFxzfCQpLyk7XG4gICAgICAgIFxuICAgICAgICBmb3IgKGNvbnN0IGxpbmUgb2YgbGluZXMpIHtcbiAgICAgICAgICAgIGNvbnN0IHRyaW1tZWQgPSBsaW5lLnRyaW0oKTtcbiAgICAgICAgICAgIGlmICghdHJpbW1lZCkgY29udGludWU7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGNvbnN0IHBhcnRzID0gdHJpbW1lZC5zcGxpdCgvXFxzKy8pO1xuICAgICAgICAgICAgaWYgKHBhcnRzLmxlbmd0aCA+PSAzKSB7XG4gICAgICAgICAgICAgICAgLy8gUHJlc2VydmUgcXVvdGVzIGZvciBsaXRlcmFsc1xuICAgICAgICAgICAgICAgIGxldCBvYmplY3QgPSBwYXJ0cy5zbGljZSgyKS5qb2luKCcgJyk7XG4gICAgICAgICAgICAgICAgdGVtcGxhdGVzLnB1c2goe1xuICAgICAgICAgICAgICAgICAgICBzdWJqZWN0OiBwYXJ0c1swXSxcbiAgICAgICAgICAgICAgICAgICAgcHJlZGljYXRlOiBwYXJ0c1sxXSxcbiAgICAgICAgICAgICAgICAgICAgb2JqZWN0OiBvYmplY3RcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgcmV0dXJuIHRlbXBsYXRlcztcbiAgICB9XG4gICAgXG4gICAgcHJpdmF0ZSBjcmVhdGVCaW5kaW5nKHBhdHRlcm46IGFueSwgdHJpcGxlOiBUcmlwbGUpOiBSZWNvcmQ8c3RyaW5nLCBzdHJpbmc+IHtcbiAgICAgICAgY29uc3QgYmluZGluZzogUmVjb3JkPHN0cmluZywgc3RyaW5nPiA9IHt9O1xuICAgICAgICBcbiAgICAgICAgaWYgKHBhdHRlcm4uc3ViamVjdC5zdGFydHNXaXRoKCc/JykpIHtcbiAgICAgICAgICAgIGJpbmRpbmdbcGF0dGVybi5zdWJqZWN0LnN1YnN0cmluZygxKV0gPSB0aGlzLmZvcm1hdEZvckJpbmRpbmcodHJpcGxlLmdldFN1YmplY3QoKSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHBhdHRlcm4ucHJlZGljYXRlLnN0YXJ0c1dpdGgoJz8nKSkge1xuICAgICAgICAgICAgYmluZGluZ1twYXR0ZXJuLnByZWRpY2F0ZS5zdWJzdHJpbmcoMSldID0gdGhpcy5mb3JtYXRGb3JCaW5kaW5nKHRyaXBsZS5nZXRQcmVkaWNhdGUoKSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHBhdHRlcm4ub2JqZWN0LnN0YXJ0c1dpdGgoJz8nKSkge1xuICAgICAgICAgICAgYmluZGluZ1twYXR0ZXJuLm9iamVjdC5zdWJzdHJpbmcoMSldID0gdGhpcy5mb3JtYXRGb3JCaW5kaW5nKHRyaXBsZS5nZXRPYmplY3QoKSk7XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIHJldHVybiBiaW5kaW5nO1xuICAgIH1cbiAgICBcbiAgICBwcml2YXRlIGZvcm1hdEZvckJpbmRpbmcobm9kZTogYW55KTogc3RyaW5nIHtcbiAgICAgICAgLy8gRm9yIFNFTEVDVCBxdWVyeSByZXN1bHRzLCByZXR1cm4gdXNlci1mcmllbmRseSBzdHJpbmcgcmVwcmVzZW50YXRpb25cbiAgICAgICAgaWYgKG5vZGUuZ2V0VmFsdWUpIHtcbiAgICAgICAgICAgIC8vIEl0J3MgYSBMaXRlcmFsIC0gcmV0dXJuIGp1c3QgdGhlIHF1b3RlZCB2YWx1ZSBmb3IgdXNlci1mcmllbmRseSBkaXNwbGF5XG4gICAgICAgICAgICByZXR1cm4gYFwiJHtub2RlLmdldFZhbHVlKCl9XCJgO1xuICAgICAgICB9XG4gICAgICAgIC8vIEZvciBJUklzIGFuZCBCbGFua05vZGVzLCB1c2Ugc3RhbmRhcmQgdG9TdHJpbmdcbiAgICAgICAgcmV0dXJuIG5vZGUudG9TdHJpbmcoKTtcbiAgICB9XG4gICAgXG4gICAgcHJpdmF0ZSBpbnN0YW50aWF0ZVRlbXBsYXRlKHRlbXBsYXRlOiBhbnlbXSwgYmluZGluZzogUmVjb3JkPHN0cmluZywgc3RyaW5nPik6IFRyaXBsZVtdIHtcbiAgICAgICAgY29uc3QgdHJpcGxlczogVHJpcGxlW10gPSBbXTtcbiAgICAgICAgXG4gICAgICAgIGZvciAoY29uc3QgdCBvZiB0ZW1wbGF0ZSkge1xuICAgICAgICAgICAgY29uc3Qgc3ViamVjdFN0ciA9IHRoaXMucmVzb2x2ZVZhbHVlKHQuc3ViamVjdCwgYmluZGluZyk7XG4gICAgICAgICAgICBjb25zdCBwcmVkaWNhdGVTdHIgPSB0aGlzLnJlc29sdmVWYWx1ZSh0LnByZWRpY2F0ZSwgYmluZGluZyk7XG4gICAgICAgICAgICBjb25zdCBvYmplY3RTdHIgPSB0aGlzLnJlc29sdmVWYWx1ZSh0Lm9iamVjdCwgYmluZGluZyk7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGlmIChzdWJqZWN0U3RyICYmIHByZWRpY2F0ZVN0ciAmJiBvYmplY3RTdHIpIHtcbiAgICAgICAgICAgICAgICAvLyBDcmVhdGUgcHJvcGVyIFRyaXBsZSBvYmplY3RzXG4gICAgICAgICAgICAgICAgY29uc3Qgc3ViamVjdCA9IHN1YmplY3RTdHIuc3RhcnRzV2l0aCgnXzonKSA/IG5ldyBCbGFua05vZGUoc3ViamVjdFN0cikgOiBuZXcgSVJJKHN1YmplY3RTdHIucmVwbGFjZSgvXjx8PiQvZywgJycpKTtcbiAgICAgICAgICAgICAgICBjb25zdCBwcmVkaWNhdGUgPSBuZXcgSVJJKHByZWRpY2F0ZVN0ci5yZXBsYWNlKC9ePHw+JC9nLCAnJykpO1xuICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgIC8vIEhhbmRsZSBkaWZmZXJlbnQgb2JqZWN0IHR5cGVzXG4gICAgICAgICAgICAgICAgbGV0IG9iamVjdDogSVJJIHwgQmxhbmtOb2RlIHwgTGl0ZXJhbDtcbiAgICAgICAgICAgICAgICBpZiAob2JqZWN0U3RyLnN0YXJ0c1dpdGgoJ1wiJykpIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gSXQncyBhIHN0cmluZyBsaXRlcmFsIC0gY3JlYXRlIHR5cGVkIGxpdGVyYWwgd2l0aCBkYXRhdHlwZVxuICAgICAgICAgICAgICAgICAgICBvYmplY3QgPSBMaXRlcmFsLnN0cmluZyhvYmplY3RTdHIucmVwbGFjZSgvXlwifFwiJC9nLCAnJykpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAob2JqZWN0U3RyID09PSAndHJ1ZScgfHwgb2JqZWN0U3RyID09PSAnZmFsc2UnKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIEJvb2xlYW4gbGl0ZXJhbFxuICAgICAgICAgICAgICAgICAgICBvYmplY3QgPSBMaXRlcmFsLmJvb2xlYW4ob2JqZWN0U3RyID09PSAndHJ1ZScpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAob2JqZWN0U3RyLnN0YXJ0c1dpdGgoJ186JykpIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gQmxhbmsgbm9kZVxuICAgICAgICAgICAgICAgICAgICBvYmplY3QgPSBuZXcgQmxhbmtOb2RlKG9iamVjdFN0cik7XG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmICgvXlxcZCskLy50ZXN0KG9iamVjdFN0cikpIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gSW50ZWdlciBsaXRlcmFsXG4gICAgICAgICAgICAgICAgICAgIG9iamVjdCA9IExpdGVyYWwuaW50ZWdlcihwYXJzZUludChvYmplY3RTdHIpKTtcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKC9eXFxkK1xcLlxcZCskLy50ZXN0KG9iamVjdFN0cikpIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gRG91YmxlIGxpdGVyYWxcbiAgICAgICAgICAgICAgICAgICAgb2JqZWN0ID0gTGl0ZXJhbC5kb3VibGUocGFyc2VGbG9hdChvYmplY3RTdHIpKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAvLyBJUklcbiAgICAgICAgICAgICAgICAgICAgb2JqZWN0ID0gbmV3IElSSShvYmplY3RTdHIucmVwbGFjZSgvXjx8PiQvZywgJycpKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgdHJpcGxlcy5wdXNoKG5ldyBUcmlwbGUoc3ViamVjdCwgcHJlZGljYXRlLCBvYmplY3QpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgcmV0dXJuIHRyaXBsZXM7XG4gICAgfVxuICAgIFxuICAgIHByaXZhdGUgcmVzb2x2ZVZhbHVlKHZhbHVlOiBzdHJpbmcsIGJpbmRpbmc6IFJlY29yZDxzdHJpbmcsIHN0cmluZz4pOiBzdHJpbmcgfCBudWxsIHtcbiAgICAgICAgaWYgKHZhbHVlLnN0YXJ0c1dpdGgoJz8nKSkge1xuICAgICAgICAgICAgY29uc3QgdmFyTmFtZSA9IHZhbHVlLnN1YnN0cmluZygxKTtcbiAgICAgICAgICAgIHJldHVybiBiaW5kaW5nW3Zhck5hbWVdIHx8IG51bGw7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHZhbHVlO1xuICAgIH1cbiAgICBcbiAgICBwcml2YXRlIGV4ZWN1dGVXaGVyZUNsYXVzZShwYXR0ZXJuczogYW55W10pOiBSZWNvcmQ8c3RyaW5nLCBzdHJpbmc+W10ge1xuICAgICAgICBpZiAocGF0dGVybnMubGVuZ3RoID09PSAwKSByZXR1cm4gW107XG4gICAgICAgIFxuICAgICAgICAvLyBTdGFydCB3aXRoIGZpcnN0IHBhdHRlcm5cbiAgICAgICAgY29uc3QgZmlyc3RQYXR0ZXJuID0gcGF0dGVybnNbMF07XG4gICAgICAgIGNvbnN0IGZpcnN0VHJpcGxlcyA9IHRoaXMuZ3JhcGgubWF0Y2goXG4gICAgICAgICAgICBmaXJzdFBhdHRlcm4uc3ViamVjdC5zdGFydHNXaXRoKCc/JykgPyBudWxsIDogbmV3IElSSShmaXJzdFBhdHRlcm4uc3ViamVjdC5yZXBsYWNlKC9ePHw+JC9nLCAnJykpLFxuICAgICAgICAgICAgZmlyc3RQYXR0ZXJuLnByZWRpY2F0ZS5zdGFydHNXaXRoKCc/JykgPyBudWxsIDogbmV3IElSSShmaXJzdFBhdHRlcm4ucHJlZGljYXRlLnJlcGxhY2UoL148fD4kL2csICcnKSksXG4gICAgICAgICAgICBmaXJzdFBhdHRlcm4ub2JqZWN0LnN0YXJ0c1dpdGgoJz8nKSA/IG51bGwgOiBcbiAgICAgICAgICAgICAgICAoZmlyc3RQYXR0ZXJuLm9iamVjdC5zdGFydHNXaXRoKCdcIicpID8gXG4gICAgICAgICAgICAgICAgICAgIG5ldyBMaXRlcmFsKGZpcnN0UGF0dGVybi5vYmplY3QucmVwbGFjZSgvXlwifFwiJC9nLCAnJykpIDogXG4gICAgICAgICAgICAgICAgICAgIG5ldyBJUkkoZmlyc3RQYXR0ZXJuLm9iamVjdC5yZXBsYWNlKC9ePHw+JC9nLCAnJykpKVxuICAgICAgICApO1xuICAgICAgICBcbiAgICAgICAgbGV0IGJpbmRpbmdzOiBSZWNvcmQ8c3RyaW5nLCBzdHJpbmc+W10gPSBbXTtcbiAgICAgICAgZm9yIChjb25zdCB0cmlwbGUgb2YgZmlyc3RUcmlwbGVzKSB7XG4gICAgICAgICAgICBiaW5kaW5ncy5wdXNoKHRoaXMuY3JlYXRlQmluZGluZyhmaXJzdFBhdHRlcm4sIHRyaXBsZSkpO1xuICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICAvLyBKb2luIHdpdGggc3Vic2VxdWVudCBwYXR0ZXJuc1xuICAgICAgICBmb3IgKGxldCBpID0gMTsgaSA8IHBhdHRlcm5zLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICBjb25zdCBwYXR0ZXJuID0gcGF0dGVybnNbaV07XG4gICAgICAgICAgICBjb25zdCBuZXdCaW5kaW5nczogUmVjb3JkPHN0cmluZywgc3RyaW5nPltdID0gW107XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGZvciAoY29uc3QgYmluZGluZyBvZiBiaW5kaW5ncykge1xuICAgICAgICAgICAgICAgIC8vIFJlc29sdmUgcGF0dGVybiB3aXRoIGN1cnJlbnQgYmluZGluZ1xuICAgICAgICAgICAgICAgIGNvbnN0IHN1YmplY3RTdHIgPSBwYXR0ZXJuLnN1YmplY3Quc3RhcnRzV2l0aCgnPycpIFxuICAgICAgICAgICAgICAgICAgICA/IChiaW5kaW5nW3BhdHRlcm4uc3ViamVjdC5zdWJzdHJpbmcoMSldIHx8IG51bGwpXG4gICAgICAgICAgICAgICAgICAgIDogcGF0dGVybi5zdWJqZWN0O1xuICAgICAgICAgICAgICAgIGNvbnN0IHByZWRpY2F0ZVN0ciA9IHBhdHRlcm4ucHJlZGljYXRlLnN0YXJ0c1dpdGgoJz8nKVxuICAgICAgICAgICAgICAgICAgICA/IChiaW5kaW5nW3BhdHRlcm4ucHJlZGljYXRlLnN1YnN0cmluZygxKV0gfHwgbnVsbClcbiAgICAgICAgICAgICAgICAgICAgOiBwYXR0ZXJuLnByZWRpY2F0ZTtcbiAgICAgICAgICAgICAgICBjb25zdCBvYmplY3RTdHIgPSBwYXR0ZXJuLm9iamVjdC5zdGFydHNXaXRoKCc/JylcbiAgICAgICAgICAgICAgICAgICAgPyAoYmluZGluZ1twYXR0ZXJuLm9iamVjdC5zdWJzdHJpbmcoMSldIHx8IG51bGwpXG4gICAgICAgICAgICAgICAgICAgIDogcGF0dGVybi5vYmplY3Q7XG4gICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgLy8gQ29udmVydCBzdHJpbmdzIHRvIHByb3BlciB0eXBlcyBmb3IgbWF0Y2hcbiAgICAgICAgICAgICAgICBjb25zdCBzdWJqZWN0ID0gc3ViamVjdFN0ciA/IG5ldyBJUkkoc3ViamVjdFN0ci5yZXBsYWNlKC9ePHw+JC9nLCAnJykpIDogbnVsbDtcbiAgICAgICAgICAgICAgICBjb25zdCBwcmVkaWNhdGUgPSBwcmVkaWNhdGVTdHIgPyBuZXcgSVJJKHByZWRpY2F0ZVN0ci5yZXBsYWNlKC9ePHw+JC9nLCAnJykpIDogbnVsbDtcbiAgICAgICAgICAgICAgICBjb25zdCBvYmplY3QgPSBvYmplY3RTdHIgPyB0aGlzLnBhcnNlT2JqZWN0Rm9yTWF0Y2hpbmcob2JqZWN0U3RyKSA6IG51bGw7XG4gICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgLy8gRmluZCBtYXRjaGluZyB0cmlwbGVzXG4gICAgICAgICAgICAgICAgY29uc3QgbWF0Y2hlcyA9IHRoaXMuZ3JhcGgubWF0Y2goc3ViamVjdCwgcHJlZGljYXRlLCBvYmplY3QpO1xuICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgIGZvciAoY29uc3QgdHJpcGxlIG9mIG1hdGNoZXMpIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgZXh0ZW5kZWRCaW5kaW5nID0geyAuLi5iaW5kaW5nIH07XG4gICAgICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgICAgICAvLyBBZGQgbmV3IHZhcmlhYmxlIGJpbmRpbmdzXG4gICAgICAgICAgICAgICAgICAgIGlmIChwYXR0ZXJuLnN1YmplY3Quc3RhcnRzV2l0aCgnPycpICYmICFzdWJqZWN0U3RyKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBleHRlbmRlZEJpbmRpbmdbcGF0dGVybi5zdWJqZWN0LnN1YnN0cmluZygxKV0gPSB0aGlzLmZvcm1hdEZvckJpbmRpbmcodHJpcGxlLmdldFN1YmplY3QoKSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgaWYgKHBhdHRlcm4ucHJlZGljYXRlLnN0YXJ0c1dpdGgoJz8nKSAmJiAhcHJlZGljYXRlU3RyKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBleHRlbmRlZEJpbmRpbmdbcGF0dGVybi5wcmVkaWNhdGUuc3Vic3RyaW5nKDEpXSA9IHRoaXMuZm9ybWF0Rm9yQmluZGluZyh0cmlwbGUuZ2V0UHJlZGljYXRlKCkpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGlmIChwYXR0ZXJuLm9iamVjdC5zdGFydHNXaXRoKCc/JykgJiYgIW9iamVjdFN0cikge1xuICAgICAgICAgICAgICAgICAgICAgICAgZXh0ZW5kZWRCaW5kaW5nW3BhdHRlcm4ub2JqZWN0LnN1YnN0cmluZygxKV0gPSB0aGlzLmZvcm1hdEZvckJpbmRpbmcodHJpcGxlLmdldE9iamVjdCgpKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAgICAgbmV3QmluZGluZ3MucHVzaChleHRlbmRlZEJpbmRpbmcpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIFxuICAgICAgICAgICAgYmluZGluZ3MgPSBuZXdCaW5kaW5ncztcbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgcmV0dXJuIGJpbmRpbmdzO1xuICAgIH1cbiAgICBcbiAgICBzZWxlY3QocXVlcnk6IHN0cmluZyk6IFNlbGVjdFJlc3VsdCB7XG4gICAgICAgIC8vIENoZWNrIGNhY2hlIGZpcnN0XG4gICAgICAgIGNvbnN0IGNhY2hlS2V5ID0gdGhpcy5xdWVyeUNhY2hlLmNyZWF0ZUNhY2hlS2V5KGBTRUxFQ1Q6JHtxdWVyeX1gKTtcbiAgICAgICAgY29uc3QgY2FjaGVkUmVzdWx0ID0gdGhpcy5xdWVyeUNhY2hlLmdldDxTZWxlY3RSZXN1bHQ+KGNhY2hlS2V5KTtcbiAgICAgICAgXG4gICAgICAgIGlmIChjYWNoZWRSZXN1bHQpIHtcbiAgICAgICAgICAgIHJldHVybiB7IC4uLmNhY2hlZFJlc3VsdCwgY2FjaGVkOiB0cnVlIH07XG4gICAgICAgIH1cblxuICAgICAgICAvLyBQYXJzZSBiYXNpYyBTRUxFQ1QgP3ZhciBXSEVSRSB7ID9zID9wID9vIH0gcGF0dGVyblxuICAgICAgICBjb25zdCBzZWxlY3RNYXRjaCA9IHF1ZXJ5Lm1hdGNoKC9TRUxFQ1RcXHMrKC4qPylcXHMrV0hFUkVcXHMqXFx7KC4qPylcXH0vaXMpO1xuICAgICAgICBpZiAoIXNlbGVjdE1hdGNoKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0ludmFsaWQgU1BBUlFMIHF1ZXJ5IGZvcm1hdCcpO1xuICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICBjb25zdCB2YXJpYWJsZXMgPSB0aGlzLnBhcnNlVmFyaWFibGVzKHNlbGVjdE1hdGNoWzFdKTtcbiAgICAgICAgY29uc3QgcGF0dGVybnMgPSB0aGlzLnBhcnNlUGF0dGVybnMoc2VsZWN0TWF0Y2hbMl0pO1xuICAgICAgICBcbiAgICAgICAgaWYgKHBhdHRlcm5zLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgY29uc3QgZW1wdHlSZXN1bHQ6IFNlbGVjdFJlc3VsdCA9IHsgcmVzdWx0czogW10sIGNhY2hlZDogZmFsc2UgfTtcbiAgICAgICAgICAgIHRoaXMucXVlcnlDYWNoZS5zZXQoY2FjaGVLZXksIGVtcHR5UmVzdWx0KTtcbiAgICAgICAgICAgIHJldHVybiBlbXB0eVJlc3VsdDtcbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgbGV0IHJlc3VsdHM6IGFueVtdID0gW107XG4gICAgICAgIFxuICAgICAgICBpZiAocGF0dGVybnMubGVuZ3RoID09PSAxKSB7XG4gICAgICAgICAgICAvLyBTaW5nbGUgcGF0dGVybiAtIHNpbXBsZSBjYXNlXG4gICAgICAgICAgICBjb25zdCBwYXR0ZXJuID0gcGF0dGVybnNbMF07XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIC8vIENvbnZlcnQgc3RyaW5nIHBhdHRlcm5zIHRvIHByb3BlciB0eXBlcyBmb3IgbWF0Y2hcbiAgICAgICAgICAgIGNvbnN0IHN1YmplY3QgPSBwYXR0ZXJuLnN1YmplY3Quc3RhcnRzV2l0aCgnPycpID8gbnVsbCA6IG5ldyBJUkkocGF0dGVybi5zdWJqZWN0LnJlcGxhY2UoL148fD4kL2csICcnKSk7XG4gICAgICAgICAgICBjb25zdCBwcmVkaWNhdGUgPSBwYXR0ZXJuLnByZWRpY2F0ZS5zdGFydHNXaXRoKCc/JykgPyBudWxsIDogbmV3IElSSShwYXR0ZXJuLnByZWRpY2F0ZS5yZXBsYWNlKC9ePHw+JC9nLCAnJykpO1xuICAgICAgICAgICAgY29uc3Qgb2JqZWN0ID0gcGF0dGVybi5vYmplY3Quc3RhcnRzV2l0aCgnPycpID8gbnVsbCA6IHRoaXMucGFyc2VPYmplY3RGb3JNYXRjaGluZyhwYXR0ZXJuLm9iamVjdCk7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGNvbnN0IHRyaXBsZXMgPSB0aGlzLmdyYXBoLm1hdGNoKHN1YmplY3QsIHByZWRpY2F0ZSwgb2JqZWN0KTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgLy8gQmluZCB2YXJpYWJsZXNcbiAgICAgICAgICAgIGZvciAoY29uc3QgdHJpcGxlIG9mIHRyaXBsZXMpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBiaW5kaW5nOiBhbnkgPSB7fTtcbiAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICBpZiAocGF0dGVybi5zdWJqZWN0LnN0YXJ0c1dpdGgoJz8nKSkge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCB2YXJOYW1lID0gcGF0dGVybi5zdWJqZWN0LnN1YnN0cmluZygxKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHZhcmlhYmxlcy5pbmNsdWRlcygnKicpIHx8IHZhcmlhYmxlcy5pbmNsdWRlcyh2YXJOYW1lKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgYmluZGluZ1t2YXJOYW1lXSA9IHRoaXMuZm9ybWF0Rm9yQmluZGluZyh0cmlwbGUuZ2V0U3ViamVjdCgpKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICBpZiAocGF0dGVybi5wcmVkaWNhdGUuc3RhcnRzV2l0aCgnPycpKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHZhck5hbWUgPSBwYXR0ZXJuLnByZWRpY2F0ZS5zdWJzdHJpbmcoMSk7XG4gICAgICAgICAgICAgICAgICAgIGlmICh2YXJpYWJsZXMuaW5jbHVkZXMoJyonKSB8fCB2YXJpYWJsZXMuaW5jbHVkZXModmFyTmFtZSkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJpbmRpbmdbdmFyTmFtZV0gPSB0aGlzLmZvcm1hdEZvckJpbmRpbmcodHJpcGxlLmdldFByZWRpY2F0ZSgpKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICBpZiAocGF0dGVybi5vYmplY3Quc3RhcnRzV2l0aCgnPycpKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHZhck5hbWUgPSBwYXR0ZXJuLm9iamVjdC5zdWJzdHJpbmcoMSk7XG4gICAgICAgICAgICAgICAgICAgIGlmICh2YXJpYWJsZXMuaW5jbHVkZXMoJyonKSB8fCB2YXJpYWJsZXMuaW5jbHVkZXModmFyTmFtZSkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJpbmRpbmdbdmFyTmFtZV0gPSB0aGlzLmZvcm1hdEZvckJpbmRpbmcodHJpcGxlLmdldE9iamVjdCgpKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICBpZiAoT2JqZWN0LmtleXMoYmluZGluZykubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgICAgICByZXN1bHRzLnB1c2goYmluZGluZyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgLy8gTXVsdGlwbGUgcGF0dGVybnMgLSBuZWVkIHRvIGpvaW4gYmluZGluZ3NcbiAgICAgICAgICAgIGNvbnN0IGJpbmRpbmdzID0gdGhpcy5leGVjdXRlV2hlcmVDbGF1c2VGb3JTZWxlY3QocGF0dGVybnMpO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICBmb3IgKGNvbnN0IGJpbmRpbmcgb2YgYmluZGluZ3MpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBmaWx0ZXJlZEJpbmRpbmc6IGFueSA9IHt9O1xuICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgIC8vIE9ubHkgaW5jbHVkZSByZXF1ZXN0ZWQgdmFyaWFibGVzXG4gICAgICAgICAgICAgICAgZm9yIChjb25zdCBba2V5LCB2YWx1ZV0gb2YgT2JqZWN0LmVudHJpZXMoYmluZGluZykpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHZhcmlhYmxlcy5pbmNsdWRlcygnKicpIHx8IHZhcmlhYmxlcy5pbmNsdWRlcyhrZXkpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBmaWx0ZXJlZEJpbmRpbmdba2V5XSA9IHZhbHVlO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgIGlmIChPYmplY3Qua2V5cyhmaWx0ZXJlZEJpbmRpbmcpLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgcmVzdWx0cy5wdXNoKGZpbHRlcmVkQmluZGluZyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICAvLyBBcHBseSBMSU1JVCBpZiBwcmVzZW50XG4gICAgICAgIGNvbnN0IGxpbWl0TWF0Y2ggPSBxdWVyeS5tYXRjaCgvTElNSVRcXHMrKFxcZCspL2kpO1xuICAgICAgICBsZXQgcmVzdWx0OiBTZWxlY3RSZXN1bHQ7XG4gICAgICAgIFxuICAgICAgICBpZiAobGltaXRNYXRjaCkge1xuICAgICAgICAgICAgY29uc3QgbGltaXQgPSBwYXJzZUludChsaW1pdE1hdGNoWzFdKTtcbiAgICAgICAgICAgIHJlc3VsdCA9IHsgcmVzdWx0czogcmVzdWx0cy5zbGljZSgwLCBsaW1pdCksIGNhY2hlZDogZmFsc2UgfTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJlc3VsdCA9IHsgcmVzdWx0cywgY2FjaGVkOiBmYWxzZSB9O1xuICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICAvLyBDYWNoZSB0aGUgcmVzdWx0XG4gICAgICAgIHRoaXMucXVlcnlDYWNoZS5zZXQoY2FjaGVLZXksIHJlc3VsdCk7XG4gICAgICAgIFxuICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgIH1cbiAgICBcbiAgICBwcml2YXRlIHBhcnNlVmFyaWFibGVzKHNlbGVjdENsYXVzZTogc3RyaW5nKTogc3RyaW5nW10ge1xuICAgICAgICBjb25zdCB0cmltbWVkID0gc2VsZWN0Q2xhdXNlLnRyaW0oKTtcbiAgICAgICAgaWYgKHRyaW1tZWQgPT09ICcqJykge1xuICAgICAgICAgICAgcmV0dXJuIFsnKiddO1xuICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICBjb25zdCB2YXJpYWJsZXM6IHN0cmluZ1tdID0gW107XG4gICAgICAgIGNvbnN0IHZhclBhdHRlcm4gPSAvXFw/KFxcdyspL2c7XG4gICAgICAgIGxldCBtYXRjaDtcbiAgICAgICAgd2hpbGUgKChtYXRjaCA9IHZhclBhdHRlcm4uZXhlYyh0cmltbWVkKSkgIT09IG51bGwpIHtcbiAgICAgICAgICAgIHZhcmlhYmxlcy5wdXNoKG1hdGNoWzFdKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdmFyaWFibGVzO1xuICAgIH1cbiAgICBcbiAgICBwcml2YXRlIHBhcnNlT2JqZWN0Rm9yTWF0Y2hpbmcob2JqZWN0U3RyOiBzdHJpbmcpOiBJUkkgfCBMaXRlcmFsIHwgbnVsbCB7XG4gICAgICAgIGlmIChvYmplY3RTdHIuc3RhcnRzV2l0aCgnXCInKSkge1xuICAgICAgICAgICAgLy8gSXQncyBhIHN0cmluZyBsaXRlcmFsIC0gY3JlYXRlIHByb3BlciBMaXRlcmFsIGZvciBtYXRjaGluZ1xuICAgICAgICAgICAgY29uc3QgY29udGVudCA9IG9iamVjdFN0ci5yZXBsYWNlKC9eXCJ8XCIkL2csICcnKTtcbiAgICAgICAgICAgIHJldHVybiBMaXRlcmFsLnN0cmluZyhjb250ZW50KTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIC8vIEl0J3MgYW4gSVJJXG4gICAgICAgICAgICByZXR1cm4gbmV3IElSSShvYmplY3RTdHIucmVwbGFjZSgvXjx8PiQvZywgJycpKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBcbiAgICBwcml2YXRlIGV4ZWN1dGVXaGVyZUNsYXVzZUZvclNlbGVjdChwYXR0ZXJuczogYW55W10pOiBSZWNvcmQ8c3RyaW5nLCBzdHJpbmc+W10ge1xuICAgICAgICBpZiAocGF0dGVybnMubGVuZ3RoID09PSAwKSByZXR1cm4gW107XG4gICAgICAgIFxuICAgICAgICAvLyBTdGFydCB3aXRoIGZpcnN0IHBhdHRlcm5cbiAgICAgICAgY29uc3QgZmlyc3RQYXR0ZXJuID0gcGF0dGVybnNbMF07XG4gICAgICAgIGNvbnN0IGZpcnN0VHJpcGxlcyA9IHRoaXMuZ3JhcGgubWF0Y2goXG4gICAgICAgICAgICBmaXJzdFBhdHRlcm4uc3ViamVjdC5zdGFydHNXaXRoKCc/JykgPyBudWxsIDogbmV3IElSSShmaXJzdFBhdHRlcm4uc3ViamVjdC5yZXBsYWNlKC9ePHw+JC9nLCAnJykpLFxuICAgICAgICAgICAgZmlyc3RQYXR0ZXJuLnByZWRpY2F0ZS5zdGFydHNXaXRoKCc/JykgPyBudWxsIDogbmV3IElSSShmaXJzdFBhdHRlcm4ucHJlZGljYXRlLnJlcGxhY2UoL148fD4kL2csICcnKSksXG4gICAgICAgICAgICBmaXJzdFBhdHRlcm4ub2JqZWN0LnN0YXJ0c1dpdGgoJz8nKSA/IG51bGwgOiB0aGlzLnBhcnNlT2JqZWN0Rm9yTWF0Y2hpbmcoZmlyc3RQYXR0ZXJuLm9iamVjdClcbiAgICAgICAgKTtcbiAgICAgICAgXG4gICAgICAgIGxldCBiaW5kaW5nczogUmVjb3JkPHN0cmluZywgc3RyaW5nPltdID0gW107XG4gICAgICAgIGZvciAoY29uc3QgdHJpcGxlIG9mIGZpcnN0VHJpcGxlcykge1xuICAgICAgICAgICAgYmluZGluZ3MucHVzaCh0aGlzLmNyZWF0ZUJpbmRpbmcoZmlyc3RQYXR0ZXJuLCB0cmlwbGUpKTtcbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgLy8gSm9pbiB3aXRoIHN1YnNlcXVlbnQgcGF0dGVybnNcbiAgICAgICAgZm9yIChsZXQgaSA9IDE7IGkgPCBwYXR0ZXJucy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgY29uc3QgcGF0dGVybiA9IHBhdHRlcm5zW2ldO1xuICAgICAgICAgICAgY29uc3QgbmV3QmluZGluZ3M6IFJlY29yZDxzdHJpbmcsIHN0cmluZz5bXSA9IFtdO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICBmb3IgKGNvbnN0IGJpbmRpbmcgb2YgYmluZGluZ3MpIHtcbiAgICAgICAgICAgICAgICAvLyBSZXNvbHZlIHBhdHRlcm4gd2l0aCBjdXJyZW50IGJpbmRpbmdcbiAgICAgICAgICAgICAgICBjb25zdCBzdWJqZWN0U3RyID0gcGF0dGVybi5zdWJqZWN0LnN0YXJ0c1dpdGgoJz8nKSBcbiAgICAgICAgICAgICAgICAgICAgPyAoYmluZGluZ1twYXR0ZXJuLnN1YmplY3Quc3Vic3RyaW5nKDEpXSB8fCBudWxsKVxuICAgICAgICAgICAgICAgICAgICA6IHBhdHRlcm4uc3ViamVjdDtcbiAgICAgICAgICAgICAgICBjb25zdCBwcmVkaWNhdGVTdHIgPSBwYXR0ZXJuLnByZWRpY2F0ZS5zdGFydHNXaXRoKCc/JylcbiAgICAgICAgICAgICAgICAgICAgPyAoYmluZGluZ1twYXR0ZXJuLnByZWRpY2F0ZS5zdWJzdHJpbmcoMSldIHx8IG51bGwpXG4gICAgICAgICAgICAgICAgICAgIDogcGF0dGVybi5wcmVkaWNhdGU7XG4gICAgICAgICAgICAgICAgY29uc3Qgb2JqZWN0U3RyID0gcGF0dGVybi5vYmplY3Quc3RhcnRzV2l0aCgnPycpXG4gICAgICAgICAgICAgICAgICAgID8gKGJpbmRpbmdbcGF0dGVybi5vYmplY3Quc3Vic3RyaW5nKDEpXSB8fCBudWxsKVxuICAgICAgICAgICAgICAgICAgICA6IHBhdHRlcm4ub2JqZWN0O1xuICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgIC8vIENvbnZlcnQgc3RyaW5ncyB0byBwcm9wZXIgdHlwZXMgZm9yIG1hdGNoXG4gICAgICAgICAgICAgICAgY29uc3Qgc3ViamVjdCA9IHN1YmplY3RTdHIgPyBuZXcgSVJJKHN1YmplY3RTdHIucmVwbGFjZSgvXjx8PiQvZywgJycpKSA6IG51bGw7XG4gICAgICAgICAgICAgICAgY29uc3QgcHJlZGljYXRlID0gcHJlZGljYXRlU3RyID8gbmV3IElSSShwcmVkaWNhdGVTdHIucmVwbGFjZSgvXjx8PiQvZywgJycpKSA6IG51bGw7XG4gICAgICAgICAgICAgICAgY29uc3Qgb2JqZWN0ID0gb2JqZWN0U3RyID8gdGhpcy5wYXJzZU9iamVjdEZvck1hdGNoaW5nKG9iamVjdFN0cikgOiBudWxsO1xuICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgIC8vIEZpbmQgbWF0Y2hpbmcgdHJpcGxlc1xuICAgICAgICAgICAgICAgIGNvbnN0IG1hdGNoZXMgPSB0aGlzLmdyYXBoLm1hdGNoKHN1YmplY3QsIHByZWRpY2F0ZSwgb2JqZWN0KTtcbiAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IHRyaXBsZSBvZiBtYXRjaGVzKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGV4dGVuZGVkQmluZGluZyA9IHsgLi4uYmluZGluZyB9O1xuICAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAgICAgLy8gQWRkIG5ldyB2YXJpYWJsZSBiaW5kaW5nc1xuICAgICAgICAgICAgICAgICAgICBpZiAocGF0dGVybi5zdWJqZWN0LnN0YXJ0c1dpdGgoJz8nKSAmJiAhc3ViamVjdFN0cikge1xuICAgICAgICAgICAgICAgICAgICAgICAgZXh0ZW5kZWRCaW5kaW5nW3BhdHRlcm4uc3ViamVjdC5zdWJzdHJpbmcoMSldID0gdGhpcy5mb3JtYXRGb3JCaW5kaW5nKHRyaXBsZS5nZXRTdWJqZWN0KCkpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGlmIChwYXR0ZXJuLnByZWRpY2F0ZS5zdGFydHNXaXRoKCc/JykgJiYgIXByZWRpY2F0ZVN0cikge1xuICAgICAgICAgICAgICAgICAgICAgICAgZXh0ZW5kZWRCaW5kaW5nW3BhdHRlcm4ucHJlZGljYXRlLnN1YnN0cmluZygxKV0gPSB0aGlzLmZvcm1hdEZvckJpbmRpbmcodHJpcGxlLmdldFByZWRpY2F0ZSgpKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBpZiAocGF0dGVybi5vYmplY3Quc3RhcnRzV2l0aCgnPycpICYmICFvYmplY3RTdHIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGV4dGVuZGVkQmluZGluZ1twYXR0ZXJuLm9iamVjdC5zdWJzdHJpbmcoMSldID0gdGhpcy5mb3JtYXRGb3JCaW5kaW5nKHRyaXBsZS5nZXRPYmplY3QoKSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgICAgIG5ld0JpbmRpbmdzLnB1c2goZXh0ZW5kZWRCaW5kaW5nKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGJpbmRpbmdzID0gbmV3QmluZGluZ3M7XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIHJldHVybiBiaW5kaW5ncztcbiAgICB9XG4gICAgXG4gICAgcHJpdmF0ZSBwYXJzZVBhdHRlcm5zKHdoZXJlQ2xhdXNlOiBzdHJpbmcpOiBhbnlbXSB7XG4gICAgICAgIGNvbnN0IHBhdHRlcm5zOiBhbnlbXSA9IFtdO1xuICAgICAgICBcbiAgICAgICAgLy8gU2ltcGxlIHRyaXBsZSBwYXR0ZXJuOiA/cyA/cCA/byBvciB3aXRoIGxpdGVyYWxzXG4gICAgICAgIC8vIFNwbGl0IGJ5IHBlcmlvZCBmb2xsb3dlZCBieSB3aGl0ZXNwYWNlL25ld2xpbmUsIG5vdCBkb3RzIGluc2lkZSBxdW90ZXNcbiAgICAgICAgY29uc3QgbGluZXMgPSB3aGVyZUNsYXVzZS50cmltKCkuc3BsaXQoL1xcLlxccyooPzpcXG58XFxzfCQpLyk7XG4gICAgICAgIFxuICAgICAgICBmb3IgKGNvbnN0IGxpbmUgb2YgbGluZXMpIHtcbiAgICAgICAgICAgIGNvbnN0IHRyaW1tZWQgPSBsaW5lLnRyaW0oKTtcbiAgICAgICAgICAgIGlmICghdHJpbW1lZCkgY29udGludWU7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIC8vIE1hdGNoIHRyaXBsZSBwYXR0ZXJuICh2ZXJ5IGJhc2ljKVxuICAgICAgICAgICAgY29uc3QgcGFydHMgPSB0cmltbWVkLnNwbGl0KC9cXHMrLyk7XG4gICAgICAgICAgICBpZiAocGFydHMubGVuZ3RoID49IDMpIHtcbiAgICAgICAgICAgICAgICBwYXR0ZXJucy5wdXNoKHtcbiAgICAgICAgICAgICAgICAgICAgc3ViamVjdDogcGFydHNbMF0sXG4gICAgICAgICAgICAgICAgICAgIHByZWRpY2F0ZTogcGFydHNbMV0sXG4gICAgICAgICAgICAgICAgICAgIG9iamVjdDogcGFydHMuc2xpY2UoMikuam9pbignICcpICAvLyBLZWVwIHF1b3RlcyBmb3IgcHJvcGVyIG1hdGNoaW5nXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIHJldHVybiBwYXR0ZXJucztcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBHZXQgY2FjaGUgc3RhdGlzdGljc1xuICAgICAqL1xuICAgIGdldENhY2hlU3RhdGlzdGljcygpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMucXVlcnlDYWNoZS5nZXRTdGF0aXN0aWNzKCk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogSW52YWxpZGF0ZSBhbGwgY2FjaGVkIHF1ZXJpZXNcbiAgICAgKi9cbiAgICBpbnZhbGlkYXRlQ2FjaGUoKTogdm9pZCB7XG4gICAgICAgIHRoaXMucXVlcnlDYWNoZS5pbnZhbGlkYXRlQWxsKCk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogVXBkYXRlIGNhY2hlIGNvbmZpZ3VyYXRpb25cbiAgICAgKi9cbiAgICB1cGRhdGVDYWNoZUNvbmZpZyhjb25maWc6IFBhcnRpYWw8UXVlcnlDYWNoZUNvbmZpZz4pOiB2b2lkIHtcbiAgICAgICAgdGhpcy5xdWVyeUNhY2hlLnVwZGF0ZUNvbmZpZyhjb25maWcpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEdldCBjdXJyZW50IGNhY2hlIGNvbmZpZ3VyYXRpb25cbiAgICAgKi9cbiAgICBnZXRDYWNoZUNvbmZpZygpOiBRdWVyeUNhY2hlQ29uZmlnIHtcbiAgICAgICAgcmV0dXJuIHRoaXMucXVlcnlDYWNoZS5nZXRDb25maWcoKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBDbGVhbnVwIGV4cGlyZWQgY2FjaGUgZW50cmllc1xuICAgICAqL1xuICAgIGNsZWFudXBDYWNoZSgpOiBudW1iZXIge1xuICAgICAgICByZXR1cm4gdGhpcy5xdWVyeUNhY2hlLmNsZWFudXAoKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBEZXN0cm95IGNhY2hlIGFuZCBjbGVhbnVwIHJlc291cmNlc1xuICAgICAqL1xuICAgIGRlc3Ryb3koKTogdm9pZCB7XG4gICAgICAgIHRoaXMucXVlcnlDYWNoZS5kZXN0cm95KCk7XG4gICAgfVxufVxuIl0sInZlcnNpb24iOjN9