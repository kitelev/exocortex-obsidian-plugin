44ae500baff3bc6c15b3709c025d9403
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.VisualQueryEdge = exports.EdgeType = void 0;
var EdgeType;
(function (EdgeType) {
    EdgeType["PROPERTY"] = "property";
    EdgeType["OPTIONAL"] = "optional";
    EdgeType["UNION"] = "union";
    EdgeType["FILTER_CONDITION"] = "filter_condition";
})(EdgeType = exports.EdgeType || (exports.EdgeType = {}));
class VisualQueryEdge {
    constructor(params) {
        this.selected = false;
        this.valid = true;
        this.errors = [];
        this.id = params.id;
        this.sourceNodeId = params.sourceNodeId;
        this.targetNodeId = params.targetNodeId;
        this.type = params.type;
        this.label = params.label;
        this.propertyUri = params.propertyUri;
        Object.freeze(this.id);
        Object.freeze(this.sourceNodeId);
        Object.freeze(this.targetNodeId);
        Object.freeze(this.type);
    }
    getId() {
        return this.id;
    }
    getSourceNodeId() {
        return this.sourceNodeId;
    }
    getTargetNodeId() {
        return this.targetNodeId;
    }
    getType() {
        return this.type;
    }
    getLabel() {
        return this.label;
    }
    setLabel(label) {
        this.label = label;
    }
    getPropertyUri() {
        return this.propertyUri;
    }
    setPropertyUri(uri) {
        this.propertyUri = uri;
    }
    isSelected() {
        return this.selected;
    }
    setSelected(selected) {
        this.selected = selected;
    }
    isValid() {
        return this.valid;
    }
    setValid(valid, errors) {
        this.valid = valid;
        this.errors = errors || [];
    }
    getErrors() {
        return [...this.errors];
    }
    isOptional() {
        return this.type === EdgeType.OPTIONAL;
    }
    toSPARQLPredicate() {
        if (this.propertyUri) {
            return `<${this.propertyUri}>`;
        }
        if (this.label.startsWith("?")) {
            return this.label;
        }
        if (this.label.includes(":")) {
            return this.label;
        }
        return `?${this.label.toLowerCase().replace(/\s+/g, "_")}`;
    }
    calculatePath(sourceNode, targetNode) {
        const sourcePoint = sourceNode.getConnectionPoints();
        const targetPoint = targetNode.getConnectionPoints();
        // Simple direct path for now - can be enhanced with curved paths
        const sx = sourcePoint.right.x;
        const sy = sourcePoint.right.y;
        const tx = targetPoint.left.x;
        const ty = targetPoint.left.y;
        // Calculate control points for smooth curve
        const dx = tx - sx;
        const dy = ty - sy;
        const cx1 = sx + dx * 0.5;
        const cy1 = sy;
        const cx2 = sx + dx * 0.5;
        const cy2 = ty;
        return `M ${sx} ${sy} C ${cx1} ${cy1}, ${cx2} ${cy2}, ${tx} ${ty}`;
    }
    getLabelPosition(sourceNode, targetNode) {
        const sourcePoint = sourceNode.getConnectionPoints().right;
        const targetPoint = targetNode.getConnectionPoints().left;
        return {
            x: (sourcePoint.x + targetPoint.x) / 2,
            y: (sourcePoint.y + targetPoint.y) / 2,
        };
    }
    clone() {
        return new VisualQueryEdge({
            id: `${this.id}_clone_${Date.now()}`,
            sourceNodeId: this.sourceNodeId,
            targetNodeId: this.targetNodeId,
            type: this.type,
            label: this.label,
            propertyUri: this.propertyUri,
        });
    }
    static createProperty(sourceNodeId, targetNodeId, label, propertyUri) {
        return new VisualQueryEdge({
            id: `edge_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,
            sourceNodeId,
            targetNodeId,
            type: EdgeType.PROPERTY,
            label,
            propertyUri,
        });
    }
    static createOptional(sourceNodeId, targetNodeId, label, propertyUri) {
        return new VisualQueryEdge({
            id: `optional_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,
            sourceNodeId,
            targetNodeId,
            type: EdgeType.OPTIONAL,
            label,
            propertyUri,
        });
    }
    static createFilterCondition(sourceNodeId, targetNodeId, label) {
        return new VisualQueryEdge({
            id: `filter_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,
            sourceNodeId,
            targetNodeId,
            type: EdgeType.FILTER_CONDITION,
            label,
        });
    }
}
exports.VisualQueryEdge = VisualQueryEdge;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL2tpdGVsZXYvRG9jdW1lbnRzL2V4b2NvcnRleC1vYnNpZGlhbi1wbHVnaW4vc3JjL2RvbWFpbi92aXN1YWwvVmlzdWFsUXVlcnlFZGdlLnRzIiwibWFwcGluZ3MiOiI7OztBQUVBLElBQVksUUFLWDtBQUxELFdBQVksUUFBUTtJQUNsQixpQ0FBcUIsQ0FBQTtJQUNyQixpQ0FBcUIsQ0FBQTtJQUNyQiwyQkFBZSxDQUFBO0lBQ2YsaURBQXFDLENBQUE7QUFDdkMsQ0FBQyxFQUxXLFFBQVEsR0FBUixnQkFBUSxLQUFSLGdCQUFRLFFBS25CO0FBRUQsTUFBYSxlQUFlO0lBVzFCLFlBQVksTUFPWDtRQVhPLGFBQVEsR0FBWSxLQUFLLENBQUM7UUFDMUIsVUFBSyxHQUFZLElBQUksQ0FBQztRQUN0QixXQUFNLEdBQWEsRUFBRSxDQUFDO1FBVTVCLElBQUksQ0FBQyxFQUFFLEdBQUcsTUFBTSxDQUFDLEVBQUUsQ0FBQztRQUNwQixJQUFJLENBQUMsWUFBWSxHQUFHLE1BQU0sQ0FBQyxZQUFZLENBQUM7UUFDeEMsSUFBSSxDQUFDLFlBQVksR0FBRyxNQUFNLENBQUMsWUFBWSxDQUFDO1FBQ3hDLElBQUksQ0FBQyxJQUFJLEdBQUcsTUFBTSxDQUFDLElBQUksQ0FBQztRQUN4QixJQUFJLENBQUMsS0FBSyxHQUFHLE1BQU0sQ0FBQyxLQUFLLENBQUM7UUFDMUIsSUFBSSxDQUFDLFdBQVcsR0FBRyxNQUFNLENBQUMsV0FBVyxDQUFDO1FBQ3RDLE1BQU0sQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxDQUFDO1FBQ3ZCLE1BQU0sQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLFlBQVksQ0FBQyxDQUFDO1FBQ2pDLE1BQU0sQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLFlBQVksQ0FBQyxDQUFDO1FBQ2pDLE1BQU0sQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO0lBQzNCLENBQUM7SUFFRCxLQUFLO1FBQ0gsT0FBTyxJQUFJLENBQUMsRUFBRSxDQUFD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QUFFLENBQUMsQ0FBQyxNQUFNLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxFQUFFO1lBQ25FLFlBQVk7WUFDWixZQUFZO1lBQ1osSUFBSSxFQUFFLFFBQVEsQ0FBQyxRQUFRO1lBQ3ZCLEtBQUs7WUFDTCxXQUFXO1NBQ1osQ0FBQyxDQUFDO0lBQ0wsQ0FBQztJQUVELE1BQU0sQ0FBQyxjQUFjLENBQ25CLFlBQW9CLEVBQ3BCLFlBQW9CLEVBQ3BCLEtBQWEsRUFDYixXQUFvQjtRQUVwQixPQUFPLElBQUksZUFBZSxDQUFDO1lBQ3pCLEVBQUUsRUFBRSxZQUFZLElBQUksQ0FBQyxHQUFHLEVBQUUsSUFBSSxJQUFJLENBQUMsTUFBTSxFQUFFLENBQUMsUUFBUSxDQUFDLEVBQUUsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLEVBQUU7WUFDdkUsWUFBWTtZQUNaLFlBQVk7WUFDWixJQUFJLEVBQUUsUUFBUSxDQUFDLFFBQVE7WUFDdkIsS0FBSztZQUNMLFdBQVc7U0FDWixDQUFDLENBQUM7SUFDTCxDQUFDO0lBRUQsTUFBTSxDQUFDLHFCQUFxQixDQUMxQixZQUFvQixFQUNwQixZQUFvQixFQUNwQixLQUFhO1FBRWIsT0FBTyxJQUFJLGVBQWUsQ0FBQztZQUN6QixFQUFFLEVBQUUsVUFBVSxJQUFJLENBQUMsR0FBRyxFQUFFLElBQUksSUFBSSxDQUFDLE1BQU0sRUFBRSxDQUFDLFFBQVEsQ0FBQyxFQUFFLENBQUMsQ0FBQyxNQUFNLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxFQUFFO1lBQ3JFLFlBQVk7WUFDWixZQUFZO1lBQ1osSUFBSSxFQUFFLFFBQVEsQ0FBQyxnQkFBZ0I7WUFDL0IsS0FBSztTQUNOLENBQUMsQ0FBQztJQUNMLENBQUM7Q0FDRjtBQXJNRCwwQ0FxTUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL1VzZXJzL2tpdGVsZXYvRG9jdW1lbnRzL2V4b2NvcnRleC1vYnNpZGlhbi1wbHVnaW4vc3JjL2RvbWFpbi92aXN1YWwvVmlzdWFsUXVlcnlFZGdlLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFZpc3VhbFF1ZXJ5Tm9kZSB9IGZyb20gXCIuL1Zpc3VhbFF1ZXJ5Tm9kZVwiO1xuXG5leHBvcnQgZW51bSBFZGdlVHlwZSB7XG4gIFBST1BFUlRZID0gXCJwcm9wZXJ0eVwiLFxuICBPUFRJT05BTCA9IFwib3B0aW9uYWxcIixcbiAgVU5JT04gPSBcInVuaW9uXCIsXG4gIEZJTFRFUl9DT05ESVRJT04gPSBcImZpbHRlcl9jb25kaXRpb25cIixcbn1cblxuZXhwb3J0IGNsYXNzIFZpc3VhbFF1ZXJ5RWRnZSB7XG4gIHByaXZhdGUgcmVhZG9ubHkgaWQ6IHN0cmluZztcbiAgcHJpdmF0ZSByZWFkb25seSBzb3VyY2VOb2RlSWQ6IHN0cmluZztcbiAgcHJpdmF0ZSByZWFkb25seSB0YXJnZXROb2RlSWQ6IHN0cmluZztcbiAgcHJpdmF0ZSByZWFkb25seSB0eXBlOiBFZGdlVHlwZTtcbiAgcHJpdmF0ZSBsYWJlbDogc3RyaW5nO1xuICBwcml2YXRlIHByb3BlcnR5VXJpPzogc3RyaW5nO1xuICBwcml2YXRlIHNlbGVjdGVkOiBib29sZWFuID0gZmFsc2U7XG4gIHByaXZhdGUgdmFsaWQ6IGJvb2xlYW4gPSB0cnVlO1xuICBwcml2YXRlIGVycm9yczogc3RyaW5nW10gPSBbXTtcblxuICBjb25zdHJ1Y3RvcihwYXJhbXM6IHtcbiAgICBpZDogc3RyaW5nO1xuICAgIHNvdXJjZU5vZGVJZDogc3RyaW5nO1xuICAgIHRhcmdldE5vZGVJZDogc3RyaW5nO1xuICAgIHR5cGU6IEVkZ2VUeXBlO1xuICAgIGxhYmVsOiBzdHJpbmc7XG4gICAgcHJvcGVydHlVcmk/OiBzdHJpbmc7XG4gIH0pIHtcbiAgICB0aGlzLmlkID0gcGFyYW1zLmlkO1xuICAgIHRoaXMuc291cmNlTm9kZUlkID0gcGFyYW1zLnNvdXJjZU5vZGVJZDtcbiAgICB0aGlzLnRhcmdldE5vZGVJZCA9IHBhcmFtcy50YXJnZXROb2RlSWQ7XG4gICAgdGhpcy50eXBlID0gcGFyYW1zLnR5cGU7XG4gICAgdGhpcy5sYWJlbCA9IHBhcmFtcy5sYWJlbDtcbiAgICB0aGlzLnByb3BlcnR5VXJpID0gcGFyYW1zLnByb3BlcnR5VXJpO1xuICAgIE9iamVjdC5mcmVlemUodGhpcy5pZCk7XG4gICAgT2JqZWN0LmZyZWV6ZSh0aGlzLnNvdXJjZU5vZGVJZCk7XG4gICAgT2JqZWN0LmZyZWV6ZSh0aGlzLnRhcmdldE5vZGVJZCk7XG4gICAgT2JqZWN0LmZyZWV6ZSh0aGlzLnR5cGUpO1xuICB9XG5cbiAgZ2V0SWQoKTogc3RyaW5nIHtcbiAgICByZXR1cm4gdGhpcy5pZDtcbiAgfVxuXG4gIGdldFNvdXJjZU5vZGVJZCgpOiBzdHJpbmcge1xuICAgIHJldHVybiB0aGlzLnNvdXJjZU5vZGVJZDtcbiAgfVxuXG4gIGdldFRhcmdldE5vZGVJZCgpOiBzdHJpbmcge1xuICAgIHJldHVybiB0aGlzLnRhcmdldE5vZGVJZDtcbiAgfVxuXG4gIGdldFR5cGUoKTogRWRnZVR5cGUge1xuICAgIHJldHVybiB0aGlzLnR5cGU7XG4gIH1cblxuICBnZXRMYWJlbCgpOiBzdHJpbmcge1xuICAgIHJldHVybiB0aGlzLmxhYmVsO1xuICB9XG5cbiAgc2V0TGFiZWwobGFiZWw6IHN0cmluZyk6IHZvaWQge1xuICAgIHRoaXMubGFiZWwgPSBsYWJlbDtcbiAgfVxuXG4gIGdldFByb3BlcnR5VXJpKCk6IHN0cmluZyB8IHVuZGVmaW5lZCB7XG4gICAgcmV0dXJuIHRoaXMucHJvcGVydHlVcmk7XG4gIH1cblxuICBzZXRQcm9wZXJ0eVVyaSh1cmk6IHN0cmluZyk6IHZvaWQge1xuICAgIHRoaXMucHJvcGVydHlVcmkgPSB1cmk7XG4gIH1cblxuICBpc1NlbGVjdGVkKCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiB0aGlzLnNlbGVjdGVkO1xuICB9XG5cbiAgc2V0U2VsZWN0ZWQoc2VsZWN0ZWQ6IGJvb2xlYW4pOiB2b2lkIHtcbiAgICB0aGlzLnNlbGVjdGVkID0gc2VsZWN0ZWQ7XG4gIH1cblxuICBpc1ZhbGlkKCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiB0aGlzLnZhbGlkO1xuICB9XG5cbiAgc2V0VmFsaWQodmFsaWQ6IGJvb2xlYW4sIGVycm9ycz86IHN0cmluZ1tdKTogdm9pZCB7XG4gICAgdGhpcy52YWxpZCA9IHZhbGlkO1xuICAgIHRoaXMuZXJyb3JzID0gZXJyb3JzIHx8IFtdO1xuICB9XG5cbiAgZ2V0RXJyb3JzKCk6IHN0cmluZ1tdIHtcbiAgICByZXR1cm4gWy4uLnRoaXMuZXJyb3JzXTtcbiAgfVxuXG4gIGlzT3B0aW9uYWwoKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIHRoaXMudHlwZSA9PT0gRWRnZVR5cGUuT1BUSU9OQUw7XG4gIH1cblxuICB0b1NQQVJRTFByZWRpY2F0ZSgpOiBzdHJpbmcge1xuICAgIGlmICh0aGlzLnByb3BlcnR5VXJpKSB7XG4gICAgICByZXR1cm4gYDwke3RoaXMucHJvcGVydHlVcml9PmA7XG4gICAgfVxuXG4gICAgaWYgKHRoaXMubGFiZWwuc3RhcnRzV2l0aChcIj9cIikpIHtcbiAgICAgIHJldHVybiB0aGlzLmxhYmVsO1xuICAgIH1cblxuICAgIGlmICh0aGlzLmxhYmVsLmluY2x1ZGVzKFwiOlwiKSkge1xuICAgICAgcmV0dXJuIHRoaXMubGFiZWw7XG4gICAgfVxuXG4gICAgcmV0dXJuIGA/JHt0aGlzLmxhYmVsLnRvTG93ZXJDYXNlKCkucmVwbGFjZSgvXFxzKy9nLCBcIl9cIil9YDtcbiAgfVxuXG4gIGNhbGN1bGF0ZVBhdGgoXG4gICAgc291cmNlTm9kZTogVmlzdWFsUXVlcnlOb2RlLFxuICAgIHRhcmdldE5vZGU6IFZpc3VhbFF1ZXJ5Tm9kZSxcbiAgKTogc3RyaW5nIHtcbiAgICBjb25zdCBzb3VyY2VQb2ludCA9IHNvdXJjZU5vZGUuZ2V0Q29ubmVjdGlvblBvaW50cygpO1xuICAgIGNvbnN0IHRhcmdldFBvaW50ID0gdGFyZ2V0Tm9kZS5nZXRDb25uZWN0aW9uUG9pbnRzKCk7XG5cbiAgICAvLyBTaW1wbGUgZGlyZWN0IHBhdGggZm9yIG5vdyAtIGNhbiBiZSBlbmhhbmNlZCB3aXRoIGN1cnZlZCBwYXRoc1xuICAgIGNvbnN0IHN4ID0gc291cmNlUG9pbnQucmlnaHQueDtcbiAgICBjb25zdCBzeSA9IHNvdXJjZVBvaW50LnJpZ2h0Lnk7XG4gICAgY29uc3QgdHggPSB0YXJnZXRQb2ludC5sZWZ0Lng7XG4gICAgY29uc3QgdHkgPSB0YXJnZXRQb2ludC5sZWZ0Lnk7XG5cbiAgICAvLyBDYWxjdWxhdGUgY29udHJvbCBwb2ludHMgZm9yIHNtb290aCBjdXJ2ZVxuICAgIGNvbnN0IGR4ID0gdHggLSBzeDtcbiAgICBjb25zdCBkeSA9IHR5IC0gc3k7XG4gICAgY29uc3QgY3gxID0gc3ggKyBkeCAqIDAuNTtcbiAgICBjb25zdCBjeTEgPSBzeTtcbiAgICBjb25zdCBjeDIgPSBzeCArIGR4ICogMC41O1xuICAgIGNvbnN0IGN5MiA9IHR5O1xuXG4gICAgcmV0dXJuIGBNICR7c3h9ICR7c3l9IEMgJHtjeDF9ICR7Y3kxfSwgJHtjeDJ9ICR7Y3kyfSwgJHt0eH0gJHt0eX1gO1xuICB9XG5cbiAgZ2V0TGFiZWxQb3NpdGlvbihcbiAgICBzb3VyY2VOb2RlOiBWaXN1YWxRdWVyeU5vZGUsXG4gICAgdGFyZ2V0Tm9kZTogVmlzdWFsUXVlcnlOb2RlLFxuICApOiB7IHg6IG51bWJlcjsgeTogbnVtYmVyIH0ge1xuICAgIGNvbnN0IHNvdXJjZVBvaW50ID0gc291cmNlTm9kZS5nZXRDb25uZWN0aW9uUG9pbnRzKCkucmlnaHQ7XG4gICAgY29uc3QgdGFyZ2V0UG9pbnQgPSB0YXJnZXROb2RlLmdldENvbm5lY3Rpb25Qb2ludHMoKS5sZWZ0O1xuXG4gICAgcmV0dXJuIHtcbiAgICAgIHg6IChzb3VyY2VQb2ludC54ICsgdGFyZ2V0UG9pbnQueCkgLyAyLFxuICAgICAgeTogKHNvdXJjZVBvaW50LnkgKyB0YXJnZXRQb2ludC55KSAvIDIsXG4gICAgfTtcbiAgfVxuXG4gIGNsb25lKCk6IFZpc3VhbFF1ZXJ5RWRnZSB7XG4gICAgcmV0dXJuIG5ldyBWaXN1YWxRdWVyeUVkZ2Uoe1xuICAgICAgaWQ6IGAke3RoaXMuaWR9X2Nsb25lXyR7RGF0ZS5ub3coKX1gLFxuICAgICAgc291cmNlTm9kZUlkOiB0aGlzLnNvdXJjZU5vZGVJZCxcbiAgICAgIHRhcmdldE5vZGVJZDogdGhpcy50YXJnZXROb2RlSWQsXG4gICAgICB0eXBlOiB0aGlzLnR5cGUsXG4gICAgICBsYWJlbDogdGhpcy5sYWJlbCxcbiAgICAgIHByb3BlcnR5VXJpOiB0aGlzLnByb3BlcnR5VXJpLFxuICAgIH0pO1xuICB9XG5cbiAgc3RhdGljIGNyZWF0ZVByb3BlcnR5KFxuICAgIHNvdXJjZU5vZGVJZDogc3RyaW5nLFxuICAgIHRhcmdldE5vZGVJZDogc3RyaW5nLFxuICAgIGxhYmVsOiBzdHJpbmcsXG4gICAgcHJvcGVydHlVcmk/OiBzdHJpbmcsXG4gICk6IFZpc3VhbFF1ZXJ5RWRnZSB7XG4gICAgcmV0dXJuIG5ldyBWaXN1YWxRdWVyeUVkZ2Uoe1xuICAgICAgaWQ6IGBlZGdlXyR7RGF0ZS5ub3coKX1fJHtNYXRoLnJhbmRvbSgpLnRvU3RyaW5nKDM2KS5zdWJzdHIoMiwgOSl9YCxcbiAgICAgIHNvdXJjZU5vZGVJZCxcbiAgICAgIHRhcmdldE5vZGVJZCxcbiAgICAgIHR5cGU6IEVkZ2VUeXBlLlBST1BFUlRZLFxuICAgICAgbGFiZWwsXG4gICAgICBwcm9wZXJ0eVVyaSxcbiAgICB9KTtcbiAgfVxuXG4gIHN0YXRpYyBjcmVhdGVPcHRpb25hbChcbiAgICBzb3VyY2VOb2RlSWQ6IHN0cmluZyxcbiAgICB0YXJnZXROb2RlSWQ6IHN0cmluZyxcbiAgICBsYWJlbDogc3RyaW5nLFxuICAgIHByb3BlcnR5VXJpPzogc3RyaW5nLFxuICApOiBWaXN1YWxRdWVyeUVkZ2Uge1xuICAgIHJldHVybiBuZXcgVmlzdWFsUXVlcnlFZGdlKHtcbiAgICAgIGlkOiBgb3B0aW9uYWxfJHtEYXRlLm5vdygpfV8ke01hdGgucmFuZG9tKCkudG9TdHJpbmcoMzYpLnN1YnN0cigyLCA5KX1gLFxuICAgICAgc291cmNlTm9kZUlkLFxuICAgICAgdGFyZ2V0Tm9kZUlkLFxuICAgICAgdHlwZTogRWRnZVR5cGUuT1BUSU9OQUwsXG4gICAgICBsYWJlbCxcbiAgICAgIHByb3BlcnR5VXJpLFxuICAgIH0pO1xuICB9XG5cbiAgc3RhdGljIGNyZWF0ZUZpbHRlckNvbmRpdGlvbihcbiAgICBzb3VyY2VOb2RlSWQ6IHN0cmluZyxcbiAgICB0YXJnZXROb2RlSWQ6IHN0cmluZyxcbiAgICBsYWJlbDogc3RyaW5nLFxuICApOiBWaXN1YWxRdWVyeUVkZ2Uge1xuICAgIHJldHVybiBuZXcgVmlzdWFsUXVlcnlFZGdlKHtcbiAgICAgIGlkOiBgZmlsdGVyXyR7RGF0ZS5ub3coKX1fJHtNYXRoLnJhbmRvbSgpLnRvU3RyaW5nKDM2KS5zdWJzdHIoMiwgOSl9YCxcbiAgICAgIHNvdXJjZU5vZGVJZCxcbiAgICAgIHRhcmdldE5vZGVJZCxcbiAgICAgIHR5cGU6IEVkZ2VUeXBlLkZJTFRFUl9DT05ESVRJT04sXG4gICAgICBsYWJlbCxcbiAgICB9KTtcbiAgfVxufVxuIl0sInZlcnNpb24iOjN9