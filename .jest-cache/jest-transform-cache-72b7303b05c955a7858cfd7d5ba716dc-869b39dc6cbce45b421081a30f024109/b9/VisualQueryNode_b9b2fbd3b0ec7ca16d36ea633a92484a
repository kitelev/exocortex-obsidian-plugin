ce95b7b0f006d4487b4a0ca021354321
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.VisualQueryNode = exports.NodeType = void 0;
var NodeType;
(function (NodeType) {
    NodeType["ENTITY"] = "entity";
    NodeType["VARIABLE"] = "variable";
    NodeType["LITERAL"] = "literal";
    NodeType["FILTER"] = "filter";
})(NodeType = exports.NodeType || (exports.NodeType = {}));
class VisualQueryNode {
    constructor(params) {
        this.selected = false;
        this.valid = true;
        this.errors = [];
        this.id = params.id;
        this.type = params.type;
        this.label = params.label;
        this.position = params.position;
        this.variableName = params.variableName;
        this.uri = params.uri;
        this.dimensions = params.dimensions || { width: 150, height: 60 };
        Object.freeze(this.id);
        Object.freeze(this.type);
    }
    getId() {
        return this.id;
    }
    getType() {
        return this.type;
    }
    getLabel() {
        return this.label;
    }
    setLabel(label) {
        this.label = label;
    }
    getVariableName() {
        return this.variableName;
    }
    setVariableName(name) {
        this.variableName = name;
    }
    getUri() {
        return this.uri;
    }
    setUri(uri) {
        this.uri = uri;
    }
    getPosition() {
        return Object.assign({}, this.position);
    }
    setPosition(position) {
        this.position = Object.assign({}, position);
    }
    getDimensions() {
        return Object.assign({}, this.dimensions);
    }
    setDimensions(dimensions) {
        this.dimensions = Object.assign({}, dimensions);
    }
    isSelected() {
        return this.selected;
    }
    setSelected(selected) {
        this.selected = selected;
    }
    isValid() {
        return this.valid;
    }
    setValid(valid, errors) {
        this.valid = valid;
        this.errors = errors || [];
    }
    getErrors() {
        return [...this.errors];
    }
    containsPoint(x, y) {
        return x >= this.position.x &&
            x <= this.position.x + this.dimensions.width &&
            y >= this.position.y &&
            y <= this.position.y + this.dimensions.height;
    }
    getConnectionPoints() {
        return {
            top: {
                x: this.position.x + this.dimensions.width / 2,
                y: this.position.y
            },
            right: {
                x: this.position.x + this.dimensions.width,
                y: this.position.y + this.dimensions.height / 2
            },
            bottom: {
                x: this.position.x + this.dimensions.width / 2,
                y: this.position.y + this.dimensions.height
            },
            left: {
                x: this.position.x,
                y: this.position.y + this.dimensions.height / 2
            }
        };
    }
    toSPARQLElement() {
        switch (this.type) {
            case NodeType.ENTITY:
                if (this.uri) {
                    return `<${this.uri}>`;
                }
                else if (this.variableName) {
                    return `?${this.variableName}`;
                }
                else {
                    return `?${this.label.toLowerCase().replace(/\s+/g, '_')}`;
                }
            case NodeType.VARIABLE:
                return `?${this.variableName || this.label.toLowerCase().replace(/\s+/g, '_')}`;
            case NodeType.LITERAL:
                return `"${this.label}"`;
            case NodeType.FILTER:
                return this.label;
            default:
                return '?unknown';
        }
    }
    clone() {
        return new VisualQueryNode({
            id: `${this.id}_clone_${Date.now()}`,
            type: this.type,
            label: this.label,
            position: Object.assign({}, this.position),
            variableName: this.variableName,
            uri: this.uri,
            dimensions: Object.assign({}, this.dimensions)
        });
    }
    static createEntity(label, uri, position) {
        return new VisualQueryNode({
            id: `entity_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,
            type: NodeType.ENTITY,
            label,
            uri,
            position: position || { x: 0, y: 0 }
        });
    }
    static createVariable(name, position) {
        return new VisualQueryNode({
            id: `var_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,
            type: NodeType.VARIABLE,
            label: name,
            variableName: name,
            position: position || { x: 0, y: 0 }
        });
    }
    static createLiteral(value, position) {
        return new VisualQueryNode({
            id: `literal_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,
            type: NodeType.LITERAL,
            label: value,
            position: position || { x: 0, y: 0 }
        });
    }
    static createFilter(expression, position) {
        return new VisualQueryNode({
            id: `filter_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,
            type: NodeType.FILTER,
            label: expression,
            position: position || { x: 0, y: 0 },
            dimensions: { width: 200, height: 80 }
        });
    }
}
exports.VisualQueryNode = VisualQueryNode;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL2tpdGVsZXYvRG9jdW1lbnRzL2V4b2NvcnRleC1vYnNpZGlhbi1wbHVnaW4vc3JjL2RvbWFpbi92aXN1YWwvVmlzdWFsUXVlcnlOb2RlLnRzIiwibWFwcGluZ3MiOiI7OztBQUFBLElBQVksUUFLWDtBQUxELFdBQVksUUFBUTtJQUNoQiw2QkFBaUIsQ0FBQTtJQUNqQixpQ0FBcUIsQ0FBQTtJQUNyQiwrQkFBbUIsQ0FBQTtJQUNuQiw2QkFBaUIsQ0FBQTtBQUNyQixDQUFDLEVBTFcsUUFBUSxHQUFSLGdCQUFRLEtBQVIsZ0JBQVEsUUFLbkI7QUFZRCxNQUFhLGVBQWU7SUFZeEIsWUFBWSxNQVFYO1FBWk8sYUFBUSxHQUFZLEtBQUssQ0FBQztRQUMxQixVQUFLLEdBQVksSUFBSSxDQUFDO1FBQ3RCLFdBQU0sR0FBYSxFQUFFLENBQUM7UUFXMUIsSUFBSSxDQUFDLEVBQUUsR0FBRyxNQUFNLENBQUMsRUFBRSxDQUFDO1FBQ3BCLElBQUksQ0FBQyxJQUFJLEdBQUcsTUFBTSxDQUFDLElBQUksQ0FBQztRQUN4QixJQUFJLENBQUMsS0FBSyxHQUFHLE1BQU0sQ0FBQyxLQUFLLENBQUM7UUFDMUIsSUFBSSxDQUFDLFFBQVEsR0FBRyxNQUFNLENBQUMsUUFBUSxDQUFDO1FBQ2hDLElBQUksQ0FBQyxZQUFZLEdBQUcsTUFBTSxDQUFDLFlBQVksQ0FBQztRQUN4QyxJQUFJLENBQUMsR0FBRyxHQUFHLE1BQU0sQ0FBQyxHQUFHLENBQUM7UUFDdEIsSUFBSSxDQUFDLFVBQVUsR0FBRyxNQUFNLENBQUMsVUFBVSxJQUFJLEVBQUUsS0FBSyxFQUFFLEdBQUcsRUFBRSxNQUFNLEVBQUUsRUFBRSxFQUFFLENBQUM7UUFDbEUsTUFBTSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDLENBQUM7UUFDdkIsTUFBTSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7SUFDN0IsQ0FBQztJQUVELEtBQUs7UUFDRCxPQUFPLElBQUksQ0FBQyxFQUFFLENBQUM7SUFDbkIsQ0FBQztJQUVELE9BQU87UUFDSCxPQUFPLElBQUksQ0FBQyxJQUFJLENBQUM7SUFDckIsQ0FBQztJQUVELFFBQVE7UUFDSixPQUFPLElBQUksQ0FBQyxLQUFLLENBQUM7SUFDdEIsQ0FBQztJQUVELFFBQVEsQ0FBQyxLQUFhO1FBQ2xCLElBQUksQ0FBQyxLQUFLLEdBQUcsS0FBSyxDQUFDO0lBQ3ZCLENBQUM7SUFFRCxlQUFlO1FBQ1gsT0FBTyxJQUFJLENBQUMsWUFBWSxDQUFDO0lBQzdCLENBQUM7SUFFRCxlQUFlLENBQUMsSUFBWTtRQUN4QixJQUFJLENBQUMsWUFBWSxHQUFHLElBQUksQ0FBQztJQUM3QixDQUFDO0lBRUQsTUFBTTtRQUNGLE9BQU8sSUFBSSxDQUFDLEdBQUcsQ0FBQztJQUNwQixDQUFDO0lBRUQsTUFBTSxDQUFDLEdBQVc7UUFDZCxJQUFJLENBQUMsR0FBRyxHQUFHLEdBQUcsQ0FBQztJQUNuQixDQUFDO0lBRUQsV0FBVztRQUNQLHlCQUFZLElBQUksQ0FBQyxRQUFRLEVBQUc7SUFDaEMsQ0FBQztJQUVELFdBQVcsQ0FBQyxRQUFzQjtRQUM5QixJQUFJLENBQUMsUUFBUSxxQkFBUSxRQUFRLENBQUUsQ0FBQztJQUNwQyxDQUFDO0lBRUQsYUFBYTtRQUNULHlCQUFZLElBQUksQ0FBQyxVQUFVLEVBQUc7SUFDbEMsQ0FBQztJQUVELGFBQWEsQ0FBQyxVQUEwQjtRQUNwQyxJQUFJLENBQUMsVUFBVSxxQkFBUSxVQUFVLENBQUUsQ0FBQztJQUN4QyxDQUFDO0lBRUQsVUFBVTtRQUNOLE9BQU8sSUFBSSxDQUFDLFFBQVEsQ0FBQztJQUN6QixDQUFDO0lBRUQsV0FBVyxDQUFDLFFBQWlCO1FBQ3pCLElBQUksQ0FBQyxRQUFRLEdBQUcsUUFBUSxDQUFDO0lBQzdCLENBQUM7SUFFRCxPQUFPO1FBQ0gsT0FBTyxJQUFJLENBQUMsS0FBSyxDQUFDO0lBQ3RCLENBQUM7SUFFRCxRQUFRLENBQUMsS0FBYyxFQUFFLE1BQWlCO1FBQ3RDLElBQUksQ0FBQyxLQUFLLEdBQUcsS0FBSyxDQUFDO1FBQ25CLElBQUksQ0FBQyxNQUFNLEdBQUcsTUFBTSxJQUFJLEVBQUUsQ0FBQztJQUMvQixDQUFDO0lBRUQsU0FBUztRQUNMLE9BQU8sQ0FBQyxHQUFHLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQztJQUM1QixDQUFDO0lBRUQsYUFBYSxDQUFDLENBQVMsRUFBRSxDQUFTO1FBQzlCLE9BQU8sQ0FBQyxJQUFJLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQztZQUNwQixDQUFDLElBQUksSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUFDLEdBQUcsSUFBSSxDQUFDLFVBQVUsQ0FBQyxLQUFLO1lBQzVDLENBQUMsSUFBSSxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUM7WUFDcEIsQ0FBQyxJQUFJLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQyxHQUFHLElBQUksQ0FBQyxVQUFVLENBQUMsTUFBTSxDQUFDO0lBQ3pELENBQUM7SUFFRCxtQkFBbUI7UUFDZixPQUFPO1lBQ0gsR0FBRyxFQUFFO2dCQUNELENBQUMsRUFBRSxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUMsR0FBRyxJQUFJLENBQUMsVUFBVSxDQUFDLEtBQUssR0FBRyxDQUFDO2dCQUM5QyxDQUFDLEVBQUUsSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUFDO2FBQ3JCO1lBQ0QsS0FBSyxFQUFFO2dCQUNILENBQUMsRUFBRSxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUMsR0FBRyxJQUFJLENBQUMsVUFBVSxDQUFDLEtBQUs7Z0JBQzFDLENBQUMsRUFBRSxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUMsR0FBRyxJQUFJLENBQUMsVUFBVSxDQUFDLE1BQU0sR0FBRyxDQUFDO2FBQ2xEO1lBQ0QsTUFBTSxFQUFFO2dCQUNKLENBQUMsRUFBRSxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUMsR0FBRyxJQUFJLENBQUMsVUFBVSxDQUFDLEtBQUssR0FBRyxDQUFDO2dCQUM5QyxDQUFDLEVBQUUsSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUFDLEdBQUcsSUFBSSxDQUFDLFVBQVUsQ0FBQyxNQUFNO2FBQzlDO1lBQ0QsSUFBSSxFQUFFO2dCQUNGLENBQUMsRUFBRSxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUM7Z0JBQ2xCLENBQUMsRUFBRSxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUMsR0FBRyxJQUFJLENBQUMsVUFBVSxDQUFDLE1BQU0sR0FBRyxDQUFDO2FBQ2xEO1NBQ0osQ0FBQztJQUNOLENBQUM7SUFFRCxlQUFlO1FBQ1gsUUFBUSxJQUFJLENBQUMsSUFBSSxFQUFFO1lBQ2YsS0FBSyxRQUFRLENBQUMsTUFBTTtnQkFDaEIsSUFBSSxJQUFJLENBQUMsR0FBRyxFQUFFO29CQUNWLE9BQU8sSUFBSSxJQUFJLENBQUMsR0FBRyxHQUFHLENBQUM7aUJBQzFCO3FCQUFNLElBQUksSUFBSSxDQUFDLFlBQVksRUFBRTtvQkFDMUIsT0FBTyxJQUFJLElBQUksQ0FBQyxZQUFZLEVBQUUsQ0FBQztpQkFDbEM7cUJBQU07b0JBQ0gsT0FBTyxJQUFJLElBQUksQ0FBQyxLQUFLLENBQUMsV0FBVyxFQUFFLENBQUMsT0FBTyxDQUFDLE1BQU0sRUFBRSxHQUFHLENBQUMsRUFBRSxDQUFDO2lCQUM5RDtZQUNMLEtBQUssUUFBUSxDQUFDLFFBQVE7Z0JBQ2xCLE9BQU8sSUFBSSxJQUFJLENBQUMsWUFBWSxJQUFJLElBQUksQ0FBQyxLQUFLLENBQUMsV0FBVyxFQUFFLENBQUMsT0FBTyxDQUFDLE1BQU0sRUFBRSxHQUFHLENBQUMsRUFBRSxDQUFDO1lBQ3BGLEtBQUssUUFBUSxDQUFDLE9BQU87Z0JBQ2pCLE9BQU8sSUFBSSxJQUFJLENBQUMsS0FBSyxHQUFHLENBQUM7WUFDN0IsS0FBSyxRQUFRLENBQUMsTUFBTTtnQkFDaEIsT0FBTyxJQUFJLENBQUMsS0FBSyxDQUFDO1lBQ3RCO2dCQUNJLE9BQU8sVUFBVSxDQUFDO1NBQ3pCO0lBQ0wsQ0FBQztJQUVELEtBQUs7UUFDRCxPQUFPLElBQUksZUFBZSxDQUFDO1lBQ3ZCLEVBQUUsRUFBRSxHQUFHLElBQUksQ0FBQyxFQUFFLFVBQVUsSUFBSSxDQUFDLEdBQUcsRUFBRSxFQUFFO1lBQ3BDLElBQUksRUFBRSxJQUFJLENBQUMsSUFBSTtZQUNmLEtBQUssRUFBRSxJQUFJLENBQUMsS0FBSztZQUNqQixRQUFRLG9CQUFPLElBQUksQ0FBQyxRQUFRLENBQUU7WUFDOUIsWUFBWSxFQUFFLElBQUksQ0FBQyxZQUFZO1lBQy9CLEdBQUcsRUFBRSxJQUFJLENBQUMsR0FBRztZQUNiLFVBQVUsb0JBQU8sSUFBSSxDQUFDLFVBQVUsQ0FBRTtTQUNyQyxDQUFDLENBQUM7SUFDUCxDQUFDO0lBRUQsTUFBTSxDQUFDLFlBQVksQ0FBQyxLQUFhLEVBQUUsR0FBWSxFQUFFLFFBQXVCO1FBQ3BFLE9BQU8sSUFBSSxlQUFlLENBQUM7WUFDdkIsRUFBRSxFQUFFLFVBQVUsSUFBSSxDQUFDLEdBQUcsRUFBRSxJQUFJLElBQUksQ0FBQyxNQUFNLEVBQUUsQ0FBQyxRQUFRLENBQUMsRUFBRSxDQUFDLENBQUMsTUFBTSxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsRUFBRTtZQUNyRSxJQUFJLEVBQUUsUUFBUSxDQUFDLE1BQU07WUFDckIsS0FBSztZQUNMLEdBQUc7WUFDSCxRQUFRLEVBQUUsUUFBUSxJQUFJLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFO1NBQ3ZDLENBQUMsQ0FBQztJQUNQLENBQUM7SUFFRCxNQUFNLENBQUMsY0FBYyxDQUFDLElBQVksRUFBRSxRQUF1QjtRQUN2RCxPQUFPLElBQUksZUFBZSxDQUFDO1lBQ3ZCLEVBQUUsRUFBRSxPQUFPLElBQUksQ0FBQyxHQUFHLEVBQUUsSUFBSSxJQUFJLENBQUMsTUFBTSxFQUFFLENBQUMsUUFBUSxDQUFDLEVBQUUsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLEVBQUU7WUFDbEUsSUFBSSxFQUFFLFFBQVEsQ0FBQyxRQUFRO1lBQ3ZCLEtBQUssRUFBRSxJQUFJO1lBQ1gsWUFBWSxFQUFFLElBQUk7WUFDbEIsUUFBUSxFQUFFLFFBQVEsSUFBSSxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRTtTQUN2QyxDQUFDLENBQUM7SUFDUCxDQUFDO0lBRUQsTUFBTSxDQUFDLGFBQWEsQ0FBQyxLQUFhLEVBQUUsUUFBdUI7UUFDdkQsT0FBTyxJQUFJLGVBQWUsQ0FBQztZQUN2QixFQUFFLEVBQUUsV0FBVyxJQUFJLENBQUMsR0FBRyxFQUFFLElBQUksSUFBSSxDQUFDLE1BQU0sRUFBRSxDQUFDLFFBQVEsQ0FBQyxFQUFFLENBQUMsQ0FBQyxNQUFNLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxFQUFFO1lBQ3RFLElBQUksRUFBRSxRQUFRLENBQUMsT0FBTztZQUN0QixLQUFLLEVBQUUsS0FBSztZQUNaLFFBQVEsRUFBRSxRQUFRLElBQUksRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUU7U0FDdkMsQ0FBQyxDQUFDO0lBQ1AsQ0FBQztJQUVELE1BQU0sQ0FBQyxZQUFZLENBQUMsVUFBa0IsRUFBRSxRQUF1QjtRQUMzRCxPQUFPLElBQUksZUFBZSxDQUFDO1lBQ3ZCLEVBQUUsRUFBRSxVQUFVLElBQUksQ0FBQyxHQUFHLEVBQUUsSUFBSSxJQUFJLENBQUMsTUFBTSxFQUFFLENBQUMsUUFBUSxDQUFDLEVBQUUsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLEVBQUU7WUFDckUsSUFBSSxFQUFFLFFBQVEsQ0FBQyxNQUFNO1lBQ3JCLEtBQUssRUFBRSxVQUFVO1lBQ2pCLFFBQVEsRUFBRSxRQUFRLElBQUksRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUU7WUFDcEMsVUFBVSxFQUFFLEVBQUUsS0FBSyxFQUFFLEdBQUcsRUFBRSxNQUFNLEVBQUUsRUFBRSxFQUFFO1NBQ3pDLENBQUMsQ0FBQztJQUNQLENBQUM7Q0FDSjtBQXhNRCwwQ0F3TUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL1VzZXJzL2tpdGVsZXYvRG9jdW1lbnRzL2V4b2NvcnRleC1vYnNpZGlhbi1wbHVnaW4vc3JjL2RvbWFpbi92aXN1YWwvVmlzdWFsUXVlcnlOb2RlLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImV4cG9ydCBlbnVtIE5vZGVUeXBlIHtcbiAgICBFTlRJVFkgPSAnZW50aXR5JyxcbiAgICBWQVJJQUJMRSA9ICd2YXJpYWJsZScsXG4gICAgTElURVJBTCA9ICdsaXRlcmFsJyxcbiAgICBGSUxURVIgPSAnZmlsdGVyJ1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIE5vZGVQb3NpdGlvbiB7XG4gICAgeDogbnVtYmVyO1xuICAgIHk6IG51bWJlcjtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBOb2RlRGltZW5zaW9ucyB7XG4gICAgd2lkdGg6IG51bWJlcjtcbiAgICBoZWlnaHQ6IG51bWJlcjtcbn1cblxuZXhwb3J0IGNsYXNzIFZpc3VhbFF1ZXJ5Tm9kZSB7XG4gICAgcHJpdmF0ZSByZWFkb25seSBpZDogc3RyaW5nO1xuICAgIHByaXZhdGUgcmVhZG9ubHkgdHlwZTogTm9kZVR5cGU7XG4gICAgcHJpdmF0ZSBsYWJlbDogc3RyaW5nO1xuICAgIHByaXZhdGUgdmFyaWFibGVOYW1lPzogc3RyaW5nO1xuICAgIHByaXZhdGUgdXJpPzogc3RyaW5nO1xuICAgIHByaXZhdGUgcG9zaXRpb246IE5vZGVQb3NpdGlvbjtcbiAgICBwcml2YXRlIGRpbWVuc2lvbnM6IE5vZGVEaW1lbnNpb25zO1xuICAgIHByaXZhdGUgc2VsZWN0ZWQ6IGJvb2xlYW4gPSBmYWxzZTtcbiAgICBwcml2YXRlIHZhbGlkOiBib29sZWFuID0gdHJ1ZTtcbiAgICBwcml2YXRlIGVycm9yczogc3RyaW5nW10gPSBbXTtcblxuICAgIGNvbnN0cnVjdG9yKHBhcmFtczoge1xuICAgICAgICBpZDogc3RyaW5nO1xuICAgICAgICB0eXBlOiBOb2RlVHlwZTtcbiAgICAgICAgbGFiZWw6IHN0cmluZztcbiAgICAgICAgcG9zaXRpb246IE5vZGVQb3NpdGlvbjtcbiAgICAgICAgdmFyaWFibGVOYW1lPzogc3RyaW5nO1xuICAgICAgICB1cmk/OiBzdHJpbmc7XG4gICAgICAgIGRpbWVuc2lvbnM/OiBOb2RlRGltZW5zaW9ucztcbiAgICB9KSB7XG4gICAgICAgIHRoaXMuaWQgPSBwYXJhbXMuaWQ7XG4gICAgICAgIHRoaXMudHlwZSA9IHBhcmFtcy50eXBlO1xuICAgICAgICB0aGlzLmxhYmVsID0gcGFyYW1zLmxhYmVsO1xuICAgICAgICB0aGlzLnBvc2l0aW9uID0gcGFyYW1zLnBvc2l0aW9uO1xuICAgICAgICB0aGlzLnZhcmlhYmxlTmFtZSA9IHBhcmFtcy52YXJpYWJsZU5hbWU7XG4gICAgICAgIHRoaXMudXJpID0gcGFyYW1zLnVyaTtcbiAgICAgICAgdGhpcy5kaW1lbnNpb25zID0gcGFyYW1zLmRpbWVuc2lvbnMgfHwgeyB3aWR0aDogMTUwLCBoZWlnaHQ6IDYwIH07XG4gICAgICAgIE9iamVjdC5mcmVlemUodGhpcy5pZCk7XG4gICAgICAgIE9iamVjdC5mcmVlemUodGhpcy50eXBlKTtcbiAgICB9XG5cbiAgICBnZXRJZCgpOiBzdHJpbmcge1xuICAgICAgICByZXR1cm4gdGhpcy5pZDtcbiAgICB9XG5cbiAgICBnZXRUeXBlKCk6IE5vZGVUeXBlIHtcbiAgICAgICAgcmV0dXJuIHRoaXMudHlwZTtcbiAgICB9XG5cbiAgICBnZXRMYWJlbCgpOiBzdHJpbmcge1xuICAgICAgICByZXR1cm4gdGhpcy5sYWJlbDtcbiAgICB9XG5cbiAgICBzZXRMYWJlbChsYWJlbDogc3RyaW5nKTogdm9pZCB7XG4gICAgICAgIHRoaXMubGFiZWwgPSBsYWJlbDtcbiAgICB9XG5cbiAgICBnZXRWYXJpYWJsZU5hbWUoKTogc3RyaW5nIHwgdW5kZWZpbmVkIHtcbiAgICAgICAgcmV0dXJuIHRoaXMudmFyaWFibGVOYW1lO1xuICAgIH1cblxuICAgIHNldFZhcmlhYmxlTmFtZShuYW1lOiBzdHJpbmcpOiB2b2lkIHtcbiAgICAgICAgdGhpcy52YXJpYWJsZU5hbWUgPSBuYW1lO1xuICAgIH1cblxuICAgIGdldFVyaSgpOiBzdHJpbmcgfCB1bmRlZmluZWQge1xuICAgICAgICByZXR1cm4gdGhpcy51cmk7XG4gICAgfVxuXG4gICAgc2V0VXJpKHVyaTogc3RyaW5nKTogdm9pZCB7XG4gICAgICAgIHRoaXMudXJpID0gdXJpO1xuICAgIH1cblxuICAgIGdldFBvc2l0aW9uKCk6IE5vZGVQb3NpdGlvbiB7XG4gICAgICAgIHJldHVybiB7IC4uLnRoaXMucG9zaXRpb24gfTtcbiAgICB9XG5cbiAgICBzZXRQb3NpdGlvbihwb3NpdGlvbjogTm9kZVBvc2l0aW9uKTogdm9pZCB7XG4gICAgICAgIHRoaXMucG9zaXRpb24gPSB7IC4uLnBvc2l0aW9uIH07XG4gICAgfVxuXG4gICAgZ2V0RGltZW5zaW9ucygpOiBOb2RlRGltZW5zaW9ucyB7XG4gICAgICAgIHJldHVybiB7IC4uLnRoaXMuZGltZW5zaW9ucyB9O1xuICAgIH1cblxuICAgIHNldERpbWVuc2lvbnMoZGltZW5zaW9uczogTm9kZURpbWVuc2lvbnMpOiB2b2lkIHtcbiAgICAgICAgdGhpcy5kaW1lbnNpb25zID0geyAuLi5kaW1lbnNpb25zIH07XG4gICAgfVxuXG4gICAgaXNTZWxlY3RlZCgpOiBib29sZWFuIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuc2VsZWN0ZWQ7XG4gICAgfVxuXG4gICAgc2V0U2VsZWN0ZWQoc2VsZWN0ZWQ6IGJvb2xlYW4pOiB2b2lkIHtcbiAgICAgICAgdGhpcy5zZWxlY3RlZCA9IHNlbGVjdGVkO1xuICAgIH1cblxuICAgIGlzVmFsaWQoKTogYm9vbGVhbiB7XG4gICAgICAgIHJldHVybiB0aGlzLnZhbGlkO1xuICAgIH1cblxuICAgIHNldFZhbGlkKHZhbGlkOiBib29sZWFuLCBlcnJvcnM/OiBzdHJpbmdbXSk6IHZvaWQge1xuICAgICAgICB0aGlzLnZhbGlkID0gdmFsaWQ7XG4gICAgICAgIHRoaXMuZXJyb3JzID0gZXJyb3JzIHx8IFtdO1xuICAgIH1cblxuICAgIGdldEVycm9ycygpOiBzdHJpbmdbXSB7XG4gICAgICAgIHJldHVybiBbLi4udGhpcy5lcnJvcnNdO1xuICAgIH1cblxuICAgIGNvbnRhaW5zUG9pbnQoeDogbnVtYmVyLCB5OiBudW1iZXIpOiBib29sZWFuIHtcbiAgICAgICAgcmV0dXJuIHggPj0gdGhpcy5wb3NpdGlvbi54ICYmXG4gICAgICAgICAgICAgICB4IDw9IHRoaXMucG9zaXRpb24ueCArIHRoaXMuZGltZW5zaW9ucy53aWR0aCAmJlxuICAgICAgICAgICAgICAgeSA+PSB0aGlzLnBvc2l0aW9uLnkgJiZcbiAgICAgICAgICAgICAgIHkgPD0gdGhpcy5wb3NpdGlvbi55ICsgdGhpcy5kaW1lbnNpb25zLmhlaWdodDtcbiAgICB9XG5cbiAgICBnZXRDb25uZWN0aW9uUG9pbnRzKCk6IHsgdG9wOiBOb2RlUG9zaXRpb247IHJpZ2h0OiBOb2RlUG9zaXRpb247IGJvdHRvbTogTm9kZVBvc2l0aW9uOyBsZWZ0OiBOb2RlUG9zaXRpb24gfSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICB0b3A6IHtcbiAgICAgICAgICAgICAgICB4OiB0aGlzLnBvc2l0aW9uLnggKyB0aGlzLmRpbWVuc2lvbnMud2lkdGggLyAyLFxuICAgICAgICAgICAgICAgIHk6IHRoaXMucG9zaXRpb24ueVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHJpZ2h0OiB7XG4gICAgICAgICAgICAgICAgeDogdGhpcy5wb3NpdGlvbi54ICsgdGhpcy5kaW1lbnNpb25zLndpZHRoLFxuICAgICAgICAgICAgICAgIHk6IHRoaXMucG9zaXRpb24ueSArIHRoaXMuZGltZW5zaW9ucy5oZWlnaHQgLyAyXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgYm90dG9tOiB7XG4gICAgICAgICAgICAgICAgeDogdGhpcy5wb3NpdGlvbi54ICsgdGhpcy5kaW1lbnNpb25zLndpZHRoIC8gMixcbiAgICAgICAgICAgICAgICB5OiB0aGlzLnBvc2l0aW9uLnkgKyB0aGlzLmRpbWVuc2lvbnMuaGVpZ2h0XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgbGVmdDoge1xuICAgICAgICAgICAgICAgIHg6IHRoaXMucG9zaXRpb24ueCxcbiAgICAgICAgICAgICAgICB5OiB0aGlzLnBvc2l0aW9uLnkgKyB0aGlzLmRpbWVuc2lvbnMuaGVpZ2h0IC8gMlxuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgIH1cblxuICAgIHRvU1BBUlFMRWxlbWVudCgpOiBzdHJpbmcge1xuICAgICAgICBzd2l0Y2ggKHRoaXMudHlwZSkge1xuICAgICAgICAgICAgY2FzZSBOb2RlVHlwZS5FTlRJVFk6XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMudXJpKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBgPCR7dGhpcy51cml9PmA7XG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmICh0aGlzLnZhcmlhYmxlTmFtZSkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gYD8ke3RoaXMudmFyaWFibGVOYW1lfWA7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGA/JHt0aGlzLmxhYmVsLnRvTG93ZXJDYXNlKCkucmVwbGFjZSgvXFxzKy9nLCAnXycpfWA7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgY2FzZSBOb2RlVHlwZS5WQVJJQUJMRTpcbiAgICAgICAgICAgICAgICByZXR1cm4gYD8ke3RoaXMudmFyaWFibGVOYW1lIHx8IHRoaXMubGFiZWwudG9Mb3dlckNhc2UoKS5yZXBsYWNlKC9cXHMrL2csICdfJyl9YDtcbiAgICAgICAgICAgIGNhc2UgTm9kZVR5cGUuTElURVJBTDpcbiAgICAgICAgICAgICAgICByZXR1cm4gYFwiJHt0aGlzLmxhYmVsfVwiYDtcbiAgICAgICAgICAgIGNhc2UgTm9kZVR5cGUuRklMVEVSOlxuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmxhYmVsO1xuICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICByZXR1cm4gJz91bmtub3duJztcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGNsb25lKCk6IFZpc3VhbFF1ZXJ5Tm9kZSB7XG4gICAgICAgIHJldHVybiBuZXcgVmlzdWFsUXVlcnlOb2RlKHtcbiAgICAgICAgICAgIGlkOiBgJHt0aGlzLmlkfV9jbG9uZV8ke0RhdGUubm93KCl9YCxcbiAgICAgICAgICAgIHR5cGU6IHRoaXMudHlwZSxcbiAgICAgICAgICAgIGxhYmVsOiB0aGlzLmxhYmVsLFxuICAgICAgICAgICAgcG9zaXRpb246IHsgLi4udGhpcy5wb3NpdGlvbiB9LFxuICAgICAgICAgICAgdmFyaWFibGVOYW1lOiB0aGlzLnZhcmlhYmxlTmFtZSxcbiAgICAgICAgICAgIHVyaTogdGhpcy51cmksXG4gICAgICAgICAgICBkaW1lbnNpb25zOiB7IC4uLnRoaXMuZGltZW5zaW9ucyB9XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIHN0YXRpYyBjcmVhdGVFbnRpdHkobGFiZWw6IHN0cmluZywgdXJpPzogc3RyaW5nLCBwb3NpdGlvbj86IE5vZGVQb3NpdGlvbik6IFZpc3VhbFF1ZXJ5Tm9kZSB7XG4gICAgICAgIHJldHVybiBuZXcgVmlzdWFsUXVlcnlOb2RlKHtcbiAgICAgICAgICAgIGlkOiBgZW50aXR5XyR7RGF0ZS5ub3coKX1fJHtNYXRoLnJhbmRvbSgpLnRvU3RyaW5nKDM2KS5zdWJzdHIoMiwgOSl9YCxcbiAgICAgICAgICAgIHR5cGU6IE5vZGVUeXBlLkVOVElUWSxcbiAgICAgICAgICAgIGxhYmVsLFxuICAgICAgICAgICAgdXJpLFxuICAgICAgICAgICAgcG9zaXRpb246IHBvc2l0aW9uIHx8IHsgeDogMCwgeTogMCB9XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIHN0YXRpYyBjcmVhdGVWYXJpYWJsZShuYW1lOiBzdHJpbmcsIHBvc2l0aW9uPzogTm9kZVBvc2l0aW9uKTogVmlzdWFsUXVlcnlOb2RlIHtcbiAgICAgICAgcmV0dXJuIG5ldyBWaXN1YWxRdWVyeU5vZGUoe1xuICAgICAgICAgICAgaWQ6IGB2YXJfJHtEYXRlLm5vdygpfV8ke01hdGgucmFuZG9tKCkudG9TdHJpbmcoMzYpLnN1YnN0cigyLCA5KX1gLFxuICAgICAgICAgICAgdHlwZTogTm9kZVR5cGUuVkFSSUFCTEUsXG4gICAgICAgICAgICBsYWJlbDogbmFtZSxcbiAgICAgICAgICAgIHZhcmlhYmxlTmFtZTogbmFtZSxcbiAgICAgICAgICAgIHBvc2l0aW9uOiBwb3NpdGlvbiB8fCB7IHg6IDAsIHk6IDAgfVxuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBzdGF0aWMgY3JlYXRlTGl0ZXJhbCh2YWx1ZTogc3RyaW5nLCBwb3NpdGlvbj86IE5vZGVQb3NpdGlvbik6IFZpc3VhbFF1ZXJ5Tm9kZSB7XG4gICAgICAgIHJldHVybiBuZXcgVmlzdWFsUXVlcnlOb2RlKHtcbiAgICAgICAgICAgIGlkOiBgbGl0ZXJhbF8ke0RhdGUubm93KCl9XyR7TWF0aC5yYW5kb20oKS50b1N0cmluZygzNikuc3Vic3RyKDIsIDkpfWAsXG4gICAgICAgICAgICB0eXBlOiBOb2RlVHlwZS5MSVRFUkFMLFxuICAgICAgICAgICAgbGFiZWw6IHZhbHVlLFxuICAgICAgICAgICAgcG9zaXRpb246IHBvc2l0aW9uIHx8IHsgeDogMCwgeTogMCB9XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIHN0YXRpYyBjcmVhdGVGaWx0ZXIoZXhwcmVzc2lvbjogc3RyaW5nLCBwb3NpdGlvbj86IE5vZGVQb3NpdGlvbik6IFZpc3VhbFF1ZXJ5Tm9kZSB7XG4gICAgICAgIHJldHVybiBuZXcgVmlzdWFsUXVlcnlOb2RlKHtcbiAgICAgICAgICAgIGlkOiBgZmlsdGVyXyR7RGF0ZS5ub3coKX1fJHtNYXRoLnJhbmRvbSgpLnRvU3RyaW5nKDM2KS5zdWJzdHIoMiwgOSl9YCxcbiAgICAgICAgICAgIHR5cGU6IE5vZGVUeXBlLkZJTFRFUixcbiAgICAgICAgICAgIGxhYmVsOiBleHByZXNzaW9uLFxuICAgICAgICAgICAgcG9zaXRpb246IHBvc2l0aW9uIHx8IHsgeDogMCwgeTogMCB9LFxuICAgICAgICAgICAgZGltZW5zaW9uczogeyB3aWR0aDogMjAwLCBoZWlnaHQ6IDgwIH1cbiAgICAgICAgfSk7XG4gICAgfVxufSJdLCJ2ZXJzaW9uIjozfQ==