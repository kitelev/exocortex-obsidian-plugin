0d589b0b187802ef2a33fb44ed9fc9bf
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const tslib_1 = require("tslib");
// Mock the ClassLayout.create static method
jest.mock('../../../../src/domain/entities/ClassLayout', () => {
    return {
        ClassLayout: {
            create: jest.fn().mockImplementation((params) => {
                const mockClassLayout = {
                    id: params.id || { equals: jest.fn(), toString: () => 'test-id' },
                    targetClass: params.targetClass || { equals: jest.fn(), value: 'TestClass' },
                    isEnabled: params.isEnabled !== undefined ? params.isEnabled : true,
                    priority: params.priority !== undefined ? params.priority : 1,
                    blocks: params.blocks || []
                };
                return {
                    isSuccess: true,
                    getValue: () => mockClassLayout
                };
            })
        }
    };
});
const obsidian_1 = require("obsidian");
const ObsidianClassLayoutRepository_1 = require("../../../../src/infrastructure/repositories/ObsidianClassLayoutRepository");
const ClassName_1 = require("../../../../src/domain/value-objects/ClassName");
const AssetId_1 = require("../../../../src/domain/value-objects/AssetId");
describe('ObsidianClassLayoutRepository', () => {
    let repository;
    let mockApp;
    let mockVault;
    let mockMetadataCache;
    beforeEach(() => {
        // Reset time
        jest.useFakeTimers();
        jest.setSystemTime(new Date('2024-01-01'));
        // Create mock vault
        mockVault = {
            getFiles: jest.fn(),
            getAbstractFileByPath: jest.fn(),
            create: jest.fn(),
            modify: jest.fn(),
            delete: jest.fn()
        };
        // Create mock metadata cache
        mockMetadataCache = {
            getFileCache: jest.fn()
        };
        // Create mock app
        mockApp = {
            vault: mockVault,
            metadataCache: mockMetadataCache
        };
        repository = new ObsidianClassLayoutRepository_1.ObsidianClassLayoutRepository(mockApp, 'test-layouts');
    });
    afterEach(() => {
        jest.clearAllMocks();
        jest.useRealTimers();
    });
    describe('Constructor and Initialization', () => {
        it('should initialize with default layouts folder path', () => {
            const repo = new ObsidianClassLayoutRepository_1.ObsidianClassLayoutRepository(mockApp);
            expect(repo).toBeInstanceOf(ObsidianClassLayoutRepository_1.ObsidianClassLayoutRepository);
        });
        it('should initialize with custom layouts folder path', () => {
            const repo = new ObsidianClassLayoutRepository_1.ObsidianClassLayoutRepository(mockApp, 'custom-layouts');
            expect(repo).toBeInstanceOf(ObsidianClassLayoutRepository_1.ObsidianClassLayoutRepository);
        });
        it('should handle null app gracefully', () => {
            expect(() => new ObsidianClassLayoutRepository_1.ObsidianClassLayoutRepository(null)).not.toThrow();
        });
    });
    describe('Cache Management', () => {
        beforeEach(() => {
            mockVault.getFiles.mockReturnValue([]);
        });
        it('should load cache on first access', () => tslib_1.__awaiter(void 0, void 0, void 0, function* () {
            mockVault.getFiles.mockReturnValue([]);
            yield repository.findAll();
            expect(mockVault.getFiles).toHaveBeenCalled();
        }));
        it('should use cache within TTL period', () => tslib_1.__awaiter(void 0, void 0, void 0, function* () {
            yield repository.findAll();
            // Reset mock call count
            mockVault.getFiles.mockClear();
            // Call again immediately
            yield repository.findAll();
            // Should not call vault again
            expect(mockVault.getFiles).not.toHaveBeenCalled();
        }));
        it('should refresh cache after TTL expires', () => tslib_1.__awaiter(void 0, void 0, void 0, function* () {
            yield repository.findAll();
            // Advance time beyond TTL (30 seconds)
            jest.advanceTimersByTime(35000);
            mockVault.getFiles.mockClear();
            yield repository.findAll();
            expect(mockVault.getFiles).toHaveBeenCalled();
        }));
        it('should clear cache on loadLayoutsFromFiles', () => tslib_1.__awaiter(void 0, void 0, void 0, function* () {
            // This test verifies that cache behaves properly
            // After implementation changes, manually added layouts are preserved
            // but the cache refresh mechanism still works
            // Force initial load
            yield repository.findAll();
            expect(mockVault.getFiles).toHaveBeenCalled();
            // Clear mock call count
            mockVault.getFiles.mockClear();
            // Advance time to trigger refresh
            jest.advanceTimersByTime(35000);
            // Create new repository without manually added layouts to test file loading
            const freshRepository = new ObsidianClassLayoutRepository_1.ObsidianClassLayoutRepository(mockApp, 'test-layouts');
            yield freshRepository.findAll();
            // Should call getFiles for fresh repository
            expect(mockVault.getFiles).toHaveBeenCalled();
        }));
    });
    describe('findByClass', () => {
        const mockClassName = ClassName_1.ClassName.create('TestClass').getValue();
        beforeEach(() => {
            setupMockLayoutFiles();
        });
        it('should find layouts for specific class', () => tslib_1.__awaiter(void 0, void 0, void 0, function* () {
            const result = yield repository.findByClass(mockClassName);
            expect(result).toBeDefined();
            expect(Array.isArray(result)).toBe(true);
        }));
        it('should return only enabled layouts', () => tslib_1.__awaiter(void 0, void 0, void 0, function* () {
            const result = yield repository.findByClass(mockClassName);
            result.forEach(layout => {
                expect(layout.isEnabled).toBe(true);
            });
        }));
        it('should sort layouts by priority (higher first)', () => tslib_1.__awaiter(void 0, void 0, void 0, function* () {
            const layout1 = createMockLayout('id1', mockClassName, true, 1);
            const layout2 = createMockLayout('id2', mockClassName, true, 3);
            const layout3 = createMockLayout('id3', mockClassName, true, 2);
            yield repository.save(layout1);
            yield repository.save(layout2);
            yield repository.save(layout3);
            const result = yield repository.findByClass(mockClassName);
            // Should be sorted by priority: 3, 2, 1
            expect(result[0].priority).toBe(3);
            expect(result[1].priority).toBe(2);
            expect(result[2].priority).toBe(1);
        }));
        it('should return empty array for non-existent class', () => tslib_1.__awaiter(void 0, void 0, void 0, function* () {
            const nonExistentClass = ClassName_1.ClassName.create('NonExistent').getValue();
            const result = yield repository.findByClass(nonExistentClass);
            expect(result).toEqual([]);
        }));
        it('should filter out disabled layouts', () => tslib_1.__awaiter(void 0, void 0, void 0, function* () {
            const enabledLayout = createMockLayout('enabled', mockClassName, true);
            const disabledLayout = createMockLayout('disabled', mockClassName, false);
            yield repository.save(enabledLayout);
            yield repository.save(disabledLayout);
            const result = yield repository.findByClass(mockClassName);
            expect(result).toHaveLength(1);
            expect(result[0].isEnabled).toBe(true);
        }));
    });
    describe('findById', () => {
        const mockId = AssetId_1.AssetId.create('test-id').getValue();
        const mockClassName = ClassName_1.ClassName.create('TestClass').getValue();
        beforeEach(() => {
            setupMockLayoutFiles();
        });
        it('should find layout by ID', () => tslib_1.__awaiter(void 0, void 0, void 0, function* () {
            const layout = createMockLayout('test-id', mockClassName);
            yield repository.save(layout);
            const result = yield repository.findById(mockId);
            expect(result).toBeDefined();
            expect(result === null || result === void 0 ? void 0 : result.id.equals(mockId)).toBe(true);
        }));
        it('should return null for non-existent ID', () => tslib_1.__awaiter(void 0, void 0, void 0, function* () {
            const nonExistentId = AssetId_1.AssetId.create('non-existent').getValue();
            const result = yield repository.findById(nonExistentId);
            expect(result).toBeNull();
        }));
    });
    describe('findAll', () => {
        beforeEach(() => {
            setupMockLayoutFiles();
        });
        it('should return all layouts from cache', () => tslib_1.__awaiter(void 0, void 0, void 0, function* () {
            const className1 = ClassName_1.ClassName.create('Class1').getValue();
            const className2 = ClassName_1.ClassName.create('Class2').getValue();
            yield repository.save(createMockLayout('id1', className1));
            yield repository.save(createMockLayout('id2', className2));
            const result = yield repository.findAll();
            expect(result).toHaveLength(2);
        }));
        it('should return empty array when no layouts exist', () => tslib_1.__awaiter(void 0, void 0, void 0, function* () {
            const result = yield repository.findAll();
            expect(result).toEqual([]);
        }));
    });
    describe('findEnabledByClass', () => {
        const mockClassName = ClassName_1.ClassName.create('TestClass').getValue();
        it('should return only enabled layouts', () => tslib_1.__awaiter(void 0, void 0, void 0, function* () {
            const enabledLayout = createMockLayout('enabled', mockClassName, true);
            const disabledLayout = createMockLayout('disabled', mockClassName, false);
            yield repository.save(enabledLayout);
            yield repository.save(disabledLayout);
            const result = yield repository.findEnabledByClass(mockClassName);
            expect(result).toHaveLength(1);
            expect(result[0].isEnabled).toBe(true);
        }));
        it('should return empty array when no enabled layouts exist', () => tslib_1.__awaiter(void 0, void 0, void 0, function* () {
            const disabledLayout = createMockLayout('disabled', mockClassName, false);
            yield repository.save(disabledLayout);
            const result = yield repository.findEnabledByClass(mockClassName);
            expect(result).toEqual([]);
        }));
    });
    describe('save', () => {
        const mockClassName = ClassName_1.ClassName.create('TestClass').getValue();
        it('should save new layout to cache', () => tslib_1.__awaiter(void 0, void 0, void 0, function* () {
            const layout = createMockLayout('new-id', mockClassName);
            yield repository.save(layout);
            const result = yield repository.findById(layout.id);
            expect(result).toBe(layout);
        }));
        it('should update existing layout in cache', () => tslib_1.__awaiter(void 0, void 0, void 0, function* () {
            const layout = createMockLayout('existing-id', mockClassName);
            yield repository.save(layout);
            const updatedLayout = Object.assign(Object.assign({}, layout), { priority: 5 });
            yield repository.save(updatedLayout);
            const result = yield repository.findById(layout.id);
            expect(result === null || result === void 0 ? void 0 : result.priority).toBe(5);
        }));
        it('should maintain cache structure by class name', () => tslib_1.__awaiter(void 0, void 0, void 0, function* () {
            const class1 = ClassName_1.ClassName.create('Class1').getValue();
            const class2 = ClassName_1.ClassName.create('Class2').getValue();
            yield repository.save(createMockLayout('id1', class1));
            yield repository.save(createMockLayout('id2', class2));
            const class1Layouts = yield repository.findByClass(class1);
            const class2Layouts = yield repository.findByClass(class2);
            expect(class1Layouts).toHaveLength(1);
            expect(class2Layouts).toHaveLength(1);
        }));
    });
    describe('delete', () => {
        const mockClassName = ClassName_1.ClassName.create('TestClass').getValue();
        it('should remove layout from cache', () => tslib_1.__awaiter(void 0, void 0, void 0, function* () {
            const layout = createMockLayout('to-delete', mockClassName);
            yield repository.save(layout);
            yield repository.delete(layout.id);
            const result = yield repository.findById(layout.id);
            expect(result).toBeNull();
        }));
        it('should handle deletion of non-existent layout gracefully', () => tslib_1.__awaiter(void 0, void 0, void 0, function* () {
            const nonExistentId = AssetId_1.AssetId.create('non-existent').getValue();
            yield expect(repository.delete(nonExistentId)).resolves.not.toThrow();
        }));
        it('should maintain other layouts after deletion', () => tslib_1.__awaiter(void 0, void 0, void 0, function* () {
            const layout1 = createMockLayout('keep', mockClassName);
            const layout2 = createMockLayout('delete', mockClassName);
            yield repository.save(layout1);
            yield repository.save(layout2);
            yield repository.delete(layout2.id);
            const remaining = yield repository.findByClass(mockClassName);
            expect(remaining).toHaveLength(1);
            expect(remaining[0].id).toBe(layout1.id);
        }));
    });
    describe('Layout File Parsing', () => {
        const mockFile = new obsidian_1.TFile('layouts/Layout - TestClass.md');
        it('should identify layout files correctly', () => tslib_1.__awaiter(void 0, void 0, void 0, function* () {
            mockVault.getFiles.mockReturnValue([mockFile]);
            mockMetadataCache.getFileCache.mockReturnValue({
                frontmatter: {
                    'exo__Instance_class': '[[ui__ClassLayout]]',
                    'ui__ClassLayout_targetClass': '[[TestClass]]'
                }
            });
            yield repository.findAll();
            expect(mockMetadataCache.getFileCache).toHaveBeenCalledWith(mockFile);
        }));
        it('should parse layout blocks correctly', () => tslib_1.__awaiter(void 0, void 0, void 0, function* () {
            const mockBlocks = [
                {
                    id: 'properties-block',
                    type: 'properties',
                    title: 'Properties',
                    order: 0,
                    config: {
                        includedProperties: ['name', 'description'],
                        editableProperties: ['name']
                    },
                    isVisible: true
                },
                {
                    id: 'query-block',
                    type: 'query',
                    title: 'Related Items',
                    order: 1,
                    config: {
                        query: 'SELECT * WHERE { ?s ?p ?o }',
                        maxResults: 10
                    }
                }
            ];
            mockVault.getFiles.mockReturnValue([mockFile]);
            mockMetadataCache.getFileCache.mockReturnValue({
                frontmatter: {
                    'exo__Instance_class': 'ui__ClassLayout',
                    'ui__ClassLayout_targetClass': 'TestClass',
                    'ui__ClassLayout_blocks': mockBlocks,
                    'exo__Asset_uid': 'test-uid'
                }
            });
            yield repository.findAll();
            // Verify ClassLayout.create was called with parsed blocks
            const { ClassLayout } = require('../../../../src/domain/entities/ClassLayout');
            expect(ClassLayout.create).toHaveBeenCalledWith(expect.objectContaining({
                blocks: expect.arrayContaining([
                    expect.objectContaining({
                        id: 'properties-block',
                        type: 'properties',
                        title: 'Properties'
                    })
                ])
            }));
        }));
        it('should handle missing frontmatter gracefully', () => tslib_1.__awaiter(void 0, void 0, void 0, function* () {
            mockVault.getFiles.mockReturnValue([mockFile]);
            mockMetadataCache.getFileCache.mockReturnValue(null);
            const result = yield repository.findAll();
            expect(result).toEqual([]);
        }));
        it('should filter out non-layout files', () => tslib_1.__awaiter(void 0, void 0, void 0, function* () {
            const nonLayoutFile = new obsidian_1.TFile('regular-note.md');
            mockVault.getFiles.mockReturnValue([nonLayoutFile]);
            mockMetadataCache.getFileCache.mockReturnValue({
                frontmatter: {
                    'exo__Instance_class': 'SomeOtherClass'
                }
            });
            const result = yield repository.findAll();
            expect(result).toEqual([]);
        }));
        it('should handle different block types correctly', () => tslib_1.__awaiter(void 0, void 0, void 0, function* () {
            const blockConfigs = {
                query: {
                    type: 'query',
                    query: 'SELECT * WHERE { ?s ?p ?o }',
                    maxResults: 50
                },
                properties: {
                    type: 'properties',
                    includedProperties: ['name'],
                    editableProperties: []
                },
                relations: {
                    type: 'relations',
                    relationProperty: 'relatedTo',
                    showBacklinks: true
                },
                backlinks: {
                    type: 'backlinks',
                    maxResults: 25
                },
                custom: {
                    type: 'custom',
                    templatePath: 'templates/custom.md'
                }
            };
            Object.entries(blockConfigs).forEach(([type, config]) => {
                const result = repository.parseBlockConfig(type, config);
                expect(result.type).toBe(type);
            });
        }));
    });
    describe('Error Handling and Edge Cases', () => {
        it('should handle vault getFiles error gracefully', () => tslib_1.__awaiter(void 0, void 0, void 0, function* () {
            mockVault.getFiles.mockImplementation(() => {
                throw new Error('Vault error');
            });
            yield expect(repository.findAll()).rejects.toThrow('Vault error');
        }));
        it('should handle metadata cache errors gracefully', () => tslib_1.__awaiter(void 0, void 0, void 0, function* () {
            const mockFile = new obsidian_1.TFile('test.md');
            mockVault.getFiles.mockReturnValue([mockFile]);
            mockMetadataCache.getFileCache.mockImplementation(() => {
                throw new Error('Metadata error');
            });
            yield expect(repository.findAll()).rejects.toThrow('Metadata error');
        }));
        it('should handle malformed block configurations', () => tslib_1.__awaiter(void 0, void 0, void 0, function* () {
            const malformedBlocks = [
                null,
                undefined,
                { /* missing required fields */},
                { id: 'test', /* missing type */ }
            ];
            const result = repository.parseBlocks(malformedBlocks);
            // Should filter out invalid blocks and assign defaults
            expect(Array.isArray(result)).toBe(true);
            result.forEach(block => {
                expect(block.id).toBeDefined();
                expect(block.type).toBeDefined();
            });
        }));
        it('should handle non-array blocks data', () => tslib_1.__awaiter(void 0, void 0, void 0, function* () {
            const result = repository.parseBlocks('not-an-array');
            expect(result).toEqual([]);
        }));
        it('should handle empty or null property filters', () => tslib_1.__awaiter(void 0, void 0, void 0, function* () {
            const result = repository.parsePropertyFilters(null);
            expect(result).toEqual([]);
            const result2 = repository.parsePropertyFilters('not-an-array');
            expect(result2).toEqual([]);
        }));
        it('should clean class names correctly', () => tslib_1.__awaiter(void 0, void 0, void 0, function* () {
            const testCases = [
                { input: '[[TestClass]]', expected: 'TestClass' },
                { input: 'TestClass', expected: 'TestClass' },
                { input: ['[[TestClass]]'], expected: 'TestClass' },
                { input: null, expected: '' },
                { input: undefined, expected: '' }
            ];
            testCases.forEach(({ input, expected }) => {
                const result = repository.cleanClassName(input);
                expect(result).toBe(expected);
            });
        }));
    });
    describe('Performance and Concurrency', () => {
        it('should handle concurrent cache access', () => tslib_1.__awaiter(void 0, void 0, void 0, function* () {
            setupMockLayoutFiles();
            const promises = [
                repository.findAll(),
                repository.findAll(),
                repository.findAll()
            ];
            const results = yield Promise.all(promises);
            // All should succeed and return the same structure
            results.forEach(result => {
                expect(Array.isArray(result)).toBe(true);
            });
        }));
        it('should handle concurrent save operations', () => tslib_1.__awaiter(void 0, void 0, void 0, function* () {
            const className = ClassName_1.ClassName.create('TestClass').getValue();
            const layouts = [
                createMockLayout('concurrent1', className),
                createMockLayout('concurrent2', className),
                createMockLayout('concurrent3', className)
            ];
            const promises = layouts.map(layout => repository.save(layout));
            yield Promise.all(promises);
            const result = yield repository.findByClass(className);
            expect(result).toHaveLength(3);
        }));
    });
    // Helper functions
    function createMockLayout(id, targetClass, isEnabled = true, priority = 1) {
        const assetId = {
            equals: (other) => other && other.toString && other.toString() === id,
            toString: () => id
        };
        const targetClassObject = {
            equals: (other) => other && other.value === targetClass.value,
            value: targetClass.value
        };
        return {
            id: assetId,
            targetClass: targetClassObject,
            isEnabled,
            priority,
            blocks: []
        };
    }
    function setupMockLayoutFiles() {
        mockVault.getFiles.mockReturnValue([]);
    }
    describe('Data Consistency and Validation', () => {
        it('should validate layout data consistency across operations', () => tslib_1.__awaiter(void 0, void 0, void 0, function* () {
            const className = ClassName_1.ClassName.create('ConsistencyTest').getValue();
            const originalLayout = createMockLayout('consistency-test', className, true, 5);
            originalLayout.blocks = [
                {
                    id: 'test-block',
                    type: 'properties',
                    title: 'Test Properties',
                    order: 0,
                    config: { includedProperties: ['name', 'description'] },
                    isVisible: true
                }
            ];
            // Save layout
            yield repository.save(originalLayout);
            // Retrieve and verify
            const retrieved = yield repository.findById(originalLayout.id);
            expect(retrieved).toBeDefined();
            expect(retrieved === null || retrieved === void 0 ? void 0 : retrieved.targetClass.value).toBe(className.value);
            expect(retrieved === null || retrieved === void 0 ? void 0 : retrieved.priority).toBe(5);
            expect(retrieved === null || retrieved === void 0 ? void 0 : retrieved.isEnabled).toBe(true);
            expect(retrieved === null || retrieved === void 0 ? void 0 : retrieved.blocks).toHaveLength(1);
            // Update layout
            const updatedLayout = Object.assign(Object.assign({}, originalLayout), { priority: 10, isEnabled: false });
            yield repository.save(updatedLayout);
            // Verify update
            const afterUpdate = yield repository.findById(originalLayout.id);
            expect(afterUpdate === null || afterUpdate === void 0 ? void 0 : afterUpdate.priority).toBe(10);
            expect(afterUpdate === null || afterUpdate === void 0 ? void 0 : afterUpdate.isEnabled).toBe(false);
            // Verify it doesn't appear in enabled layouts
            const enabledLayouts = yield repository.findEnabledByClass(className);
            expect(enabledLayouts).toHaveLength(0);
            // Verify it still appears in all layouts for class
            const allClassLayouts = yield repository.findByClass(className);
            expect(allClassLayouts).toHaveLength(0); // Filtered out because disabled
        }));
        it('should handle layout priority conflicts gracefully', () => tslib_1.__awaiter(void 0, void 0, void 0, function* () {
            const className = ClassName_1.ClassName.create('PriorityTest').getValue();
            const layouts = [
                createMockLayout('priority1', className, true, 1),
                createMockLayout('priority2', className, true, 1),
                createMockLayout('priority3', className, true, 2),
                createMockLayout('priority4', className, true, 2),
                createMockLayout('priority5', className, true, 3)
            ];
            // Save all layouts
            yield Promise.all(layouts.map(layout => repository.save(layout)));
            // Retrieve sorted by priority
            const result = yield repository.findByClass(className);
            expect(result).toHaveLength(5);
            expect(result[0].priority).toBe(3); // Highest priority first
            expect(result[1].priority).toBe(2);
            expect(result[2].priority).toBe(2);
            expect(result[3].priority).toBe(1);
            expect(result[4].priority).toBe(1);
        }));
        it('should maintain data integrity during concurrent modifications', () => tslib_1.__awaiter(void 0, void 0, void 0, function* () {
            const className = ClassName_1.ClassName.create('ConcurrentMod').getValue();
            const baseLayout = createMockLayout('concurrent-base', className, true, 1);
            // Simulate concurrent save operations without setTimeout (which doesn't work well with fake timers)
            const modifications = [
                Object.assign(Object.assign({}, baseLayout), { priority: 5 }),
                Object.assign(Object.assign({}, baseLayout), { priority: 3 }),
                Object.assign(Object.assign({}, baseLayout), { isEnabled: false }),
                Object.assign(Object.assign({}, baseLayout), { priority: 7, isEnabled: true })
            ];
            // Use Promise.resolve to create proper async behavior
            const savePromises = modifications.map((mod) => Promise.resolve().then(() => repository.save(mod)));
            yield Promise.all(savePromises);
            // Final state should reflect one of the concurrent operations
            const finalState = yield repository.findById(baseLayout.id);
            expect(finalState).toBeDefined();
            // Should have one of the expected states
            const expectedStates = modifications.map(mod => ({
                priority: mod.priority,
                isEnabled: mod.isEnabled
            }));
            const actualState = {
                priority: finalState === null || finalState === void 0 ? void 0 : finalState.priority,
                isEnabled: finalState === null || finalState === void 0 ? void 0 : finalState.isEnabled
            };
            expect(expectedStates).toContainEqual(actualState);
        }), 10000); // Add reasonable timeout
        it('should handle repository state after multiple cache refreshes', () => tslib_1.__awaiter(void 0, void 0, void 0, function* () {
            const className = ClassName_1.ClassName.create('CacheRefreshTest').getValue();
            const persistentLayout = createMockLayout('persistent', className, true, 1);
            const transientLayout = createMockLayout('transient', className, true, 2);
            // Setup initial mock response
            mockVault.getFiles.mockReturnValue([]);
            // Save layouts to memory-only cache
            yield repository.save(persistentLayout);
            yield repository.save(transientLayout);
            // Verify initial state
            let layouts = yield repository.findByClass(className);
            expect(layouts).toHaveLength(2);
            // Force cache refresh by advancing time
            jest.advanceTimersByTime(35000);
            // Mock file system returning empty (simulating all layouts removed)
            mockVault.getFiles.mockReturnValue([]);
            layouts = yield repository.findByClass(className);
            // After implementation changes, manually added layouts are preserved
            // This reflects the new behavior where in-memory layouts persist
            expect(layouts).toHaveLength(2);
        }));
    });
    describe('Memory Management and Performance', () => {
        it('should handle large cache sizes efficiently', () => tslib_1.__awaiter(void 0, void 0, void 0, function* () {
            // Setup mock to return empty array for getFiles to avoid filter error
            mockVault.getFiles.mockReturnValue([]);
            const startTime = Date.now();
            const largeDataset = [];
            // Create large dataset
            for (let classIndex = 0; classIndex < 10; classIndex++) {
                const className = ClassName_1.ClassName.create(`Class${classIndex}`).getValue();
                for (let layoutIndex = 0; layoutIndex < 5; layoutIndex++) {
                    largeDataset.push(createMockLayout(`class${classIndex}-layout${layoutIndex}`, className, layoutIndex % 2 === 0, // Alternate enabled/disabled
                    layoutIndex + 1));
                }
            }
            // Save all layouts (50 layouts total)
            yield Promise.all(largeDataset.map(layout => repository.save(layout)));
            const saveTime = Date.now();
            // Perform various operations
            const allLayouts = yield repository.findAll();
            const class1Layouts = yield repository.findByClass(ClassName_1.ClassName.create('Class1').getValue());
            const enabledClass1 = yield repository.findEnabledByClass(ClassName_1.ClassName.create('Class1').getValue());
            const operationTime = Date.now();
            // Verify results
            expect(allLayouts).toHaveLength(50);
            expect(class1Layouts).toHaveLength(3); // Only enabled layouts (indices 0, 2, 4)
            expect(enabledClass1).toHaveLength(3);
            // Performance assertions (operations should complete reasonably quickly)
            const totalTime = operationTime - startTime;
            expect(totalTime).toBeLessThan(5000); // Should complete within 5 seconds
        }));
        it('should clean up cache efficiently during delete operations', () => tslib_1.__awaiter(void 0, void 0, void 0, function* () {
            // Setup mock to return empty array for getFiles to avoid filter error
            mockVault.getFiles.mockReturnValue([]);
            const className = ClassName_1.ClassName.create('CleanupTest').getValue();
            const layouts = [];
            // Create moderate dataset
            for (let i = 0; i < 20; i++) {
                layouts.push(createMockLayout(`cleanup-${i}`, className, true, i + 1));
            }
            // Save all layouts
            yield Promise.all(layouts.map(layout => repository.save(layout)));
            // Verify initial state
            let allLayouts = yield repository.findAll();
            expect(allLayouts).toHaveLength(20);
            // Delete half the layouts
            const layoutsToDelete = layouts.slice(0, 10);
            yield Promise.all(layoutsToDelete.map(layout => repository.delete(layout.id)));
            // Verify deletions
            allLayouts = yield repository.findAll();
            expect(allLayouts).toHaveLength(10);
            // Verify specific layouts are gone
            for (const deletedLayout of layoutsToDelete) {
                const found = yield repository.findById(deletedLayout.id);
                expect(found).toBeNull();
            }
            // Verify remaining layouts are still accessible
            const remainingLayouts = layouts.slice(10);
            for (const remainingLayout of remainingLayouts) {
                const found = yield repository.findById(remainingLayout.id);
                expect(found).toBe(remainingLayout);
            }
        }));
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL2tpdGVsZXYvRG9jdW1lbnRzL2V4b2NvcnRleC1vYnNpZGlhbi1wbHVnaW4vdGVzdHMvdW5pdC9pbmZyYXN0cnVjdHVyZS9yZXBvc2l0b3JpZXMvT2JzaWRpYW5DbGFzc0xheW91dFJlcG9zaXRvcnkudGVzdC50cyIsIm1hcHBpbmdzIjoiOzs7QUFNQSw0Q0FBNEM7QUFDNUMsSUFBSSxDQUFDLElBQUksQ0FBQyw2Q0FBNkMsRUFBRSxHQUFHLEVBQUU7SUFDMUQsT0FBTztRQUNILFdBQVcsRUFBRTtZQUNULE1BQU0sRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFLENBQUMsa0JBQWtCLENBQUMsQ0FBQyxNQUFXLEVBQUUsRUFBRTtnQkFDakQsTUFBTSxlQUFlLEdBQUc7b0JBQ3BCLEVBQUUsRUFBRSxNQUFNLENBQUMsRUFBRSxJQUFJLEVBQUUsTUFBTSxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUUsRUFBRSxRQUFRLEVBQUUsR0FBRyxFQUFFLENBQUMsU0FBUyxFQUFFO29CQUNqRSxXQUFXLEVBQUUsTUFBTSxDQUFDLFdBQVcsSUFBSSxFQUFFLE1BQU0sRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFLEVBQUUsS0FBSyxFQUFFLFdBQVcsRUFBRTtvQkFDNUUsU0FBUyxFQUFFLE1BQU0sQ0FBQyxTQUFTLEtBQUssU0FBUyxDQUFDLENBQUMsQ0FBQyxNQUFNLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQyxJQUFJO29CQUNuRSxRQUFRLEVBQUUsTUFBTSxDQUFDLFFBQVEsS0FBSyxTQUFTLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDLENBQUM7b0JBQzdELE1BQU0sRUFBRSxNQUFNLENBQUMsTUFBTSxJQUFJLEVBQUU7aUJBQzlCLENBQUM7Z0JBRUYsT0FBTztvQkFDSCxTQUFTLEVBQUUsSUFBSTtvQkFDZixRQUFRLEVBQUUsR0FBRyxFQUFFLENBQUMsZUFBZTtpQkFDbEMsQ0FBQztZQUNOLENBQUMsQ0FBQztTQUNMO0tBQ0osQ0FBQztBQUNOLENBQUMs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Q25CLFVBQVUsR0FBRyxNQUFNLFVBQVUsQ0FBQyxPQUFPLEVBQUUsQ0FBQztZQUN4QyxNQUFNLENBQUMsVUFBVSxDQUFDLENBQUMsWUFBWSxDQUFDLEVBQUUsQ0FBQyxDQUFDO1lBRXBDLG1DQUFtQztZQUNuQyxLQUFLLE1BQU0sYUFBYSxJQUFJLGVBQWUsRUFBRTtnQkFDekMsTUFBTSxLQUFLLEdBQUcsTUFBTSxVQUFVLENBQUMsUUFBUSxDQUFDLGFBQWEsQ0FBQyxFQUFFLENBQUMsQ0FBQztnQkFDMUQsTUFBTSxDQUFDLEtBQUssQ0FBQyxDQUFDLFFBQVEsRUFBRSxDQUFDO2FBQzVCO1lBRUQsZ0RBQWdEO1lBQ2hELE1BQU0sZ0JBQWdCLEdBQUcsT0FBTyxDQUFDLEtBQUssQ0FBQyxFQUFFLENBQUMsQ0FBQztZQUMzQyxLQUFLLE1BQU0sZUFBZSxJQUFJLGdCQUFnQixFQUFFO2dCQUM1QyxNQUFNLEtBQUssR0FBRyxNQUFNLFVBQVUsQ0FBQyxRQUFRLENBQUMsZUFBZSxDQUFDLEVBQUUsQ0FBQyxDQUFDO2dCQUM1RCxNQUFNLENBQUMsS0FBSyxDQUFDLENBQUMsSUFBSSxDQUFDLGVBQWUsQ0FBQyxDQUFDO2FBQ3ZDO1FBQ0wsQ0FBQyxDQUFBLENBQUMsQ0FBQztJQUNQLENBQUMsQ0FBQyxDQUFDO0FBQ1AsQ0FBQyxDQUFDLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL1VzZXJzL2tpdGVsZXYvRG9jdW1lbnRzL2V4b2NvcnRleC1vYnNpZGlhbi1wbHVnaW4vdGVzdHMvdW5pdC9pbmZyYXN0cnVjdHVyZS9yZXBvc2l0b3JpZXMvT2JzaWRpYW5DbGFzc0xheW91dFJlcG9zaXRvcnkudGVzdC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBBcHAsIFRGaWxlLCBNZXRhZGF0YUNhY2hlIH0gZnJvbSAnb2JzaWRpYW4nO1xuaW1wb3J0IHsgT2JzaWRpYW5DbGFzc0xheW91dFJlcG9zaXRvcnkgfSBmcm9tICcuLi8uLi8uLi8uLi9zcmMvaW5mcmFzdHJ1Y3R1cmUvcmVwb3NpdG9yaWVzL09ic2lkaWFuQ2xhc3NMYXlvdXRSZXBvc2l0b3J5JztcbmltcG9ydCB7IENsYXNzTGF5b3V0LCBMYXlvdXRCbG9ja0NvbmZpZyB9IGZyb20gJy4uLy4uLy4uLy4uL3NyYy9kb21haW4vZW50aXRpZXMvQ2xhc3NMYXlvdXQnO1xuaW1wb3J0IHsgQ2xhc3NOYW1lIH0gZnJvbSAnLi4vLi4vLi4vLi4vc3JjL2RvbWFpbi92YWx1ZS1vYmplY3RzL0NsYXNzTmFtZSc7XG5pbXBvcnQgeyBBc3NldElkIH0gZnJvbSAnLi4vLi4vLi4vLi4vc3JjL2RvbWFpbi92YWx1ZS1vYmplY3RzL0Fzc2V0SWQnO1xuXG4vLyBNb2NrIHRoZSBDbGFzc0xheW91dC5jcmVhdGUgc3RhdGljIG1ldGhvZFxuamVzdC5tb2NrKCcuLi8uLi8uLi8uLi9zcmMvZG9tYWluL2VudGl0aWVzL0NsYXNzTGF5b3V0JywgKCkgPT4ge1xuICAgIHJldHVybiB7XG4gICAgICAgIENsYXNzTGF5b3V0OiB7XG4gICAgICAgICAgICBjcmVhdGU6IGplc3QuZm4oKS5tb2NrSW1wbGVtZW50YXRpb24oKHBhcmFtczogYW55KSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3QgbW9ja0NsYXNzTGF5b3V0ID0ge1xuICAgICAgICAgICAgICAgICAgICBpZDogcGFyYW1zLmlkIHx8IHsgZXF1YWxzOiBqZXN0LmZuKCksIHRvU3RyaW5nOiAoKSA9PiAndGVzdC1pZCcgfSxcbiAgICAgICAgICAgICAgICAgICAgdGFyZ2V0Q2xhc3M6IHBhcmFtcy50YXJnZXRDbGFzcyB8fCB7IGVxdWFsczogamVzdC5mbigpLCB2YWx1ZTogJ1Rlc3RDbGFzcycgfSxcbiAgICAgICAgICAgICAgICAgICAgaXNFbmFibGVkOiBwYXJhbXMuaXNFbmFibGVkICE9PSB1bmRlZmluZWQgPyBwYXJhbXMuaXNFbmFibGVkIDogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgcHJpb3JpdHk6IHBhcmFtcy5wcmlvcml0eSAhPT0gdW5kZWZpbmVkID8gcGFyYW1zLnByaW9yaXR5IDogMSxcbiAgICAgICAgICAgICAgICAgICAgYmxvY2tzOiBwYXJhbXMuYmxvY2tzIHx8IFtdXG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgICAgICBpc1N1Y2Nlc3M6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgIGdldFZhbHVlOiAoKSA9PiBtb2NrQ2xhc3NMYXlvdXRcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgfSlcbiAgICAgICAgfVxuICAgIH07XG59KTtcblxuZGVzY3JpYmUoJ09ic2lkaWFuQ2xhc3NMYXlvdXRSZXBvc2l0b3J5JywgKCkgPT4ge1xuICAgIGxldCByZXBvc2l0b3J5OiBPYnNpZGlhbkNsYXNzTGF5b3V0UmVwb3NpdG9yeTtcbiAgICBsZXQgbW9ja0FwcDogQXBwO1xuICAgIGxldCBtb2NrVmF1bHQ6IGFueTtcbiAgICBsZXQgbW9ja01ldGFkYXRhQ2FjaGU6IE1ldGFkYXRhQ2FjaGU7XG5cbiAgICBiZWZvcmVFYWNoKCgpID0+IHtcbiAgICAgICAgLy8gUmVzZXQgdGltZVxuICAgICAgICBqZXN0LnVzZUZha2VUaW1lcnMoKTtcbiAgICAgICAgamVzdC5zZXRTeXN0ZW1UaW1lKG5ldyBEYXRlKCcyMDI0LTAxLTAxJykpO1xuXG4gICAgICAgIC8vIENyZWF0ZSBtb2NrIHZhdWx0XG4gICAgICAgIG1vY2tWYXVsdCA9IHtcbiAgICAgICAgICAgIGdldEZpbGVzOiBqZXN0LmZuKCksXG4gICAgICAgICAgICBnZXRBYnN0cmFjdEZpbGVCeVBhdGg6IGplc3QuZm4oKSxcbiAgICAgICAgICAgIGNyZWF0ZTogamVzdC5mbigpLFxuICAgICAgICAgICAgbW9kaWZ5OiBqZXN0LmZuKCksXG4gICAgICAgICAgICBkZWxldGU6IGplc3QuZm4oKVxuICAgICAgICB9O1xuXG4gICAgICAgIC8vIENyZWF0ZSBtb2NrIG1ldGFkYXRhIGNhY2hlXG4gICAgICAgIG1vY2tNZXRhZGF0YUNhY2hlID0ge1xuICAgICAgICAgICAgZ2V0RmlsZUNhY2hlOiBqZXN0LmZuKClcbiAgICAgICAgfSBhcyBhbnk7XG5cbiAgICAgICAgLy8gQ3JlYXRlIG1vY2sgYXBwXG4gICAgICAgIG1vY2tBcHAgPSB7XG4gICAgICAgICAgICB2YXVsdDogbW9ja1ZhdWx0LFxuICAgICAgICAgICAgbWV0YWRhdGFDYWNoZTogbW9ja01ldGFkYXRhQ2FjaGVcbiAgICAgICAgfSBhcyBBcHA7XG5cbiAgICAgICAgcmVwb3NpdG9yeSA9IG5ldyBPYnNpZGlhbkNsYXNzTGF5b3V0UmVwb3NpdG9yeShtb2NrQXBwLCAndGVzdC1sYXlvdXRzJyk7XG4gICAgfSk7XG5cbiAgICBhZnRlckVhY2goKCkgPT4ge1xuICAgICAgICBqZXN0LmNsZWFyQWxsTW9ja3MoKTtcbiAgICAgICAgamVzdC51c2VSZWFsVGltZXJzKCk7XG4gICAgfSk7XG5cbiAgICBkZXNjcmliZSgnQ29uc3RydWN0b3IgYW5kIEluaXRpYWxpemF0aW9uJywgKCkgPT4ge1xuICAgICAgICBpdCgnc2hvdWxkIGluaXRpYWxpemUgd2l0aCBkZWZhdWx0IGxheW91dHMgZm9sZGVyIHBhdGgnLCAoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCByZXBvID0gbmV3IE9ic2lkaWFuQ2xhc3NMYXlvdXRSZXBvc2l0b3J5KG1vY2tBcHApO1xuICAgICAgICAgICAgZXhwZWN0KHJlcG8pLnRvQmVJbnN0YW5jZU9mKE9ic2lkaWFuQ2xhc3NMYXlvdXRSZXBvc2l0b3J5KTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgaXQoJ3Nob3VsZCBpbml0aWFsaXplIHdpdGggY3VzdG9tIGxheW91dHMgZm9sZGVyIHBhdGgnLCAoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCByZXBvID0gbmV3IE9ic2lkaWFuQ2xhc3NMYXlvdXRSZXBvc2l0b3J5KG1vY2tBcHAsICdjdXN0b20tbGF5b3V0cycpO1xuICAgICAgICAgICAgZXhwZWN0KHJlcG8pLnRvQmVJbnN0YW5jZU9mKE9ic2lkaWFuQ2xhc3NMYXlvdXRSZXBvc2l0b3J5KTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgaXQoJ3Nob3VsZCBoYW5kbGUgbnVsbCBhcHAgZ3JhY2VmdWxseScsICgpID0+IHtcbiAgICAgICAgICAgIGV4cGVjdCgoKSA9PiBuZXcgT2JzaWRpYW5DbGFzc0xheW91dFJlcG9zaXRvcnkobnVsbCBhcyBhbnkpKS5ub3QudG9UaHJvdygpO1xuICAgICAgICB9KTtcbiAgICB9KTtcblxuICAgIGRlc2NyaWJlKCdDYWNoZSBNYW5hZ2VtZW50JywgKCkgPT4ge1xuICAgICAgICBiZWZvcmVFYWNoKCgpID0+IHtcbiAgICAgICAgICAgIG1vY2tWYXVsdC5nZXRGaWxlcy5tb2NrUmV0dXJuVmFsdWUoW10pO1xuICAgICAgICB9KTtcblxuICAgICAgICBpdCgnc2hvdWxkIGxvYWQgY2FjaGUgb24gZmlyc3QgYWNjZXNzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgICAgICAgbW9ja1ZhdWx0LmdldEZpbGVzLm1vY2tSZXR1cm5WYWx1ZShbXSk7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGF3YWl0IHJlcG9zaXRvcnkuZmluZEFsbCgpO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICBleHBlY3QobW9ja1ZhdWx0LmdldEZpbGVzKS50b0hhdmVCZWVuQ2FsbGVkKCk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGl0KCdzaG91bGQgdXNlIGNhY2hlIHdpdGhpbiBUVEwgcGVyaW9kJywgYXN5bmMgKCkgPT4ge1xuICAgICAgICAgICAgYXdhaXQgcmVwb3NpdG9yeS5maW5kQWxsKCk7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIC8vIFJlc2V0IG1vY2sgY2FsbCBjb3VudFxuICAgICAgICAgICAgbW9ja1ZhdWx0LmdldEZpbGVzLm1vY2tDbGVhcigpO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICAvLyBDYWxsIGFnYWluIGltbWVkaWF0ZWx5XG4gICAgICAgICAgICBhd2FpdCByZXBvc2l0b3J5LmZpbmRBbGwoKTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgLy8gU2hvdWxkIG5vdCBjYWxsIHZhdWx0IGFnYWluXG4gICAgICAgICAgICBleHBlY3QobW9ja1ZhdWx0LmdldEZpbGVzKS5ub3QudG9IYXZlQmVlbkNhbGxlZCgpO1xuICAgICAgICB9KTtcblxuICAgICAgICBpdCgnc2hvdWxkIHJlZnJlc2ggY2FjaGUgYWZ0ZXIgVFRMIGV4cGlyZXMnLCBhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICBhd2FpdCByZXBvc2l0b3J5LmZpbmRBbGwoKTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgLy8gQWR2YW5jZSB0aW1lIGJleW9uZCBUVEwgKDMwIHNlY29uZHMpXG4gICAgICAgICAgICBqZXN0LmFkdmFuY2VUaW1lcnNCeVRpbWUoMzUwMDApO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICBtb2NrVmF1bHQuZ2V0RmlsZXMubW9ja0NsZWFyKCk7XG4gICAgICAgICAgICBhd2FpdCByZXBvc2l0b3J5LmZpbmRBbGwoKTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgZXhwZWN0KG1vY2tWYXVsdC5nZXRGaWxlcykudG9IYXZlQmVlbkNhbGxlZCgpO1xuICAgICAgICB9KTtcblxuICAgICAgICBpdCgnc2hvdWxkIGNsZWFyIGNhY2hlIG9uIGxvYWRMYXlvdXRzRnJvbUZpbGVzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgICAgICAgLy8gVGhpcyB0ZXN0IHZlcmlmaWVzIHRoYXQgY2FjaGUgYmVoYXZlcyBwcm9wZXJseVxuICAgICAgICAgICAgLy8gQWZ0ZXIgaW1wbGVtZW50YXRpb24gY2hhbmdlcywgbWFudWFsbHkgYWRkZWQgbGF5b3V0cyBhcmUgcHJlc2VydmVkXG4gICAgICAgICAgICAvLyBidXQgdGhlIGNhY2hlIHJlZnJlc2ggbWVjaGFuaXNtIHN0aWxsIHdvcmtzXG4gICAgICAgICAgICBcbiAgICAgICAgICAgIC8vIEZvcmNlIGluaXRpYWwgbG9hZFxuICAgICAgICAgICAgYXdhaXQgcmVwb3NpdG9yeS5maW5kQWxsKCk7XG4gICAgICAgICAgICBleHBlY3QobW9ja1ZhdWx0LmdldEZpbGVzKS50b0hhdmVCZWVuQ2FsbGVkKCk7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIC8vIENsZWFyIG1vY2sgY2FsbCBjb3VudFxuICAgICAgICAgICAgbW9ja1ZhdWx0LmdldEZpbGVzLm1vY2tDbGVhcigpO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICAvLyBBZHZhbmNlIHRpbWUgdG8gdHJpZ2dlciByZWZyZXNoXG4gICAgICAgICAgICBqZXN0LmFkdmFuY2VUaW1lcnNCeVRpbWUoMzUwMDApO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICAvLyBDcmVhdGUgbmV3IHJlcG9zaXRvcnkgd2l0aG91dCBtYW51YWxseSBhZGRlZCBsYXlvdXRzIHRvIHRlc3QgZmlsZSBsb2FkaW5nXG4gICAgICAgICAgICBjb25zdCBmcmVzaFJlcG9zaXRvcnkgPSBuZXcgT2JzaWRpYW5DbGFzc0xheW91dFJlcG9zaXRvcnkobW9ja0FwcCwgJ3Rlc3QtbGF5b3V0cycpO1xuICAgICAgICAgICAgYXdhaXQgZnJlc2hSZXBvc2l0b3J5LmZpbmRBbGwoKTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgLy8gU2hvdWxkIGNhbGwgZ2V0RmlsZXMgZm9yIGZyZXNoIHJlcG9zaXRvcnlcbiAgICAgICAgICAgIGV4cGVjdChtb2NrVmF1bHQuZ2V0RmlsZXMpLnRvSGF2ZUJlZW5DYWxsZWQoKTtcbiAgICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBkZXNjcmliZSgnZmluZEJ5Q2xhc3MnLCAoKSA9PiB7XG4gICAgICAgIGNvbnN0IG1vY2tDbGFzc05hbWUgPSBDbGFzc05hbWUuY3JlYXRlKCdUZXN0Q2xhc3MnKS5nZXRWYWx1ZSgpO1xuXG4gICAgICAgIGJlZm9yZUVhY2goKCkgPT4ge1xuICAgICAgICAgICAgc2V0dXBNb2NrTGF5b3V0RmlsZXMoKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgaXQoJ3Nob3VsZCBmaW5kIGxheW91dHMgZm9yIHNwZWNpZmljIGNsYXNzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgcmVwb3NpdG9yeS5maW5kQnlDbGFzcyhtb2NrQ2xhc3NOYW1lKTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgZXhwZWN0KHJlc3VsdCkudG9CZURlZmluZWQoKTtcbiAgICAgICAgICAgIGV4cGVjdChBcnJheS5pc0FycmF5KHJlc3VsdCkpLnRvQmUodHJ1ZSk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGl0KCdzaG91bGQgcmV0dXJuIG9ubHkgZW5hYmxlZCBsYXlvdXRzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgcmVwb3NpdG9yeS5maW5kQnlDbGFzcyhtb2NrQ2xhc3NOYW1lKTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgcmVzdWx0LmZvckVhY2gobGF5b3V0ID0+IHtcbiAgICAgICAgICAgICAgICBleHBlY3QobGF5b3V0LmlzRW5hYmxlZCkudG9CZSh0cnVlKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcblxuICAgICAgICBpdCgnc2hvdWxkIHNvcnQgbGF5b3V0cyBieSBwcmlvcml0eSAoaGlnaGVyIGZpcnN0KScsIGFzeW5jICgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGxheW91dDEgPSBjcmVhdGVNb2NrTGF5b3V0KCdpZDEnLCBtb2NrQ2xhc3NOYW1lLCB0cnVlLCAxKTtcbiAgICAgICAgICAgIGNvbnN0IGxheW91dDIgPSBjcmVhdGVNb2NrTGF5b3V0KCdpZDInLCBtb2NrQ2xhc3NOYW1lLCB0cnVlLCAzKTtcbiAgICAgICAgICAgIGNvbnN0IGxheW91dDMgPSBjcmVhdGVNb2NrTGF5b3V0KCdpZDMnLCBtb2NrQ2xhc3NOYW1lLCB0cnVlLCAyKTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgYXdhaXQgcmVwb3NpdG9yeS5zYXZlKGxheW91dDEpO1xuICAgICAgICAgICAgYXdhaXQgcmVwb3NpdG9yeS5zYXZlKGxheW91dDIpO1xuICAgICAgICAgICAgYXdhaXQgcmVwb3NpdG9yeS5zYXZlKGxheW91dDMpO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCByZXBvc2l0b3J5LmZpbmRCeUNsYXNzKG1vY2tDbGFzc05hbWUpO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICAvLyBTaG91bGQgYmUgc29ydGVkIGJ5IHByaW9yaXR5OiAzLCAyLCAxXG4gICAgICAgICAgICBleHBlY3QocmVzdWx0WzBdLnByaW9yaXR5KS50b0JlKDMpO1xuICAgICAgICAgICAgZXhwZWN0KHJlc3VsdFsxXS5wcmlvcml0eSkudG9CZSgyKTtcbiAgICAgICAgICAgIGV4cGVjdChyZXN1bHRbMl0ucHJpb3JpdHkpLnRvQmUoMSk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGl0KCdzaG91bGQgcmV0dXJuIGVtcHR5IGFycmF5IGZvciBub24tZXhpc3RlbnQgY2xhc3MnLCBhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBub25FeGlzdGVudENsYXNzID0gQ2xhc3NOYW1lLmNyZWF0ZSgnTm9uRXhpc3RlbnQnKS5nZXRWYWx1ZSgpO1xuICAgICAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgcmVwb3NpdG9yeS5maW5kQnlDbGFzcyhub25FeGlzdGVudENsYXNzKTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgZXhwZWN0KHJlc3VsdCkudG9FcXVhbChbXSk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGl0KCdzaG91bGQgZmlsdGVyIG91dCBkaXNhYmxlZCBsYXlvdXRzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgZW5hYmxlZExheW91dCA9IGNyZWF0ZU1vY2tMYXlvdXQoJ2VuYWJsZWQnLCBtb2NrQ2xhc3NOYW1lLCB0cnVlKTtcbiAgICAgICAgICAgIGNvbnN0IGRpc2FibGVkTGF5b3V0ID0gY3JlYXRlTW9ja0xheW91dCgnZGlzYWJsZWQnLCBtb2NrQ2xhc3NOYW1lLCBmYWxzZSk7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGF3YWl0IHJlcG9zaXRvcnkuc2F2ZShlbmFibGVkTGF5b3V0KTtcbiAgICAgICAgICAgIGF3YWl0IHJlcG9zaXRvcnkuc2F2ZShkaXNhYmxlZExheW91dCk7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHJlcG9zaXRvcnkuZmluZEJ5Q2xhc3MobW9ja0NsYXNzTmFtZSk7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGV4cGVjdChyZXN1bHQpLnRvSGF2ZUxlbmd0aCgxKTtcbiAgICAgICAgICAgIGV4cGVjdChyZXN1bHRbMF0uaXNFbmFibGVkKS50b0JlKHRydWUpO1xuICAgICAgICB9KTtcbiAgICB9KTtcblxuICAgIGRlc2NyaWJlKCdmaW5kQnlJZCcsICgpID0+IHtcbiAgICAgICAgY29uc3QgbW9ja0lkID0gQXNzZXRJZC5jcmVhdGUoJ3Rlc3QtaWQnKS5nZXRWYWx1ZSgpO1xuICAgICAgICBjb25zdCBtb2NrQ2xhc3NOYW1lID0gQ2xhc3NOYW1lLmNyZWF0ZSgnVGVzdENsYXNzJykuZ2V0VmFsdWUoKTtcblxuICAgICAgICBiZWZvcmVFYWNoKCgpID0+IHtcbiAgICAgICAgICAgIHNldHVwTW9ja0xheW91dEZpbGVzKCk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGl0KCdzaG91bGQgZmluZCBsYXlvdXQgYnkgSUQnLCBhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBsYXlvdXQgPSBjcmVhdGVNb2NrTGF5b3V0KCd0ZXN0LWlkJywgbW9ja0NsYXNzTmFtZSk7XG4gICAgICAgICAgICBhd2FpdCByZXBvc2l0b3J5LnNhdmUobGF5b3V0KTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgcmVwb3NpdG9yeS5maW5kQnlJZChtb2NrSWQpO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICBleHBlY3QocmVzdWx0KS50b0JlRGVmaW5lZCgpO1xuICAgICAgICAgICAgZXhwZWN0KHJlc3VsdD8uaWQuZXF1YWxzKG1vY2tJZCkpLnRvQmUodHJ1ZSk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGl0KCdzaG91bGQgcmV0dXJuIG51bGwgZm9yIG5vbi1leGlzdGVudCBJRCcsIGFzeW5jICgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IG5vbkV4aXN0ZW50SWQgPSBBc3NldElkLmNyZWF0ZSgnbm9uLWV4aXN0ZW50JykuZ2V0VmFsdWUoKTtcbiAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHJlcG9zaXRvcnkuZmluZEJ5SWQobm9uRXhpc3RlbnRJZCk7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGV4cGVjdChyZXN1bHQpLnRvQmVOdWxsKCk7XG4gICAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgZGVzY3JpYmUoJ2ZpbmRBbGwnLCAoKSA9PiB7XG4gICAgICAgIGJlZm9yZUVhY2goKCkgPT4ge1xuICAgICAgICAgICAgc2V0dXBNb2NrTGF5b3V0RmlsZXMoKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgaXQoJ3Nob3VsZCByZXR1cm4gYWxsIGxheW91dHMgZnJvbSBjYWNoZScsIGFzeW5jICgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGNsYXNzTmFtZTEgPSBDbGFzc05hbWUuY3JlYXRlKCdDbGFzczEnKS5nZXRWYWx1ZSgpO1xuICAgICAgICAgICAgY29uc3QgY2xhc3NOYW1lMiA9IENsYXNzTmFtZS5jcmVhdGUoJ0NsYXNzMicpLmdldFZhbHVlKCk7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGF3YWl0IHJlcG9zaXRvcnkuc2F2ZShjcmVhdGVNb2NrTGF5b3V0KCdpZDEnLCBjbGFzc05hbWUxKSk7XG4gICAgICAgICAgICBhd2FpdCByZXBvc2l0b3J5LnNhdmUoY3JlYXRlTW9ja0xheW91dCgnaWQyJywgY2xhc3NOYW1lMikpO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCByZXBvc2l0b3J5LmZpbmRBbGwoKTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgZXhwZWN0KHJlc3VsdCkudG9IYXZlTGVuZ3RoKDIpO1xuICAgICAgICB9KTtcblxuICAgICAgICBpdCgnc2hvdWxkIHJldHVybiBlbXB0eSBhcnJheSB3aGVuIG5vIGxheW91dHMgZXhpc3QnLCBhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCByZXBvc2l0b3J5LmZpbmRBbGwoKTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgZXhwZWN0KHJlc3VsdCkudG9FcXVhbChbXSk7XG4gICAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgZGVzY3JpYmUoJ2ZpbmRFbmFibGVkQnlDbGFzcycsICgpID0+IHtcbiAgICAgICAgY29uc3QgbW9ja0NsYXNzTmFtZSA9IENsYXNzTmFtZS5jcmVhdGUoJ1Rlc3RDbGFzcycpLmdldFZhbHVlKCk7XG5cbiAgICAgICAgaXQoJ3Nob3VsZCByZXR1cm4gb25seSBlbmFibGVkIGxheW91dHMnLCBhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBlbmFibGVkTGF5b3V0ID0gY3JlYXRlTW9ja0xheW91dCgnZW5hYmxlZCcsIG1vY2tDbGFzc05hbWUsIHRydWUpO1xuICAgICAgICAgICAgY29uc3QgZGlzYWJsZWRMYXlvdXQgPSBjcmVhdGVNb2NrTGF5b3V0KCdkaXNhYmxlZCcsIG1vY2tDbGFzc05hbWUsIGZhbHNlKTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgYXdhaXQgcmVwb3NpdG9yeS5zYXZlKGVuYWJsZWRMYXlvdXQpO1xuICAgICAgICAgICAgYXdhaXQgcmVwb3NpdG9yeS5zYXZlKGRpc2FibGVkTGF5b3V0KTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgcmVwb3NpdG9yeS5maW5kRW5hYmxlZEJ5Q2xhc3MobW9ja0NsYXNzTmFtZSk7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGV4cGVjdChyZXN1bHQpLnRvSGF2ZUxlbmd0aCgxKTtcbiAgICAgICAgICAgIGV4cGVjdChyZXN1bHRbMF0uaXNFbmFibGVkKS50b0JlKHRydWUpO1xuICAgICAgICB9KTtcblxuICAgICAgICBpdCgnc2hvdWxkIHJldHVybiBlbXB0eSBhcnJheSB3aGVuIG5vIGVuYWJsZWQgbGF5b3V0cyBleGlzdCcsIGFzeW5jICgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGRpc2FibGVkTGF5b3V0ID0gY3JlYXRlTW9ja0xheW91dCgnZGlzYWJsZWQnLCBtb2NrQ2xhc3NOYW1lLCBmYWxzZSk7XG4gICAgICAgICAgICBhd2FpdCByZXBvc2l0b3J5LnNhdmUoZGlzYWJsZWRMYXlvdXQpO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCByZXBvc2l0b3J5LmZpbmRFbmFibGVkQnlDbGFzcyhtb2NrQ2xhc3NOYW1lKTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgZXhwZWN0KHJlc3VsdCkudG9FcXVhbChbXSk7XG4gICAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgZGVzY3JpYmUoJ3NhdmUnLCAoKSA9PiB7XG4gICAgICAgIGNvbnN0IG1vY2tDbGFzc05hbWUgPSBDbGFzc05hbWUuY3JlYXRlKCdUZXN0Q2xhc3MnKS5nZXRWYWx1ZSgpO1xuXG4gICAgICAgIGl0KCdzaG91bGQgc2F2ZSBuZXcgbGF5b3V0IHRvIGNhY2hlJywgYXN5bmMgKCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgbGF5b3V0ID0gY3JlYXRlTW9ja0xheW91dCgnbmV3LWlkJywgbW9ja0NsYXNzTmFtZSk7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGF3YWl0IHJlcG9zaXRvcnkuc2F2ZShsYXlvdXQpO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCByZXBvc2l0b3J5LmZpbmRCeUlkKGxheW91dC5pZCk7XG4gICAgICAgICAgICBleHBlY3QocmVzdWx0KS50b0JlKGxheW91dCk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGl0KCdzaG91bGQgdXBkYXRlIGV4aXN0aW5nIGxheW91dCBpbiBjYWNoZScsIGFzeW5jICgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGxheW91dCA9IGNyZWF0ZU1vY2tMYXlvdXQoJ2V4aXN0aW5nLWlkJywgbW9ja0NsYXNzTmFtZSk7XG4gICAgICAgICAgICBhd2FpdCByZXBvc2l0b3J5LnNhdmUobGF5b3V0KTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgY29uc3QgdXBkYXRlZExheW91dCA9IHsgLi4ubGF5b3V0LCBwcmlvcml0eTogNSB9O1xuICAgICAgICAgICAgYXdhaXQgcmVwb3NpdG9yeS5zYXZlKHVwZGF0ZWRMYXlvdXQpO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCByZXBvc2l0b3J5LmZpbmRCeUlkKGxheW91dC5pZCk7XG4gICAgICAgICAgICBleHBlY3QocmVzdWx0Py5wcmlvcml0eSkudG9CZSg1KTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgaXQoJ3Nob3VsZCBtYWludGFpbiBjYWNoZSBzdHJ1Y3R1cmUgYnkgY2xhc3MgbmFtZScsIGFzeW5jICgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGNsYXNzMSA9IENsYXNzTmFtZS5jcmVhdGUoJ0NsYXNzMScpLmdldFZhbHVlKCk7XG4gICAgICAgICAgICBjb25zdCBjbGFzczIgPSBDbGFzc05hbWUuY3JlYXRlKCdDbGFzczInKS5nZXRWYWx1ZSgpO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICBhd2FpdCByZXBvc2l0b3J5LnNhdmUoY3JlYXRlTW9ja0xheW91dCgnaWQxJywgY2xhc3MxKSk7XG4gICAgICAgICAgICBhd2FpdCByZXBvc2l0b3J5LnNhdmUoY3JlYXRlTW9ja0xheW91dCgnaWQyJywgY2xhc3MyKSk7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGNvbnN0IGNsYXNzMUxheW91dHMgPSBhd2FpdCByZXBvc2l0b3J5LmZpbmRCeUNsYXNzKGNsYXNzMSk7XG4gICAgICAgICAgICBjb25zdCBjbGFzczJMYXlvdXRzID0gYXdhaXQgcmVwb3NpdG9yeS5maW5kQnlDbGFzcyhjbGFzczIpO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICBleHBlY3QoY2xhc3MxTGF5b3V0cykudG9IYXZlTGVuZ3RoKDEpO1xuICAgICAgICAgICAgZXhwZWN0KGNsYXNzMkxheW91dHMpLnRvSGF2ZUxlbmd0aCgxKTtcbiAgICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBkZXNjcmliZSgnZGVsZXRlJywgKCkgPT4ge1xuICAgICAgICBjb25zdCBtb2NrQ2xhc3NOYW1lID0gQ2xhc3NOYW1lLmNyZWF0ZSgnVGVzdENsYXNzJykuZ2V0VmFsdWUoKTtcblxuICAgICAgICBpdCgnc2hvdWxkIHJlbW92ZSBsYXlvdXQgZnJvbSBjYWNoZScsIGFzeW5jICgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGxheW91dCA9IGNyZWF0ZU1vY2tMYXlvdXQoJ3RvLWRlbGV0ZScsIG1vY2tDbGFzc05hbWUpO1xuICAgICAgICAgICAgYXdhaXQgcmVwb3NpdG9yeS5zYXZlKGxheW91dCk7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGF3YWl0IHJlcG9zaXRvcnkuZGVsZXRlKGxheW91dC5pZCk7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHJlcG9zaXRvcnkuZmluZEJ5SWQobGF5b3V0LmlkKTtcbiAgICAgICAgICAgIGV4cGVjdChyZXN1bHQpLnRvQmVOdWxsKCk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGl0KCdzaG91bGQgaGFuZGxlIGRlbGV0aW9uIG9mIG5vbi1leGlzdGVudCBsYXlvdXQgZ3JhY2VmdWxseScsIGFzeW5jICgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IG5vbkV4aXN0ZW50SWQgPSBBc3NldElkLmNyZWF0ZSgnbm9uLWV4aXN0ZW50JykuZ2V0VmFsdWUoKTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgYXdhaXQgZXhwZWN0KHJlcG9zaXRvcnkuZGVsZXRlKG5vbkV4aXN0ZW50SWQpKS5yZXNvbHZlcy5ub3QudG9UaHJvdygpO1xuICAgICAgICB9KTtcblxuICAgICAgICBpdCgnc2hvdWxkIG1haW50YWluIG90aGVyIGxheW91dHMgYWZ0ZXIgZGVsZXRpb24nLCBhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBsYXlvdXQxID0gY3JlYXRlTW9ja0xheW91dCgna2VlcCcsIG1vY2tDbGFzc05hbWUpO1xuICAgICAgICAgICAgY29uc3QgbGF5b3V0MiA9IGNyZWF0ZU1vY2tMYXlvdXQoJ2RlbGV0ZScsIG1vY2tDbGFzc05hbWUpO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICBhd2FpdCByZXBvc2l0b3J5LnNhdmUobGF5b3V0MSk7XG4gICAgICAgICAgICBhd2FpdCByZXBvc2l0b3J5LnNhdmUobGF5b3V0Mik7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGF3YWl0IHJlcG9zaXRvcnkuZGVsZXRlKGxheW91dDIuaWQpO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICBjb25zdCByZW1haW5pbmcgPSBhd2FpdCByZXBvc2l0b3J5LmZpbmRCeUNsYXNzKG1vY2tDbGFzc05hbWUpO1xuICAgICAgICAgICAgZXhwZWN0KHJlbWFpbmluZykudG9IYXZlTGVuZ3RoKDEpO1xuICAgICAgICAgICAgZXhwZWN0KHJlbWFpbmluZ1swXS5pZCkudG9CZShsYXlvdXQxLmlkKTtcbiAgICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBkZXNjcmliZSgnTGF5b3V0IEZpbGUgUGFyc2luZycsICgpID0+IHtcbiAgICAgICAgY29uc3QgbW9ja0ZpbGUgPSBuZXcgVEZpbGUoJ2xheW91dHMvTGF5b3V0IC0gVGVzdENsYXNzLm1kJyk7XG5cbiAgICAgICAgaXQoJ3Nob3VsZCBpZGVudGlmeSBsYXlvdXQgZmlsZXMgY29ycmVjdGx5JywgYXN5bmMgKCkgPT4ge1xuICAgICAgICAgICAgbW9ja1ZhdWx0LmdldEZpbGVzLm1vY2tSZXR1cm5WYWx1ZShbbW9ja0ZpbGVdKTtcbiAgICAgICAgICAgIG1vY2tNZXRhZGF0YUNhY2hlLmdldEZpbGVDYWNoZS5tb2NrUmV0dXJuVmFsdWUoe1xuICAgICAgICAgICAgICAgIGZyb250bWF0dGVyOiB7XG4gICAgICAgICAgICAgICAgICAgICdleG9fX0luc3RhbmNlX2NsYXNzJzogJ1tbdWlfX0NsYXNzTGF5b3V0XV0nLFxuICAgICAgICAgICAgICAgICAgICAndWlfX0NsYXNzTGF5b3V0X3RhcmdldENsYXNzJzogJ1tbVGVzdENsYXNzXV0nXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGF3YWl0IHJlcG9zaXRvcnkuZmluZEFsbCgpO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICBleHBlY3QobW9ja01ldGFkYXRhQ2FjaGUuZ2V0RmlsZUNhY2hlKS50b0hhdmVCZWVuQ2FsbGVkV2l0aChtb2NrRmlsZSk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGl0KCdzaG91bGQgcGFyc2UgbGF5b3V0IGJsb2NrcyBjb3JyZWN0bHknLCBhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBtb2NrQmxvY2tzID0gW1xuICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgaWQ6ICdwcm9wZXJ0aWVzLWJsb2NrJyxcbiAgICAgICAgICAgICAgICAgICAgdHlwZTogJ3Byb3BlcnRpZXMnLFxuICAgICAgICAgICAgICAgICAgICB0aXRsZTogJ1Byb3BlcnRpZXMnLFxuICAgICAgICAgICAgICAgICAgICBvcmRlcjogMCxcbiAgICAgICAgICAgICAgICAgICAgY29uZmlnOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpbmNsdWRlZFByb3BlcnRpZXM6IFsnbmFtZScsICdkZXNjcmlwdGlvbiddLFxuICAgICAgICAgICAgICAgICAgICAgICAgZWRpdGFibGVQcm9wZXJ0aWVzOiBbJ25hbWUnXVxuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICBpc1Zpc2libGU6IHRydWVcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgaWQ6ICdxdWVyeS1ibG9jaycsXG4gICAgICAgICAgICAgICAgICAgIHR5cGU6ICdxdWVyeScsXG4gICAgICAgICAgICAgICAgICAgIHRpdGxlOiAnUmVsYXRlZCBJdGVtcycsXG4gICAgICAgICAgICAgICAgICAgIG9yZGVyOiAxLFxuICAgICAgICAgICAgICAgICAgICBjb25maWc6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHF1ZXJ5OiAnU0VMRUNUICogV0hFUkUgeyA/cyA/cCA/byB9JyxcbiAgICAgICAgICAgICAgICAgICAgICAgIG1heFJlc3VsdHM6IDEwXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICBdO1xuXG4gICAgICAgICAgICBtb2NrVmF1bHQuZ2V0RmlsZXMubW9ja1JldHVyblZhbHVlKFttb2NrRmlsZV0pO1xuICAgICAgICAgICAgbW9ja01ldGFkYXRhQ2FjaGUuZ2V0RmlsZUNhY2hlLm1vY2tSZXR1cm5WYWx1ZSh7XG4gICAgICAgICAgICAgICAgZnJvbnRtYXR0ZXI6IHtcbiAgICAgICAgICAgICAgICAgICAgJ2V4b19fSW5zdGFuY2VfY2xhc3MnOiAndWlfX0NsYXNzTGF5b3V0JyxcbiAgICAgICAgICAgICAgICAgICAgJ3VpX19DbGFzc0xheW91dF90YXJnZXRDbGFzcyc6ICdUZXN0Q2xhc3MnLFxuICAgICAgICAgICAgICAgICAgICAndWlfX0NsYXNzTGF5b3V0X2Jsb2Nrcyc6IG1vY2tCbG9ja3MsXG4gICAgICAgICAgICAgICAgICAgICdleG9fX0Fzc2V0X3VpZCc6ICd0ZXN0LXVpZCdcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgYXdhaXQgcmVwb3NpdG9yeS5maW5kQWxsKCk7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIC8vIFZlcmlmeSBDbGFzc0xheW91dC5jcmVhdGUgd2FzIGNhbGxlZCB3aXRoIHBhcnNlZCBibG9ja3NcbiAgICAgICAgICAgIGNvbnN0IHsgQ2xhc3NMYXlvdXQgfSA9IHJlcXVpcmUoJy4uLy4uLy4uLy4uL3NyYy9kb21haW4vZW50aXRpZXMvQ2xhc3NMYXlvdXQnKTtcbiAgICAgICAgICAgIGV4cGVjdChDbGFzc0xheW91dC5jcmVhdGUpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKFxuICAgICAgICAgICAgICAgIGV4cGVjdC5vYmplY3RDb250YWluaW5nKHtcbiAgICAgICAgICAgICAgICAgICAgYmxvY2tzOiBleHBlY3QuYXJyYXlDb250YWluaW5nKFtcbiAgICAgICAgICAgICAgICAgICAgICAgIGV4cGVjdC5vYmplY3RDb250YWluaW5nKHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZDogJ3Byb3BlcnRpZXMtYmxvY2snLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6ICdwcm9wZXJ0aWVzJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aXRsZTogJ1Byb3BlcnRpZXMnXG4gICAgICAgICAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgICAgICBdKVxuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICApO1xuICAgICAgICB9KTtcblxuICAgICAgICBpdCgnc2hvdWxkIGhhbmRsZSBtaXNzaW5nIGZyb250bWF0dGVyIGdyYWNlZnVsbHknLCBhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICBtb2NrVmF1bHQuZ2V0RmlsZXMubW9ja1JldHVyblZhbHVlKFttb2NrRmlsZV0pO1xuICAgICAgICAgICAgbW9ja01ldGFkYXRhQ2FjaGUuZ2V0RmlsZUNhY2hlLm1vY2tSZXR1cm5WYWx1ZShudWxsKTtcblxuICAgICAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgcmVwb3NpdG9yeS5maW5kQWxsKCk7XG4gICAgICAgICAgICBleHBlY3QocmVzdWx0KS50b0VxdWFsKFtdKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgaXQoJ3Nob3VsZCBmaWx0ZXIgb3V0IG5vbi1sYXlvdXQgZmlsZXMnLCBhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBub25MYXlvdXRGaWxlID0gbmV3IFRGaWxlKCdyZWd1bGFyLW5vdGUubWQnKTtcbiAgICAgICAgICAgIG1vY2tWYXVsdC5nZXRGaWxlcy5tb2NrUmV0dXJuVmFsdWUoW25vbkxheW91dEZpbGVdKTtcbiAgICAgICAgICAgIG1vY2tNZXRhZGF0YUNhY2hlLmdldEZpbGVDYWNoZS5tb2NrUmV0dXJuVmFsdWUoe1xuICAgICAgICAgICAgICAgIGZyb250bWF0dGVyOiB7XG4gICAgICAgICAgICAgICAgICAgICdleG9fX0luc3RhbmNlX2NsYXNzJzogJ1NvbWVPdGhlckNsYXNzJ1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCByZXBvc2l0b3J5LmZpbmRBbGwoKTtcbiAgICAgICAgICAgIGV4cGVjdChyZXN1bHQpLnRvRXF1YWwoW10pO1xuICAgICAgICB9KTtcblxuICAgICAgICBpdCgnc2hvdWxkIGhhbmRsZSBkaWZmZXJlbnQgYmxvY2sgdHlwZXMgY29ycmVjdGx5JywgYXN5bmMgKCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgYmxvY2tDb25maWdzID0ge1xuICAgICAgICAgICAgICAgIHF1ZXJ5OiB7XG4gICAgICAgICAgICAgICAgICAgIHR5cGU6ICdxdWVyeScsXG4gICAgICAgICAgICAgICAgICAgIHF1ZXJ5OiAnU0VMRUNUICogV0hFUkUgeyA/cyA/cCA/byB9JyxcbiAgICAgICAgICAgICAgICAgICAgbWF4UmVzdWx0czogNTBcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIHByb3BlcnRpZXM6IHtcbiAgICAgICAgICAgICAgICAgICAgdHlwZTogJ3Byb3BlcnRpZXMnLFxuICAgICAgICAgICAgICAgICAgICBpbmNsdWRlZFByb3BlcnRpZXM6IFsnbmFtZSddLFxuICAgICAgICAgICAgICAgICAgICBlZGl0YWJsZVByb3BlcnRpZXM6IFtdXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICByZWxhdGlvbnM6IHtcbiAgICAgICAgICAgICAgICAgICAgdHlwZTogJ3JlbGF0aW9ucycsXG4gICAgICAgICAgICAgICAgICAgIHJlbGF0aW9uUHJvcGVydHk6ICdyZWxhdGVkVG8nLFxuICAgICAgICAgICAgICAgICAgICBzaG93QmFja2xpbmtzOiB0cnVlXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBiYWNrbGlua3M6IHtcbiAgICAgICAgICAgICAgICAgICAgdHlwZTogJ2JhY2tsaW5rcycsXG4gICAgICAgICAgICAgICAgICAgIG1heFJlc3VsdHM6IDI1XG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBjdXN0b206IHtcbiAgICAgICAgICAgICAgICAgICAgdHlwZTogJ2N1c3RvbScsXG4gICAgICAgICAgICAgICAgICAgIHRlbXBsYXRlUGF0aDogJ3RlbXBsYXRlcy9jdXN0b20ubWQnXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgT2JqZWN0LmVudHJpZXMoYmxvY2tDb25maWdzKS5mb3JFYWNoKChbdHlwZSwgY29uZmlnXSkgPT4ge1xuICAgICAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IChyZXBvc2l0b3J5IGFzIGFueSkucGFyc2VCbG9ja0NvbmZpZyh0eXBlLCBjb25maWcpO1xuICAgICAgICAgICAgICAgIGV4cGVjdChyZXN1bHQudHlwZSkudG9CZSh0eXBlKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICB9KTtcblxuICAgIGRlc2NyaWJlKCdFcnJvciBIYW5kbGluZyBhbmQgRWRnZSBDYXNlcycsICgpID0+IHtcbiAgICAgICAgaXQoJ3Nob3VsZCBoYW5kbGUgdmF1bHQgZ2V0RmlsZXMgZXJyb3IgZ3JhY2VmdWxseScsIGFzeW5jICgpID0+IHtcbiAgICAgICAgICAgIG1vY2tWYXVsdC5nZXRGaWxlcy5tb2NrSW1wbGVtZW50YXRpb24oKCkgPT4ge1xuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignVmF1bHQgZXJyb3InKTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBhd2FpdCBleHBlY3QocmVwb3NpdG9yeS5maW5kQWxsKCkpLnJlamVjdHMudG9UaHJvdygnVmF1bHQgZXJyb3InKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgaXQoJ3Nob3VsZCBoYW5kbGUgbWV0YWRhdGEgY2FjaGUgZXJyb3JzIGdyYWNlZnVsbHknLCBhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBtb2NrRmlsZSA9IG5ldyBURmlsZSgndGVzdC5tZCcpO1xuICAgICAgICAgICAgbW9ja1ZhdWx0LmdldEZpbGVzLm1vY2tSZXR1cm5WYWx1ZShbbW9ja0ZpbGVdKTtcbiAgICAgICAgICAgIG1vY2tNZXRhZGF0YUNhY2hlLmdldEZpbGVDYWNoZS5tb2NrSW1wbGVtZW50YXRpb24oKCkgPT4ge1xuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignTWV0YWRhdGEgZXJyb3InKTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBhd2FpdCBleHBlY3QocmVwb3NpdG9yeS5maW5kQWxsKCkpLnJlamVjdHMudG9UaHJvdygnTWV0YWRhdGEgZXJyb3InKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgaXQoJ3Nob3VsZCBoYW5kbGUgbWFsZm9ybWVkIGJsb2NrIGNvbmZpZ3VyYXRpb25zJywgYXN5bmMgKCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgbWFsZm9ybWVkQmxvY2tzID0gW1xuICAgICAgICAgICAgICAgIG51bGwsXG4gICAgICAgICAgICAgICAgdW5kZWZpbmVkLFxuICAgICAgICAgICAgICAgIHsgLyogbWlzc2luZyByZXF1aXJlZCBmaWVsZHMgKi8gfSxcbiAgICAgICAgICAgICAgICB7IGlkOiAndGVzdCcsIC8qIG1pc3NpbmcgdHlwZSAqLyB9XG4gICAgICAgICAgICBdO1xuXG4gICAgICAgICAgICBjb25zdCByZXN1bHQgPSAocmVwb3NpdG9yeSBhcyBhbnkpLnBhcnNlQmxvY2tzKG1hbGZvcm1lZEJsb2Nrcyk7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIC8vIFNob3VsZCBmaWx0ZXIgb3V0IGludmFsaWQgYmxvY2tzIGFuZCBhc3NpZ24gZGVmYXVsdHNcbiAgICAgICAgICAgIGV4cGVjdChBcnJheS5pc0FycmF5KHJlc3VsdCkpLnRvQmUodHJ1ZSk7XG4gICAgICAgICAgICByZXN1bHQuZm9yRWFjaChibG9jayA9PiB7XG4gICAgICAgICAgICAgICAgZXhwZWN0KGJsb2NrLmlkKS50b0JlRGVmaW5lZCgpO1xuICAgICAgICAgICAgICAgIGV4cGVjdChibG9jay50eXBlKS50b0JlRGVmaW5lZCgpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGl0KCdzaG91bGQgaGFuZGxlIG5vbi1hcnJheSBibG9ja3MgZGF0YScsIGFzeW5jICgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IChyZXBvc2l0b3J5IGFzIGFueSkucGFyc2VCbG9ja3MoJ25vdC1hbi1hcnJheScpO1xuICAgICAgICAgICAgZXhwZWN0KHJlc3VsdCkudG9FcXVhbChbXSk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGl0KCdzaG91bGQgaGFuZGxlIGVtcHR5IG9yIG51bGwgcHJvcGVydHkgZmlsdGVycycsIGFzeW5jICgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IChyZXBvc2l0b3J5IGFzIGFueSkucGFyc2VQcm9wZXJ0eUZpbHRlcnMobnVsbCk7XG4gICAgICAgICAgICBleHBlY3QocmVzdWx0KS50b0VxdWFsKFtdKTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgY29uc3QgcmVzdWx0MiA9IChyZXBvc2l0b3J5IGFzIGFueSkucGFyc2VQcm9wZXJ0eUZpbHRlcnMoJ25vdC1hbi1hcnJheScpO1xuICAgICAgICAgICAgZXhwZWN0KHJlc3VsdDIpLnRvRXF1YWwoW10pO1xuICAgICAgICB9KTtcblxuICAgICAgICBpdCgnc2hvdWxkIGNsZWFuIGNsYXNzIG5hbWVzIGNvcnJlY3RseScsIGFzeW5jICgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHRlc3RDYXNlcyA9IFtcbiAgICAgICAgICAgICAgICB7IGlucHV0OiAnW1tUZXN0Q2xhc3NdXScsIGV4cGVjdGVkOiAnVGVzdENsYXNzJyB9LFxuICAgICAgICAgICAgICAgIHsgaW5wdXQ6ICdUZXN0Q2xhc3MnLCBleHBlY3RlZDogJ1Rlc3RDbGFzcycgfSxcbiAgICAgICAgICAgICAgICB7IGlucHV0OiBbJ1tbVGVzdENsYXNzXV0nXSwgZXhwZWN0ZWQ6ICdUZXN0Q2xhc3MnIH0sXG4gICAgICAgICAgICAgICAgeyBpbnB1dDogbnVsbCwgZXhwZWN0ZWQ6ICcnIH0sXG4gICAgICAgICAgICAgICAgeyBpbnB1dDogdW5kZWZpbmVkLCBleHBlY3RlZDogJycgfVxuICAgICAgICAgICAgXTtcblxuICAgICAgICAgICAgdGVzdENhc2VzLmZvckVhY2goKHsgaW5wdXQsIGV4cGVjdGVkIH0pID0+IHtcbiAgICAgICAgICAgICAgICBjb25zdCByZXN1bHQgPSAocmVwb3NpdG9yeSBhcyBhbnkpLmNsZWFuQ2xhc3NOYW1lKGlucHV0KTtcbiAgICAgICAgICAgICAgICBleHBlY3QocmVzdWx0KS50b0JlKGV4cGVjdGVkKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICB9KTtcblxuICAgIGRlc2NyaWJlKCdQZXJmb3JtYW5jZSBhbmQgQ29uY3VycmVuY3knLCAoKSA9PiB7XG4gICAgICAgIGl0KCdzaG91bGQgaGFuZGxlIGNvbmN1cnJlbnQgY2FjaGUgYWNjZXNzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgICAgICAgc2V0dXBNb2NrTGF5b3V0RmlsZXMoKTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgY29uc3QgcHJvbWlzZXMgPSBbXG4gICAgICAgICAgICAgICAgcmVwb3NpdG9yeS5maW5kQWxsKCksXG4gICAgICAgICAgICAgICAgcmVwb3NpdG9yeS5maW5kQWxsKCksXG4gICAgICAgICAgICAgICAgcmVwb3NpdG9yeS5maW5kQWxsKClcbiAgICAgICAgICAgIF07XG5cbiAgICAgICAgICAgIGNvbnN0IHJlc3VsdHMgPSBhd2FpdCBQcm9taXNlLmFsbChwcm9taXNlcyk7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIC8vIEFsbCBzaG91bGQgc3VjY2VlZCBhbmQgcmV0dXJuIHRoZSBzYW1lIHN0cnVjdHVyZVxuICAgICAgICAgICAgcmVzdWx0cy5mb3JFYWNoKHJlc3VsdCA9PiB7XG4gICAgICAgICAgICAgICAgZXhwZWN0KEFycmF5LmlzQXJyYXkocmVzdWx0KSkudG9CZSh0cnVlKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcblxuICAgICAgICBpdCgnc2hvdWxkIGhhbmRsZSBjb25jdXJyZW50IHNhdmUgb3BlcmF0aW9ucycsIGFzeW5jICgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGNsYXNzTmFtZSA9IENsYXNzTmFtZS5jcmVhdGUoJ1Rlc3RDbGFzcycpLmdldFZhbHVlKCk7XG4gICAgICAgICAgICBjb25zdCBsYXlvdXRzID0gW1xuICAgICAgICAgICAgICAgIGNyZWF0ZU1vY2tMYXlvdXQoJ2NvbmN1cnJlbnQxJywgY2xhc3NOYW1lKSxcbiAgICAgICAgICAgICAgICBjcmVhdGVNb2NrTGF5b3V0KCdjb25jdXJyZW50MicsIGNsYXNzTmFtZSksXG4gICAgICAgICAgICAgICAgY3JlYXRlTW9ja0xheW91dCgnY29uY3VycmVudDMnLCBjbGFzc05hbWUpXG4gICAgICAgICAgICBdO1xuXG4gICAgICAgICAgICBjb25zdCBwcm9taXNlcyA9IGxheW91dHMubWFwKGxheW91dCA9PiByZXBvc2l0b3J5LnNhdmUobGF5b3V0KSk7XG4gICAgICAgICAgICBhd2FpdCBQcm9taXNlLmFsbChwcm9taXNlcyk7XG5cbiAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHJlcG9zaXRvcnkuZmluZEJ5Q2xhc3MoY2xhc3NOYW1lKTtcbiAgICAgICAgICAgIGV4cGVjdChyZXN1bHQpLnRvSGF2ZUxlbmd0aCgzKTtcbiAgICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICAvLyBIZWxwZXIgZnVuY3Rpb25zXG4gICAgZnVuY3Rpb24gY3JlYXRlTW9ja0xheW91dChpZDogc3RyaW5nLCB0YXJnZXRDbGFzczogQ2xhc3NOYW1lLCBpc0VuYWJsZWQ6IGJvb2xlYW4gPSB0cnVlLCBwcmlvcml0eTogbnVtYmVyID0gMSk6IGFueSB7XG4gICAgICAgIGNvbnN0IGFzc2V0SWQgPSB7XG4gICAgICAgICAgICBlcXVhbHM6IChvdGhlcjogYW55KSA9PiBvdGhlciAmJiBvdGhlci50b1N0cmluZyAmJiBvdGhlci50b1N0cmluZygpID09PSBpZCxcbiAgICAgICAgICAgIHRvU3RyaW5nOiAoKSA9PiBpZFxuICAgICAgICB9O1xuICAgICAgICBcbiAgICAgICAgY29uc3QgdGFyZ2V0Q2xhc3NPYmplY3QgPSB7XG4gICAgICAgICAgICBlcXVhbHM6IChvdGhlcjogQ2xhc3NOYW1lKSA9PiBvdGhlciAmJiBvdGhlci52YWx1ZSA9PT0gdGFyZ2V0Q2xhc3MudmFsdWUsXG4gICAgICAgICAgICB2YWx1ZTogdGFyZ2V0Q2xhc3MudmFsdWVcbiAgICAgICAgfTtcbiAgICAgICAgXG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBpZDogYXNzZXRJZCxcbiAgICAgICAgICAgIHRhcmdldENsYXNzOiB0YXJnZXRDbGFzc09iamVjdCxcbiAgICAgICAgICAgIGlzRW5hYmxlZCxcbiAgICAgICAgICAgIHByaW9yaXR5LFxuICAgICAgICAgICAgYmxvY2tzOiBbXSBhcyBMYXlvdXRCbG9ja0NvbmZpZ1tdXG4gICAgICAgIH07XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gc2V0dXBNb2NrTGF5b3V0RmlsZXMoKSB7XG4gICAgICAgIG1vY2tWYXVsdC5nZXRGaWxlcy5tb2NrUmV0dXJuVmFsdWUoW10pO1xuICAgIH1cblxuICAgIGRlc2NyaWJlKCdEYXRhIENvbnNpc3RlbmN5IGFuZCBWYWxpZGF0aW9uJywgKCkgPT4ge1xuICAgICAgICBpdCgnc2hvdWxkIHZhbGlkYXRlIGxheW91dCBkYXRhIGNvbnNpc3RlbmN5IGFjcm9zcyBvcGVyYXRpb25zJywgYXN5bmMgKCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgY2xhc3NOYW1lID0gQ2xhc3NOYW1lLmNyZWF0ZSgnQ29uc2lzdGVuY3lUZXN0JykuZ2V0VmFsdWUoKTtcbiAgICAgICAgICAgIGNvbnN0IG9yaWdpbmFsTGF5b3V0ID0gY3JlYXRlTW9ja0xheW91dCgnY29uc2lzdGVuY3ktdGVzdCcsIGNsYXNzTmFtZSwgdHJ1ZSwgNSk7XG4gICAgICAgICAgICBvcmlnaW5hbExheW91dC5ibG9ja3MgPSBbXG4gICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICBpZDogJ3Rlc3QtYmxvY2snLFxuICAgICAgICAgICAgICAgICAgICB0eXBlOiAncHJvcGVydGllcycsXG4gICAgICAgICAgICAgICAgICAgIHRpdGxlOiAnVGVzdCBQcm9wZXJ0aWVzJyxcbiAgICAgICAgICAgICAgICAgICAgb3JkZXI6IDAsXG4gICAgICAgICAgICAgICAgICAgIGNvbmZpZzogeyBpbmNsdWRlZFByb3BlcnRpZXM6IFsnbmFtZScsICdkZXNjcmlwdGlvbiddIH0sXG4gICAgICAgICAgICAgICAgICAgIGlzVmlzaWJsZTogdHJ1ZVxuICAgICAgICAgICAgICAgIH0gYXMgTGF5b3V0QmxvY2tDb25maWdcbiAgICAgICAgICAgIF07XG5cbiAgICAgICAgICAgIC8vIFNhdmUgbGF5b3V0XG4gICAgICAgICAgICBhd2FpdCByZXBvc2l0b3J5LnNhdmUob3JpZ2luYWxMYXlvdXQpO1xuXG4gICAgICAgICAgICAvLyBSZXRyaWV2ZSBhbmQgdmVyaWZ5XG4gICAgICAgICAgICBjb25zdCByZXRyaWV2ZWQgPSBhd2FpdCByZXBvc2l0b3J5LmZpbmRCeUlkKG9yaWdpbmFsTGF5b3V0LmlkKTtcbiAgICAgICAgICAgIGV4cGVjdChyZXRyaWV2ZWQpLnRvQmVEZWZpbmVkKCk7XG4gICAgICAgICAgICBleHBlY3QocmV0cmlldmVkPy50YXJnZXRDbGFzcy52YWx1ZSkudG9CZShjbGFzc05hbWUudmFsdWUpO1xuICAgICAgICAgICAgZXhwZWN0KHJldHJpZXZlZD8ucHJpb3JpdHkpLnRvQmUoNSk7XG4gICAgICAgICAgICBleHBlY3QocmV0cmlldmVkPy5pc0VuYWJsZWQpLnRvQmUodHJ1ZSk7XG4gICAgICAgICAgICBleHBlY3QocmV0cmlldmVkPy5ibG9ja3MpLnRvSGF2ZUxlbmd0aCgxKTtcblxuICAgICAgICAgICAgLy8gVXBkYXRlIGxheW91dFxuICAgICAgICAgICAgY29uc3QgdXBkYXRlZExheW91dCA9IHsgLi4ub3JpZ2luYWxMYXlvdXQsIHByaW9yaXR5OiAxMCwgaXNFbmFibGVkOiBmYWxzZSB9O1xuICAgICAgICAgICAgYXdhaXQgcmVwb3NpdG9yeS5zYXZlKHVwZGF0ZWRMYXlvdXQpO1xuXG4gICAgICAgICAgICAvLyBWZXJpZnkgdXBkYXRlXG4gICAgICAgICAgICBjb25zdCBhZnRlclVwZGF0ZSA9IGF3YWl0IHJlcG9zaXRvcnkuZmluZEJ5SWQob3JpZ2luYWxMYXlvdXQuaWQpO1xuICAgICAgICAgICAgZXhwZWN0KGFmdGVyVXBkYXRlPy5wcmlvcml0eSkudG9CZSgxMCk7XG4gICAgICAgICAgICBleHBlY3QoYWZ0ZXJVcGRhdGU/LmlzRW5hYmxlZCkudG9CZShmYWxzZSk7XG5cbiAgICAgICAgICAgIC8vIFZlcmlmeSBpdCBkb2Vzbid0IGFwcGVhciBpbiBlbmFibGVkIGxheW91dHNcbiAgICAgICAgICAgIGNvbnN0IGVuYWJsZWRMYXlvdXRzID0gYXdhaXQgcmVwb3NpdG9yeS5maW5kRW5hYmxlZEJ5Q2xhc3MoY2xhc3NOYW1lKTtcbiAgICAgICAgICAgIGV4cGVjdChlbmFibGVkTGF5b3V0cykudG9IYXZlTGVuZ3RoKDApO1xuXG4gICAgICAgICAgICAvLyBWZXJpZnkgaXQgc3RpbGwgYXBwZWFycyBpbiBhbGwgbGF5b3V0cyBmb3IgY2xhc3NcbiAgICAgICAgICAgIGNvbnN0IGFsbENsYXNzTGF5b3V0cyA9IGF3YWl0IHJlcG9zaXRvcnkuZmluZEJ5Q2xhc3MoY2xhc3NOYW1lKTtcbiAgICAgICAgICAgIGV4cGVjdChhbGxDbGFzc0xheW91dHMpLnRvSGF2ZUxlbmd0aCgwKTsgLy8gRmlsdGVyZWQgb3V0IGJlY2F1c2UgZGlzYWJsZWRcbiAgICAgICAgfSk7XG5cbiAgICAgICAgaXQoJ3Nob3VsZCBoYW5kbGUgbGF5b3V0IHByaW9yaXR5IGNvbmZsaWN0cyBncmFjZWZ1bGx5JywgYXN5bmMgKCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgY2xhc3NOYW1lID0gQ2xhc3NOYW1lLmNyZWF0ZSgnUHJpb3JpdHlUZXN0JykuZ2V0VmFsdWUoKTtcbiAgICAgICAgICAgIGNvbnN0IGxheW91dHMgPSBbXG4gICAgICAgICAgICAgICAgY3JlYXRlTW9ja0xheW91dCgncHJpb3JpdHkxJywgY2xhc3NOYW1lLCB0cnVlLCAxKSxcbiAgICAgICAgICAgICAgICBjcmVhdGVNb2NrTGF5b3V0KCdwcmlvcml0eTInLCBjbGFzc05hbWUsIHRydWUsIDEpLCAvLyBTYW1lIHByaW9yaXR5XG4gICAgICAgICAgICAgICAgY3JlYXRlTW9ja0xheW91dCgncHJpb3JpdHkzJywgY2xhc3NOYW1lLCB0cnVlLCAyKSxcbiAgICAgICAgICAgICAgICBjcmVhdGVNb2NrTGF5b3V0KCdwcmlvcml0eTQnLCBjbGFzc05hbWUsIHRydWUsIDIpLCAvLyBTYW1lIHByaW9yaXR5XG4gICAgICAgICAgICAgICAgY3JlYXRlTW9ja0xheW91dCgncHJpb3JpdHk1JywgY2xhc3NOYW1lLCB0cnVlLCAzKVxuICAgICAgICAgICAgXTtcblxuICAgICAgICAgICAgLy8gU2F2ZSBhbGwgbGF5b3V0c1xuICAgICAgICAgICAgYXdhaXQgUHJvbWlzZS5hbGwobGF5b3V0cy5tYXAobGF5b3V0ID0+IHJlcG9zaXRvcnkuc2F2ZShsYXlvdXQpKSk7XG5cbiAgICAgICAgICAgIC8vIFJldHJpZXZlIHNvcnRlZCBieSBwcmlvcml0eVxuICAgICAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgcmVwb3NpdG9yeS5maW5kQnlDbGFzcyhjbGFzc05hbWUpO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICBleHBlY3QocmVzdWx0KS50b0hhdmVMZW5ndGgoNSk7XG4gICAgICAgICAgICBleHBlY3QocmVzdWx0WzBdLnByaW9yaXR5KS50b0JlKDMpOyAvLyBIaWdoZXN0IHByaW9yaXR5IGZpcnN0XG4gICAgICAgICAgICBleHBlY3QocmVzdWx0WzFdLnByaW9yaXR5KS50b0JlKDIpO1xuICAgICAgICAgICAgZXhwZWN0KHJlc3VsdFsyXS5wcmlvcml0eSkudG9CZSgyKTtcbiAgICAgICAgICAgIGV4cGVjdChyZXN1bHRbM10ucHJpb3JpdHkpLnRvQmUoMSk7XG4gICAgICAgICAgICBleHBlY3QocmVzdWx0WzRdLnByaW9yaXR5KS50b0JlKDEpO1xuICAgICAgICB9KTtcblxuICAgICAgICBpdCgnc2hvdWxkIG1haW50YWluIGRhdGEgaW50ZWdyaXR5IGR1cmluZyBjb25jdXJyZW50IG1vZGlmaWNhdGlvbnMnLCBhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBjbGFzc05hbWUgPSBDbGFzc05hbWUuY3JlYXRlKCdDb25jdXJyZW50TW9kJykuZ2V0VmFsdWUoKTtcbiAgICAgICAgICAgIGNvbnN0IGJhc2VMYXlvdXQgPSBjcmVhdGVNb2NrTGF5b3V0KCdjb25jdXJyZW50LWJhc2UnLCBjbGFzc05hbWUsIHRydWUsIDEpO1xuXG4gICAgICAgICAgICAvLyBTaW11bGF0ZSBjb25jdXJyZW50IHNhdmUgb3BlcmF0aW9ucyB3aXRob3V0IHNldFRpbWVvdXQgKHdoaWNoIGRvZXNuJ3Qgd29yayB3ZWxsIHdpdGggZmFrZSB0aW1lcnMpXG4gICAgICAgICAgICBjb25zdCBtb2RpZmljYXRpb25zID0gW1xuICAgICAgICAgICAgICAgIHsgLi4uYmFzZUxheW91dCwgcHJpb3JpdHk6IDUgfSxcbiAgICAgICAgICAgICAgICB7IC4uLmJhc2VMYXlvdXQsIHByaW9yaXR5OiAzIH0sXG4gICAgICAgICAgICAgICAgeyAuLi5iYXNlTGF5b3V0LCBpc0VuYWJsZWQ6IGZhbHNlIH0sXG4gICAgICAgICAgICAgICAgeyAuLi5iYXNlTGF5b3V0LCBwcmlvcml0eTogNywgaXNFbmFibGVkOiB0cnVlIH1cbiAgICAgICAgICAgIF07XG5cbiAgICAgICAgICAgIC8vIFVzZSBQcm9taXNlLnJlc29sdmUgdG8gY3JlYXRlIHByb3BlciBhc3luYyBiZWhhdmlvclxuICAgICAgICAgICAgY29uc3Qgc2F2ZVByb21pc2VzID0gbW9kaWZpY2F0aW9ucy5tYXAoKG1vZCkgPT4gXG4gICAgICAgICAgICAgICAgUHJvbWlzZS5yZXNvbHZlKCkudGhlbigoKSA9PiByZXBvc2l0b3J5LnNhdmUobW9kKSlcbiAgICAgICAgICAgICk7XG5cbiAgICAgICAgICAgIGF3YWl0IFByb21pc2UuYWxsKHNhdmVQcm9taXNlcyk7XG5cbiAgICAgICAgICAgIC8vIEZpbmFsIHN0YXRlIHNob3VsZCByZWZsZWN0IG9uZSBvZiB0aGUgY29uY3VycmVudCBvcGVyYXRpb25zXG4gICAgICAgICAgICBjb25zdCBmaW5hbFN0YXRlID0gYXdhaXQgcmVwb3NpdG9yeS5maW5kQnlJZChiYXNlTGF5b3V0LmlkKTtcbiAgICAgICAgICAgIGV4cGVjdChmaW5hbFN0YXRlKS50b0JlRGVmaW5lZCgpO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICAvLyBTaG91bGQgaGF2ZSBvbmUgb2YgdGhlIGV4cGVjdGVkIHN0YXRlc1xuICAgICAgICAgICAgY29uc3QgZXhwZWN0ZWRTdGF0ZXMgPSBtb2RpZmljYXRpb25zLm1hcChtb2QgPT4gKHtcbiAgICAgICAgICAgICAgICBwcmlvcml0eTogbW9kLnByaW9yaXR5LFxuICAgICAgICAgICAgICAgIGlzRW5hYmxlZDogbW9kLmlzRW5hYmxlZFxuICAgICAgICAgICAgfSkpO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICBjb25zdCBhY3R1YWxTdGF0ZSA9IHtcbiAgICAgICAgICAgICAgICBwcmlvcml0eTogZmluYWxTdGF0ZT8ucHJpb3JpdHksXG4gICAgICAgICAgICAgICAgaXNFbmFibGVkOiBmaW5hbFN0YXRlPy5pc0VuYWJsZWRcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGV4cGVjdChleHBlY3RlZFN0YXRlcykudG9Db250YWluRXF1YWwoYWN0dWFsU3RhdGUpO1xuICAgICAgICB9LCAxMDAwMCk7IC8vIEFkZCByZWFzb25hYmxlIHRpbWVvdXRcblxuICAgICAgICBpdCgnc2hvdWxkIGhhbmRsZSByZXBvc2l0b3J5IHN0YXRlIGFmdGVyIG11bHRpcGxlIGNhY2hlIHJlZnJlc2hlcycsIGFzeW5jICgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGNsYXNzTmFtZSA9IENsYXNzTmFtZS5jcmVhdGUoJ0NhY2hlUmVmcmVzaFRlc3QnKS5nZXRWYWx1ZSgpO1xuICAgICAgICAgICAgY29uc3QgcGVyc2lzdGVudExheW91dCA9IGNyZWF0ZU1vY2tMYXlvdXQoJ3BlcnNpc3RlbnQnLCBjbGFzc05hbWUsIHRydWUsIDEpO1xuICAgICAgICAgICAgY29uc3QgdHJhbnNpZW50TGF5b3V0ID0gY3JlYXRlTW9ja0xheW91dCgndHJhbnNpZW50JywgY2xhc3NOYW1lLCB0cnVlLCAyKTtcblxuICAgICAgICAgICAgLy8gU2V0dXAgaW5pdGlhbCBtb2NrIHJlc3BvbnNlXG4gICAgICAgICAgICBtb2NrVmF1bHQuZ2V0RmlsZXMubW9ja1JldHVyblZhbHVlKFtdKTtcblxuICAgICAgICAgICAgLy8gU2F2ZSBsYXlvdXRzIHRvIG1lbW9yeS1vbmx5IGNhY2hlXG4gICAgICAgICAgICBhd2FpdCByZXBvc2l0b3J5LnNhdmUocGVyc2lzdGVudExheW91dCk7XG4gICAgICAgICAgICBhd2FpdCByZXBvc2l0b3J5LnNhdmUodHJhbnNpZW50TGF5b3V0KTtcblxuICAgICAgICAgICAgLy8gVmVyaWZ5IGluaXRpYWwgc3RhdGVcbiAgICAgICAgICAgIGxldCBsYXlvdXRzID0gYXdhaXQgcmVwb3NpdG9yeS5maW5kQnlDbGFzcyhjbGFzc05hbWUpO1xuICAgICAgICAgICAgZXhwZWN0KGxheW91dHMpLnRvSGF2ZUxlbmd0aCgyKTtcblxuICAgICAgICAgICAgLy8gRm9yY2UgY2FjaGUgcmVmcmVzaCBieSBhZHZhbmNpbmcgdGltZVxuICAgICAgICAgICAgamVzdC5hZHZhbmNlVGltZXJzQnlUaW1lKDM1MDAwKTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgLy8gTW9jayBmaWxlIHN5c3RlbSByZXR1cm5pbmcgZW1wdHkgKHNpbXVsYXRpbmcgYWxsIGxheW91dHMgcmVtb3ZlZClcbiAgICAgICAgICAgIG1vY2tWYXVsdC5nZXRGaWxlcy5tb2NrUmV0dXJuVmFsdWUoW10pO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICBsYXlvdXRzID0gYXdhaXQgcmVwb3NpdG9yeS5maW5kQnlDbGFzcyhjbGFzc05hbWUpO1xuXG4gICAgICAgICAgICAvLyBBZnRlciBpbXBsZW1lbnRhdGlvbiBjaGFuZ2VzLCBtYW51YWxseSBhZGRlZCBsYXlvdXRzIGFyZSBwcmVzZXJ2ZWRcbiAgICAgICAgICAgIC8vIFRoaXMgcmVmbGVjdHMgdGhlIG5ldyBiZWhhdmlvciB3aGVyZSBpbi1tZW1vcnkgbGF5b3V0cyBwZXJzaXN0XG4gICAgICAgICAgICBleHBlY3QobGF5b3V0cykudG9IYXZlTGVuZ3RoKDIpO1xuICAgICAgICB9KTtcbiAgICB9KTtcblxuICAgIGRlc2NyaWJlKCdNZW1vcnkgTWFuYWdlbWVudCBhbmQgUGVyZm9ybWFuY2UnLCAoKSA9PiB7XG4gICAgICAgIGl0KCdzaG91bGQgaGFuZGxlIGxhcmdlIGNhY2hlIHNpemVzIGVmZmljaWVudGx5JywgYXN5bmMgKCkgPT4ge1xuICAgICAgICAgICAgLy8gU2V0dXAgbW9jayB0byByZXR1cm4gZW1wdHkgYXJyYXkgZm9yIGdldEZpbGVzIHRvIGF2b2lkIGZpbHRlciBlcnJvclxuICAgICAgICAgICAgbW9ja1ZhdWx0LmdldEZpbGVzLm1vY2tSZXR1cm5WYWx1ZShbXSk7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGNvbnN0IHN0YXJ0VGltZSA9IERhdGUubm93KCk7XG4gICAgICAgICAgICBjb25zdCBsYXJnZURhdGFzZXQ6IGFueVtdID0gW107XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIC8vIENyZWF0ZSBsYXJnZSBkYXRhc2V0XG4gICAgICAgICAgICBmb3IgKGxldCBjbGFzc0luZGV4ID0gMDsgY2xhc3NJbmRleCA8IDEwOyBjbGFzc0luZGV4KyspIHtcbiAgICAgICAgICAgICAgICBjb25zdCBjbGFzc05hbWUgPSBDbGFzc05hbWUuY3JlYXRlKGBDbGFzcyR7Y2xhc3NJbmRleH1gKS5nZXRWYWx1ZSgpO1xuICAgICAgICAgICAgICAgIGZvciAobGV0IGxheW91dEluZGV4ID0gMDsgbGF5b3V0SW5kZXggPCA1OyBsYXlvdXRJbmRleCsrKSB7XG4gICAgICAgICAgICAgICAgICAgIGxhcmdlRGF0YXNldC5wdXNoKGNyZWF0ZU1vY2tMYXlvdXQoXG4gICAgICAgICAgICAgICAgICAgICAgICBgY2xhc3Mke2NsYXNzSW5kZXh9LWxheW91dCR7bGF5b3V0SW5kZXh9YCxcbiAgICAgICAgICAgICAgICAgICAgICAgIGNsYXNzTmFtZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGxheW91dEluZGV4ICUgMiA9PT0gMCwgLy8gQWx0ZXJuYXRlIGVuYWJsZWQvZGlzYWJsZWRcbiAgICAgICAgICAgICAgICAgICAgICAgIGxheW91dEluZGV4ICsgMVxuICAgICAgICAgICAgICAgICAgICApKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIFNhdmUgYWxsIGxheW91dHMgKDUwIGxheW91dHMgdG90YWwpXG4gICAgICAgICAgICBhd2FpdCBQcm9taXNlLmFsbChsYXJnZURhdGFzZXQubWFwKGxheW91dCA9PiByZXBvc2l0b3J5LnNhdmUobGF5b3V0KSkpO1xuXG4gICAgICAgICAgICBjb25zdCBzYXZlVGltZSA9IERhdGUubm93KCk7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIC8vIFBlcmZvcm0gdmFyaW91cyBvcGVyYXRpb25zXG4gICAgICAgICAgICBjb25zdCBhbGxMYXlvdXRzID0gYXdhaXQgcmVwb3NpdG9yeS5maW5kQWxsKCk7XG4gICAgICAgICAgICBjb25zdCBjbGFzczFMYXlvdXRzID0gYXdhaXQgcmVwb3NpdG9yeS5maW5kQnlDbGFzcyhDbGFzc05hbWUuY3JlYXRlKCdDbGFzczEnKS5nZXRWYWx1ZSgpKTtcbiAgICAgICAgICAgIGNvbnN0IGVuYWJsZWRDbGFzczEgPSBhd2FpdCByZXBvc2l0b3J5LmZpbmRFbmFibGVkQnlDbGFzcyhDbGFzc05hbWUuY3JlYXRlKCdDbGFzczEnKS5nZXRWYWx1ZSgpKTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgY29uc3Qgb3BlcmF0aW9uVGltZSA9IERhdGUubm93KCk7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIC8vIFZlcmlmeSByZXN1bHRzXG4gICAgICAgICAgICBleHBlY3QoYWxsTGF5b3V0cykudG9IYXZlTGVuZ3RoKDUwKTtcbiAgICAgICAgICAgIGV4cGVjdChjbGFzczFMYXlvdXRzKS50b0hhdmVMZW5ndGgoMyk7IC8vIE9ubHkgZW5hYmxlZCBsYXlvdXRzIChpbmRpY2VzIDAsIDIsIDQpXG4gICAgICAgICAgICBleHBlY3QoZW5hYmxlZENsYXNzMSkudG9IYXZlTGVuZ3RoKDMpO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICAvLyBQZXJmb3JtYW5jZSBhc3NlcnRpb25zIChvcGVyYXRpb25zIHNob3VsZCBjb21wbGV0ZSByZWFzb25hYmx5IHF1aWNrbHkpXG4gICAgICAgICAgICBjb25zdCB0b3RhbFRpbWUgPSBvcGVyYXRpb25UaW1lIC0gc3RhcnRUaW1lO1xuICAgICAgICAgICAgZXhwZWN0KHRvdGFsVGltZSkudG9CZUxlc3NUaGFuKDUwMDApOyAvLyBTaG91bGQgY29tcGxldGUgd2l0aGluIDUgc2Vjb25kc1xuICAgICAgICB9KTtcblxuICAgICAgICBpdCgnc2hvdWxkIGNsZWFuIHVwIGNhY2hlIGVmZmljaWVudGx5IGR1cmluZyBkZWxldGUgb3BlcmF0aW9ucycsIGFzeW5jICgpID0+IHtcbiAgICAgICAgICAgIC8vIFNldHVwIG1vY2sgdG8gcmV0dXJuIGVtcHR5IGFycmF5IGZvciBnZXRGaWxlcyB0byBhdm9pZCBmaWx0ZXIgZXJyb3JcbiAgICAgICAgICAgIG1vY2tWYXVsdC5nZXRGaWxlcy5tb2NrUmV0dXJuVmFsdWUoW10pO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICBjb25zdCBjbGFzc05hbWUgPSBDbGFzc05hbWUuY3JlYXRlKCdDbGVhbnVwVGVzdCcpLmdldFZhbHVlKCk7XG4gICAgICAgICAgICBjb25zdCBsYXlvdXRzOiBhbnlbXSA9IFtdO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICAvLyBDcmVhdGUgbW9kZXJhdGUgZGF0YXNldFxuICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCAyMDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgbGF5b3V0cy5wdXNoKGNyZWF0ZU1vY2tMYXlvdXQoYGNsZWFudXAtJHtpfWAsIGNsYXNzTmFtZSwgdHJ1ZSwgaSArIDEpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIFxuICAgICAgICAgICAgLy8gU2F2ZSBhbGwgbGF5b3V0c1xuICAgICAgICAgICAgYXdhaXQgUHJvbWlzZS5hbGwobGF5b3V0cy5tYXAobGF5b3V0ID0+IHJlcG9zaXRvcnkuc2F2ZShsYXlvdXQpKSk7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIC8vIFZlcmlmeSBpbml0aWFsIHN0YXRlXG4gICAgICAgICAgICBsZXQgYWxsTGF5b3V0cyA9IGF3YWl0IHJlcG9zaXRvcnkuZmluZEFsbCgpO1xuICAgICAgICAgICAgZXhwZWN0KGFsbExheW91dHMpLnRvSGF2ZUxlbmd0aCgyMCk7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIC8vIERlbGV0ZSBoYWxmIHRoZSBsYXlvdXRzXG4gICAgICAgICAgICBjb25zdCBsYXlvdXRzVG9EZWxldGUgPSBsYXlvdXRzLnNsaWNlKDAsIDEwKTtcbiAgICAgICAgICAgIGF3YWl0IFByb21pc2UuYWxsKGxheW91dHNUb0RlbGV0ZS5tYXAobGF5b3V0ID0+IHJlcG9zaXRvcnkuZGVsZXRlKGxheW91dC5pZCkpKTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgLy8gVmVyaWZ5IGRlbGV0aW9uc1xuICAgICAgICAgICAgYWxsTGF5b3V0cyA9IGF3YWl0IHJlcG9zaXRvcnkuZmluZEFsbCgpO1xuICAgICAgICAgICAgZXhwZWN0KGFsbExheW91dHMpLnRvSGF2ZUxlbmd0aCgxMCk7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIC8vIFZlcmlmeSBzcGVjaWZpYyBsYXlvdXRzIGFyZSBnb25lXG4gICAgICAgICAgICBmb3IgKGNvbnN0IGRlbGV0ZWRMYXlvdXQgb2YgbGF5b3V0c1RvRGVsZXRlKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgZm91bmQgPSBhd2FpdCByZXBvc2l0b3J5LmZpbmRCeUlkKGRlbGV0ZWRMYXlvdXQuaWQpO1xuICAgICAgICAgICAgICAgIGV4cGVjdChmb3VuZCkudG9CZU51bGwoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIFxuICAgICAgICAgICAgLy8gVmVyaWZ5IHJlbWFpbmluZyBsYXlvdXRzIGFyZSBzdGlsbCBhY2Nlc3NpYmxlXG4gICAgICAgICAgICBjb25zdCByZW1haW5pbmdMYXlvdXRzID0gbGF5b3V0cy5zbGljZSgxMCk7XG4gICAgICAgICAgICBmb3IgKGNvbnN0IHJlbWFpbmluZ0xheW91dCBvZiByZW1haW5pbmdMYXlvdXRzKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgZm91bmQgPSBhd2FpdCByZXBvc2l0b3J5LmZpbmRCeUlkKHJlbWFpbmluZ0xheW91dC5pZCk7XG4gICAgICAgICAgICAgICAgZXhwZWN0KGZvdW5kKS50b0JlKHJlbWFpbmluZ0xheW91dCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH0pO1xufSk7XG4iXSwidmVyc2lvbiI6M30=