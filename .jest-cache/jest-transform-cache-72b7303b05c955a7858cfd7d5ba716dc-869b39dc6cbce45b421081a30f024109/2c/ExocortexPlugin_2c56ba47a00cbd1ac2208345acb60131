0117b12dc5cb6bebd28054c6e2ebc38a
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const obsidian_1 = require("obsidian");
const LifecycleRegistry_1 = require("./infrastructure/lifecycle/LifecycleRegistry");
const CommandRegistry_1 = require("./presentation/command-controllers/CommandRegistry");
const ServiceProvider_1 = require("./infrastructure/providers/ServiceProvider");
const SettingsLifecycleManager_1 = require("./infrastructure/lifecycle/SettingsLifecycleManager");
const GraphLifecycleManager_1 = require("./infrastructure/lifecycle/GraphLifecycleManager");
const ProcessorLifecycleManager_1 = require("./infrastructure/lifecycle/ProcessorLifecycleManager");
const AssetCommandController_1 = require("./presentation/command-controllers/AssetCommandController");
const SPARQLCommandController_1 = require("./presentation/command-controllers/SPARQLCommandController");
const RDFCommandController_1 = require("./presentation/command-controllers/RDFCommandController");
const TaskCommandController_1 = require("./presentation/command-controllers/TaskCommandController");
/**
 * Main Plugin Class following Single Responsibility Principle
 * Single Responsibility: Coordinate plugin initialization and cleanup
 *
 * This refactored version demonstrates:
 * - Single Responsibility Principle: Only handles plugin coordination
 * - Open/Closed Principle: Extensible through registries
 * - Dependency Inversion: Depends on abstractions, not concretions
 * - Interface Segregation: Uses specific interfaces for different concerns
 * - GRASP Patterns: Controller, Creator, Pure Fabrication
 */
class ExocortexPlugin extends obsidian_1.Plugin {
    async onload() {
        try {
            // Initialize registries
            this.lifecycleRegistry = new LifecycleRegistry_1.LifecycleRegistry(this);
            this.commandRegistry = new CommandRegistry_1.CommandRegistry(this);
            // Initialize and register lifecycle managers
            await this.initializeLifecycleManagers();
            // Initialize service provider
            await this.initializeServiceProvider();
            // Initialize and register command controllers
            await this.initializeCommandControllers();
            // Initialize all managers
            await this.lifecycleRegistry.initializeAll();
            // Wire up cache invalidation callback
            this.setupCacheInvalidation();
            // Initialize all commands
            await this.commandRegistry.initializeAll();
            console.log("ðŸ” Exocortex Plugin initialized successfully");
        }
        catch (error) {
            console.error("Failed to initialize Exocortex Plugin:", error);
            throw error;
        }
    }
    async onunload() {
        try {
            // Cleanup in reverse order
            await this.commandRegistry?.cleanupAll();
            await this.serviceProvider?.cleanup();
            await this.lifecycleRegistry?.cleanupAll();
            console.log("ðŸ” Exocortex Plugin cleaned up successfully");
        }
        catch (error) {
            console.error("Error during plugin cleanup:", error);
        }
    }
    /**
     * Get plugin settings (exposed for settings tab)
     */
    get settings() {
        return this.settingsManager?.getSettings();
    }
    /**
     * Save plugin settings (exposed for settings tab)
     */
    async saveSettings() {
        await this.settingsManager?.saveSettings();
        // Update dependent services
        this.serviceProvider?.updateServices(this.settings);
        this.processorManager?.updateCacheConfig(this.settings);
    }
    /**
     * Update container (exposed for settings tab)
     */
    updateContainer() {
        this.serviceProvider?.updateServices(this.settings);
        this.processorManager?.updateCacheConfig(this.settings);
    }
    /**
     * Get SPARQL processor (exposed for testing)
     */
    get sparqlProcessor() {
        return this.processorManager?.getSPARQLProcessor();
    }
    async initializeLifecycleManagers() {
        // Create and register lifecycle managers
        this.settingsManager = new SettingsLifecycleManager_1.SettingsLifecycleManager(this);
        this.graphManager = new GraphLifecycleManager_1.GraphLifecycleManager(this);
        this.lifecycleRegistry.registerManager(this.settingsManager);
        this.lifecycleRegistry.registerManager(this.graphManager);
        // Initialize settings first (others depend on it)
        await this.settingsManager.initialize();
        // Create processor manager (depends on settings and graph)
        this.processorManager = new ProcessorLifecycleManager_1.ProcessorLifecycleManager(this, this.graphManager.getGraph(), this.settingsManager.getSettings());
        this.lifecycleRegistry.registerManager(this.processorManager);
    }
    async initializeServiceProvider() {
        this.serviceProvider = new ServiceProvider_1.ServiceProvider(this, this.graphManager.getGraph(), this.settingsManager.getSettings());
        await this.serviceProvider.initializeServices();
    }
    async initializeCommandControllers() {
        // Create and register command controllers
        const assetController = new AssetCommandController_1.AssetCommandController(this);
        const sparqlController = new SPARQLCommandController_1.SPARQLCommandController(this, this.processorManager.getSPARQLProcessor());
        const rdfController = new RDFCommandController_1.RDFCommandController(this, this.graphManager.getGraph(), this.serviceProvider.getService("RDFService"), this.processorManager.getSPARQLProcessor());
        const taskController = new TaskCommandController_1.TaskCommandController(this, this.graphManager.getGraph());
        this.commandRegistry.registerController(assetController);
        this.commandRegistry.registerController(sparqlController);
        this.commandRegistry.registerController(rdfController);
        this.commandRegistry.registerController(taskController);
    }
    setupCacheInvalidation() {
        // Setup cache invalidation callback from graph to SPARQL processor
        this.graphManager.setCacheInvalidationCallback(() => {
            this.processorManager.getSPARQLProcessor()?.invalidateCache();
        });
    }
}
exports.default = ExocortexPlugin;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL2tpdGVsZXYvRG9jdW1lbnRzL2V4b2NvcnRleC1vYnNpZGlhbi1wbHVnaW4vc3JjL0V4b2NvcnRleFBsdWdpbi50cyIsIm1hcHBpbmdzIjoiOztBQUFBLHVDQUFrQztBQUNsQyxvRkFBaUY7QUFDakYsd0ZBQXFGO0FBQ3JGLGdGQUE2RTtBQUM3RSxrR0FBK0Y7QUFDL0YsNEZBQXlGO0FBQ3pGLG9HQUFpRztBQUNqRyxzR0FBbUc7QUFDbkcsd0dBQXFHO0FBQ3JHLGtHQUErRjtBQUMvRixvR0FBaUc7QUFHakc7Ozs7Ozs7Ozs7R0FVRztBQUNILE1BQXFCLGVBQWdCLFNBQVEsaUJBQU07SUFVakQsS0FBSyxDQUFDLE1BQU07UUFDVixJQUFJO1lBQ0Ysd0JBQXdCO1lBQ3hCLElBQUksQ0FBQyxpQkFBaUIsR0FBRyxJQUFJLHFDQUFpQixDQUFDLElBQUksQ0FBQyxDQUFDO1lBQ3JELElBQUksQ0FBQyxlQUFlLEdBQUcsSUFBSSxpQ0FBZSxDQUFDLElBQUksQ0FBQyxDQUFDO1lBRWpELDZDQUE2QztZQUM3QyxNQUFNLElBQUksQ0FBQywyQkFBMkIsRUFBRSxDQUFDO1lBRXpDLDhCQUE4QjtZQUM5QixNQUFNLElBQUksQ0FBQyx5QkFBeUIsRUFBRSxDQUFDO1lBRXZDLDhDQUE4QztZQUM5QyxNQUFNLElBQUksQ0FBQyw0QkFBNEIsRUFBRSxDQUFDO1lBRTFDLDBCQUEwQjtZQUMxQixNQUFNLElBQUksQ0FBQyxpQkFBaUIsQ0FBQyxhQUFhLEVBQUUsQ0FBQztZQUU3QyxzQ0FBc0M7WUFDdEMsSUFBSSxDQUFDLHNCQUFzQixFQUFFLENBQUM7WUFFOUIsMEJBQTBCO1lBQzFCLE1BQU0sSUFBSSxDQUFDLGVBQWUsQ0FBQyxhQUFhLEVBQUUsQ0FBQztZQUUzQyxPQUFPLENBQUMsR0FBRyxDQUFDLDhDQUE4QyxDQUFDLENBQUM7U0FDN0Q7UUFBQyxPQUFPLEtBQUssRUFBRTtZQUNkLE9BQU8sQ0FBQyxLQUFLLENBQUMsd0NBQXdDLEVBQUUsS0FBSyxDQUFDLENBQUM7WUFDL0QsTUFBTSxLQUFLLENBQUM7U0FDYjtJQUNILENBQUM7SUFFRCxLQUFLLENBQUMsUUFBUTtRQUNaLElBQUk7WUFDRiwyQkFBMkI7WUFDM0IsTUFBTSxJQUFJLENBQUMsZUFBZSxFQUFFLFVBQVUsRUFBRSxDQUFDO1lBQ3pDLE1BQU0sSUFBSSxDQUFDLGVBQWUsRUFBRSxPQUFPLEVBQUUsQ0FBQztZQUN0QyxNQUFNLElBQUksQ0FBQyxpQkFBaUIsRUFBRSxVQUFVLEVBQUUsQ0FBQztZQUUzQyxPQUFPLENBQUMsR0FBRyxDQUFDLDZDQUE2QyxDQUFDLENBQUM7U0FDNUQ7UUFBQyxPQUFPLEtBQUssRUFBRTtZQUNkLE9BQU8sQ0FBQyxLQUFLLENBQUMsOEJBQThCLEVBQUUsS0FBSyxDQUFDLENBQUM7U0FDdEQ7SUFDSCxDQUFDO0lBRUQ7O09BRUc7SUFDSCxJQUFJLFFBQVE7UUFDVixPQUFPLElBQUksQ0FBQyxlQUFlLEVBQUUsV0FBVyxFQUFFLENBQUM7SUFDN0MsQ0FBQztJQUVEOztPQUVHO0lBQ0gsS0FBSyxDQUFDLFlBQVk7UUFDaEIsTUFBTSxJQUFJLENBQUMsZUFBZSxFQUFFLFlBQVksRUFBRSxDQUFDO1FBRTNDLDRCQUE0QjtRQUM1QixJQUFJLENBQUMsZUFBZSxFQUFFLGNBQWMsQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUM7UUFDcEQsSUFBSSxDQUFDLGdCQUFnQixFQUFFLGlCQUFpQixDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQztJQUMxRCxDQUFDO0lBRUQ7O09BRUc7SUFDSCxlQUFlO1FBQ2IsSUFBSSxDQUFDLGVBQWUsRUFBRSxjQUFjLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUFDO1FBQ3BELElBQUksQ0FBQyxnQkFBZ0IsRUFBRSxpQkFBaUIsQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUM7SUFDMUQsQ0FBQztJQUVEOztPQUVHO0lBQ0gsSUFBSSxlQUFlO1FBQ2pCLE9BQU8sSUFBSSxDQUFDLGdCQUFnQixFQUFFLGtCQUFrQixFQUFFLENBQUM7SUFDckQsQ0FBQztJQUVPLEtBQUssQ0FBQywyQkFBMkI7UUFDdkMseUNBQXlDO1FBQ3pDLElBQUksQ0FBQyxlQUFlLEdBQUcsSUFBSSxtREFBd0IsQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUMxRCxJQUFJLENBQUMsWUFBWSxHQUFHLElBQUksNkNBQXFCLENBQUMsSUFBSSxDQUFDLENBQUM7UUFFcEQsSUFBSSxDQUFDLGlCQUFpQixDQUFDLGVBQWUsQ0FBQyxJQUFJLENBQUMsZUFBZSxDQUFDLENBQUM7UUFDN0QsSUFBSSxDQUFDLGlCQUFpQixDQUFDLGVBQWUsQ0FBQyxJQUFJLENBQUMsWUFBWSxDQUFDLENBQUM7UUFFMUQsa0RBQWtEO1FBQ2xELE1BQU0sSUFBSSxDQUFDLGVBQWUsQ0FBQyxVQUFVLEVBQUUsQ0FBQztRQUV4QywyREFBMkQ7UUFDM0QsSUFBSSxDQUFDLGdCQUFnQixHQUFHLElBQUkscURBQXlCLENBQ25ELElBQUksRUFDSixJQUFJLENBQUMsWUFBWSxDQUFDLFFBQVEsRUFBRSxFQUM1QixJQUFJLENBQUMsZUFBZSxDQUFDLFdBQVcsRUFBRSxDQUNuQyxDQUFDO1FBQ0YsSUFBSSxDQUFDLGlCQUFpQixDQUFDLGVBQWUsQ0FBQyxJQUFJLENBQUMsZ0JBQWdCLENBQUMsQ0FBQztJQUNoRSxDQUFDO0lBRU8sS0FBSyxDQUFDLHlCQUF5QjtRQUNyQyxJQUFJLENBQUMsZUFBZSxHQUFHLElBQUksaUNBQWUsQ0FDeEMsSUFBSSxFQUNKLElBQUksQ0FBQyxZQUFZLENBQUMsUUFBUSxFQUFFLEVBQzVCLElBQUksQ0FBQyxlQUFlLENBQUMsV0FBVyxFQUFFLENBQ25DLENBQUM7UUFDRixNQUFNLElBQUksQ0FBQyxlQUFlLENBQUMsa0JBQWtCLEVBQUUsQ0FBQztJQUNsRCxDQUFDO0lBRU8sS0FBSyxDQUFDLDRCQUE0QjtRQUN4QywwQ0FBMEM7UUFDMUMsTUFBTSxlQUFlLEdBQUcsSUFBSSwrQ0FBc0IsQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUN6RCxNQUFNLGdCQUFnQixHQUFHLElBQUksaURBQXVCLENBQ2xELElBQUksRUFDSixJQUFJLENBQUMsZ0JBQWdCLENBQUMsa0JBQWtCLEVBQUUsQ0FDM0MsQ0FBQztRQUNGLE1BQU0sYUFBYSxHQUFHLElBQUksMkNBQW9CLENBQzVDLElBQUksRUFDSixJQUFJLENBQUMsWUFBWSxDQUFDLFFBQVEsRUFBRSxFQUM1QixJQUFJLENBQUMsZUFBZSxDQUFDLFVBQVUsQ0FBQyxZQUFZLENBQUMsRUFDN0MsSUFBSSxDQUFDLGdCQUFnQixDQUFDLGtCQUFrQixFQUFFLENBQzNDLENBQUM7UUFDRixNQUFNLGNBQWMsR0FBRyxJQUFJLDZDQUFxQixDQUM5QyxJQUFJLEVBQ0osSUFBSSxDQUFDLFlBQVksQ0FBQyxRQUFRLEVBQUUsQ0FDN0IsQ0FBQztRQUVGLElBQUksQ0FBQyxlQUFlLENBQUMsa0JBQWtCLENBQUMsZUFBZSxDQUFDLENBQUM7UUFDekQsSUFBSSxDQUFDLGVBQWUsQ0FBQyxrQkFBa0IsQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDO1FBQzFELElBQUksQ0FBQyxlQUFlLENBQUMsa0JBQWtCLENBQUMsYUFBYSxDQUFDLENBQUM7UUFDdkQsSUFBSSxDQUFDLGVBQWUsQ0FBQyxrQkFBa0IsQ0FBQyxjQUFjLENBQUMsQ0FBQztJQUMxRCxDQUFDO0lBRU8sc0JBQXNCO1FBQzVCLG1FQUFtRTtRQUNuRSxJQUFJLENBQUMsWUFBWSxDQUFDLDRCQUE0QixDQUFDLEdBQUcsRUFBRTtZQUNsRCxJQUFJLENBQUMsZ0JBQWdCLENBQUMsa0JBQWtCLEVBQUUsRUFBRSxlQUFlLEVBQUUsQ0FBQztRQUNoRSxDQUFDLENBQUMsQ0FBQztJQUNMLENBQUM7Q0FDRjtBQWxKRCxrQ0FrSkMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL1VzZXJzL2tpdGVsZXYvRG9jdW1lbnRzL2V4b2NvcnRleC1vYnNpZGlhbi1wbHVnaW4vc3JjL0V4b2NvcnRleFBsdWdpbi50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBQbHVnaW4gfSBmcm9tIFwib2JzaWRpYW5cIjtcbmltcG9ydCB7IExpZmVjeWNsZVJlZ2lzdHJ5IH0gZnJvbSBcIi4vaW5mcmFzdHJ1Y3R1cmUvbGlmZWN5Y2xlL0xpZmVjeWNsZVJlZ2lzdHJ5XCI7XG5pbXBvcnQgeyBDb21tYW5kUmVnaXN0cnkgfSBmcm9tIFwiLi9wcmVzZW50YXRpb24vY29tbWFuZC1jb250cm9sbGVycy9Db21tYW5kUmVnaXN0cnlcIjtcbmltcG9ydCB7IFNlcnZpY2VQcm92aWRlciB9IGZyb20gXCIuL2luZnJhc3RydWN0dXJlL3Byb3ZpZGVycy9TZXJ2aWNlUHJvdmlkZXJcIjtcbmltcG9ydCB7IFNldHRpbmdzTGlmZWN5Y2xlTWFuYWdlciB9IGZyb20gXCIuL2luZnJhc3RydWN0dXJlL2xpZmVjeWNsZS9TZXR0aW5nc0xpZmVjeWNsZU1hbmFnZXJcIjtcbmltcG9ydCB7IEdyYXBoTGlmZWN5Y2xlTWFuYWdlciB9IGZyb20gXCIuL2luZnJhc3RydWN0dXJlL2xpZmVjeWNsZS9HcmFwaExpZmVjeWNsZU1hbmFnZXJcIjtcbmltcG9ydCB7IFByb2Nlc3NvckxpZmVjeWNsZU1hbmFnZXIgfSBmcm9tIFwiLi9pbmZyYXN0cnVjdHVyZS9saWZlY3ljbGUvUHJvY2Vzc29yTGlmZWN5Y2xlTWFuYWdlclwiO1xuaW1wb3J0IHsgQXNzZXRDb21tYW5kQ29udHJvbGxlciB9IGZyb20gXCIuL3ByZXNlbnRhdGlvbi9jb21tYW5kLWNvbnRyb2xsZXJzL0Fzc2V0Q29tbWFuZENvbnRyb2xsZXJcIjtcbmltcG9ydCB7IFNQQVJRTENvbW1hbmRDb250cm9sbGVyIH0gZnJvbSBcIi4vcHJlc2VudGF0aW9uL2NvbW1hbmQtY29udHJvbGxlcnMvU1BBUlFMQ29tbWFuZENvbnRyb2xsZXJcIjtcbmltcG9ydCB7IFJERkNvbW1hbmRDb250cm9sbGVyIH0gZnJvbSBcIi4vcHJlc2VudGF0aW9uL2NvbW1hbmQtY29udHJvbGxlcnMvUkRGQ29tbWFuZENvbnRyb2xsZXJcIjtcbmltcG9ydCB7IFRhc2tDb21tYW5kQ29udHJvbGxlciB9IGZyb20gXCIuL3ByZXNlbnRhdGlvbi9jb21tYW5kLWNvbnRyb2xsZXJzL1Rhc2tDb21tYW5kQ29udHJvbGxlclwiO1xuaW1wb3J0IHsgRXhvY29ydGV4U2V0dGluZ3MgfSBmcm9tIFwiLi9kb21haW4vZW50aXRpZXMvRXhvY29ydGV4U2V0dGluZ3NcIjtcblxuLyoqXG4gKiBNYWluIFBsdWdpbiBDbGFzcyBmb2xsb3dpbmcgU2luZ2xlIFJlc3BvbnNpYmlsaXR5IFByaW5jaXBsZVxuICogU2luZ2xlIFJlc3BvbnNpYmlsaXR5OiBDb29yZGluYXRlIHBsdWdpbiBpbml0aWFsaXphdGlvbiBhbmQgY2xlYW51cFxuICpcbiAqIFRoaXMgcmVmYWN0b3JlZCB2ZXJzaW9uIGRlbW9uc3RyYXRlczpcbiAqIC0gU2luZ2xlIFJlc3BvbnNpYmlsaXR5IFByaW5jaXBsZTogT25seSBoYW5kbGVzIHBsdWdpbiBjb29yZGluYXRpb25cbiAqIC0gT3Blbi9DbG9zZWQgUHJpbmNpcGxlOiBFeHRlbnNpYmxlIHRocm91Z2ggcmVnaXN0cmllc1xuICogLSBEZXBlbmRlbmN5IEludmVyc2lvbjogRGVwZW5kcyBvbiBhYnN0cmFjdGlvbnMsIG5vdCBjb25jcmV0aW9uc1xuICogLSBJbnRlcmZhY2UgU2VncmVnYXRpb246IFVzZXMgc3BlY2lmaWMgaW50ZXJmYWNlcyBmb3IgZGlmZmVyZW50IGNvbmNlcm5zXG4gKiAtIEdSQVNQIFBhdHRlcm5zOiBDb250cm9sbGVyLCBDcmVhdG9yLCBQdXJlIEZhYnJpY2F0aW9uXG4gKi9cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIEV4b2NvcnRleFBsdWdpbiBleHRlbmRzIFBsdWdpbiB7XG4gIHByaXZhdGUgbGlmZWN5Y2xlUmVnaXN0cnk6IExpZmVjeWNsZVJlZ2lzdHJ5O1xuICBwcml2YXRlIGNvbW1hbmRSZWdpc3RyeTogQ29tbWFuZFJlZ2lzdHJ5O1xuICBwcml2YXRlIHNlcnZpY2VQcm92aWRlcjogU2VydmljZVByb3ZpZGVyO1xuXG4gIC8vIE1hbmFnZXJzXG4gIHByaXZhdGUgc2V0dGluZ3NNYW5hZ2VyOiBTZXR0aW5nc0xpZmVjeWNsZU1hbmFnZXI7XG4gIHByaXZhdGUgZ3JhcGhNYW5hZ2VyOiBHcmFwaExpZmVjeWNsZU1hbmFnZXI7XG4gIHByaXZhdGUgcHJvY2Vzc29yTWFuYWdlcjogUHJvY2Vzc29yTGlmZWN5Y2xlTWFuYWdlcjtcblxuICBhc3luYyBvbmxvYWQoKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgdHJ5IHtcbiAgICAgIC8vIEluaXRpYWxpemUgcmVnaXN0cmllc1xuICAgICAgdGhpcy5saWZlY3ljbGVSZWdpc3RyeSA9IG5ldyBMaWZlY3ljbGVSZWdpc3RyeSh0aGlzKTtcbiAgICAgIHRoaXMuY29tbWFuZFJlZ2lzdHJ5ID0gbmV3IENvbW1hbmRSZWdpc3RyeSh0aGlzKTtcblxuICAgICAgLy8gSW5pdGlhbGl6ZSBhbmQgcmVnaXN0ZXIgbGlmZWN5Y2xlIG1hbmFnZXJzXG4gICAgICBhd2FpdCB0aGlzLmluaXRpYWxpemVMaWZlY3ljbGVNYW5hZ2VycygpO1xuXG4gICAgICAvLyBJbml0aWFsaXplIHNlcnZpY2UgcHJvdmlkZXJcbiAgICAgIGF3YWl0IHRoaXMuaW5pdGlhbGl6ZVNlcnZpY2VQcm92aWRlcigpO1xuXG4gICAgICAvLyBJbml0aWFsaXplIGFuZCByZWdpc3RlciBjb21tYW5kIGNvbnRyb2xsZXJzXG4gICAgICBhd2FpdCB0aGlzLmluaXRpYWxpemVDb21tYW5kQ29udHJvbGxlcnMoKTtcblxuICAgICAgLy8gSW5pdGlhbGl6ZSBhbGwgbWFuYWdlcnNcbiAgICAgIGF3YWl0IHRoaXMubGlmZWN5Y2xlUmVnaXN0cnkuaW5pdGlhbGl6ZUFsbCgpO1xuXG4gICAgICAvLyBXaXJlIHVwIGNhY2hlIGludmFsaWRhdGlvbiBjYWxsYmFja1xuICAgICAgdGhpcy5zZXR1cENhY2hlSW52YWxpZGF0aW9uKCk7XG5cbiAgICAgIC8vIEluaXRpYWxpemUgYWxsIGNvbW1hbmRzXG4gICAgICBhd2FpdCB0aGlzLmNvbW1hbmRSZWdpc3RyeS5pbml0aWFsaXplQWxsKCk7XG5cbiAgICAgIGNvbnNvbGUubG9nKFwi8J+UjSBFeG9jb3J0ZXggUGx1Z2luIGluaXRpYWxpemVkIHN1Y2Nlc3NmdWxseVwiKTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcihcIkZhaWxlZCB0byBpbml0aWFsaXplIEV4b2NvcnRleCBQbHVnaW46XCIsIGVycm9yKTtcbiAgICAgIHRocm93IGVycm9yO1xuICAgIH1cbiAgfVxuXG4gIGFzeW5jIG9udW5sb2FkKCk6IFByb21pc2U8dm9pZD4ge1xuICAgIHRyeSB7XG4gICAgICAvLyBDbGVhbnVwIGluIHJldmVyc2Ugb3JkZXJcbiAgICAgIGF3YWl0IHRoaXMuY29tbWFuZFJlZ2lzdHJ5Py5jbGVhbnVwQWxsKCk7XG4gICAgICBhd2FpdCB0aGlzLnNlcnZpY2VQcm92aWRlcj8uY2xlYW51cCgpO1xuICAgICAgYXdhaXQgdGhpcy5saWZlY3ljbGVSZWdpc3RyeT8uY2xlYW51cEFsbCgpO1xuXG4gICAgICBjb25zb2xlLmxvZyhcIvCflI0gRXhvY29ydGV4IFBsdWdpbiBjbGVhbmVkIHVwIHN1Y2Nlc3NmdWxseVwiKTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcihcIkVycm9yIGR1cmluZyBwbHVnaW4gY2xlYW51cDpcIiwgZXJyb3IpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgcGx1Z2luIHNldHRpbmdzIChleHBvc2VkIGZvciBzZXR0aW5ncyB0YWIpXG4gICAqL1xuICBnZXQgc2V0dGluZ3MoKTogRXhvY29ydGV4U2V0dGluZ3Mge1xuICAgIHJldHVybiB0aGlzLnNldHRpbmdzTWFuYWdlcj8uZ2V0U2V0dGluZ3MoKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBTYXZlIHBsdWdpbiBzZXR0aW5ncyAoZXhwb3NlZCBmb3Igc2V0dGluZ3MgdGFiKVxuICAgKi9cbiAgYXN5bmMgc2F2ZVNldHRpbmdzKCk6IFByb21pc2U8dm9pZD4ge1xuICAgIGF3YWl0IHRoaXMuc2V0dGluZ3NNYW5hZ2VyPy5zYXZlU2V0dGluZ3MoKTtcblxuICAgIC8vIFVwZGF0ZSBkZXBlbmRlbnQgc2VydmljZXNcbiAgICB0aGlzLnNlcnZpY2VQcm92aWRlcj8udXBkYXRlU2VydmljZXModGhpcy5zZXR0aW5ncyk7XG4gICAgdGhpcy5wcm9jZXNzb3JNYW5hZ2VyPy51cGRhdGVDYWNoZUNvbmZpZyh0aGlzLnNldHRpbmdzKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBVcGRhdGUgY29udGFpbmVyIChleHBvc2VkIGZvciBzZXR0aW5ncyB0YWIpXG4gICAqL1xuICB1cGRhdGVDb250YWluZXIoKTogdm9pZCB7XG4gICAgdGhpcy5zZXJ2aWNlUHJvdmlkZXI/LnVwZGF0ZVNlcnZpY2VzKHRoaXMuc2V0dGluZ3MpO1xuICAgIHRoaXMucHJvY2Vzc29yTWFuYWdlcj8udXBkYXRlQ2FjaGVDb25maWcodGhpcy5zZXR0aW5ncyk7XG4gIH1cblxuICAvKipcbiAgICogR2V0IFNQQVJRTCBwcm9jZXNzb3IgKGV4cG9zZWQgZm9yIHRlc3RpbmcpXG4gICAqL1xuICBnZXQgc3BhcnFsUHJvY2Vzc29yKCkge1xuICAgIHJldHVybiB0aGlzLnByb2Nlc3Nvck1hbmFnZXI/LmdldFNQQVJRTFByb2Nlc3NvcigpO1xuICB9XG5cbiAgcHJpdmF0ZSBhc3luYyBpbml0aWFsaXplTGlmZWN5Y2xlTWFuYWdlcnMoKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgLy8gQ3JlYXRlIGFuZCByZWdpc3RlciBsaWZlY3ljbGUgbWFuYWdlcnNcbiAgICB0aGlzLnNldHRpbmdzTWFuYWdlciA9IG5ldyBTZXR0aW5nc0xpZmVjeWNsZU1hbmFnZXIodGhpcyk7XG4gICAgdGhpcy5ncmFwaE1hbmFnZXIgPSBuZXcgR3JhcGhMaWZlY3ljbGVNYW5hZ2VyKHRoaXMpO1xuXG4gICAgdGhpcy5saWZlY3ljbGVSZWdpc3RyeS5yZWdpc3Rlck1hbmFnZXIodGhpcy5zZXR0aW5nc01hbmFnZXIpO1xuICAgIHRoaXMubGlmZWN5Y2xlUmVnaXN0cnkucmVnaXN0ZXJNYW5hZ2VyKHRoaXMuZ3JhcGhNYW5hZ2VyKTtcblxuICAgIC8vIEluaXRpYWxpemUgc2V0dGluZ3MgZmlyc3QgKG90aGVycyBkZXBlbmQgb24gaXQpXG4gICAgYXdhaXQgdGhpcy5zZXR0aW5nc01hbmFnZXIuaW5pdGlhbGl6ZSgpO1xuXG4gICAgLy8gQ3JlYXRlIHByb2Nlc3NvciBtYW5hZ2VyIChkZXBlbmRzIG9uIHNldHRpbmdzIGFuZCBncmFwaClcbiAgICB0aGlzLnByb2Nlc3Nvck1hbmFnZXIgPSBuZXcgUHJvY2Vzc29yTGlmZWN5Y2xlTWFuYWdlcihcbiAgICAgIHRoaXMsXG4gICAgICB0aGlzLmdyYXBoTWFuYWdlci5nZXRHcmFwaCgpLFxuICAgICAgdGhpcy5zZXR0aW5nc01hbmFnZXIuZ2V0U2V0dGluZ3MoKSxcbiAgICApO1xuICAgIHRoaXMubGlmZWN5Y2xlUmVnaXN0cnkucmVnaXN0ZXJNYW5hZ2VyKHRoaXMucHJvY2Vzc29yTWFuYWdlcik7XG4gIH1cblxuICBwcml2YXRlIGFzeW5jIGluaXRpYWxpemVTZXJ2aWNlUHJvdmlkZXIoKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgdGhpcy5zZXJ2aWNlUHJvdmlkZXIgPSBuZXcgU2VydmljZVByb3ZpZGVyKFxuICAgICAgdGhpcyxcbiAgICAgIHRoaXMuZ3JhcGhNYW5hZ2VyLmdldEdyYXBoKCksXG4gICAgICB0aGlzLnNldHRpbmdzTWFuYWdlci5nZXRTZXR0aW5ncygpLFxuICAgICk7XG4gICAgYXdhaXQgdGhpcy5zZXJ2aWNlUHJvdmlkZXIuaW5pdGlhbGl6ZVNlcnZpY2VzKCk7XG4gIH1cblxuICBwcml2YXRlIGFzeW5jIGluaXRpYWxpemVDb21tYW5kQ29udHJvbGxlcnMoKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgLy8gQ3JlYXRlIGFuZCByZWdpc3RlciBjb21tYW5kIGNvbnRyb2xsZXJzXG4gICAgY29uc3QgYXNzZXRDb250cm9sbGVyID0gbmV3IEFzc2V0Q29tbWFuZENvbnRyb2xsZXIodGhpcyk7XG4gICAgY29uc3Qgc3BhcnFsQ29udHJvbGxlciA9IG5ldyBTUEFSUUxDb21tYW5kQ29udHJvbGxlcihcbiAgICAgIHRoaXMsXG4gICAgICB0aGlzLnByb2Nlc3Nvck1hbmFnZXIuZ2V0U1BBUlFMUHJvY2Vzc29yKCksXG4gICAgKTtcbiAgICBjb25zdCByZGZDb250cm9sbGVyID0gbmV3IFJERkNvbW1hbmRDb250cm9sbGVyKFxuICAgICAgdGhpcyxcbiAgICAgIHRoaXMuZ3JhcGhNYW5hZ2VyLmdldEdyYXBoKCksXG4gICAgICB0aGlzLnNlcnZpY2VQcm92aWRlci5nZXRTZXJ2aWNlKFwiUkRGU2VydmljZVwiKSxcbiAgICAgIHRoaXMucHJvY2Vzc29yTWFuYWdlci5nZXRTUEFSUUxQcm9jZXNzb3IoKSxcbiAgICApO1xuICAgIGNvbnN0IHRhc2tDb250cm9sbGVyID0gbmV3IFRhc2tDb21tYW5kQ29udHJvbGxlcihcbiAgICAgIHRoaXMsXG4gICAgICB0aGlzLmdyYXBoTWFuYWdlci5nZXRHcmFwaCgpLFxuICAgICk7XG5cbiAgICB0aGlzLmNvbW1hbmRSZWdpc3RyeS5yZWdpc3RlckNvbnRyb2xsZXIoYXNzZXRDb250cm9sbGVyKTtcbiAgICB0aGlzLmNvbW1hbmRSZWdpc3RyeS5yZWdpc3RlckNvbnRyb2xsZXIoc3BhcnFsQ29udHJvbGxlcik7XG4gICAgdGhpcy5jb21tYW5kUmVnaXN0cnkucmVnaXN0ZXJDb250cm9sbGVyKHJkZkNvbnRyb2xsZXIpO1xuICAgIHRoaXMuY29tbWFuZFJlZ2lzdHJ5LnJlZ2lzdGVyQ29udHJvbGxlcih0YXNrQ29udHJvbGxlcik7XG4gIH1cblxuICBwcml2YXRlIHNldHVwQ2FjaGVJbnZhbGlkYXRpb24oKTogdm9pZCB7XG4gICAgLy8gU2V0dXAgY2FjaGUgaW52YWxpZGF0aW9uIGNhbGxiYWNrIGZyb20gZ3JhcGggdG8gU1BBUlFMIHByb2Nlc3NvclxuICAgIHRoaXMuZ3JhcGhNYW5hZ2VyLnNldENhY2hlSW52YWxpZGF0aW9uQ2FsbGJhY2soKCkgPT4ge1xuICAgICAgdGhpcy5wcm9jZXNzb3JNYW5hZ2VyLmdldFNQQVJRTFByb2Nlc3NvcigpPy5pbnZhbGlkYXRlQ2FjaGUoKTtcbiAgICB9KTtcbiAgfVxufVxuIl0sInZlcnNpb24iOjN9