a3d6a9f376b9f817c51aec90f895f7b2
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.VisualQueryEdge = exports.EdgeType = void 0;
var EdgeType;
(function (EdgeType) {
    EdgeType["PROPERTY"] = "property";
    EdgeType["OPTIONAL"] = "optional";
    EdgeType["UNION"] = "union";
    EdgeType["FILTER_CONDITION"] = "filter_condition";
})(EdgeType = exports.EdgeType || (exports.EdgeType = {}));
class VisualQueryEdge {
    constructor(params) {
        this.selected = false;
        this.valid = true;
        this.errors = [];
        this.id = params.id;
        this.sourceNodeId = params.sourceNodeId;
        this.targetNodeId = params.targetNodeId;
        this.type = params.type;
        this.label = params.label;
        this.propertyUri = params.propertyUri;
        Object.freeze(this.id);
        Object.freeze(this.sourceNodeId);
        Object.freeze(this.targetNodeId);
        Object.freeze(this.type);
    }
    getId() {
        return this.id;
    }
    getSourceNodeId() {
        return this.sourceNodeId;
    }
    getTargetNodeId() {
        return this.targetNodeId;
    }
    getType() {
        return this.type;
    }
    getLabel() {
        return this.label;
    }
    setLabel(label) {
        this.label = label;
    }
    getPropertyUri() {
        return this.propertyUri;
    }
    setPropertyUri(uri) {
        this.propertyUri = uri;
    }
    isSelected() {
        return this.selected;
    }
    setSelected(selected) {
        this.selected = selected;
    }
    isValid() {
        return this.valid;
    }
    setValid(valid, errors) {
        this.valid = valid;
        this.errors = errors || [];
    }
    getErrors() {
        return [...this.errors];
    }
    isOptional() {
        return this.type === EdgeType.OPTIONAL;
    }
    toSPARQLPredicate() {
        if (this.propertyUri) {
            return `<${this.propertyUri}>`;
        }
        if (this.label.startsWith('?')) {
            return this.label;
        }
        if (this.label.includes(':')) {
            return this.label;
        }
        return `?${this.label.toLowerCase().replace(/\s+/g, '_')}`;
    }
    calculatePath(sourceNode, targetNode) {
        const sourcePoint = sourceNode.getConnectionPoints();
        const targetPoint = targetNode.getConnectionPoints();
        // Simple direct path for now - can be enhanced with curved paths
        const sx = sourcePoint.right.x;
        const sy = sourcePoint.right.y;
        const tx = targetPoint.left.x;
        const ty = targetPoint.left.y;
        // Calculate control points for smooth curve
        const dx = tx - sx;
        const dy = ty - sy;
        const cx1 = sx + dx * 0.5;
        const cy1 = sy;
        const cx2 = sx + dx * 0.5;
        const cy2 = ty;
        return `M ${sx} ${sy} C ${cx1} ${cy1}, ${cx2} ${cy2}, ${tx} ${ty}`;
    }
    getLabelPosition(sourceNode, targetNode) {
        const sourcePoint = sourceNode.getConnectionPoints().right;
        const targetPoint = targetNode.getConnectionPoints().left;
        return {
            x: (sourcePoint.x + targetPoint.x) / 2,
            y: (sourcePoint.y + targetPoint.y) / 2
        };
    }
    clone() {
        return new VisualQueryEdge({
            id: `${this.id}_clone_${Date.now()}`,
            sourceNodeId: this.sourceNodeId,
            targetNodeId: this.targetNodeId,
            type: this.type,
            label: this.label,
            propertyUri: this.propertyUri
        });
    }
    static createProperty(sourceNodeId, targetNodeId, label, propertyUri) {
        return new VisualQueryEdge({
            id: `edge_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,
            sourceNodeId,
            targetNodeId,
            type: EdgeType.PROPERTY,
            label,
            propertyUri
        });
    }
    static createOptional(sourceNodeId, targetNodeId, label, propertyUri) {
        return new VisualQueryEdge({
            id: `optional_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,
            sourceNodeId,
            targetNodeId,
            type: EdgeType.OPTIONAL,
            label,
            propertyUri
        });
    }
    static createFilterCondition(sourceNodeId, targetNodeId, label) {
        return new VisualQueryEdge({
            id: `filter_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,
            sourceNodeId,
            targetNodeId,
            type: EdgeType.FILTER_CONDITION,
            label
        });
    }
}
exports.VisualQueryEdge = VisualQueryEdge;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL2tpdGVsZXYvRG9jdW1lbnRzL2V4b2NvcnRleC1vYnNpZGlhbi1wbHVnaW4vc3JjL2RvbWFpbi92aXN1YWwvVmlzdWFsUXVlcnlFZGdlLnRzIiwibWFwcGluZ3MiOiI7OztBQUVBLElBQVksUUFLWDtBQUxELFdBQVksUUFBUTtJQUNoQixpQ0FBcUIsQ0FBQTtJQUNyQixpQ0FBcUIsQ0FBQTtJQUNyQiwyQkFBZSxDQUFBO0lBQ2YsaURBQXFDLENBQUE7QUFDekMsQ0FBQyxFQUxXLFFBQVEsR0FBUixnQkFBUSxLQUFSLGdCQUFRLFFBS25CO0FBRUQsTUFBYSxlQUFlO0lBV3hCLFlBQVksTUFPWDtRQVhPLGFBQVEsR0FBWSxLQUFLLENBQUM7UUFDMUIsVUFBSyxHQUFZLElBQUksQ0FBQztRQUN0QixXQUFNLEdBQWEsRUFBRSxDQUFDO1FBVTFCLElBQUksQ0FBQyxFQUFFLEdBQUcsTUFBTSxDQUFDLEVBQUUsQ0FBQztRQUNwQixJQUFJLENBQUMsWUFBWSxHQUFHLE1BQU0sQ0FBQyxZQUFZLENBQUM7UUFDeEMsSUFBSSxDQUFDLFlBQVksR0FBRyxNQUFNLENBQUMsWUFBWSxDQUFDO1FBQ3hDLElBQUksQ0FBQyxJQUFJLEdBQUcsTUFBTSxDQUFDLElBQUksQ0FBQztRQUN4QixJQUFJLENBQUMsS0FBSyxHQUFHLE1BQU0sQ0FBQyxLQUFLLENBQUM7UUFDMUIsSUFBSSxDQUFDLFdBQVcsR0FBRyxNQUFNLENBQUMsV0FBVyxDQUFDO1FBQ3RDLE1BQU0sQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxDQUFDO1FBQ3ZCLE1BQU0sQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLFlBQVksQ0FBQyxDQUFDO1FBQ2pDLE1BQU0sQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLFlBQVksQ0FBQyxDQUFDO1FBQ2pDLE1BQU0sQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO0lBQzdCLENBQUM7SUFFRCxLQUFLO1FBQ0QsT0FBTyxJQUFJLENBQUMsRUFBRSxDQUFD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RSxDQUFDLENBQUMsTUFBTSxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsRUFBRTtZQUNuRSxZQUFZO1lBQ1osWUFBWTtZQUNaLElBQUksRUFBRSxRQUFRLENBQUMsUUFBUTtZQUN2QixLQUFLO1lBQ0wsV0FBVztTQUNkLENBQUMsQ0FBQztJQUNQLENBQUM7SUFFRCxNQUFNLENBQUMsY0FBYyxDQUNqQixZQUFvQixFQUNwQixZQUFvQixFQUNwQixLQUFhLEVBQ2IsV0FBb0I7UUFFcEIsT0FBTyxJQUFJLGVBQWUsQ0FBQztZQUN2QixFQUFFLEVBQUUsWUFBWSxJQUFJLENBQUMsR0FBRyxFQUFFLElBQUksSUFBSSxDQUFDLE1BQU0sRUFBRSxDQUFDLFFBQVEsQ0FBQyxFQUFFLENBQUMsQ0FBQyxNQUFNLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxFQUFFO1lBQ3ZFLFlBQVk7WUFDWixZQUFZO1lBQ1osSUFBSSxFQUFFLFFBQVEsQ0FBQyxRQUFRO1lBQ3ZCLEtBQUs7WUFDTCxXQUFXO1NBQ2QsQ0FBQyxDQUFDO0lBQ1AsQ0FBQztJQUVELE1BQU0sQ0FBQyxxQkFBcUIsQ0FDeEIsWUFBb0IsRUFDcEIsWUFBb0IsRUFDcEIsS0FBYTtRQUViLE9BQU8sSUFBSSxlQUFlLENBQUM7WUFDdkIsRUFBRSxFQUFFLFVBQVUsSUFBSSxDQUFDLEdBQUcsRUFBRSxJQUFJLElBQUksQ0FBQyxNQUFNLEVBQUUsQ0FBQyxRQUFRLENBQUMsRUFBRSxDQUFDLENBQUMsTUFBTSxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsRUFBRTtZQUNyRSxZQUFZO1lBQ1osWUFBWTtZQUNaLElBQUksRUFBRSxRQUFRLENBQUMsZ0JBQWdCO1lBQy9CLEtBQUs7U0FDUixDQUFDLENBQUM7SUFDUCxDQUFDO0NBQ0o7QUEvTEQsMENBK0xDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIi9Vc2Vycy9raXRlbGV2L0RvY3VtZW50cy9leG9jb3J0ZXgtb2JzaWRpYW4tcGx1Z2luL3NyYy9kb21haW4vdmlzdWFsL1Zpc3VhbFF1ZXJ5RWRnZS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBWaXN1YWxRdWVyeU5vZGUgfSBmcm9tICcuL1Zpc3VhbFF1ZXJ5Tm9kZSc7XG5cbmV4cG9ydCBlbnVtIEVkZ2VUeXBlIHtcbiAgICBQUk9QRVJUWSA9ICdwcm9wZXJ0eScsXG4gICAgT1BUSU9OQUwgPSAnb3B0aW9uYWwnLFxuICAgIFVOSU9OID0gJ3VuaW9uJyxcbiAgICBGSUxURVJfQ09ORElUSU9OID0gJ2ZpbHRlcl9jb25kaXRpb24nXG59XG5cbmV4cG9ydCBjbGFzcyBWaXN1YWxRdWVyeUVkZ2Uge1xuICAgIHByaXZhdGUgcmVhZG9ubHkgaWQ6IHN0cmluZztcbiAgICBwcml2YXRlIHJlYWRvbmx5IHNvdXJjZU5vZGVJZDogc3RyaW5nO1xuICAgIHByaXZhdGUgcmVhZG9ubHkgdGFyZ2V0Tm9kZUlkOiBzdHJpbmc7XG4gICAgcHJpdmF0ZSByZWFkb25seSB0eXBlOiBFZGdlVHlwZTtcbiAgICBwcml2YXRlIGxhYmVsOiBzdHJpbmc7XG4gICAgcHJpdmF0ZSBwcm9wZXJ0eVVyaT86IHN0cmluZztcbiAgICBwcml2YXRlIHNlbGVjdGVkOiBib29sZWFuID0gZmFsc2U7XG4gICAgcHJpdmF0ZSB2YWxpZDogYm9vbGVhbiA9IHRydWU7XG4gICAgcHJpdmF0ZSBlcnJvcnM6IHN0cmluZ1tdID0gW107XG5cbiAgICBjb25zdHJ1Y3RvcihwYXJhbXM6IHtcbiAgICAgICAgaWQ6IHN0cmluZztcbiAgICAgICAgc291cmNlTm9kZUlkOiBzdHJpbmc7XG4gICAgICAgIHRhcmdldE5vZGVJZDogc3RyaW5nO1xuICAgICAgICB0eXBlOiBFZGdlVHlwZTtcbiAgICAgICAgbGFiZWw6IHN0cmluZztcbiAgICAgICAgcHJvcGVydHlVcmk/OiBzdHJpbmc7XG4gICAgfSkge1xuICAgICAgICB0aGlzLmlkID0gcGFyYW1zLmlkO1xuICAgICAgICB0aGlzLnNvdXJjZU5vZGVJZCA9IHBhcmFtcy5zb3VyY2VOb2RlSWQ7XG4gICAgICAgIHRoaXMudGFyZ2V0Tm9kZUlkID0gcGFyYW1zLnRhcmdldE5vZGVJZDtcbiAgICAgICAgdGhpcy50eXBlID0gcGFyYW1zLnR5cGU7XG4gICAgICAgIHRoaXMubGFiZWwgPSBwYXJhbXMubGFiZWw7XG4gICAgICAgIHRoaXMucHJvcGVydHlVcmkgPSBwYXJhbXMucHJvcGVydHlVcmk7XG4gICAgICAgIE9iamVjdC5mcmVlemUodGhpcy5pZCk7XG4gICAgICAgIE9iamVjdC5mcmVlemUodGhpcy5zb3VyY2VOb2RlSWQpO1xuICAgICAgICBPYmplY3QuZnJlZXplKHRoaXMudGFyZ2V0Tm9kZUlkKTtcbiAgICAgICAgT2JqZWN0LmZyZWV6ZSh0aGlzLnR5cGUpO1xuICAgIH1cblxuICAgIGdldElkKCk6IHN0cmluZyB7XG4gICAgICAgIHJldHVybiB0aGlzLmlkO1xuICAgIH1cblxuICAgIGdldFNvdXJjZU5vZGVJZCgpOiBzdHJpbmcge1xuICAgICAgICByZXR1cm4gdGhpcy5zb3VyY2VOb2RlSWQ7XG4gICAgfVxuXG4gICAgZ2V0VGFyZ2V0Tm9kZUlkKCk6IHN0cmluZyB7XG4gICAgICAgIHJldHVybiB0aGlzLnRhcmdldE5vZGVJZDtcbiAgICB9XG5cbiAgICBnZXRUeXBlKCk6IEVkZ2VUeXBlIHtcbiAgICAgICAgcmV0dXJuIHRoaXMudHlwZTtcbiAgICB9XG5cbiAgICBnZXRMYWJlbCgpOiBzdHJpbmcge1xuICAgICAgICByZXR1cm4gdGhpcy5sYWJlbDtcbiAgICB9XG5cbiAgICBzZXRMYWJlbChsYWJlbDogc3RyaW5nKTogdm9pZCB7XG4gICAgICAgIHRoaXMubGFiZWwgPSBsYWJlbDtcbiAgICB9XG5cbiAgICBnZXRQcm9wZXJ0eVVyaSgpOiBzdHJpbmcgfCB1bmRlZmluZWQge1xuICAgICAgICByZXR1cm4gdGhpcy5wcm9wZXJ0eVVyaTtcbiAgICB9XG5cbiAgICBzZXRQcm9wZXJ0eVVyaSh1cmk6IHN0cmluZyk6IHZvaWQge1xuICAgICAgICB0aGlzLnByb3BlcnR5VXJpID0gdXJpO1xuICAgIH1cblxuICAgIGlzU2VsZWN0ZWQoKTogYm9vbGVhbiB7XG4gICAgICAgIHJldHVybiB0aGlzLnNlbGVjdGVkO1xuICAgIH1cblxuICAgIHNldFNlbGVjdGVkKHNlbGVjdGVkOiBib29sZWFuKTogdm9pZCB7XG4gICAgICAgIHRoaXMuc2VsZWN0ZWQgPSBzZWxlY3RlZDtcbiAgICB9XG5cbiAgICBpc1ZhbGlkKCk6IGJvb2xlYW4ge1xuICAgICAgICByZXR1cm4gdGhpcy52YWxpZDtcbiAgICB9XG5cbiAgICBzZXRWYWxpZCh2YWxpZDogYm9vbGVhbiwgZXJyb3JzPzogc3RyaW5nW10pOiB2b2lkIHtcbiAgICAgICAgdGhpcy52YWxpZCA9IHZhbGlkO1xuICAgICAgICB0aGlzLmVycm9ycyA9IGVycm9ycyB8fCBbXTtcbiAgICB9XG5cbiAgICBnZXRFcnJvcnMoKTogc3RyaW5nW10ge1xuICAgICAgICByZXR1cm4gWy4uLnRoaXMuZXJyb3JzXTtcbiAgICB9XG5cbiAgICBpc09wdGlvbmFsKCk6IGJvb2xlYW4ge1xuICAgICAgICByZXR1cm4gdGhpcy50eXBlID09PSBFZGdlVHlwZS5PUFRJT05BTDtcbiAgICB9XG5cbiAgICB0b1NQQVJRTFByZWRpY2F0ZSgpOiBzdHJpbmcge1xuICAgICAgICBpZiAodGhpcy5wcm9wZXJ0eVVyaSkge1xuICAgICAgICAgICAgcmV0dXJuIGA8JHt0aGlzLnByb3BlcnR5VXJpfT5gO1xuICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICBpZiAodGhpcy5sYWJlbC5zdGFydHNXaXRoKCc/JykpIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmxhYmVsO1xuICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICBpZiAodGhpcy5sYWJlbC5pbmNsdWRlcygnOicpKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5sYWJlbDtcbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgcmV0dXJuIGA/JHt0aGlzLmxhYmVsLnRvTG93ZXJDYXNlKCkucmVwbGFjZSgvXFxzKy9nLCAnXycpfWA7XG4gICAgfVxuXG4gICAgY2FsY3VsYXRlUGF0aChzb3VyY2VOb2RlOiBWaXN1YWxRdWVyeU5vZGUsIHRhcmdldE5vZGU6IFZpc3VhbFF1ZXJ5Tm9kZSk6IHN0cmluZyB7XG4gICAgICAgIGNvbnN0IHNvdXJjZVBvaW50ID0gc291cmNlTm9kZS5nZXRDb25uZWN0aW9uUG9pbnRzKCk7XG4gICAgICAgIGNvbnN0IHRhcmdldFBvaW50ID0gdGFyZ2V0Tm9kZS5nZXRDb25uZWN0aW9uUG9pbnRzKCk7XG4gICAgICAgIFxuICAgICAgICAvLyBTaW1wbGUgZGlyZWN0IHBhdGggZm9yIG5vdyAtIGNhbiBiZSBlbmhhbmNlZCB3aXRoIGN1cnZlZCBwYXRoc1xuICAgICAgICBjb25zdCBzeCA9IHNvdXJjZVBvaW50LnJpZ2h0Lng7XG4gICAgICAgIGNvbnN0IHN5ID0gc291cmNlUG9pbnQucmlnaHQueTtcbiAgICAgICAgY29uc3QgdHggPSB0YXJnZXRQb2ludC5sZWZ0Lng7XG4gICAgICAgIGNvbnN0IHR5ID0gdGFyZ2V0UG9pbnQubGVmdC55O1xuICAgICAgICBcbiAgICAgICAgLy8gQ2FsY3VsYXRlIGNvbnRyb2wgcG9pbnRzIGZvciBzbW9vdGggY3VydmVcbiAgICAgICAgY29uc3QgZHggPSB0eCAtIHN4O1xuICAgICAgICBjb25zdCBkeSA9IHR5IC0gc3k7XG4gICAgICAgIGNvbnN0IGN4MSA9IHN4ICsgZHggKiAwLjU7XG4gICAgICAgIGNvbnN0IGN5MSA9IHN5O1xuICAgICAgICBjb25zdCBjeDIgPSBzeCArIGR4ICogMC41O1xuICAgICAgICBjb25zdCBjeTIgPSB0eTtcbiAgICAgICAgXG4gICAgICAgIHJldHVybiBgTSAke3N4fSAke3N5fSBDICR7Y3gxfSAke2N5MX0sICR7Y3gyfSAke2N5Mn0sICR7dHh9ICR7dHl9YDtcbiAgICB9XG5cbiAgICBnZXRMYWJlbFBvc2l0aW9uKHNvdXJjZU5vZGU6IFZpc3VhbFF1ZXJ5Tm9kZSwgdGFyZ2V0Tm9kZTogVmlzdWFsUXVlcnlOb2RlKTogeyB4OiBudW1iZXI7IHk6IG51bWJlciB9IHtcbiAgICAgICAgY29uc3Qgc291cmNlUG9pbnQgPSBzb3VyY2VOb2RlLmdldENvbm5lY3Rpb25Qb2ludHMoKS5yaWdodDtcbiAgICAgICAgY29uc3QgdGFyZ2V0UG9pbnQgPSB0YXJnZXROb2RlLmdldENvbm5lY3Rpb25Qb2ludHMoKS5sZWZ0O1xuICAgICAgICBcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIHg6IChzb3VyY2VQb2ludC54ICsgdGFyZ2V0UG9pbnQueCkgLyAyLFxuICAgICAgICAgICAgeTogKHNvdXJjZVBvaW50LnkgKyB0YXJnZXRQb2ludC55KSAvIDJcbiAgICAgICAgfTtcbiAgICB9XG5cbiAgICBjbG9uZSgpOiBWaXN1YWxRdWVyeUVkZ2Uge1xuICAgICAgICByZXR1cm4gbmV3IFZpc3VhbFF1ZXJ5RWRnZSh7XG4gICAgICAgICAgICBpZDogYCR7dGhpcy5pZH1fY2xvbmVfJHtEYXRlLm5vdygpfWAsXG4gICAgICAgICAgICBzb3VyY2VOb2RlSWQ6IHRoaXMuc291cmNlTm9kZUlkLFxuICAgICAgICAgICAgdGFyZ2V0Tm9kZUlkOiB0aGlzLnRhcmdldE5vZGVJZCxcbiAgICAgICAgICAgIHR5cGU6IHRoaXMudHlwZSxcbiAgICAgICAgICAgIGxhYmVsOiB0aGlzLmxhYmVsLFxuICAgICAgICAgICAgcHJvcGVydHlVcmk6IHRoaXMucHJvcGVydHlVcmlcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgc3RhdGljIGNyZWF0ZVByb3BlcnR5KFxuICAgICAgICBzb3VyY2VOb2RlSWQ6IHN0cmluZyxcbiAgICAgICAgdGFyZ2V0Tm9kZUlkOiBzdHJpbmcsXG4gICAgICAgIGxhYmVsOiBzdHJpbmcsXG4gICAgICAgIHByb3BlcnR5VXJpPzogc3RyaW5nXG4gICAgKTogVmlzdWFsUXVlcnlFZGdlIHtcbiAgICAgICAgcmV0dXJuIG5ldyBWaXN1YWxRdWVyeUVkZ2Uoe1xuICAgICAgICAgICAgaWQ6IGBlZGdlXyR7RGF0ZS5ub3coKX1fJHtNYXRoLnJhbmRvbSgpLnRvU3RyaW5nKDM2KS5zdWJzdHIoMiwgOSl9YCxcbiAgICAgICAgICAgIHNvdXJjZU5vZGVJZCxcbiAgICAgICAgICAgIHRhcmdldE5vZGVJZCxcbiAgICAgICAgICAgIHR5cGU6IEVkZ2VUeXBlLlBST1BFUlRZLFxuICAgICAgICAgICAgbGFiZWwsXG4gICAgICAgICAgICBwcm9wZXJ0eVVyaVxuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBzdGF0aWMgY3JlYXRlT3B0aW9uYWwoXG4gICAgICAgIHNvdXJjZU5vZGVJZDogc3RyaW5nLFxuICAgICAgICB0YXJnZXROb2RlSWQ6IHN0cmluZyxcbiAgICAgICAgbGFiZWw6IHN0cmluZyxcbiAgICAgICAgcHJvcGVydHlVcmk/OiBzdHJpbmdcbiAgICApOiBWaXN1YWxRdWVyeUVkZ2Uge1xuICAgICAgICByZXR1cm4gbmV3IFZpc3VhbFF1ZXJ5RWRnZSh7XG4gICAgICAgICAgICBpZDogYG9wdGlvbmFsXyR7RGF0ZS5ub3coKX1fJHtNYXRoLnJhbmRvbSgpLnRvU3RyaW5nKDM2KS5zdWJzdHIoMiwgOSl9YCxcbiAgICAgICAgICAgIHNvdXJjZU5vZGVJZCxcbiAgICAgICAgICAgIHRhcmdldE5vZGVJZCxcbiAgICAgICAgICAgIHR5cGU6IEVkZ2VUeXBlLk9QVElPTkFMLFxuICAgICAgICAgICAgbGFiZWwsXG4gICAgICAgICAgICBwcm9wZXJ0eVVyaVxuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBzdGF0aWMgY3JlYXRlRmlsdGVyQ29uZGl0aW9uKFxuICAgICAgICBzb3VyY2VOb2RlSWQ6IHN0cmluZyxcbiAgICAgICAgdGFyZ2V0Tm9kZUlkOiBzdHJpbmcsXG4gICAgICAgIGxhYmVsOiBzdHJpbmdcbiAgICApOiBWaXN1YWxRdWVyeUVkZ2Uge1xuICAgICAgICByZXR1cm4gbmV3IFZpc3VhbFF1ZXJ5RWRnZSh7XG4gICAgICAgICAgICBpZDogYGZpbHRlcl8ke0RhdGUubm93KCl9XyR7TWF0aC5yYW5kb20oKS50b1N0cmluZygzNikuc3Vic3RyKDIsIDkpfWAsXG4gICAgICAgICAgICBzb3VyY2VOb2RlSWQsXG4gICAgICAgICAgICB0YXJnZXROb2RlSWQsXG4gICAgICAgICAgICB0eXBlOiBFZGdlVHlwZS5GSUxURVJfQ09ORElUSU9OLFxuICAgICAgICAgICAgbGFiZWxcbiAgICAgICAgfSk7XG4gICAgfVxufSJdLCJ2ZXJzaW9uIjozfQ==