f79d3c297a053e5f5059d01d863222b7
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const tslib_1 = require("tslib");
const main_1 = tslib_1.__importDefault(require("../../src/main"));
describe.skip("LayoutRenderer Integration (deprecated)", () => {
    let plugin;
    let mockApp;
    beforeEach(() => {
        // Create mock app
        mockApp = {
            vault: {
                getMarkdownFiles: jest.fn().mockReturnValue([]),
                read: jest.fn(),
                create: jest.fn(),
                modify: jest.fn(),
                on: jest.fn().mockReturnValue({ unload: jest.fn() }),
                getAbstractFileByPath: jest.fn(),
            },
            workspace: {
                getActiveFile: jest.fn(),
                on: jest.fn().mockReturnValue({ unload: jest.fn() }),
            },
            metadataCache: {
                getFileCache: jest.fn(),
                on: jest.fn().mockReturnValue({ unload: jest.fn() }),
            },
        };
        plugin = new main_1.default(mockApp, {});
    });
    describe("Layout Renderer Registration", () => {
        test("should register exo-layout code block processor", async () => {
            const registerSpy = jest.fn();
            plugin.registerMarkdownCodeBlockProcessor = registerSpy;
            await plugin.onload();
            // Check that exo-layout processor was registered
            const calls = registerSpy.mock.calls;
            const layoutCall = calls.find((call) => call[0] === "exo-layout");
            expect(layoutCall).toBeDefined();
            expect(layoutCall[0]).toBe("exo-layout");
            expect(typeof layoutCall[1]).toBe("function");
        });
        test("should render layout when exo-layout block is processed", async () => {
            let layoutProcessor;
            plugin.registerMarkdownCodeBlockProcessor = jest.fn((type, processor) => {
                if (type === "exo-layout") {
                    layoutProcessor = processor;
                }
            });
            await plugin.onload();
            // Mock active file with frontmatter
            const mockFile = {
                path: "test.md",
                basename: "test",
                name: "test.md",
            };
            mockApp.workspace.getActiveFile.mockReturnValue(mockFile);
            mockApp.metadataCache.getFileCache.mockReturnValue({
                frontmatter: {
                    exo__Instance_class: "[[ems__Task]]",
                    title: "Test Task",
                    status: "active",
                },
            });
            // Create mock element
            const mockEl = {
                empty: jest.fn(),
                createDiv: jest.fn().mockReturnValue({
                    createEl: jest.fn(),
                    createDiv: jest.fn(),
                    style: {},
                    setAttribute: jest.fn(),
                    addClass: jest.fn(),
                }),
                createEl: jest.fn(),
            };
            // Process the block
            await layoutProcessor("", mockEl, {});
            expect(mockEl.empty).toHaveBeenCalled();
            expect(mockApp.workspace.getActiveFile).toHaveBeenCalled();
            expect(mockApp.metadataCache.getFileCache).toHaveBeenCalledWith(mockFile);
        });
        test("should not render if no active file", async () => {
            let layoutProcessor;
            plugin.registerMarkdownCodeBlockProcessor = jest.fn((type, processor) => {
                if (type === "exo-layout") {
                    layoutProcessor = processor;
                }
            });
            await plugin.onload();
            mockApp.workspace.getActiveFile.mockReturnValue(null);
            const mockEl = {
                empty: jest.fn(),
            };
            await layoutProcessor("", mockEl, {});
            expect(mockEl.empty).not.toHaveBeenCalled();
        });
        test("should not render if no frontmatter", async () => {
            let layoutProcessor;
            plugin.registerMarkdownCodeBlockProcessor = jest.fn((type, processor) => {
                if (type === "exo-layout") {
                    layoutProcessor = processor;
                }
            });
            await plugin.onload();
            const mockFile = {
                path: "test.md",
            };
            mockApp.workspace.getActiveFile.mockReturnValue(mockFile);
            mockApp.metadataCache.getFileCache.mockReturnValue(null);
            const mockEl = {
                empty: jest.fn(),
            };
            await layoutProcessor("", mockEl, {});
            expect(mockEl.empty).not.toHaveBeenCalled();
        });
    });
    describe("Layout Rendering Types", () => {
        test("should support query blocks in layouts", async () => {
            await plugin.onload();
            const layoutRenderer = plugin.layoutRenderer;
            expect(layoutRenderer).toBeDefined();
            // Verify renderer has query block support
            expect(layoutRenderer.queryRenderer).toBeDefined();
        });
        test("should support properties blocks in layouts", async () => {
            await plugin.onload();
            const layoutRenderer = plugin.layoutRenderer;
            expect(layoutRenderer).toBeDefined();
            // Verify renderer has properties block support
            expect(layoutRenderer.propertiesRenderer).toBeDefined();
        });
        test("should support backlinks blocks in layouts", async () => {
            await plugin.onload();
            const layoutRenderer = plugin.layoutRenderer;
            expect(layoutRenderer).toBeDefined();
            // Verify renderer has backlinks block support
            expect(layoutRenderer.backlinksRenderer).toBeDefined();
        });
        test("should support custom blocks in layouts", async () => {
            await plugin.onload();
            const layoutRenderer = plugin.layoutRenderer;
            expect(layoutRenderer).toBeDefined();
            // Verify renderer has custom block support
            expect(layoutRenderer.customRenderer).toBeDefined();
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL2tpdGVsZXYvRG9jdW1lbnRzL2V4b2NvcnRleC1vYnNpZGlhbi1wbHVnaW4vdGVzdHMvaW50ZWdyYXRpb24vTGF5b3V0UmVuZGVyZXJJbnRlZ3JhdGlvbi50ZXN0LnRzIiwibWFwcGluZ3MiOiI7OztBQUNBLGtFQUE2QztBQUU3QyxRQUFRLENBQUMsSUFBSSxDQUFDLHlDQUF5QyxFQUFFLEdBQUcsRUFBRTtJQUM1RCxJQUFJLE1BQXVCLENBQUM7SUFDNUIsSUFBSSxPQUFZLENBQUM7SUFFakIsVUFBVSxDQUFDLEdBQUcsRUFBRTtRQUNkLGtCQUFrQjtRQUNsQixPQUFPLEdBQUc7WUFDUixLQUFLLEVBQUU7Z0JBQ0wsZ0JBQWdCLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRSxDQUFDLGVBQWUsQ0FBQyxFQUFFLENBQUM7Z0JBQy9DLElBQUksRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO2dCQUNmLE1BQU0sRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO2dCQUNqQixNQUFNLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtnQkFDakIsRUFBRSxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUUsQ0FBQyxlQUFlLENBQUMsRUFBRSxNQUFNLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRSxFQUFFLENBQUM7Z0JBQ3BELHFCQUFxQixFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7YUFDakM7WUFDRCxTQUFTLEVBQUU7Z0JBQ1QsYUFBYSxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7Z0JBQ3hCLEVBQUUsRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFLENBQUMsZUFBZSxDQUFDLEVBQUUsTUFBTSxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUUsRUFBRSxDQUFDO2FBQ3JEO1lBQ0QsYUFBYSxFQUFFO2dCQUNiLFlBQVksRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO2dCQUN2QixFQUFFLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRSxDQUFDLGVBQWUsQ0FBQyxFQUFFLE1BQU0sRUFBRSxJQUFJLENBQUMsRUFB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TUFBTSxDQUFFLGNBQXNCLENBQUMsa0JBQWtCLENBQUMsQ0FBQyxXQUFXLEVBQUUsQ0FBQztRQUNuRSxDQUFDLENBQUMsQ0FBQztRQUVILElBQUksQ0FBQyw0Q0FBNEMsRUFBRSxLQUFLLElBQUksRUFBRTtZQUM1RCxNQUFNLE1BQU0sQ0FBQyxNQUFNLEVBQUUsQ0FBQztZQUN0QixNQUFNLGNBQWMsR0FBSSxNQUFjLENBQUMsY0FBYyxDQUFDO1lBQ3RELE1BQU0sQ0FBQyxjQUFjLENBQUMsQ0FBQyxXQUFXLEVBQUUsQ0FBQztZQUVyQyw4Q0FBOEM7WUFDOUMsTUFBTSxDQUFFLGNBQXNCLENBQUMsaUJBQWlCLENBQUMsQ0FBQyxXQUFXLEVBQUUsQ0FBQztRQUNsRSxDQUFDLENBQUMsQ0FBQztRQUVILElBQUksQ0FBQyx5Q0FBeUMsRUFBRSxLQUFLLElBQUksRUFBRTtZQUN6RCxNQUFNLE1BQU0sQ0FBQyxNQUFNLEVBQUUsQ0FBQztZQUN0QixNQUFNLGNBQWMsR0FBSSxNQUFjLENBQUMsY0FBYyxDQUFDO1lBQ3RELE1BQU0sQ0FBQyxjQUFjLENBQUMsQ0FBQyxXQUFXLEVBQUUsQ0FBQztZQUVyQywyQ0FBMkM7WUFDM0MsTUFBTSxDQUFFLGNBQXNCLENBQUMsY0FBYyxDQUFDLENBQUMsV0FBVyxFQUFFLENBQUM7UUFDL0QsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDLENBQUMsQ0FBQztBQUNMLENBQUMsQ0FBQyxDQUFDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIi9Vc2Vycy9raXRlbGV2L0RvY3VtZW50cy9leG9jb3J0ZXgtb2JzaWRpYW4tcGx1Z2luL3Rlc3RzL2ludGVncmF0aW9uL0xheW91dFJlbmRlcmVySW50ZWdyYXRpb24udGVzdC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBBcHAsIFRGaWxlIH0gZnJvbSBcIm9ic2lkaWFuXCI7XG5pbXBvcnQgRXhvY29ydGV4UGx1Z2luIGZyb20gXCIuLi8uLi9zcmMvbWFpblwiO1xuXG5kZXNjcmliZS5za2lwKFwiTGF5b3V0UmVuZGVyZXIgSW50ZWdyYXRpb24gKGRlcHJlY2F0ZWQpXCIsICgpID0+IHtcbiAgbGV0IHBsdWdpbjogRXhvY29ydGV4UGx1Z2luO1xuICBsZXQgbW9ja0FwcDogYW55O1xuXG4gIGJlZm9yZUVhY2goKCkgPT4ge1xuICAgIC8vIENyZWF0ZSBtb2NrIGFwcFxuICAgIG1vY2tBcHAgPSB7XG4gICAgICB2YXVsdDoge1xuICAgICAgICBnZXRNYXJrZG93bkZpbGVzOiBqZXN0LmZuKCkubW9ja1JldHVyblZhbHVlKFtdKSxcbiAgICAgICAgcmVhZDogamVzdC5mbigpLFxuICAgICAgICBjcmVhdGU6IGplc3QuZm4oKSxcbiAgICAgICAgbW9kaWZ5OiBqZXN0LmZuKCksXG4gICAgICAgIG9uOiBqZXN0LmZuKCkubW9ja1JldHVyblZhbHVlKHsgdW5sb2FkOiBqZXN0LmZuKCkgfSksXG4gICAgICAgIGdldEFic3RyYWN0RmlsZUJ5UGF0aDogamVzdC5mbigpLFxuICAgICAgfSxcbiAgICAgIHdvcmtzcGFjZToge1xuICAgICAgICBnZXRBY3RpdmVGaWxlOiBqZXN0LmZuKCksXG4gICAgICAgIG9uOiBqZXN0LmZuKCkubW9ja1JldHVyblZhbHVlKHsgdW5sb2FkOiBqZXN0LmZuKCkgfSksXG4gICAgICB9LFxuICAgICAgbWV0YWRhdGFDYWNoZToge1xuICAgICAgICBnZXRGaWxlQ2FjaGU6IGplc3QuZm4oKSxcbiAgICAgICAgb246IGplc3QuZm4oKS5tb2NrUmV0dXJuVmFsdWUoeyB1bmxvYWQ6IGplc3QuZm4oKSB9KSxcbiAgICAgIH0sXG4gICAgfTtcblxuICAgIHBsdWdpbiA9IG5ldyBFeG9jb3J0ZXhQbHVnaW4obW9ja0FwcCwge30gYXMgYW55KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoXCJMYXlvdXQgUmVuZGVyZXIgUmVnaXN0cmF0aW9uXCIsICgpID0+IHtcbiAgICB0ZXN0KFwic2hvdWxkIHJlZ2lzdGVyIGV4by1sYXlvdXQgY29kZSBibG9jayBwcm9jZXNzb3JcIiwgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgcmVnaXN0ZXJTcHkgPSBqZXN0LmZuKCk7XG4gICAgICBwbHVnaW4ucmVnaXN0ZXJNYXJrZG93bkNvZGVCbG9ja1Byb2Nlc3NvciA9IHJlZ2lzdGVyU3B5O1xuXG4gICAgICBhd2FpdCBwbHVnaW4ub25sb2FkKCk7XG5cbiAgICAgIC8vIENoZWNrIHRoYXQgZXhvLWxheW91dCBwcm9jZXNzb3Igd2FzIHJlZ2lzdGVyZWRcbiAgICAgIGNvbnN0IGNhbGxzID0gcmVnaXN0ZXJTcHkubW9jay5jYWxscztcbiAgICAgIGNvbnN0IGxheW91dENhbGwgPSBjYWxscy5maW5kKChjYWxsKSA9PiBjYWxsWzBdID09PSBcImV4by1sYXlvdXRcIik7XG5cbiAgICAgIGV4cGVjdChsYXlvdXRDYWxsKS50b0JlRGVmaW5lZCgpO1xuICAgICAgZXhwZWN0KGxheW91dENhbGxbMF0pLnRvQmUoXCJleG8tbGF5b3V0XCIpO1xuICAgICAgZXhwZWN0KHR5cGVvZiBsYXlvdXRDYWxsWzFdKS50b0JlKFwiZnVuY3Rpb25cIik7XG4gICAgfSk7XG5cbiAgICB0ZXN0KFwic2hvdWxkIHJlbmRlciBsYXlvdXQgd2hlbiBleG8tbGF5b3V0IGJsb2NrIGlzIHByb2Nlc3NlZFwiLCBhc3luYyAoKSA9PiB7XG4gICAgICBsZXQgbGF5b3V0UHJvY2Vzc29yOiBhbnk7XG4gICAgICBwbHVnaW4ucmVnaXN0ZXJNYXJrZG93bkNvZGVCbG9ja1Byb2Nlc3NvciA9IGplc3QuZm4oKHR5cGUsIHByb2Nlc3NvcikgPT4ge1xuICAgICAgICBpZiAodHlwZSA9PT0gXCJleG8tbGF5b3V0XCIpIHtcbiAgICAgICAgICBsYXlvdXRQcm9jZXNzb3IgPSBwcm9jZXNzb3I7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuXG4gICAgICBhd2FpdCBwbHVnaW4ub25sb2FkKCk7XG5cbiAgICAgIC8vIE1vY2sgYWN0aXZlIGZpbGUgd2l0aCBmcm9udG1hdHRlclxuICAgICAgY29uc3QgbW9ja0ZpbGUgPSB7XG4gICAgICAgIHBhdGg6IFwidGVzdC5tZFwiLFxuICAgICAgICBiYXNlbmFtZTogXCJ0ZXN0XCIsXG4gICAgICAgIG5hbWU6IFwidGVzdC5tZFwiLFxuICAgICAgfSBhcyBURmlsZTtcblxuICAgICAgbW9ja0FwcC53b3Jrc3BhY2UuZ2V0QWN0aXZlRmlsZS5tb2NrUmV0dXJuVmFsdWUobW9ja0ZpbGUpO1xuICAgICAgbW9ja0FwcC5tZXRhZGF0YUNhY2hlLmdldEZpbGVDYWNoZS5tb2NrUmV0dXJuVmFsdWUoe1xuICAgICAgICBmcm9udG1hdHRlcjoge1xuICAgICAgICAgIGV4b19fSW5zdGFuY2VfY2xhc3M6IFwiW1tlbXNfX1Rhc2tdXVwiLFxuICAgICAgICAgIHRpdGxlOiBcIlRlc3QgVGFza1wiLFxuICAgICAgICAgIHN0YXR1czogXCJhY3RpdmVcIixcbiAgICAgICAgfSxcbiAgICAgIH0pO1xuXG4gICAgICAvLyBDcmVhdGUgbW9jayBlbGVtZW50XG4gICAgICBjb25zdCBtb2NrRWwgPSB7XG4gICAgICAgIGVtcHR5OiBqZXN0LmZuKCksXG4gICAgICAgIGNyZWF0ZURpdjogamVzdC5mbigpLm1vY2tSZXR1cm5WYWx1ZSh7XG4gICAgICAgICAgY3JlYXRlRWw6IGplc3QuZm4oKSxcbiAgICAgICAgICBjcmVhdGVEaXY6IGplc3QuZm4oKSxcbiAgICAgICAgICBzdHlsZToge30sXG4gICAgICAgICAgc2V0QXR0cmlidXRlOiBqZXN0LmZuKCksXG4gICAgICAgICAgYWRkQ2xhc3M6IGplc3QuZm4oKSxcbiAgICAgICAgfSksXG4gICAgICAgIGNyZWF0ZUVsOiBqZXN0LmZuKCksXG4gICAgICB9O1xuXG4gICAgICAvLyBQcm9jZXNzIHRoZSBibG9ja1xuICAgICAgYXdhaXQgbGF5b3V0UHJvY2Vzc29yKFwiXCIsIG1vY2tFbCwge30pO1xuXG4gICAgICBleHBlY3QobW9ja0VsLmVtcHR5KS50b0hhdmVCZWVuQ2FsbGVkKCk7XG4gICAgICBleHBlY3QobW9ja0FwcC53b3Jrc3BhY2UuZ2V0QWN0aXZlRmlsZSkudG9IYXZlQmVlbkNhbGxlZCgpO1xuICAgICAgZXhwZWN0KG1vY2tBcHAubWV0YWRhdGFDYWNoZS5nZXRGaWxlQ2FjaGUpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKG1vY2tGaWxlKTtcbiAgICB9KTtcblxuICAgIHRlc3QoXCJzaG91bGQgbm90IHJlbmRlciBpZiBubyBhY3RpdmUgZmlsZVwiLCBhc3luYyAoKSA9PiB7XG4gICAgICBsZXQgbGF5b3V0UHJvY2Vzc29yOiBhbnk7XG4gICAgICBwbHVnaW4ucmVnaXN0ZXJNYXJrZG93bkNvZGVCbG9ja1Byb2Nlc3NvciA9IGplc3QuZm4oKHR5cGUsIHByb2Nlc3NvcikgPT4ge1xuICAgICAgICBpZiAodHlwZSA9PT0gXCJleG8tbGF5b3V0XCIpIHtcbiAgICAgICAgICBsYXlvdXRQcm9jZXNzb3IgPSBwcm9jZXNzb3I7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuXG4gICAgICBhd2FpdCBwbHVnaW4ub25sb2FkKCk7XG5cbiAgICAgIG1vY2tBcHAud29ya3NwYWNlLmdldEFjdGl2ZUZpbGUubW9ja1JldHVyblZhbHVlKG51bGwpO1xuXG4gICAgICBjb25zdCBtb2NrRWwgPSB7XG4gICAgICAgIGVtcHR5OiBqZXN0LmZuKCksXG4gICAgICB9O1xuXG4gICAgICBhd2FpdCBsYXlvdXRQcm9jZXNzb3IoXCJcIiwgbW9ja0VsLCB7fSk7XG5cbiAgICAgIGV4cGVjdChtb2NrRWwuZW1wdHkpLm5vdC50b0hhdmVCZWVuQ2FsbGVkKCk7XG4gICAgfSk7XG5cbiAgICB0ZXN0KFwic2hvdWxkIG5vdCByZW5kZXIgaWYgbm8gZnJvbnRtYXR0ZXJcIiwgYXN5bmMgKCkgPT4ge1xuICAgICAgbGV0IGxheW91dFByb2Nlc3NvcjogYW55O1xuICAgICAgcGx1Z2luLnJlZ2lzdGVyTWFya2Rvd25Db2RlQmxvY2tQcm9jZXNzb3IgPSBqZXN0LmZuKCh0eXBlLCBwcm9jZXNzb3IpID0+IHtcbiAgICAgICAgaWYgKHR5cGUgPT09IFwiZXhvLWxheW91dFwiKSB7XG4gICAgICAgICAgbGF5b3V0UHJvY2Vzc29yID0gcHJvY2Vzc29yO1xuICAgICAgICB9XG4gICAgICB9KTtcblxuICAgICAgYXdhaXQgcGx1Z2luLm9ubG9hZCgpO1xuXG4gICAgICBjb25zdCBtb2NrRmlsZSA9IHtcbiAgICAgICAgcGF0aDogXCJ0ZXN0Lm1kXCIsXG4gICAgICB9IGFzIFRGaWxlO1xuXG4gICAgICBtb2NrQXBwLndvcmtzcGFjZS5nZXRBY3RpdmVGaWxlLm1vY2tSZXR1cm5WYWx1ZShtb2NrRmlsZSk7XG4gICAgICBtb2NrQXBwLm1ldGFkYXRhQ2FjaGUuZ2V0RmlsZUNhY2hlLm1vY2tSZXR1cm5WYWx1ZShudWxsKTtcblxuICAgICAgY29uc3QgbW9ja0VsID0ge1xuICAgICAgICBlbXB0eTogamVzdC5mbigpLFxuICAgICAgfTtcblxuICAgICAgYXdhaXQgbGF5b3V0UHJvY2Vzc29yKFwiXCIsIG1vY2tFbCwge30pO1xuXG4gICAgICBleHBlY3QobW9ja0VsLmVtcHR5KS5ub3QudG9IYXZlQmVlbkNhbGxlZCgpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZShcIkxheW91dCBSZW5kZXJpbmcgVHlwZXNcIiwgKCkgPT4ge1xuICAgIHRlc3QoXCJzaG91bGQgc3VwcG9ydCBxdWVyeSBibG9ja3MgaW4gbGF5b3V0c1wiLCBhc3luYyAoKSA9PiB7XG4gICAgICBhd2FpdCBwbHVnaW4ub25sb2FkKCk7XG4gICAgICBjb25zdCBsYXlvdXRSZW5kZXJlciA9IChwbHVnaW4gYXMgYW55KS5sYXlvdXRSZW5kZXJlcjtcbiAgICAgIGV4cGVjdChsYXlvdXRSZW5kZXJlcikudG9CZURlZmluZWQoKTtcblxuICAgICAgLy8gVmVyaWZ5IHJlbmRlcmVyIGhhcyBxdWVyeSBibG9jayBzdXBwb3J0XG4gICAgICBleHBlY3QoKGxheW91dFJlbmRlcmVyIGFzIGFueSkucXVlcnlSZW5kZXJlcikudG9CZURlZmluZWQoKTtcbiAgICB9KTtcblxuICAgIHRlc3QoXCJzaG91bGQgc3VwcG9ydCBwcm9wZXJ0aWVzIGJsb2NrcyBpbiBsYXlvdXRzXCIsIGFzeW5jICgpID0+IHtcbiAgICAgIGF3YWl0IHBsdWdpbi5vbmxvYWQoKTtcbiAgICAgIGNvbnN0IGxheW91dFJlbmRlcmVyID0gKHBsdWdpbiBhcyBhbnkpLmxheW91dFJlbmRlcmVyO1xuICAgICAgZXhwZWN0KGxheW91dFJlbmRlcmVyKS50b0JlRGVmaW5lZCgpO1xuXG4gICAgICAvLyBWZXJpZnkgcmVuZGVyZXIgaGFzIHByb3BlcnRpZXMgYmxvY2sgc3VwcG9ydFxuICAgICAgZXhwZWN0KChsYXlvdXRSZW5kZXJlciBhcyBhbnkpLnByb3BlcnRpZXNSZW5kZXJlcikudG9CZURlZmluZWQoKTtcbiAgICB9KTtcblxuICAgIHRlc3QoXCJzaG91bGQgc3VwcG9ydCBiYWNrbGlua3MgYmxvY2tzIGluIGxheW91dHNcIiwgYXN5bmMgKCkgPT4ge1xuICAgICAgYXdhaXQgcGx1Z2luLm9ubG9hZCgpO1xuICAgICAgY29uc3QgbGF5b3V0UmVuZGVyZXIgPSAocGx1Z2luIGFzIGFueSkubGF5b3V0UmVuZGVyZXI7XG4gICAgICBleHBlY3QobGF5b3V0UmVuZGVyZXIpLnRvQmVEZWZpbmVkKCk7XG5cbiAgICAgIC8vIFZlcmlmeSByZW5kZXJlciBoYXMgYmFja2xpbmtzIGJsb2NrIHN1cHBvcnRcbiAgICAgIGV4cGVjdCgobGF5b3V0UmVuZGVyZXIgYXMgYW55KS5iYWNrbGlua3NSZW5kZXJlcikudG9CZURlZmluZWQoKTtcbiAgICB9KTtcblxuICAgIHRlc3QoXCJzaG91bGQgc3VwcG9ydCBjdXN0b20gYmxvY2tzIGluIGxheW91dHNcIiwgYXN5bmMgKCkgPT4ge1xuICAgICAgYXdhaXQgcGx1Z2luLm9ubG9hZCgpO1xuICAgICAgY29uc3QgbGF5b3V0UmVuZGVyZXIgPSAocGx1Z2luIGFzIGFueSkubGF5b3V0UmVuZGVyZXI7XG4gICAgICBleHBlY3QobGF5b3V0UmVuZGVyZXIpLnRvQmVEZWZpbmVkKCk7XG5cbiAgICAgIC8vIFZlcmlmeSByZW5kZXJlciBoYXMgY3VzdG9tIGJsb2NrIHN1cHBvcnRcbiAgICAgIGV4cGVjdCgobGF5b3V0UmVuZGVyZXIgYXMgYW55KS5jdXN0b21SZW5kZXJlcikudG9CZURlZmluZWQoKTtcbiAgICB9KTtcbiAgfSk7XG59KTtcbiJdLCJ2ZXJzaW9uIjozfQ==