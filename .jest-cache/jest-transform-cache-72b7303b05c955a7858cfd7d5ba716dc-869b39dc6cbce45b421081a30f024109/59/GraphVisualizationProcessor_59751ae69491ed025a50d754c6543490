27d10eb31336bb03e4c423d14ffa1ed8
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.GraphVisualizationProcessor = void 0;
const obsidian_1 = require("obsidian");
const SPARQLEngine_1 = require("../../application/SPARQLEngine");
const Graph_1 = require("../../domain/semantic/core/Graph");
const Triple_1 = require("../../domain/semantic/core/Triple");
const ExportRDFModal_1 = require("../modals/ExportRDFModal");
const DIContainer_1 = require("../../infrastructure/container/DIContainer");
class GraphVisualizationProcessor {
    constructor(plugin, graph) {
        this.plugin = plugin;
        this.graph = graph;
        this.engine = new SPARQLEngine_1.SPARQLEngine(graph);
        // Get RDFService from DI container
        const container = DIContainer_1.DIContainer.getInstance();
        this.rdfService = container.resolve("RDFService");
    }
    /**
     * Main processor method called by Obsidian
     */
    async processCodeBlock(source, el, ctx) {
        el.empty();
        // Create main container
        const container = document.createElement("div");
        container.className = "exocortex-graph-container";
        container.style.cssText = `
            border: 1px solid var(--background-modifier-border);
            padding: 1em;
            margin: 1em 0;
            border-radius: var(--radius-m);
            background: var(--background-secondary);
            position: relative;
        `;
        el.appendChild(container);
        try {
            // Parse configuration
            const config = this.parseConfig(source.trim());
            // Show loading indicator
            const loadingEl = this.createLoadingIndicator();
            container.appendChild(loadingEl);
            // Get graph data
            const graphData = await this.getGraphData(config);
            // Remove loading indicator
            loadingEl.remove();
            if (graphData.nodes.length === 0) {
                const emptyMessage = document.createElement("div");
                emptyMessage.textContent = "No graph data found";
                emptyMessage.style.cssText =
                    "padding: 2em; text-align: center; color: var(--text-muted);";
                container.appendChild(emptyMessage);
                return;
            }
            // Create graph visualization
            await this.createGraphVisualization(container, graphData, config);
            // Add controls
            this.addControls(container, graphData, config);
        }
        catch (error) {
            container.innerHTML = "";
            const errorEl = this.createErrorMessage(error);
            container.appendChild(errorEl);
            console.error("Graph visualization error:", error);
        }
    }
    parseConfig(source) {
        const config = {
            limit: 100,
            showLabels: true,
            nodeSize: 8,
            linkDistance: 80,
            depth: 2,
        };
        const lines = source
            .split("\n")
            .map((l) => l.trim())
            .filter((l) => l);
        // Check if it's a SPARQL query
        if (source.toUpperCase().includes("SELECT")) {
            config.query = source;
            return config;
        }
        // Parse configuration options
        for (const line of lines) {
            if (line.includes(":")) {
                const [key, value] = line.split(":").map((s) => s.trim());
                switch (key.toLowerCase()) {
                    case "focus":
                        config.focus = value.replace(/\[\[|\]\]/g, "");
                        break;
                    case "depth":
                        config.depth = parseInt(value) || 2;
                        break;
                    case "limit":
                        config.limit = parseInt(value) || 100;
                        break;
                    case "query":
                        config.query = value;
                        break;
                    case "showlabels":
                        config.showLabels = value.toLowerCase() === "true";
                        break;
                    case "nodesize":
                        config.nodeSize = parseInt(value) || 8;
                        break;
                    case "linkdistance":
                        config.linkDistance = parseInt(value) || 80;
                        break;
                }
            }
        }
        return config;
    }
    async getGraphData(config) {
        let triples = [];
        if (config.query) {
            // Execute SPARQL query to get specific triples
            const result = this.engine.select(config.query);
            // Convert SPARQL results to triples
            for (const row of result.results) {
                if (row.s && row.p && row.o) {
                    triples.push(new Triple_1.Triple(new Triple_1.IRI(row.s), new Triple_1.IRI(row.p), row.o.startsWith('"')
                        ? Triple_1.Literal.string(row.o.replace(/^"|"$/g, ""))
                        : new Triple_1.IRI(row.o)));
                }
                else if (row.subject && row.predicate && row.object) {
                    triples.push(new Triple_1.Triple(new Triple_1.IRI(row.subject), new Triple_1.IRI(row.predicate), row.object.startsWith('"')
                        ? Triple_1.Literal.string(row.object.replace(/^"|"$/g, ""))
                        : new Triple_1.IRI(row.object)));
                }
            }
        }
        else if (config.focus) {
            // Get triples centered around focus entity
            triples = this.getTriplesAroundFocus(config.focus, config.depth || 2);
        }
        else {
            // Get all triples (with limit)
            triples = this.graph.match(null, null, null);
        }
        // Apply limit
        if (config.limit && triples.length > config.limit) {
            triples = triples.slice(0, config.limit);
        }
        return this.convertTriplesToGraphData(triples);
    }
    getTriplesAroundFocus(focus, depth) {
        const visited = new Set();
        const result = [];
        const queue = [
            { entity: focus, currentDepth: 0 },
        ];
        while (queue.length > 0) {
            const { entity, currentDepth } = queue.shift();
            if (visited.has(entity) || currentDepth >= depth) {
                continue;
            }
            visited.add(entity);
            // Get triples where entity is subject
            const subjectTriples = this.graph.match(new Triple_1.IRI(entity), null, null);
            result.push(...subjectTriples);
            // Get triples where entity is object
            const objectTriples = this.graph.match(null, null, new Triple_1.IRI(entity));
            result.push(...objectTriples);
            // Add related entities to queue for next depth level
            if (currentDepth < depth - 1) {
                for (const triple of subjectTriples) {
                    const objectStr = triple.getObject().toString();
                    if (!visited.has(objectStr)) {
                        queue.push({ entity: objectStr, currentDepth: currentDepth + 1 });
                    }
                }
                for (const triple of objectTriples) {
                    const subjectStr = triple.getSubject().toString();
                    if (!visited.has(subjectStr)) {
                        queue.push({ entity: subjectStr, currentDepth: currentDepth + 1 });
                    }
                }
            }
        }
        return result;
    }
    convertTriplesToGraphData(triples) {
        const nodesMap = new Map();
        const links = [];
        for (const triple of triples) {
            const subjectStr = triple.getSubject().toString();
            const predicateStr = triple.getPredicate().toString();
            const objectStr = triple.getObject().toString();
            // Add subject node
            if (!nodesMap.has(subjectStr)) {
                nodesMap.set(subjectStr, {
                    id: subjectStr,
                    label: this.getDisplayLabel(subjectStr),
                    type: "subject",
                    group: 1,
                });
            }
            // Add object node
            if (!nodesMap.has(objectStr)) {
                nodesMap.set(objectStr, {
                    id: objectStr,
                    label: this.getDisplayLabel(objectStr),
                    type: "object",
                    group: 2,
                });
            }
            // Add link
            const linkId = `${subjectStr}-${predicateStr}-${objectStr}`;
            links.push({
                source: subjectStr,
                target: objectStr,
                label: predicateStr,
                id: linkId,
            });
        }
        return {
            nodes: Array.from(nodesMap.values()),
            links,
        };
    }
    getDisplayLabel(uri) {
        // Extract human-readable label from URI
        if (uri.startsWith("file://")) {
            return uri.replace("file://", "");
        }
        // Extract last part of URI
        const parts = uri.split("/");
        return parts[parts.length - 1] || uri;
    }
    async createGraphVisualization(container, data, config) {
        // Create SVG container
        const svgContainer = document.createElement("div");
        svgContainer.style.cssText =
            "position: relative; width: 100%; height: 600px; overflow: hidden;";
        container.appendChild(svgContainer);
        const svg = document.createElementNS("http://www.w3.org/2000/svg", "svg");
        svg.setAttribute("width", "100%");
        svg.setAttribute("height", "600");
        svg.style.cssText =
            "border: 1px solid var(--background-modifier-border); background: var(--background-primary);";
        svgContainer.appendChild(svg);
        // Create D3.js-like force simulation manually (simplified version)
        await this.createForceDirectedGraph(svg, data, config);
        // Store data for export functionality
        container.__graphData = data;
        container.__graphConfig = config;
    }
    async createForceDirectedGraph(svg, data, config) {
        const width = 800;
        const height = 600;
        const centerX = width / 2;
        const centerY = height / 2;
        // Create groups for different elements
        const defs = document.createElementNS("http://www.w3.org/2000/svg", "defs");
        svg.appendChild(defs);
        // Add arrow marker for directed edges
        const marker = document.createElementNS("http://www.w3.org/2000/svg", "marker");
        marker.setAttribute("id", "arrowhead");
        marker.setAttribute("viewBox", "0 -5 10 10");
        marker.setAttribute("refX", "8");
        marker.setAttribute("refY", "0");
        marker.setAttribute("orient", "auto");
        marker.setAttribute("markerWidth", "6");
        marker.setAttribute("markerHeight", "6");
        const path = document.createElementNS("http://www.w3.org/2000/svg", "path");
        path.setAttribute("d", "M 0,-5 L 10 ,0 L 0,5");
        path.setAttribute("fill", "var(--text-muted)");
        marker.appendChild(path);
        defs.appendChild(marker);
        const g = document.createElementNS("http://www.w3.org/2000/svg", "g");
        svg.appendChild(g);
        // Position nodes using simple force-directed layout
        this.positionNodes(data.nodes, width, height);
        // Create links
        const linksGroup = document.createElementNS("http://www.w3.org/2000/svg", "g");
        linksGroup.setAttribute("class", "links");
        g.appendChild(linksGroup);
        for (const link of data.links) {
            const sourceNode = data.nodes.find((n) => n.id === link.source);
            const targetNode = data.nodes.find((n) => n.id === link.target);
            if (sourceNode && targetNode) {
                const line = document.createElementNS("http://www.w3.org/2000/svg", "line");
                line.setAttribute("x1", sourceNode.x?.toString() || "0");
                line.setAttribute("y1", sourceNode.y?.toString() || "0");
                line.setAttribute("x2", targetNode.x?.toString() || "0");
                line.setAttribute("y2", targetNode.y?.toString() || "0");
                line.setAttribute("stroke", "var(--text-muted)");
                line.setAttribute("stroke-width", "1");
                line.setAttribute("marker-end", "url(#arrowhead)");
                line.style.cursor = "pointer";
                // Add hover effect
                line.addEventListener("mouseenter", () => {
                    line.setAttribute("stroke", "var(--text-accent)");
                    line.setAttribute("stroke-width", "2");
                });
                line.addEventListener("mouseleave", () => {
                    line.setAttribute("stroke", "var(--text-muted)");
                    line.setAttribute("stroke-width", "1");
                });
                linksGroup.appendChild(line);
                // Add edge label if enabled
                if (config.showLabels && link.label) {
                    const midX = ((sourceNode.x || 0) + (targetNode.x || 0)) / 2;
                    const midY = ((sourceNode.y || 0) + (targetNode.y || 0)) / 2;
                    const text = document.createElementNS("http://www.w3.org/2000/svg", "text");
                    text.setAttribute("x", midX.toString());
                    text.setAttribute("y", (midY - 5).toString());
                    text.setAttribute("text-anchor", "middle");
                    text.setAttribute("font-size", "10");
                    text.setAttribute("fill", "var(--text-muted)");
                    text.textContent = this.truncateLabel(link.label, 15);
                    // Add background rectangle for better readability
                    const bbox = text.getBBox();
                    const rect = document.createElementNS("http://www.w3.org/2000/svg", "rect");
                    rect.setAttribute("x", (bbox.x - 2).toString());
                    rect.setAttribute("y", (bbox.y - 1).toString());
                    rect.setAttribute("width", (bbox.width + 4).toString());
                    rect.setAttribute("height", (bbox.height + 2).toString());
                    rect.setAttribute("fill", "var(--background-primary)");
                    rect.setAttribute("opacity", "0.8");
                    linksGroup.appendChild(rect);
                    linksGroup.appendChild(text);
                }
            }
        }
        // Create nodes
        const nodesGroup = document.createElementNS("http://www.w3.org/2000/svg", "g");
        nodesGroup.setAttribute("class", "nodes");
        g.appendChild(nodesGroup);
        for (const node of data.nodes) {
            const nodeGroup = document.createElementNS("http://www.w3.org/2000/svg", "g");
            nodeGroup.setAttribute("class", "node");
            nodeGroup.style.cursor = "pointer";
            const circle = document.createElementNS("http://www.w3.org/2000/svg", "circle");
            circle.setAttribute("cx", node.x?.toString() || "0");
            circle.setAttribute("cy", node.y?.toString() || "0");
            circle.setAttribute("r", (config.nodeSize || 8).toString());
            circle.setAttribute("fill", this.getNodeColor(node.type));
            circle.setAttribute("stroke", "var(--background-modifier-border)");
            circle.setAttribute("stroke-width", "2");
            nodeGroup.appendChild(circle);
            // Add node label if enabled
            if (config.showLabels) {
                const text = document.createElementNS("http://www.w3.org/2000/svg", "text");
                text.setAttribute("x", node.x?.toString() || "0");
                text.setAttribute("y", ((node.y || 0) + (config.nodeSize || 8) + 15).toString());
                text.setAttribute("text-anchor", "middle");
                text.setAttribute("font-size", "12");
                text.setAttribute("fill", "var(--text-normal)");
                text.textContent = this.truncateLabel(node.label, 20);
                nodeGroup.appendChild(text);
            }
            // Add click handler for navigation
            nodeGroup.addEventListener("click", () => {
                this.handleNodeClick(node);
            });
            // Add hover effects
            nodeGroup.addEventListener("mouseenter", () => {
                circle.setAttribute("r", ((config.nodeSize || 8) + 2).toString());
                circle.setAttribute("stroke-width", "3");
            });
            nodeGroup.addEventListener("mouseleave", () => {
                circle.setAttribute("r", (config.nodeSize || 8).toString());
                circle.setAttribute("stroke-width", "2");
            });
            nodesGroup.appendChild(nodeGroup);
        }
        // Add zoom and pan functionality
        this.addZoomPan(svg, g);
    }
    positionNodes(nodes, width, height) {
        // Simple circular layout as starting positions
        const centerX = width / 2;
        const centerY = height / 2;
        const radius = Math.min(width, height) / 3;
        nodes.forEach((node, i) => {
            const angle = (i / nodes.length) * 2 * Math.PI;
            node.x = centerX + radius * Math.cos(angle);
            node.y = centerY + radius * Math.sin(angle);
        });
    }
    getNodeColor(type) {
        switch (type) {
            case "subject":
                return "var(--color-accent)";
            case "object":
                return "var(--color-blue)";
            case "predicate":
                return "var(--color-green)";
            default:
                return "var(--text-muted)";
        }
    }
    truncateLabel(label, maxLength) {
        if (label.length <= maxLength)
            return label;
        return label.substring(0, maxLength - 3) + "...";
    }
    handleNodeClick(node) {
        // If it's a file link, navigate to it
        if (node.id.startsWith("file://") || node.id.includes(".md")) {
            const filename = node.id.replace("file://", "");
            this.plugin.app.workspace.openLinkText(filename, "");
        }
        else {
            // Show node details in a notice
            new obsidian_1.Notice(`Node: ${node.label}\nType: ${node.type}\nID: ${node.id}`, 3000);
        }
    }
    addZoomPan(svg, g) {
        let isMouseDown = false;
        let startX = 0;
        let startY = 0;
        let currentTransform = { x: 0, y: 0, scale: 1 };
        svg.addEventListener("mousedown", (e) => {
            isMouseDown = true;
            startX = e.clientX;
            startY = e.clientY;
            svg.style.cursor = "grabbing";
        });
        svg.addEventListener("mousemove", (e) => {
            if (!isMouseDown)
                return;
            const deltaX = e.clientX - startX;
            const deltaY = e.clientY - startY;
            currentTransform.x += deltaX;
            currentTransform.y += deltaY;
            g.setAttribute("transform", `translate(${currentTransform.x}, ${currentTransform.y}) scale(${currentTransform.scale})`);
            startX = e.clientX;
            startY = e.clientY;
        });
        svg.addEventListener("mouseup", () => {
            isMouseDown = false;
            svg.style.cursor = "grab";
        });
        svg.addEventListener("wheel", (e) => {
            e.preventDefault();
            const scaleFactor = e.deltaY > 0 ? 0.9 : 1.1;
            currentTransform.scale = Math.max(0.1, Math.min(3, currentTransform.scale * scaleFactor));
            g.setAttribute("transform", `translate(${currentTransform.x}, ${currentTransform.y}) scale(${currentTransform.scale})`);
        });
        svg.style.cursor = "grab";
    }
    addControls(container, data, config) {
        const controlsDiv = document.createElement("div");
        controlsDiv.style.cssText = `
            margin-top: 1em;
            display: flex;
            gap: 0.5em;
            flex-wrap: wrap;
            align-items: center;
            padding: 0.5em;
            background: var(--background-modifier-form-field);
            border-radius: var(--radius-s);
        `;
        // Node count info
        const info = document.createElement("span");
        info.textContent = `Nodes: ${data.nodes.length}, Links: ${data.links.length}`;
        info.style.cssText =
            "color: var(--text-muted); font-size: 0.9em; margin-right: auto;";
        controlsDiv.appendChild(info);
        // PNG Export dropdown
        const pngExportContainer = this.createPNGExportDropdown(container, data, config);
        controlsDiv.appendChild(pngExportContainer);
        // Export as SVG button
        const exportSvgBtn = document.createElement("button");
        exportSvgBtn.textContent = "Export SVG";
        exportSvgBtn.className = "mod-cta";
        exportSvgBtn.style.cssText = "padding: 0.25em 0.5em; font-size: 0.9em;";
        exportSvgBtn.addEventListener("click", () => this.exportAsSVG(container));
        controlsDiv.appendChild(exportSvgBtn);
        // Export as RDF dropdown
        const rdfExportContainer = document.createElement("div");
        rdfExportContainer.style.cssText =
            "position: relative; display: inline-block;";
        const rdfExportBtn = document.createElement("button");
        rdfExportBtn.textContent = "Export RDF ▼";
        rdfExportBtn.style.cssText =
            "padding: 0.25em 0.5em; font-size: 0.9em; background: var(--interactive-accent); color: var(--text-on-accent); border: none; border-radius: 3px; cursor: pointer;";
        const rdfDropdown = document.createElement("div");
        rdfDropdown.style.cssText = `
            display: none;
            position: absolute;
            top: 100%;
            left: 0;
            background: var(--background-primary);
            border: 1px solid var(--background-modifier-border);
            border-radius: 3px;
            box-shadow: var(--shadow-s);
            z-index: 1000;
            min-width: 120px;
        `;
        const formats = [
            { format: "turtle", label: "Turtle (.ttl)" },
            { format: "json-ld", label: "JSON-LD (.jsonld)" },
            { format: "n-triples", label: "N-Triples (.nt)" },
            { format: "rdf-xml", label: "RDF/XML (.rdf)" },
        ];
        for (const { format, label } of formats) {
            const item = document.createElement("div");
            item.textContent = label;
            item.style.cssText =
                "padding: 0.5em 0.8em; cursor: pointer; border-bottom: 1px solid var(--background-modifier-border);";
            item.addEventListener("mouseenter", () => {
                item.style.background = "var(--background-modifier-hover)";
            });
            item.addEventListener("mouseleave", () => {
                item.style.background = "";
            });
            item.addEventListener("click", () => {
                this.exportGraphAsRDF(data, format);
                rdfDropdown.style.display = "none";
            });
            rdfDropdown.appendChild(item);
        }
        // Advanced export option
        const advancedItem = document.createElement("div");
        advancedItem.textContent = "Advanced...";
        advancedItem.style.cssText =
            "padding: 0.5em 0.8em; cursor: pointer; font-weight: 500; color: var(--text-accent);";
        advancedItem.addEventListener("mouseenter", () => {
            advancedItem.style.background = "var(--background-modifier-hover)";
        });
        advancedItem.addEventListener("mouseleave", () => {
            advancedItem.style.background = "";
        });
        advancedItem.addEventListener("click", () => {
            this.openAdvancedRDFExport(data);
            rdfDropdown.style.display = "none";
        });
        rdfDropdown.appendChild(advancedItem);
        rdfExportBtn.addEventListener("click", (e) => {
            e.stopPropagation();
            rdfDropdown.style.display =
                rdfDropdown.style.display === "none" ? "block" : "none";
        });
        // Close dropdown when clicking outside
        document.addEventListener("click", () => {
            rdfDropdown.style.display = "none";
        });
        rdfExportContainer.appendChild(rdfExportBtn);
        rdfExportContainer.appendChild(rdfDropdown);
        controlsDiv.appendChild(rdfExportContainer);
        // Reset zoom button
        const resetBtn = document.createElement("button");
        resetBtn.textContent = "Reset View";
        resetBtn.style.cssText = "padding: 0.25em 0.5em; font-size: 0.9em;";
        resetBtn.addEventListener("click", () => this.resetView(container));
        controlsDiv.appendChild(resetBtn);
        container.appendChild(controlsDiv);
    }
    createPNGExportDropdown(container, data, config) {
        const pngExportContainer = document.createElement("div");
        pngExportContainer.style.cssText =
            "position: relative; display: inline-block;";
        const pngExportBtn = document.createElement("button");
        pngExportBtn.textContent = "Export PNG ▼";
        pngExportBtn.style.cssText =
            "padding: 0.25em 0.5em; font-size: 0.9em; background: var(--interactive-accent); color: var(--text-on-accent); border: none; border-radius: 3px; cursor: pointer;";
        const pngDropdown = document.createElement("div");
        pngDropdown.style.cssText = `
            display: none;
            position: absolute;
            top: 100%;
            left: 0;
            background: var(--background-primary);
            border: 1px solid var(--background-modifier-border);
            border-radius: 3px;
            box-shadow: var(--shadow-s);
            z-index: 1000;
            min-width: 180px;
        `;
        const resolutions = [
            { scale: 1, label: "Standard (800×600)", filename: "graph-standard.png" },
            { scale: 2, label: "High-DPI (1600×1200)", filename: "graph-hd.png" },
            { scale: 4, label: "4K (3200×2400)", filename: "graph-4k.png" },
        ];
        for (const resolution of resolutions) {
            const item = document.createElement("div");
            item.textContent = resolution.label;
            item.style.cssText =
                "padding: 0.5em 0.8em; cursor: pointer; border-bottom: 1px solid var(--background-modifier-border);";
            item.addEventListener("mouseenter", () => {
                item.style.background = "var(--background-modifier-hover)";
            });
            item.addEventListener("mouseleave", () => {
                item.style.background = "";
            });
            item.addEventListener("click", () => {
                this.exportAsPNG(container, data, config, resolution.scale, resolution.filename);
                pngDropdown.style.display = "none";
            });
            pngDropdown.appendChild(item);
        }
        pngExportBtn.addEventListener("click", (e) => {
            e.stopPropagation();
            pngDropdown.style.display =
                pngDropdown.style.display === "none" ? "block" : "none";
        });
        // Close dropdown when clicking outside
        document.addEventListener("click", () => {
            pngDropdown.style.display = "none";
        });
        pngExportContainer.appendChild(pngExportBtn);
        pngExportContainer.appendChild(pngDropdown);
        return pngExportContainer;
    }
    async exportAsPNG(container, data, config, scale = 1, filename = "knowledge-graph.png") {
        const svg = container.querySelector("svg");
        if (!svg) {
            new obsidian_1.Notice("No graph visualization found");
            return;
        }
        try {
            // Show loading notice for high-resolution exports
            let loadingNotice = null;
            if (scale >= 2) {
                loadingNotice = new obsidian_1.Notice(`Generating ${scale === 2 ? "high-resolution" : "4K"} PNG export...`, 0);
            }
            // Create canvas with scaled dimensions
            const canvas = document.createElement("canvas");
            const baseWidth = 800;
            const baseHeight = 600;
            canvas.width = baseWidth * scale;
            canvas.height = baseHeight * scale;
            const ctx = canvas.getContext("2d");
            if (!ctx) {
                throw new Error("Could not get canvas context");
            }
            // Scale context for high-DPI rendering
            ctx.scale(scale, scale);
            // Set high-quality rendering
            ctx.imageSmoothingEnabled = true;
            ctx.imageSmoothingQuality = "high";
            // Fill background with theme color
            const bgColor = this.getThemeColor("--background-primary") || "#ffffff";
            ctx.fillStyle = bgColor;
            ctx.fillRect(0, 0, baseWidth, baseHeight);
            // Draw border
            const borderColor = this.getThemeColor("--background-modifier-border") || "#e5e5e5";
            ctx.strokeStyle = borderColor;
            ctx.lineWidth = 1;
            ctx.strokeRect(0, 0, baseWidth, baseHeight);
            // Render graph to canvas
            await this.renderGraphToCanvas(ctx, data, config, baseWidth, baseHeight);
            // Convert canvas to PNG blob
            canvas.toBlob((blob) => {
                if (blob) {
                    this.downloadBlob(blob, filename);
                    if (loadingNotice) {
                        loadingNotice.hide();
                    }
                    const sizeKB = Math.round(blob.size / 1024);
                    new obsidian_1.Notice(`Graph exported as PNG (${sizeKB} KB)`);
                }
                else {
                    throw new Error("Failed to create PNG blob");
                }
            }, "image/png", 0.9);
        }
        catch (error) {
            console.error("PNG export failed:", error);
            new obsidian_1.Notice(`PNG export failed: ${error.message}`);
        }
    }
    async renderGraphToCanvas(ctx, data, config, width, height) {
        // Position nodes (reuse existing algorithm)
        this.positionNodes(data.nodes, width, height);
        // Render links first (background layer)
        for (const link of data.links) {
            const sourceNode = data.nodes.find((n) => n.id ===
                (typeof link.source === "string" ? link.source : link.source.id));
            const targetNode = data.nodes.find((n) => n.id ===
                (typeof link.target === "string" ? link.target : link.target.id));
            if (sourceNode && targetNode) {
                // Draw line
                ctx.beginPath();
                ctx.moveTo(sourceNode.x || 0, sourceNode.y || 0);
                ctx.lineTo(targetNode.x || 0, targetNode.y || 0);
                ctx.strokeStyle = this.getThemeColor("--text-muted") || "#6b7280";
                ctx.lineWidth = 1;
                ctx.stroke();
                // Draw arrowhead
                this.drawArrowHead(ctx, sourceNode.x || 0, sourceNode.y || 0, targetNode.x || 0, targetNode.y || 0);
                // Draw edge label if enabled
                if (config.showLabels && link.label) {
                    const midX = ((sourceNode.x || 0) + (targetNode.x || 0)) / 2;
                    const midY = ((sourceNode.y || 0) + (targetNode.y || 0)) / 2;
                    // Draw background rectangle for label
                    const labelText = this.truncateLabel(link.label, 15);
                    ctx.font = "10px var(--font-interface)";
                    const textMetrics = ctx.measureText(labelText);
                    ctx.fillStyle =
                        this.getThemeColor("--background-primary") || "#ffffff";
                    ctx.fillRect(midX - textMetrics.width / 2 - 2, midY - 7, textMetrics.width + 4, 12);
                    // Draw label text
                    ctx.fillStyle = this.getThemeColor("--text-muted") || "#6b7280";
                    ctx.textAlign = "center";
                    ctx.fillText(labelText, midX, midY + 3);
                }
            }
        }
        // Render nodes on top
        for (const node of data.nodes) {
            const x = node.x || 0;
            const y = node.y || 0;
            const radius = config.nodeSize || 8;
            // Draw node circle
            ctx.beginPath();
            ctx.arc(x, y, radius, 0, 2 * Math.PI);
            ctx.fillStyle = this.getNodeCanvasColor(node.type);
            ctx.fill();
            // Draw border
            ctx.strokeStyle =
                this.getThemeColor("--background-modifier-border") || "#e5e5e5";
            ctx.lineWidth = 2;
            ctx.stroke();
            // Draw node label if enabled
            if (config.showLabels) {
                ctx.font = "12px var(--font-interface)";
                ctx.fillStyle = this.getThemeColor("--text-normal") || "#000000";
                ctx.textAlign = "center";
                const labelText = this.truncateLabel(node.label, 20);
                ctx.fillText(labelText, x, y + radius + 15);
            }
        }
    }
    drawArrowHead(ctx, fromX, fromY, toX, toY) {
        const angle = Math.atan2(toY - fromY, toX - fromX);
        const arrowLength = 10;
        const arrowAngle = Math.PI / 6;
        // Calculate arrowhead position (offset from target node)
        const offsetDistance = 10; // Distance from node edge
        const offsetX = toX - offsetDistance * Math.cos(angle);
        const offsetY = toY - offsetDistance * Math.sin(angle);
        ctx.beginPath();
        ctx.moveTo(offsetX, offsetY);
        ctx.lineTo(offsetX - arrowLength * Math.cos(angle - arrowAngle), offsetY - arrowLength * Math.sin(angle - arrowAngle));
        ctx.moveTo(offsetX, offsetY);
        ctx.lineTo(offsetX - arrowLength * Math.cos(angle + arrowAngle), offsetY - arrowLength * Math.sin(angle + arrowAngle));
        ctx.strokeStyle = this.getThemeColor("--text-muted") || "#6b7280";
        ctx.lineWidth = 1;
        ctx.stroke();
    }
    getThemeColor(cssVariable) {
        try {
            const style = getComputedStyle(document.documentElement);
            const color = style.getPropertyValue(cssVariable).trim();
            if (!color)
                return null;
            // Convert CSS color formats to hex if needed
            if (color.startsWith("hsl")) {
                return this.hslToHex(color);
            }
            if (color.startsWith("rgb")) {
                return this.rgbToHex(color);
            }
            return color;
        }
        catch (error) {
            console.warn(`Failed to get theme color for ${cssVariable}:`, error);
            return null;
        }
    }
    getNodeCanvasColor(type) {
        switch (type) {
            case "subject":
                return this.getThemeColor("--color-accent") || "#7c3aed";
            case "object":
                return this.getThemeColor("--color-blue") || "#2563eb";
            case "predicate":
                return this.getThemeColor("--color-green") || "#059669";
            default:
                return "#6b7280";
        }
    }
    hslToHex(hsl) {
        // Simple HSL to hex conversion - for basic theme support
        // This is a simplified version; for production, consider using a library
        return "#6b7280"; // Fallback color
    }
    rgbToHex(rgb) {
        const match = rgb.match(/rgb\((\d+),\s*(\d+),\s*(\d+)\)/);
        if (!match)
            return "#000000";
        const r = parseInt(match[1]);
        const g = parseInt(match[2]);
        const b = parseInt(match[3]);
        return ("#" +
            [r, g, b]
                .map((x) => {
                const hex = x.toString(16);
                return hex.length === 1 ? "0" + hex : hex;
            })
                .join(""));
    }
    downloadBlob(blob, filename) {
        // Check if we're in a test environment (JSDOM)
        if (typeof window !== "undefined" &&
            window.navigator?.userAgent?.includes("jsdom")) {
            // In test environment, just log the action instead of attempting DOM manipulation
            console.log(`Test environment: Would download ${filename} (${blob.size} bytes)`);
            return;
        }
        const url = URL.createObjectURL(blob);
        const link = document.createElement("a");
        link.href = url;
        link.download = filename;
        link.style.display = "none";
        // Ensure document.body exists before appending
        if (document.body) {
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }
        else {
            // Fallback for environments without document.body
            console.warn("Document body not available for download");
        }
        URL.revokeObjectURL(url);
    }
    exportAsSVG(container) {
        const svg = container.querySelector("svg");
        if (!svg)
            return;
        try {
            const serializer = new XMLSerializer();
            const svgString = serializer.serializeToString(svg);
            const blob = new Blob([svgString], { type: "image/svg+xml" });
            this.downloadBlob(blob, "knowledge-graph.svg");
            new obsidian_1.Notice("Graph exported as SVG");
        }
        catch (error) {
            console.error("SVG export failed:", error);
            new obsidian_1.Notice("Failed to export SVG");
        }
    }
    resetView(container) {
        const svg = container.querySelector("svg");
        const g = svg?.querySelector("g");
        if (g) {
            g.setAttribute("transform", "translate(0, 0) scale(1)");
        }
    }
    createLoadingIndicator() {
        const loading = document.createElement("div");
        loading.className = "graph-loading";
        loading.textContent = "Generating graph visualization...";
        loading.style.cssText =
            "padding: 2em; text-align: center; color: var(--text-muted);";
        return loading;
    }
    createErrorMessage(error) {
        const errorDiv = document.createElement("div");
        errorDiv.className = "graph-error";
        errorDiv.style.cssText = `
            background: var(--background-modifier-error);
            color: var(--text-error);
            padding: 1em;
            border-radius: var(--radius-m);
            border: 1px solid var(--background-modifier-border);
        `;
        const title = document.createElement("strong");
        title.textContent = "Graph Visualization Error: ";
        errorDiv.appendChild(title);
        const message = document.createElement("span");
        message.textContent = error.message;
        errorDiv.appendChild(message);
        return errorDiv;
    }
    /**
     * Export graph visualization data as RDF
     */
    async exportGraphAsRDF(data, format) {
        try {
            // Convert graph data back to triples
            const triples = this.convertGraphDataToTriples(data);
            // Create a graph from the triples
            const graph = new Graph_1.Graph();
            for (const triple of triples) {
                graph.add(triple);
            }
            const fileName = `graph-visualization-${Date.now()}`;
            const result = await this.rdfService.exportGraph(graph, {
                format,
                fileName,
                saveToVault: true,
                includeComments: true,
                prettyPrint: true,
                targetFolder: "exports",
            });
            if (result.isSuccess) {
                const exportData = result.getValue();
                new obsidian_1.Notice(`Exported graph visualization as ${format.toUpperCase()} (${exportData.tripleCount} triples)`);
            }
            else {
                new obsidian_1.Notice(`Export failed: ${result.errorValue()}`);
            }
        }
        catch (error) {
            new obsidian_1.Notice(`Export error: ${error.message}`);
            console.error("Graph RDF export error:", error);
        }
    }
    /**
     * Open advanced RDF export modal
     */
    openAdvancedRDFExport(data) {
        try {
            // Convert graph data back to triples
            const triples = this.convertGraphDataToTriples(data);
            // Create a graph from the triples
            const graph = new Graph_1.Graph();
            for (const triple of triples) {
                graph.add(triple);
            }
            const modal = new ExportRDFModal_1.ExportRDFModal(this.plugin.app, graph, this.rdfService.getNamespaceManager(), (result) => {
                new obsidian_1.Notice(`Graph visualization exported: ${result.fileName}`);
            });
            modal.open();
        }
        catch (error) {
            new obsidian_1.Notice(`Failed to open export modal: ${error.message}`);
            console.error("Export modal error:", error);
        }
    }
    /**
     * Convert GraphData back to Triple format
     */
    convertGraphDataToTriples(data) {
        const triples = [];
        // Reconstruct triples from graph data
        for (const link of data.links) {
            const sourceNode = data.nodes.find((n) => n.id ===
                (typeof link.source === "string" ? link.source : link.source.id));
            const targetNode = data.nodes.find((n) => n.id ===
                (typeof link.target === "string" ? link.target : link.target.id));
            if (sourceNode && targetNode) {
                triples.push(new Triple_1.Triple(new Triple_1.IRI(sourceNode.id), new Triple_1.IRI(link.label), new Triple_1.IRI(targetNode.id)));
            }
        }
        return triples;
    }
}
exports.GraphVisualizationProcessor = GraphVisualizationProcessor;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL2tpdGVsZXYvRG9jdW1lbnRzL2V4b2NvcnRleC1vYnNpZGlhbi1wbHVnaW4vc3JjL3ByZXNlbnRhdGlvbi9wcm9jZXNzb3JzL0dyYXBoVmlzdWFsaXphdGlvblByb2Nlc3Nvci50cyIsIm1hcHBpbmdzIjoiOzs7QUFBQSx1Q0FBd0U7QUFDeEUsaUVBQTRFO0FBQzVFLDREQUF5RDtBQUN6RCw4REFBeUU7QUFFekUsNkRBQTBEO0FBRTFELDRFQUF5RTtBQW1DekUsTUFBYSwyQkFBMkI7SUFNdEMsWUFBWSxNQUFjLEVBQUUsS0FBWTtRQUN0QyxJQUFJLENBQUMsTUFBTSxHQUFHLE1BQU0sQ0FBQztRQUNyQixJQUFJLENBQUMsS0FBSyxHQUFHLEtBQUssQ0FBQztRQUNuQixJQUFJLENBQUMsTUFBTSxHQUFHLElBQUksMkJBQVksQ0FBQyxLQUFLLENBQUMsQ0FBQztRQUN0QyxtQ0FBbUM7UUFDbkMsTUFBTSxTQUFTLEdBQUcseUJBQVcsQ0FBQyxXQUFXLEVBQUUsQ0FBQztRQUM1QyxJQUFJLENBQUMsVUFBVSxHQUFHLFNBQVMsQ0FBQyxPQUFPLENBQWEsWUFBWSxDQUFDLENBQUM7SUFDaEUsQ0FBQztJQUVEOztPQUVHO0lBQ0gsS0FBSyxDQUFDLGdCQUFnQixDQUNwQixNQUFjLEVBQ2QsRUFBZSxFQUNmLEdBQWlDO1FBRWpDLEVBQUUsQ0FBQyxLQUFLLEVBQUUsQ0FBQztRQUVYLHdCQUF3QjtRQUN4QixNQUFNLFNBQVMsR0FBRyxRQUFRLENBQUMsYUFBYSxDQUFDLEtBQUssQ0FBQyxDQUFDO1FBQ2hELFNBQVMsQ0FBQyxTQUFTLEdBQUcsMkJBQTJCLENBQUM7UUFDbEQsU0FBUyxDQUFDLEtBQUssQ0FBQyxPQUFPLEdBQUc7Ozs7Ozs7U0FPckIsQ0FBQztRQUNOLEVBQUUsQ0FBQyxXQUFXLENBQUMsU0FBUyxDQUFDLENBQUM7UUFFMUIsSUFBSTtZQUNGLHNCQUFzQjtZQUN0QixNQUFNLE1BQU0sR0FBRyxJQUFJLENBQUMsV0FBVyxDQUFDLE1BQU0sQ0FBQyxJQUFJLEVBQUUsQ0FB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QixJQUFJLFlBQUcsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLEVBQ25CLElBQUksWUFBRyxDQUFDLFVBQVUsQ0FBQyxFQUFFLENBQUMsQ0FDdkIsQ0FDRixDQUFDO2FBQ0g7U0FDRjtRQUVELE9BQU8sT0FBTyxDQUFDO0lBQ2pCLENBQUM7Q0FDRjtBQXp1Q0Qsa0VBeXVDQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyIvVXNlcnMva2l0ZWxldi9Eb2N1bWVudHMvZXhvY29ydGV4LW9ic2lkaWFuLXBsdWdpbi9zcmMvcHJlc2VudGF0aW9uL3Byb2Nlc3NvcnMvR3JhcGhWaXN1YWxpemF0aW9uUHJvY2Vzc29yLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IE1hcmtkb3duUG9zdFByb2Nlc3NvckNvbnRleHQsIFBsdWdpbiwgTm90aWNlIH0gZnJvbSBcIm9ic2lkaWFuXCI7XG5pbXBvcnQgeyBTUEFSUUxFbmdpbmUsIFNlbGVjdFJlc3VsdCB9IGZyb20gXCIuLi8uLi9hcHBsaWNhdGlvbi9TUEFSUUxFbmdpbmVcIjtcbmltcG9ydCB7IEdyYXBoIH0gZnJvbSBcIi4uLy4uL2RvbWFpbi9zZW1hbnRpYy9jb3JlL0dyYXBoXCI7XG5pbXBvcnQgeyBUcmlwbGUsIElSSSwgTGl0ZXJhbCB9IGZyb20gXCIuLi8uLi9kb21haW4vc2VtYW50aWMvY29yZS9UcmlwbGVcIjtcbmltcG9ydCB7IFJERlNlcnZpY2UgfSBmcm9tIFwiLi4vLi4vYXBwbGljYXRpb24vc2VydmljZXMvUkRGU2VydmljZVwiO1xuaW1wb3J0IHsgRXhwb3J0UkRGTW9kYWwgfSBmcm9tIFwiLi4vbW9kYWxzL0V4cG9ydFJERk1vZGFsXCI7XG5pbXBvcnQgeyBSREZGb3JtYXQgfSBmcm9tIFwiLi4vLi4vYXBwbGljYXRpb24vc2VydmljZXMvUkRGU2VyaWFsaXplclwiO1xuaW1wb3J0IHsgRElDb250YWluZXIgfSBmcm9tIFwiLi4vLi4vaW5mcmFzdHJ1Y3R1cmUvY29udGFpbmVyL0RJQ29udGFpbmVyXCI7XG5cbmludGVyZmFjZSBHcmFwaE5vZGUge1xuICBpZDogc3RyaW5nO1xuICBsYWJlbDogc3RyaW5nO1xuICB0eXBlOiBcInN1YmplY3RcIiB8IFwib2JqZWN0XCIgfCBcInByZWRpY2F0ZVwiO1xuICBncm91cDogbnVtYmVyO1xuICB4PzogbnVtYmVyO1xuICB5PzogbnVtYmVyO1xuICBmeD86IG51bWJlciB8IG51bGw7XG4gIGZ5PzogbnVtYmVyIHwgbnVsbDtcbn1cblxuaW50ZXJmYWNlIEdyYXBoTGluayB7XG4gIHNvdXJjZTogc3RyaW5nIHwgR3JhcGhOb2RlO1xuICB0YXJnZXQ6IHN0cmluZyB8IEdyYXBoTm9kZTtcbiAgbGFiZWw6IHN0cmluZztcbiAgaWQ6IHN0cmluZztcbn1cblxuaW50ZXJmYWNlIEdyYXBoRGF0YSB7XG4gIG5vZGVzOiBHcmFwaE5vZGVbXTtcbiAgbGlua3M6IEdyYXBoTGlua1tdO1xufVxuXG5pbnRlcmZhY2UgR3JhcGhDb25maWcge1xuICBmb2N1cz86IHN0cmluZztcbiAgZGVwdGg/OiBudW1iZXI7XG4gIGxpbWl0PzogbnVtYmVyO1xuICBxdWVyeT86IHN0cmluZztcbiAgc2hvd0xhYmVscz86IGJvb2xlYW47XG4gIG5vZGVTaXplPzogbnVtYmVyO1xuICBsaW5rRGlzdGFuY2U/OiBudW1iZXI7XG59XG5cbmV4cG9ydCBjbGFzcyBHcmFwaFZpc3VhbGl6YXRpb25Qcm9jZXNzb3Ige1xuICBwcml2YXRlIHBsdWdpbjogUGx1Z2luO1xuICBwcml2YXRlIGVuZ2luZTogU1BBUlFMRW5naW5lO1xuICBwcml2YXRlIGdyYXBoOiBHcmFwaDtcbiAgcHJpdmF0ZSByZGZTZXJ2aWNlOiBSREZTZXJ2aWNlO1xuXG4gIGNvbnN0cnVjdG9yKHBsdWdpbjogUGx1Z2luLCBncmFwaDogR3JhcGgpIHtcbiAgICB0aGlzLnBsdWdpbiA9IHBsdWdpbjtcbiAgICB0aGlzLmdyYXBoID0gZ3JhcGg7XG4gICAgdGhpcy5lbmdpbmUgPSBuZXcgU1BBUlFMRW5naW5lKGdyYXBoKTtcbiAgICAvLyBHZXQgUkRGU2VydmljZSBmcm9tIERJIGNvbnRhaW5lclxuICAgIGNvbnN0IGNvbnRhaW5lciA9IERJQ29udGFpbmVyLmdldEluc3RhbmNlKCk7XG4gICAgdGhpcy5yZGZTZXJ2aWNlID0gY29udGFpbmVyLnJlc29sdmU8UkRGU2VydmljZT4oXCJSREZTZXJ2aWNlXCIpO1xuICB9XG5cbiAgLyoqXG4gICAqIE1haW4gcHJvY2Vzc29yIG1ldGhvZCBjYWxsZWQgYnkgT2JzaWRpYW5cbiAgICovXG4gIGFzeW5jIHByb2Nlc3NDb2RlQmxvY2soXG4gICAgc291cmNlOiBzdHJpbmcsXG4gICAgZWw6IEhUTUxFbGVtZW50LFxuICAgIGN0eDogTWFya2Rvd25Qb3N0UHJvY2Vzc29yQ29udGV4dCxcbiAgKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgZWwuZW1wdHkoKTtcblxuICAgIC8vIENyZWF0ZSBtYWluIGNvbnRhaW5lclxuICAgIGNvbnN0IGNvbnRhaW5lciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG4gICAgY29udGFpbmVyLmNsYXNzTmFtZSA9IFwiZXhvY29ydGV4LWdyYXBoLWNvbnRhaW5lclwiO1xuICAgIGNvbnRhaW5lci5zdHlsZS5jc3NUZXh0ID0gYFxuICAgICAgICAgICAgYm9yZGVyOiAxcHggc29saWQgdmFyKC0tYmFja2dyb3VuZC1tb2RpZmllci1ib3JkZXIpO1xuICAgICAgICAgICAgcGFkZGluZzogMWVtO1xuICAgICAgICAgICAgbWFyZ2luOiAxZW0gMDtcbiAgICAgICAgICAgIGJvcmRlci1yYWRpdXM6IHZhcigtLXJhZGl1cy1tKTtcbiAgICAgICAgICAgIGJhY2tncm91bmQ6IHZhcigtLWJhY2tncm91bmQtc2Vjb25kYXJ5KTtcbiAgICAgICAgICAgIHBvc2l0aW9uOiByZWxhdGl2ZTtcbiAgICAgICAgYDtcbiAgICBlbC5hcHBlbmRDaGlsZChjb250YWluZXIpO1xuXG4gICAgdHJ5IHtcbiAgICAgIC8vIFBhcnNlIGNvbmZpZ3VyYXRpb25cbiAgICAgIGNvbnN0IGNvbmZpZyA9IHRoaXMucGFyc2VDb25maWcoc291cmNlLnRyaW0oKSk7XG5cbiAgICAgIC8vIFNob3cgbG9hZGluZyBpbmRpY2F0b3JcbiAgICAgIGNvbnN0IGxvYWRpbmdFbCA9IHRoaXMuY3JlYXRlTG9hZGluZ0luZGljYXRvcigpO1xuICAgICAgY29udGFpbmVyLmFwcGVuZENoaWxkKGxvYWRpbmdFbCk7XG5cbiAgICAgIC8vIEdldCBncmFwaCBkYXRhXG4gICAgICBjb25zdCBncmFwaERhdGEgPSBhd2FpdCB0aGlzLmdldEdyYXBoRGF0YShjb25maWcpO1xuXG4gICAgICAvLyBSZW1vdmUgbG9hZGluZyBpbmRpY2F0b3JcbiAgICAgIGxvYWRpbmdFbC5yZW1vdmUoKTtcblxuICAgICAgaWYgKGdyYXBoRGF0YS5ub2Rlcy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgY29uc3QgZW1wdHlNZXNzYWdlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcbiAgICAgICAgZW1wdHlNZXNzYWdlLnRleHRDb250ZW50ID0gXCJObyBncmFwaCBkYXRhIGZvdW5kXCI7XG4gICAgICAgIGVtcHR5TWVzc2FnZS5zdHlsZS5jc3NUZXh0ID1cbiAgICAgICAgICBcInBhZGRpbmc6IDJlbTsgdGV4dC1hbGlnbjogY2VudGVyOyBjb2xvcjogdmFyKC0tdGV4dC1tdXRlZCk7XCI7XG4gICAgICAgIGNvbnRhaW5lci5hcHBlbmRDaGlsZChlbXB0eU1lc3NhZ2UpO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIC8vIENyZWF0ZSBncmFwaCB2aXN1YWxpemF0aW9uXG4gICAgICBhd2FpdCB0aGlzLmNyZWF0ZUdyYXBoVmlzdWFsaXphdGlvbihjb250YWluZXIsIGdyYXBoRGF0YSwgY29uZmlnKTtcblxuICAgICAgLy8gQWRkIGNvbnRyb2xzXG4gICAgICB0aGlzLmFkZENvbnRyb2xzKGNvbnRhaW5lciwgZ3JhcGhEYXRhLCBjb25maWcpO1xuICAgIH0gY2F0Y2ggKGVycm9yOiBhbnkpIHtcbiAgICAgIGNvbnRhaW5lci5pbm5lckhUTUwgPSBcIlwiO1xuICAgICAgY29uc3QgZXJyb3JFbCA9IHRoaXMuY3JlYXRlRXJyb3JNZXNzYWdlKGVycm9yKTtcbiAgICAgIGNvbnRhaW5lci5hcHBlbmRDaGlsZChlcnJvckVsKTtcbiAgICAgIGNvbnNvbGUuZXJyb3IoXCJHcmFwaCB2aXN1YWxpemF0aW9uIGVycm9yOlwiLCBlcnJvcik7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBwYXJzZUNvbmZpZyhzb3VyY2U6IHN0cmluZyk6IEdyYXBoQ29uZmlnIHtcbiAgICBjb25zdCBjb25maWc6IEdyYXBoQ29uZmlnID0ge1xuICAgICAgbGltaXQ6IDEwMCxcbiAgICAgIHNob3dMYWJlbHM6IHRydWUsXG4gICAgICBub2RlU2l6ZTogOCxcbiAgICAgIGxpbmtEaXN0YW5jZTogODAsXG4gICAgICBkZXB0aDogMixcbiAgICB9O1xuXG4gICAgY29uc3QgbGluZXMgPSBzb3VyY2VcbiAgICAgIC5zcGxpdChcIlxcblwiKVxuICAgICAgLm1hcCgobCkgPT4gbC50cmltKCkpXG4gICAgICAuZmlsdGVyKChsKSA9PiBsKTtcblxuICAgIC8vIENoZWNrIGlmIGl0J3MgYSBTUEFSUUwgcXVlcnlcbiAgICBpZiAoc291cmNlLnRvVXBwZXJDYXNlKCkuaW5jbHVkZXMoXCJTRUxFQ1RcIikpIHtcbiAgICAgIGNvbmZpZy5xdWVyeSA9IHNvdXJjZTtcbiAgICAgIHJldHVybiBjb25maWc7XG4gICAgfVxuXG4gICAgLy8gUGFyc2UgY29uZmlndXJhdGlvbiBvcHRpb25zXG4gICAgZm9yIChjb25zdCBsaW5lIG9mIGxpbmVzKSB7XG4gICAgICBpZiAobGluZS5pbmNsdWRlcyhcIjpcIikpIHtcbiAgICAgICAgY29uc3QgW2tleSwgdmFsdWVdID0gbGluZS5zcGxpdChcIjpcIikubWFwKChzKSA9PiBzLnRyaW0oKSk7XG4gICAgICAgIHN3aXRjaCAoa2V5LnRvTG93ZXJDYXNlKCkpIHtcbiAgICAgICAgICBjYXNlIFwiZm9jdXNcIjpcbiAgICAgICAgICAgIGNvbmZpZy5mb2N1cyA9IHZhbHVlLnJlcGxhY2UoL1xcW1xcW3xcXF1cXF0vZywgXCJcIik7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgICBjYXNlIFwiZGVwdGhcIjpcbiAgICAgICAgICAgIGNvbmZpZy5kZXB0aCA9IHBhcnNlSW50KHZhbHVlKSB8fCAyO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgY2FzZSBcImxpbWl0XCI6XG4gICAgICAgICAgICBjb25maWcubGltaXQgPSBwYXJzZUludCh2YWx1ZSkgfHwgMTAwO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgY2FzZSBcInF1ZXJ5XCI6XG4gICAgICAgICAgICBjb25maWcucXVlcnkgPSB2YWx1ZTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgIGNhc2UgXCJzaG93bGFiZWxzXCI6XG4gICAgICAgICAgICBjb25maWcuc2hvd0xhYmVscyA9IHZhbHVlLnRvTG93ZXJDYXNlKCkgPT09IFwidHJ1ZVwiO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgY2FzZSBcIm5vZGVzaXplXCI6XG4gICAgICAgICAgICBjb25maWcubm9kZVNpemUgPSBwYXJzZUludCh2YWx1ZSkgfHwgODtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgIGNhc2UgXCJsaW5rZGlzdGFuY2VcIjpcbiAgICAgICAgICAgIGNvbmZpZy5saW5rRGlzdGFuY2UgPSBwYXJzZUludCh2YWx1ZSkgfHwgODA7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiBjb25maWc7XG4gIH1cblxuICBwcml2YXRlIGFzeW5jIGdldEdyYXBoRGF0YShjb25maWc6IEdyYXBoQ29uZmlnKTogUHJvbWlzZTxHcmFwaERhdGE+IHtcbiAgICBsZXQgdHJpcGxlczogVHJpcGxlW10gPSBbXTtcblxuICAgIGlmIChjb25maWcucXVlcnkpIHtcbiAgICAgIC8vIEV4ZWN1dGUgU1BBUlFMIHF1ZXJ5IHRvIGdldCBzcGVjaWZpYyB0cmlwbGVzXG4gICAgICBjb25zdCByZXN1bHQ6IFNlbGVjdFJlc3VsdCA9IHRoaXMuZW5naW5lLnNlbGVjdChjb25maWcucXVlcnkpO1xuXG4gICAgICAvLyBDb252ZXJ0IFNQQVJRTCByZXN1bHRzIHRvIHRyaXBsZXNcbiAgICAgIGZvciAoY29uc3Qgcm93IG9mIHJlc3VsdC5yZXN1bHRzKSB7XG4gICAgICAgIGlmIChyb3cucyAmJiByb3cucCAmJiByb3cubykge1xuICAgICAgICAgIHRyaXBsZXMucHVzaChcbiAgICAgICAgICAgIG5ldyBUcmlwbGUoXG4gICAgICAgICAgICAgIG5ldyBJUkkocm93LnMpLFxuICAgICAgICAgICAgICBuZXcgSVJJKHJvdy5wKSxcbiAgICAgICAgICAgICAgcm93Lm8uc3RhcnRzV2l0aCgnXCInKVxuICAgICAgICAgICAgICAgID8gTGl0ZXJhbC5zdHJpbmcocm93Lm8ucmVwbGFjZSgvXlwifFwiJC9nLCBcIlwiKSlcbiAgICAgICAgICAgICAgICA6IG5ldyBJUkkocm93Lm8pLFxuICAgICAgICAgICAgKSxcbiAgICAgICAgICApO1xuICAgICAgICB9IGVsc2UgaWYgKHJvdy5zdWJqZWN0ICYmIHJvdy5wcmVkaWNhdGUgJiYgcm93Lm9iamVjdCkge1xuICAgICAgICAgIHRyaXBsZXMucHVzaChcbiAgICAgICAgICAgIG5ldyBUcmlwbGUoXG4gICAgICAgICAgICAgIG5ldyBJUkkocm93LnN1YmplY3QpLFxuICAgICAgICAgICAgICBuZXcgSVJJKHJvdy5wcmVkaWNhdGUpLFxuICAgICAgICAgICAgICByb3cub2JqZWN0LnN0YXJ0c1dpdGgoJ1wiJylcbiAgICAgICAgICAgICAgICA/IExpdGVyYWwuc3RyaW5nKHJvdy5vYmplY3QucmVwbGFjZSgvXlwifFwiJC9nLCBcIlwiKSlcbiAgICAgICAgICAgICAgICA6IG5ldyBJUkkocm93Lm9iamVjdCksXG4gICAgICAgICAgICApLFxuICAgICAgICAgICk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9IGVsc2UgaWYgKGNvbmZpZy5mb2N1cykge1xuICAgICAgLy8gR2V0IHRyaXBsZXMgY2VudGVyZWQgYXJvdW5kIGZvY3VzIGVudGl0eVxuICAgICAgdHJpcGxlcyA9IHRoaXMuZ2V0VHJpcGxlc0Fyb3VuZEZvY3VzKGNvbmZpZy5mb2N1cywgY29uZmlnLmRlcHRoIHx8IDIpO1xuICAgIH0gZWxzZSB7XG4gICAgICAvLyBHZXQgYWxsIHRyaXBsZXMgKHdpdGggbGltaXQpXG4gICAgICB0cmlwbGVzID0gdGhpcy5ncmFwaC5tYXRjaChudWxsLCBudWxsLCBudWxsKTtcbiAgICB9XG5cbiAgICAvLyBBcHBseSBsaW1pdFxuICAgIGlmIChjb25maWcubGltaXQgJiYgdHJpcGxlcy5sZW5ndGggPiBjb25maWcubGltaXQpIHtcbiAgICAgIHRyaXBsZXMgPSB0cmlwbGVzLnNsaWNlKDAsIGNvbmZpZy5saW1pdCk7XG4gICAgfVxuXG4gICAgcmV0dXJuIHRoaXMuY29udmVydFRyaXBsZXNUb0dyYXBoRGF0YSh0cmlwbGVzKTtcbiAgfVxuXG4gIHByaXZhdGUgZ2V0VHJpcGxlc0Fyb3VuZEZvY3VzKGZvY3VzOiBzdHJpbmcsIGRlcHRoOiBudW1iZXIpOiBUcmlwbGVbXSB7XG4gICAgY29uc3QgdmlzaXRlZCA9IG5ldyBTZXQ8c3RyaW5nPigpO1xuICAgIGNvbnN0IHJlc3VsdDogVHJpcGxlW10gPSBbXTtcbiAgICBjb25zdCBxdWV1ZTogeyBlbnRpdHk6IHN0cmluZzsgY3VycmVudERlcHRoOiBudW1iZXIgfVtdID0gW1xuICAgICAgeyBlbnRpdHk6IGZvY3VzLCBjdXJyZW50RGVwdGg6IDAgfSxcbiAgICBdO1xuXG4gICAgd2hpbGUgKHF1ZXVlLmxlbmd0aCA+IDApIHtcbiAgICAgIGNvbnN0IHsgZW50aXR5LCBjdXJyZW50RGVwdGggfSA9IHF1ZXVlLnNoaWZ0KCkhO1xuXG4gICAgICBpZiAodmlzaXRlZC5oYXMoZW50aXR5KSB8fCBjdXJyZW50RGVwdGggPj0gZGVwdGgpIHtcbiAgICAgICAgY29udGludWU7XG4gICAgICB9XG5cbiAgICAgIHZpc2l0ZWQuYWRkKGVudGl0eSk7XG5cbiAgICAgIC8vIEdldCB0cmlwbGVzIHdoZXJlIGVudGl0eSBpcyBzdWJqZWN0XG4gICAgICBjb25zdCBzdWJqZWN0VHJpcGxlcyA9IHRoaXMuZ3JhcGgubWF0Y2gobmV3IElSSShlbnRpdHkpLCBudWxsLCBudWxsKTtcbiAgICAgIHJlc3VsdC5wdXNoKC4uLnN1YmplY3RUcmlwbGVzKTtcblxuICAgICAgLy8gR2V0IHRyaXBsZXMgd2hlcmUgZW50aXR5IGlzIG9iamVjdFxuICAgICAgY29uc3Qgb2JqZWN0VHJpcGxlcyA9IHRoaXMuZ3JhcGgubWF0Y2gobnVsbCwgbnVsbCwgbmV3IElSSShlbnRpdHkpKTtcbiAgICAgIHJlc3VsdC5wdXNoKC4uLm9iamVjdFRyaXBsZXMpO1xuXG4gICAgICAvLyBBZGQgcmVsYXRlZCBlbnRpdGllcyB0byBxdWV1ZSBmb3IgbmV4dCBkZXB0aCBsZXZlbFxuICAgICAgaWYgKGN1cnJlbnREZXB0aCA8IGRlcHRoIC0gMSkge1xuICAgICAgICBmb3IgKGNvbnN0IHRyaXBsZSBvZiBzdWJqZWN0VHJpcGxlcykge1xuICAgICAgICAgIGNvbnN0IG9iamVjdFN0ciA9IHRyaXBsZS5nZXRPYmplY3QoKS50b1N0cmluZygpO1xuICAgICAgICAgIGlmICghdmlzaXRlZC5oYXMob2JqZWN0U3RyKSkge1xuICAgICAgICAgICAgcXVldWUucHVzaCh7IGVudGl0eTogb2JqZWN0U3RyLCBjdXJyZW50RGVwdGg6IGN1cnJlbnREZXB0aCArIDEgfSk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGZvciAoY29uc3QgdHJpcGxlIG9mIG9iamVjdFRyaXBsZXMpIHtcbiAgICAgICAgICBjb25zdCBzdWJqZWN0U3RyID0gdHJpcGxlLmdldFN1YmplY3QoKS50b1N0cmluZygpO1xuICAgICAgICAgIGlmICghdmlzaXRlZC5oYXMoc3ViamVjdFN0cikpIHtcbiAgICAgICAgICAgIHF1ZXVlLnB1c2goeyBlbnRpdHk6IHN1YmplY3RTdHIsIGN1cnJlbnREZXB0aDogY3VycmVudERlcHRoICsgMSB9KTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gcmVzdWx0O1xuICB9XG5cbiAgcHJpdmF0ZSBjb252ZXJ0VHJpcGxlc1RvR3JhcGhEYXRhKHRyaXBsZXM6IFRyaXBsZVtdKTogR3JhcGhEYXRhIHtcbiAgICBjb25zdCBub2Rlc01hcCA9IG5ldyBNYXA8c3RyaW5nLCBHcmFwaE5vZGU+KCk7XG4gICAgY29uc3QgbGlua3M6IEdyYXBoTGlua1tdID0gW107XG5cbiAgICBmb3IgKGNvbnN0IHRyaXBsZSBvZiB0cmlwbGVzKSB7XG4gICAgICBjb25zdCBzdWJqZWN0U3RyID0gdHJpcGxlLmdldFN1YmplY3QoKS50b1N0cmluZygpO1xuICAgICAgY29uc3QgcHJlZGljYXRlU3RyID0gdHJpcGxlLmdldFByZWRpY2F0ZSgpLnRvU3RyaW5nKCk7XG4gICAgICBjb25zdCBvYmplY3RTdHIgPSB0cmlwbGUuZ2V0T2JqZWN0KCkudG9TdHJpbmcoKTtcblxuICAgICAgLy8gQWRkIHN1YmplY3Qgbm9kZVxuICAgICAgaWYgKCFub2Rlc01hcC5oYXMoc3ViamVjdFN0cikpIHtcbiAgICAgICAgbm9kZXNNYXAuc2V0KHN1YmplY3RTdHIsIHtcbiAgICAgICAgICBpZDogc3ViamVjdFN0cixcbiAgICAgICAgICBsYWJlbDogdGhpcy5nZXREaXNwbGF5TGFiZWwoc3ViamVjdFN0ciksXG4gICAgICAgICAgdHlwZTogXCJzdWJqZWN0XCIsXG4gICAgICAgICAgZ3JvdXA6IDEsXG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICAvLyBBZGQgb2JqZWN0IG5vZGVcbiAgICAgIGlmICghbm9kZXNNYXAuaGFzKG9iamVjdFN0cikpIHtcbiAgICAgICAgbm9kZXNNYXAuc2V0KG9iamVjdFN0ciwge1xuICAgICAgICAgIGlkOiBvYmplY3RTdHIsXG4gICAgICAgICAgbGFiZWw6IHRoaXMuZ2V0RGlzcGxheUxhYmVsKG9iamVjdFN0ciksXG4gICAgICAgICAgdHlwZTogXCJvYmplY3RcIixcbiAgICAgICAgICBncm91cDogMixcbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIC8vIEFkZCBsaW5rXG4gICAgICBjb25zdCBsaW5rSWQgPSBgJHtzdWJqZWN0U3RyfS0ke3ByZWRpY2F0ZVN0cn0tJHtvYmplY3RTdHJ9YDtcbiAgICAgIGxpbmtzLnB1c2goe1xuICAgICAgICBzb3VyY2U6IHN1YmplY3RTdHIsXG4gICAgICAgIHRhcmdldDogb2JqZWN0U3RyLFxuICAgICAgICBsYWJlbDogcHJlZGljYXRlU3RyLFxuICAgICAgICBpZDogbGlua0lkLFxuICAgICAgfSk7XG4gICAgfVxuXG4gICAgcmV0dXJuIHtcbiAgICAgIG5vZGVzOiBBcnJheS5mcm9tKG5vZGVzTWFwLnZhbHVlcygpKSxcbiAgICAgIGxpbmtzLFxuICAgIH07XG4gIH1cblxuICBwcml2YXRlIGdldERpc3BsYXlMYWJlbCh1cmk6IHN0cmluZyk6IHN0cmluZyB7XG4gICAgLy8gRXh0cmFjdCBodW1hbi1yZWFkYWJsZSBsYWJlbCBmcm9tIFVSSVxuICAgIGlmICh1cmkuc3RhcnRzV2l0aChcImZpbGU6Ly9cIikpIHtcbiAgICAgIHJldHVybiB1cmkucmVwbGFjZShcImZpbGU6Ly9cIiwgXCJcIik7XG4gICAgfVxuXG4gICAgLy8gRXh0cmFjdCBsYXN0IHBhcnQgb2YgVVJJXG4gICAgY29uc3QgcGFydHMgPSB1cmkuc3BsaXQoXCIvXCIpO1xuICAgIHJldHVybiBwYXJ0c1twYXJ0cy5sZW5ndGggLSAxXSB8fCB1cmk7XG4gIH1cblxuICBwcml2YXRlIGFzeW5jIGNyZWF0ZUdyYXBoVmlzdWFsaXphdGlvbihcbiAgICBjb250YWluZXI6IEhUTUxFbGVtZW50LFxuICAgIGRhdGE6IEdyYXBoRGF0YSxcbiAgICBjb25maWc6IEdyYXBoQ29uZmlnLFxuICApOiBQcm9taXNlPHZvaWQ+IHtcbiAgICAvLyBDcmVhdGUgU1ZHIGNvbnRhaW5lclxuICAgIGNvbnN0IHN2Z0NvbnRhaW5lciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG4gICAgc3ZnQ29udGFpbmVyLnN0eWxlLmNzc1RleHQgPVxuICAgICAgXCJwb3NpdGlvbjogcmVsYXRpdmU7IHdpZHRoOiAxMDAlOyBoZWlnaHQ6IDYwMHB4OyBvdmVyZmxvdzogaGlkZGVuO1wiO1xuICAgIGNvbnRhaW5lci5hcHBlbmRDaGlsZChzdmdDb250YWluZXIpO1xuXG4gICAgY29uc3Qgc3ZnID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudE5TKFwiaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmdcIiwgXCJzdmdcIik7XG4gICAgc3ZnLnNldEF0dHJpYnV0ZShcIndpZHRoXCIsIFwiMTAwJVwiKTtcbiAgICBzdmcuc2V0QXR0cmlidXRlKFwiaGVpZ2h0XCIsIFwiNjAwXCIpO1xuICAgIHN2Zy5zdHlsZS5jc3NUZXh0ID1cbiAgICAgIFwiYm9yZGVyOiAxcHggc29saWQgdmFyKC0tYmFja2dyb3VuZC1tb2RpZmllci1ib3JkZXIpOyBiYWNrZ3JvdW5kOiB2YXIoLS1iYWNrZ3JvdW5kLXByaW1hcnkpO1wiO1xuICAgIHN2Z0NvbnRhaW5lci5hcHBlbmRDaGlsZChzdmcpO1xuXG4gICAgLy8gQ3JlYXRlIEQzLmpzLWxpa2UgZm9yY2Ugc2ltdWxhdGlvbiBtYW51YWxseSAoc2ltcGxpZmllZCB2ZXJzaW9uKVxuICAgIGF3YWl0IHRoaXMuY3JlYXRlRm9yY2VEaXJlY3RlZEdyYXBoKHN2ZywgZGF0YSwgY29uZmlnKTtcblxuICAgIC8vIFN0b3JlIGRhdGEgZm9yIGV4cG9ydCBmdW5jdGlvbmFsaXR5XG4gICAgKGNvbnRhaW5lciBhcyBhbnkpLl9fZ3JhcGhEYXRhID0gZGF0YTtcbiAgICAoY29udGFpbmVyIGFzIGFueSkuX19ncmFwaENvbmZpZyA9IGNvbmZpZztcbiAgfVxuXG4gIHByaXZhdGUgYXN5bmMgY3JlYXRlRm9yY2VEaXJlY3RlZEdyYXBoKFxuICAgIHN2ZzogU1ZHU1ZHRWxlbWVudCxcbiAgICBkYXRhOiBHcmFwaERhdGEsXG4gICAgY29uZmlnOiBHcmFwaENvbmZpZyxcbiAgKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgY29uc3Qgd2lkdGggPSA4MDA7XG4gICAgY29uc3QgaGVpZ2h0ID0gNjAwO1xuICAgIGNvbnN0IGNlbnRlclggPSB3aWR0aCAvIDI7XG4gICAgY29uc3QgY2VudGVyWSA9IGhlaWdodCAvIDI7XG5cbiAgICAvLyBDcmVhdGUgZ3JvdXBzIGZvciBkaWZmZXJlbnQgZWxlbWVudHNcbiAgICBjb25zdCBkZWZzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudE5TKFwiaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmdcIiwgXCJkZWZzXCIpO1xuICAgIHN2Zy5hcHBlbmRDaGlsZChkZWZzKTtcblxuICAgIC8vIEFkZCBhcnJvdyBtYXJrZXIgZm9yIGRpcmVjdGVkIGVkZ2VzXG4gICAgY29uc3QgbWFya2VyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudE5TKFxuICAgICAgXCJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2Z1wiLFxuICAgICAgXCJtYXJrZXJcIixcbiAgICApO1xuICAgIG1hcmtlci5zZXRBdHRyaWJ1dGUoXCJpZFwiLCBcImFycm93aGVhZFwiKTtcbiAgICBtYXJrZXIuc2V0QXR0cmlidXRlKFwidmlld0JveFwiLCBcIjAgLTUgMTAgMTBcIik7XG4gICAgbWFya2VyLnNldEF0dHJpYnV0ZShcInJlZlhcIiwgXCI4XCIpO1xuICAgIG1hcmtlci5zZXRBdHRyaWJ1dGUoXCJyZWZZXCIsIFwiMFwiKTtcbiAgICBtYXJrZXIuc2V0QXR0cmlidXRlKFwib3JpZW50XCIsIFwiYXV0b1wiKTtcbiAgICBtYXJrZXIuc2V0QXR0cmlidXRlKFwibWFya2VyV2lkdGhcIiwgXCI2XCIpO1xuICAgIG1hcmtlci5zZXRBdHRyaWJ1dGUoXCJtYXJrZXJIZWlnaHRcIiwgXCI2XCIpO1xuXG4gICAgY29uc3QgcGF0aCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnROUyhcImh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnXCIsIFwicGF0aFwiKTtcbiAgICBwYXRoLnNldEF0dHJpYnV0ZShcImRcIiwgXCJNIDAsLTUgTCAxMCAsMCBMIDAsNVwiKTtcbiAgICBwYXRoLnNldEF0dHJpYnV0ZShcImZpbGxcIiwgXCJ2YXIoLS10ZXh0LW11dGVkKVwiKTtcbiAgICBtYXJrZXIuYXBwZW5kQ2hpbGQocGF0aCk7XG4gICAgZGVmcy5hcHBlbmRDaGlsZChtYXJrZXIpO1xuXG4gICAgY29uc3QgZyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnROUyhcImh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnXCIsIFwiZ1wiKTtcbiAgICBzdmcuYXBwZW5kQ2hpbGQoZyk7XG5cbiAgICAvLyBQb3NpdGlvbiBub2RlcyB1c2luZyBzaW1wbGUgZm9yY2UtZGlyZWN0ZWQgbGF5b3V0XG4gICAgdGhpcy5wb3NpdGlvbk5vZGVzKGRhdGEubm9kZXMsIHdpZHRoLCBoZWlnaHQpO1xuXG4gICAgLy8gQ3JlYXRlIGxpbmtzXG4gICAgY29uc3QgbGlua3NHcm91cCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnROUyhcbiAgICAgIFwiaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmdcIixcbiAgICAgIFwiZ1wiLFxuICAgICk7XG4gICAgbGlua3NHcm91cC5zZXRBdHRyaWJ1dGUoXCJjbGFzc1wiLCBcImxpbmtzXCIpO1xuICAgIGcuYXBwZW5kQ2hpbGQobGlua3NHcm91cCk7XG5cbiAgICBmb3IgKGNvbnN0IGxpbmsgb2YgZGF0YS5saW5rcykge1xuICAgICAgY29uc3Qgc291cmNlTm9kZSA9IGRhdGEubm9kZXMuZmluZCgobikgPT4gbi5pZCA9PT0gbGluay5zb3VyY2UpO1xuICAgICAgY29uc3QgdGFyZ2V0Tm9kZSA9IGRhdGEubm9kZXMuZmluZCgobikgPT4gbi5pZCA9PT0gbGluay50YXJnZXQpO1xuXG4gICAgICBpZiAoc291cmNlTm9kZSAmJiB0YXJnZXROb2RlKSB7XG4gICAgICAgIGNvbnN0IGxpbmUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50TlMoXG4gICAgICAgICAgXCJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2Z1wiLFxuICAgICAgICAgIFwibGluZVwiLFxuICAgICAgICApO1xuICAgICAgICBsaW5lLnNldEF0dHJpYnV0ZShcIngxXCIsIHNvdXJjZU5vZGUueD8udG9TdHJpbmcoKSB8fCBcIjBcIik7XG4gICAgICAgIGxpbmUuc2V0QXR0cmlidXRlKFwieTFcIiwgc291cmNlTm9kZS55Py50b1N0cmluZygpIHx8IFwiMFwiKTtcbiAgICAgICAgbGluZS5zZXRBdHRyaWJ1dGUoXCJ4MlwiLCB0YXJnZXROb2RlLng/LnRvU3RyaW5nKCkgfHwgXCIwXCIpO1xuICAgICAgICBsaW5lLnNldEF0dHJpYnV0ZShcInkyXCIsIHRhcmdldE5vZGUueT8udG9TdHJpbmcoKSB8fCBcIjBcIik7XG4gICAgICAgIGxpbmUuc2V0QXR0cmlidXRlKFwic3Ryb2tlXCIsIFwidmFyKC0tdGV4dC1tdXRlZClcIik7XG4gICAgICAgIGxpbmUuc2V0QXR0cmlidXRlKFwic3Ryb2tlLXdpZHRoXCIsIFwiMVwiKTtcbiAgICAgICAgbGluZS5zZXRBdHRyaWJ1dGUoXCJtYXJrZXItZW5kXCIsIFwidXJsKCNhcnJvd2hlYWQpXCIpO1xuICAgICAgICBsaW5lLnN0eWxlLmN1cnNvciA9IFwicG9pbnRlclwiO1xuXG4gICAgICAgIC8vIEFkZCBob3ZlciBlZmZlY3RcbiAgICAgICAgbGluZS5hZGRFdmVudExpc3RlbmVyKFwibW91c2VlbnRlclwiLCAoKSA9PiB7XG4gICAgICAgICAgbGluZS5zZXRBdHRyaWJ1dGUoXCJzdHJva2VcIiwgXCJ2YXIoLS10ZXh0LWFjY2VudClcIik7XG4gICAgICAgICAgbGluZS5zZXRBdHRyaWJ1dGUoXCJzdHJva2Utd2lkdGhcIiwgXCIyXCIpO1xuICAgICAgICB9KTtcblxuICAgICAgICBsaW5lLmFkZEV2ZW50TGlzdGVuZXIoXCJtb3VzZWxlYXZlXCIsICgpID0+IHtcbiAgICAgICAgICBsaW5lLnNldEF0dHJpYnV0ZShcInN0cm9rZVwiLCBcInZhcigtLXRleHQtbXV0ZWQpXCIpO1xuICAgICAgICAgIGxpbmUuc2V0QXR0cmlidXRlKFwic3Ryb2tlLXdpZHRoXCIsIFwiMVwiKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgbGlua3NHcm91cC5hcHBlbmRDaGlsZChsaW5lKTtcblxuICAgICAgICAvLyBBZGQgZWRnZSBsYWJlbCBpZiBlbmFibGVkXG4gICAgICAgIGlmIChjb25maWcuc2hvd0xhYmVscyAmJiBsaW5rLmxhYmVsKSB7XG4gICAgICAgICAgY29uc3QgbWlkWCA9ICgoc291cmNlTm9kZS54IHx8IDApICsgKHRhcmdldE5vZGUueCB8fCAwKSkgLyAyO1xuICAgICAgICAgIGNvbnN0IG1pZFkgPSAoKHNvdXJjZU5vZGUueSB8fCAwKSArICh0YXJnZXROb2RlLnkgfHwgMCkpIC8gMjtcblxuICAgICAgICAgIGNvbnN0IHRleHQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50TlMoXG4gICAgICAgICAgICBcImh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnXCIsXG4gICAgICAgICAgICBcInRleHRcIixcbiAgICAgICAgICApO1xuICAgICAgICAgIHRleHQuc2V0QXR0cmlidXRlKFwieFwiLCBtaWRYLnRvU3RyaW5nKCkpO1xuICAgICAgICAgIHRleHQuc2V0QXR0cmlidXRlKFwieVwiLCAobWlkWSAtIDUpLnRvU3RyaW5nKCkpO1xuICAgICAgICAgIHRleHQuc2V0QXR0cmlidXRlKFwidGV4dC1hbmNob3JcIiwgXCJtaWRkbGVcIik7XG4gICAgICAgICAgdGV4dC5zZXRBdHRyaWJ1dGUoXCJmb250LXNpemVcIiwgXCIxMFwiKTtcbiAgICAgICAgICB0ZXh0LnNldEF0dHJpYnV0ZShcImZpbGxcIiwgXCJ2YXIoLS10ZXh0LW11dGVkKVwiKTtcbiAgICAgICAgICB0ZXh0LnRleHRDb250ZW50ID0gdGhpcy50cnVuY2F0ZUxhYmVsKGxpbmsubGFiZWwsIDE1KTtcblxuICAgICAgICAgIC8vIEFkZCBiYWNrZ3JvdW5kIHJlY3RhbmdsZSBmb3IgYmV0dGVyIHJlYWRhYmlsaXR5XG4gICAgICAgICAgY29uc3QgYmJveCA9IHRleHQuZ2V0QkJveCgpO1xuICAgICAgICAgIGNvbnN0IHJlY3QgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50TlMoXG4gICAgICAgICAgICBcImh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnXCIsXG4gICAgICAgICAgICBcInJlY3RcIixcbiAgICAgICAgICApO1xuICAgICAgICAgIHJlY3Quc2V0QXR0cmlidXRlKFwieFwiLCAoYmJveC54IC0gMikudG9TdHJpbmcoKSk7XG4gICAgICAgICAgcmVjdC5zZXRBdHRyaWJ1dGUoXCJ5XCIsIChiYm94LnkgLSAxKS50b1N0cmluZygpKTtcbiAgICAgICAgICByZWN0LnNldEF0dHJpYnV0ZShcIndpZHRoXCIsIChiYm94LndpZHRoICsgNCkudG9TdHJpbmcoKSk7XG4gICAgICAgICAgcmVjdC5zZXRBdHRyaWJ1dGUoXCJoZWlnaHRcIiwgKGJib3guaGVpZ2h0ICsgMikudG9TdHJpbmcoKSk7XG4gICAgICAgICAgcmVjdC5zZXRBdHRyaWJ1dGUoXCJmaWxsXCIsIFwidmFyKC0tYmFja2dyb3VuZC1wcmltYXJ5KVwiKTtcbiAgICAgICAgICByZWN0LnNldEF0dHJpYnV0ZShcIm9wYWNpdHlcIiwgXCIwLjhcIik7XG5cbiAgICAgICAgICBsaW5rc0dyb3VwLmFwcGVuZENoaWxkKHJlY3QpO1xuICAgICAgICAgIGxpbmtzR3JvdXAuYXBwZW5kQ2hpbGQodGV4dCk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBDcmVhdGUgbm9kZXNcbiAgICBjb25zdCBub2Rlc0dyb3VwID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudE5TKFxuICAgICAgXCJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2Z1wiLFxuICAgICAgXCJnXCIsXG4gICAgKTtcbiAgICBub2Rlc0dyb3VwLnNldEF0dHJpYnV0ZShcImNsYXNzXCIsIFwibm9kZXNcIik7XG4gICAgZy5hcHBlbmRDaGlsZChub2Rlc0dyb3VwKTtcblxuICAgIGZvciAoY29uc3Qgbm9kZSBvZiBkYXRhLm5vZGVzKSB7XG4gICAgICBjb25zdCBub2RlR3JvdXAgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50TlMoXG4gICAgICAgIFwiaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmdcIixcbiAgICAgICAgXCJnXCIsXG4gICAgICApO1xuICAgICAgbm9kZUdyb3VwLnNldEF0dHJpYnV0ZShcImNsYXNzXCIsIFwibm9kZVwiKTtcbiAgICAgIG5vZGVHcm91cC5zdHlsZS5jdXJzb3IgPSBcInBvaW50ZXJcIjtcblxuICAgICAgY29uc3QgY2lyY2xlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudE5TKFxuICAgICAgICBcImh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnXCIsXG4gICAgICAgIFwiY2lyY2xlXCIsXG4gICAgICApO1xuICAgICAgY2lyY2xlLnNldEF0dHJpYnV0ZShcImN4XCIsIG5vZGUueD8udG9TdHJpbmcoKSB8fCBcIjBcIik7XG4gICAgICBjaXJjbGUuc2V0QXR0cmlidXRlKFwiY3lcIiwgbm9kZS55Py50b1N0cmluZygpIHx8IFwiMFwiKTtcbiAgICAgIGNpcmNsZS5zZXRBdHRyaWJ1dGUoXCJyXCIsIChjb25maWcubm9kZVNpemUgfHwgOCkudG9TdHJpbmcoKSk7XG4gICAgICBjaXJjbGUuc2V0QXR0cmlidXRlKFwiZmlsbFwiLCB0aGlzLmdldE5vZGVDb2xvcihub2RlLnR5cGUpKTtcbiAgICAgIGNpcmNsZS5zZXRBdHRyaWJ1dGUoXCJzdHJva2VcIiwgXCJ2YXIoLS1iYWNrZ3JvdW5kLW1vZGlmaWVyLWJvcmRlcilcIik7XG4gICAgICBjaXJjbGUuc2V0QXR0cmlidXRlKFwic3Ryb2tlLXdpZHRoXCIsIFwiMlwiKTtcblxuICAgICAgbm9kZUdyb3VwLmFwcGVuZENoaWxkKGNpcmNsZSk7XG5cbiAgICAgIC8vIEFkZCBub2RlIGxhYmVsIGlmIGVuYWJsZWRcbiAgICAgIGlmIChjb25maWcuc2hvd0xhYmVscykge1xuICAgICAgICBjb25zdCB0ZXh0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudE5TKFxuICAgICAgICAgIFwiaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmdcIixcbiAgICAgICAgICBcInRleHRcIixcbiAgICAgICAgKTtcbiAgICAgICAgdGV4dC5zZXRBdHRyaWJ1dGUoXCJ4XCIsIG5vZGUueD8udG9TdHJpbmcoKSB8fCBcIjBcIik7XG4gICAgICAgIHRleHQuc2V0QXR0cmlidXRlKFxuICAgICAgICAgIFwieVwiLFxuICAgICAgICAgICgobm9kZS55IHx8IDApICsgKGNvbmZpZy5ub2RlU2l6ZSB8fCA4KSArIDE1KS50b1N0cmluZygpLFxuICAgICAgICApO1xuICAgICAgICB0ZXh0LnNldEF0dHJpYnV0ZShcInRleHQtYW5jaG9yXCIsIFwibWlkZGxlXCIpO1xuICAgICAgICB0ZXh0LnNldEF0dHJpYnV0ZShcImZvbnQtc2l6ZVwiLCBcIjEyXCIpO1xuICAgICAgICB0ZXh0LnNldEF0dHJpYnV0ZShcImZpbGxcIiwgXCJ2YXIoLS10ZXh0LW5vcm1hbClcIik7XG4gICAgICAgIHRleHQudGV4dENvbnRlbnQgPSB0aGlzLnRydW5jYXRlTGFiZWwobm9kZS5sYWJlbCwgMjApO1xuICAgICAgICBub2RlR3JvdXAuYXBwZW5kQ2hpbGQodGV4dCk7XG4gICAgICB9XG5cbiAgICAgIC8vIEFkZCBjbGljayBoYW5kbGVyIGZvciBuYXZpZ2F0aW9uXG4gICAgICBub2RlR3JvdXAuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcbiAgICAgICAgdGhpcy5oYW5kbGVOb2RlQ2xpY2sobm9kZSk7XG4gICAgICB9KTtcblxuICAgICAgLy8gQWRkIGhvdmVyIGVmZmVjdHNcbiAgICAgIG5vZGVHcm91cC5hZGRFdmVudExpc3RlbmVyKFwibW91c2VlbnRlclwiLCAoKSA9PiB7XG4gICAgICAgIGNpcmNsZS5zZXRBdHRyaWJ1dGUoXCJyXCIsICgoY29uZmlnLm5vZGVTaXplIHx8IDgpICsgMikudG9TdHJpbmcoKSk7XG4gICAgICAgIGNpcmNsZS5zZXRBdHRyaWJ1dGUoXCJzdHJva2Utd2lkdGhcIiwgXCIzXCIpO1xuICAgICAgfSk7XG5cbiAgICAgIG5vZGVHcm91cC5hZGRFdmVudExpc3RlbmVyKFwibW91c2VsZWF2ZVwiLCAoKSA9PiB7XG4gICAgICAgIGNpcmNsZS5zZXRBdHRyaWJ1dGUoXCJyXCIsIChjb25maWcubm9kZVNpemUgfHwgOCkudG9TdHJpbmcoKSk7XG4gICAgICAgIGNpcmNsZS5zZXRBdHRyaWJ1dGUoXCJzdHJva2Utd2lkdGhcIiwgXCIyXCIpO1xuICAgICAgfSk7XG5cbiAgICAgIG5vZGVzR3JvdXAuYXBwZW5kQ2hpbGQobm9kZUdyb3VwKTtcbiAgICB9XG5cbiAgICAvLyBBZGQgem9vbSBhbmQgcGFuIGZ1bmN0aW9uYWxpdHlcbiAgICB0aGlzLmFkZFpvb21QYW4oc3ZnLCBnKTtcbiAgfVxuXG4gIHByaXZhdGUgcG9zaXRpb25Ob2RlcyhcbiAgICBub2RlczogR3JhcGhOb2RlW10sXG4gICAgd2lkdGg6IG51bWJlcixcbiAgICBoZWlnaHQ6IG51bWJlcixcbiAgKTogdm9pZCB7XG4gICAgLy8gU2ltcGxlIGNpcmN1bGFyIGxheW91dCBhcyBzdGFydGluZyBwb3NpdGlvbnNcbiAgICBjb25zdCBjZW50ZXJYID0gd2lkdGggLyAyO1xuICAgIGNvbnN0IGNlbnRlclkgPSBoZWlnaHQgLyAyO1xuICAgIGNvbnN0IHJhZGl1cyA9IE1hdGgubWluKHdpZHRoLCBoZWlnaHQpIC8gMztcblxuICAgIG5vZGVzLmZvckVhY2goKG5vZGUsIGkpID0+IHtcbiAgICAgIGNvbnN0IGFuZ2xlID0gKGkgLyBub2Rlcy5sZW5ndGgpICogMiAqIE1hdGguUEk7XG4gICAgICBub2RlLnggPSBjZW50ZXJYICsgcmFkaXVzICogTWF0aC5jb3MoYW5nbGUpO1xuICAgICAgbm9kZS55ID0gY2VudGVyWSArIHJhZGl1cyAqIE1hdGguc2luKGFuZ2xlKTtcbiAgICB9KTtcbiAgfVxuXG4gIHByaXZhdGUgZ2V0Tm9kZUNvbG9yKHR5cGU6IFwic3ViamVjdFwiIHwgXCJvYmplY3RcIiB8IFwicHJlZGljYXRlXCIpOiBzdHJpbmcge1xuICAgIHN3aXRjaCAodHlwZSkge1xuICAgICAgY2FzZSBcInN1YmplY3RcIjpcbiAgICAgICAgcmV0dXJuIFwidmFyKC0tY29sb3ItYWNjZW50KVwiO1xuICAgICAgY2FzZSBcIm9iamVjdFwiOlxuICAgICAgICByZXR1cm4gXCJ2YXIoLS1jb2xvci1ibHVlKVwiO1xuICAgICAgY2FzZSBcInByZWRpY2F0ZVwiOlxuICAgICAgICByZXR1cm4gXCJ2YXIoLS1jb2xvci1ncmVlbilcIjtcbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIHJldHVybiBcInZhcigtLXRleHQtbXV0ZWQpXCI7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSB0cnVuY2F0ZUxhYmVsKGxhYmVsOiBzdHJpbmcsIG1heExlbmd0aDogbnVtYmVyKTogc3RyaW5nIHtcbiAgICBpZiAobGFiZWwubGVuZ3RoIDw9IG1heExlbmd0aCkgcmV0dXJuIGxhYmVsO1xuICAgIHJldHVybiBsYWJlbC5zdWJzdHJpbmcoMCwgbWF4TGVuZ3RoIC0gMykgKyBcIi4uLlwiO1xuICB9XG5cbiAgcHJpdmF0ZSBoYW5kbGVOb2RlQ2xpY2sobm9kZTogR3JhcGhOb2RlKTogdm9pZCB7XG4gICAgLy8gSWYgaXQncyBhIGZpbGUgbGluaywgbmF2aWdhdGUgdG8gaXRcbiAgICBpZiAobm9kZS5pZC5zdGFydHNXaXRoKFwiZmlsZTovL1wiKSB8fCBub2RlLmlkLmluY2x1ZGVzKFwiLm1kXCIpKSB7XG4gICAgICBjb25zdCBmaWxlbmFtZSA9IG5vZGUuaWQucmVwbGFjZShcImZpbGU6Ly9cIiwgXCJcIik7XG4gICAgICB0aGlzLnBsdWdpbi5hcHAud29ya3NwYWNlLm9wZW5MaW5rVGV4dChmaWxlbmFtZSwgXCJcIik7XG4gICAgfSBlbHNlIHtcbiAgICAgIC8vIFNob3cgbm9kZSBkZXRhaWxzIGluIGEgbm90aWNlXG4gICAgICBuZXcgTm90aWNlKFxuICAgICAgICBgTm9kZTogJHtub2RlLmxhYmVsfVxcblR5cGU6ICR7bm9kZS50eXBlfVxcbklEOiAke25vZGUuaWR9YCxcbiAgICAgICAgMzAwMCxcbiAgICAgICk7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBhZGRab29tUGFuKHN2ZzogU1ZHU1ZHRWxlbWVudCwgZzogU1ZHR0VsZW1lbnQpOiB2b2lkIHtcbiAgICBsZXQgaXNNb3VzZURvd24gPSBmYWxzZTtcbiAgICBsZXQgc3RhcnRYID0gMDtcbiAgICBsZXQgc3RhcnRZID0gMDtcbiAgICBsZXQgY3VycmVudFRyYW5zZm9ybSA9IHsgeDogMCwgeTogMCwgc2NhbGU6IDEgfTtcblxuICAgIHN2Zy5hZGRFdmVudExpc3RlbmVyKFwibW91c2Vkb3duXCIsIChlKSA9PiB7XG4gICAgICBpc01vdXNlRG93biA9IHRydWU7XG4gICAgICBzdGFydFggPSBlLmNsaWVudFg7XG4gICAgICBzdGFydFkgPSBlLmNsaWVudFk7XG4gICAgICBzdmcuc3R5bGUuY3Vyc29yID0gXCJncmFiYmluZ1wiO1xuICAgIH0pO1xuXG4gICAgc3ZnLmFkZEV2ZW50TGlzdGVuZXIoXCJtb3VzZW1vdmVcIiwgKGUpID0+IHtcbiAgICAgIGlmICghaXNNb3VzZURvd24pIHJldHVybjtcblxuICAgICAgY29uc3QgZGVsdGFYID0gZS5jbGllbnRYIC0gc3RhcnRYO1xuICAgICAgY29uc3QgZGVsdGFZID0gZS5jbGllbnRZIC0gc3RhcnRZO1xuXG4gICAgICBjdXJyZW50VHJhbnNmb3JtLnggKz0gZGVsdGFYO1xuICAgICAgY3VycmVudFRyYW5zZm9ybS55ICs9IGRlbHRhWTtcblxuICAgICAgZy5zZXRBdHRyaWJ1dGUoXG4gICAgICAgIFwidHJhbnNmb3JtXCIsXG4gICAgICAgIGB0cmFuc2xhdGUoJHtjdXJyZW50VHJhbnNmb3JtLnh9LCAke2N1cnJlbnRUcmFuc2Zvcm0ueX0pIHNjYWxlKCR7Y3VycmVudFRyYW5zZm9ybS5zY2FsZX0pYCxcbiAgICAgICk7XG5cbiAgICAgIHN0YXJ0WCA9IGUuY2xpZW50WDtcbiAgICAgIHN0YXJ0WSA9IGUuY2xpZW50WTtcbiAgICB9KTtcblxuICAgIHN2Zy5hZGRFdmVudExpc3RlbmVyKFwibW91c2V1cFwiLCAoKSA9PiB7XG4gICAgICBpc01vdXNlRG93biA9IGZhbHNlO1xuICAgICAgc3ZnLnN0eWxlLmN1cnNvciA9IFwiZ3JhYlwiO1xuICAgIH0pO1xuXG4gICAgc3ZnLmFkZEV2ZW50TGlzdGVuZXIoXCJ3aGVlbFwiLCAoZSkgPT4ge1xuICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuXG4gICAgICBjb25zdCBzY2FsZUZhY3RvciA9IGUuZGVsdGFZID4gMCA/IDAuOSA6IDEuMTtcbiAgICAgIGN1cnJlbnRUcmFuc2Zvcm0uc2NhbGUgPSBNYXRoLm1heChcbiAgICAgICAgMC4xLFxuICAgICAgICBNYXRoLm1pbigzLCBjdXJyZW50VHJhbnNmb3JtLnNjYWxlICogc2NhbGVGYWN0b3IpLFxuICAgICAgKTtcblxuICAgICAgZy5zZXRBdHRyaWJ1dGUoXG4gICAgICAgIFwidHJhbnNmb3JtXCIsXG4gICAgICAgIGB0cmFuc2xhdGUoJHtjdXJyZW50VHJhbnNmb3JtLnh9LCAke2N1cnJlbnRUcmFuc2Zvcm0ueX0pIHNjYWxlKCR7Y3VycmVudFRyYW5zZm9ybS5zY2FsZX0pYCxcbiAgICAgICk7XG4gICAgfSk7XG5cbiAgICBzdmcuc3R5bGUuY3Vyc29yID0gXCJncmFiXCI7XG4gIH1cblxuICBwcml2YXRlIGFkZENvbnRyb2xzKFxuICAgIGNvbnRhaW5lcjogSFRNTEVsZW1lbnQsXG4gICAgZGF0YTogR3JhcGhEYXRhLFxuICAgIGNvbmZpZzogR3JhcGhDb25maWcsXG4gICk6IHZvaWQge1xuICAgIGNvbnN0IGNvbnRyb2xzRGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcbiAgICBjb250cm9sc0Rpdi5zdHlsZS5jc3NUZXh0ID0gYFxuICAgICAgICAgICAgbWFyZ2luLXRvcDogMWVtO1xuICAgICAgICAgICAgZGlzcGxheTogZmxleDtcbiAgICAgICAgICAgIGdhcDogMC41ZW07XG4gICAgICAgICAgICBmbGV4LXdyYXA6IHdyYXA7XG4gICAgICAgICAgICBhbGlnbi1pdGVtczogY2VudGVyO1xuICAgICAgICAgICAgcGFkZGluZzogMC41ZW07XG4gICAgICAgICAgICBiYWNrZ3JvdW5kOiB2YXIoLS1iYWNrZ3JvdW5kLW1vZGlmaWVyLWZvcm0tZmllbGQpO1xuICAgICAgICAgICAgYm9yZGVyLXJhZGl1czogdmFyKC0tcmFkaXVzLXMpO1xuICAgICAgICBgO1xuXG4gICAgLy8gTm9kZSBjb3VudCBpbmZvXG4gICAgY29uc3QgaW5mbyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJzcGFuXCIpO1xuICAgIGluZm8udGV4dENvbnRlbnQgPSBgTm9kZXM6ICR7ZGF0YS5ub2Rlcy5sZW5ndGh9LCBMaW5rczogJHtkYXRhLmxpbmtzLmxlbmd0aH1gO1xuICAgIGluZm8uc3R5bGUuY3NzVGV4dCA9XG4gICAgICBcImNvbG9yOiB2YXIoLS10ZXh0LW11dGVkKTsgZm9udC1zaXplOiAwLjllbTsgbWFyZ2luLXJpZ2h0OiBhdXRvO1wiO1xuICAgIGNvbnRyb2xzRGl2LmFwcGVuZENoaWxkKGluZm8pO1xuXG4gICAgLy8gUE5HIEV4cG9ydCBkcm9wZG93blxuICAgIGNvbnN0IHBuZ0V4cG9ydENvbnRhaW5lciA9IHRoaXMuY3JlYXRlUE5HRXhwb3J0RHJvcGRvd24oXG4gICAgICBjb250YWluZXIsXG4gICAgICBkYXRhLFxuICAgICAgY29uZmlnLFxuICAgICk7XG4gICAgY29udHJvbHNEaXYuYXBwZW5kQ2hpbGQocG5nRXhwb3J0Q29udGFpbmVyKTtcblxuICAgIC8vIEV4cG9ydCBhcyBTVkcgYnV0dG9uXG4gICAgY29uc3QgZXhwb3J0U3ZnQnRuID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImJ1dHRvblwiKTtcbiAgICBleHBvcnRTdmdCdG4udGV4dENvbnRlbnQgPSBcIkV4cG9ydCBTVkdcIjtcbiAgICBleHBvcnRTdmdCdG4uY2xhc3NOYW1lID0gXCJtb2QtY3RhXCI7XG4gICAgZXhwb3J0U3ZnQnRuLnN0eWxlLmNzc1RleHQgPSBcInBhZGRpbmc6IDAuMjVlbSAwLjVlbTsgZm9udC1zaXplOiAwLjllbTtcIjtcbiAgICBleHBvcnRTdmdCdG4uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHRoaXMuZXhwb3J0QXNTVkcoY29udGFpbmVyKSk7XG4gICAgY29udHJvbHNEaXYuYXBwZW5kQ2hpbGQoZXhwb3J0U3ZnQnRuKTtcblxuICAgIC8vIEV4cG9ydCBhcyBSREYgZHJvcGRvd25cbiAgICBjb25zdCByZGZFeHBvcnRDb250YWluZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuICAgIHJkZkV4cG9ydENvbnRhaW5lci5zdHlsZS5jc3NUZXh0ID1cbiAgICAgIFwicG9zaXRpb246IHJlbGF0aXZlOyBkaXNwbGF5OiBpbmxpbmUtYmxvY2s7XCI7XG5cbiAgICBjb25zdCByZGZFeHBvcnRCdG4gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiYnV0dG9uXCIpO1xuICAgIHJkZkV4cG9ydEJ0bi50ZXh0Q29udGVudCA9IFwiRXhwb3J0IFJERiDilrxcIjtcbiAgICByZGZFeHBvcnRCdG4uc3R5bGUuY3NzVGV4dCA9XG4gICAgICBcInBhZGRpbmc6IDAuMjVlbSAwLjVlbTsgZm9udC1zaXplOiAwLjllbTsgYmFja2dyb3VuZDogdmFyKC0taW50ZXJhY3RpdmUtYWNjZW50KTsgY29sb3I6IHZhcigtLXRleHQtb24tYWNjZW50KTsgYm9yZGVyOiBub25lOyBib3JkZXItcmFkaXVzOiAzcHg7IGN1cnNvcjogcG9pbnRlcjtcIjtcblxuICAgIGNvbnN0IHJkZkRyb3Bkb3duID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcbiAgICByZGZEcm9wZG93bi5zdHlsZS5jc3NUZXh0ID0gYFxuICAgICAgICAgICAgZGlzcGxheTogbm9uZTtcbiAgICAgICAgICAgIHBvc2l0aW9uOiBhYnNvbHV0ZTtcbiAgICAgICAgICAgIHRvcDogMTAwJTtcbiAgICAgICAgICAgIGxlZnQ6IDA7XG4gICAgICAgICAgICBiYWNrZ3JvdW5kOiB2YXIoLS1iYWNrZ3JvdW5kLXByaW1hcnkpO1xuICAgICAgICAgICAgYm9yZGVyOiAxcHggc29saWQgdmFyKC0tYmFja2dyb3VuZC1tb2RpZmllci1ib3JkZXIpO1xuICAgICAgICAgICAgYm9yZGVyLXJhZGl1czogM3B4O1xuICAgICAgICAgICAgYm94LXNoYWRvdzogdmFyKC0tc2hhZG93LXMpO1xuICAgICAgICAgICAgei1pbmRleDogMTAwMDtcbiAgICAgICAgICAgIG1pbi13aWR0aDogMTIwcHg7XG4gICAgICAgIGA7XG5cbiAgICBjb25zdCBmb3JtYXRzOiBBcnJheTx7IGZvcm1hdDogUkRGRm9ybWF0OyBsYWJlbDogc3RyaW5nIH0+ID0gW1xuICAgICAgeyBmb3JtYXQ6IFwidHVydGxlXCIsIGxhYmVsOiBcIlR1cnRsZSAoLnR0bClcIiB9LFxuICAgICAgeyBmb3JtYXQ6IFwianNvbi1sZFwiLCBsYWJlbDogXCJKU09OLUxEICguanNvbmxkKVwiIH0sXG4gICAgICB7IGZvcm1hdDogXCJuLXRyaXBsZXNcIiwgbGFiZWw6IFwiTi1UcmlwbGVzICgubnQpXCIgfSxcbiAgICAgIHsgZm9ybWF0OiBcInJkZi14bWxcIiwgbGFiZWw6IFwiUkRGL1hNTCAoLnJkZilcIiB9LFxuICAgIF07XG5cbiAgICBmb3IgKGNvbnN0IHsgZm9ybWF0LCBsYWJlbCB9IG9mIGZvcm1hdHMpIHtcbiAgICAgIGNvbnN0IGl0ZW0gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuICAgICAgaXRlbS50ZXh0Q29udGVudCA9IGxhYmVsO1xuICAgICAgaXRlbS5zdHlsZS5jc3NUZXh0ID1cbiAgICAgICAgXCJwYWRkaW5nOiAwLjVlbSAwLjhlbTsgY3Vyc29yOiBwb2ludGVyOyBib3JkZXItYm90dG9tOiAxcHggc29saWQgdmFyKC0tYmFja2dyb3VuZC1tb2RpZmllci1ib3JkZXIpO1wiO1xuICAgICAgaXRlbS5hZGRFdmVudExpc3RlbmVyKFwibW91c2VlbnRlclwiLCAoKSA9PiB7XG4gICAgICAgIGl0ZW0uc3R5bGUuYmFja2dyb3VuZCA9IFwidmFyKC0tYmFja2dyb3VuZC1tb2RpZmllci1ob3ZlcilcIjtcbiAgICAgIH0pO1xuICAgICAgaXRlbS5hZGRFdmVudExpc3RlbmVyKFwibW91c2VsZWF2ZVwiLCAoKSA9PiB7XG4gICAgICAgIGl0ZW0uc3R5bGUuYmFja2dyb3VuZCA9IFwiXCI7XG4gICAgICB9KTtcbiAgICAgIGl0ZW0uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcbiAgICAgICAgdGhpcy5leHBvcnRHcmFwaEFzUkRGKGRhdGEsIGZvcm1hdCk7XG4gICAgICAgIHJkZkRyb3Bkb3duLnN0eWxlLmRpc3BsYXkgPSBcIm5vbmVcIjtcbiAgICAgIH0pO1xuICAgICAgcmRmRHJvcGRvd24uYXBwZW5kQ2hpbGQoaXRlbSk7XG4gICAgfVxuXG4gICAgLy8gQWR2YW5jZWQgZXhwb3J0IG9wdGlvblxuICAgIGNvbnN0IGFkdmFuY2VkSXRlbSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG4gICAgYWR2YW5jZWRJdGVtLnRleHRDb250ZW50ID0gXCJBZHZhbmNlZC4uLlwiO1xuICAgIGFkdmFuY2VkSXRlbS5zdHlsZS5jc3NUZXh0ID1cbiAgICAgIFwicGFkZGluZzogMC41ZW0gMC44ZW07IGN1cnNvcjogcG9pbnRlcjsgZm9udC13ZWlnaHQ6IDUwMDsgY29sb3I6IHZhcigtLXRleHQtYWNjZW50KTtcIjtcbiAgICBhZHZhbmNlZEl0ZW0uYWRkRXZlbnRMaXN0ZW5lcihcIm1vdXNlZW50ZXJcIiwgKCkgPT4ge1xuICAgICAgYWR2YW5jZWRJdGVtLnN0eWxlLmJhY2tncm91bmQgPSBcInZhcigtLWJhY2tncm91bmQtbW9kaWZpZXItaG92ZXIpXCI7XG4gICAgfSk7XG4gICAgYWR2YW5jZWRJdGVtLmFkZEV2ZW50TGlzdGVuZXIoXCJtb3VzZWxlYXZlXCIsICgpID0+IHtcbiAgICAgIGFkdmFuY2VkSXRlbS5zdHlsZS5iYWNrZ3JvdW5kID0gXCJcIjtcbiAgICB9KTtcbiAgICBhZHZhbmNlZEl0ZW0uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcbiAgICAgIHRoaXMub3BlbkFkdmFuY2VkUkRGRXhwb3J0KGRhdGEpO1xuICAgICAgcmRmRHJvcGRvd24uc3R5bGUuZGlzcGxheSA9IFwibm9uZVwiO1xuICAgIH0pO1xuICAgIHJkZkRyb3Bkb3duLmFwcGVuZENoaWxkKGFkdmFuY2VkSXRlbSk7XG5cbiAgICByZGZFeHBvcnRCdG4uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIChlKSA9PiB7XG4gICAgICBlLnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgcmRmRHJvcGRvd24uc3R5bGUuZGlzcGxheSA9XG4gICAgICAgIHJkZkRyb3Bkb3duLnN0eWxlLmRpc3BsYXkgPT09IFwibm9uZVwiID8gXCJibG9ja1wiIDogXCJub25lXCI7XG4gICAgfSk7XG5cbiAgICAvLyBDbG9zZSBkcm9wZG93biB3aGVuIGNsaWNraW5nIG91dHNpZGVcbiAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xuICAgICAgcmRmRHJvcGRvd24uc3R5bGUuZGlzcGxheSA9IFwibm9uZVwiO1xuICAgIH0pO1xuXG4gICAgcmRmRXhwb3J0Q29udGFpbmVyLmFwcGVuZENoaWxkKHJkZkV4cG9ydEJ0bik7XG4gICAgcmRmRXhwb3J0Q29udGFpbmVyLmFwcGVuZENoaWxkKHJkZkRyb3Bkb3duKTtcbiAgICBjb250cm9sc0Rpdi5hcHBlbmRDaGlsZChyZGZFeHBvcnRDb250YWluZXIpO1xuXG4gICAgLy8gUmVzZXQgem9vbSBidXR0b25cbiAgICBjb25zdCByZXNldEJ0biA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJidXR0b25cIik7XG4gICAgcmVzZXRCdG4udGV4dENvbnRlbnQgPSBcIlJlc2V0IFZpZXdcIjtcbiAgICByZXNldEJ0bi5zdHlsZS5jc3NUZXh0ID0gXCJwYWRkaW5nOiAwLjI1ZW0gMC41ZW07IGZvbnQtc2l6ZTogMC45ZW07XCI7XG4gICAgcmVzZXRCdG4uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHRoaXMucmVzZXRWaWV3KGNvbnRhaW5lcikpO1xuICAgIGNvbnRyb2xzRGl2LmFwcGVuZENoaWxkKHJlc2V0QnRuKTtcblxuICAgIGNvbnRhaW5lci5hcHBlbmRDaGlsZChjb250cm9sc0Rpdik7XG4gIH1cblxuICBwcml2YXRlIGNyZWF0ZVBOR0V4cG9ydERyb3Bkb3duKFxuICAgIGNvbnRhaW5lcjogSFRNTEVsZW1lbnQsXG4gICAgZGF0YTogR3JhcGhEYXRhLFxuICAgIGNvbmZpZzogR3JhcGhDb25maWcsXG4gICk6IEhUTUxFbGVtZW50IHtcbiAgICBjb25zdCBwbmdFeHBvcnRDb250YWluZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuICAgIHBuZ0V4cG9ydENvbnRhaW5lci5zdHlsZS5jc3NUZXh0ID1cbiAgICAgIFwicG9zaXRpb246IHJlbGF0aXZlOyBkaXNwbGF5OiBpbmxpbmUtYmxvY2s7XCI7XG5cbiAgICBjb25zdCBwbmdFeHBvcnRCdG4gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiYnV0dG9uXCIpO1xuICAgIHBuZ0V4cG9ydEJ0bi50ZXh0Q29udGVudCA9IFwiRXhwb3J0IFBORyDilrxcIjtcbiAgICBwbmdFeHBvcnRCdG4uc3R5bGUuY3NzVGV4dCA9XG4gICAgICBcInBhZGRpbmc6IDAuMjVlbSAwLjVlbTsgZm9udC1zaXplOiAwLjllbTsgYmFja2dyb3VuZDogdmFyKC0taW50ZXJhY3RpdmUtYWNjZW50KTsgY29sb3I6IHZhcigtLXRleHQtb24tYWNjZW50KTsgYm9yZGVyOiBub25lOyBib3JkZXItcmFkaXVzOiAzcHg7IGN1cnNvcjogcG9pbnRlcjtcIjtcblxuICAgIGNvbnN0IHBuZ0Ryb3Bkb3duID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcbiAgICBwbmdEcm9wZG93bi5zdHlsZS5jc3NUZXh0ID0gYFxuICAgICAgICAgICAgZGlzcGxheTogbm9uZTtcbiAgICAgICAgICAgIHBvc2l0aW9uOiBhYnNvbHV0ZTtcbiAgICAgICAgICAgIHRvcDogMTAwJTtcbiAgICAgICAgICAgIGxlZnQ6IDA7XG4gICAgICAgICAgICBiYWNrZ3JvdW5kOiB2YXIoLS1iYWNrZ3JvdW5kLXByaW1hcnkpO1xuICAgICAgICAgICAgYm9yZGVyOiAxcHggc29saWQgdmFyKC0tYmFja2dyb3VuZC1tb2RpZmllci1ib3JkZXIpO1xuICAgICAgICAgICAgYm9yZGVyLXJhZGl1czogM3B4O1xuICAgICAgICAgICAgYm94LXNoYWRvdzogdmFyKC0tc2hhZG93LXMpO1xuICAgICAgICAgICAgei1pbmRleDogMTAwMDtcbiAgICAgICAgICAgIG1pbi13aWR0aDogMTgwcHg7XG4gICAgICAgIGA7XG5cbiAgICBjb25zdCByZXNvbHV0aW9ucyA9IFtcbiAgICAgIHsgc2NhbGU6IDEsIGxhYmVsOiBcIlN0YW5kYXJkICg4MDDDlzYwMClcIiwgZmlsZW5hbWU6IFwiZ3JhcGgtc3RhbmRhcmQucG5nXCIgfSxcbiAgICAgIHsgc2NhbGU6IDIsIGxhYmVsOiBcIkhpZ2gtRFBJICgxNjAww5cxMjAwKVwiLCBmaWxlbmFtZTogXCJncmFwaC1oZC5wbmdcIiB9LFxuICAgICAgeyBzY2FsZTogNCwgbGFiZWw6IFwiNEsgKDMyMDDDlzI0MDApXCIsIGZpbGVuYW1lOiBcImdyYXBoLTRrLnBuZ1wiIH0sXG4gICAgXTtcblxuICAgIGZvciAoY29uc3QgcmVzb2x1dGlvbiBvZiByZXNvbHV0aW9ucykge1xuICAgICAgY29uc3QgaXRlbSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG4gICAgICBpdGVtLnRleHRDb250ZW50ID0gcmVzb2x1dGlvbi5sYWJlbDtcbiAgICAgIGl0ZW0uc3R5bGUuY3NzVGV4dCA9XG4gICAgICAgIFwicGFkZGluZzogMC41ZW0gMC44ZW07IGN1cnNvcjogcG9pbnRlcjsgYm9yZGVyLWJvdHRvbTogMXB4IHNvbGlkIHZhcigtLWJhY2tncm91bmQtbW9kaWZpZXItYm9yZGVyKTtcIjtcblxuICAgICAgaXRlbS5hZGRFdmVudExpc3RlbmVyKFwibW91c2VlbnRlclwiLCAoKSA9PiB7XG4gICAgICAgIGl0ZW0uc3R5bGUuYmFja2dyb3VuZCA9IFwidmFyKC0tYmFja2dyb3VuZC1tb2RpZmllci1ob3ZlcilcIjtcbiAgICAgIH0pO1xuICAgICAgaXRlbS5hZGRFdmVudExpc3RlbmVyKFwibW91c2VsZWF2ZVwiLCAoKSA9PiB7XG4gICAgICAgIGl0ZW0uc3R5bGUuYmFja2dyb3VuZCA9IFwiXCI7XG4gICAgICB9KTtcbiAgICAgIGl0ZW0uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcbiAgICAgICAgdGhpcy5leHBvcnRBc1BORyhcbiAgICAgICAgICBjb250YWluZXIsXG4gICAgICAgICAgZGF0YSxcbiAgICAgICAgICBjb25maWcsXG4gICAgICAgICAgcmVzb2x1dGlvbi5zY2FsZSxcbiAgICAgICAgICByZXNvbHV0aW9uLmZpbGVuYW1lLFxuICAgICAgICApO1xuICAgICAgICBwbmdEcm9wZG93bi5zdHlsZS5kaXNwbGF5ID0gXCJub25lXCI7XG4gICAgICB9KTtcblxuICAgICAgcG5nRHJvcGRvd24uYXBwZW5kQ2hpbGQoaXRlbSk7XG4gICAgfVxuXG4gICAgcG5nRXhwb3J0QnRuLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoZSkgPT4ge1xuICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgIHBuZ0Ryb3Bkb3duLnN0eWxlLmRpc3BsYXkgPVxuICAgICAgICBwbmdEcm9wZG93bi5zdHlsZS5kaXNwbGF5ID09PSBcIm5vbmVcIiA/IFwiYmxvY2tcIiA6IFwibm9uZVwiO1xuICAgIH0pO1xuXG4gICAgLy8gQ2xvc2UgZHJvcGRvd24gd2hlbiBjbGlja2luZyBvdXRzaWRlXG4gICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcbiAgICAgIHBuZ0Ryb3Bkb3duLnN0eWxlLmRpc3BsYXkgPSBcIm5vbmVcIjtcbiAgICB9KTtcblxuICAgIHBuZ0V4cG9ydENvbnRhaW5lci5hcHBlbmRDaGlsZChwbmdFeHBvcnRCdG4pO1xuICAgIHBuZ0V4cG9ydENvbnRhaW5lci5hcHBlbmRDaGlsZChwbmdEcm9wZG93bik7XG5cbiAgICByZXR1cm4gcG5nRXhwb3J0Q29udGFpbmVyO1xuICB9XG5cbiAgcHJpdmF0ZSBhc3luYyBleHBvcnRBc1BORyhcbiAgICBjb250YWluZXI6IEhUTUxFbGVtZW50LFxuICAgIGRhdGE6IEdyYXBoRGF0YSxcbiAgICBjb25maWc6IEdyYXBoQ29uZmlnLFxuICAgIHNjYWxlOiBudW1iZXIgPSAxLFxuICAgIGZpbGVuYW1lOiBzdHJpbmcgPSBcImtub3dsZWRnZS1ncmFwaC5wbmdcIixcbiAgKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgY29uc3Qgc3ZnID0gY29udGFpbmVyLnF1ZXJ5U2VsZWN0b3IoXCJzdmdcIik7XG4gICAgaWYgKCFzdmcpIHtcbiAgICAgIG5ldyBOb3RpY2UoXCJObyBncmFwaCB2aXN1YWxpemF0aW9uIGZvdW5kXCIpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIHRyeSB7XG4gICAgICAvLyBTaG93IGxvYWRpbmcgbm90aWNlIGZvciBoaWdoLXJlc29sdXRpb24gZXhwb3J0c1xuICAgICAgbGV0IGxvYWRpbmdOb3RpY2U6IE5vdGljZSB8IG51bGwgPSBudWxsO1xuICAgICAgaWYgKHNjYWxlID49IDIpIHtcbiAgICAgICAgbG9hZGluZ05vdGljZSA9IG5ldyBOb3RpY2UoXG4gICAgICAgICAgYEdlbmVyYXRpbmcgJHtzY2FsZSA9PT0gMiA/IFwiaGlnaC1yZXNvbHV0aW9uXCIgOiBcIjRLXCJ9IFBORyBleHBvcnQuLi5gLFxuICAgICAgICAgIDAsXG4gICAgICAgICk7XG4gICAgICB9XG5cbiAgICAgIC8vIENyZWF0ZSBjYW52YXMgd2l0aCBzY2FsZWQgZGltZW5zaW9uc1xuICAgICAgY29uc3QgY2FudmFzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImNhbnZhc1wiKTtcbiAgICAgIGNvbnN0IGJhc2VXaWR0aCA9IDgwMDtcbiAgICAgIGNvbnN0IGJhc2VIZWlnaHQgPSA2MDA7XG4gICAgICBjYW52YXMud2lkdGggPSBiYXNlV2lkdGggKiBzY2FsZTtcbiAgICAgIGNhbnZhcy5oZWlnaHQgPSBiYXNlSGVpZ2h0ICogc2NhbGU7XG5cbiAgICAgIGNvbnN0IGN0eCA9IGNhbnZhcy5nZXRDb250ZXh0KFwiMmRcIik7XG4gICAgICBpZiAoIWN0eCkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJDb3VsZCBub3QgZ2V0IGNhbnZhcyBjb250ZXh0XCIpO1xuICAgICAgfVxuXG4gICAgICAvLyBTY2FsZSBjb250ZXh0IGZvciBoaWdoLURQSSByZW5kZXJpbmdcbiAgICAgIGN0eC5zY2FsZShzY2FsZSwgc2NhbGUpO1xuXG4gICAgICAvLyBTZXQgaGlnaC1xdWFsaXR5IHJlbmRlcmluZ1xuICAgICAgY3R4LmltYWdlU21vb3RoaW5nRW5hYmxlZCA9IHRydWU7XG4gICAgICBjdHguaW1hZ2VTbW9vdGhpbmdRdWFsaXR5ID0gXCJoaWdoXCI7XG5cbiAgICAgIC8vIEZpbGwgYmFja2dyb3VuZCB3aXRoIHRoZW1lIGNvbG9yXG4gICAgICBjb25zdCBiZ0NvbG9yID0gdGhpcy5nZXRUaGVtZUNvbG9yKFwiLS1iYWNrZ3JvdW5kLXByaW1hcnlcIikgfHwgXCIjZmZmZmZmXCI7XG4gICAgICBjdHguZmlsbFN0eWxlID0gYmdDb2xvcjtcbiAgICAgIGN0eC5maWxsUmVjdCgwLCAwLCBiYXNlV2lkdGgsIGJhc2VIZWlnaHQpO1xuXG4gICAgICAvLyBEcmF3IGJvcmRlclxuICAgICAgY29uc3QgYm9yZGVyQ29sb3IgPVxuICAgICAgICB0aGlzLmdldFRoZW1lQ29sb3IoXCItLWJhY2tncm91bmQtbW9kaWZpZXItYm9yZGVyXCIpIHx8IFwiI2U1ZTVlNVwiO1xuICAgICAgY3R4LnN0cm9rZVN0eWxlID0gYm9yZGVyQ29sb3I7XG4gICAgICBjdHgubGluZVdpZHRoID0gMTtcbiAgICAgIGN0eC5zdHJva2VSZWN0KDAsIDAsIGJhc2VXaWR0aCwgYmFzZUhlaWdodCk7XG5cbiAgICAgIC8vIFJlbmRlciBncmFwaCB0byBjYW52YXNcbiAgICAgIGF3YWl0IHRoaXMucmVuZGVyR3JhcGhUb0NhbnZhcyhjdHgsIGRhdGEsIGNvbmZpZywgYmFzZVdpZHRoLCBiYXNlSGVpZ2h0KTtcblxuICAgICAgLy8gQ29udmVydCBjYW52YXMgdG8gUE5HIGJsb2JcbiAgICAgIGNhbnZhcy50b0Jsb2IoXG4gICAgICAgIChibG9iKSA9PiB7XG4gICAgICAgICAgaWYgKGJsb2IpIHtcbiAgICAgICAgICAgIHRoaXMuZG93bmxvYWRCbG9iKGJsb2IsIGZpbGVuYW1lKTtcblxuICAgICAgICAgICAgaWYgKGxvYWRpbmdOb3RpY2UpIHtcbiAgICAgICAgICAgICAgbG9hZGluZ05vdGljZS5oaWRlKCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGNvbnN0IHNpemVLQiA9IE1hdGgucm91bmQoYmxvYi5zaXplIC8gMTAyNCk7XG4gICAgICAgICAgICBuZXcgTm90aWNlKGBHcmFwaCBleHBvcnRlZCBhcyBQTkcgKCR7c2l6ZUtCfSBLQilgKTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiRmFpbGVkIHRvIGNyZWF0ZSBQTkcgYmxvYlwiKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIFwiaW1hZ2UvcG5nXCIsXG4gICAgICAgIDAuOSxcbiAgICAgICk7XG4gICAgfSBjYXRjaCAoZXJyb3I6IGFueSkge1xuICAgICAgY29uc29sZS5lcnJvcihcIlBORyBleHBvcnQgZmFpbGVkOlwiLCBlcnJvcik7XG4gICAgICBuZXcgTm90aWNlKGBQTkcgZXhwb3J0IGZhaWxlZDogJHtlcnJvci5tZXNzYWdlfWApO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgYXN5bmMgcmVuZGVyR3JhcGhUb0NhbnZhcyhcbiAgICBjdHg6IENhbnZhc1JlbmRlcmluZ0NvbnRleHQyRCxcbiAgICBkYXRhOiBHcmFwaERhdGEsXG4gICAgY29uZmlnOiBHcmFwaENvbmZpZyxcbiAgICB3aWR0aDogbnVtYmVyLFxuICAgIGhlaWdodDogbnVtYmVyLFxuICApOiBQcm9taXNlPHZvaWQ+IHtcbiAgICAvLyBQb3NpdGlvbiBub2RlcyAocmV1c2UgZXhpc3RpbmcgYWxnb3JpdGhtKVxuICAgIHRoaXMucG9zaXRpb25Ob2RlcyhkYXRhLm5vZGVzLCB3aWR0aCwgaGVpZ2h0KTtcblxuICAgIC8vIFJlbmRlciBsaW5rcyBmaXJzdCAoYmFja2dyb3VuZCBsYXllcilcbiAgICBmb3IgKGNvbnN0IGxpbmsgb2YgZGF0YS5saW5rcykge1xuICAgICAgY29uc3Qgc291cmNlTm9kZSA9IGRhdGEubm9kZXMuZmluZChcbiAgICAgICAgKG4pID0+XG4gICAgICAgICAgbi5pZCA9PT1cbiAgICAgICAgICAodHlwZW9mIGxpbmsuc291cmNlID09PSBcInN0cmluZ1wiID8gbGluay5zb3VyY2UgOiBsaW5rLnNvdXJjZS5pZCksXG4gICAgICApO1xuICAgICAgY29uc3QgdGFyZ2V0Tm9kZSA9IGRhdGEubm9kZXMuZmluZChcbiAgICAgICAgKG4pID0+XG4gICAgICAgICAgbi5pZCA9PT1cbiAgICAgICAgICAodHlwZW9mIGxpbmsudGFyZ2V0ID09PSBcInN0cmluZ1wiID8gbGluay50YXJnZXQgOiBsaW5rLnRhcmdldC5pZCksXG4gICAgICApO1xuXG4gICAgICBpZiAoc291cmNlTm9kZSAmJiB0YXJnZXROb2RlKSB7XG4gICAgICAgIC8vIERyYXcgbGluZVxuICAgICAgICBjdHguYmVnaW5QYXRoKCk7XG4gICAgICAgIGN0eC5tb3ZlVG8oc291cmNlTm9kZS54IHx8IDAsIHNvdXJjZU5vZGUueSB8fCAwKTtcbiAgICAgICAgY3R4LmxpbmVUbyh0YXJnZXROb2RlLnggfHwgMCwgdGFyZ2V0Tm9kZS55IHx8IDApO1xuICAgICAgICBjdHguc3Ryb2tlU3R5bGUgPSB0aGlzLmdldFRoZW1lQ29sb3IoXCItLXRleHQtbXV0ZWRcIikgfHwgXCIjNmI3MjgwXCI7XG4gICAgICAgIGN0eC5saW5lV2lkdGggPSAxO1xuICAgICAgICBjdHguc3Ryb2tlKCk7XG5cbiAgICAgICAgLy8gRHJhdyBhcnJvd2hlYWRcbiAgICAgICAgdGhpcy5kcmF3QXJyb3dIZWFkKFxuICAgICAgICAgIGN0eCxcbiAgICAgICAgICBzb3VyY2VOb2RlLnggfHwgMCxcbiAgICAgICAgICBzb3VyY2VOb2RlLnkgfHwgMCxcbiAgICAgICAgICB0YXJnZXROb2RlLnggfHwgMCxcbiAgICAgICAgICB0YXJnZXROb2RlLnkgfHwgMCxcbiAgICAgICAgKTtcblxuICAgICAgICAvLyBEcmF3IGVkZ2UgbGFiZWwgaWYgZW5hYmxlZFxuICAgICAgICBpZiAoY29uZmlnLnNob3dMYWJlbHMgJiYgbGluay5sYWJlbCkge1xuICAgICAgICAgIGNvbnN0IG1pZFggPSAoKHNvdXJjZU5vZGUueCB8fCAwKSArICh0YXJnZXROb2RlLnggfHwgMCkpIC8gMjtcbiAgICAgICAgICBjb25zdCBtaWRZID0gKChzb3VyY2VOb2RlLnkgfHwgMCkgKyAodGFyZ2V0Tm9kZS55IHx8IDApKSAvIDI7XG5cbiAgICAgICAgICAvLyBEcmF3IGJhY2tncm91bmQgcmVjdGFuZ2xlIGZvciBsYWJlbFxuICAgICAgICAgIGNvbnN0IGxhYmVsVGV4dCA9IHRoaXMudHJ1bmNhdGVMYWJlbChsaW5rLmxhYmVsLCAxNSk7XG4gICAgICAgICAgY3R4LmZvbnQgPSBcIjEwcHggdmFyKC0tZm9udC1pbnRlcmZhY2UpXCI7XG4gICAgICAgICAgY29uc3QgdGV4dE1ldHJpY3MgPSBjdHgubWVhc3VyZVRleHQobGFiZWxUZXh0KTtcblxuICAgICAgICAgIGN0eC5maWxsU3R5bGUgPVxuICAgICAgICAgICAgdGhpcy5nZXRUaGVtZUNvbG9yKFwiLS1iYWNrZ3JvdW5kLXByaW1hcnlcIikgfHwgXCIjZmZmZmZmXCI7XG4gICAgICAgICAgY3R4LmZpbGxSZWN0KFxuICAgICAgICAgICAgbWlkWCAtIHRleHRNZXRyaWNzLndpZHRoIC8gMiAtIDIsXG4gICAgICAgICAgICBtaWRZIC0gNyxcbiAgICAgICAgICAgIHRleHRNZXRyaWNzLndpZHRoICsgNCxcbiAgICAgICAgICAgIDEyLFxuICAgICAgICAgICk7XG5cbiAgICAgICAgICAvLyBEcmF3IGxhYmVsIHRleHRcbiAgICAgICAgICBjdHguZmlsbFN0eWxlID0gdGhpcy5nZXRUaGVtZUNvbG9yKFwiLS10ZXh0LW11dGVkXCIpIHx8IFwiIzZiNzI4MFwiO1xuICAgICAgICAgIGN0eC50ZXh0QWxpZ24gPSBcImNlbnRlclwiO1xuICAgICAgICAgIGN0eC5maWxsVGV4dChsYWJlbFRleHQsIG1pZFgsIG1pZFkgKyAzKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIC8vIFJlbmRlciBub2RlcyBvbiB0b3BcbiAgICBmb3IgKGNvbnN0IG5vZGUgb2YgZGF0YS5ub2Rlcykge1xuICAgICAgY29uc3QgeCA9IG5vZGUueCB8fCAwO1xuICAgICAgY29uc3QgeSA9IG5vZGUueSB8fCAwO1xuICAgICAgY29uc3QgcmFkaXVzID0gY29uZmlnLm5vZGVTaXplIHx8IDg7XG5cbiAgICAgIC8vIERyYXcgbm9kZSBjaXJjbGVcbiAgICAgIGN0eC5iZWdpblBhdGgoKTtcbiAgICAgIGN0eC5hcmMoeCwgeSwgcmFkaXVzLCAwLCAyICogTWF0aC5QSSk7XG4gICAgICBjdHguZmlsbFN0eWxlID0gdGhpcy5nZXROb2RlQ2FudmFzQ29sb3Iobm9kZS50eXBlKTtcbiAgICAgIGN0eC5maWxsKCk7XG5cbiAgICAgIC8vIERyYXcgYm9yZGVyXG4gICAgICBjdHguc3Ryb2tlU3R5bGUgPVxuICAgICAgICB0aGlzLmdldFRoZW1lQ29sb3IoXCItLWJhY2tncm91bmQtbW9kaWZpZXItYm9yZGVyXCIpIHx8IFwiI2U1ZTVlNVwiO1xuICAgICAgY3R4LmxpbmVXaWR0aCA9IDI7XG4gICAgICBjdHguc3Ryb2tlKCk7XG5cbiAgICAgIC8vIERyYXcgbm9kZSBsYWJlbCBpZiBlbmFibGVkXG4gICAgICBpZiAoY29uZmlnLnNob3dMYWJlbHMpIHtcbiAgICAgICAgY3R4LmZvbnQgPSBcIjEycHggdmFyKC0tZm9udC1pbnRlcmZhY2UpXCI7XG4gICAgICAgIGN0eC5maWxsU3R5bGUgPSB0aGlzLmdldFRoZW1lQ29sb3IoXCItLXRleHQtbm9ybWFsXCIpIHx8IFwiIzAwMDAwMFwiO1xuICAgICAgICBjdHgudGV4dEFsaWduID0gXCJjZW50ZXJcIjtcbiAgICAgICAgY29uc3QgbGFiZWxUZXh0ID0gdGhpcy50cnVuY2F0ZUxhYmVsKG5vZGUubGFiZWwsIDIwKTtcbiAgICAgICAgY3R4LmZpbGxUZXh0KGxhYmVsVGV4dCwgeCwgeSArIHJhZGl1cyArIDE1KTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGRyYXdBcnJvd0hlYWQoXG4gICAgY3R4OiBDYW52YXNSZW5kZXJpbmdDb250ZXh0MkQsXG4gICAgZnJvbVg6IG51bWJlcixcbiAgICBmcm9tWTogbnVtYmVyLFxuICAgIHRvWDogbnVtYmVyLFxuICAgIHRvWTogbnVtYmVyLFxuICApOiB2b2lkIHtcbiAgICBjb25zdCBhbmdsZSA9IE1hdGguYXRhbjIodG9ZIC0gZnJvbVksIHRvWCAtIGZyb21YKTtcbiAgICBjb25zdCBhcnJvd0xlbmd0aCA9IDEwO1xuICAgIGNvbnN0IGFycm93QW5nbGUgPSBNYXRoLlBJIC8gNjtcblxuICAgIC8vIENhbGN1bGF0ZSBhcnJvd2hlYWQgcG9zaXRpb24gKG9mZnNldCBmcm9tIHRhcmdldCBub2RlKVxuICAgIGNvbnN0IG9mZnNldERpc3RhbmNlID0gMTA7IC8vIERpc3RhbmNlIGZyb20gbm9kZSBlZGdlXG4gICAgY29uc3Qgb2Zmc2V0WCA9IHRvWCAtIG9mZnNldERpc3RhbmNlICogTWF0aC5jb3MoYW5nbGUpO1xuICAgIGNvbnN0IG9mZnNldFkgPSB0b1kgLSBvZmZzZXREaXN0YW5jZSAqIE1hdGguc2luKGFuZ2xlKTtcblxuICAgIGN0eC5iZWdpblBhdGgoKTtcbiAgICBjdHgubW92ZVRvKG9mZnNldFgsIG9mZnNldFkpO1xuICAgIGN0eC5saW5lVG8oXG4gICAgICBvZmZzZXRYIC0gYXJyb3dMZW5ndGggKiBNYXRoLmNvcyhhbmdsZSAtIGFycm93QW5nbGUpLFxuICAgICAgb2Zmc2V0WSAtIGFycm93TGVuZ3RoICogTWF0aC5zaW4oYW5nbGUgLSBhcnJvd0FuZ2xlKSxcbiAgICApO1xuICAgIGN0eC5tb3ZlVG8ob2Zmc2V0WCwgb2Zmc2V0WSk7XG4gICAgY3R4LmxpbmVUbyhcbiAgICAgIG9mZnNldFggLSBhcnJvd0xlbmd0aCAqIE1hdGguY29zKGFuZ2xlICsgYXJyb3dBbmdsZSksXG4gICAgICBvZmZzZXRZIC0gYXJyb3dMZW5ndGggKiBNYXRoLnNpbihhbmdsZSArIGFycm93QW5nbGUpLFxuICAgICk7XG4gICAgY3R4LnN0cm9rZVN0eWxlID0gdGhpcy5nZXRUaGVtZUNvbG9yKFwiLS10ZXh0LW11dGVkXCIpIHx8IFwiIzZiNzI4MFwiO1xuICAgIGN0eC5saW5lV2lkdGggPSAxO1xuICAgIGN0eC5zdHJva2UoKTtcbiAgfVxuXG4gIHByaXZhdGUgZ2V0VGhlbWVDb2xvcihjc3NWYXJpYWJsZTogc3RyaW5nKTogc3RyaW5nIHwgbnVsbCB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHN0eWxlID0gZ2V0Q29tcHV0ZWRTdHlsZShkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQpO1xuICAgICAgY29uc3QgY29sb3IgPSBzdHlsZS5nZXRQcm9wZXJ0eVZhbHVlKGNzc1ZhcmlhYmxlKS50cmltKCk7XG5cbiAgICAgIGlmICghY29sb3IpIHJldHVybiBudWxsO1xuXG4gICAgICAvLyBDb252ZXJ0IENTUyBjb2xvciBmb3JtYXRzIHRvIGhleCBpZiBuZWVkZWRcbiAgICAgIGlmIChjb2xvci5zdGFydHNXaXRoKFwiaHNsXCIpKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmhzbFRvSGV4KGNvbG9yKTtcbiAgICAgIH1cbiAgICAgIGlmIChjb2xvci5zdGFydHNXaXRoKFwicmdiXCIpKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnJnYlRvSGV4KGNvbG9yKTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIGNvbG9yO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLndhcm4oYEZhaWxlZCB0byBnZXQgdGhlbWUgY29sb3IgZm9yICR7Y3NzVmFyaWFibGV9OmAsIGVycm9yKTtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgZ2V0Tm9kZUNhbnZhc0NvbG9yKHR5cGU6IFwic3ViamVjdFwiIHwgXCJvYmplY3RcIiB8IFwicHJlZGljYXRlXCIpOiBzdHJpbmcge1xuICAgIHN3aXRjaCAodHlwZSkge1xuICAgICAgY2FzZSBcInN1YmplY3RcIjpcbiAgICAgICAgcmV0dXJuIHRoaXMuZ2V0VGhlbWVDb2xvcihcIi0tY29sb3ItYWNjZW50XCIpIHx8IFwiIzdjM2FlZFwiO1xuICAgICAgY2FzZSBcIm9iamVjdFwiOlxuICAgICAgICByZXR1cm4gdGhpcy5nZXRUaGVtZUNvbG9yKFwiLS1jb2xvci1ibHVlXCIpIHx8IFwiIzI1NjNlYlwiO1xuICAgICAgY2FzZSBcInByZWRpY2F0ZVwiOlxuICAgICAgICByZXR1cm4gdGhpcy5nZXRUaGVtZUNvbG9yKFwiLS1jb2xvci1ncmVlblwiKSB8fCBcIiMwNTk2NjlcIjtcbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIHJldHVybiBcIiM2YjcyODBcIjtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGhzbFRvSGV4KGhzbDogc3RyaW5nKTogc3RyaW5nIHtcbiAgICAvLyBTaW1wbGUgSFNMIHRvIGhleCBjb252ZXJzaW9uIC0gZm9yIGJhc2ljIHRoZW1lIHN1cHBvcnRcbiAgICAvLyBUaGlzIGlzIGEgc2ltcGxpZmllZCB2ZXJzaW9uOyBmb3IgcHJvZHVjdGlvbiwgY29uc2lkZXIgdXNpbmcgYSBsaWJyYXJ5XG4gICAgcmV0dXJuIFwiIzZiNzI4MFwiOyAvLyBGYWxsYmFjayBjb2xvclxuICB9XG5cbiAgcHJpdmF0ZSByZ2JUb0hleChyZ2I6IHN0cmluZyk6IHN0cmluZyB7XG4gICAgY29uc3QgbWF0Y2ggPSByZ2IubWF0Y2goL3JnYlxcKChcXGQrKSxcXHMqKFxcZCspLFxccyooXFxkKylcXCkvKTtcbiAgICBpZiAoIW1hdGNoKSByZXR1cm4gXCIjMDAwMDAwXCI7XG5cbiAgICBjb25zdCByID0gcGFyc2VJbnQobWF0Y2hbMV0pO1xuICAgIGNvbnN0IGcgPSBwYXJzZUludChtYXRjaFsyXSk7XG4gICAgY29uc3QgYiA9IHBhcnNlSW50KG1hdGNoWzNdKTtcblxuICAgIHJldHVybiAoXG4gICAgICBcIiNcIiArXG4gICAgICBbciwgZywgYl1cbiAgICAgICAgLm1hcCgoeCkgPT4ge1xuICAgICAgICAgIGNvbnN0IGhleCA9IHgudG9TdHJpbmcoMTYpO1xuICAgICAgICAgIHJldHVybiBoZXgubGVuZ3RoID09PSAxID8gXCIwXCIgKyBoZXggOiBoZXg7XG4gICAgICAgIH0pXG4gICAgICAgIC5qb2luKFwiXCIpXG4gICAgKTtcbiAgfVxuXG4gIHByaXZhdGUgZG93bmxvYWRCbG9iKGJsb2I6IEJsb2IsIGZpbGVuYW1lOiBzdHJpbmcpOiB2b2lkIHtcbiAgICAvLyBDaGVjayBpZiB3ZSdyZSBpbiBhIHRlc3QgZW52aXJvbm1lbnQgKEpTRE9NKVxuICAgIGlmIChcbiAgICAgIHR5cGVvZiB3aW5kb3cgIT09IFwidW5kZWZpbmVkXCIgJiZcbiAgICAgIHdpbmRvdy5uYXZpZ2F0b3I/LnVzZXJBZ2VudD8uaW5jbHVkZXMoXCJqc2RvbVwiKVxuICAgICkge1xuICAgICAgLy8gSW4gdGVzdCBlbnZpcm9ubWVudCwganVzdCBsb2cgdGhlIGFjdGlvbiBpbnN0ZWFkIG9mIGF0dGVtcHRpbmcgRE9NIG1hbmlwdWxhdGlvblxuICAgICAgY29uc29sZS5sb2coXG4gICAgICAgIGBUZXN0IGVudmlyb25tZW50OiBXb3VsZCBkb3dubG9hZCAke2ZpbGVuYW1lfSAoJHtibG9iLnNpemV9IGJ5dGVzKWAsXG4gICAgICApO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGNvbnN0IHVybCA9IFVSTC5jcmVhdGVPYmplY3RVUkwoYmxvYik7XG4gICAgY29uc3QgbGluayA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJhXCIpO1xuICAgIGxpbmsuaHJlZiA9IHVybDtcbiAgICBsaW5rLmRvd25sb2FkID0gZmlsZW5hbWU7XG4gICAgbGluay5zdHlsZS5kaXNwbGF5ID0gXCJub25lXCI7XG5cbiAgICAvLyBFbnN1cmUgZG9jdW1lbnQuYm9keSBleGlzdHMgYmVmb3JlIGFwcGVuZGluZ1xuICAgIGlmIChkb2N1bWVudC5ib2R5KSB7XG4gICAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKGxpbmspO1xuICAgICAgbGluay5jbGljaygpO1xuICAgICAgZG9jdW1lbnQuYm9keS5yZW1vdmVDaGlsZChsaW5rKTtcbiAgICB9IGVsc2Uge1xuICAgICAgLy8gRmFsbGJhY2sgZm9yIGVudmlyb25tZW50cyB3aXRob3V0IGRvY3VtZW50LmJvZHlcbiAgICAgIGNvbnNvbGUud2FybihcIkRvY3VtZW50IGJvZHkgbm90IGF2YWlsYWJsZSBmb3IgZG93bmxvYWRcIik7XG4gICAgfVxuXG4gICAgVVJMLnJldm9rZU9iamVjdFVSTCh1cmwpO1xuICB9XG5cbiAgcHJpdmF0ZSBleHBvcnRBc1NWRyhjb250YWluZXI6IEhUTUxFbGVtZW50KTogdm9pZCB7XG4gICAgY29uc3Qgc3ZnID0gY29udGFpbmVyLnF1ZXJ5U2VsZWN0b3IoXCJzdmdcIik7XG4gICAgaWYgKCFzdmcpIHJldHVybjtcblxuICAgIHRyeSB7XG4gICAgICBjb25zdCBzZXJpYWxpemVyID0gbmV3IFhNTFNlcmlhbGl6ZXIoKTtcbiAgICAgIGNvbnN0IHN2Z1N0cmluZyA9IHNlcmlhbGl6ZXIuc2VyaWFsaXplVG9TdHJpbmcoc3ZnKTtcblxuICAgICAgY29uc3QgYmxvYiA9IG5ldyBCbG9iKFtzdmdTdHJpbmddLCB7IHR5cGU6IFwiaW1hZ2Uvc3ZnK3htbFwiIH0pO1xuICAgICAgdGhpcy5kb3dubG9hZEJsb2IoYmxvYiwgXCJrbm93bGVkZ2UtZ3JhcGguc3ZnXCIpO1xuXG4gICAgICBuZXcgTm90aWNlKFwiR3JhcGggZXhwb3J0ZWQgYXMgU1ZHXCIpO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKFwiU1ZHIGV4cG9ydCBmYWlsZWQ6XCIsIGVycm9yKTtcbiAgICAgIG5ldyBOb3RpY2UoXCJGYWlsZWQgdG8gZXhwb3J0IFNWR1wiKTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIHJlc2V0Vmlldyhjb250YWluZXI6IEhUTUxFbGVtZW50KTogdm9pZCB7XG4gICAgY29uc3Qgc3ZnID0gY29udGFpbmVyLnF1ZXJ5U2VsZWN0b3IoXCJzdmdcIik7XG4gICAgY29uc3QgZyA9IHN2Zz8ucXVlcnlTZWxlY3RvcihcImdcIik7XG4gICAgaWYgKGcpIHtcbiAgICAgIGcuc2V0QXR0cmlidXRlKFwidHJhbnNmb3JtXCIsIFwidHJhbnNsYXRlKDAsIDApIHNjYWxlKDEpXCIpO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgY3JlYXRlTG9hZGluZ0luZGljYXRvcigpOiBIVE1MRWxlbWVudCB7XG4gICAgY29uc3QgbG9hZGluZyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG4gICAgbG9hZGluZy5jbGFzc05hbWUgPSBcImdyYXBoLWxvYWRpbmdcIjtcbiAgICBsb2FkaW5nLnRleHRDb250ZW50ID0gXCJHZW5lcmF0aW5nIGdyYXBoIHZpc3VhbGl6YXRpb24uLi5cIjtcbiAgICBsb2FkaW5nLnN0eWxlLmNzc1RleHQgPVxuICAgICAgXCJwYWRkaW5nOiAyZW07IHRleHQtYWxpZ246IGNlbnRlcjsgY29sb3I6IHZhcigtLXRleHQtbXV0ZWQpO1wiO1xuICAgIHJldHVybiBsb2FkaW5nO1xuICB9XG5cbiAgcHJpdmF0ZSBjcmVhdGVFcnJvck1lc3NhZ2UoZXJyb3I6IEVycm9yKTogSFRNTEVsZW1lbnQge1xuICAgIGNvbnN0IGVycm9yRGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcbiAgICBlcnJvckRpdi5jbGFzc05hbWUgPSBcImdyYXBoLWVycm9yXCI7XG4gICAgZXJyb3JEaXYuc3R5bGUuY3NzVGV4dCA9IGBcbiAgICAgICAgICAgIGJhY2tncm91bmQ6IHZhcigtLWJhY2tncm91bmQtbW9kaWZpZXItZXJyb3IpO1xuICAgICAgICAgICAgY29sb3I6IHZhcigtLXRleHQtZXJyb3IpO1xuICAgICAgICAgICAgcGFkZGluZzogMWVtO1xuICAgICAgICAgICAgYm9yZGVyLXJhZGl1czogdmFyKC0tcmFkaXVzLW0pO1xuICAgICAgICAgICAgYm9yZGVyOiAxcHggc29saWQgdmFyKC0tYmFja2dyb3VuZC1tb2RpZmllci1ib3JkZXIpO1xuICAgICAgICBgO1xuXG4gICAgY29uc3QgdGl0bGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwic3Ryb25nXCIpO1xuICAgIHRpdGxlLnRleHRDb250ZW50ID0gXCJHcmFwaCBWaXN1YWxpemF0aW9uIEVycm9yOiBcIjtcbiAgICBlcnJvckRpdi5hcHBlbmRDaGlsZCh0aXRsZSk7XG5cbiAgICBjb25zdCBtZXNzYWdlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInNwYW5cIik7XG4gICAgbWVzc2FnZS50ZXh0Q29udGVudCA9IGVycm9yLm1lc3NhZ2U7XG4gICAgZXJyb3JEaXYuYXBwZW5kQ2hpbGQobWVzc2FnZSk7XG5cbiAgICByZXR1cm4gZXJyb3JEaXY7XG4gIH1cblxuICAvKipcbiAgICogRXhwb3J0IGdyYXBoIHZpc3VhbGl6YXRpb24gZGF0YSBhcyBSREZcbiAgICovXG4gIHByaXZhdGUgYXN5bmMgZXhwb3J0R3JhcGhBc1JERihcbiAgICBkYXRhOiBHcmFwaERhdGEsXG4gICAgZm9ybWF0OiBSREZGb3JtYXQsXG4gICk6IFByb21pc2U8dm9pZD4ge1xuICAgIHRyeSB7XG4gICAgICAvLyBDb252ZXJ0IGdyYXBoIGRhdGEgYmFjayB0byB0cmlwbGVzXG4gICAgICBjb25zdCB0cmlwbGVzID0gdGhpcy5jb252ZXJ0R3JhcGhEYXRhVG9UcmlwbGVzKGRhdGEpO1xuXG4gICAgICAvLyBDcmVhdGUgYSBncmFwaCBmcm9tIHRoZSB0cmlwbGVzXG4gICAgICBjb25zdCBncmFwaCA9IG5ldyBHcmFwaCgpO1xuICAgICAgZm9yIChjb25zdCB0cmlwbGUgb2YgdHJpcGxlcykge1xuICAgICAgICBncmFwaC5hZGQodHJpcGxlKTtcbiAgICAgIH1cblxuICAgICAgY29uc3QgZmlsZU5hbWUgPSBgZ3JhcGgtdmlzdWFsaXphdGlvbi0ke0RhdGUubm93KCl9YDtcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHRoaXMucmRmU2VydmljZS5leHBvcnRHcmFwaChncmFwaCwge1xuICAgICAgICBmb3JtYXQsXG4gICAgICAgIGZpbGVOYW1lLFxuICAgICAgICBzYXZlVG9WYXVsdDogdHJ1ZSxcbiAgICAgICAgaW5jbHVkZUNvbW1lbnRzOiB0cnVlLFxuICAgICAgICBwcmV0dHlQcmludDogdHJ1ZSxcbiAgICAgICAgdGFyZ2V0Rm9sZGVyOiBcImV4cG9ydHNcIixcbiAgICAgIH0pO1xuXG4gICAgICBpZiAocmVzdWx0LmlzU3VjY2Vzcykge1xuICAgICAgICBjb25zdCBleHBvcnREYXRhID0gcmVzdWx0LmdldFZhbHVlKCk7XG4gICAgICAgIG5ldyBOb3RpY2UoXG4gICAgICAgICAgYEV4cG9ydGVkIGdyYXBoIHZpc3VhbGl6YXRpb24gYXMgJHtmb3JtYXQudG9VcHBlckNhc2UoKX0gKCR7ZXhwb3J0RGF0YS50cmlwbGVDb3VudH0gdHJpcGxlcylgLFxuICAgICAgICApO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgbmV3IE5vdGljZShgRXhwb3J0IGZhaWxlZDogJHtyZXN1bHQuZXJyb3JWYWx1ZSgpfWApO1xuICAgICAgfVxuICAgIH0gY2F0Y2ggKGVycm9yOiBhbnkpIHtcbiAgICAgIG5ldyBOb3RpY2UoYEV4cG9ydCBlcnJvcjogJHtlcnJvci5tZXNzYWdlfWApO1xuICAgICAgY29uc29sZS5lcnJvcihcIkdyYXBoIFJERiBleHBvcnQgZXJyb3I6XCIsIGVycm9yKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogT3BlbiBhZHZhbmNlZCBSREYgZXhwb3J0IG1vZGFsXG4gICAqL1xuICBwcml2YXRlIG9wZW5BZHZhbmNlZFJERkV4cG9ydChkYXRhOiBHcmFwaERhdGEpOiB2b2lkIHtcbiAgICB0cnkge1xuICAgICAgLy8gQ29udmVydCBncmFwaCBkYXRhIGJhY2sgdG8gdHJpcGxlc1xuICAgICAgY29uc3QgdHJpcGxlcyA9IHRoaXMuY29udmVydEdyYXBoRGF0YVRvVHJpcGxlcyhkYXRhKTtcblxuICAgICAgLy8gQ3JlYXRlIGEgZ3JhcGggZnJvbSB0aGUgdHJpcGxlc1xuICAgICAgY29uc3QgZ3JhcGggPSBuZXcgR3JhcGgoKTtcbiAgICAgIGZvciAoY29uc3QgdHJpcGxlIG9mIHRyaXBsZXMpIHtcbiAgICAgICAgZ3JhcGguYWRkKHRyaXBsZSk7XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IG1vZGFsID0gbmV3IEV4cG9ydFJERk1vZGFsKFxuICAgICAgICB0aGlzLnBsdWdpbi5hcHAsXG4gICAgICAgIGdyYXBoLFxuICAgICAgICB0aGlzLnJkZlNlcnZpY2UuZ2V0TmFtZXNwYWNlTWFuYWdlcigpLFxuICAgICAgICAocmVzdWx0KSA9PiB7XG4gICAgICAgICAgbmV3IE5vdGljZShgR3JhcGggdmlzdWFsaXphdGlvbiBleHBvcnRlZDogJHtyZXN1bHQuZmlsZU5hbWV9YCk7XG4gICAgICAgIH0sXG4gICAgICApO1xuXG4gICAgICBtb2RhbC5vcGVuKCk7XG4gICAgfSBjYXRjaCAoZXJyb3I6IGFueSkge1xuICAgICAgbmV3IE5vdGljZShgRmFpbGVkIHRvIG9wZW4gZXhwb3J0IG1vZGFsOiAke2Vycm9yLm1lc3NhZ2V9YCk7XG4gICAgICBjb25zb2xlLmVycm9yKFwiRXhwb3J0IG1vZGFsIGVycm9yOlwiLCBlcnJvcik7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIENvbnZlcnQgR3JhcGhEYXRhIGJhY2sgdG8gVHJpcGxlIGZvcm1hdFxuICAgKi9cbiAgcHJpdmF0ZSBjb252ZXJ0R3JhcGhEYXRhVG9UcmlwbGVzKGRhdGE6IEdyYXBoRGF0YSk6IFRyaXBsZVtdIHtcbiAgICBjb25zdCB0cmlwbGVzOiBUcmlwbGVbXSA9IFtdO1xuXG4gICAgLy8gUmVjb25zdHJ1Y3QgdHJpcGxlcyBmcm9tIGdyYXBoIGRhdGFcbiAgICBmb3IgKGNvbnN0IGxpbmsgb2YgZGF0YS5saW5rcykge1xuICAgICAgY29uc3Qgc291cmNlTm9kZSA9IGRhdGEubm9kZXMuZmluZChcbiAgICAgICAgKG4pID0+XG4gICAgICAgICAgbi5pZCA9PT1cbiAgICAgICAgICAodHlwZW9mIGxpbmsuc291cmNlID09PSBcInN0cmluZ1wiID8gbGluay5zb3VyY2UgOiBsaW5rLnNvdXJjZS5pZCksXG4gICAgICApO1xuICAgICAgY29uc3QgdGFyZ2V0Tm9kZSA9IGRhdGEubm9kZXMuZmluZChcbiAgICAgICAgKG4pID0+XG4gICAgICAgICAgbi5pZCA9PT1cbiAgICAgICAgICAodHlwZW9mIGxpbmsudGFyZ2V0ID09PSBcInN0cmluZ1wiID8gbGluay50YXJnZXQgOiBsaW5rLnRhcmdldC5pZCksXG4gICAgICApO1xuXG4gICAgICBpZiAoc291cmNlTm9kZSAmJiB0YXJnZXROb2RlKSB7XG4gICAgICAgIHRyaXBsZXMucHVzaChcbiAgICAgICAgICBuZXcgVHJpcGxlKFxuICAgICAgICAgICAgbmV3IElSSShzb3VyY2VOb2RlLmlkKSxcbiAgICAgICAgICAgIG5ldyBJUkkobGluay5sYWJlbCksXG4gICAgICAgICAgICBuZXcgSVJJKHRhcmdldE5vZGUuaWQpLFxuICAgICAgICAgICksXG4gICAgICAgICk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIHRyaXBsZXM7XG4gIH1cbn1cbiJdLCJ2ZXJzaW9uIjozfQ==