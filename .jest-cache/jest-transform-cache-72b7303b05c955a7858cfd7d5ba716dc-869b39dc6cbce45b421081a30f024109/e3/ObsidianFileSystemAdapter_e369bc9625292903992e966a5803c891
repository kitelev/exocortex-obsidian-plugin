86a0272bade42bdb10ee31eda370c7ca
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.ObsidianFileSystemAdapter = void 0;
const obsidian_1 = require("obsidian");
const Result_1 = require("../../domain/core/Result");
/**
 * Obsidian implementation of file system adapter
 */
class ObsidianFileSystemAdapter {
    constructor(app) {
        this.app = app;
    }
    async readFile(path) {
        try {
            const file = this.app.vault.getAbstractFileByPath(path);
            if (!file || !(file instanceof obsidian_1.TFile)) {
                return Result_1.Result.fail(`File not found: ${path}`);
            }
            const content = await this.app.vault.read(file);
            return Result_1.Result.ok(content);
        }
        catch (error) {
            return Result_1.Result.fail(`Failed to read file ${path}: ${error.message}`);
        }
    }
    async writeFile(path, content) {
        try {
            const file = this.app.vault.getAbstractFileByPath(path);
            if (file instanceof obsidian_1.TFile) {
                await this.app.vault.modify(file, content);
            }
            else {
                await this.app.vault.create(path, content);
            }
            return Result_1.Result.ok(undefined);
        }
        catch (error) {
            return Result_1.Result.fail(`Failed to write file ${path}: ${error.message}`);
        }
    }
    async fileExists(path) {
        const file = this.app.vault.getAbstractFileByPath(path);
        return file instanceof obsidian_1.TFile;
    }
    async listFiles(directory, extension) {
        try {
            let files = this.app.vault.getFiles();
            if (directory) {
                files = files.filter((file) => file.path.startsWith(directory));
            }
            if (extension) {
                files = files.filter((file) => file.extension === extension);
            }
            return Result_1.Result.ok(files);
        }
        catch (error) {
            return Result_1.Result.fail(`Failed to list files: ${error.message}`);
        }
    }
    generateFileName(baseName, extension) {
        const timestamp = new Date().toISOString().replace(/[:.]/g, "-");
        const name = baseName || `export-${timestamp}`;
        return extension ? `${name}.${extension}` : name;
    }
    detectFormatFromExtension(fileName) {
        const extension = fileName.split(".").pop()?.toLowerCase();
        const formatMap = {
            ttl: "turtle",
            nt: "n-triples",
            jsonld: "json-ld",
            rdf: "rdf-xml",
            xml: "rdf-xml",
        };
        return formatMap[extension || ""] || "turtle";
    }
    async ensureDirectory(path) {
        try {
            const exists = await this.app.vault.adapter.exists(path);
            if (!exists) {
                await this.app.vault.adapter.mkdir(path);
            }
            return Result_1.Result.ok(undefined);
        }
        catch (error) {
            return Result_1.Result.fail(`Failed to create directory ${path}: ${error.message}`);
        }
    }
}
exports.ObsidianFileSystemAdapter = ObsidianFileSystemAdapter;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL2tpdGVsZXYvRG9jdW1lbnRzL2V4b2NvcnRleC1vYnNpZGlhbi1wbHVnaW4vc3JjL2luZnJhc3RydWN0dXJlL2FkYXB0ZXJzL09ic2lkaWFuRmlsZVN5c3RlbUFkYXB0ZXIudHMiLCJtYXBwaW5ncyI6Ijs7O0FBQUEsdUNBQXNDO0FBQ3RDLHFEQUFrRDtBQUdsRDs7R0FFRztBQUNILE1BQWEseUJBQXlCO0lBQ3BDLFlBQW9CLEdBQVE7UUFBUixRQUFHLEdBQUgsR0FBRyxDQUFLO0lBQUcsQ0FBQztJQUVoQyxLQUFLLENBQUMsUUFBUSxDQUFDLElBQVk7UUFDekIsSUFBSTtZQUNGLE1BQU0sSUFBSSxHQUFHLElBQUksQ0FBQyxHQUFHLENBQUMsS0FBSyxDQUFDLHFCQUFxQixDQUFDLElBQUksQ0FBQyxDQUFDO1lBQ3hELElBQUksQ0FBQyxJQUFJLElBQUksQ0FBQyxDQUFDLElBQUksWUFBWSxnQkFBSyxDQUFDLEVBQUU7Z0JBQ3JDLE9BQU8sZUFBTSxDQUFDLElBQUksQ0FBQyxtQkFBbUIsSUFBSSxFQUFFLENBQUMsQ0FBQzthQUMvQztZQUVELE1BQU0sT0FBTyxHQUFHLE1BQU0sSUFBSSxDQUFDLEdBQUcsQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO1lBQ2hELE9BQU8sZUFBTSxDQUFDLEVBQUUsQ0FBQyxPQUFPLENBQUMsQ0FBQztTQUMzQjtRQUFDLE9BQU8sS0FBSyxFQUFFO1lBQ2QsT0FBTyxlQUFNLENBQUMsSUFBSSxDQUFDLHVCQUF1QixJQUFJLEtBQUssS0FBSyxDQUFDLE9BQU8sRUFBRSxDQUFDLENBQUM7U0FDckU7SUFDSCxDQUFDO0lBRUQsS0FBSyxDQUFDLFNBQVMsQ0FBQyxJQUFZLEVBQUUsT0FBZTtRQUMzQyxJQUFJO1lBQ0YsTUFBTSxJQUFJLEdBQUcsSUFBSSxDQUFDLEdBQUcsQ0FBQyxLQUFLLENBQUMscUJBQXFCLENBQUMsSUFBSSxDQUFDLENBQUM7WUFDeEQsSUFBSSxJQUFJLFlBQVksZ0JBQUssRUFBRTtnQkFDekIsTUFB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QUFDLElBQUksQ0FBQyxDQUFDO2FBQzFDO1lBQ0QsT0FBTyxlQUFNLENBQUMsRUFBRSxDQUFDLFNBQVMsQ0FBQyxDQUFDO1NBQzdCO1FBQUMsT0FBTyxLQUFLLEVBQUU7WUFDZCxPQUFPLGVBQU0sQ0FBQyxJQUFJLENBQ2hCLDhCQUE4QixJQUFJLEtBQUssS0FBSyxDQUFDLE9BQU8sRUFBRSxDQUN2RCxDQUFDO1NBQ0g7SUFDSCxDQUFDO0NBQ0Y7QUF4RkQsOERBd0ZDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIi9Vc2Vycy9raXRlbGV2L0RvY3VtZW50cy9leG9jb3J0ZXgtb2JzaWRpYW4tcGx1Z2luL3NyYy9pbmZyYXN0cnVjdHVyZS9hZGFwdGVycy9PYnNpZGlhbkZpbGVTeXN0ZW1BZGFwdGVyLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEFwcCwgVEZpbGUgfSBmcm9tIFwib2JzaWRpYW5cIjtcbmltcG9ydCB7IFJlc3VsdCB9IGZyb20gXCIuLi8uLi9kb21haW4vY29yZS9SZXN1bHRcIjtcbmltcG9ydCB7IElGaWxlU3lzdGVtQWRhcHRlciB9IGZyb20gXCIuLi8uLi9hcHBsaWNhdGlvbi9wb3J0cy9JRmlsZVN5c3RlbUFkYXB0ZXJcIjtcblxuLyoqXG4gKiBPYnNpZGlhbiBpbXBsZW1lbnRhdGlvbiBvZiBmaWxlIHN5c3RlbSBhZGFwdGVyXG4gKi9cbmV4cG9ydCBjbGFzcyBPYnNpZGlhbkZpbGVTeXN0ZW1BZGFwdGVyIGltcGxlbWVudHMgSUZpbGVTeXN0ZW1BZGFwdGVyIHtcbiAgY29uc3RydWN0b3IocHJpdmF0ZSBhcHA6IEFwcCkge31cblxuICBhc3luYyByZWFkRmlsZShwYXRoOiBzdHJpbmcpOiBQcm9taXNlPFJlc3VsdDxzdHJpbmc+PiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IGZpbGUgPSB0aGlzLmFwcC52YXVsdC5nZXRBYnN0cmFjdEZpbGVCeVBhdGgocGF0aCk7XG4gICAgICBpZiAoIWZpbGUgfHwgIShmaWxlIGluc3RhbmNlb2YgVEZpbGUpKSB7XG4gICAgICAgIHJldHVybiBSZXN1bHQuZmFpbChgRmlsZSBub3QgZm91bmQ6ICR7cGF0aH1gKTtcbiAgICAgIH1cblxuICAgICAgY29uc3QgY29udGVudCA9IGF3YWl0IHRoaXMuYXBwLnZhdWx0LnJlYWQoZmlsZSk7XG4gICAgICByZXR1cm4gUmVzdWx0Lm9rKGNvbnRlbnQpO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICByZXR1cm4gUmVzdWx0LmZhaWwoYEZhaWxlZCB0byByZWFkIGZpbGUgJHtwYXRofTogJHtlcnJvci5tZXNzYWdlfWApO1xuICAgIH1cbiAgfVxuXG4gIGFzeW5jIHdyaXRlRmlsZShwYXRoOiBzdHJpbmcsIGNvbnRlbnQ6IHN0cmluZyk6IFByb21pc2U8UmVzdWx0PHZvaWQ+PiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IGZpbGUgPSB0aGlzLmFwcC52YXVsdC5nZXRBYnN0cmFjdEZpbGVCeVBhdGgocGF0aCk7XG4gICAgICBpZiAoZmlsZSBpbnN0YW5jZW9mIFRGaWxlKSB7XG4gICAgICAgIGF3YWl0IHRoaXMuYXBwLnZhdWx0Lm1vZGlmeShmaWxlLCBjb250ZW50KTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGF3YWl0IHRoaXMuYXBwLnZhdWx0LmNyZWF0ZShwYXRoLCBjb250ZW50KTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBSZXN1bHQub2sodW5kZWZpbmVkKTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgcmV0dXJuIFJlc3VsdC5mYWlsKGBGYWlsZWQgdG8gd3JpdGUgZmlsZSAke3BhdGh9OiAke2Vycm9yLm1lc3NhZ2V9YCk7XG4gICAgfVxuICB9XG5cbiAgYXN5bmMgZmlsZUV4aXN0cyhwYXRoOiBzdHJpbmcpOiBQcm9taXNlPGJvb2xlYW4+IHtcbiAgICBjb25zdCBmaWxlID0gdGhpcy5hcHAudmF1bHQuZ2V0QWJzdHJhY3RGaWxlQnlQYXRoKHBhdGgpO1xuICAgIHJldHVybiBmaWxlIGluc3RhbmNlb2YgVEZpbGU7XG4gIH1cblxuICBhc3luYyBsaXN0RmlsZXMoXG4gICAgZGlyZWN0b3J5Pzogc3RyaW5nLFxuICAgIGV4dGVuc2lvbj86IHN0cmluZyxcbiAgKTogUHJvbWlzZTxSZXN1bHQ8VEZpbGVbXT4+IHtcbiAgICB0cnkge1xuICAgICAgbGV0IGZpbGVzID0gdGhpcy5hcHAudmF1bHQuZ2V0RmlsZXMoKTtcblxuICAgICAgaWYgKGRpcmVjdG9yeSkge1xuICAgICAgICBmaWxlcyA9IGZpbGVzLmZpbHRlcigoZmlsZSkgPT4gZmlsZS5wYXRoLnN0YXJ0c1dpdGgoZGlyZWN0b3J5KSk7XG4gICAgICB9XG5cbiAgICAgIGlmIChleHRlbnNpb24pIHtcbiAgICAgICAgZmlsZXMgPSBmaWxlcy5maWx0ZXIoKGZpbGUpID0+IGZpbGUuZXh0ZW5zaW9uID09PSBleHRlbnNpb24pO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gUmVzdWx0Lm9rKGZpbGVzKTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgcmV0dXJuIFJlc3VsdC5mYWlsKGBGYWlsZWQgdG8gbGlzdCBmaWxlczogJHtlcnJvci5tZXNzYWdlfWApO1xuICAgIH1cbiAgfVxuXG4gIGdlbmVyYXRlRmlsZU5hbWUoYmFzZU5hbWU/OiBzdHJpbmcsIGV4dGVuc2lvbj86IHN0cmluZyk6IHN0cmluZyB7XG4gICAgY29uc3QgdGltZXN0YW1wID0gbmV3IERhdGUoKS50b0lTT1N0cmluZygpLnJlcGxhY2UoL1s6Ll0vZywgXCItXCIpO1xuICAgIGNvbnN0IG5hbWUgPSBiYXNlTmFtZSB8fCBgZXhwb3J0LSR7dGltZXN0YW1wfWA7XG4gICAgcmV0dXJuIGV4dGVuc2lvbiA/IGAke25hbWV9LiR7ZXh0ZW5zaW9ufWAgOiBuYW1lO1xuICB9XG5cbiAgZGV0ZWN0Rm9ybWF0RnJvbUV4dGVuc2lvbihmaWxlTmFtZTogc3RyaW5nKTogc3RyaW5nIHtcbiAgICBjb25zdCBleHRlbnNpb24gPSBmaWxlTmFtZS5zcGxpdChcIi5cIikucG9wKCk/LnRvTG93ZXJDYXNlKCk7XG4gICAgY29uc3QgZm9ybWF0TWFwOiBSZWNvcmQ8c3RyaW5nLCBzdHJpbmc+ID0ge1xuICAgICAgdHRsOiBcInR1cnRsZVwiLFxuICAgICAgbnQ6IFwibi10cmlwbGVzXCIsXG4gICAgICBqc29ubGQ6IFwianNvbi1sZFwiLFxuICAgICAgcmRmOiBcInJkZi14bWxcIixcbiAgICAgIHhtbDogXCJyZGYteG1sXCIsXG4gICAgfTtcbiAgICByZXR1cm4gZm9ybWF0TWFwW2V4dGVuc2lvbiB8fCBcIlwiXSB8fCBcInR1cnRsZVwiO1xuICB9XG5cbiAgYXN5bmMgZW5zdXJlRGlyZWN0b3J5KHBhdGg6IHN0cmluZyk6IFByb21pc2U8UmVzdWx0PHZvaWQ+PiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IGV4aXN0cyA9IGF3YWl0IHRoaXMuYXBwLnZhdWx0LmFkYXB0ZXIuZXhpc3RzKHBhdGgpO1xuICAgICAgaWYgKCFleGlzdHMpIHtcbiAgICAgICAgYXdhaXQgdGhpcy5hcHAudmF1bHQuYWRhcHRlci5ta2RpcihwYXRoKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBSZXN1bHQub2sodW5kZWZpbmVkKTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgcmV0dXJuIFJlc3VsdC5mYWlsKFxuICAgICAgICBgRmFpbGVkIHRvIGNyZWF0ZSBkaXJlY3RvcnkgJHtwYXRofTogJHtlcnJvci5tZXNzYWdlfWAsXG4gICAgICApO1xuICAgIH1cbiAgfVxufVxuIl0sInZlcnNpb24iOjN9