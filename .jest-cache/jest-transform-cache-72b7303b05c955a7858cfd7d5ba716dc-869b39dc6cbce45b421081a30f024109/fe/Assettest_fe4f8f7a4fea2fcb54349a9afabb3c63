f405a0a7757c60b2f191137cc696bcf7
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const tslib_1 = require("tslib");
const Asset_1 = require("../../../src/domain/entities/Asset");
const AssetId_1 = require("../../../src/domain/value-objects/AssetId");
const ClassName_1 = require("../../../src/domain/value-objects/ClassName");
const OntologyPrefix_1 = require("../../../src/domain/value-objects/OntologyPrefix");
describe('Asset Entity', () => {
    describe('Construction', () => {
        it('should create an asset with valid properties', () => {
            // Given
            const label = 'Test Asset';
            const id = AssetId_1.AssetId.generate();
            const className = ClassName_1.ClassName.create('exo__Asset').getValue();
            const ontology = OntologyPrefix_1.OntologyPrefix.create('exo').getValue();
            // When
            const assetResult = Asset_1.Asset.create({
                id,
                label,
                className,
                ontology
            });
            // Then
            expect(assetResult.isSuccess).toBe(true);
            const asset = assetResult.getValue();
            expect(asset.getTitle()).toBe(label);
            expect(asset.getClassName()).toEqual(className);
            expect(asset.getOntologyPrefix()).toEqual(ontology);
            expect(asset.getId()).toBeDefined();
            expect(asset.getCreatedAt()).toBeInstanceOf(Date);
        });
        it('should fail when label is empty', () => {
            // Given
            const id = AssetId_1.AssetId.generate();
            const className = ClassName_1.ClassName.create('exo__Asset').getValue();
            const ontology = OntologyPrefix_1.OntologyPrefix.create('exo').getValue();
            // When
            const assetResult = Asset_1.Asset.create({
                id,
                label: '',
                className,
                ontology
            });
            // Then
            expect(assetResult.isFailure).toBe(true);
            expect(assetResult.error).toBe('Asset label cannot be empty');
        });
        it('should handle missing className gracefully', () => {
            // When
            const result = Asset_1.Asset.create({
                id: AssetId_1.AssetId.generate(),
                label: 'Test',
                className: null,
                ontology: OntologyPrefix_1.OntologyPrefix.create('exo').getValue()
            });
            // Then
            // Should either fail or use default, but not throw
            expect(result).toBeDefined();
        });
    });
    describe('Business Methods', () => {
        let asset;
        beforeEach(() => {
            const result = Asset_1.Asset.create({
                id: AssetId_1.AssetId.generate(),
                label: 'Test Asset',
                className: ClassName_1.ClassName.create('exo__Asset').getValue(),
                ontology: OntologyPrefix_1.OntologyPrefix.create('exo').getValue()
            });
            asset = result.getValue();
        });
        it('should update title', () => tslib_1.__awaiter(void 0, void 0, void 0, function* () {
            // Given
            const newTitle = 'Updated Title';
            const originalUpdatedAt = asset.getUpdatedAt();
            // Wait a moment to ensure time difference
            yield new Promise(resolve => setTimeout(resolve, 2));
            // When
            asset.updateTitle(newTitle);
            // Then
            expect(asset.getTitle()).toBe(newTitle);
            expect(asset.getUpdatedAt().getTime()).toBeGreaterThan(originalUpdatedAt.getTime());
        }));
        it('should set and get properties', () => {
            // When
            asset.setProperty('customProp', 'value');
            // Then
            expect(asset.getProperty('customProp')).toBe('value');
            expect(asset.getProperties().get('customProp')).toBe('value');
        });
        it('should remove properties', () => {
            // Given
            asset.setProperty('tempProp', 'value');
            // When
            asset.removeProperty('tempProp');
            // Then
            expect(asset.getProperty('tempProp')).toBeUndefined();
        });
        it('should change class', () => {
            // Given
            const newClass = ClassName_1.ClassName.create('ems__Task').getValue();
            // When
            asset.changeClass(newClass);
            // Then
            expect(asset.getClassName()).toBe(newClass);
        });
    });
    describe('Serialization', () => {
        it('should convert to frontmatter', () => {
            // Given
            const id = AssetId_1.AssetId.generate();
            const className = ClassName_1.ClassName.create('ems__Task').getValue();
            const ontology = OntologyPrefix_1.OntologyPrefix.create('ems').getValue();
            const assetResult = Asset_1.Asset.create({
                id,
                label: 'Test Asset',
                className,
                ontology,
                properties: {
                    'ems__Task_status': 'todo',
                    'ems__Task_priority': 'high'
                }
            });
            const asset = assetResult.getValue();
            // When
            const frontmatter = asset.toFrontmatter();
            // Then
            expect(frontmatter['exo__Asset_label']).toBe('Test Asset');
            expect(frontmatter['exo__Asset_isDefinedBy']).toBe('[[!ems]]');
            expect(frontmatter['exo__Instance_class']).toEqual(['[[ems__Task]]']);
            expect(frontmatter['ems__Task_status']).toBe('todo');
            expect(frontmatter['ems__Task_priority']).toBe('high');
        });
        it('should create from frontmatter', () => {
            // Given
            const frontmatter = {
                'exo__Asset_uid': 'test-id-123',
                'exo__Asset_label': 'Test Asset',
                'exo__Asset_isDefinedBy': '[[ems]]',
                'exo__Instance_class': ['[[ems__Task]]'],
                'exo__Asset_createdAt': '2024-01-01T00:00:00.000Z',
                'ems__Task_status': 'done'
            };
            // When
            const asset = Asset_1.Asset.fromFrontmatter(frontmatter, 'test.md');
            // Then
            expect(asset).not.toBeNull();
            expect(asset.getId().toString()).toBe('test-id-123');
            expect(asset.getTitle()).toBe('Test Asset');
            expect(asset.getClassName().toString()).toBe('ems__Task');
            expect(asset.getOntologyPrefix().toString()).toBe('ems');
            expect(asset.getProperty('ems__Task_status')).toBe('done');
        });
    });
});
describe('Asset Entity - FIRST Principles', () => {
    // Fast - Tests run quickly
    it('should create asset in milliseconds', () => {
        const start = Date.now();
        Asset_1.Asset.create({
            id: AssetId_1.AssetId.generate(),
            label: 'Performance Test',
            className: ClassName_1.ClassName.create('exo__Asset').getValue(),
            ontology: OntologyPrefix_1.OntologyPrefix.create('exo').getValue()
        });
        const duration = Date.now() - start;
        expect(duration).toBeLessThan(10); // Should be instant
    });
    // Independent - Tests don't depend on each other
    it('should not affect other asset instances', () => {
        const asset1Result = Asset_1.Asset.create({
            id: AssetId_1.AssetId.generate(),
            label: 'Asset 1',
            className: ClassName_1.ClassName.create('exo__Asset').getValue(),
            ontology: OntologyPrefix_1.OntologyPrefix.create('exo').getValue()
        });
        const asset1 = asset1Result.getValue();
        const asset2Result = Asset_1.Asset.create({
            id: AssetId_1.AssetId.generate(),
            label: 'Asset 2',
            className: ClassName_1.ClassName.create('exo__Asset').getValue(),
            ontology: OntologyPrefix_1.OntologyPrefix.create('exo').getValue()
        });
        const asset2 = asset2Result.getValue();
        asset1.setProperty('prop', 'value1');
        asset2.setProperty('prop', 'value2');
        expect(asset1.getProperty('prop')).toBe('value1');
        expect(asset2.getProperty('prop')).toBe('value2');
    });
    // Repeatable - Same results every run
    it('should generate consistent IDs', () => {
        const assetResult = Asset_1.Asset.create({
            id: AssetId_1.AssetId.generate(),
            label: 'Repeatable Test',
            className: ClassName_1.ClassName.create('exo__Asset').getValue(),
            ontology: OntologyPrefix_1.OntologyPrefix.create('exo').getValue()
        });
        const asset = assetResult.getValue();
        const id1 = asset.getId().toString();
        const id2 = asset.getId().toString();
        expect(id1).toBe(id2);
    });
    // Self-Validating - Clear pass/fail
    it('should clearly validate required fields', () => {
        const validAsset = () => Asset_1.Asset.create({
            id: AssetId_1.AssetId.generate(),
            label: 'Valid',
            className: ClassName_1.ClassName.create('exo__Asset').getValue(),
            ontology: OntologyPrefix_1.OntologyPrefix.create('exo').getValue()
        });
        const invalidAsset = () => Asset_1.Asset.create({
            id: AssetId_1.AssetId.generate(),
            label: '',
            className: ClassName_1.ClassName.create('exo__Asset').getValue(),
            ontology: OntologyPrefix_1.OntologyPrefix.create('exo').getValue()
        });
        expect(validAsset().isSuccess).toBe(true);
        expect(invalidAsset().isFailure).toBe(true);
    });
    // Timely - Written with the code
    it('should test current implementation', () => {
        const assetResult = Asset_1.Asset.create({
            id: AssetId_1.AssetId.generate(),
            label: 'Current Implementation',
            className: ClassName_1.ClassName.create('exo__Asset').getValue(),
            ontology: OntologyPrefix_1.OntologyPrefix.create('exo').getValue()
        });
        const asset = assetResult.getValue();
        // Tests match current implementation
        expect(asset.getTitle()).toBe('Current Implementation');
        expect(asset.getClassName()).toBeDefined();
        expect(asset.getOntologyPrefix()).toBeDefined();
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL2tpdGVsZXYvRG9jdW1lbnRzL2V4b2NvcnRleC1vYnNpZGlhbi1wbHVnaW4vdGVzdHMvZG9tYWluL2VudGl0aWVzL0Fzc2V0LnRlc3QudHMiLCJtYXBwaW5ncyI6Ijs7O0FBQUEsOERBQTJEO0FBQzNELHVFQUFvRTtBQUNwRSwyRUFBd0U7QUFDeEUscUZBQWtGO0FBRWxGLFFBQVEsQ0FBQyxjQUFjLEVBQUUsR0FBRyxFQUFFO0lBQzVCLFFBQVEsQ0FBQyxjQUFjLEVBQUUsR0FBRyxFQUFFO1FBQzVCLEVBQUUsQ0FBQyw4Q0FBOEMsRUFBRSxHQUFHLEVBQUU7WUFDdEQsUUFBUTtZQUNSLE1BQU0sS0FBSyxHQUFHLFlBQVksQ0FBQztZQUMzQixNQUFNLEVBQUUsR0FBRyxpQkFBTyxDQUFDLFFBQVEsRUFBRSxDQUFDO1lBQzlCLE1BQU0sU0FBUyxHQUFHLHFCQUFTLENBQUMsTUFBTSxDQUFDLFlBQVksQ0FBQyxDQUFDLFFBQVEsRUFBRyxDQUFDO1lBQzdELE1BQU0sUUFBUSxHQUFHLCtCQUFjLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxDQUFDLFFBQVEsRUFBRyxDQUFDO1lBRTFELE9BQU87WUFDUCxNQUFNLFdBQVcsR0FBRyxhQUFLLENBQUMsTUFBTSxDQUFDO2dCQUMvQixFQUFFO2dCQUNGLEtBQUs7Z0JBQ0wsU0FBUztnQkFDVCxRQUFRO2FBQ1QsQ0FBQyxDQUFDO1lBRUgsT0FBTztZQUNQLE1BQU0sQ0FBQyxXQUFXLENBQUMsU0FBUyxDQUFDLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO1lBQ3pDLE1BQU0sS0FBSyxHQUFHLFdBQVcsQ0FBQyxRQUFRLEVBQUcsQ0FBQztZQUN0QyxNQUFNLENBQUMsS0FBSyxDQUFDLFFBQVEsRUFBRSxDQUFDLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDO1lBQ3JDLE1BQU0sQ0FBQyxLQUFLLENBQUMsWUFBWSxFQUFFLENBQUMsQ0FBQyxPQUFPLENBQUMsU0FBUyxDQUFDLENBQUM7WUFDaEQsTUFBTSxDQUFDLEtBQUss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QUMsWUFBWSxFQUFFLENBQUMsU0FBUyxDQUFDLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO0lBQzlDLENBQUMsQ0FBQyxDQUFDO0lBRUgsaUNBQWlDO0lBQ2pDLEVBQUUsQ0FBQyxvQ0FBb0MsRUFBRSxHQUFHLEVBQUU7UUFDNUMsTUFBTSxXQUFXLEdBQUcsYUFBSyxDQUFDLE1BQU0sQ0FBQztZQUMvQixFQUFFLEVBQUUsaUJBQU8sQ0FBQyxRQUFRLEVBQUU7WUFDdEIsS0FBSyxFQUFFLHdCQUF3QjtZQUMvQixTQUFTLEVBQUUscUJBQVMsQ0FBQyxNQUFNLENBQUMsWUFBWSxDQUFDLENBQUMsUUFBUSxFQUFHO1lBQ3JELFFBQVEsRUFBRSwrQkFBYyxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsQ0FBQyxRQUFRLEVBQUc7U0FDbkQsQ0FBQyxDQUFDO1FBQ0gsTUFBTSxLQUFLLEdBQUcsV0FBVyxDQUFDLFFBQVEsRUFBRyxDQUFDO1FBRXRDLHFDQUFxQztRQUNyQyxNQUFNLENBQUMsS0FBSyxDQUFDLFFBQVEsRUFBRSxDQUFDLENBQUMsSUFBSSxDQUFDLHdCQUF3QixDQUFDLENBQUM7UUFDeEQsTUFBTSxDQUFDLEtBQUssQ0FBQyxZQUFZLEVBQUUsQ0FBQyxDQUFDLFdBQVcsRUFBRSxDQUFDO1FBQzNDLE1BQU0sQ0FBQyxLQUFLLENBQUMsaUJBQWlCLEVBQUUsQ0FBQyxDQUFDLFdBQVcsRUFBRSxDQUFDO0lBQ2xELENBQUMsQ0FBQyxDQUFDO0FBQ0wsQ0FBQyxDQUFDLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL1VzZXJzL2tpdGVsZXYvRG9jdW1lbnRzL2V4b2NvcnRleC1vYnNpZGlhbi1wbHVnaW4vdGVzdHMvZG9tYWluL2VudGl0aWVzL0Fzc2V0LnRlc3QudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQXNzZXQgfSBmcm9tICcuLi8uLi8uLi9zcmMvZG9tYWluL2VudGl0aWVzL0Fzc2V0JztcbmltcG9ydCB7IEFzc2V0SWQgfSBmcm9tICcuLi8uLi8uLi9zcmMvZG9tYWluL3ZhbHVlLW9iamVjdHMvQXNzZXRJZCc7XG5pbXBvcnQgeyBDbGFzc05hbWUgfSBmcm9tICcuLi8uLi8uLi9zcmMvZG9tYWluL3ZhbHVlLW9iamVjdHMvQ2xhc3NOYW1lJztcbmltcG9ydCB7IE9udG9sb2d5UHJlZml4IH0gZnJvbSAnLi4vLi4vLi4vc3JjL2RvbWFpbi92YWx1ZS1vYmplY3RzL09udG9sb2d5UHJlZml4JztcblxuZGVzY3JpYmUoJ0Fzc2V0IEVudGl0eScsICgpID0+IHtcbiAgZGVzY3JpYmUoJ0NvbnN0cnVjdGlvbicsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIGNyZWF0ZSBhbiBhc3NldCB3aXRoIHZhbGlkIHByb3BlcnRpZXMnLCAoKSA9PiB7XG4gICAgICAvLyBHaXZlblxuICAgICAgY29uc3QgbGFiZWwgPSAnVGVzdCBBc3NldCc7XG4gICAgICBjb25zdCBpZCA9IEFzc2V0SWQuZ2VuZXJhdGUoKTtcbiAgICAgIGNvbnN0IGNsYXNzTmFtZSA9IENsYXNzTmFtZS5jcmVhdGUoJ2V4b19fQXNzZXQnKS5nZXRWYWx1ZSgpITtcbiAgICAgIGNvbnN0IG9udG9sb2d5ID0gT250b2xvZ3lQcmVmaXguY3JlYXRlKCdleG8nKS5nZXRWYWx1ZSgpITtcbiAgICAgIFxuICAgICAgLy8gV2hlblxuICAgICAgY29uc3QgYXNzZXRSZXN1bHQgPSBBc3NldC5jcmVhdGUoe1xuICAgICAgICBpZCxcbiAgICAgICAgbGFiZWwsXG4gICAgICAgIGNsYXNzTmFtZSxcbiAgICAgICAgb250b2xvZ3lcbiAgICAgIH0pO1xuICAgICAgXG4gICAgICAvLyBUaGVuXG4gICAgICBleHBlY3QoYXNzZXRSZXN1bHQuaXNTdWNjZXNzKS50b0JlKHRydWUpO1xuICAgICAgY29uc3QgYXNzZXQgPSBhc3NldFJlc3VsdC5nZXRWYWx1ZSgpITtcbiAgICAgIGV4cGVjdChhc3NldC5nZXRUaXRsZSgpKS50b0JlKGxhYmVsKTtcbiAgICAgIGV4cGVjdChhc3NldC5nZXRDbGFzc05hbWUoKSkudG9FcXVhbChjbGFzc05hbWUpO1xuICAgICAgZXhwZWN0KGFzc2V0LmdldE9udG9sb2d5UHJlZml4KCkpLnRvRXF1YWwob250b2xvZ3kpO1xuICAgICAgZXhwZWN0KGFzc2V0LmdldElkKCkpLnRvQmVEZWZpbmVkKCk7XG4gICAgICBleHBlY3QoYXNzZXQuZ2V0Q3JlYXRlZEF0KCkpLnRvQmVJbnN0YW5jZU9mKERhdGUpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBmYWlsIHdoZW4gbGFiZWwgaXMgZW1wdHknLCAoKSA9PiB7XG4gICAgICAvLyBHaXZlblxuICAgICAgY29uc3QgaWQgPSBBc3NldElkLmdlbmVyYXRlKCk7XG4gICAgICBjb25zdCBjbGFzc05hbWUgPSBDbGFzc05hbWUuY3JlYXRlKCdleG9fX0Fzc2V0JykuZ2V0VmFsdWUoKSE7XG4gICAgICBjb25zdCBvbnRvbG9neSA9IE9udG9sb2d5UHJlZml4LmNyZWF0ZSgnZXhvJykuZ2V0VmFsdWUoKSE7XG4gICAgICBcbiAgICAgIC8vIFdoZW5cbiAgICAgIGNvbnN0IGFzc2V0UmVzdWx0ID0gQXNzZXQuY3JlYXRlKHtcbiAgICAgICAgaWQsXG4gICAgICAgIGxhYmVsOiAnJyxcbiAgICAgICAgY2xhc3NOYW1lLFxuICAgICAgICBvbnRvbG9neVxuICAgICAgfSk7XG4gICAgICBcbiAgICAgIC8vIFRoZW5cbiAgICAgIGV4cGVjdChhc3NldFJlc3VsdC5pc0ZhaWx1cmUpLnRvQmUodHJ1ZSk7XG4gICAgICBleHBlY3QoYXNzZXRSZXN1bHQuZXJyb3IpLnRvQmUoJ0Fzc2V0IGxhYmVsIGNhbm5vdCBiZSBlbXB0eScpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgbWlzc2luZyBjbGFzc05hbWUgZ3JhY2VmdWxseScsICgpID0+IHtcbiAgICAgIC8vIFdoZW5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IEFzc2V0LmNyZWF0ZSh7XG4gICAgICAgIGlkOiBBc3NldElkLmdlbmVyYXRlKCksXG4gICAgICAgIGxhYmVsOiAnVGVzdCcsXG4gICAgICAgIGNsYXNzTmFtZTogbnVsbCBhcyBhbnksXG4gICAgICAgIG9udG9sb2d5OiBPbnRvbG9neVByZWZpeC5jcmVhdGUoJ2V4bycpLmdldFZhbHVlKCkhXG4gICAgICB9KTtcbiAgICAgIFxuICAgICAgLy8gVGhlblxuICAgICAgLy8gU2hvdWxkIGVpdGhlciBmYWlsIG9yIHVzZSBkZWZhdWx0LCBidXQgbm90IHRocm93XG4gICAgICBleHBlY3QocmVzdWx0KS50b0JlRGVmaW5lZCgpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnQnVzaW5lc3MgTWV0aG9kcycsICgpID0+IHtcbiAgICBsZXQgYXNzZXQ6IEFzc2V0O1xuICAgIFxuICAgIGJlZm9yZUVhY2goKCkgPT4ge1xuICAgICAgY29uc3QgcmVzdWx0ID0gQXNzZXQuY3JlYXRlKHtcbiAgICAgICAgaWQ6IEFzc2V0SWQuZ2VuZXJhdGUoKSxcbiAgICAgICAgbGFiZWw6ICdUZXN0IEFzc2V0JyxcbiAgICAgICAgY2xhc3NOYW1lOiBDbGFzc05hbWUuY3JlYXRlKCdleG9fX0Fzc2V0JykuZ2V0VmFsdWUoKSEsXG4gICAgICAgIG9udG9sb2d5OiBPbnRvbG9neVByZWZpeC5jcmVhdGUoJ2V4bycpLmdldFZhbHVlKCkhXG4gICAgICB9KTtcbiAgICAgIGFzc2V0ID0gcmVzdWx0LmdldFZhbHVlKCkhO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCB1cGRhdGUgdGl0bGUnLCBhc3luYyAoKSA9PiB7XG4gICAgICAvLyBHaXZlblxuICAgICAgY29uc3QgbmV3VGl0bGUgPSAnVXBkYXRlZCBUaXRsZSc7XG4gICAgICBjb25zdCBvcmlnaW5hbFVwZGF0ZWRBdCA9IGFzc2V0LmdldFVwZGF0ZWRBdCgpO1xuICAgICAgXG4gICAgICAvLyBXYWl0IGEgbW9tZW50IHRvIGVuc3VyZSB0aW1lIGRpZmZlcmVuY2VcbiAgICAgIGF3YWl0IG5ldyBQcm9taXNlKHJlc29sdmUgPT4gc2V0VGltZW91dChyZXNvbHZlLCAyKSk7XG4gICAgICBcbiAgICAgIC8vIFdoZW5cbiAgICAgIGFzc2V0LnVwZGF0ZVRpdGxlKG5ld1RpdGxlKTtcbiAgICAgIFxuICAgICAgLy8gVGhlblxuICAgICAgZXhwZWN0KGFzc2V0LmdldFRpdGxlKCkpLnRvQmUobmV3VGl0bGUpO1xuICAgICAgZXhwZWN0KGFzc2V0LmdldFVwZGF0ZWRBdCgpLmdldFRpbWUoKSkudG9CZUdyZWF0ZXJUaGFuKG9yaWdpbmFsVXBkYXRlZEF0LmdldFRpbWUoKSk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHNldCBhbmQgZ2V0IHByb3BlcnRpZXMnLCAoKSA9PiB7XG4gICAgICAvLyBXaGVuXG4gICAgICBhc3NldC5zZXRQcm9wZXJ0eSgnY3VzdG9tUHJvcCcsICd2YWx1ZScpO1xuICAgICAgXG4gICAgICAvLyBUaGVuXG4gICAgICBleHBlY3QoYXNzZXQuZ2V0UHJvcGVydHkoJ2N1c3RvbVByb3AnKSkudG9CZSgndmFsdWUnKTtcbiAgICAgIGV4cGVjdChhc3NldC5nZXRQcm9wZXJ0aWVzKCkuZ2V0KCdjdXN0b21Qcm9wJykpLnRvQmUoJ3ZhbHVlJyk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHJlbW92ZSBwcm9wZXJ0aWVzJywgKCkgPT4ge1xuICAgICAgLy8gR2l2ZW5cbiAgICAgIGFzc2V0LnNldFByb3BlcnR5KCd0ZW1wUHJvcCcsICd2YWx1ZScpO1xuICAgICAgXG4gICAgICAvLyBXaGVuXG4gICAgICBhc3NldC5yZW1vdmVQcm9wZXJ0eSgndGVtcFByb3AnKTtcbiAgICAgIFxuICAgICAgLy8gVGhlblxuICAgICAgZXhwZWN0KGFzc2V0LmdldFByb3BlcnR5KCd0ZW1wUHJvcCcpKS50b0JlVW5kZWZpbmVkKCk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGNoYW5nZSBjbGFzcycsICgpID0+IHtcbiAgICAgIC8vIEdpdmVuXG4gICAgICBjb25zdCBuZXdDbGFzcyA9IENsYXNzTmFtZS5jcmVhdGUoJ2Vtc19fVGFzaycpLmdldFZhbHVlKCkhO1xuICAgICAgXG4gICAgICAvLyBXaGVuXG4gICAgICBhc3NldC5jaGFuZ2VDbGFzcyhuZXdDbGFzcyk7XG4gICAgICBcbiAgICAgIC8vIFRoZW5cbiAgICAgIGV4cGVjdChhc3NldC5nZXRDbGFzc05hbWUoKSkudG9CZShuZXdDbGFzcyk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdTZXJpYWxpemF0aW9uJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgY29udmVydCB0byBmcm9udG1hdHRlcicsICgpID0+IHtcbiAgICAgIC8vIEdpdmVuXG4gICAgICBjb25zdCBpZCA9IEFzc2V0SWQuZ2VuZXJhdGUoKTtcbiAgICAgIGNvbnN0IGNsYXNzTmFtZSA9IENsYXNzTmFtZS5jcmVhdGUoJ2Vtc19fVGFzaycpLmdldFZhbHVlKCkhO1xuICAgICAgY29uc3Qgb250b2xvZ3kgPSBPbnRvbG9neVByZWZpeC5jcmVhdGUoJ2VtcycpLmdldFZhbHVlKCkhO1xuICAgICAgXG4gICAgICBjb25zdCBhc3NldFJlc3VsdCA9IEFzc2V0LmNyZWF0ZSh7XG4gICAgICAgIGlkLFxuICAgICAgICBsYWJlbDogJ1Rlc3QgQXNzZXQnLFxuICAgICAgICBjbGFzc05hbWUsXG4gICAgICAgIG9udG9sb2d5LFxuICAgICAgICBwcm9wZXJ0aWVzOiB7XG4gICAgICAgICAgJ2Vtc19fVGFza19zdGF0dXMnOiAndG9kbycsXG4gICAgICAgICAgJ2Vtc19fVGFza19wcmlvcml0eSc6ICdoaWdoJ1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICAgIFxuICAgICAgY29uc3QgYXNzZXQgPSBhc3NldFJlc3VsdC5nZXRWYWx1ZSgpITtcbiAgICAgIFxuICAgICAgLy8gV2hlblxuICAgICAgY29uc3QgZnJvbnRtYXR0ZXIgPSBhc3NldC50b0Zyb250bWF0dGVyKCk7XG4gICAgICBcbiAgICAgIC8vIFRoZW5cbiAgICAgIGV4cGVjdChmcm9udG1hdHRlclsnZXhvX19Bc3NldF9sYWJlbCddKS50b0JlKCdUZXN0IEFzc2V0Jyk7XG4gICAgICBleHBlY3QoZnJvbnRtYXR0ZXJbJ2V4b19fQXNzZXRfaXNEZWZpbmVkQnknXSkudG9CZSgnW1shZW1zXV0nKTtcbiAgICAgIGV4cGVjdChmcm9udG1hdHRlclsnZXhvX19JbnN0YW5jZV9jbGFzcyddKS50b0VxdWFsKFsnW1tlbXNfX1Rhc2tdXSddKTtcbiAgICAgIGV4cGVjdChmcm9udG1hdHRlclsnZW1zX19UYXNrX3N0YXR1cyddKS50b0JlKCd0b2RvJyk7XG4gICAgICBleHBlY3QoZnJvbnRtYXR0ZXJbJ2Vtc19fVGFza19wcmlvcml0eSddKS50b0JlKCdoaWdoJyk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGNyZWF0ZSBmcm9tIGZyb250bWF0dGVyJywgKCkgPT4ge1xuICAgICAgLy8gR2l2ZW5cbiAgICAgIGNvbnN0IGZyb250bWF0dGVyID0ge1xuICAgICAgICAnZXhvX19Bc3NldF91aWQnOiAndGVzdC1pZC0xMjMnLFxuICAgICAgICAnZXhvX19Bc3NldF9sYWJlbCc6ICdUZXN0IEFzc2V0JyxcbiAgICAgICAgJ2V4b19fQXNzZXRfaXNEZWZpbmVkQnknOiAnW1tlbXNdXScsXG4gICAgICAgICdleG9fX0luc3RhbmNlX2NsYXNzJzogWydbW2Vtc19fVGFza11dJ10sXG4gICAgICAgICdleG9fX0Fzc2V0X2NyZWF0ZWRBdCc6ICcyMDI0LTAxLTAxVDAwOjAwOjAwLjAwMFonLFxuICAgICAgICAnZW1zX19UYXNrX3N0YXR1cyc6ICdkb25lJ1xuICAgICAgfTtcbiAgICAgIFxuICAgICAgLy8gV2hlblxuICAgICAgY29uc3QgYXNzZXQgPSBBc3NldC5mcm9tRnJvbnRtYXR0ZXIoZnJvbnRtYXR0ZXIsICd0ZXN0Lm1kJyk7XG4gICAgICBcbiAgICAgIC8vIFRoZW5cbiAgICAgIGV4cGVjdChhc3NldCkubm90LnRvQmVOdWxsKCk7XG4gICAgICBleHBlY3QoYXNzZXQhLmdldElkKCkudG9TdHJpbmcoKSkudG9CZSgndGVzdC1pZC0xMjMnKTtcbiAgICAgIGV4cGVjdChhc3NldCEuZ2V0VGl0bGUoKSkudG9CZSgnVGVzdCBBc3NldCcpO1xuICAgICAgZXhwZWN0KGFzc2V0IS5nZXRDbGFzc05hbWUoKS50b1N0cmluZygpKS50b0JlKCdlbXNfX1Rhc2snKTtcbiAgICAgIGV4cGVjdChhc3NldCEuZ2V0T250b2xvZ3lQcmVmaXgoKS50b1N0cmluZygpKS50b0JlKCdlbXMnKTtcbiAgICAgIGV4cGVjdChhc3NldCEuZ2V0UHJvcGVydHkoJ2Vtc19fVGFza19zdGF0dXMnKSkudG9CZSgnZG9uZScpO1xuICAgIH0pO1xuICB9KTtcbn0pO1xuXG5kZXNjcmliZSgnQXNzZXQgRW50aXR5IC0gRklSU1QgUHJpbmNpcGxlcycsICgpID0+IHtcbiAgLy8gRmFzdCAtIFRlc3RzIHJ1biBxdWlja2x5XG4gIGl0KCdzaG91bGQgY3JlYXRlIGFzc2V0IGluIG1pbGxpc2Vjb25kcycsICgpID0+IHtcbiAgICBjb25zdCBzdGFydCA9IERhdGUubm93KCk7XG4gICAgXG4gICAgQXNzZXQuY3JlYXRlKHtcbiAgICAgIGlkOiBBc3NldElkLmdlbmVyYXRlKCksXG4gICAgICBsYWJlbDogJ1BlcmZvcm1hbmNlIFRlc3QnLFxuICAgICAgY2xhc3NOYW1lOiBDbGFzc05hbWUuY3JlYXRlKCdleG9fX0Fzc2V0JykuZ2V0VmFsdWUoKSEsXG4gICAgICBvbnRvbG9neTogT250b2xvZ3lQcmVmaXguY3JlYXRlKCdleG8nKS5nZXRWYWx1ZSgpIVxuICAgIH0pO1xuICAgIFxuICAgIGNvbnN0IGR1cmF0aW9uID0gRGF0ZS5ub3coKSAtIHN0YXJ0O1xuICAgIGV4cGVjdChkdXJhdGlvbikudG9CZUxlc3NUaGFuKDEwKTsgLy8gU2hvdWxkIGJlIGluc3RhbnRcbiAgfSk7XG5cbiAgLy8gSW5kZXBlbmRlbnQgLSBUZXN0cyBkb24ndCBkZXBlbmQgb24gZWFjaCBvdGhlclxuICBpdCgnc2hvdWxkIG5vdCBhZmZlY3Qgb3RoZXIgYXNzZXQgaW5zdGFuY2VzJywgKCkgPT4ge1xuICAgIGNvbnN0IGFzc2V0MVJlc3VsdCA9IEFzc2V0LmNyZWF0ZSh7XG4gICAgICBpZDogQXNzZXRJZC5nZW5lcmF0ZSgpLFxuICAgICAgbGFiZWw6ICdBc3NldCAxJyxcbiAgICAgIGNsYXNzTmFtZTogQ2xhc3NOYW1lLmNyZWF0ZSgnZXhvX19Bc3NldCcpLmdldFZhbHVlKCkhLFxuICAgICAgb250b2xvZ3k6IE9udG9sb2d5UHJlZml4LmNyZWF0ZSgnZXhvJykuZ2V0VmFsdWUoKSFcbiAgICB9KTtcbiAgICBjb25zdCBhc3NldDEgPSBhc3NldDFSZXN1bHQuZ2V0VmFsdWUoKSE7XG4gICAgXG4gICAgY29uc3QgYXNzZXQyUmVzdWx0ID0gQXNzZXQuY3JlYXRlKHtcbiAgICAgIGlkOiBBc3NldElkLmdlbmVyYXRlKCksXG4gICAgICBsYWJlbDogJ0Fzc2V0IDInLFxuICAgICAgY2xhc3NOYW1lOiBDbGFzc05hbWUuY3JlYXRlKCdleG9fX0Fzc2V0JykuZ2V0VmFsdWUoKSEsXG4gICAgICBvbnRvbG9neTogT250b2xvZ3lQcmVmaXguY3JlYXRlKCdleG8nKS5nZXRWYWx1ZSgpIVxuICAgIH0pO1xuICAgIGNvbnN0IGFzc2V0MiA9IGFzc2V0MlJlc3VsdC5nZXRWYWx1ZSgpITtcbiAgICBcbiAgICBhc3NldDEuc2V0UHJvcGVydHkoJ3Byb3AnLCAndmFsdWUxJyk7XG4gICAgYXNzZXQyLnNldFByb3BlcnR5KCdwcm9wJywgJ3ZhbHVlMicpO1xuICAgIFxuICAgIGV4cGVjdChhc3NldDEuZ2V0UHJvcGVydHkoJ3Byb3AnKSkudG9CZSgndmFsdWUxJyk7XG4gICAgZXhwZWN0KGFzc2V0Mi5nZXRQcm9wZXJ0eSgncHJvcCcpKS50b0JlKCd2YWx1ZTInKTtcbiAgfSk7XG5cbiAgLy8gUmVwZWF0YWJsZSAtIFNhbWUgcmVzdWx0cyBldmVyeSBydW5cbiAgaXQoJ3Nob3VsZCBnZW5lcmF0ZSBjb25zaXN0ZW50IElEcycsICgpID0+IHtcbiAgICBjb25zdCBhc3NldFJlc3VsdCA9IEFzc2V0LmNyZWF0ZSh7XG4gICAgICBpZDogQXNzZXRJZC5nZW5lcmF0ZSgpLFxuICAgICAgbGFiZWw6ICdSZXBlYXRhYmxlIFRlc3QnLFxuICAgICAgY2xhc3NOYW1lOiBDbGFzc05hbWUuY3JlYXRlKCdleG9fX0Fzc2V0JykuZ2V0VmFsdWUoKSEsXG4gICAgICBvbnRvbG9neTogT250b2xvZ3lQcmVmaXguY3JlYXRlKCdleG8nKS5nZXRWYWx1ZSgpIVxuICAgIH0pO1xuICAgIGNvbnN0IGFzc2V0ID0gYXNzZXRSZXN1bHQuZ2V0VmFsdWUoKSE7XG4gICAgXG4gICAgY29uc3QgaWQxID0gYXNzZXQuZ2V0SWQoKS50b1N0cmluZygpO1xuICAgIGNvbnN0IGlkMiA9IGFzc2V0LmdldElkKCkudG9TdHJpbmcoKTtcbiAgICBcbiAgICBleHBlY3QoaWQxKS50b0JlKGlkMik7XG4gIH0pO1xuXG4gIC8vIFNlbGYtVmFsaWRhdGluZyAtIENsZWFyIHBhc3MvZmFpbFxuICBpdCgnc2hvdWxkIGNsZWFybHkgdmFsaWRhdGUgcmVxdWlyZWQgZmllbGRzJywgKCkgPT4ge1xuICAgIGNvbnN0IHZhbGlkQXNzZXQgPSAoKSA9PiBBc3NldC5jcmVhdGUoe1xuICAgICAgaWQ6IEFzc2V0SWQuZ2VuZXJhdGUoKSxcbiAgICAgIGxhYmVsOiAnVmFsaWQnLFxuICAgICAgY2xhc3NOYW1lOiBDbGFzc05hbWUuY3JlYXRlKCdleG9fX0Fzc2V0JykuZ2V0VmFsdWUoKSEsXG4gICAgICBvbnRvbG9neTogT250b2xvZ3lQcmVmaXguY3JlYXRlKCdleG8nKS5nZXRWYWx1ZSgpIVxuICAgIH0pO1xuICAgIFxuICAgIGNvbnN0IGludmFsaWRBc3NldCA9ICgpID0+IEFzc2V0LmNyZWF0ZSh7XG4gICAgICBpZDogQXNzZXRJZC5nZW5lcmF0ZSgpLFxuICAgICAgbGFiZWw6ICcnLFxuICAgICAgY2xhc3NOYW1lOiBDbGFzc05hbWUuY3JlYXRlKCdleG9fX0Fzc2V0JykuZ2V0VmFsdWUoKSEsXG4gICAgICBvbnRvbG9neTogT250b2xvZ3lQcmVmaXguY3JlYXRlKCdleG8nKS5nZXRWYWx1ZSgpIVxuICAgIH0pO1xuICAgIFxuICAgIGV4cGVjdCh2YWxpZEFzc2V0KCkuaXNTdWNjZXNzKS50b0JlKHRydWUpO1xuICAgIGV4cGVjdChpbnZhbGlkQXNzZXQoKS5pc0ZhaWx1cmUpLnRvQmUodHJ1ZSk7XG4gIH0pO1xuXG4gIC8vIFRpbWVseSAtIFdyaXR0ZW4gd2l0aCB0aGUgY29kZVxuICBpdCgnc2hvdWxkIHRlc3QgY3VycmVudCBpbXBsZW1lbnRhdGlvbicsICgpID0+IHtcbiAgICBjb25zdCBhc3NldFJlc3VsdCA9IEFzc2V0LmNyZWF0ZSh7XG4gICAgICBpZDogQXNzZXRJZC5nZW5lcmF0ZSgpLFxuICAgICAgbGFiZWw6ICdDdXJyZW50IEltcGxlbWVudGF0aW9uJyxcbiAgICAgIGNsYXNzTmFtZTogQ2xhc3NOYW1lLmNyZWF0ZSgnZXhvX19Bc3NldCcpLmdldFZhbHVlKCkhLFxuICAgICAgb250b2xvZ3k6IE9udG9sb2d5UHJlZml4LmNyZWF0ZSgnZXhvJykuZ2V0VmFsdWUoKSFcbiAgICB9KTtcbiAgICBjb25zdCBhc3NldCA9IGFzc2V0UmVzdWx0LmdldFZhbHVlKCkhO1xuICAgIFxuICAgIC8vIFRlc3RzIG1hdGNoIGN1cnJlbnQgaW1wbGVtZW50YXRpb25cbiAgICBleHBlY3QoYXNzZXQuZ2V0VGl0bGUoKSkudG9CZSgnQ3VycmVudCBJbXBsZW1lbnRhdGlvbicpO1xuICAgIGV4cGVjdChhc3NldC5nZXRDbGFzc05hbWUoKSkudG9CZURlZmluZWQoKTtcbiAgICBleHBlY3QoYXNzZXQuZ2V0T250b2xvZ3lQcmVmaXgoKSkudG9CZURlZmluZWQoKTtcbiAgfSk7XG59KTsiXSwidmVyc2lvbiI6M30=