a5058955dce55b030e245b9c235ca5f8
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.ExocortexSettings = exports.DEFAULT_SETTINGS = void 0;
const Result_1 = require("../core/Result");
/**
 * Default settings for the Exocortex plugin
 */
exports.DEFAULT_SETTINGS = {
    // Folder Paths
    layoutsFolderPath: "layouts",
    templatesFolderPath: ".exocortex/templates",
    templateUsageDataPath: ".exocortex/template-usage.json",
    // Query Engine Settings
    preferredQueryEngine: "dataview",
    fallbackQueryEngine: "datacore",
    enableQueryEngineAutoDetect: true,
    // Cache Settings
    enableSPARQLCache: true,
    sparqlCacheMaxSize: 500,
    sparqlCacheTTLMinutes: 5,
    enableQueryCache: true,
    queryCacheTimeout: 30,
    queryCacheMaxSize: 100,
    // RDF Export Settings
    defaultRDFFormat: "turtle",
    includeInferredTriples: false,
    exportNamespaces: true,
    // Performance Settings
    maxGraphSize: 10000,
    batchProcessingSize: 50,
    enableLazyLoading: true,
    // Mobile/Platform Settings
    enableMobileOptimizations: true,
    mobileBatchSize: 10,
    enableTouchControls: true,
    // Debug Settings
    enableDebugMode: false,
    enableVerboseLogging: false,
    logSPARQLQueries: false,
    enablePerformanceMetrics: false,
};
/**
 * Exocortex Settings Entity
 * Manages plugin configuration with validation
 */
class ExocortexSettings {
    constructor(data = {}) {
        this.data = { ...exports.DEFAULT_SETTINGS, ...data };
    }
    /**
     * Create settings from partial data with validation
     */
    static create(data = {}) {
        try {
            const settings = new ExocortexSettings(data);
            const validation = settings.validate();
            if (validation.isFailure) {
                return Result_1.Result.fail(validation.getError());
            }
            return Result_1.Result.ok(settings);
        }
        catch (error) {
            return Result_1.Result.fail(`Failed to create settings: ${error.message}`);
        }
    }
    /**
     * Validate all settings
     */
    validate() {
        // Validate folder paths
        if (!this.data.layoutsFolderPath ||
            this.data.layoutsFolderPath.trim().length === 0) {
            return Result_1.Result.fail("Layouts folder path cannot be empty");
        }
        if (!this.data.templatesFolderPath ||
            this.data.templatesFolderPath.trim().length === 0) {
            return Result_1.Result.fail("Templates folder path cannot be empty");
        }
        // Validate cache settings
        if (this.data.sparqlCacheMaxSize < 1) {
            return Result_1.Result.fail("SPARQL cache max size must be at least 1");
        }
        if (this.data.sparqlCacheTTLMinutes < 1) {
            return Result_1.Result.fail("SPARQL cache TTL must be at least 1 minute");
        }
        if (this.data.queryCacheMaxSize < 1) {
            return Result_1.Result.fail("Query cache max size must be at least 1");
        }
        if (this.data.queryCacheTimeout < 1) {
            return Result_1.Result.fail("Query cache timeout must be at least 1 minute");
        }
        // Validate performance settings
        if (this.data.maxGraphSize < 100) {
            return Result_1.Result.fail("Max graph size must be at least 100");
        }
        if (this.data.batchProcessingSize < 1) {
            return Result_1.Result.fail("Batch processing size must be at least 1");
        }
        if (this.data.mobileBatchSize < 1) {
            return Result_1.Result.fail("Mobile batch size must be at least 1");
        }
        return Result_1.Result.ok();
    }
    /**
     * Get all settings data
     */
    getData() {
        return { ...this.data };
    }
    /**
     * Update settings with partial data
     */
    update(updates) {
        const newData = { ...this.data, ...updates };
        const tempSettings = new ExocortexSettings(newData);
        const validation = tempSettings.validate();
        if (validation.isFailure) {
            return Result_1.Result.fail(validation.getError());
        }
        this.data = newData;
        return Result_1.Result.ok();
    }
    /**
     * Get specific setting value with type safety
     */
    get(key) {
        return this.data[key];
    }
    /**
     * Set specific setting value with validation
     */
    set(key, value) {
        const updates = { [key]: value };
        return this.update(updates);
    }
    /**
     * Reset all settings to defaults
     */
    resetToDefaults() {
        this.data = { ...exports.DEFAULT_SETTINGS };
    }
    /**
     * Convert to JSON for persistence
     */
    toJSON() {
        return this.getData();
    }
    /**
     * Create from JSON data
     */
    static fromJSON(json) {
        try {
            const data = JSON.parse(json);
            return ExocortexSettings.create(data);
        }
        catch (error) {
            return Result_1.Result.fail(`Failed to parse settings JSON: ${error.message}`);
        }
    }
}
exports.ExocortexSettings = ExocortexSettings;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL2tpdGVsZXYvRG9jdW1lbnRzL2V4b2NvcnRleC1vYnNpZGlhbi1wbHVnaW4vc3JjL2RvbWFpbi9lbnRpdGllcy9FeG9jb3J0ZXhTZXR0aW5ncy50cyIsIm1hcHBpbmdzIjoiOzs7QUFBQSwyQ0FBd0M7QUFnRHhDOztHQUVHO0FBQ1UsUUFBQSxnQkFBZ0IsR0FBMEI7SUFDckQsZUFBZTtJQUNmLGlCQUFpQixFQUFFLFNBQVM7SUFDNUIsbUJBQW1CLEVBQUUsc0JBQXNCO0lBQzNDLHFCQUFxQixFQUFFLGdDQUFnQztJQUV2RCx3QkFBd0I7SUFDeEIsb0JBQW9CLEVBQUUsVUFBVTtJQUNoQyxtQkFBbUIsRUFBRSxVQUFVO0lBQy9CLDJCQUEyQixFQUFFLElBQUk7SUFFakMsaUJBQWlCO0lBQ2pCLGlCQUFpQixFQUFFLElBQUk7SUFDdkIsa0JBQWtCLEVBQUUsR0FBRztJQUN2QixxQkFBcUIsRUFBRSxDQUFDO0lBQ3hCLGdCQUFnQixFQUFFLElBQUk7SUFDdEIsaUJBQWlCLEVBQUUsRUFBRTtJQUNyQixpQkFBaUIsRUFBRSxHQUFHO0lBRXRCLHNCQUFzQjtJQUN0QixnQkFBZ0IsRUFBRSxRQUFRO0lBQzFCLHNCQUFzQixFQUFFLEtBQUs7SUFDN0IsZ0JBQWdCLEVBQUUsSUFBSTtJQUV0Qix1QkFBdUI7SUFDdkIsWUFBWSxFQUFFLEtBQUs7SUFDbkIsbUJBQW1CLEVBQUUsRUFBRTtJQUN2QixpQkFBaUIsRUFBRSxJQUFJO0lBRXZCLDJCQUEyQjtJQUMzQix5QkFBeUIsRUFBRSxJQUFJO0lBQy9CLGVBQWUsRUFBRSxFQUFFO0lBQ25CLG1CQUFtQixFQUFFLElBQUk7SUFFekIsaUJBQWlCO0lBQ2pCLGVBQWUsRUFBRSxLQUFLO0lBQ3RCLG9CQUFvQixFQUFFLEtBQUs7SUFDM0IsZ0JBQWdCLEVBQUUsS0FBSztJQUN2Qix3QkFBd0IsRUFBRSxLQUFLO0NBQ2hDLENBQUM7QUFFRjs7O0dBR0c7QUFDSCxNQUFhLGlCQUFpQjtJQUc1QixZQUFZLE9BQXVDLEVBQUU7UUFDbkQsSUFBSSxD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RTtZQUNkLE9BQU8sZUFBTSxDQUFDLElBQUksQ0FDaEIsa0NBQWtDLEtBQUssQ0FBQyxPQUFPLEVBQUUsQ0FDbEQsQ0FBQztTQUNIO0lBQ0gsQ0FBQztDQUNGO0FBdkpELDhDQXVKQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyIvVXNlcnMva2l0ZWxldi9Eb2N1bWVudHMvZXhvY29ydGV4LW9ic2lkaWFuLXBsdWdpbi9zcmMvZG9tYWluL2VudGl0aWVzL0V4b2NvcnRleFNldHRpbmdzLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFJlc3VsdCB9IGZyb20gXCIuLi9jb3JlL1Jlc3VsdFwiO1xuaW1wb3J0IHsgUXVlcnlFbmdpbmVUeXBlIH0gZnJvbSBcIi4uL3BvcnRzL0lRdWVyeUVuZ2luZVwiO1xuXG4vKipcbiAqIEV4b2NvcnRleCBQbHVnaW4gU2V0dGluZ3MgSW50ZXJmYWNlXG4gKiBDb250YWlucyBhbGwgdXNlci1jb25maWd1cmFibGUgcGx1Z2luIHNldHRpbmdzXG4gKi9cbmV4cG9ydCBpbnRlcmZhY2UgRXhvY29ydGV4U2V0dGluZ3NEYXRhIHtcbiAgLy8gRm9sZGVyIFBhdGhzXG4gIGxheW91dHNGb2xkZXJQYXRoOiBzdHJpbmc7XG4gIHRlbXBsYXRlc0ZvbGRlclBhdGg6IHN0cmluZztcbiAgdGVtcGxhdGVVc2FnZURhdGFQYXRoOiBzdHJpbmc7XG5cbiAgLy8gUXVlcnkgRW5naW5lIFNldHRpbmdzXG4gIHByZWZlcnJlZFF1ZXJ5RW5naW5lOiBRdWVyeUVuZ2luZVR5cGU7XG4gIGZhbGxiYWNrUXVlcnlFbmdpbmU6IFF1ZXJ5RW5naW5lVHlwZTtcbiAgZW5hYmxlUXVlcnlFbmdpbmVBdXRvRGV0ZWN0OiBib29sZWFuO1xuXG4gIC8vIENhY2hlIFNldHRpbmdzXG4gIGVuYWJsZVNQQVJRTENhY2hlOiBib29sZWFuO1xuICBzcGFycWxDYWNoZU1heFNpemU6IG51bWJlcjtcbiAgc3BhcnFsQ2FjaGVUVExNaW51dGVzOiBudW1iZXI7XG4gIGVuYWJsZVF1ZXJ5Q2FjaGU6IGJvb2xlYW47XG4gIHF1ZXJ5Q2FjaGVUaW1lb3V0OiBudW1iZXI7XG4gIHF1ZXJ5Q2FjaGVNYXhTaXplOiBudW1iZXI7XG5cbiAgLy8gUkRGIEV4cG9ydCBTZXR0aW5nc1xuICBkZWZhdWx0UkRGRm9ybWF0OiBcInR1cnRsZVwiIHwgXCJyZGYteG1sXCIgfCBcIm4tdHJpcGxlc1wiIHwgXCJqc29uLWxkXCI7XG4gIGluY2x1ZGVJbmZlcnJlZFRyaXBsZXM6IGJvb2xlYW47XG4gIGV4cG9ydE5hbWVzcGFjZXM6IGJvb2xlYW47XG5cbiAgLy8gUGVyZm9ybWFuY2UgU2V0dGluZ3NcbiAgbWF4R3JhcGhTaXplOiBudW1iZXI7XG4gIGJhdGNoUHJvY2Vzc2luZ1NpemU6IG51bWJlcjtcbiAgZW5hYmxlTGF6eUxvYWRpbmc6IGJvb2xlYW47XG5cbiAgLy8gTW9iaWxlL1BsYXRmb3JtIFNldHRpbmdzXG4gIGVuYWJsZU1vYmlsZU9wdGltaXphdGlvbnM6IGJvb2xlYW47XG4gIG1vYmlsZUJhdGNoU2l6ZTogbnVtYmVyO1xuICBlbmFibGVUb3VjaENvbnRyb2xzOiBib29sZWFuO1xuXG4gIC8vIERlYnVnIFNldHRpbmdzXG4gIGVuYWJsZURlYnVnTW9kZTogYm9vbGVhbjtcbiAgZW5hYmxlVmVyYm9zZUxvZ2dpbmc6IGJvb2xlYW47XG4gIGxvZ1NQQVJRTFF1ZXJpZXM6IGJvb2xlYW47XG4gIGVuYWJsZVBlcmZvcm1hbmNlTWV0cmljczogYm9vbGVhbjtcbn1cblxuLyoqXG4gKiBEZWZhdWx0IHNldHRpbmdzIGZvciB0aGUgRXhvY29ydGV4IHBsdWdpblxuICovXG5leHBvcnQgY29uc3QgREVGQVVMVF9TRVRUSU5HUzogRXhvY29ydGV4U2V0dGluZ3NEYXRhID0ge1xuICAvLyBGb2xkZXIgUGF0aHNcbiAgbGF5b3V0c0ZvbGRlclBhdGg6IFwibGF5b3V0c1wiLFxuICB0ZW1wbGF0ZXNGb2xkZXJQYXRoOiBcIi5leG9jb3J0ZXgvdGVtcGxhdGVzXCIsXG4gIHRlbXBsYXRlVXNhZ2VEYXRhUGF0aDogXCIuZXhvY29ydGV4L3RlbXBsYXRlLXVzYWdlLmpzb25cIixcblxuICAvLyBRdWVyeSBFbmdpbmUgU2V0dGluZ3NcbiAgcHJlZmVycmVkUXVlcnlFbmdpbmU6IFwiZGF0YXZpZXdcIixcbiAgZmFsbGJhY2tRdWVyeUVuZ2luZTogXCJkYXRhY29yZVwiLFxuICBlbmFibGVRdWVyeUVuZ2luZUF1dG9EZXRlY3Q6IHRydWUsXG5cbiAgLy8gQ2FjaGUgU2V0dGluZ3NcbiAgZW5hYmxlU1BBUlFMQ2FjaGU6IHRydWUsXG4gIHNwYXJxbENhY2hlTWF4U2l6ZTogNTAwLFxuICBzcGFycWxDYWNoZVRUTE1pbnV0ZXM6IDUsXG4gIGVuYWJsZVF1ZXJ5Q2FjaGU6IHRydWUsXG4gIHF1ZXJ5Q2FjaGVUaW1lb3V0OiAzMCxcbiAgcXVlcnlDYWNoZU1heFNpemU6IDEwMCxcblxuICAvLyBSREYgRXhwb3J0IFNldHRpbmdzXG4gIGRlZmF1bHRSREZGb3JtYXQ6IFwidHVydGxlXCIsXG4gIGluY2x1ZGVJbmZlcnJlZFRyaXBsZXM6IGZhbHNlLFxuICBleHBvcnROYW1lc3BhY2VzOiB0cnVlLFxuXG4gIC8vIFBlcmZvcm1hbmNlIFNldHRpbmdzXG4gIG1heEdyYXBoU2l6ZTogMTAwMDAsXG4gIGJhdGNoUHJvY2Vzc2luZ1NpemU6IDUwLFxuICBlbmFibGVMYXp5TG9hZGluZzogdHJ1ZSxcblxuICAvLyBNb2JpbGUvUGxhdGZvcm0gU2V0dGluZ3NcbiAgZW5hYmxlTW9iaWxlT3B0aW1pemF0aW9uczogdHJ1ZSxcbiAgbW9iaWxlQmF0Y2hTaXplOiAxMCxcbiAgZW5hYmxlVG91Y2hDb250cm9sczogdHJ1ZSxcblxuICAvLyBEZWJ1ZyBTZXR0aW5nc1xuICBlbmFibGVEZWJ1Z01vZGU6IGZhbHNlLFxuICBlbmFibGVWZXJib3NlTG9nZ2luZzogZmFsc2UsXG4gIGxvZ1NQQVJRTFF1ZXJpZXM6IGZhbHNlLFxuICBlbmFibGVQZXJmb3JtYW5jZU1ldHJpY3M6IGZhbHNlLFxufTtcblxuLyoqXG4gKiBFeG9jb3J0ZXggU2V0dGluZ3MgRW50aXR5XG4gKiBNYW5hZ2VzIHBsdWdpbiBjb25maWd1cmF0aW9uIHdpdGggdmFsaWRhdGlvblxuICovXG5leHBvcnQgY2xhc3MgRXhvY29ydGV4U2V0dGluZ3Mge1xuICBwcml2YXRlIGRhdGE6IEV4b2NvcnRleFNldHRpbmdzRGF0YTtcblxuICBjb25zdHJ1Y3RvcihkYXRhOiBQYXJ0aWFsPEV4b2NvcnRleFNldHRpbmdzRGF0YT4gPSB7fSkge1xuICAgIHRoaXMuZGF0YSA9IHsgLi4uREVGQVVMVF9TRVRUSU5HUywgLi4uZGF0YSB9O1xuICB9XG5cbiAgLyoqXG4gICAqIENyZWF0ZSBzZXR0aW5ncyBmcm9tIHBhcnRpYWwgZGF0YSB3aXRoIHZhbGlkYXRpb25cbiAgICovXG4gIHB1YmxpYyBzdGF0aWMgY3JlYXRlKFxuICAgIGRhdGE6IFBhcnRpYWw8RXhvY29ydGV4U2V0dGluZ3NEYXRhPiA9IHt9LFxuICApOiBSZXN1bHQ8RXhvY29ydGV4U2V0dGluZ3M+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3Qgc2V0dGluZ3MgPSBuZXcgRXhvY29ydGV4U2V0dGluZ3MoZGF0YSk7XG4gICAgICBjb25zdCB2YWxpZGF0aW9uID0gc2V0dGluZ3MudmFsaWRhdGUoKTtcblxuICAgICAgaWYgKHZhbGlkYXRpb24uaXNGYWlsdXJlKSB7XG4gICAgICAgIHJldHVybiBSZXN1bHQuZmFpbDxFeG9jb3J0ZXhTZXR0aW5ncz4odmFsaWRhdGlvbi5nZXRFcnJvcigpKTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIFJlc3VsdC5vazxFeG9jb3J0ZXhTZXR0aW5ncz4oc2V0dGluZ3MpO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICByZXR1cm4gUmVzdWx0LmZhaWw8RXhvY29ydGV4U2V0dGluZ3M+KFxuICAgICAgICBgRmFpbGVkIHRvIGNyZWF0ZSBzZXR0aW5nczogJHtlcnJvci5tZXNzYWdlfWAsXG4gICAgICApO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBWYWxpZGF0ZSBhbGwgc2V0dGluZ3NcbiAgICovXG4gIHB1YmxpYyB2YWxpZGF0ZSgpOiBSZXN1bHQ8dm9pZD4ge1xuICAgIC8vIFZhbGlkYXRlIGZvbGRlciBwYXRoc1xuICAgIGlmIChcbiAgICAgICF0aGlzLmRhdGEubGF5b3V0c0ZvbGRlclBhdGggfHxcbiAgICAgIHRoaXMuZGF0YS5sYXlvdXRzRm9sZGVyUGF0aC50cmltKCkubGVuZ3RoID09PSAwXG4gICAgKSB7XG4gICAgICByZXR1cm4gUmVzdWx0LmZhaWw8dm9pZD4oXCJMYXlvdXRzIGZvbGRlciBwYXRoIGNhbm5vdCBiZSBlbXB0eVwiKTtcbiAgICB9XG5cbiAgICBpZiAoXG4gICAgICAhdGhpcy5kYXRhLnRlbXBsYXRlc0ZvbGRlclBhdGggfHxcbiAgICAgIHRoaXMuZGF0YS50ZW1wbGF0ZXNGb2xkZXJQYXRoLnRyaW0oKS5sZW5ndGggPT09IDBcbiAgICApIHtcbiAgICAgIHJldHVybiBSZXN1bHQuZmFpbDx2b2lkPihcIlRlbXBsYXRlcyBmb2xkZXIgcGF0aCBjYW5ub3QgYmUgZW1wdHlcIik7XG4gICAgfVxuXG4gICAgLy8gVmFsaWRhdGUgY2FjaGUgc2V0dGluZ3NcbiAgICBpZiAodGhpcy5kYXRhLnNwYXJxbENhY2hlTWF4U2l6ZSA8IDEpIHtcbiAgICAgIHJldHVybiBSZXN1bHQuZmFpbDx2b2lkPihcIlNQQVJRTCBjYWNoZSBtYXggc2l6ZSBtdXN0IGJlIGF0IGxlYXN0IDFcIik7XG4gICAgfVxuXG4gICAgaWYgKHRoaXMuZGF0YS5zcGFycWxDYWNoZVRUTE1pbnV0ZXMgPCAxKSB7XG4gICAgICByZXR1cm4gUmVzdWx0LmZhaWw8dm9pZD4oXCJTUEFSUUwgY2FjaGUgVFRMIG11c3QgYmUgYXQgbGVhc3QgMSBtaW51dGVcIik7XG4gICAgfVxuXG4gICAgaWYgKHRoaXMuZGF0YS5xdWVyeUNhY2hlTWF4U2l6ZSA8IDEpIHtcbiAgICAgIHJldHVybiBSZXN1bHQuZmFpbDx2b2lkPihcIlF1ZXJ5IGNhY2hlIG1heCBzaXplIG11c3QgYmUgYXQgbGVhc3QgMVwiKTtcbiAgICB9XG5cbiAgICBpZiAodGhpcy5kYXRhLnF1ZXJ5Q2FjaGVUaW1lb3V0IDwgMSkge1xuICAgICAgcmV0dXJuIFJlc3VsdC5mYWlsPHZvaWQ+KFwiUXVlcnkgY2FjaGUgdGltZW91dCBtdXN0IGJlIGF0IGxlYXN0IDEgbWludXRlXCIpO1xuICAgIH1cblxuICAgIC8vIFZhbGlkYXRlIHBlcmZvcm1hbmNlIHNldHRpbmdzXG4gICAgaWYgKHRoaXMuZGF0YS5tYXhHcmFwaFNpemUgPCAxMDApIHtcbiAgICAgIHJldHVybiBSZXN1bHQuZmFpbDx2b2lkPihcIk1heCBncmFwaCBzaXplIG11c3QgYmUgYXQgbGVhc3QgMTAwXCIpO1xuICAgIH1cblxuICAgIGlmICh0aGlzLmRhdGEuYmF0Y2hQcm9jZXNzaW5nU2l6ZSA8IDEpIHtcbiAgICAgIHJldHVybiBSZXN1bHQuZmFpbDx2b2lkPihcIkJhdGNoIHByb2Nlc3Npbmcgc2l6ZSBtdXN0IGJlIGF0IGxlYXN0IDFcIik7XG4gICAgfVxuXG4gICAgaWYgKHRoaXMuZGF0YS5tb2JpbGVCYXRjaFNpemUgPCAxKSB7XG4gICAgICByZXR1cm4gUmVzdWx0LmZhaWw8dm9pZD4oXCJNb2JpbGUgYmF0Y2ggc2l6ZSBtdXN0IGJlIGF0IGxlYXN0IDFcIik7XG4gICAgfVxuXG4gICAgcmV0dXJuIFJlc3VsdC5vazx2b2lkPigpO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldCBhbGwgc2V0dGluZ3MgZGF0YVxuICAgKi9cbiAgcHVibGljIGdldERhdGEoKTogRXhvY29ydGV4U2V0dGluZ3NEYXRhIHtcbiAgICByZXR1cm4geyAuLi50aGlzLmRhdGEgfTtcbiAgfVxuXG4gIC8qKlxuICAgKiBVcGRhdGUgc2V0dGluZ3Mgd2l0aCBwYXJ0aWFsIGRhdGFcbiAgICovXG4gIHB1YmxpYyB1cGRhdGUodXBkYXRlczogUGFydGlhbDxFeG9jb3J0ZXhTZXR0aW5nc0RhdGE+KTogUmVzdWx0PHZvaWQ+IHtcbiAgICBjb25zdCBuZXdEYXRhID0geyAuLi50aGlzLmRhdGEsIC4uLnVwZGF0ZXMgfTtcbiAgICBjb25zdCB0ZW1wU2V0dGluZ3MgPSBuZXcgRXhvY29ydGV4U2V0dGluZ3MobmV3RGF0YSk7XG4gICAgY29uc3QgdmFsaWRhdGlvbiA9IHRlbXBTZXR0aW5ncy52YWxpZGF0ZSgpO1xuXG4gICAgaWYgKHZhbGlkYXRpb24uaXNGYWlsdXJlKSB7XG4gICAgICByZXR1cm4gUmVzdWx0LmZhaWw8dm9pZD4odmFsaWRhdGlvbi5nZXRFcnJvcigpKTtcbiAgICB9XG5cbiAgICB0aGlzLmRhdGEgPSBuZXdEYXRhO1xuICAgIHJldHVybiBSZXN1bHQub2s8dm9pZD4oKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgc3BlY2lmaWMgc2V0dGluZyB2YWx1ZSB3aXRoIHR5cGUgc2FmZXR5XG4gICAqL1xuICBwdWJsaWMgZ2V0PEsgZXh0ZW5kcyBrZXlvZiBFeG9jb3J0ZXhTZXR0aW5nc0RhdGE+KFxuICAgIGtleTogSyxcbiAgKTogRXhvY29ydGV4U2V0dGluZ3NEYXRhW0tdIHtcbiAgICByZXR1cm4gdGhpcy5kYXRhW2tleV07XG4gIH1cblxuICAvKipcbiAgICogU2V0IHNwZWNpZmljIHNldHRpbmcgdmFsdWUgd2l0aCB2YWxpZGF0aW9uXG4gICAqL1xuICBwdWJsaWMgc2V0PEsgZXh0ZW5kcyBrZXlvZiBFeG9jb3J0ZXhTZXR0aW5nc0RhdGE+KFxuICAgIGtleTogSyxcbiAgICB2YWx1ZTogRXhvY29ydGV4U2V0dGluZ3NEYXRhW0tdLFxuICApOiBSZXN1bHQ8dm9pZD4ge1xuICAgIGNvbnN0IHVwZGF0ZXMgPSB7IFtrZXldOiB2YWx1ZSB9IGFzIFBhcnRpYWw8RXhvY29ydGV4U2V0dGluZ3NEYXRhPjtcbiAgICByZXR1cm4gdGhpcy51cGRhdGUodXBkYXRlcyk7XG4gIH1cblxuICAvKipcbiAgICogUmVzZXQgYWxsIHNldHRpbmdzIHRvIGRlZmF1bHRzXG4gICAqL1xuICBwdWJsaWMgcmVzZXRUb0RlZmF1bHRzKCk6IHZvaWQge1xuICAgIHRoaXMuZGF0YSA9IHsgLi4uREVGQVVMVF9TRVRUSU5HUyB9O1xuICB9XG5cbiAgLyoqXG4gICAqIENvbnZlcnQgdG8gSlNPTiBmb3IgcGVyc2lzdGVuY2VcbiAgICovXG4gIHB1YmxpYyB0b0pTT04oKTogRXhvY29ydGV4U2V0dGluZ3NEYXRhIHtcbiAgICByZXR1cm4gdGhpcy5nZXREYXRhKCk7XG4gIH1cblxuICAvKipcbiAgICogQ3JlYXRlIGZyb20gSlNPTiBkYXRhXG4gICAqL1xuICBwdWJsaWMgc3RhdGljIGZyb21KU09OKGpzb246IHN0cmluZyk6IFJlc3VsdDxFeG9jb3J0ZXhTZXR0aW5ncz4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBkYXRhID0gSlNPTi5wYXJzZShqc29uKTtcbiAgICAgIHJldHVybiBFeG9jb3J0ZXhTZXR0aW5ncy5jcmVhdGUoZGF0YSk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIHJldHVybiBSZXN1bHQuZmFpbDxFeG9jb3J0ZXhTZXR0aW5ncz4oXG4gICAgICAgIGBGYWlsZWQgdG8gcGFyc2Ugc2V0dGluZ3MgSlNPTjogJHtlcnJvci5tZXNzYWdlfWAsXG4gICAgICApO1xuICAgIH1cbiAgfVxufVxuIl0sInZlcnNpb24iOjN9