3ea45e74578b9528f0b31c25a881bb7a
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.ExecuteButtonCommandUseCase = void 0;
const Result_1 = require("../../domain/core/Result");
const AssetId_1 = require("../../domain/value-objects/AssetId");
class ExecuteButtonCommandUseCase {
    constructor(buttonRepository, commandExecutor) {
        this.buttonRepository = buttonRepository;
        this.commandExecutor = commandExecutor;
    }
    async execute(request) {
        // Validate request
        if (!request.buttonId) {
            return Result_1.Result.fail("Button ID is required");
        }
        // Parse button ID
        const buttonIdResult = AssetId_1.AssetId.create(request.buttonId);
        if (buttonIdResult.isFailure) {
            return Result_1.Result.fail("Invalid button ID");
        }
        const buttonId = buttonIdResult.getValue();
        // Find the button
        const buttonResult = await this.buttonRepository.findButtonById(buttonId);
        if (buttonResult.isFailure) {
            return Result_1.Result.fail(`Failed to load button: ${buttonResult.error}`);
        }
        const button = buttonResult.getValue();
        if (!button) {
            return Result_1.Result.fail("Button not found");
        }
        // Check if button can be executed
        if (!button.canExecute()) {
            return Result_1.Result.fail("Button is disabled");
        }
        // Load the command
        const commandResult = await this.buttonRepository.findCommandById(button.commandId);
        if (commandResult.isFailure) {
            return Result_1.Result.fail(`Failed to load command: ${commandResult.error}`);
        }
        const command = commandResult.getValue();
        if (!command) {
            return Result_1.Result.fail("Command not found");
        }
        // Check if command requires input but none provided
        if (command.requiresInput && !request.inputParameters) {
            // Return schema for input collection
            return Result_1.Result.ok({
                success: false,
                requiresInput: true,
                inputSchema: {
                    title: command.name,
                    description: command.description,
                    parameters: command.parameters,
                },
            });
        }
        // Validate and prepare execution context
        const contextResult = command.buildExecutionContext(request.inputParameters || {});
        if (contextResult.isFailure) {
            return Result_1.Result.fail(`Invalid parameters: ${contextResult.error}`);
        }
        const executionContext = contextResult.getValue();
        // Execute the command through the command executor service
        try {
            const executionResult = await this.commandExecutor.execute({
                command: command,
                context: {
                    ...executionContext,
                    assetId: request.assetId,
                    currentView: request.context?.currentView,
                    currentClass: request.context?.currentClass,
                    selection: request.context?.selection,
                },
            });
            if (executionResult.isFailure) {
                return Result_1.Result.fail(`Command execution failed: ${executionResult.error}`);
            }
            const result = executionResult.getValue();
            // Record button click event
            button.click();
            return Result_1.Result.ok({
                success: true,
                message: `Command '${command.name}' executed successfully`,
                result: result,
            });
        }
        catch (error) {
            return Result_1.Result.fail(`Unexpected error during command execution: ${error.message}`);
        }
    }
}
exports.ExecuteButtonCommandUseCase = ExecuteButtonCommandUseCase;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL2tpdGVsZXYvRG9jdW1lbnRzL2V4b2NvcnRleC1vYnNpZGlhbi1wbHVnaW4vc3JjL2FwcGxpY2F0aW9uL3VzZS1jYXNlcy9FeGVjdXRlQnV0dG9uQ29tbWFuZFVzZUNhc2UudHMiLCJtYXBwaW5ncyI6Ijs7O0FBQ0EscURBQWtEO0FBR2xELGdFQUE2RDtBQXlCN0QsTUFBYSwyQkFBMkI7SUFHdEMsWUFDVSxnQkFBbUMsRUFDbkMsZUFBaUM7UUFEakMscUJBQWdCLEdBQWhCLGdCQUFnQixDQUFtQjtRQUNuQyxvQkFBZSxHQUFmLGVBQWUsQ0FBa0I7SUFDeEMsQ0FBQztJQUVKLEtBQUssQ0FBQyxPQUFPLENBQ1gsT0FBb0M7UUFFcEMsbUJBQW1CO1FBQ25CLElBQUksQ0FBQyxPQUFPLENBQUMsUUFBUSxFQUFFO1lBQ3JCLE9BQU8sZUFBTSxDQUFDLElBQUksQ0FBK0IsdUJBQXVCLENBQUMsQ0FBQztTQUMzRTtRQUVELGtCQUFrQjtRQUNsQixNQUFNLGNBQWMsR0FBRyxpQkFBTyxDQUFDLE1BQU0sQ0FBQyxPQUFPLENBQUMsUUFBUSxDQUFDLENBQUM7UUFDeEQsSUFBSSxjQUFjLENBQUMsU0FBUyxFQUFFO1lBQzVCLE9BQU8sZUFBTSxDQUFDLElBQUksQ0FBK0IsbUJBQW1CLENBQUMsQ0FBQztTQUN2RTtRQUNELE1BQU0sUUFBUSxHQUFHLGNBQWMsQ0FBQyxRQUFRLEVBQUUsQ0FBQztRQUUzQyxrQkFBa0I7UUFDbEIsTUFBTSxZQUFZLEdBQUcsTUFBTSxJQUFJLENBQUMsZ0JBQWdCLENBQUMsY0FBYyxDQUFDLFFBQVEsQ0FBQyxDQUFDO1FBQzFFLElBQUksWUFBWSxDQUFDLFNBQVMsRUFBRTtZQUMxQixPQUFPLGVBQU0sQ0FBQyxJQUFJLENBQ2hCLDBCQUEwQixZQUFZLENBQUMsS0FBSyxFQUFFLENBQy9DLENBQUM7U0FDSDtRQUVELE1BQU0sTUFBTSxHQUFHLFlBQVksQ0FBQyxRQUFRLEVBQUUsQ0FBQztRQUN2QyxJQUFJLENBQUMsTUFBTSxFQUFFO1lBQ1gsT0FBTyxlQUFN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dXJjZXMiOlsiL1VzZXJzL2tpdGVsZXYvRG9jdW1lbnRzL2V4b2NvcnRleC1vYnNpZGlhbi1wbHVnaW4vc3JjL2FwcGxpY2F0aW9uL3VzZS1jYXNlcy9FeGVjdXRlQnV0dG9uQ29tbWFuZFVzZUNhc2UudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgVXNlQ2FzZSB9IGZyb20gXCIuLi9jb3JlL1VzZUNhc2VcIjtcbmltcG9ydCB7IFJlc3VsdCB9IGZyb20gXCIuLi8uLi9kb21haW4vY29yZS9SZXN1bHRcIjtcbmltcG9ydCB7IElCdXR0b25SZXBvc2l0b3J5IH0gZnJvbSBcIi4uLy4uL2RvbWFpbi9yZXBvc2l0b3JpZXMvSUJ1dHRvblJlcG9zaXRvcnlcIjtcbmltcG9ydCB7IElDb21tYW5kRXhlY3V0b3IgfSBmcm9tIFwiLi4vc2VydmljZXMvSUNvbW1hbmRFeGVjdXRvclwiO1xuaW1wb3J0IHsgQXNzZXRJZCB9IGZyb20gXCIuLi8uLi9kb21haW4vdmFsdWUtb2JqZWN0cy9Bc3NldElkXCI7XG5pbXBvcnQgeyBDb21tYW5kVHlwZSB9IGZyb20gXCIuLi8uLi9kb21haW4vZW50aXRpZXMvQnV0dG9uQ29tbWFuZFwiO1xuXG4vKipcbiAqIFVzZSBDYXNlIGZvciBleGVjdXRpbmcgYSBidXR0b24gY29tbWFuZFxuICovXG5leHBvcnQgaW50ZXJmYWNlIEV4ZWN1dGVCdXR0b25Db21tYW5kUmVxdWVzdCB7XG4gIGJ1dHRvbklkOiBzdHJpbmc7XG4gIGFzc2V0SWQ/OiBzdHJpbmc7XG4gIGlucHV0UGFyYW1ldGVycz86IFJlY29yZDxzdHJpbmcsIGFueT47XG4gIGNvbnRleHQ/OiB7XG4gICAgY3VycmVudFZpZXc/OiBzdHJpbmc7XG4gICAgY3VycmVudENsYXNzPzogc3RyaW5nO1xuICAgIHNlbGVjdGlvbj86IHN0cmluZ1tdO1xuICB9O1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIEV4ZWN1dGVCdXR0b25Db21tYW5kUmVzcG9uc2Uge1xuICBzdWNjZXNzOiBib29sZWFuO1xuICBtZXNzYWdlPzogc3RyaW5nO1xuICByZXN1bHQ/OiBhbnk7XG4gIHJlcXVpcmVzSW5wdXQ/OiBib29sZWFuO1xuICBpbnB1dFNjaGVtYT86IGFueTtcbn1cblxuZXhwb3J0IGNsYXNzIEV4ZWN1dGVCdXR0b25Db21tYW5kVXNlQ2FzZVxuICBpbXBsZW1lbnRzIFVzZUNhc2U8RXhlY3V0ZUJ1dHRvbkNvbW1hbmRSZXF1ZXN0LCBFeGVjdXRlQnV0dG9uQ29tbWFuZFJlc3BvbnNlPlxue1xuICBjb25zdHJ1Y3RvcihcbiAgICBwcml2YXRlIGJ1dHRvblJlcG9zaXRvcnk6IElCdXR0b25SZXBvc2l0b3J5LFxuICAgIHByaXZhdGUgY29tbWFuZEV4ZWN1dG9yOiBJQ29tbWFuZEV4ZWN1dG9yLFxuICApIHt9XG5cbiAgYXN5bmMgZXhlY3V0ZShcbiAgICByZXF1ZXN0OiBFeGVjdXRlQnV0dG9uQ29tbWFuZFJlcXVlc3QsXG4gICk6IFByb21pc2U8UmVzdWx0PEV4ZWN1dGVCdXR0b25Db21tYW5kUmVzcG9uc2U+PiB7XG4gICAgLy8gVmFsaWRhdGUgcmVxdWVzdFxuICAgIGlmICghcmVxdWVzdC5idXR0b25JZCkge1xuICAgICAgcmV0dXJuIFJlc3VsdC5mYWlsPEV4ZWN1dGVCdXR0b25Db21tYW5kUmVzcG9uc2U+KFwiQnV0dG9uIElEIGlzIHJlcXVpcmVkXCIpO1xuICAgIH1cblxuICAgIC8vIFBhcnNlIGJ1dHRvbiBJRFxuICAgIGNvbnN0IGJ1dHRvbklkUmVzdWx0ID0gQXNzZXRJZC5jcmVhdGUocmVxdWVzdC5idXR0b25JZCk7XG4gICAgaWYgKGJ1dHRvbklkUmVzdWx0LmlzRmFpbHVyZSkge1xuICAgICAgcmV0dXJuIFJlc3VsdC5mYWlsPEV4ZWN1dGVCdXR0b25Db21tYW5kUmVzcG9uc2U+KFwiSW52YWxpZCBidXR0b24gSURcIik7XG4gICAgfVxuICAgIGNvbnN0IGJ1dHRvbklkID0gYnV0dG9uSWRSZXN1bHQuZ2V0VmFsdWUoKTtcblxuICAgIC8vIEZpbmQgdGhlIGJ1dHRvblxuICAgIGNvbnN0IGJ1dHRvblJlc3VsdCA9IGF3YWl0IHRoaXMuYnV0dG9uUmVwb3NpdG9yeS5maW5kQnV0dG9uQnlJZChidXR0b25JZCk7XG4gICAgaWYgKGJ1dHRvblJlc3VsdC5pc0ZhaWx1cmUpIHtcbiAgICAgIHJldHVybiBSZXN1bHQuZmFpbDxFeGVjdXRlQnV0dG9uQ29tbWFuZFJlc3BvbnNlPihcbiAgICAgICAgYEZhaWxlZCB0byBsb2FkIGJ1dHRvbjogJHtidXR0b25SZXN1bHQuZXJyb3J9YCxcbiAgICAgICk7XG4gICAgfVxuXG4gICAgY29uc3QgYnV0dG9uID0gYnV0dG9uUmVzdWx0LmdldFZhbHVlKCk7XG4gICAgaWYgKCFidXR0b24pIHtcbiAgICAgIHJldHVybiBSZXN1bHQuZmFpbDxFeGVjdXRlQnV0dG9uQ29tbWFuZFJlc3BvbnNlPihcIkJ1dHRvbiBub3QgZm91bmRcIik7XG4gICAgfVxuXG4gICAgLy8gQ2hlY2sgaWYgYnV0dG9uIGNhbiBiZSBleGVjdXRlZFxuICAgIGlmICghYnV0dG9uLmNhbkV4ZWN1dGUoKSkge1xuICAgICAgcmV0dXJuIFJlc3VsdC5mYWlsPEV4ZWN1dGVCdXR0b25Db21tYW5kUmVzcG9uc2U+KFwiQnV0dG9uIGlzIGRpc2FibGVkXCIpO1xuICAgIH1cblxuICAgIC8vIExvYWQgdGhlIGNvbW1hbmRcbiAgICBjb25zdCBjb21tYW5kUmVzdWx0ID0gYXdhaXQgdGhpcy5idXR0b25SZXBvc2l0b3J5LmZpbmRDb21tYW5kQnlJZChcbiAgICAgIGJ1dHRvbi5jb21tYW5kSWQsXG4gICAgKTtcbiAgICBpZiAoY29tbWFuZFJlc3VsdC5pc0ZhaWx1cmUpIHtcbiAgICAgIHJldHVybiBSZXN1bHQuZmFpbDxFeGVjdXRlQnV0dG9uQ29tbWFuZFJlc3BvbnNlPihcbiAgICAgICAgYEZhaWxlZCB0byBsb2FkIGNvbW1hbmQ6ICR7Y29tbWFuZFJlc3VsdC5lcnJvcn1gLFxuICAgICAgKTtcbiAgICB9XG5cbiAgICBjb25zdCBjb21tYW5kID0gY29tbWFuZFJlc3VsdC5nZXRWYWx1ZSgpO1xuICAgIGlmICghY29tbWFuZCkge1xuICAgICAgcmV0dXJuIFJlc3VsdC5mYWlsPEV4ZWN1dGVCdXR0b25Db21tYW5kUmVzcG9uc2U+KFwiQ29tbWFuZCBub3QgZm91bmRcIik7XG4gICAgfVxuXG4gICAgLy8gQ2hlY2sgaWYgY29tbWFuZCByZXF1aXJlcyBpbnB1dCBidXQgbm9uZSBwcm92aWRlZFxuICAgIGlmIChjb21tYW5kLnJlcXVpcmVzSW5wdXQgJiYgIXJlcXVlc3QuaW5wdXRQYXJhbWV0ZXJzKSB7XG4gICAgICAvLyBSZXR1cm4gc2NoZW1hIGZvciBpbnB1dCBjb2xsZWN0aW9uXG4gICAgICByZXR1cm4gUmVzdWx0Lm9rPEV4ZWN1dGVCdXR0b25Db21tYW5kUmVzcG9uc2U+KHtcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgIHJlcXVpcmVzSW5wdXQ6IHRydWUsXG4gICAgICAgIGlucHV0U2NoZW1hOiB7XG4gICAgICAgICAgdGl0bGU6IGNvbW1hbmQubmFtZSxcbiAgICAgICAgICBkZXNjcmlwdGlvbjogY29tbWFuZC5kZXNjcmlwdGlvbixcbiAgICAgICAgICBwYXJhbWV0ZXJzOiBjb21tYW5kLnBhcmFtZXRlcnMsXG4gICAgICAgIH0sXG4gICAgICB9KTtcbiAgICB9XG5cbiAgICAvLyBWYWxpZGF0ZSBhbmQgcHJlcGFyZSBleGVjdXRpb24gY29udGV4dFxuICAgIGNvbnN0IGNvbnRleHRSZXN1bHQgPSBjb21tYW5kLmJ1aWxkRXhlY3V0aW9uQ29udGV4dChcbiAgICAgIHJlcXVlc3QuaW5wdXRQYXJhbWV0ZXJzIHx8IHt9LFxuICAgICk7XG5cbiAgICBpZiAoY29udGV4dFJlc3VsdC5pc0ZhaWx1cmUpIHtcbiAgICAgIHJldHVybiBSZXN1bHQuZmFpbDxFeGVjdXRlQnV0dG9uQ29tbWFuZFJlc3BvbnNlPihcbiAgICAgICAgYEludmFsaWQgcGFyYW1ldGVyczogJHtjb250ZXh0UmVzdWx0LmVycm9yfWAsXG4gICAgICApO1xuICAgIH1cblxuICAgIGNvbnN0IGV4ZWN1dGlvbkNvbnRleHQgPSBjb250ZXh0UmVzdWx0LmdldFZhbHVlKCk7XG5cbiAgICAvLyBFeGVjdXRlIHRoZSBjb21tYW5kIHRocm91Z2ggdGhlIGNvbW1hbmQgZXhlY3V0b3Igc2VydmljZVxuICAgIHRyeSB7XG4gICAgICBjb25zdCBleGVjdXRpb25SZXN1bHQgPSBhd2FpdCB0aGlzLmNvbW1hbmRFeGVjdXRvci5leGVjdXRlKHtcbiAgICAgICAgY29tbWFuZDogY29tbWFuZCxcbiAgICAgICAgY29udGV4dDoge1xuICAgICAgICAgIC4uLmV4ZWN1dGlvbkNvbnRleHQsXG4gICAgICAgICAgYXNzZXRJZDogcmVxdWVzdC5hc3NldElkLFxuICAgICAgICAgIGN1cnJlbnRWaWV3OiByZXF1ZXN0LmNvbnRleHQ/LmN1cnJlbnRWaWV3LFxuICAgICAgICAgIGN1cnJlbnRDbGFzczogcmVxdWVzdC5jb250ZXh0Py5jdXJyZW50Q2xhc3MsXG4gICAgICAgICAgc2VsZWN0aW9uOiByZXF1ZXN0LmNvbnRleHQ/LnNlbGVjdGlvbixcbiAgICAgICAgfSxcbiAgICAgIH0pO1xuXG4gICAgICBpZiAoZXhlY3V0aW9uUmVzdWx0LmlzRmFpbHVyZSkge1xuICAgICAgICByZXR1cm4gUmVzdWx0LmZhaWw8RXhlY3V0ZUJ1dHRvbkNvbW1hbmRSZXNwb25zZT4oXG4gICAgICAgICAgYENvbW1hbmQgZXhlY3V0aW9uIGZhaWxlZDogJHtleGVjdXRpb25SZXN1bHQuZXJyb3J9YCxcbiAgICAgICAgKTtcbiAgICAgIH1cblxuICAgICAgY29uc3QgcmVzdWx0ID0gZXhlY3V0aW9uUmVzdWx0LmdldFZhbHVlKCk7XG5cbiAgICAgIC8vIFJlY29yZCBidXR0b24gY2xpY2sgZXZlbnRcbiAgICAgIGJ1dHRvbi5jbGljaygpO1xuXG4gICAgICByZXR1cm4gUmVzdWx0Lm9rPEV4ZWN1dGVCdXR0b25Db21tYW5kUmVzcG9uc2U+KHtcbiAgICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgICAgbWVzc2FnZTogYENvbW1hbmQgJyR7Y29tbWFuZC5uYW1lfScgZXhlY3V0ZWQgc3VjY2Vzc2Z1bGx5YCxcbiAgICAgICAgcmVzdWx0OiByZXN1bHQsXG4gICAgICB9KTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgcmV0dXJuIFJlc3VsdC5mYWlsPEV4ZWN1dGVCdXR0b25Db21tYW5kUmVzcG9uc2U+KFxuICAgICAgICBgVW5leHBlY3RlZCBlcnJvciBkdXJpbmcgY29tbWFuZCBleGVjdXRpb246ICR7ZXJyb3IubWVzc2FnZX1gLFxuICAgICAgKTtcbiAgICB9XG4gIH1cbn1cbiJdLCJ2ZXJzaW9uIjozfQ==