60a1353bae34a8f52a957f798b11034a
"use strict";
/**
 * RDF Service - Coordinates RDF operations using specialized services
 * Follows Single Responsibility Principle by delegating to specific services
 */
Object.defineProperty(exports, "__esModule", { value: true });
exports.RDFService = void 0;
const Graph_1 = require("../../domain/semantic/core/Graph");
const Triple_1 = require("../../domain/semantic/core/Triple");
const Result_1 = require("../../domain/core/Result");
const RDFSerializer_1 = require("./RDFSerializer");
const RDFParser_1 = require("./RDFParser");
const NamespaceManager_1 = require("./NamespaceManager");
const RDFValidator_1 = require("./RDFValidator");
const MemoryOptimizedImporter_1 = require("../../infrastructure/performance/MemoryOptimizedImporter");
const IndexedGraph_1 = require("../../domain/semantic/core/IndexedGraph");
class RDFService {
    constructor(notificationService, fileSystemAdapter, namespaceManager) {
        this.notificationService = notificationService;
        this.fileSystemAdapter = fileSystemAdapter;
        this.namespaceManager = namespaceManager || new NamespaceManager_1.NamespaceManager();
        this.serializer = new RDFSerializer_1.RDFSerializer(this.namespaceManager);
        this.parser = new RDFParser_1.RDFParser(this.namespaceManager);
        this.validator = new RDFValidator_1.RDFValidator();
        this.optimizedImporter = new MemoryOptimizedImporter_1.MemoryOptimizedImporter();
    }
    /**
     * Export graph to RDF format
     */
    async exportGraph(graph, options) {
        try {
            const validationResult = this.validator.validateExportOptions(options);
            if (validationResult.isFailure) {
                return Result_1.Result.fail(validationResult.errorValue());
            }
            const serializationOptions = {
                format: options.format,
                includeComments: options.includeComments ?? true,
                prettyPrint: options.prettyPrint ?? true,
                baseIRI: options.baseIRI,
                namespaceManager: this.namespaceManager,
            };
            const result = this.serializer.serialize(graph, serializationOptions);
            if (result.isFailure) {
                return result;
            }
            const serializedData = result.getValue();
            if (options.saveToVault) {
                const fileName = this.fileSystemAdapter.generateFileName(options.fileName, this.getFormatInfo(options.format).extension.slice(1));
                const filePath = options.targetFolder
                    ? `${options.targetFolder}/${fileName}`
                    : fileName;
                const saveResult = await this.fileSystemAdapter.writeFile(filePath, serializedData.content);
                if (saveResult.isFailure) {
                    return Result_1.Result.fail(saveResult.errorValue());
                }
                this.notificationService.showSuccess(`Exported ${serializedData.tripleCount} triples to ${filePath}`);
            }
            return result;
        }
        catch (error) {
            return Result_1.Result.fail(`Export failed: ${error.message}`);
        }
    }
    /**
     * Import RDF data and merge with existing graph
     */
    async importRDF(content, graph, options) {
        try {
            const validationResult = this.validator.validateImportOptions(options);
            if (validationResult.isFailure) {
                return Result_1.Result.fail(validationResult.errorValue());
            }
            const parseOptions = {
                format: options.format,
                baseIRI: options.baseIRI,
                namespaceManager: this.namespaceManager,
                validateInput: options.validateInput ?? true,
                strictMode: options.strictMode ?? false,
            };
            const parseResult = this.parser.parse(content, parseOptions);
            if (parseResult.isFailure) {
                return Result_1.Result.fail(`Import parsing failed: ${parseResult.errorValue()}`);
            }
            const imported = parseResult.getValue();
            if (options.validateInput) {
                const validationOptions = {
                    strictMode: options.strictMode,
                    checkDuplicates: true,
                    checkNamespaces: true,
                    checkLiterals: true,
                };
                const graphValidation = this.validator.validateGraph(imported.graph, validationOptions);
                if (graphValidation.isFailure) {
                    return Result_1.Result.fail(graphValidation.errorValue());
                }
                const validation = graphValidation.getValue();
                if (!validation.isValid && options.strictMode) {
                    const errorMessages = validation.errors
                        .map((e) => e.message)
                        .join("; ");
                    return Result_1.Result.fail(`Import validation failed: ${errorMessages}`);
                }
                if (validation.warnings.length > 0) {
                    this.notificationService.showWarning(`Import completed with ${validation.warnings.length} warnings`);
                }
            }
            let finalGraph;
            // Use optimized importer for large files
            const useOptimized = options.useOptimizedImporter !== false &&
                (content.length > 50000 || options.chunkSize);
            if (useOptimized && graph instanceof IndexedGraph_1.IndexedGraph) {
                // Use optimized batch processing
                if (options.mergeMode === "replace") {
                    graph.clear();
                }
                graph.beginBatch();
                for (const triple of imported.graph.toArray()) {
                    graph.add(triple);
                }
                graph.commitBatch();
                finalGraph = graph;
            }
            else {
                // Standard merge
                if (options.mergeMode === "replace") {
                    finalGraph = imported.graph;
                }
                else {
                    finalGraph = graph.clone();
                    if (finalGraph instanceof IndexedGraph_1.IndexedGraph) {
                        finalGraph.beginBatch();
                        finalGraph.merge(imported.graph);
                        finalGraph.commitBatch();
                    }
                    else {
                        finalGraph.merge(imported.graph);
                    }
                }
            }
            for (const [prefix, namespace] of Object.entries(imported.namespaces)) {
                if (!this.namespaceManager.hasPrefix(prefix)) {
                    this.namespaceManager.addBinding(prefix, namespace);
                }
            }
            return Result_1.Result.ok({ graph: finalGraph, imported });
        }
        catch (error) {
            return Result_1.Result.fail(`Import failed: ${error.message}`);
        }
    }
    /**
     * Import RDF from vault file
     */
    async importFromVaultFile(filePath, graph, options) {
        try {
            const contentResult = await this.fileSystemAdapter.readFile(filePath);
            if (contentResult.isFailure) {
                return Result_1.Result.fail(contentResult.errorValue());
            }
            if (!options.format) {
                const fileName = filePath.split("/").pop() || filePath;
                options.format = this.fileSystemAdapter.detectFormatFromExtension(fileName);
            }
            return await this.importRDF(contentResult.getValue(), graph, options);
        }
        catch (error) {
            return Result_1.Result.fail(`Failed to import from vault file: ${error.message}`);
        }
    }
    /**
     * Export SPARQL query results
     */
    async exportQueryResults(results, format, fileName, saveToVault = true) {
        try {
            const graph = this.convertQueryResultsToGraph(results);
            const options = {
                format,
                fileName: fileName || "sparql-results",
                saveToVault,
                includeComments: true,
                prettyPrint: true,
                targetFolder: "exports",
            };
            return await this.exportGraph(graph, options);
        }
        catch (error) {
            return Result_1.Result.fail(`Query results export failed: ${error.message}`);
        }
    }
    /**
     * Validate a graph
     */
    async validateGraph(graph, options) {
        return this.validator.validateGraph(graph, options);
    }
    /**
     * List RDF files in vault
     */
    async listRDFFiles(folder) {
        return this.fileSystemAdapter.listFiles(folder, "ttl");
    }
    /**
     * Convert SPARQL query results to graph
     */
    convertQueryResultsToGraph(results) {
        const graph = new Graph_1.Graph();
        for (const result of results) {
            if (result.subject && result.predicate && result.object) {
                try {
                    const subject = this.createNodeFromValue(result.subject);
                    const predicate = this.createNodeFromValue(result.predicate);
                    const object = this.createNodeFromValue(result.object);
                    if (subject && predicate && object) {
                        const triple = new Triple_1.Triple(subject, predicate, object);
                        graph.add(triple);
                    }
                }
                catch (error) {
                    console.warn("Failed to convert query result to triple:", error);
                }
            }
        }
        return graph;
    }
    /**
     * Create RDF node from query result value
     */
    createNodeFromValue(value) {
        if (typeof value === "string") {
            if (value.startsWith("_:")) {
                return new Triple_1.BlankNode(value);
            }
            else if (value.startsWith("http://") ||
                value.startsWith("https://") ||
                value.includes(":")) {
                try {
                    return new Triple_1.IRI(value);
                }
                catch {
                    return Triple_1.Literal.string(value);
                }
            }
            else {
                return Triple_1.Literal.string(value);
            }
        }
        else if (typeof value === "number") {
            return Number.isInteger(value)
                ? Triple_1.Literal.integer(value)
                : Triple_1.Literal.double(value);
        }
        else if (typeof value === "boolean") {
            return Triple_1.Literal.boolean(value);
        }
        else if (value && typeof value === "object") {
            if (value.type === "uri" || value.type === "iri") {
                return new Triple_1.IRI(value.value);
            }
            else if (value.type === "bnode") {
                return new Triple_1.BlankNode(value.value);
            }
            else if (value.type === "literal") {
                if (value.datatype) {
                    return new Triple_1.Literal(value.value, new Triple_1.IRI(value.datatype));
                }
                else if (value.lang) {
                    return new Triple_1.Literal(value.value, undefined, value.lang);
                }
                else {
                    return new Triple_1.Literal(value.value);
                }
            }
        }
        return null;
    }
    /**
     * Get namespace manager instance
     */
    getNamespaceManager() {
        return this.namespaceManager;
    }
    /**
     * Get supported export formats
     */
    getSupportedFormats() {
        return ["turtle", "n-triples", "json-ld", "rdf-xml"];
    }
    /**
     * Get format information
     */
    getFormatInfo(format) {
        const formatMap = {
            turtle: { extension: ".ttl", mimeType: "text/turtle", name: "Turtle" },
            "n-triples": {
                extension: ".nt",
                mimeType: "application/n-triples",
                name: "N-Triples",
            },
            "json-ld": {
                extension: ".jsonld",
                mimeType: "application/ld+json",
                name: "JSON-LD",
            },
            "rdf-xml": {
                extension: ".rdf",
                mimeType: "application/rdf+xml",
                name: "RDF/XML",
            },
        };
        return formatMap[format];
    }
}
exports.RDFService = RDFService;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL2tpdGVsZXYvRG9jdW1lbnRzL2V4b2NvcnRleC1vYnNpZGlhbi1wbHVnaW4vc3JjL2FwcGxpY2F0aW9uL3NlcnZpY2VzL1JERlNlcnZpY2UudHMiLCJtYXBwaW5ncyI6IjtBQUFBOzs7R0FHRzs7O0FBRUgsNERBQXlEO0FBQ3pELDhEQUsyQztBQUMzQyxxREFBa0Q7QUFDbEQsbURBS3lCO0FBQ3pCLDJDQUFtRTtBQUNuRSx5REFBc0Q7QUFDdEQsaURBQWlFO0FBR2pFLHNHQUdrRTtBQUNsRSwwRUFBdUU7QUF1QnZFLE1BQWEsVUFBVTtJQU9yQixZQUNVLG1CQUF5QyxFQUN6QyxpQkFBcUMsRUFDN0MsZ0JBQW1DO1FBRjNCLHdCQUFtQixHQUFuQixtQkFBbUIsQ0FBc0I7UUFDekMsc0JBQWlCLEdBQWpCLGlCQUFpQixDQUFvQjtRQUc3QyxJQUFJLENBQUMsZ0JBQWdCLEdBQUcsZ0JBQWdCLElBQUksSUFBSSxtQ0FBZ0IsRUFBRSxDQUFDO1FBQ25FLElBQUksQ0FBQyxVQUFVLEdBQUcsSUFBSSw2QkFBYSxDQUFDLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDO1FBQzNELElBQUksQ0FBQyxNQUFNLEdBQUcsSUFBSSxxQkFBUyxDQUFDLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDO1FBQ25ELElBQUksQ0FBQyxTQUFTLEdBQUcsSUFBSSwyQkFBWSxFQUFFLENBQUM7UUFDcEMsSUFBSSxDQUFDLGlCQUFpQixHQUFHLElBQUksaURBQXVCLEVBQUUsQ0FBQztJQUN6RCxDQUFDO0lBRUQ7O09BRUc7SUFDSCxLQUFLLENBQUMsV0FBVyxDQUNmLEtBQVksRUFDWixPQUF5QjtRQUV6QixJQUFJO1lBQ0YsTUFBTSxnQkFBZ0IsR0FBRyxJQUFJLENBQUMsU0FBUyxDQUFDLHFCQUFxQixDQUFDLE9BQU8sQ0FBQyxDQUFDO1lBQ3ZFLElBQUksZ0JBQWdCLENBQUMsU0FBUyxFQUFFO2dCQUM5QixPQUFPLGVBQU0sQ0FBQyxJQUFJLENBQXNCLGdCQUFnQixDQUFDLFVBQVUsRUFBRSxDQUFD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aWRpYW4tcGx1Z2luL3NyYy9hcHBsaWNhdGlvbi9zZXJ2aWNlcy9SREZTZXJ2aWNlLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogUkRGIFNlcnZpY2UgLSBDb29yZGluYXRlcyBSREYgb3BlcmF0aW9ucyB1c2luZyBzcGVjaWFsaXplZCBzZXJ2aWNlc1xuICogRm9sbG93cyBTaW5nbGUgUmVzcG9uc2liaWxpdHkgUHJpbmNpcGxlIGJ5IGRlbGVnYXRpbmcgdG8gc3BlY2lmaWMgc2VydmljZXNcbiAqL1xuXG5pbXBvcnQgeyBHcmFwaCB9IGZyb20gXCIuLi8uLi9kb21haW4vc2VtYW50aWMvY29yZS9HcmFwaFwiO1xuaW1wb3J0IHtcbiAgVHJpcGxlLFxuICBJUkksXG4gIEJsYW5rTm9kZSxcbiAgTGl0ZXJhbCxcbn0gZnJvbSBcIi4uLy4uL2RvbWFpbi9zZW1hbnRpYy9jb3JlL1RyaXBsZVwiO1xuaW1wb3J0IHsgUmVzdWx0IH0gZnJvbSBcIi4uLy4uL2RvbWFpbi9jb3JlL1Jlc3VsdFwiO1xuaW1wb3J0IHtcbiAgUkRGU2VyaWFsaXplcixcbiAgUkRGRm9ybWF0LFxuICBTZXJpYWxpemF0aW9uT3B0aW9ucyxcbiAgU2VyaWFsaXphdGlvblJlc3VsdCxcbn0gZnJvbSBcIi4vUkRGU2VyaWFsaXplclwiO1xuaW1wb3J0IHsgUkRGUGFyc2VyLCBQYXJzZU9wdGlvbnMsIFBhcnNlUmVzdWx0IH0gZnJvbSBcIi4vUkRGUGFyc2VyXCI7XG5pbXBvcnQgeyBOYW1lc3BhY2VNYW5hZ2VyIH0gZnJvbSBcIi4vTmFtZXNwYWNlTWFuYWdlclwiO1xuaW1wb3J0IHsgUkRGVmFsaWRhdG9yLCBWYWxpZGF0aW9uT3B0aW9ucyB9IGZyb20gXCIuL1JERlZhbGlkYXRvclwiO1xuaW1wb3J0IHsgSU5vdGlmaWNhdGlvblNlcnZpY2UgfSBmcm9tIFwiLi4vcG9ydHMvSU5vdGlmaWNhdGlvblNlcnZpY2VcIjtcbmltcG9ydCB7IElGaWxlU3lzdGVtQWRhcHRlciB9IGZyb20gXCIuLi9wb3J0cy9JRmlsZVN5c3RlbUFkYXB0ZXJcIjtcbmltcG9ydCB7XG4gIE1lbW9yeU9wdGltaXplZEltcG9ydGVyLFxuICBTdHJlYW1pbmdJbXBvcnRPcHRpb25zLFxufSBmcm9tIFwiLi4vLi4vaW5mcmFzdHJ1Y3R1cmUvcGVyZm9ybWFuY2UvTWVtb3J5T3B0aW1pemVkSW1wb3J0ZXJcIjtcbmltcG9ydCB7IEluZGV4ZWRHcmFwaCB9IGZyb20gXCIuLi8uLi9kb21haW4vc2VtYW50aWMvY29yZS9JbmRleGVkR3JhcGhcIjtcblxuZXhwb3J0IGludGVyZmFjZSBSREZFeHBvcnRPcHRpb25zIHtcbiAgZm9ybWF0OiBSREZGb3JtYXQ7XG4gIGluY2x1ZGVDb21tZW50cz86IGJvb2xlYW47XG4gIHByZXR0eVByaW50PzogYm9vbGVhbjtcbiAgYmFzZUlSST86IHN0cmluZztcbiAgZmlsZU5hbWU/OiBzdHJpbmc7XG4gIHNhdmVUb1ZhdWx0PzogYm9vbGVhbjtcbiAgdGFyZ2V0Rm9sZGVyPzogc3RyaW5nO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIFJERkltcG9ydE9wdGlvbnMgZXh0ZW5kcyBTdHJlYW1pbmdJbXBvcnRPcHRpb25zIHtcbiAgZm9ybWF0PzogUkRGRm9ybWF0O1xuICBtZXJnZU1vZGU6IFwibWVyZ2VcIiB8IFwicmVwbGFjZVwiO1xuICB2YWxpZGF0ZUlucHV0PzogYm9vbGVhbjtcbiAgc3RyaWN0TW9kZT86IGJvb2xlYW47XG4gIGJhc2VJUkk/OiBzdHJpbmc7XG4gIHVzZU9wdGltaXplZEltcG9ydGVyPzogYm9vbGVhbjtcbn1cblxuZXhwb3J0IHR5cGUgeyBWYWxpZGF0aW9uRXJyb3IgfSBmcm9tIFwiLi9SREZWYWxpZGF0b3JcIjtcblxuZXhwb3J0IGNsYXNzIFJERlNlcnZpY2Uge1xuICBwcml2YXRlIHNlcmlhbGl6ZXI6IFJERlNlcmlhbGl6ZXI7XG4gIHByaXZhdGUgcGFyc2VyOiBSREZQYXJzZXI7XG4gIHByaXZhdGUgdmFsaWRhdG9yOiBSREZWYWxpZGF0b3I7XG4gIHByaXZhdGUgb3B0aW1pemVkSW1wb3J0ZXI6IE1lbW9yeU9wdGltaXplZEltcG9ydGVyO1xuICBwcml2YXRlIG5hbWVzcGFjZU1hbmFnZXI6IE5hbWVzcGFjZU1hbmFnZXI7XG5cbiAgY29uc3RydWN0b3IoXG4gICAgcHJpdmF0ZSBub3RpZmljYXRpb25TZXJ2aWNlOiBJTm90aWZpY2F0aW9uU2VydmljZSxcbiAgICBwcml2YXRlIGZpbGVTeXN0ZW1BZGFwdGVyOiBJRmlsZVN5c3RlbUFkYXB0ZXIsXG4gICAgbmFtZXNwYWNlTWFuYWdlcj86IE5hbWVzcGFjZU1hbmFnZXIsXG4gICkge1xuICAgIHRoaXMubmFtZXNwYWNlTWFuYWdlciA9IG5hbWVzcGFjZU1hbmFnZXIgfHwgbmV3IE5hbWVzcGFjZU1hbmFnZXIoKTtcbiAgICB0aGlzLnNlcmlhbGl6ZXIgPSBuZXcgUkRGU2VyaWFsaXplcih0aGlzLm5hbWVzcGFjZU1hbmFnZXIpO1xuICAgIHRoaXMucGFyc2VyID0gbmV3IFJERlBhcnNlcih0aGlzLm5hbWVzcGFjZU1hbmFnZXIpO1xuICAgIHRoaXMudmFsaWRhdG9yID0gbmV3IFJERlZhbGlkYXRvcigpO1xuICAgIHRoaXMub3B0aW1pemVkSW1wb3J0ZXIgPSBuZXcgTWVtb3J5T3B0aW1pemVkSW1wb3J0ZXIoKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBFeHBvcnQgZ3JhcGggdG8gUkRGIGZvcm1hdFxuICAgKi9cbiAgYXN5bmMgZXhwb3J0R3JhcGgoXG4gICAgZ3JhcGg6IEdyYXBoLFxuICAgIG9wdGlvbnM6IFJERkV4cG9ydE9wdGlvbnMsXG4gICk6IFByb21pc2U8UmVzdWx0PFNlcmlhbGl6YXRpb25SZXN1bHQ+PiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHZhbGlkYXRpb25SZXN1bHQgPSB0aGlzLnZhbGlkYXRvci52YWxpZGF0ZUV4cG9ydE9wdGlvbnMob3B0aW9ucyk7XG4gICAgICBpZiAodmFsaWRhdGlvblJlc3VsdC5pc0ZhaWx1cmUpIHtcbiAgICAgICAgcmV0dXJuIFJlc3VsdC5mYWlsPFNlcmlhbGl6YXRpb25SZXN1bHQ+KHZhbGlkYXRpb25SZXN1bHQuZXJyb3JWYWx1ZSgpKTtcbiAgICAgIH1cblxuICAgICAgY29uc3Qgc2VyaWFsaXphdGlvbk9wdGlvbnM6IFNlcmlhbGl6YXRpb25PcHRpb25zID0ge1xuICAgICAgICBmb3JtYXQ6IG9wdGlvbnMuZm9ybWF0LFxuICAgICAgICBpbmNsdWRlQ29tbWVudHM6IG9wdGlvbnMuaW5jbHVkZUNvbW1lbnRzID8/IHRydWUsXG4gICAgICAgIHByZXR0eVByaW50OiBvcHRpb25zLnByZXR0eVByaW50ID8/IHRydWUsXG4gICAgICAgIGJhc2VJUkk6IG9wdGlvbnMuYmFzZUlSSSxcbiAgICAgICAgbmFtZXNwYWNlTWFuYWdlcjogdGhpcy5uYW1lc3BhY2VNYW5hZ2VyLFxuICAgICAgfTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gdGhpcy5zZXJpYWxpemVyLnNlcmlhbGl6ZShncmFwaCwgc2VyaWFsaXphdGlvbk9wdGlvbnMpO1xuICAgICAgaWYgKHJlc3VsdC5pc0ZhaWx1cmUpIHtcbiAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICAgIH1cblxuICAgICAgY29uc3Qgc2VyaWFsaXplZERhdGEgPSByZXN1bHQuZ2V0VmFsdWUoKTtcblxuICAgICAgaWYgKG9wdGlvbnMuc2F2ZVRvVmF1bHQpIHtcbiAgICAgICAgY29uc3QgZmlsZU5hbWUgPSB0aGlzLmZpbGVTeXN0ZW1BZGFwdGVyLmdlbmVyYXRlRmlsZU5hbWUoXG4gICAgICAgICAgb3B0aW9ucy5maWxlTmFtZSxcbiAgICAgICAgICB0aGlzLmdldEZvcm1hdEluZm8ob3B0aW9ucy5mb3JtYXQpLmV4dGVuc2lvbi5zbGljZSgxKSxcbiAgICAgICAgKTtcbiAgICAgICAgY29uc3QgZmlsZVBhdGggPSBvcHRpb25zLnRhcmdldEZvbGRlclxuICAgICAgICAgID8gYCR7b3B0aW9ucy50YXJnZXRGb2xkZXJ9LyR7ZmlsZU5hbWV9YFxuICAgICAgICAgIDogZmlsZU5hbWU7XG5cbiAgICAgICAgY29uc3Qgc2F2ZVJlc3VsdCA9IGF3YWl0IHRoaXMuZmlsZVN5c3RlbUFkYXB0ZXIud3JpdGVGaWxlKFxuICAgICAgICAgIGZpbGVQYXRoLFxuICAgICAgICAgIHNlcmlhbGl6ZWREYXRhLmNvbnRlbnQsXG4gICAgICAgICk7XG4gICAgICAgIGlmIChzYXZlUmVzdWx0LmlzRmFpbHVyZSkge1xuICAgICAgICAgIHJldHVybiBSZXN1bHQuZmFpbChzYXZlUmVzdWx0LmVycm9yVmFsdWUoKSk7XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLm5vdGlmaWNhdGlvblNlcnZpY2Uuc2hvd1N1Y2Nlc3MoXG4gICAgICAgICAgYEV4cG9ydGVkICR7c2VyaWFsaXplZERhdGEudHJpcGxlQ291bnR9IHRyaXBsZXMgdG8gJHtmaWxlUGF0aH1gLFxuICAgICAgICApO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gcmVzdWx0O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICByZXR1cm4gUmVzdWx0LmZhaWwoYEV4cG9ydCBmYWlsZWQ6ICR7ZXJyb3IubWVzc2FnZX1gKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogSW1wb3J0IFJERiBkYXRhIGFuZCBtZXJnZSB3aXRoIGV4aXN0aW5nIGdyYXBoXG4gICAqL1xuICBhc3luYyBpbXBvcnRSREYoXG4gICAgY29udGVudDogc3RyaW5nLFxuICAgIGdyYXBoOiBHcmFwaCxcbiAgICBvcHRpb25zOiBSREZJbXBvcnRPcHRpb25zLFxuICApOiBQcm9taXNlPFJlc3VsdDx7IGdyYXBoOiBHcmFwaDsgaW1wb3J0ZWQ6IFBhcnNlUmVzdWx0IH0+PiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHZhbGlkYXRpb25SZXN1bHQgPSB0aGlzLnZhbGlkYXRvci52YWxpZGF0ZUltcG9ydE9wdGlvbnMob3B0aW9ucyk7XG4gICAgICBpZiAodmFsaWRhdGlvblJlc3VsdC5pc0ZhaWx1cmUpIHtcbiAgICAgICAgcmV0dXJuIFJlc3VsdC5mYWlsPHsgZ3JhcGg6IEdyYXBoOyBpbXBvcnRlZDogUGFyc2VSZXN1bHQgfT4oXG4gICAgICAgICAgdmFsaWRhdGlvblJlc3VsdC5lcnJvclZhbHVlKCksXG4gICAgICAgICk7XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IHBhcnNlT3B0aW9uczogUGFyc2VPcHRpb25zID0ge1xuICAgICAgICBmb3JtYXQ6IG9wdGlvbnMuZm9ybWF0LFxuICAgICAgICBiYXNlSVJJOiBvcHRpb25zLmJhc2VJUkksXG4gICAgICAgIG5hbWVzcGFjZU1hbmFnZXI6IHRoaXMubmFtZXNwYWNlTWFuYWdlcixcbiAgICAgICAgdmFsaWRhdGVJbnB1dDogb3B0aW9ucy52YWxpZGF0ZUlucHV0ID8/IHRydWUsXG4gICAgICAgIHN0cmljdE1vZGU6IG9wdGlvbnMuc3RyaWN0TW9kZSA/PyBmYWxzZSxcbiAgICAgIH07XG5cbiAgICAgIGNvbnN0IHBhcnNlUmVzdWx0ID0gdGhpcy5wYXJzZXIucGFyc2UoY29udGVudCwgcGFyc2VPcHRpb25zKTtcbiAgICAgIGlmIChwYXJzZVJlc3VsdC5pc0ZhaWx1cmUpIHtcbiAgICAgICAgcmV0dXJuIFJlc3VsdC5mYWlsKFxuICAgICAgICAgIGBJbXBvcnQgcGFyc2luZyBmYWlsZWQ6ICR7cGFyc2VSZXN1bHQuZXJyb3JWYWx1ZSgpfWAsXG4gICAgICAgICk7XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IGltcG9ydGVkID0gcGFyc2VSZXN1bHQuZ2V0VmFsdWUoKTtcblxuICAgICAgaWYgKG9wdGlvbnMudmFsaWRhdGVJbnB1dCkge1xuICAgICAgICBjb25zdCB2YWxpZGF0aW9uT3B0aW9uczogVmFsaWRhdGlvbk9wdGlvbnMgPSB7XG4gICAgICAgICAgc3RyaWN0TW9kZTogb3B0aW9ucy5zdHJpY3RNb2RlLFxuICAgICAgICAgIGNoZWNrRHVwbGljYXRlczogdHJ1ZSxcbiAgICAgICAgICBjaGVja05hbWVzcGFjZXM6IHRydWUsXG4gICAgICAgICAgY2hlY2tMaXRlcmFsczogdHJ1ZSxcbiAgICAgICAgfTtcblxuICAgICAgICBjb25zdCBncmFwaFZhbGlkYXRpb24gPSB0aGlzLnZhbGlkYXRvci52YWxpZGF0ZUdyYXBoKFxuICAgICAgICAgIGltcG9ydGVkLmdyYXBoLFxuICAgICAgICAgIHZhbGlkYXRpb25PcHRpb25zLFxuICAgICAgICApO1xuICAgICAgICBpZiAoZ3JhcGhWYWxpZGF0aW9uLmlzRmFpbHVyZSkge1xuICAgICAgICAgIHJldHVybiBSZXN1bHQuZmFpbChncmFwaFZhbGlkYXRpb24uZXJyb3JWYWx1ZSgpKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IHZhbGlkYXRpb24gPSBncmFwaFZhbGlkYXRpb24uZ2V0VmFsdWUoKTtcbiAgICAgICAgaWYgKCF2YWxpZGF0aW9uLmlzVmFsaWQgJiYgb3B0aW9ucy5zdHJpY3RNb2RlKSB7XG4gICAgICAgICAgY29uc3QgZXJyb3JNZXNzYWdlcyA9IHZhbGlkYXRpb24uZXJyb3JzXG4gICAgICAgICAgICAubWFwKChlKSA9PiBlLm1lc3NhZ2UpXG4gICAgICAgICAgICAuam9pbihcIjsgXCIpO1xuICAgICAgICAgIHJldHVybiBSZXN1bHQuZmFpbChgSW1wb3J0IHZhbGlkYXRpb24gZmFpbGVkOiAke2Vycm9yTWVzc2FnZXN9YCk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAodmFsaWRhdGlvbi53YXJuaW5ncy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgdGhpcy5ub3RpZmljYXRpb25TZXJ2aWNlLnNob3dXYXJuaW5nKFxuICAgICAgICAgICAgYEltcG9ydCBjb21wbGV0ZWQgd2l0aCAke3ZhbGlkYXRpb24ud2FybmluZ3MubGVuZ3RofSB3YXJuaW5nc2AsXG4gICAgICAgICAgKTtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICBsZXQgZmluYWxHcmFwaDogR3JhcGg7XG5cbiAgICAgIC8vIFVzZSBvcHRpbWl6ZWQgaW1wb3J0ZXIgZm9yIGxhcmdlIGZpbGVzXG4gICAgICBjb25zdCB1c2VPcHRpbWl6ZWQgPVxuICAgICAgICBvcHRpb25zLnVzZU9wdGltaXplZEltcG9ydGVyICE9PSBmYWxzZSAmJlxuICAgICAgICAoY29udGVudC5sZW5ndGggPiA1MDAwMCB8fCBvcHRpb25zLmNodW5rU2l6ZSk7XG5cbiAgICAgIGlmICh1c2VPcHRpbWl6ZWQgJiYgZ3JhcGggaW5zdGFuY2VvZiBJbmRleGVkR3JhcGgpIHtcbiAgICAgICAgLy8gVXNlIG9wdGltaXplZCBiYXRjaCBwcm9jZXNzaW5nXG4gICAgICAgIGlmIChvcHRpb25zLm1lcmdlTW9kZSA9PT0gXCJyZXBsYWNlXCIpIHtcbiAgICAgICAgICBncmFwaC5jbGVhcigpO1xuICAgICAgICB9XG5cbiAgICAgICAgZ3JhcGguYmVnaW5CYXRjaCgpO1xuICAgICAgICBmb3IgKGNvbnN0IHRyaXBsZSBvZiBpbXBvcnRlZC5ncmFwaC50b0FycmF5KCkpIHtcbiAgICAgICAgICBncmFwaC5hZGQodHJpcGxlKTtcbiAgICAgICAgfVxuICAgICAgICBncmFwaC5jb21taXRCYXRjaCgpO1xuXG4gICAgICAgIGZpbmFsR3JhcGggPSBncmFwaDtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIC8vIFN0YW5kYXJkIG1lcmdlXG4gICAgICAgIGlmIChvcHRpb25zLm1lcmdlTW9kZSA9PT0gXCJyZXBsYWNlXCIpIHtcbiAgICAgICAgICBmaW5hbEdyYXBoID0gaW1wb3J0ZWQuZ3JhcGg7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgZmluYWxHcmFwaCA9IGdyYXBoLmNsb25lKCk7XG4gICAgICAgICAgaWYgKGZpbmFsR3JhcGggaW5zdGFuY2VvZiBJbmRleGVkR3JhcGgpIHtcbiAgICAgICAgICAgIGZpbmFsR3JhcGguYmVnaW5CYXRjaCgpO1xuICAgICAgICAgICAgZmluYWxHcmFwaC5tZXJnZShpbXBvcnRlZC5ncmFwaCk7XG4gICAgICAgICAgICBmaW5hbEdyYXBoLmNvbW1pdEJhdGNoKCk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGZpbmFsR3JhcGgubWVyZ2UoaW1wb3J0ZWQuZ3JhcGgpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICBmb3IgKGNvbnN0IFtwcmVmaXgsIG5hbWVzcGFjZV0gb2YgT2JqZWN0LmVudHJpZXMoaW1wb3J0ZWQubmFtZXNwYWNlcykpIHtcbiAgICAgICAgaWYgKCF0aGlzLm5hbWVzcGFjZU1hbmFnZXIuaGFzUHJlZml4KHByZWZpeCkpIHtcbiAgICAgICAgICB0aGlzLm5hbWVzcGFjZU1hbmFnZXIuYWRkQmluZGluZyhwcmVmaXgsIG5hbWVzcGFjZSk7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgcmV0dXJuIFJlc3VsdC5vayh7IGdyYXBoOiBmaW5hbEdyYXBoLCBpbXBvcnRlZCB9KTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgcmV0dXJuIFJlc3VsdC5mYWlsKGBJbXBvcnQgZmFpbGVkOiAke2Vycm9yLm1lc3NhZ2V9YCk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEltcG9ydCBSREYgZnJvbSB2YXVsdCBmaWxlXG4gICAqL1xuICBhc3luYyBpbXBvcnRGcm9tVmF1bHRGaWxlKFxuICAgIGZpbGVQYXRoOiBzdHJpbmcsXG4gICAgZ3JhcGg6IEdyYXBoLFxuICAgIG9wdGlvbnM6IFJERkltcG9ydE9wdGlvbnMsXG4gICk6IFByb21pc2U8UmVzdWx0PHsgZ3JhcGg6IEdyYXBoOyBpbXBvcnRlZDogUGFyc2VSZXN1bHQgfT4+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgY29udGVudFJlc3VsdCA9IGF3YWl0IHRoaXMuZmlsZVN5c3RlbUFkYXB0ZXIucmVhZEZpbGUoZmlsZVBhdGgpO1xuICAgICAgaWYgKGNvbnRlbnRSZXN1bHQuaXNGYWlsdXJlKSB7XG4gICAgICAgIHJldHVybiBSZXN1bHQuZmFpbChjb250ZW50UmVzdWx0LmVycm9yVmFsdWUoKSk7XG4gICAgICB9XG5cbiAgICAgIGlmICghb3B0aW9ucy5mb3JtYXQpIHtcbiAgICAgICAgY29uc3QgZmlsZU5hbWUgPSBmaWxlUGF0aC5zcGxpdChcIi9cIikucG9wKCkgfHwgZmlsZVBhdGg7XG4gICAgICAgIG9wdGlvbnMuZm9ybWF0ID0gdGhpcy5maWxlU3lzdGVtQWRhcHRlci5kZXRlY3RGb3JtYXRGcm9tRXh0ZW5zaW9uKFxuICAgICAgICAgIGZpbGVOYW1lLFxuICAgICAgICApIGFzIFJERkZvcm1hdDtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIGF3YWl0IHRoaXMuaW1wb3J0UkRGKGNvbnRlbnRSZXN1bHQuZ2V0VmFsdWUoKSwgZ3JhcGgsIG9wdGlvbnMpO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICByZXR1cm4gUmVzdWx0LmZhaWwoYEZhaWxlZCB0byBpbXBvcnQgZnJvbSB2YXVsdCBmaWxlOiAke2Vycm9yLm1lc3NhZ2V9YCk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEV4cG9ydCBTUEFSUUwgcXVlcnkgcmVzdWx0c1xuICAgKi9cbiAgYXN5bmMgZXhwb3J0UXVlcnlSZXN1bHRzKFxuICAgIHJlc3VsdHM6IGFueVtdLFxuICAgIGZvcm1hdDogUkRGRm9ybWF0LFxuICAgIGZpbGVOYW1lPzogc3RyaW5nLFxuICAgIHNhdmVUb1ZhdWx0OiBib29sZWFuID0gdHJ1ZSxcbiAgKTogUHJvbWlzZTxSZXN1bHQ8U2VyaWFsaXphdGlvblJlc3VsdD4+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgZ3JhcGggPSB0aGlzLmNvbnZlcnRRdWVyeVJlc3VsdHNUb0dyYXBoKHJlc3VsdHMpO1xuXG4gICAgICBjb25zdCBvcHRpb25zOiBSREZFeHBvcnRPcHRpb25zID0ge1xuICAgICAgICBmb3JtYXQsXG4gICAgICAgIGZpbGVOYW1lOiBmaWxlTmFtZSB8fCBcInNwYXJxbC1yZXN1bHRzXCIsXG4gICAgICAgIHNhdmVUb1ZhdWx0LFxuICAgICAgICBpbmNsdWRlQ29tbWVudHM6IHRydWUsXG4gICAgICAgIHByZXR0eVByaW50OiB0cnVlLFxuICAgICAgICB0YXJnZXRGb2xkZXI6IFwiZXhwb3J0c1wiLFxuICAgICAgfTtcblxuICAgICAgcmV0dXJuIGF3YWl0IHRoaXMuZXhwb3J0R3JhcGgoZ3JhcGgsIG9wdGlvbnMpO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICByZXR1cm4gUmVzdWx0LmZhaWwoYFF1ZXJ5IHJlc3VsdHMgZXhwb3J0IGZhaWxlZDogJHtlcnJvci5tZXNzYWdlfWApO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBWYWxpZGF0ZSBhIGdyYXBoXG4gICAqL1xuICBhc3luYyB2YWxpZGF0ZUdyYXBoKFxuICAgIGdyYXBoOiBHcmFwaCxcbiAgICBvcHRpb25zPzogVmFsaWRhdGlvbk9wdGlvbnMsXG4gICk6IFByb21pc2U8UmVzdWx0PGFueT4+IHtcbiAgICByZXR1cm4gdGhpcy52YWxpZGF0b3IudmFsaWRhdGVHcmFwaChncmFwaCwgb3B0aW9ucyk7XG4gIH1cblxuICAvKipcbiAgICogTGlzdCBSREYgZmlsZXMgaW4gdmF1bHRcbiAgICovXG4gIGFzeW5jIGxpc3RSREZGaWxlcyhmb2xkZXI/OiBzdHJpbmcpOiBQcm9taXNlPFJlc3VsdDxhbnlbXT4+IHtcbiAgICByZXR1cm4gdGhpcy5maWxlU3lzdGVtQWRhcHRlci5saXN0RmlsZXMoZm9sZGVyLCBcInR0bFwiKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDb252ZXJ0IFNQQVJRTCBxdWVyeSByZXN1bHRzIHRvIGdyYXBoXG4gICAqL1xuICBwcml2YXRlIGNvbnZlcnRRdWVyeVJlc3VsdHNUb0dyYXBoKHJlc3VsdHM6IGFueVtdKTogR3JhcGgge1xuICAgIGNvbnN0IGdyYXBoID0gbmV3IEdyYXBoKCk7XG5cbiAgICBmb3IgKGNvbnN0IHJlc3VsdCBvZiByZXN1bHRzKSB7XG4gICAgICBpZiAocmVzdWx0LnN1YmplY3QgJiYgcmVzdWx0LnByZWRpY2F0ZSAmJiByZXN1bHQub2JqZWN0KSB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgY29uc3Qgc3ViamVjdCA9IHRoaXMuY3JlYXRlTm9kZUZyb21WYWx1ZShyZXN1bHQuc3ViamVjdCk7XG4gICAgICAgICAgY29uc3QgcHJlZGljYXRlID0gdGhpcy5jcmVhdGVOb2RlRnJvbVZhbHVlKHJlc3VsdC5wcmVkaWNhdGUpIGFzIElSSTtcbiAgICAgICAgICBjb25zdCBvYmplY3QgPSB0aGlzLmNyZWF0ZU5vZGVGcm9tVmFsdWUocmVzdWx0Lm9iamVjdCk7XG5cbiAgICAgICAgICBpZiAoc3ViamVjdCAmJiBwcmVkaWNhdGUgJiYgb2JqZWN0KSB7XG4gICAgICAgICAgICBjb25zdCB0cmlwbGUgPSBuZXcgVHJpcGxlKFxuICAgICAgICAgICAgICBzdWJqZWN0IGFzIElSSSB8IEJsYW5rTm9kZSxcbiAgICAgICAgICAgICAgcHJlZGljYXRlLFxuICAgICAgICAgICAgICBvYmplY3QsXG4gICAgICAgICAgICApO1xuICAgICAgICAgICAgZ3JhcGguYWRkKHRyaXBsZSk7XG4gICAgICAgICAgfVxuICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgIGNvbnNvbGUud2FybihcIkZhaWxlZCB0byBjb252ZXJ0IHF1ZXJ5IHJlc3VsdCB0byB0cmlwbGU6XCIsIGVycm9yKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiBncmFwaDtcbiAgfVxuXG4gIC8qKlxuICAgKiBDcmVhdGUgUkRGIG5vZGUgZnJvbSBxdWVyeSByZXN1bHQgdmFsdWVcbiAgICovXG4gIHByaXZhdGUgY3JlYXRlTm9kZUZyb21WYWx1ZSh2YWx1ZTogYW55KTogSVJJIHwgQmxhbmtOb2RlIHwgTGl0ZXJhbCB8IG51bGwge1xuICAgIGlmICh0eXBlb2YgdmFsdWUgPT09IFwic3RyaW5nXCIpIHtcbiAgICAgIGlmICh2YWx1ZS5zdGFydHNXaXRoKFwiXzpcIikpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBCbGFua05vZGUodmFsdWUpO1xuICAgICAgfSBlbHNlIGlmIChcbiAgICAgICAgdmFsdWUuc3RhcnRzV2l0aChcImh0dHA6Ly9cIikgfHxcbiAgICAgICAgdmFsdWUuc3RhcnRzV2l0aChcImh0dHBzOi8vXCIpIHx8XG4gICAgICAgIHZhbHVlLmluY2x1ZGVzKFwiOlwiKVxuICAgICAgKSB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgcmV0dXJuIG5ldyBJUkkodmFsdWUpO1xuICAgICAgICB9IGNhdGNoIHtcbiAgICAgICAgICByZXR1cm4gTGl0ZXJhbC5zdHJpbmcodmFsdWUpO1xuICAgICAgICB9XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm4gTGl0ZXJhbC5zdHJpbmcodmFsdWUpO1xuICAgICAgfVxuICAgIH0gZWxzZSBpZiAodHlwZW9mIHZhbHVlID09PSBcIm51bWJlclwiKSB7XG4gICAgICByZXR1cm4gTnVtYmVyLmlzSW50ZWdlcih2YWx1ZSlcbiAgICAgICAgPyBMaXRlcmFsLmludGVnZXIodmFsdWUpXG4gICAgICAgIDogTGl0ZXJhbC5kb3VibGUodmFsdWUpO1xuICAgIH0gZWxzZSBpZiAodHlwZW9mIHZhbHVlID09PSBcImJvb2xlYW5cIikge1xuICAgICAgcmV0dXJuIExpdGVyYWwuYm9vbGVhbih2YWx1ZSk7XG4gICAgfSBlbHNlIGlmICh2YWx1ZSAmJiB0eXBlb2YgdmFsdWUgPT09IFwib2JqZWN0XCIpIHtcbiAgICAgIGlmICh2YWx1ZS50eXBlID09PSBcInVyaVwiIHx8IHZhbHVlLnR5cGUgPT09IFwiaXJpXCIpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBJUkkodmFsdWUudmFsdWUpO1xuICAgICAgfSBlbHNlIGlmICh2YWx1ZS50eXBlID09PSBcImJub2RlXCIpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBCbGFua05vZGUodmFsdWUudmFsdWUpO1xuICAgICAgfSBlbHNlIGlmICh2YWx1ZS50eXBlID09PSBcImxpdGVyYWxcIikge1xuICAgICAgICBpZiAodmFsdWUuZGF0YXR5cGUpIHtcbiAgICAgICAgICByZXR1cm4gbmV3IExpdGVyYWwodmFsdWUudmFsdWUsIG5ldyBJUkkodmFsdWUuZGF0YXR5cGUpKTtcbiAgICAgICAgfSBlbHNlIGlmICh2YWx1ZS5sYW5nKSB7XG4gICAgICAgICAgcmV0dXJuIG5ldyBMaXRlcmFsKHZhbHVlLnZhbHVlLCB1bmRlZmluZWQsIHZhbHVlLmxhbmcpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHJldHVybiBuZXcgTGl0ZXJhbCh2YWx1ZS52YWx1ZSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gbnVsbDtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgbmFtZXNwYWNlIG1hbmFnZXIgaW5zdGFuY2VcbiAgICovXG4gIGdldE5hbWVzcGFjZU1hbmFnZXIoKTogTmFtZXNwYWNlTWFuYWdlciB7XG4gICAgcmV0dXJuIHRoaXMubmFtZXNwYWNlTWFuYWdlcjtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgc3VwcG9ydGVkIGV4cG9ydCBmb3JtYXRzXG4gICAqL1xuICBnZXRTdXBwb3J0ZWRGb3JtYXRzKCk6IFJERkZvcm1hdFtdIHtcbiAgICByZXR1cm4gW1widHVydGxlXCIsIFwibi10cmlwbGVzXCIsIFwianNvbi1sZFwiLCBcInJkZi14bWxcIl07XG4gIH1cblxuICAvKipcbiAgICogR2V0IGZvcm1hdCBpbmZvcm1hdGlvblxuICAgKi9cbiAgZ2V0Rm9ybWF0SW5mbyhmb3JtYXQ6IFJERkZvcm1hdCk6IHtcbiAgICBleHRlbnNpb246IHN0cmluZztcbiAgICBtaW1lVHlwZTogc3RyaW5nO1xuICAgIG5hbWU6IHN0cmluZztcbiAgfSB7XG4gICAgY29uc3QgZm9ybWF0TWFwID0ge1xuICAgICAgdHVydGxlOiB7IGV4dGVuc2lvbjogXCIudHRsXCIsIG1pbWVUeXBlOiBcInRleHQvdHVydGxlXCIsIG5hbWU6IFwiVHVydGxlXCIgfSxcbiAgICAgIFwibi10cmlwbGVzXCI6IHtcbiAgICAgICAgZXh0ZW5zaW9uOiBcIi5udFwiLFxuICAgICAgICBtaW1lVHlwZTogXCJhcHBsaWNhdGlvbi9uLXRyaXBsZXNcIixcbiAgICAgICAgbmFtZTogXCJOLVRyaXBsZXNcIixcbiAgICAgIH0sXG4gICAgICBcImpzb24tbGRcIjoge1xuICAgICAgICBleHRlbnNpb246IFwiLmpzb25sZFwiLFxuICAgICAgICBtaW1lVHlwZTogXCJhcHBsaWNhdGlvbi9sZCtqc29uXCIsXG4gICAgICAgIG5hbWU6IFwiSlNPTi1MRFwiLFxuICAgICAgfSxcbiAgICAgIFwicmRmLXhtbFwiOiB7XG4gICAgICAgIGV4dGVuc2lvbjogXCIucmRmXCIsXG4gICAgICAgIG1pbWVUeXBlOiBcImFwcGxpY2F0aW9uL3JkZit4bWxcIixcbiAgICAgICAgbmFtZTogXCJSREYvWE1MXCIsXG4gICAgICB9LFxuICAgIH07XG5cbiAgICByZXR1cm4gZm9ybWF0TWFwW2Zvcm1hdF07XG4gIH1cbn1cbiJdLCJ2ZXJzaW9uIjozfQ==