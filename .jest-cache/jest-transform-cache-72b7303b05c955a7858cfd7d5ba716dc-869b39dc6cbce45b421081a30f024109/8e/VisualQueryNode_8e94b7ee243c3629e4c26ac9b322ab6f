8cd455e672b6ebb8046354cc80fadc31
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.VisualQueryNode = exports.NodeType = void 0;
var NodeType;
(function (NodeType) {
    NodeType["ENTITY"] = "entity";
    NodeType["VARIABLE"] = "variable";
    NodeType["LITERAL"] = "literal";
    NodeType["FILTER"] = "filter";
})(NodeType = exports.NodeType || (exports.NodeType = {}));
class VisualQueryNode {
    constructor(params) {
        this.selected = false;
        this.valid = true;
        this.errors = [];
        this.id = params.id;
        this.type = params.type;
        this.label = params.label;
        this.position = params.position;
        this.variableName = params.variableName;
        this.uri = params.uri;
        this.dimensions = params.dimensions || { width: 150, height: 60 };
        Object.freeze(this.id);
        Object.freeze(this.type);
    }
    getId() {
        return this.id;
    }
    getType() {
        return this.type;
    }
    getLabel() {
        return this.label;
    }
    setLabel(label) {
        this.label = label;
    }
    getVariableName() {
        return this.variableName;
    }
    setVariableName(name) {
        this.variableName = name;
    }
    getUri() {
        return this.uri;
    }
    setUri(uri) {
        this.uri = uri;
    }
    getPosition() {
        return { ...this.position };
    }
    setPosition(position) {
        this.position = { ...position };
    }
    getDimensions() {
        return { ...this.dimensions };
    }
    setDimensions(dimensions) {
        this.dimensions = { ...dimensions };
    }
    isSelected() {
        return this.selected;
    }
    setSelected(selected) {
        this.selected = selected;
    }
    isValid() {
        return this.valid;
    }
    setValid(valid, errors) {
        this.valid = valid;
        this.errors = errors || [];
    }
    getErrors() {
        return [...this.errors];
    }
    containsPoint(x, y) {
        return (x >= this.position.x &&
            x <= this.position.x + this.dimensions.width &&
            y >= this.position.y &&
            y <= this.position.y + this.dimensions.height);
    }
    getConnectionPoints() {
        return {
            top: {
                x: this.position.x + this.dimensions.width / 2,
                y: this.position.y,
            },
            right: {
                x: this.position.x + this.dimensions.width,
                y: this.position.y + this.dimensions.height / 2,
            },
            bottom: {
                x: this.position.x + this.dimensions.width / 2,
                y: this.position.y + this.dimensions.height,
            },
            left: {
                x: this.position.x,
                y: this.position.y + this.dimensions.height / 2,
            },
        };
    }
    toSPARQLElement() {
        switch (this.type) {
            case NodeType.ENTITY:
                if (this.uri) {
                    return `<${this.uri}>`;
                }
                else if (this.variableName) {
                    return `?${this.variableName}`;
                }
                else {
                    return `?${this.label.toLowerCase().replace(/\s+/g, "_")}`;
                }
            case NodeType.VARIABLE:
                return `?${this.variableName || this.label.toLowerCase().replace(/\s+/g, "_")}`;
            case NodeType.LITERAL:
                return `"${this.label}"`;
            case NodeType.FILTER:
                return this.label;
            default:
                return "?unknown";
        }
    }
    clone() {
        return new VisualQueryNode({
            id: `${this.id}_clone_${Date.now()}`,
            type: this.type,
            label: this.label,
            position: { ...this.position },
            variableName: this.variableName,
            uri: this.uri,
            dimensions: { ...this.dimensions },
        });
    }
    static createEntity(label, uri, position) {
        return new VisualQueryNode({
            id: `entity_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,
            type: NodeType.ENTITY,
            label,
            uri,
            position: position || { x: 0, y: 0 },
        });
    }
    static createVariable(name, position) {
        return new VisualQueryNode({
            id: `var_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,
            type: NodeType.VARIABLE,
            label: name,
            variableName: name,
            position: position || { x: 0, y: 0 },
        });
    }
    static createLiteral(value, position) {
        return new VisualQueryNode({
            id: `literal_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,
            type: NodeType.LITERAL,
            label: value,
            position: position || { x: 0, y: 0 },
        });
    }
    static createFilter(expression, position) {
        return new VisualQueryNode({
            id: `filter_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,
            type: NodeType.FILTER,
            label: expression,
            position: position || { x: 0, y: 0 },
            dimensions: { width: 200, height: 80 },
        });
    }
}
exports.VisualQueryNode = VisualQueryNode;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL2tpdGVsZXYvRG9jdW1lbnRzL2V4b2NvcnRleC1vYnNpZGlhbi1wbHVnaW4vc3JjL2RvbWFpbi92aXN1YWwvVmlzdWFsUXVlcnlOb2RlLnRzIiwibWFwcGluZ3MiOiI7OztBQUFBLElBQVksUUFLWDtBQUxELFdBQVksUUFBUTtJQUNsQiw2QkFBaUIsQ0FBQTtJQUNqQixpQ0FBcUIsQ0FBQTtJQUNyQiwrQkFBbUIsQ0FBQTtJQUNuQiw2QkFBaUIsQ0FBQTtBQUNuQixDQUFDLEVBTFcsUUFBUSxHQUFSLGdCQUFRLEtBQVIsZ0JBQVEsUUFLbkI7QUFZRCxNQUFhLGVBQWU7SUFZMUIsWUFBWSxNQVFYO1FBWk8sYUFBUSxHQUFZLEtBQUssQ0FBQztRQUMxQixVQUFLLEdBQVksSUFBSSxDQUFDO1FBQ3RCLFdBQU0sR0FBYSxFQUFFLENBQUM7UUFXNUIsSUFBSSxDQUFDLEVBQUUsR0FBRyxNQUFNLENBQUMsRUFBRSxDQUFDO1FBQ3BCLElBQUksQ0FBQyxJQUFJLEdBQUcsTUFBTSxDQUFDLElBQUksQ0FBQztRQUN4QixJQUFJLENBQUMsS0FBSyxHQUFHLE1BQU0sQ0FBQyxLQUFLLENBQUM7UUFDMUIsSUFBSSxDQUFDLFFBQVEsR0FBRyxNQUFNLENBQUMsUUFBUSxDQUFDO1FBQ2hDLElBQUksQ0FBQyxZQUFZLEdBQUcsTUFBTSxDQUFDLFlBQVksQ0FBQztRQUN4QyxJQUFJLENBQUMsR0FBRyxHQUFHLE1BQU0sQ0FBQyxHQUFHLENBQUM7UUFDdEIsSUFBSSxDQUFDLFVBQVUsR0FBRyxNQUFNLENBQUMsVUFBVSxJQUFJLEVBQUUsS0FBSyxFQUFFLEdBQUcsRUFBRSxNQUFNLEVBQUUsRUFBRSxFQUFFLENBQUM7UUFDbEUsTUFBTSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDLENBQUM7UUFDdkIsTUFBTSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7SUFDM0IsQ0FBQztJQUVELEtBQUs7UUFDSCxPQUFPLElBQUksQ0FBQyxFQUFFLENBQUM7SUFD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QUE1TkQsMENBNE5DIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIi9Vc2Vycy9raXRlbGV2L0RvY3VtZW50cy9leG9jb3J0ZXgtb2JzaWRpYW4tcGx1Z2luL3NyYy9kb21haW4vdmlzdWFsL1Zpc3VhbFF1ZXJ5Tm9kZS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJleHBvcnQgZW51bSBOb2RlVHlwZSB7XG4gIEVOVElUWSA9IFwiZW50aXR5XCIsXG4gIFZBUklBQkxFID0gXCJ2YXJpYWJsZVwiLFxuICBMSVRFUkFMID0gXCJsaXRlcmFsXCIsXG4gIEZJTFRFUiA9IFwiZmlsdGVyXCIsXG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgTm9kZVBvc2l0aW9uIHtcbiAgeDogbnVtYmVyO1xuICB5OiBudW1iZXI7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgTm9kZURpbWVuc2lvbnMge1xuICB3aWR0aDogbnVtYmVyO1xuICBoZWlnaHQ6IG51bWJlcjtcbn1cblxuZXhwb3J0IGNsYXNzIFZpc3VhbFF1ZXJ5Tm9kZSB7XG4gIHByaXZhdGUgcmVhZG9ubHkgaWQ6IHN0cmluZztcbiAgcHJpdmF0ZSByZWFkb25seSB0eXBlOiBOb2RlVHlwZTtcbiAgcHJpdmF0ZSBsYWJlbDogc3RyaW5nO1xuICBwcml2YXRlIHZhcmlhYmxlTmFtZT86IHN0cmluZztcbiAgcHJpdmF0ZSB1cmk/OiBzdHJpbmc7XG4gIHByaXZhdGUgcG9zaXRpb246IE5vZGVQb3NpdGlvbjtcbiAgcHJpdmF0ZSBkaW1lbnNpb25zOiBOb2RlRGltZW5zaW9ucztcbiAgcHJpdmF0ZSBzZWxlY3RlZDogYm9vbGVhbiA9IGZhbHNlO1xuICBwcml2YXRlIHZhbGlkOiBib29sZWFuID0gdHJ1ZTtcbiAgcHJpdmF0ZSBlcnJvcnM6IHN0cmluZ1tdID0gW107XG5cbiAgY29uc3RydWN0b3IocGFyYW1zOiB7XG4gICAgaWQ6IHN0cmluZztcbiAgICB0eXBlOiBOb2RlVHlwZTtcbiAgICBsYWJlbDogc3RyaW5nO1xuICAgIHBvc2l0aW9uOiBOb2RlUG9zaXRpb247XG4gICAgdmFyaWFibGVOYW1lPzogc3RyaW5nO1xuICAgIHVyaT86IHN0cmluZztcbiAgICBkaW1lbnNpb25zPzogTm9kZURpbWVuc2lvbnM7XG4gIH0pIHtcbiAgICB0aGlzLmlkID0gcGFyYW1zLmlkO1xuICAgIHRoaXMudHlwZSA9IHBhcmFtcy50eXBlO1xuICAgIHRoaXMubGFiZWwgPSBwYXJhbXMubGFiZWw7XG4gICAgdGhpcy5wb3NpdGlvbiA9IHBhcmFtcy5wb3NpdGlvbjtcbiAgICB0aGlzLnZhcmlhYmxlTmFtZSA9IHBhcmFtcy52YXJpYWJsZU5hbWU7XG4gICAgdGhpcy51cmkgPSBwYXJhbXMudXJpO1xuICAgIHRoaXMuZGltZW5zaW9ucyA9IHBhcmFtcy5kaW1lbnNpb25zIHx8IHsgd2lkdGg6IDE1MCwgaGVpZ2h0OiA2MCB9O1xuICAgIE9iamVjdC5mcmVlemUodGhpcy5pZCk7XG4gICAgT2JqZWN0LmZyZWV6ZSh0aGlzLnR5cGUpO1xuICB9XG5cbiAgZ2V0SWQoKTogc3RyaW5nIHtcbiAgICByZXR1cm4gdGhpcy5pZDtcbiAgfVxuXG4gIGdldFR5cGUoKTogTm9kZVR5cGUge1xuICAgIHJldHVybiB0aGlzLnR5cGU7XG4gIH1cblxuICBnZXRMYWJlbCgpOiBzdHJpbmcge1xuICAgIHJldHVybiB0aGlzLmxhYmVsO1xuICB9XG5cbiAgc2V0TGFiZWwobGFiZWw6IHN0cmluZyk6IHZvaWQge1xuICAgIHRoaXMubGFiZWwgPSBsYWJlbDtcbiAgfVxuXG4gIGdldFZhcmlhYmxlTmFtZSgpOiBzdHJpbmcgfCB1bmRlZmluZWQge1xuICAgIHJldHVybiB0aGlzLnZhcmlhYmxlTmFtZTtcbiAgfVxuXG4gIHNldFZhcmlhYmxlTmFtZShuYW1lOiBzdHJpbmcpOiB2b2lkIHtcbiAgICB0aGlzLnZhcmlhYmxlTmFtZSA9IG5hbWU7XG4gIH1cblxuICBnZXRVcmkoKTogc3RyaW5nIHwgdW5kZWZpbmVkIHtcbiAgICByZXR1cm4gdGhpcy51cmk7XG4gIH1cblxuICBzZXRVcmkodXJpOiBzdHJpbmcpOiB2b2lkIHtcbiAgICB0aGlzLnVyaSA9IHVyaTtcbiAgfVxuXG4gIGdldFBvc2l0aW9uKCk6IE5vZGVQb3NpdGlvbiB7XG4gICAgcmV0dXJuIHsgLi4udGhpcy5wb3NpdGlvbiB9O1xuICB9XG5cbiAgc2V0UG9zaXRpb24ocG9zaXRpb246IE5vZGVQb3NpdGlvbik6IHZvaWQge1xuICAgIHRoaXMucG9zaXRpb24gPSB7IC4uLnBvc2l0aW9uIH07XG4gIH1cblxuICBnZXREaW1lbnNpb25zKCk6IE5vZGVEaW1lbnNpb25zIHtcbiAgICByZXR1cm4geyAuLi50aGlzLmRpbWVuc2lvbnMgfTtcbiAgfVxuXG4gIHNldERpbWVuc2lvbnMoZGltZW5zaW9uczogTm9kZURpbWVuc2lvbnMpOiB2b2lkIHtcbiAgICB0aGlzLmRpbWVuc2lvbnMgPSB7IC4uLmRpbWVuc2lvbnMgfTtcbiAgfVxuXG4gIGlzU2VsZWN0ZWQoKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIHRoaXMuc2VsZWN0ZWQ7XG4gIH1cblxuICBzZXRTZWxlY3RlZChzZWxlY3RlZDogYm9vbGVhbik6IHZvaWQge1xuICAgIHRoaXMuc2VsZWN0ZWQgPSBzZWxlY3RlZDtcbiAgfVxuXG4gIGlzVmFsaWQoKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIHRoaXMudmFsaWQ7XG4gIH1cblxuICBzZXRWYWxpZCh2YWxpZDogYm9vbGVhbiwgZXJyb3JzPzogc3RyaW5nW10pOiB2b2lkIHtcbiAgICB0aGlzLnZhbGlkID0gdmFsaWQ7XG4gICAgdGhpcy5lcnJvcnMgPSBlcnJvcnMgfHwgW107XG4gIH1cblxuICBnZXRFcnJvcnMoKTogc3RyaW5nW10ge1xuICAgIHJldHVybiBbLi4udGhpcy5lcnJvcnNdO1xuICB9XG5cbiAgY29udGFpbnNQb2ludCh4OiBudW1iZXIsIHk6IG51bWJlcik6IGJvb2xlYW4ge1xuICAgIHJldHVybiAoXG4gICAgICB4ID49IHRoaXMucG9zaXRpb24ueCAmJlxuICAgICAgeCA8PSB0aGlzLnBvc2l0aW9uLnggKyB0aGlzLmRpbWVuc2lvbnMud2lkdGggJiZcbiAgICAgIHkgPj0gdGhpcy5wb3NpdGlvbi55ICYmXG4gICAgICB5IDw9IHRoaXMucG9zaXRpb24ueSArIHRoaXMuZGltZW5zaW9ucy5oZWlnaHRcbiAgICApO1xuICB9XG5cbiAgZ2V0Q29ubmVjdGlvblBvaW50cygpOiB7XG4gICAgdG9wOiBOb2RlUG9zaXRpb247XG4gICAgcmlnaHQ6IE5vZGVQb3NpdGlvbjtcbiAgICBib3R0b206IE5vZGVQb3NpdGlvbjtcbiAgICBsZWZ0OiBOb2RlUG9zaXRpb247XG4gIH0ge1xuICAgIHJldHVybiB7XG4gICAgICB0b3A6IHtcbiAgICAgICAgeDogdGhpcy5wb3NpdGlvbi54ICsgdGhpcy5kaW1lbnNpb25zLndpZHRoIC8gMixcbiAgICAgICAgeTogdGhpcy5wb3NpdGlvbi55LFxuICAgICAgfSxcbiAgICAgIHJpZ2h0OiB7XG4gICAgICAgIHg6IHRoaXMucG9zaXRpb24ueCArIHRoaXMuZGltZW5zaW9ucy53aWR0aCxcbiAgICAgICAgeTogdGhpcy5wb3NpdGlvbi55ICsgdGhpcy5kaW1lbnNpb25zLmhlaWdodCAvIDIsXG4gICAgICB9LFxuICAgICAgYm90dG9tOiB7XG4gICAgICAgIHg6IHRoaXMucG9zaXRpb24ueCArIHRoaXMuZGltZW5zaW9ucy53aWR0aCAvIDIsXG4gICAgICAgIHk6IHRoaXMucG9zaXRpb24ueSArIHRoaXMuZGltZW5zaW9ucy5oZWlnaHQsXG4gICAgICB9LFxuICAgICAgbGVmdDoge1xuICAgICAgICB4OiB0aGlzLnBvc2l0aW9uLngsXG4gICAgICAgIHk6IHRoaXMucG9zaXRpb24ueSArIHRoaXMuZGltZW5zaW9ucy5oZWlnaHQgLyAyLFxuICAgICAgfSxcbiAgICB9O1xuICB9XG5cbiAgdG9TUEFSUUxFbGVtZW50KCk6IHN0cmluZyB7XG4gICAgc3dpdGNoICh0aGlzLnR5cGUpIHtcbiAgICAgIGNhc2UgTm9kZVR5cGUuRU5USVRZOlxuICAgICAgICBpZiAodGhpcy51cmkpIHtcbiAgICAgICAgICByZXR1cm4gYDwke3RoaXMudXJpfT5gO1xuICAgICAgICB9IGVsc2UgaWYgKHRoaXMudmFyaWFibGVOYW1lKSB7XG4gICAgICAgICAgcmV0dXJuIGA/JHt0aGlzLnZhcmlhYmxlTmFtZX1gO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHJldHVybiBgPyR7dGhpcy5sYWJlbC50b0xvd2VyQ2FzZSgpLnJlcGxhY2UoL1xccysvZywgXCJfXCIpfWA7XG4gICAgICAgIH1cbiAgICAgIGNhc2UgTm9kZVR5cGUuVkFSSUFCTEU6XG4gICAgICAgIHJldHVybiBgPyR7dGhpcy52YXJpYWJsZU5hbWUgfHwgdGhpcy5sYWJlbC50b0xvd2VyQ2FzZSgpLnJlcGxhY2UoL1xccysvZywgXCJfXCIpfWA7XG4gICAgICBjYXNlIE5vZGVUeXBlLkxJVEVSQUw6XG4gICAgICAgIHJldHVybiBgXCIke3RoaXMubGFiZWx9XCJgO1xuICAgICAgY2FzZSBOb2RlVHlwZS5GSUxURVI6XG4gICAgICAgIHJldHVybiB0aGlzLmxhYmVsO1xuICAgICAgZGVmYXVsdDpcbiAgICAgICAgcmV0dXJuIFwiP3Vua25vd25cIjtcbiAgICB9XG4gIH1cblxuICBjbG9uZSgpOiBWaXN1YWxRdWVyeU5vZGUge1xuICAgIHJldHVybiBuZXcgVmlzdWFsUXVlcnlOb2RlKHtcbiAgICAgIGlkOiBgJHt0aGlzLmlkfV9jbG9uZV8ke0RhdGUubm93KCl9YCxcbiAgICAgIHR5cGU6IHRoaXMudHlwZSxcbiAgICAgIGxhYmVsOiB0aGlzLmxhYmVsLFxuICAgICAgcG9zaXRpb246IHsgLi4udGhpcy5wb3NpdGlvbiB9LFxuICAgICAgdmFyaWFibGVOYW1lOiB0aGlzLnZhcmlhYmxlTmFtZSxcbiAgICAgIHVyaTogdGhpcy51cmksXG4gICAgICBkaW1lbnNpb25zOiB7IC4uLnRoaXMuZGltZW5zaW9ucyB9LFxuICAgIH0pO1xuICB9XG5cbiAgc3RhdGljIGNyZWF0ZUVudGl0eShcbiAgICBsYWJlbDogc3RyaW5nLFxuICAgIHVyaT86IHN0cmluZyxcbiAgICBwb3NpdGlvbj86IE5vZGVQb3NpdGlvbixcbiAgKTogVmlzdWFsUXVlcnlOb2RlIHtcbiAgICByZXR1cm4gbmV3IFZpc3VhbFF1ZXJ5Tm9kZSh7XG4gICAgICBpZDogYGVudGl0eV8ke0RhdGUubm93KCl9XyR7TWF0aC5yYW5kb20oKS50b1N0cmluZygzNikuc3Vic3RyKDIsIDkpfWAsXG4gICAgICB0eXBlOiBOb2RlVHlwZS5FTlRJVFksXG4gICAgICBsYWJlbCxcbiAgICAgIHVyaSxcbiAgICAgIHBvc2l0aW9uOiBwb3NpdGlvbiB8fCB7IHg6IDAsIHk6IDAgfSxcbiAgICB9KTtcbiAgfVxuXG4gIHN0YXRpYyBjcmVhdGVWYXJpYWJsZShcbiAgICBuYW1lOiBzdHJpbmcsXG4gICAgcG9zaXRpb24/OiBOb2RlUG9zaXRpb24sXG4gICk6IFZpc3VhbFF1ZXJ5Tm9kZSB7XG4gICAgcmV0dXJuIG5ldyBWaXN1YWxRdWVyeU5vZGUoe1xuICAgICAgaWQ6IGB2YXJfJHtEYXRlLm5vdygpfV8ke01hdGgucmFuZG9tKCkudG9TdHJpbmcoMzYpLnN1YnN0cigyLCA5KX1gLFxuICAgICAgdHlwZTogTm9kZVR5cGUuVkFSSUFCTEUsXG4gICAgICBsYWJlbDogbmFtZSxcbiAgICAgIHZhcmlhYmxlTmFtZTogbmFtZSxcbiAgICAgIHBvc2l0aW9uOiBwb3NpdGlvbiB8fCB7IHg6IDAsIHk6IDAgfSxcbiAgICB9KTtcbiAgfVxuXG4gIHN0YXRpYyBjcmVhdGVMaXRlcmFsKFxuICAgIHZhbHVlOiBzdHJpbmcsXG4gICAgcG9zaXRpb24/OiBOb2RlUG9zaXRpb24sXG4gICk6IFZpc3VhbFF1ZXJ5Tm9kZSB7XG4gICAgcmV0dXJuIG5ldyBWaXN1YWxRdWVyeU5vZGUoe1xuICAgICAgaWQ6IGBsaXRlcmFsXyR7RGF0ZS5ub3coKX1fJHtNYXRoLnJhbmRvbSgpLnRvU3RyaW5nKDM2KS5zdWJzdHIoMiwgOSl9YCxcbiAgICAgIHR5cGU6IE5vZGVUeXBlLkxJVEVSQUwsXG4gICAgICBsYWJlbDogdmFsdWUsXG4gICAgICBwb3NpdGlvbjogcG9zaXRpb24gfHwgeyB4OiAwLCB5OiAwIH0sXG4gICAgfSk7XG4gIH1cblxuICBzdGF0aWMgY3JlYXRlRmlsdGVyKFxuICAgIGV4cHJlc3Npb246IHN0cmluZyxcbiAgICBwb3NpdGlvbj86IE5vZGVQb3NpdGlvbixcbiAgKTogVmlzdWFsUXVlcnlOb2RlIHtcbiAgICByZXR1cm4gbmV3IFZpc3VhbFF1ZXJ5Tm9kZSh7XG4gICAgICBpZDogYGZpbHRlcl8ke0RhdGUubm93KCl9XyR7TWF0aC5yYW5kb20oKS50b1N0cmluZygzNikuc3Vic3RyKDIsIDkpfWAsXG4gICAgICB0eXBlOiBOb2RlVHlwZS5GSUxURVIsXG4gICAgICBsYWJlbDogZXhwcmVzc2lvbixcbiAgICAgIHBvc2l0aW9uOiBwb3NpdGlvbiB8fCB7IHg6IDAsIHk6IDAgfSxcbiAgICAgIGRpbWVuc2lvbnM6IHsgd2lkdGg6IDIwMCwgaGVpZ2h0OiA4MCB9LFxuICAgIH0pO1xuICB9XG59XG4iXSwidmVyc2lvbiI6M30=