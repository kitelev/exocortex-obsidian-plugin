822d3e01a2eccda302e64ad1bbcd15bb
"use strict";
/**
 * Performance tests for IndexedGraph
 * Validates O(1) lookup performance and optimization strategies
 */
Object.defineProperty(exports, "__esModule", { value: true });
const tslib_1 = require("tslib");
const IndexedGraph_1 = require("../../../../src/domain/semantic/core/IndexedGraph");
const Triple_1 = require("../../../../src/domain/semantic/core/Triple");
describe('IndexedGraph Performance', () => {
    let graph;
    beforeEach(() => {
        graph = new IndexedGraph_1.IndexedGraph();
    });
    describe('Batch Operations', () => {
        it('should handle batch inserts efficiently', () => {
            const startTime = performance.now();
            graph.beginBatch();
            // Add 1000 triples
            for (let i = 0; i < 1000; i++) {
                const triple = new Triple_1.Triple(new Triple_1.IRI(`http://example.org/subject${i}`), new Triple_1.IRI('http://example.org/predicate'), new Triple_1.Literal(`value${i}`));
                graph.add(triple);
            }
            graph.commitBatch();
            const elapsed = performance.now() - startTime;
            expect(graph.size()).toBe(1000);
            expect(elapsed).toBeLessThan(500); // Should complete in under 500ms
            expect(graph.getMetrics().lastIndexTime).toBeGreaterThan(0);
        });
        it('should rollback batch on error', () => {
            graph.beginBatch();
            for (let i = 0; i < 10; i++) {
                const triple = new Triple_1.Triple(new Triple_1.IRI(`http://example.org/subject${i}`), new Triple_1.IRI('http://example.org/predicate'), new Triple_1.Literal(`value${i}`));
                graph.add(triple);
            }
            graph.rollbackBatch();
            expect(graph.size()).toBe(0);
        });
    });
    describe('Query Performance', () => {
        beforeEach(() => {
            // Setup test data
            graph.beginBatch();
            for (let i = 0; i < 100; i++) {
                for (let j = 0; j < 10; j++) {
                    const triple = new Triple_1.Triple(new Triple_1.IRI(`http://example.org/subject${i}`), new Triple_1.IRI(`http://example.org/predicate${j}`), new Triple_1.Literal(`value${i}_${j}`));
                    graph.add(triple);
                }
            }
            graph.commitBatch();
        });
        it('should have O(1) lookup performance', () => {
            const warmupRuns = 10;
            const measurementRuns = 100;
            const times = [];
            // Warmup phase - discard these measurements to stabilize JIT
            for (let i = 0; i < warmupRuns; i++) {
                graph.query(`http://example.org/subject${i % 10}`, 'http://example.org/predicate5');
            }
            // Measurement phase - collect all timings, even very small ones
            for (let i = 0; i < measurementRuns; i++) {
                const startTime = performance.now();
                graph.query(`http://example.org/subject${i % 10}`, 'http://example.org/predicate5');
                const endTime = performance.now();
                times.push(endTime - startTime);
            }
            // We should have all measurements (no filtering by precision)
            expect(times.length).toBe(measurementRuns);
            // Basic performance validation - focus on outliers rather than precision
            times.sort((a, b) => a - b);
            const avg = times.reduce((a, b) => a + b, 0) / times.length;
            const median = times[Math.floor(times.length / 2)];
            const p95 = times[Math.floor(times.length * 0.95)];
            const max = times[times.length - 1];
            // O(1) performance characteristics - very lenient thresholds
            // Focus on worst-case performance rather than timing precision
            expect(median).toBeLessThan(10.0); // Median < 10ms (very generous)
            expect(p95).toBeLessThan(50.0); // 95th percentile < 50ms
            expect(max).toBeLessThan(100.0); // Maximum < 100ms
            // Ensure most queries are reasonably fast (rule out O(n) behavior)
            const fastQueries = times.filter(t => t < 5.0).length;
            const fastQueryRatio = fastQueries / times.length;
            expect(fastQueryRatio).toBeGreaterThan(0.7); // At least 70% of queries < 5ms
            // Verify cache is working by checking some queries are very fast
            const veryFastQueries = times.filter(t => t < 0.1).length;
            expect(veryFastQueries).toBeGreaterThan(0); // At least some cache hits
            // Log performance stats for debugging
            console.log(`Performance stats: avg=${avg.toFixed(3)}ms, median=${median.toFixed(3)}ms, p95=${p95.toFixed(3)}ms, max=${max.toFixed(3)}ms`);
        });
        it('should cache query results', () => {
            // First query - cache miss
            const result1 = graph.query('http://example.org/subject1');
            // Second identical query - cache hit
            const result2 = graph.query('http://example.org/subject1');
            expect(result1).toEqual(result2);
            expect(graph.getMetrics().cacheHitRate).toBeGreaterThan(0);
        });
        it('should handle parallel queries efficiently', () => tslib_1.__awaiter(void 0, void 0, void 0, function* () {
            const patterns = [
                { s: 'http://example.org/subject1' },
                { s: 'http://example.org/subject2' },
                { s: 'http://example.org/subject3' },
                { p: 'http://example.org/predicate1' },
                { o: 'value50_5' }
            ];
            const startTime = performance.now();
            const results = yield graph.parallelQuery(patterns);
            const elapsed = performance.now() - startTime;
            expect(results).toHaveLength(5);
            expect(elapsed).toBeLessThan(100); // Parallel queries should be fast
        }));
    });
    describe('Statistics', () => {
        it('should calculate statistics efficiently', () => {
            // Add test data
            graph.beginBatch();
            for (let i = 0; i < 50; i++) {
                const triple = new Triple_1.Triple(new Triple_1.IRI(`http://example.org/subject${i % 10}`), new Triple_1.IRI(`http://example.org/predicate${i % 5}`), new Triple_1.Literal(`value${i}`));
                graph.add(triple);
            }
            graph.commitBatch();
            const stats = graph.getStatistics();
            expect(stats.totalTriples).toBe(50);
            expect(stats.uniqueSubjects).toBe(10);
            expect(stats.uniquePredicates).toBe(5);
            expect(stats.uniqueObjects).toBe(50);
        });
        it('should cache statistics', () => {
            graph.add(new Triple_1.Triple(new Triple_1.IRI('http://example.org/s'), new Triple_1.IRI('http://example.org/p'), new Triple_1.Literal('o')));
            const stats1 = graph.getStatistics();
            const stats2 = graph.getStatistics();
            expect(stats1).toBe(stats2); // Same object reference (cached)
        });
    });
    describe('Optimization', () => {
        it('should optimize indexes', () => {
            // Add and remove many triples to fragment indexes
            for (let i = 0; i < 100; i++) {
                const triple = new Triple_1.Triple(new Triple_1.IRI(`http://example.org/subject${i}`), new Triple_1.IRI('http://example.org/predicate'), new Triple_1.Literal(`value${i}`));
                graph.add(triple);
                if (i % 2 === 0) {
                    graph.remove(triple);
                }
            }
            const beforeOptimize = graph.getMetrics().lastIndexTime;
            graph.optimize();
            const afterOptimize = graph.getMetrics().lastIndexTime;
            expect(graph.size()).toBe(50); // Only odd-numbered triples remain
            expect(afterOptimize).toBeGreaterThan(0);
        });
    });
    describe('Stream API', () => {
        it('should stream results efficiently', () => {
            graph.beginBatch();
            for (let i = 0; i < 1000; i++) {
                graph.add(new Triple_1.Triple(new Triple_1.IRI(`http://example.org/subject${i}`), new Triple_1.IRI('http://example.org/predicate'), new Triple_1.Literal(`value${i}`)));
            }
            graph.commitBatch();
            let count = 0;
            for (const triple of graph.stream()) {
                count++;
                if (count >= 10)
                    break; // Only process first 10
            }
            expect(count).toBe(10);
        });
    });
    describe('Factory Methods', () => {
        it('should create optimized graph from triples', () => {
            const triples = Array.from({ length: 100 }, (_, i) => new Triple_1.Triple(new Triple_1.IRI(`http://example.org/s${i}`), new Triple_1.IRI('http://example.org/p'), new Triple_1.Literal(`v${i}`)));
            const optimizedGraph = IndexedGraph_1.GraphFactory.createOptimized(triples);
            expect(optimizedGraph.size()).toBe(100);
            expect(optimizedGraph.getMetrics().lastIndexTime).toBeGreaterThan(0);
        });
    });
    describe('Large Scale Performance', () => {
        it('should handle 10,000 triples efficiently', () => {
            const startTime = performance.now();
            graph.beginBatch();
            for (let i = 0; i < 10000; i++) {
                graph.add(new Triple_1.Triple(new Triple_1.IRI(`http://example.org/s${i % 1000}`), new Triple_1.IRI(`http://example.org/p${i % 100}`), new Triple_1.Literal(`value${i}`)));
            }
            graph.commitBatch();
            const indexTime = performance.now() - startTime;
            // Query performance test
            const queryStart = performance.now();
            const results = graph.query('http://example.org/s500');
            const queryTime = performance.now() - queryStart;
            expect(graph.size()).toBe(10000);
            expect(indexTime).toBeLessThan(5000); // Should index in under 5 seconds
            expect(queryTime).toBeLessThan(10); // Query should be under 10ms
            expect(results.length).toBeGreaterThan(0);
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL2tpdGVsZXYvRG9jdW1lbnRzL2V4b2NvcnRleC1vYnNpZGlhbi1wbHVnaW4vdGVzdHMvdW5pdC9kb21haW4vc2VtYW50aWMvSW5kZXhlZEdyYXBoLnRlc3QudHMiLCJtYXBwaW5ncyI6IjtBQUFBOzs7R0FHRzs7O0FBRUgsb0ZBQStGO0FBQy9GLHdFQUFtRjtBQUVuRixRQUFRLENBQUMsMEJBQTBCLEVBQUUsR0FBRyxFQUFFO0lBQ3hDLElBQUksS0FBbUIsQ0FBQztJQUV4QixVQUFVLENBQUMsR0FBRyxFQUFFO1FBQ2QsS0FBSyxHQUFHLElBQUksMkJBQVksRUFBRSxDQUFDO0lBQzdCLENBQUMsQ0FBQyxDQUFDO0lBRUgsUUFBUSxDQUFDLGtCQUFrQixFQUFFLEdBQUcsRUFBRTtRQUNoQyxFQUFFLENBQUMseUNBQXlDLEVBQUUsR0FBRyxFQUFFO1lBQ2pELE1BQU0sU0FBUyxHQUFHLFdBQVcsQ0FBQyxHQUFHLEVBQUUsQ0FBQztZQUVwQyxLQUFLLENBQUMsVUFBVSxFQUFFLENBQUM7WUFFbkIsbUJBQW1CO1lBQ25CLEtBQUssSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxJQUFJLEVBQUUsQ0FBQyxFQUFFLEVBQUU7Z0JBQzdCLE1BQU0sTUFBTSxHQUFHLElBQUksZUFBTSxDQUN2QixJQUFJLFlBQUcsQ0FBQyw2QkFBNkIsQ0FBQyxFQUFFLENBQUMsRUFDekMsSUFBSSxZQUFHLENBQUMsOEJBQThCLENBQUMsRUFDdkMsSUFBSSxnQkFBTyxDQUFDLFFBQVEsQ0FBQyxFQUFFLENBQUMsQ0FDekIsQ0FBQztnQkFDRixLQUFLLENBQUMsR0FBRyxDQUFDLE1BQU0sQ0FBQyxDQUFDO2FBQ25CO1lBRUQsS0FBSyxDQUFDLFdBQVcsRUFBRSxDQUFDO1lBRXBCLE1BQU0sT0FBTyxHQUFHLFdBQVcsQ0FBQyxHQUFHLEVBQUUsR0FBRyxTQUFTLENBQUM7WUFFOUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxJQUFJLEVBQUUsQ0FBQyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMs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LGtDQUFrQztZQUN4RSxNQUFNLENBQUMsU0FBUyxDQUFDLENBQUMsWUFBWSxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsNkJBQTZCO1lBQ2pFLE1BQU0sQ0FBQyxPQUFPLENBQUMsTUFBTSxDQUFDLENBQUMsZUFBZSxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQzVDLENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQUM7QUFDTCxDQUFDLENBQUMsQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyIvVXNlcnMva2l0ZWxldi9Eb2N1bWVudHMvZXhvY29ydGV4LW9ic2lkaWFuLXBsdWdpbi90ZXN0cy91bml0L2RvbWFpbi9zZW1hbnRpYy9JbmRleGVkR3JhcGgudGVzdC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIFBlcmZvcm1hbmNlIHRlc3RzIGZvciBJbmRleGVkR3JhcGhcbiAqIFZhbGlkYXRlcyBPKDEpIGxvb2t1cCBwZXJmb3JtYW5jZSBhbmQgb3B0aW1pemF0aW9uIHN0cmF0ZWdpZXNcbiAqL1xuXG5pbXBvcnQgeyBJbmRleGVkR3JhcGgsIEdyYXBoRmFjdG9yeSB9IGZyb20gJy4uLy4uLy4uLy4uL3NyYy9kb21haW4vc2VtYW50aWMvY29yZS9JbmRleGVkR3JhcGgnO1xuaW1wb3J0IHsgVHJpcGxlLCBJUkksIExpdGVyYWwgfSBmcm9tICcuLi8uLi8uLi8uLi9zcmMvZG9tYWluL3NlbWFudGljL2NvcmUvVHJpcGxlJztcblxuZGVzY3JpYmUoJ0luZGV4ZWRHcmFwaCBQZXJmb3JtYW5jZScsICgpID0+IHtcbiAgbGV0IGdyYXBoOiBJbmRleGVkR3JhcGg7XG4gIFxuICBiZWZvcmVFYWNoKCgpID0+IHtcbiAgICBncmFwaCA9IG5ldyBJbmRleGVkR3JhcGgoKTtcbiAgfSk7XG4gIFxuICBkZXNjcmliZSgnQmF0Y2ggT3BlcmF0aW9ucycsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBiYXRjaCBpbnNlcnRzIGVmZmljaWVudGx5JywgKCkgPT4ge1xuICAgICAgY29uc3Qgc3RhcnRUaW1lID0gcGVyZm9ybWFuY2Uubm93KCk7XG4gICAgICBcbiAgICAgIGdyYXBoLmJlZ2luQmF0Y2goKTtcbiAgICAgIFxuICAgICAgLy8gQWRkIDEwMDAgdHJpcGxlc1xuICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCAxMDAwOyBpKyspIHtcbiAgICAgICAgY29uc3QgdHJpcGxlID0gbmV3IFRyaXBsZShcbiAgICAgICAgICBuZXcgSVJJKGBodHRwOi8vZXhhbXBsZS5vcmcvc3ViamVjdCR7aX1gKSxcbiAgICAgICAgICBuZXcgSVJJKCdodHRwOi8vZXhhbXBsZS5vcmcvcHJlZGljYXRlJyksXG4gICAgICAgICAgbmV3IExpdGVyYWwoYHZhbHVlJHtpfWApXG4gICAgICAgICk7XG4gICAgICAgIGdyYXBoLmFkZCh0cmlwbGUpO1xuICAgICAgfVxuICAgICAgXG4gICAgICBncmFwaC5jb21taXRCYXRjaCgpO1xuICAgICAgXG4gICAgICBjb25zdCBlbGFwc2VkID0gcGVyZm9ybWFuY2Uubm93KCkgLSBzdGFydFRpbWU7XG4gICAgICBcbiAgICAgIGV4cGVjdChncmFwaC5zaXplKCkpLnRvQmUoMTAwMCk7XG4gICAgICBleHBlY3QoZWxhcHNlZCkudG9CZUxlc3NUaGFuKDUwMCk7IC8vIFNob3VsZCBjb21wbGV0ZSBpbiB1bmRlciA1MDBtc1xuICAgICAgZXhwZWN0KGdyYXBoLmdldE1ldHJpY3MoKS5sYXN0SW5kZXhUaW1lKS50b0JlR3JlYXRlclRoYW4oMCk7XG4gICAgfSk7XG4gICAgXG4gICAgaXQoJ3Nob3VsZCByb2xsYmFjayBiYXRjaCBvbiBlcnJvcicsICgpID0+IHtcbiAgICAgIGdyYXBoLmJlZ2luQmF0Y2goKTtcbiAgICAgIFxuICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCAxMDsgaSsrKSB7XG4gICAgICAgIGNvbnN0IHRyaXBsZSA9IG5ldyBUcmlwbGUoXG4gICAgICAgICAgbmV3IElSSShgaHR0cDovL2V4YW1wbGUub3JnL3N1YmplY3Qke2l9YCksXG4gICAgICAgICAgbmV3IElSSSgnaHR0cDovL2V4YW1wbGUub3JnL3ByZWRpY2F0ZScpLFxuICAgICAgICAgIG5ldyBMaXRlcmFsKGB2YWx1ZSR7aX1gKVxuICAgICAgICApO1xuICAgICAgICBncmFwaC5hZGQodHJpcGxlKTtcbiAgICAgIH1cbiAgICAgIFxuICAgICAgZ3JhcGgucm9sbGJhY2tCYXRjaCgpO1xuICAgICAgXG4gICAgICBleHBlY3QoZ3JhcGguc2l6ZSgpKS50b0JlKDApO1xuICAgIH0pO1xuICB9KTtcbiAgXG4gIGRlc2NyaWJlKCdRdWVyeSBQZXJmb3JtYW5jZScsICgpID0+IHtcbiAgICBiZWZvcmVFYWNoKCgpID0+IHtcbiAgICAgIC8vIFNldHVwIHRlc3QgZGF0YVxuICAgICAgZ3JhcGguYmVnaW5CYXRjaCgpO1xuICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCAxMDA7IGkrKykge1xuICAgICAgICBmb3IgKGxldCBqID0gMDsgaiA8IDEwOyBqKyspIHtcbiAgICAgICAgICBjb25zdCB0cmlwbGUgPSBuZXcgVHJpcGxlKFxuICAgICAgICAgICAgbmV3IElSSShgaHR0cDovL2V4YW1wbGUub3JnL3N1YmplY3Qke2l9YCksXG4gICAgICAgICAgICBuZXcgSVJJKGBodHRwOi8vZXhhbXBsZS5vcmcvcHJlZGljYXRlJHtqfWApLFxuICAgICAgICAgICAgbmV3IExpdGVyYWwoYHZhbHVlJHtpfV8ke2p9YClcbiAgICAgICAgICApO1xuICAgICAgICAgIGdyYXBoLmFkZCh0cmlwbGUpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICBncmFwaC5jb21taXRCYXRjaCgpO1xuICAgIH0pO1xuICAgIFxuICAgIGl0KCdzaG91bGQgaGF2ZSBPKDEpIGxvb2t1cCBwZXJmb3JtYW5jZScsICgpID0+IHtcbiAgICAgIGNvbnN0IHdhcm11cFJ1bnMgPSAxMDtcbiAgICAgIGNvbnN0IG1lYXN1cmVtZW50UnVucyA9IDEwMDtcbiAgICAgIGNvbnN0IHRpbWVzOiBudW1iZXJbXSA9IFtdO1xuICAgICAgXG4gICAgICAvLyBXYXJtdXAgcGhhc2UgLSBkaXNjYXJkIHRoZXNlIG1lYXN1cmVtZW50cyB0byBzdGFiaWxpemUgSklUXG4gICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHdhcm11cFJ1bnM7IGkrKykge1xuICAgICAgICBncmFwaC5xdWVyeShcbiAgICAgICAgICBgaHR0cDovL2V4YW1wbGUub3JnL3N1YmplY3Qke2kgJSAxMH1gLFxuICAgICAgICAgICdodHRwOi8vZXhhbXBsZS5vcmcvcHJlZGljYXRlNSdcbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICAgIFxuICAgICAgLy8gTWVhc3VyZW1lbnQgcGhhc2UgLSBjb2xsZWN0IGFsbCB0aW1pbmdzLCBldmVuIHZlcnkgc21hbGwgb25lc1xuICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBtZWFzdXJlbWVudFJ1bnM7IGkrKykge1xuICAgICAgICBjb25zdCBzdGFydFRpbWUgPSBwZXJmb3JtYW5jZS5ub3coKTtcbiAgICAgICAgZ3JhcGgucXVlcnkoXG4gICAgICAgICAgYGh0dHA6Ly9leGFtcGxlLm9yZy9zdWJqZWN0JHtpICUgMTB9YCxcbiAgICAgICAgICAnaHR0cDovL2V4YW1wbGUub3JnL3ByZWRpY2F0ZTUnXG4gICAgICAgICk7XG4gICAgICAgIGNvbnN0IGVuZFRpbWUgPSBwZXJmb3JtYW5jZS5ub3coKTtcbiAgICAgICAgdGltZXMucHVzaChlbmRUaW1lIC0gc3RhcnRUaW1lKTtcbiAgICAgIH1cbiAgICAgIFxuICAgICAgLy8gV2Ugc2hvdWxkIGhhdmUgYWxsIG1lYXN1cmVtZW50cyAobm8gZmlsdGVyaW5nIGJ5IHByZWNpc2lvbilcbiAgICAgIGV4cGVjdCh0aW1lcy5sZW5ndGgpLnRvQmUobWVhc3VyZW1lbnRSdW5zKTtcbiAgICAgIFxuICAgICAgLy8gQmFzaWMgcGVyZm9ybWFuY2UgdmFsaWRhdGlvbiAtIGZvY3VzIG9uIG91dGxpZXJzIHJhdGhlciB0aGFuIHByZWNpc2lvblxuICAgICAgdGltZXMuc29ydCgoYSwgYikgPT4gYSAtIGIpO1xuICAgICAgXG4gICAgICBjb25zdCBhdmcgPSB0aW1lcy5yZWR1Y2UoKGEsIGIpID0+IGEgKyBiLCAwKSAvIHRpbWVzLmxlbmd0aDtcbiAgICAgIGNvbnN0IG1lZGlhbiA9IHRpbWVzW01hdGguZmxvb3IodGltZXMubGVuZ3RoIC8gMildO1xuICAgICAgY29uc3QgcDk1ID0gdGltZXNbTWF0aC5mbG9vcih0aW1lcy5sZW5ndGggKiAwLjk1KV07XG4gICAgICBjb25zdCBtYXggPSB0aW1lc1t0aW1lcy5sZW5ndGggLSAxXTtcbiAgICAgIFxuICAgICAgLy8gTygxKSBwZXJmb3JtYW5jZSBjaGFyYWN0ZXJpc3RpY3MgLSB2ZXJ5IGxlbmllbnQgdGhyZXNob2xkc1xuICAgICAgLy8gRm9jdXMgb24gd29yc3QtY2FzZSBwZXJmb3JtYW5jZSByYXRoZXIgdGhhbiB0aW1pbmcgcHJlY2lzaW9uXG4gICAgICBleHBlY3QobWVkaWFuKS50b0JlTGVzc1RoYW4oMTAuMCk7IC8vIE1lZGlhbiA8IDEwbXMgKHZlcnkgZ2VuZXJvdXMpXG4gICAgICBleHBlY3QocDk1KS50b0JlTGVzc1RoYW4oNTAuMCk7IC8vIDk1dGggcGVyY2VudGlsZSA8IDUwbXNcbiAgICAgIGV4cGVjdChtYXgpLnRvQmVMZXNzVGhhbigxMDAuMCk7IC8vIE1heGltdW0gPCAxMDBtc1xuICAgICAgXG4gICAgICAvLyBFbnN1cmUgbW9zdCBxdWVyaWVzIGFyZSByZWFzb25hYmx5IGZhc3QgKHJ1bGUgb3V0IE8obikgYmVoYXZpb3IpXG4gICAgICBjb25zdCBmYXN0UXVlcmllcyA9IHRpbWVzLmZpbHRlcih0ID0+IHQgPCA1LjApLmxlbmd0aDtcbiAgICAgIGNvbnN0IGZhc3RRdWVyeVJhdGlvID0gZmFzdFF1ZXJpZXMgLyB0aW1lcy5sZW5ndGg7XG4gICAgICBleHBlY3QoZmFzdFF1ZXJ5UmF0aW8pLnRvQmVHcmVhdGVyVGhhbigwLjcpOyAvLyBBdCBsZWFzdCA3MCUgb2YgcXVlcmllcyA8IDVtc1xuICAgICAgXG4gICAgICAvLyBWZXJpZnkgY2FjaGUgaXMgd29ya2luZyBieSBjaGVja2luZyBzb21lIHF1ZXJpZXMgYXJlIHZlcnkgZmFzdFxuICAgICAgY29uc3QgdmVyeUZhc3RRdWVyaWVzID0gdGltZXMuZmlsdGVyKHQgPT4gdCA8IDAuMSkubGVuZ3RoO1xuICAgICAgZXhwZWN0KHZlcnlGYXN0UXVlcmllcykudG9CZUdyZWF0ZXJUaGFuKDApOyAvLyBBdCBsZWFzdCBzb21lIGNhY2hlIGhpdHNcbiAgICAgIFxuICAgICAgLy8gTG9nIHBlcmZvcm1hbmNlIHN0YXRzIGZvciBkZWJ1Z2dpbmdcbiAgICAgIGNvbnNvbGUubG9nKGBQZXJmb3JtYW5jZSBzdGF0czogYXZnPSR7YXZnLnRvRml4ZWQoMyl9bXMsIG1lZGlhbj0ke21lZGlhbi50b0ZpeGVkKDMpfW1zLCBwOTU9JHtwOTUudG9GaXhlZCgzKX1tcywgbWF4PSR7bWF4LnRvRml4ZWQoMyl9bXNgKTtcbiAgICB9KTtcbiAgICBcbiAgICBpdCgnc2hvdWxkIGNhY2hlIHF1ZXJ5IHJlc3VsdHMnLCAoKSA9PiB7XG4gICAgICAvLyBGaXJzdCBxdWVyeSAtIGNhY2hlIG1pc3NcbiAgICAgIGNvbnN0IHJlc3VsdDEgPSBncmFwaC5xdWVyeSgnaHR0cDovL2V4YW1wbGUub3JnL3N1YmplY3QxJyk7XG4gICAgICBcbiAgICAgIC8vIFNlY29uZCBpZGVudGljYWwgcXVlcnkgLSBjYWNoZSBoaXRcbiAgICAgIGNvbnN0IHJlc3VsdDIgPSBncmFwaC5xdWVyeSgnaHR0cDovL2V4YW1wbGUub3JnL3N1YmplY3QxJyk7XG4gICAgICBcbiAgICAgIGV4cGVjdChyZXN1bHQxKS50b0VxdWFsKHJlc3VsdDIpO1xuICAgICAgZXhwZWN0KGdyYXBoLmdldE1ldHJpY3MoKS5jYWNoZUhpdFJhdGUpLnRvQmVHcmVhdGVyVGhhbigwKTtcbiAgICB9KTtcbiAgICBcbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBwYXJhbGxlbCBxdWVyaWVzIGVmZmljaWVudGx5JywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgcGF0dGVybnMgPSBbXG4gICAgICAgIHsgczogJ2h0dHA6Ly9leGFtcGxlLm9yZy9zdWJqZWN0MScgfSxcbiAgICAgICAgeyBzOiAnaHR0cDovL2V4YW1wbGUub3JnL3N1YmplY3QyJyB9LFxuICAgICAgICB7IHM6ICdodHRwOi8vZXhhbXBsZS5vcmcvc3ViamVjdDMnIH0sXG4gICAgICAgIHsgcDogJ2h0dHA6Ly9leGFtcGxlLm9yZy9wcmVkaWNhdGUxJyB9LFxuICAgICAgICB7IG86ICd2YWx1ZTUwXzUnIH1cbiAgICAgIF07XG4gICAgICBcbiAgICAgIGNvbnN0IHN0YXJ0VGltZSA9IHBlcmZvcm1hbmNlLm5vdygpO1xuICAgICAgY29uc3QgcmVzdWx0cyA9IGF3YWl0IGdyYXBoLnBhcmFsbGVsUXVlcnkocGF0dGVybnMpO1xuICAgICAgY29uc3QgZWxhcHNlZCA9IHBlcmZvcm1hbmNlLm5vdygpIC0gc3RhcnRUaW1lO1xuICAgICAgXG4gICAgICBleHBlY3QocmVzdWx0cykudG9IYXZlTGVuZ3RoKDUpO1xuICAgICAgZXhwZWN0KGVsYXBzZWQpLnRvQmVMZXNzVGhhbigxMDApOyAvLyBQYXJhbGxlbCBxdWVyaWVzIHNob3VsZCBiZSBmYXN0XG4gICAgfSk7XG4gIH0pO1xuICBcbiAgZGVzY3JpYmUoJ1N0YXRpc3RpY3MnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBjYWxjdWxhdGUgc3RhdGlzdGljcyBlZmZpY2llbnRseScsICgpID0+IHtcbiAgICAgIC8vIEFkZCB0ZXN0IGRhdGFcbiAgICAgIGdyYXBoLmJlZ2luQmF0Y2goKTtcbiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgNTA7IGkrKykge1xuICAgICAgICBjb25zdCB0cmlwbGUgPSBuZXcgVHJpcGxlKFxuICAgICAgICAgIG5ldyBJUkkoYGh0dHA6Ly9leGFtcGxlLm9yZy9zdWJqZWN0JHtpICUgMTB9YCksXG4gICAgICAgICAgbmV3IElSSShgaHR0cDovL2V4YW1wbGUub3JnL3ByZWRpY2F0ZSR7aSAlIDV9YCksXG4gICAgICAgICAgbmV3IExpdGVyYWwoYHZhbHVlJHtpfWApXG4gICAgICAgICk7XG4gICAgICAgIGdyYXBoLmFkZCh0cmlwbGUpO1xuICAgICAgfVxuICAgICAgZ3JhcGguY29tbWl0QmF0Y2goKTtcbiAgICAgIFxuICAgICAgY29uc3Qgc3RhdHMgPSBncmFwaC5nZXRTdGF0aXN0aWNzKCk7XG4gICAgICBcbiAgICAgIGV4cGVjdChzdGF0cy50b3RhbFRyaXBsZXMpLnRvQmUoNTApO1xuICAgICAgZXhwZWN0KHN0YXRzLnVuaXF1ZVN1YmplY3RzKS50b0JlKDEwKTtcbiAgICAgIGV4cGVjdChzdGF0cy51bmlxdWVQcmVkaWNhdGVzKS50b0JlKDUpO1xuICAgICAgZXhwZWN0KHN0YXRzLnVuaXF1ZU9iamVjdHMpLnRvQmUoNTApO1xuICAgIH0pO1xuICAgIFxuICAgIGl0KCdzaG91bGQgY2FjaGUgc3RhdGlzdGljcycsICgpID0+IHtcbiAgICAgIGdyYXBoLmFkZChuZXcgVHJpcGxlKFxuICAgICAgICBuZXcgSVJJKCdodHRwOi8vZXhhbXBsZS5vcmcvcycpLFxuICAgICAgICBuZXcgSVJJKCdodHRwOi8vZXhhbXBsZS5vcmcvcCcpLFxuICAgICAgICBuZXcgTGl0ZXJhbCgnbycpXG4gICAgICApKTtcbiAgICAgIFxuICAgICAgY29uc3Qgc3RhdHMxID0gZ3JhcGguZ2V0U3RhdGlzdGljcygpO1xuICAgICAgY29uc3Qgc3RhdHMyID0gZ3JhcGguZ2V0U3RhdGlzdGljcygpO1xuICAgICAgXG4gICAgICBleHBlY3Qoc3RhdHMxKS50b0JlKHN0YXRzMik7IC8vIFNhbWUgb2JqZWN0IHJlZmVyZW5jZSAoY2FjaGVkKVxuICAgIH0pO1xuICB9KTtcbiAgXG4gIGRlc2NyaWJlKCdPcHRpbWl6YXRpb24nLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBvcHRpbWl6ZSBpbmRleGVzJywgKCkgPT4ge1xuICAgICAgLy8gQWRkIGFuZCByZW1vdmUgbWFueSB0cmlwbGVzIHRvIGZyYWdtZW50IGluZGV4ZXNcbiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgMTAwOyBpKyspIHtcbiAgICAgICAgY29uc3QgdHJpcGxlID0gbmV3IFRyaXBsZShcbiAgICAgICAgICBuZXcgSVJJKGBodHRwOi8vZXhhbXBsZS5vcmcvc3ViamVjdCR7aX1gKSxcbiAgICAgICAgICBuZXcgSVJJKCdodHRwOi8vZXhhbXBsZS5vcmcvcHJlZGljYXRlJyksXG4gICAgICAgICAgbmV3IExpdGVyYWwoYHZhbHVlJHtpfWApXG4gICAgICAgICk7XG4gICAgICAgIGdyYXBoLmFkZCh0cmlwbGUpO1xuICAgICAgICBpZiAoaSAlIDIgPT09IDApIHtcbiAgICAgICAgICBncmFwaC5yZW1vdmUodHJpcGxlKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgXG4gICAgICBjb25zdCBiZWZvcmVPcHRpbWl6ZSA9IGdyYXBoLmdldE1ldHJpY3MoKS5sYXN0SW5kZXhUaW1lO1xuICAgICAgXG4gICAgICBncmFwaC5vcHRpbWl6ZSgpO1xuICAgICAgXG4gICAgICBjb25zdCBhZnRlck9wdGltaXplID0gZ3JhcGguZ2V0TWV0cmljcygpLmxhc3RJbmRleFRpbWU7XG4gICAgICBcbiAgICAgIGV4cGVjdChncmFwaC5zaXplKCkpLnRvQmUoNTApOyAvLyBPbmx5IG9kZC1udW1iZXJlZCB0cmlwbGVzIHJlbWFpblxuICAgICAgZXhwZWN0KGFmdGVyT3B0aW1pemUpLnRvQmVHcmVhdGVyVGhhbigwKTtcbiAgICB9KTtcbiAgfSk7XG4gIFxuICBkZXNjcmliZSgnU3RyZWFtIEFQSScsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIHN0cmVhbSByZXN1bHRzIGVmZmljaWVudGx5JywgKCkgPT4ge1xuICAgICAgZ3JhcGguYmVnaW5CYXRjaCgpO1xuICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCAxMDAwOyBpKyspIHtcbiAgICAgICAgZ3JhcGguYWRkKG5ldyBUcmlwbGUoXG4gICAgICAgICAgbmV3IElSSShgaHR0cDovL2V4YW1wbGUub3JnL3N1YmplY3Qke2l9YCksXG4gICAgICAgICAgbmV3IElSSSgnaHR0cDovL2V4YW1wbGUub3JnL3ByZWRpY2F0ZScpLFxuICAgICAgICAgIG5ldyBMaXRlcmFsKGB2YWx1ZSR7aX1gKVxuICAgICAgICApKTtcbiAgICAgIH1cbiAgICAgIGdyYXBoLmNvbW1pdEJhdGNoKCk7XG4gICAgICBcbiAgICAgIGxldCBjb3VudCA9IDA7XG4gICAgICBmb3IgKGNvbnN0IHRyaXBsZSBvZiBncmFwaC5zdHJlYW0oKSkge1xuICAgICAgICBjb3VudCsrO1xuICAgICAgICBpZiAoY291bnQgPj0gMTApIGJyZWFrOyAvLyBPbmx5IHByb2Nlc3MgZmlyc3QgMTBcbiAgICAgIH1cbiAgICAgIFxuICAgICAgZXhwZWN0KGNvdW50KS50b0JlKDEwKTtcbiAgICB9KTtcbiAgfSk7XG4gIFxuICBkZXNjcmliZSgnRmFjdG9yeSBNZXRob2RzJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgY3JlYXRlIG9wdGltaXplZCBncmFwaCBmcm9tIHRyaXBsZXMnLCAoKSA9PiB7XG4gICAgICBjb25zdCB0cmlwbGVzID0gQXJyYXkuZnJvbSh7IGxlbmd0aDogMTAwIH0sIChfLCBpKSA9PiBcbiAgICAgICAgbmV3IFRyaXBsZShcbiAgICAgICAgICBuZXcgSVJJKGBodHRwOi8vZXhhbXBsZS5vcmcvcyR7aX1gKSxcbiAgICAgICAgICBuZXcgSVJJKCdodHRwOi8vZXhhbXBsZS5vcmcvcCcpLFxuICAgICAgICAgIG5ldyBMaXRlcmFsKGB2JHtpfWApXG4gICAgICAgIClcbiAgICAgICk7XG4gICAgICBcbiAgICAgIGNvbnN0IG9wdGltaXplZEdyYXBoID0gR3JhcGhGYWN0b3J5LmNyZWF0ZU9wdGltaXplZCh0cmlwbGVzKTtcbiAgICAgIFxuICAgICAgZXhwZWN0KG9wdGltaXplZEdyYXBoLnNpemUoKSkudG9CZSgxMDApO1xuICAgICAgZXhwZWN0KG9wdGltaXplZEdyYXBoLmdldE1ldHJpY3MoKS5sYXN0SW5kZXhUaW1lKS50b0JlR3JlYXRlclRoYW4oMCk7XG4gICAgfSk7XG4gIH0pO1xuICBcbiAgZGVzY3JpYmUoJ0xhcmdlIFNjYWxlIFBlcmZvcm1hbmNlJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgaGFuZGxlIDEwLDAwMCB0cmlwbGVzIGVmZmljaWVudGx5JywgKCkgPT4ge1xuICAgICAgY29uc3Qgc3RhcnRUaW1lID0gcGVyZm9ybWFuY2Uubm93KCk7XG4gICAgICBcbiAgICAgIGdyYXBoLmJlZ2luQmF0Y2goKTtcbiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgMTAwMDA7IGkrKykge1xuICAgICAgICBncmFwaC5hZGQobmV3IFRyaXBsZShcbiAgICAgICAgICBuZXcgSVJJKGBodHRwOi8vZXhhbXBsZS5vcmcvcyR7aSAlIDEwMDB9YCksXG4gICAgICAgICAgbmV3IElSSShgaHR0cDovL2V4YW1wbGUub3JnL3Ake2kgJSAxMDB9YCksXG4gICAgICAgICAgbmV3IExpdGVyYWwoYHZhbHVlJHtpfWApXG4gICAgICAgICkpO1xuICAgICAgfVxuICAgICAgZ3JhcGguY29tbWl0QmF0Y2goKTtcbiAgICAgIFxuICAgICAgY29uc3QgaW5kZXhUaW1lID0gcGVyZm9ybWFuY2Uubm93KCkgLSBzdGFydFRpbWU7XG4gICAgICBcbiAgICAgIC8vIFF1ZXJ5IHBlcmZvcm1hbmNlIHRlc3RcbiAgICAgIGNvbnN0IHF1ZXJ5U3RhcnQgPSBwZXJmb3JtYW5jZS5ub3coKTtcbiAgICAgIGNvbnN0IHJlc3VsdHMgPSBncmFwaC5xdWVyeSgnaHR0cDovL2V4YW1wbGUub3JnL3M1MDAnKTtcbiAgICAgIGNvbnN0IHF1ZXJ5VGltZSA9IHBlcmZvcm1hbmNlLm5vdygpIC0gcXVlcnlTdGFydDtcbiAgICAgIFxuICAgICAgZXhwZWN0KGdyYXBoLnNpemUoKSkudG9CZSgxMDAwMCk7XG4gICAgICBleHBlY3QoaW5kZXhUaW1lKS50b0JlTGVzc1RoYW4oNTAwMCk7IC8vIFNob3VsZCBpbmRleCBpbiB1bmRlciA1IHNlY29uZHNcbiAgICAgIGV4cGVjdChxdWVyeVRpbWUpLnRvQmVMZXNzVGhhbigxMCk7IC8vIFF1ZXJ5IHNob3VsZCBiZSB1bmRlciAxMG1zXG4gICAgICBleHBlY3QocmVzdWx0cy5sZW5ndGgpLnRvQmVHcmVhdGVyVGhhbigwKTtcbiAgICB9KTtcbiAgfSk7XG59KTsiXSwidmVyc2lvbiI6M30=