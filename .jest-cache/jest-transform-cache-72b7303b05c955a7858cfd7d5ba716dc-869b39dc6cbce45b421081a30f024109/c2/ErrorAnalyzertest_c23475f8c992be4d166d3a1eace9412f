05eafd3bb78fcfceefdf3b509d76f297
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const ErrorAnalyzer_1 = require("../../../../src/domain/errors/ErrorAnalyzer");
const ExocortexError_1 = require("../../../../src/domain/errors/ExocortexError");
describe('ErrorAnalyzer', () => {
    describe('analyze', () => {
        it('should recognize SPARQL syntax errors', () => {
            const error = new Error("Unexpected token '}' at position 42");
            const result = ErrorAnalyzer_1.ErrorAnalyzer.analyze(error);
            expect(result.severity).toBe(ExocortexError_1.ErrorSeverity.ERROR);
            expect(result.category).toBe(ExocortexError_1.ErrorCategory.SYNTAX);
            expect(result.title).toBe('SPARQL Syntax Error');
            expect(result.message).toContain("Unexpected '}' at position 42");
            expect(result.suggestions).toBeDefined();
            expect(result.suggestions.length).toBeGreaterThan(0);
            expect(result.recoverable).toBe(true);
        });
        it('should recognize unknown prefix errors', () => {
            const error = new Error('Unknown prefix: foaf');
            const result = ErrorAnalyzer_1.ErrorAnalyzer.analyze(error);
            expect(result.severity).toBe(ExocortexError_1.ErrorSeverity.ERROR);
            expect(result.category).toBe(ExocortexError_1.ErrorCategory.SEMANTIC);
            expect(result.title).toBe('Unknown Prefix');
            expect(result.message).toContain("prefix 'foaf' is not defined");
            expect(result.suggestions[0].title).toBe('Add PREFIX Declaration');
            expect(result.suggestions[0].confidence).toBe(0.95);
        });
        it('should recognize query timeout errors', () => {
            const error = new Error('Query timeout after 5000ms');
            const result = ErrorAnalyzer_1.ErrorAnalyzer.analyze(error);
            expect(result.severity).toBe(ExocortexError_1.ErrorSeverity.WARNING);
            expect(result.category).toBe(ExocortexError_1.ErrorCategory.SYSTEM);
            expect(result.title).toBe('Query Timeout');
            expect(result.message).toContain('5000ms');
            expect(result.suggestions).toBeDefined();
            expect(result.suggestions.some(s => s.title === 'Add LIMIT Clause')).toBe(true);
        });
        it('should recognize invalid IRI errors', () => {
            const error = new Error('Invalid IRI: not-a-valid-iri');
            const result = ErrorAnalyzer_1.ErrorAnalyzer.analyze(error);
            expect(result.severity).toBe(ExocortexError_1.ErrorSeverity.ERROR);
            expect(result.category).toBe(ExocortexError_1.ErrorCategory.VALIDATION);
            expect(result.title).toBe('Invalid IRI');
            expect(result.message).toContain('not-a-valid-iri');
            expect(result.suggestions).toBeDefined();
        });
        it('should handle empty result set as info', () => {
            const error = new Error('Empty result set');
            const result = ErrorAnalyzer_1.ErrorAnalyzer.analyze(error);
            expect(result.severity).toBe(ExocortexError_1.ErrorSeverity.INFO);
            expect(result.category).toBe(ExocortexError_1.ErrorCategory.SEMANTIC);
            expect(result.title).toBe('No Results Found');
            expect(result.recoverable).toBe(true);
        });
        it('should handle circular reference warnings', () => {
            const error = new Error('Circular reference detected');
            const result = ErrorAnalyzer_1.ErrorAnalyzer.analyze(error);
            expect(result.severity).toBe(ExocortexError_1.ErrorSeverity.WARNING);
            expect(result.category).toBe(ExocortexError_1.ErrorCategory.SEMANTIC);
            expect(result.title).toBe('Circular Reference');
            expect(result.suggestions.some(s => s.title === 'Review Ontology Structure')).toBe(true);
        });
        it('should handle unknown errors with default values', () => {
            const error = new Error('Some random error message');
            const result = ErrorAnalyzer_1.ErrorAnalyzer.analyze(error);
            expect(result.severity).toBe(ExocortexError_1.ErrorSeverity.ERROR);
            expect(result.category).toBe(ExocortexError_1.ErrorCategory.SYSTEM);
            expect(result.title).toBe('Unknown Error');
            expect(result.message).toContain('unexpected error occurred');
            expect(result.recoverable).toBe(false);
        });
        it('should handle string errors', () => {
            const result = ErrorAnalyzer_1.ErrorAnalyzer.analyze('Simple error string');
            expect(result.severity).toBe(ExocortexError_1.ErrorSeverity.ERROR);
            expect(result.category).toBe(ExocortexError_1.ErrorCategory.SYSTEM);
            expect(result.technicalDetails).toBe('Simple error string');
        });
        it('should preserve stack traces', () => {
            const error = new Error('Test error with stack');
            const result = ErrorAnalyzer_1.ErrorAnalyzer.analyze(error);
            expect(result.stackTrace).toBeDefined();
            expect(result.stackTrace).toContain('Test error with stack');
        });
    });
    describe('getSPARQLErrorLocation', () => {
        it('should calculate line and column from position', () => {
            const query = 'SELECT ?s ?p ?o\nWHERE {\n  ?s ?p ?o .\n}';
            const position = 24; // Position in the third line (0-indexed: 24 = line 3, col 1)
            const location = ErrorAnalyzer_1.ErrorAnalyzer.getSPARQLErrorLocation(query, position);
            expect(location).toBeDefined();
            expect(location.line).toBe(3);
            expect(location.column).toBe(1);
        });
        it('should handle single line queries', () => {
            const query = 'SELECT ?s WHERE { ?s ?p ?o }';
            const position = 10;
            const location = ErrorAnalyzer_1.ErrorAnalyzer.getSPARQLErrorLocation(query, position);
            expect(location).toBeDefined();
            expect(location.line).toBe(1);
            expect(location.column).toBe(11);
        });
        it('should return undefined for invalid positions', () => {
            const query = 'SELECT ?s WHERE { ?s ?p ?o }';
            expect(ErrorAnalyzer_1.ErrorAnalyzer.getSPARQLErrorLocation(query, -1)).toBeUndefined();
            expect(ErrorAnalyzer_1.ErrorAnalyzer.getSPARQLErrorLocation(query, 1000)).toBeUndefined();
            expect(ErrorAnalyzer_1.ErrorAnalyzer.getSPARQLErrorLocation(query, undefined)).toBeUndefined();
        });
        it('should handle multi-line queries correctly', () => {
            const query = `PREFIX ex: <http://example.org/>
SELECT ?subject ?predicate ?object
WHERE {
  ?subject ?predicate ?object .
  FILTER (?object > 10)
}`;
            const position = 70; // Position in WHERE clause
            const location = ErrorAnalyzer_1.ErrorAnalyzer.getSPARQLErrorLocation(query, position);
            expect(location).toBeDefined();
            expect(location.line).toBe(3);
        });
    });
    describe('pattern management', () => {
        beforeEach(() => {
            ErrorAnalyzer_1.ErrorAnalyzer.clearPatterns();
        });
        it('should allow adding custom patterns', () => {
            ErrorAnalyzer_1.ErrorAnalyzer.addPattern({
                pattern: /custom error (\d+)/i,
                severity: ExocortexError_1.ErrorSeverity.WARNING,
                category: ExocortexError_1.ErrorCategory.SYSTEM,
                title: 'Custom Error',
                getUserMessage: (match) => `Custom error code: ${match[1]}`,
                getSuggestions: () => [{
                        title: 'Custom Fix',
                        description: 'Apply custom fix',
                        confidence: 0.8
                    }],
                recoverable: true
            });
            const error = new Error('Custom error 42');
            const result = ErrorAnalyzer_1.ErrorAnalyzer.analyze(error);
            expect(result.title).toBe('Custom Error');
            expect(result.message).toBe('Custom error code: 42');
            expect(result.suggestions[0].title).toBe('Custom Fix');
        });
        it('should handle empty pattern list gracefully', () => {
            ErrorAnalyzer_1.ErrorAnalyzer.clearPatterns();
            const error = new Error('Any error');
            const result = ErrorAnalyzer_1.ErrorAnalyzer.analyze(error);
            expect(result.title).toBe('Unknown Error');
            expect(result.category).toBe(ExocortexError_1.ErrorCategory.SYSTEM);
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL2tpdGVsZXYvRG9jdW1lbnRzL2V4b2NvcnRleC1vYnNpZGlhbi1wbHVnaW4vdGVzdHMvdW5pdC9kb21haW4vZXJyb3JzL0Vycm9yQW5hbHl6ZXIudGVzdC50cyIsIm1hcHBpbmdzIjoiOztBQUFBLCtFQUE0RTtBQUM1RSxpRkFBNEY7QUFFNUYsUUFBUSxDQUFDLGVBQWUsRUFBRSxHQUFHLEVBQUU7SUFDM0IsUUFBUSxDQUFDLFNBQVMsRUFBRSxHQUFHLEVBQUU7UUFDckIsRUFBRSxDQUFDLHVDQUF1QyxFQUFFLEdBQUcsRUFBRTtZQUM3QyxNQUFNLEtBQUssR0FBRyxJQUFJLEtBQUssQ0FBQyxxQ0FBcUMsQ0FBQyxDQUFDO1lBQy9ELE1BQU0sTUFBTSxHQUFHLDZCQUFhLENBQUMsT0FBTyxDQUFDLEtBQUssQ0FBQyxDQUFDO1lBRTVDLE1BQU0sQ0FBQyxNQUFNLENBQUMsUUFBUSxDQUFDLENBQUMsSUFBSSxDQUFDLDhCQUFhLENBQUMsS0FBSyxDQUFDLENBQUM7WUFDbEQsTUFBTSxDQUFDLE1BQU0sQ0FBQyxRQUFRLENBQUMsQ0FBQyxJQUFJLENBQUMsOEJBQWEsQ0FBQyxNQUFNLENBQUMsQ0FBQztZQUNuRCxNQUFNLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxDQUFDLElBQUksQ0FBQyxxQkFBcUIsQ0FBQyxDQUFDO1lBQ2pELE1BQU0sQ0FBQyxNQUFNLENBQUMsT0FBTyxDQUFDLENBQUMsU0FBUyxDQUFDLCtCQUErQixDQUFDLENBQUM7WUFDbEUsTUFBTSxDQUFDLE1BQU0sQ0FBQyxXQUFXLENBQUMsQ0FBQyxXQUFXLEVBQUUsQ0FBQztZQUN6QyxNQUFNLENBQUMsTUFBTSxDQUFDLFdBQVksQ0FBQyxNQUFNLENBQUMsQ0FBQyxlQUFlLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDdEQsTUFBTSxDQUFDLE1BQU0sQ0FBQyxXQUFXLENBQUMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDMUMsQ0FBQyxDQUFDLENBQUM7UUFFSCxFQUFFLENBQUMsd0NBQXdDLEVB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RSxHQUFHLEVBQUU7WUFDbkQsNkJBQWEsQ0FBQyxhQUFhLEVBQUUsQ0FBQztZQUU5QixNQUFNLEtBQUssR0FBRyxJQUFJLEtBQUssQ0FBQyxXQUFXLENBQUMsQ0FBQztZQUNyQyxNQUFNLE1BQU0sR0FBRyw2QkFBYSxDQUFDLE9BQU8sQ0FBQyxLQUFLLENBQUMsQ0FBQztZQUU1QyxNQUFNLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxDQUFDLElBQUksQ0FBQyxlQUFlLENBQUMsQ0FBQztZQUMzQyxNQUFNLENBQUMsTUFBTSxDQUFDLFFBQVEsQ0FBQyxDQUFDLElBQUksQ0FBQyw4QkFBYSxDQUFDLE1BQU0sQ0FBQyxDQUFDO1FBQ3ZELENBQUMsQ0FBQyxDQUFDO0lBQ1AsQ0FBQyxDQUFDLENBQUM7QUFDUCxDQUFDLENBQUMsQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyIvVXNlcnMva2l0ZWxldi9Eb2N1bWVudHMvZXhvY29ydGV4LW9ic2lkaWFuLXBsdWdpbi90ZXN0cy91bml0L2RvbWFpbi9lcnJvcnMvRXJyb3JBbmFseXplci50ZXN0LnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEVycm9yQW5hbHl6ZXIgfSBmcm9tICcuLi8uLi8uLi8uLi9zcmMvZG9tYWluL2Vycm9ycy9FcnJvckFuYWx5emVyJztcbmltcG9ydCB7IEVycm9yU2V2ZXJpdHksIEVycm9yQ2F0ZWdvcnkgfSBmcm9tICcuLi8uLi8uLi8uLi9zcmMvZG9tYWluL2Vycm9ycy9FeG9jb3J0ZXhFcnJvcic7XG5cbmRlc2NyaWJlKCdFcnJvckFuYWx5emVyJywgKCkgPT4ge1xuICAgIGRlc2NyaWJlKCdhbmFseXplJywgKCkgPT4ge1xuICAgICAgICBpdCgnc2hvdWxkIHJlY29nbml6ZSBTUEFSUUwgc3ludGF4IGVycm9ycycsICgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGVycm9yID0gbmV3IEVycm9yKFwiVW5leHBlY3RlZCB0b2tlbiAnfScgYXQgcG9zaXRpb24gNDJcIik7XG4gICAgICAgICAgICBjb25zdCByZXN1bHQgPSBFcnJvckFuYWx5emVyLmFuYWx5emUoZXJyb3IpO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICBleHBlY3QocmVzdWx0LnNldmVyaXR5KS50b0JlKEVycm9yU2V2ZXJpdHkuRVJST1IpO1xuICAgICAgICAgICAgZXhwZWN0KHJlc3VsdC5jYXRlZ29yeSkudG9CZShFcnJvckNhdGVnb3J5LlNZTlRBWCk7XG4gICAgICAgICAgICBleHBlY3QocmVzdWx0LnRpdGxlKS50b0JlKCdTUEFSUUwgU3ludGF4IEVycm9yJyk7XG4gICAgICAgICAgICBleHBlY3QocmVzdWx0Lm1lc3NhZ2UpLnRvQ29udGFpbihcIlVuZXhwZWN0ZWQgJ30nIGF0IHBvc2l0aW9uIDQyXCIpO1xuICAgICAgICAgICAgZXhwZWN0KHJlc3VsdC5zdWdnZXN0aW9ucykudG9CZURlZmluZWQoKTtcbiAgICAgICAgICAgIGV4cGVjdChyZXN1bHQuc3VnZ2VzdGlvbnMhLmxlbmd0aCkudG9CZUdyZWF0ZXJUaGFuKDApO1xuICAgICAgICAgICAgZXhwZWN0KHJlc3VsdC5yZWNvdmVyYWJsZSkudG9CZSh0cnVlKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgaXQoJ3Nob3VsZCByZWNvZ25pemUgdW5rbm93biBwcmVmaXggZXJyb3JzJywgKCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgZXJyb3IgPSBuZXcgRXJyb3IoJ1Vua25vd24gcHJlZml4OiBmb2FmJyk7XG4gICAgICAgICAgICBjb25zdCByZXN1bHQgPSBFcnJvckFuYWx5emVyLmFuYWx5emUoZXJyb3IpO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICBleHBlY3QocmVzdWx0LnNldmVyaXR5KS50b0JlKEVycm9yU2V2ZXJpdHkuRVJST1IpO1xuICAgICAgICAgICAgZXhwZWN0KHJlc3VsdC5jYXRlZ29yeSkudG9CZShFcnJvckNhdGVnb3J5LlNFTUFOVElDKTtcbiAgICAgICAgICAgIGV4cGVjdChyZXN1bHQudGl0bGUpLnRvQmUoJ1Vua25vd24gUHJlZml4Jyk7XG4gICAgICAgICAgICBleHBlY3QocmVzdWx0Lm1lc3NhZ2UpLnRvQ29udGFpbihcInByZWZpeCAnZm9hZicgaXMgbm90IGRlZmluZWRcIik7XG4gICAgICAgICAgICBleHBlY3QocmVzdWx0LnN1Z2dlc3Rpb25zIVswXS50aXRsZSkudG9CZSgnQWRkIFBSRUZJWCBEZWNsYXJhdGlvbicpO1xuICAgICAgICAgICAgZXhwZWN0KHJlc3VsdC5zdWdnZXN0aW9ucyFbMF0uY29uZmlkZW5jZSkudG9CZSgwLjk1KTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgaXQoJ3Nob3VsZCByZWNvZ25pemUgcXVlcnkgdGltZW91dCBlcnJvcnMnLCAoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBlcnJvciA9IG5ldyBFcnJvcignUXVlcnkgdGltZW91dCBhZnRlciA1MDAwbXMnKTtcbiAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IEVycm9yQW5hbHl6ZXIuYW5hbHl6ZShlcnJvcik7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGV4cGVjdChyZXN1bHQuc2V2ZXJpdHkpLnRvQmUoRXJyb3JTZXZlcml0eS5XQVJOSU5HKTtcbiAgICAgICAgICAgIGV4cGVjdChyZXN1bHQuY2F0ZWdvcnkpLnRvQmUoRXJyb3JDYXRlZ29yeS5TWVNURU0pO1xuICAgICAgICAgICAgZXhwZWN0KHJlc3VsdC50aXRsZSkudG9CZSgnUXVlcnkgVGltZW91dCcpO1xuICAgICAgICAgICAgZXhwZWN0KHJlc3VsdC5tZXNzYWdlKS50b0NvbnRhaW4oJzUwMDBtcycpO1xuICAgICAgICAgICAgZXhwZWN0KHJlc3VsdC5zdWdnZXN0aW9ucykudG9CZURlZmluZWQoKTtcbiAgICAgICAgICAgIGV4cGVjdChyZXN1bHQuc3VnZ2VzdGlvbnMhLnNvbWUocyA9PiBzLnRpdGxlID09PSAnQWRkIExJTUlUIENsYXVzZScpKS50b0JlKHRydWUpO1xuICAgICAgICB9KTtcblxuICAgICAgICBpdCgnc2hvdWxkIHJlY29nbml6ZSBpbnZhbGlkIElSSSBlcnJvcnMnLCAoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBlcnJvciA9IG5ldyBFcnJvcignSW52YWxpZCBJUkk6IG5vdC1hLXZhbGlkLWlyaScpO1xuICAgICAgICAgICAgY29uc3QgcmVzdWx0ID0gRXJyb3JBbmFseXplci5hbmFseXplKGVycm9yKTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgZXhwZWN0KHJlc3VsdC5zZXZlcml0eSkudG9CZShFcnJvclNldmVyaXR5LkVSUk9SKTtcbiAgICAgICAgICAgIGV4cGVjdChyZXN1bHQuY2F0ZWdvcnkpLnRvQmUoRXJyb3JDYXRlZ29yeS5WQUxJREFUSU9OKTtcbiAgICAgICAgICAgIGV4cGVjdChyZXN1bHQudGl0bGUpLnRvQmUoJ0ludmFsaWQgSVJJJyk7XG4gICAgICAgICAgICBleHBlY3QocmVzdWx0Lm1lc3NhZ2UpLnRvQ29udGFpbignbm90LWEtdmFsaWQtaXJpJyk7XG4gICAgICAgICAgICBleHBlY3QocmVzdWx0LnN1Z2dlc3Rpb25zKS50b0JlRGVmaW5lZCgpO1xuICAgICAgICB9KTtcblxuICAgICAgICBpdCgnc2hvdWxkIGhhbmRsZSBlbXB0eSByZXN1bHQgc2V0IGFzIGluZm8nLCAoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBlcnJvciA9IG5ldyBFcnJvcignRW1wdHkgcmVzdWx0IHNldCcpO1xuICAgICAgICAgICAgY29uc3QgcmVzdWx0ID0gRXJyb3JBbmFseXplci5hbmFseXplKGVycm9yKTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgZXhwZWN0KHJlc3VsdC5zZXZlcml0eSkudG9CZShFcnJvclNldmVyaXR5LklORk8pO1xuICAgICAgICAgICAgZXhwZWN0KHJlc3VsdC5jYXRlZ29yeSkudG9CZShFcnJvckNhdGVnb3J5LlNFTUFOVElDKTtcbiAgICAgICAgICAgIGV4cGVjdChyZXN1bHQudGl0bGUpLnRvQmUoJ05vIFJlc3VsdHMgRm91bmQnKTtcbiAgICAgICAgICAgIGV4cGVjdChyZXN1bHQucmVjb3ZlcmFibGUpLnRvQmUodHJ1ZSk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGl0KCdzaG91bGQgaGFuZGxlIGNpcmN1bGFyIHJlZmVyZW5jZSB3YXJuaW5ncycsICgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGVycm9yID0gbmV3IEVycm9yKCdDaXJjdWxhciByZWZlcmVuY2UgZGV0ZWN0ZWQnKTtcbiAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IEVycm9yQW5hbHl6ZXIuYW5hbHl6ZShlcnJvcik7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGV4cGVjdChyZXN1bHQuc2V2ZXJpdHkpLnRvQmUoRXJyb3JTZXZlcml0eS5XQVJOSU5HKTtcbiAgICAgICAgICAgIGV4cGVjdChyZXN1bHQuY2F0ZWdvcnkpLnRvQmUoRXJyb3JDYXRlZ29yeS5TRU1BTlRJQyk7XG4gICAgICAgICAgICBleHBlY3QocmVzdWx0LnRpdGxlKS50b0JlKCdDaXJjdWxhciBSZWZlcmVuY2UnKTtcbiAgICAgICAgICAgIGV4cGVjdChyZXN1bHQuc3VnZ2VzdGlvbnMhLnNvbWUocyA9PiBzLnRpdGxlID09PSAnUmV2aWV3IE9udG9sb2d5IFN0cnVjdHVyZScpKS50b0JlKHRydWUpO1xuICAgICAgICB9KTtcblxuICAgICAgICBpdCgnc2hvdWxkIGhhbmRsZSB1bmtub3duIGVycm9ycyB3aXRoIGRlZmF1bHQgdmFsdWVzJywgKCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgZXJyb3IgPSBuZXcgRXJyb3IoJ1NvbWUgcmFuZG9tIGVycm9yIG1lc3NhZ2UnKTtcbiAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IEVycm9yQW5hbHl6ZXIuYW5hbHl6ZShlcnJvcik7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGV4cGVjdChyZXN1bHQuc2V2ZXJpdHkpLnRvQmUoRXJyb3JTZXZlcml0eS5FUlJPUik7XG4gICAgICAgICAgICBleHBlY3QocmVzdWx0LmNhdGVnb3J5KS50b0JlKEVycm9yQ2F0ZWdvcnkuU1lTVEVNKTtcbiAgICAgICAgICAgIGV4cGVjdChyZXN1bHQudGl0bGUpLnRvQmUoJ1Vua25vd24gRXJyb3InKTtcbiAgICAgICAgICAgIGV4cGVjdChyZXN1bHQubWVzc2FnZSkudG9Db250YWluKCd1bmV4cGVjdGVkIGVycm9yIG9jY3VycmVkJyk7XG4gICAgICAgICAgICBleHBlY3QocmVzdWx0LnJlY292ZXJhYmxlKS50b0JlKGZhbHNlKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgaXQoJ3Nob3VsZCBoYW5kbGUgc3RyaW5nIGVycm9ycycsICgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IEVycm9yQW5hbHl6ZXIuYW5hbHl6ZSgnU2ltcGxlIGVycm9yIHN0cmluZycpO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICBleHBlY3QocmVzdWx0LnNldmVyaXR5KS50b0JlKEVycm9yU2V2ZXJpdHkuRVJST1IpO1xuICAgICAgICAgICAgZXhwZWN0KHJlc3VsdC5jYXRlZ29yeSkudG9CZShFcnJvckNhdGVnb3J5LlNZU1RFTSk7XG4gICAgICAgICAgICBleHBlY3QocmVzdWx0LnRlY2huaWNhbERldGFpbHMpLnRvQmUoJ1NpbXBsZSBlcnJvciBzdHJpbmcnKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgaXQoJ3Nob3VsZCBwcmVzZXJ2ZSBzdGFjayB0cmFjZXMnLCAoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBlcnJvciA9IG5ldyBFcnJvcignVGVzdCBlcnJvciB3aXRoIHN0YWNrJyk7XG4gICAgICAgICAgICBjb25zdCByZXN1bHQgPSBFcnJvckFuYWx5emVyLmFuYWx5emUoZXJyb3IpO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICBleHBlY3QocmVzdWx0LnN0YWNrVHJhY2UpLnRvQmVEZWZpbmVkKCk7XG4gICAgICAgICAgICBleHBlY3QocmVzdWx0LnN0YWNrVHJhY2UpLnRvQ29udGFpbignVGVzdCBlcnJvciB3aXRoIHN0YWNrJyk7XG4gICAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgZGVzY3JpYmUoJ2dldFNQQVJRTEVycm9yTG9jYXRpb24nLCAoKSA9PiB7XG4gICAgICAgIGl0KCdzaG91bGQgY2FsY3VsYXRlIGxpbmUgYW5kIGNvbHVtbiBmcm9tIHBvc2l0aW9uJywgKCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgcXVlcnkgPSAnU0VMRUNUID9zID9wID9vXFxuV0hFUkUge1xcbiAgP3MgP3AgP28gLlxcbn0nO1xuICAgICAgICAgICAgY29uc3QgcG9zaXRpb24gPSAyNDsgLy8gUG9zaXRpb24gaW4gdGhlIHRoaXJkIGxpbmUgKDAtaW5kZXhlZDogMjQgPSBsaW5lIDMsIGNvbCAxKVxuICAgICAgICAgICAgXG4gICAgICAgICAgICBjb25zdCBsb2NhdGlvbiA9IEVycm9yQW5hbHl6ZXIuZ2V0U1BBUlFMRXJyb3JMb2NhdGlvbihxdWVyeSwgcG9zaXRpb24pO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICBleHBlY3QobG9jYXRpb24pLnRvQmVEZWZpbmVkKCk7XG4gICAgICAgICAgICBleHBlY3QobG9jYXRpb24hLmxpbmUpLnRvQmUoMyk7XG4gICAgICAgICAgICBleHBlY3QobG9jYXRpb24hLmNvbHVtbikudG9CZSgxKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgaXQoJ3Nob3VsZCBoYW5kbGUgc2luZ2xlIGxpbmUgcXVlcmllcycsICgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHF1ZXJ5ID0gJ1NFTEVDVCA/cyBXSEVSRSB7ID9zID9wID9vIH0nO1xuICAgICAgICAgICAgY29uc3QgcG9zaXRpb24gPSAxMDtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgY29uc3QgbG9jYXRpb24gPSBFcnJvckFuYWx5emVyLmdldFNQQVJRTEVycm9yTG9jYXRpb24ocXVlcnksIHBvc2l0aW9uKTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgZXhwZWN0KGxvY2F0aW9uKS50b0JlRGVmaW5lZCgpO1xuICAgICAgICAgICAgZXhwZWN0KGxvY2F0aW9uIS5saW5lKS50b0JlKDEpO1xuICAgICAgICAgICAgZXhwZWN0KGxvY2F0aW9uIS5jb2x1bW4pLnRvQmUoMTEpO1xuICAgICAgICB9KTtcblxuICAgICAgICBpdCgnc2hvdWxkIHJldHVybiB1bmRlZmluZWQgZm9yIGludmFsaWQgcG9zaXRpb25zJywgKCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgcXVlcnkgPSAnU0VMRUNUID9zIFdIRVJFIHsgP3MgP3AgP28gfSc7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGV4cGVjdChFcnJvckFuYWx5emVyLmdldFNQQVJRTEVycm9yTG9jYXRpb24ocXVlcnksIC0xKSkudG9CZVVuZGVmaW5lZCgpO1xuICAgICAgICAgICAgZXhwZWN0KEVycm9yQW5hbHl6ZXIuZ2V0U1BBUlFMRXJyb3JMb2NhdGlvbihxdWVyeSwgMTAwMCkpLnRvQmVVbmRlZmluZWQoKTtcbiAgICAgICAgICAgIGV4cGVjdChFcnJvckFuYWx5emVyLmdldFNQQVJRTEVycm9yTG9jYXRpb24ocXVlcnksIHVuZGVmaW5lZCBhcyBhbnkpKS50b0JlVW5kZWZpbmVkKCk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGl0KCdzaG91bGQgaGFuZGxlIG11bHRpLWxpbmUgcXVlcmllcyBjb3JyZWN0bHknLCAoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBxdWVyeSA9IGBQUkVGSVggZXg6IDxodHRwOi8vZXhhbXBsZS5vcmcvPlxuU0VMRUNUID9zdWJqZWN0ID9wcmVkaWNhdGUgP29iamVjdFxuV0hFUkUge1xuICA/c3ViamVjdCA/cHJlZGljYXRlID9vYmplY3QgLlxuICBGSUxURVIgKD9vYmplY3QgPiAxMClcbn1gO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICBjb25zdCBwb3NpdGlvbiA9IDcwOyAvLyBQb3NpdGlvbiBpbiBXSEVSRSBjbGF1c2VcbiAgICAgICAgICAgIGNvbnN0IGxvY2F0aW9uID0gRXJyb3JBbmFseXplci5nZXRTUEFSUUxFcnJvckxvY2F0aW9uKHF1ZXJ5LCBwb3NpdGlvbik7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGV4cGVjdChsb2NhdGlvbikudG9CZURlZmluZWQoKTtcbiAgICAgICAgICAgIGV4cGVjdChsb2NhdGlvbiEubGluZSkudG9CZSgzKTtcbiAgICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBkZXNjcmliZSgncGF0dGVybiBtYW5hZ2VtZW50JywgKCkgPT4ge1xuICAgICAgICBiZWZvcmVFYWNoKCgpID0+IHtcbiAgICAgICAgICAgIEVycm9yQW5hbHl6ZXIuY2xlYXJQYXR0ZXJucygpO1xuICAgICAgICB9KTtcblxuICAgICAgICBpdCgnc2hvdWxkIGFsbG93IGFkZGluZyBjdXN0b20gcGF0dGVybnMnLCAoKSA9PiB7XG4gICAgICAgICAgICBFcnJvckFuYWx5emVyLmFkZFBhdHRlcm4oe1xuICAgICAgICAgICAgICAgIHBhdHRlcm46IC9jdXN0b20gZXJyb3IgKFxcZCspL2ksXG4gICAgICAgICAgICAgICAgc2V2ZXJpdHk6IEVycm9yU2V2ZXJpdHkuV0FSTklORyxcbiAgICAgICAgICAgICAgICBjYXRlZ29yeTogRXJyb3JDYXRlZ29yeS5TWVNURU0sXG4gICAgICAgICAgICAgICAgdGl0bGU6ICdDdXN0b20gRXJyb3InLFxuICAgICAgICAgICAgICAgIGdldFVzZXJNZXNzYWdlOiAobWF0Y2gpID0+IGBDdXN0b20gZXJyb3IgY29kZTogJHttYXRjaFsxXX1gLFxuICAgICAgICAgICAgICAgIGdldFN1Z2dlc3Rpb25zOiAoKSA9PiBbe1xuICAgICAgICAgICAgICAgICAgICB0aXRsZTogJ0N1c3RvbSBGaXgnLFxuICAgICAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbjogJ0FwcGx5IGN1c3RvbSBmaXgnLFxuICAgICAgICAgICAgICAgICAgICBjb25maWRlbmNlOiAwLjhcbiAgICAgICAgICAgICAgICB9XSxcbiAgICAgICAgICAgICAgICByZWNvdmVyYWJsZTogdHJ1ZVxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGNvbnN0IGVycm9yID0gbmV3IEVycm9yKCdDdXN0b20gZXJyb3IgNDInKTtcbiAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IEVycm9yQW5hbHl6ZXIuYW5hbHl6ZShlcnJvcik7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGV4cGVjdChyZXN1bHQudGl0bGUpLnRvQmUoJ0N1c3RvbSBFcnJvcicpO1xuICAgICAgICAgICAgZXhwZWN0KHJlc3VsdC5tZXNzYWdlKS50b0JlKCdDdXN0b20gZXJyb3IgY29kZTogNDInKTtcbiAgICAgICAgICAgIGV4cGVjdChyZXN1bHQuc3VnZ2VzdGlvbnMhWzBdLnRpdGxlKS50b0JlKCdDdXN0b20gRml4Jyk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGl0KCdzaG91bGQgaGFuZGxlIGVtcHR5IHBhdHRlcm4gbGlzdCBncmFjZWZ1bGx5JywgKCkgPT4ge1xuICAgICAgICAgICAgRXJyb3JBbmFseXplci5jbGVhclBhdHRlcm5zKCk7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGNvbnN0IGVycm9yID0gbmV3IEVycm9yKCdBbnkgZXJyb3InKTtcbiAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IEVycm9yQW5hbHl6ZXIuYW5hbHl6ZShlcnJvcik7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGV4cGVjdChyZXN1bHQudGl0bGUpLnRvQmUoJ1Vua25vd24gRXJyb3InKTtcbiAgICAgICAgICAgIGV4cGVjdChyZXN1bHQuY2F0ZWdvcnkpLnRvQmUoRXJyb3JDYXRlZ29yeS5TWVNURU0pO1xuICAgICAgICB9KTtcbiAgICB9KTtcbn0pOyJdLCJ2ZXJzaW9uIjozfQ==