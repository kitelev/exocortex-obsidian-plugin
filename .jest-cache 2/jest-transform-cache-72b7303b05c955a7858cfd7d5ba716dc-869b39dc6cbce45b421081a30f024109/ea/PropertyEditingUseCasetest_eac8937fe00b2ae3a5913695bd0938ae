3dbf07bbf760172aa865a25ca5ed7eaa
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const PropertyEditingUseCase_1 = require("../../src/application/use-cases/PropertyEditingUseCase");
const Asset_1 = require("../../src/domain/entities/Asset");
const AssetId_1 = require("../../src/domain/value-objects/AssetId");
const ClassName_1 = require("../../src/domain/value-objects/ClassName");
const OntologyPrefix_1 = require("../../src/domain/value-objects/OntologyPrefix");
describe('PropertyEditingUseCase Integration', () => {
    let useCase;
    let mockRepository;
    let mockPlugin;
    beforeEach(() => {
        mockRepository = {
            findById: jest.fn(),
            findByFilename: jest.fn(),
            findByClass: jest.fn(),
            findByOntology: jest.fn(),
            save: jest.fn(),
            delete: jest.fn(),
            exists: jest.fn(),
            findAll: jest.fn()
        };
        mockPlugin = {
            findPropertiesForClass: jest.fn(),
            findAssetsByClass: jest.fn()
        };
        useCase = new PropertyEditingUseCase_1.PropertyEditingUseCase(mockRepository, mockPlugin);
    });
    afterEach(() => {
        jest.clearAllMocks();
        jest.clearAllTimers();
        // Clear references to prevent memory leaks
        mockRepository = null;
        mockPlugin = null;
        useCase = null;
    });
    describe('execute with different asset identifiers', () => {
        const testAsset = Asset_1.Asset.create({
            id: AssetId_1.AssetId.generate(),
            label: 'Test Asset',
            className: ClassName_1.ClassName.create('TestClass').getValue(),
            ontology: OntologyPrefix_1.OntologyPrefix.create('test').getValue(),
            properties: { testProp: 'oldValue' }
        }).getValue();
        it('should find asset by UUID and update property', async () => {
            mockRepository.findById.mockResolvedValue(testAsset);
            mockRepository.save.mockResolvedValue(undefined);
            const result = await useCase.execute({
                assetId: testAsset.getId().toString(),
                propertyName: 'testProp',
                value: 'newValue',
                propertyDefinition: {
                    propertyName: 'testProp',
                    label: 'Test Property',
                    range: 'string',
                    isRequired: false
                }
            });
            expect(result.isSuccess).toBe(true);
            expect(mockRepository.findById).toHaveBeenCalled();
            expect(mockRepository.save).toHaveBeenCalled();
        });
        it('should fallback to filename when UUID not found', async () => {
            mockRepository.findById.mockResolvedValue(null);
            mockRepository.findByFilename.mockResolvedValue(testAsset);
            mockRepository.save.mockResolvedValue(undefined);
            const result = await useCase.execute({
                assetId: 'MyAsset.md',
                propertyName: 'testProp',
                value: 'newValue',
                propertyDefinition: {
                    propertyName: 'testProp',
                    label: 'Test Property',
                    range: 'string',
                    isRequired: false
                }
            });
            expect(result.isSuccess).toBe(true);
            expect(mockRepository.findById).toHaveBeenCalled();
            expect(mockRepository.findByFilename).toHaveBeenCalledWith('MyAsset.md');
            expect(mockRepository.save).toHaveBeenCalled();
        });
        it('should handle filename without extension', async () => {
            mockRepository.findById.mockResolvedValue(null);
            mockRepository.findByFilename.mockResolvedValue(testAsset);
            mockRepository.save.mockResolvedValue(undefined);
            const result = await useCase.execute({
                assetId: 'MyAsset',
                propertyName: 'testProp',
                value: 'newValue',
                propertyDefinition: {
                    propertyName: 'testProp',
                    label: 'Test Property',
                    range: 'string',
                    isRequired: false
                }
            });
            expect(result.isSuccess).toBe(true);
            expect(mockRepository.findByFilename).toHaveBeenCalledWith('MyAsset');
        });
        it('should return error when asset not found by any method', async () => {
            mockRepository.findById.mockResolvedValue(null);
            mockRepository.findByFilename.mockResolvedValue(null);
            const result = await useCase.execute({
                assetId: 'NonExistent',
                propertyName: 'testProp',
                value: 'newValue',
                propertyDefinition: {
                    propertyName: 'testProp',
                    label: 'Test Property',
                    range: 'string',
                    isRequired: false
                }
            });
            expect(result.isFailure).toBe(true);
            expect(result.error).toContain('Asset not found');
        });
        it('should handle file paths as identifiers', async () => {
            mockRepository.findById.mockResolvedValue(null);
            mockRepository.findByFilename.mockResolvedValue(testAsset);
            mockRepository.save.mockResolvedValue(undefined);
            const result = await useCase.execute({
                assetId: 'folder/subfolder/MyAsset.md',
                propertyName: 'testProp',
                value: 'newValue',
                propertyDefinition: {
                    propertyName: 'testProp',
                    label: 'Test Property',
                    range: 'string',
                    isRequired: false
                }
            });
            expect(result.isSuccess).toBe(true);
            expect(mockRepository.findByFilename).toHaveBeenCalledWith('folder/subfolder/MyAsset.md');
        });
    });
    describe('property validation', () => {
        const testAsset = Asset_1.Asset.create({
            id: AssetId_1.AssetId.generate(),
            label: 'Test Asset',
            className: ClassName_1.ClassName.create('TestClass').getValue(),
            ontology: OntologyPrefix_1.OntologyPrefix.create('test').getValue(),
            properties: {}
        }).getValue();
        beforeEach(() => {
            mockRepository.findById.mockResolvedValue(testAsset);
            mockRepository.save.mockResolvedValue(undefined);
        });
        it('should validate required fields', async () => {
            const result = await useCase.execute({
                assetId: 'test-id',
                propertyName: 'requiredProp',
                value: '',
                propertyDefinition: {
                    propertyName: 'requiredProp',
                    label: 'Required Property',
                    range: 'string',
                    isRequired: true
                }
            });
            expect(result.isFailure).toBe(true);
            expect(result.error).toContain('Required Property is required');
        });
        it('should allow empty values for optional fields', async () => {
            const result = await useCase.execute({
                assetId: 'test-id',
                propertyName: 'optionalProp',
                value: '',
                propertyDefinition: {
                    propertyName: 'optionalProp',
                    label: 'Optional Property',
                    range: 'string',
                    isRequired: false
                }
            });
            expect(result.isSuccess).toBe(true);
        });
        it('should validate enum values', async () => {
            const result = await useCase.execute({
                assetId: 'test-id',
                propertyName: 'statusProp',
                value: 'invalid',
                propertyDefinition: {
                    propertyName: 'statusProp',
                    label: 'Status',
                    range: 'enum:pending,active,completed',
                    isRequired: true
                }
            });
            expect(result.isFailure).toBe(true);
            expect(result.error).toContain('Status must be one of: pending, active, completed');
        });
        it('should validate date format', async () => {
            const result = await useCase.execute({
                assetId: 'test-id',
                propertyName: 'dateProp',
                value: 'not-a-date',
                propertyDefinition: {
                    propertyName: 'dateProp',
                    label: 'Date',
                    range: 'date',
                    isRequired: true
                }
            });
            expect(result.isFailure).toBe(true);
            expect(result.error).toContain('Date must be a valid date');
        });
        it('should validate custom regex patterns', async () => {
            const result = await useCase.execute({
                assetId: 'test-id',
                propertyName: 'emailProp',
                value: 'invalid-email',
                propertyDefinition: {
                    propertyName: 'emailProp',
                    label: 'Email',
                    range: 'string',
                    isRequired: true,
                    validation: '^[\\w\\.-]+@[\\w\\.-]+\\.\\w+$'
                }
            });
            expect(result.isFailure).toBe(true);
            expect(result.error).toContain('Email format is invalid');
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL2tpdGVsZXYvRG9jdW1lbnRzL2V4b2NvcnRleC1vYnNpZGlhbi1wbHVnaW4vdGVzdHMvaW50ZWdyYXRpb24vUHJvcGVydHlFZGl0aW5nVXNlQ2FzZS50ZXN0LnRzIiwibWFwcGluZ3MiOiI7O0FBQUEsbUdBQWdHO0FBRWhHLDJEQUF3RDtBQUN4RCxvRUFBaUU7QUFDakUsd0VBQXFFO0FBQ3JFLGtGQUErRTtBQUUvRSxRQUFRLENBQUMsb0NBQW9DLEVBQUUsR0FBRyxFQUFFO0lBQ2hELElBQUksT0FBK0IsQ0FBQztJQUNwQyxJQUFJLGNBQTZDLENBQUM7SUFDbEQsSUFBSSxVQUFlLENBQUM7SUFFcEIsVUFBVSxDQUFDLEdBQUcsRUFBRTtRQUNaLGNBQWMsR0FBRztZQUNiLFFBQVEsRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO1lBQ25CLGNBQWMsRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO1lBQ3pCLFdBQVcsRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO1lBQ3RCLGNBQWMsRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO1lBQ3pCLElBQUksRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO1lBQ2YsTUFBTSxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7WUFDakIsTUFBTSxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7WUFDakIsT0FBTyxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7U0FDZCxDQUFDO1FBRVQsVUFBVSxHQUFHO1lBQ1Qsc0JBQXNCLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtZQUNqQyxpQkFBaUIsRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO1NBQy9CLENBQUM7UUFFRixPQUFPLEdBQUcsSUFBSSwrQ0FBc0IsQ0FBQyxjQUFjLEVBQUUsVUFBVSxDQUFDLENBQUM7SUFDckUsQ0FBQyxDQUFDLENBQUM7SUFFSCxTQUFTLENBQUMsR0FBRyxFQUFFO1FBQ1gsSUFBSSxDQUFDLGFBQWEsRUFBRSxDQUFDO1FBQ3JCLElBQUksQ0FBQyxjQUFjLEVBQUUsQ0FBQztRQUN0Qiwy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QUFFO29CQUNoQixZQUFZLEVBQUUsVUFBVTtvQkFDeEIsS0FBSyxFQUFFLE1BQU07b0JBQ2IsS0FBSyxFQUFFLE1BQU07b0JBQ2IsVUFBVSxFQUFFLElBQUk7aUJBQ25CO2FBQ0osQ0FBQyxDQUFDO1lBRUgsTUFBTSxDQUFDLE1BQU0sQ0FBQyxTQUFTLENBQUMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7WUFDcEMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsQ0FBQyxTQUFTLENBQUMsMkJBQTJCLENBQUMsQ0FBQztRQUNoRSxDQUFDLENBQUMsQ0FBQztRQUVILEVBQUUsQ0FBQyx1Q0FBdUMsRUFBRSxLQUFLLElBQUksRUFBRTtZQUNuRCxNQUFNLE1BQU0sR0FBRyxNQUFNLE9BQU8sQ0FBQyxPQUFPLENBQUM7Z0JBQ2pDLE9BQU8sRUFBRSxTQUFTO2dCQUNsQixZQUFZLEVBQUUsV0FBVztnQkFDekIsS0FBSyxFQUFFLGVBQWU7Z0JBQ3RCLGtCQUFrQixFQUFFO29CQUNoQixZQUFZLEVBQUUsV0FBVztvQkFDekIsS0FBSyxFQUFFLE9BQU87b0JBQ2QsS0FBSyxFQUFFLFFBQVE7b0JBQ2YsVUFBVSxFQUFFLElBQUk7b0JBQ2hCLFVBQVUsRUFBRSxnQ0FBZ0M7aUJBQy9DO2FBQ0osQ0FBQyxDQUFDO1lBRUgsTUFBTSxDQUFDLE1BQU0sQ0FBQyxTQUFTLENBQUMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7WUFDcEMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsQ0FBQyxTQUFTLENBQUMseUJBQXlCLENBQUMsQ0FBQztRQUM5RCxDQUFDLENBQUMsQ0FBQztJQUNQLENBQUMsQ0FBQyxDQUFDO0FBQ1AsQ0FBQyxDQUFDLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL1VzZXJzL2tpdGVsZXYvRG9jdW1lbnRzL2V4b2NvcnRleC1vYnNpZGlhbi1wbHVnaW4vdGVzdHMvaW50ZWdyYXRpb24vUHJvcGVydHlFZGl0aW5nVXNlQ2FzZS50ZXN0LnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFByb3BlcnR5RWRpdGluZ1VzZUNhc2UgfSBmcm9tICcuLi8uLi9zcmMvYXBwbGljYXRpb24vdXNlLWNhc2VzL1Byb3BlcnR5RWRpdGluZ1VzZUNhc2UnO1xuaW1wb3J0IHsgSUFzc2V0UmVwb3NpdG9yeSB9IGZyb20gJy4uLy4uL3NyYy9kb21haW4vcmVwb3NpdG9yaWVzL0lBc3NldFJlcG9zaXRvcnknO1xuaW1wb3J0IHsgQXNzZXQgfSBmcm9tICcuLi8uLi9zcmMvZG9tYWluL2VudGl0aWVzL0Fzc2V0JztcbmltcG9ydCB7IEFzc2V0SWQgfSBmcm9tICcuLi8uLi9zcmMvZG9tYWluL3ZhbHVlLW9iamVjdHMvQXNzZXRJZCc7XG5pbXBvcnQgeyBDbGFzc05hbWUgfSBmcm9tICcuLi8uLi9zcmMvZG9tYWluL3ZhbHVlLW9iamVjdHMvQ2xhc3NOYW1lJztcbmltcG9ydCB7IE9udG9sb2d5UHJlZml4IH0gZnJvbSAnLi4vLi4vc3JjL2RvbWFpbi92YWx1ZS1vYmplY3RzL09udG9sb2d5UHJlZml4JztcblxuZGVzY3JpYmUoJ1Byb3BlcnR5RWRpdGluZ1VzZUNhc2UgSW50ZWdyYXRpb24nLCAoKSA9PiB7XG4gICAgbGV0IHVzZUNhc2U6IFByb3BlcnR5RWRpdGluZ1VzZUNhc2U7XG4gICAgbGV0IG1vY2tSZXBvc2l0b3J5OiBqZXN0Lk1vY2tlZDxJQXNzZXRSZXBvc2l0b3J5PjtcbiAgICBsZXQgbW9ja1BsdWdpbjogYW55O1xuXG4gICAgYmVmb3JlRWFjaCgoKSA9PiB7XG4gICAgICAgIG1vY2tSZXBvc2l0b3J5ID0ge1xuICAgICAgICAgICAgZmluZEJ5SWQ6IGplc3QuZm4oKSxcbiAgICAgICAgICAgIGZpbmRCeUZpbGVuYW1lOiBqZXN0LmZuKCksXG4gICAgICAgICAgICBmaW5kQnlDbGFzczogamVzdC5mbigpLFxuICAgICAgICAgICAgZmluZEJ5T250b2xvZ3k6IGplc3QuZm4oKSxcbiAgICAgICAgICAgIHNhdmU6IGplc3QuZm4oKSxcbiAgICAgICAgICAgIGRlbGV0ZTogamVzdC5mbigpLFxuICAgICAgICAgICAgZXhpc3RzOiBqZXN0LmZuKCksXG4gICAgICAgICAgICBmaW5kQWxsOiBqZXN0LmZuKClcbiAgICAgICAgfSBhcyBhbnk7XG5cbiAgICAgICAgbW9ja1BsdWdpbiA9IHtcbiAgICAgICAgICAgIGZpbmRQcm9wZXJ0aWVzRm9yQ2xhc3M6IGplc3QuZm4oKSxcbiAgICAgICAgICAgIGZpbmRBc3NldHNCeUNsYXNzOiBqZXN0LmZuKClcbiAgICAgICAgfTtcblxuICAgICAgICB1c2VDYXNlID0gbmV3IFByb3BlcnR5RWRpdGluZ1VzZUNhc2UobW9ja1JlcG9zaXRvcnksIG1vY2tQbHVnaW4pO1xuICAgIH0pO1xuXG4gICAgYWZ0ZXJFYWNoKCgpID0+IHtcbiAgICAgICAgamVzdC5jbGVhckFsbE1vY2tzKCk7XG4gICAgICAgIGplc3QuY2xlYXJBbGxUaW1lcnMoKTtcbiAgICAgICAgLy8gQ2xlYXIgcmVmZXJlbmNlcyB0byBwcmV2ZW50IG1lbW9yeSBsZWFrc1xuICAgICAgICBtb2NrUmVwb3NpdG9yeSA9IG51bGwgYXMgYW55O1xuICAgICAgICBtb2NrUGx1Z2luID0gbnVsbCBhcyBhbnk7XG4gICAgICAgIHVzZUNhc2UgPSBudWxsIGFzIGFueTtcbiAgICB9KTtcblxuICAgIGRlc2NyaWJlKCdleGVjdXRlIHdpdGggZGlmZmVyZW50IGFzc2V0IGlkZW50aWZpZXJzJywgKCkgPT4ge1xuICAgICAgICBjb25zdCB0ZXN0QXNzZXQgPSBBc3NldC5jcmVhdGUoe1xuICAgICAgICAgICAgaWQ6IEFzc2V0SWQuZ2VuZXJhdGUoKSxcbiAgICAgICAgICAgIGxhYmVsOiAnVGVzdCBBc3NldCcsXG4gICAgICAgICAgICBjbGFzc05hbWU6IENsYXNzTmFtZS5jcmVhdGUoJ1Rlc3RDbGFzcycpLmdldFZhbHVlKCkhLFxuICAgICAgICAgICAgb250b2xvZ3k6IE9udG9sb2d5UHJlZml4LmNyZWF0ZSgndGVzdCcpLmdldFZhbHVlKCkhLFxuICAgICAgICAgICAgcHJvcGVydGllczogeyB0ZXN0UHJvcDogJ29sZFZhbHVlJyB9XG4gICAgICAgIH0pLmdldFZhbHVlKCkhO1xuXG4gICAgICAgIGl0KCdzaG91bGQgZmluZCBhc3NldCBieSBVVUlEIGFuZCB1cGRhdGUgcHJvcGVydHknLCBhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICBtb2NrUmVwb3NpdG9yeS5maW5kQnlJZC5tb2NrUmVzb2x2ZWRWYWx1ZSh0ZXN0QXNzZXQpO1xuICAgICAgICAgICAgbW9ja1JlcG9zaXRvcnkuc2F2ZS5tb2NrUmVzb2x2ZWRWYWx1ZSh1bmRlZmluZWQpO1xuXG4gICAgICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB1c2VDYXNlLmV4ZWN1dGUoe1xuICAgICAgICAgICAgICAgIGFzc2V0SWQ6IHRlc3RBc3NldC5nZXRJZCgpLnRvU3RyaW5nKCksXG4gICAgICAgICAgICAgICAgcHJvcGVydHlOYW1lOiAndGVzdFByb3AnLFxuICAgICAgICAgICAgICAgIHZhbHVlOiAnbmV3VmFsdWUnLFxuICAgICAgICAgICAgICAgIHByb3BlcnR5RGVmaW5pdGlvbjoge1xuICAgICAgICAgICAgICAgICAgICBwcm9wZXJ0eU5hbWU6ICd0ZXN0UHJvcCcsXG4gICAgICAgICAgICAgICAgICAgIGxhYmVsOiAnVGVzdCBQcm9wZXJ0eScsXG4gICAgICAgICAgICAgICAgICAgIHJhbmdlOiAnc3RyaW5nJyxcbiAgICAgICAgICAgICAgICAgICAgaXNSZXF1aXJlZDogZmFsc2VcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgZXhwZWN0KHJlc3VsdC5pc1N1Y2Nlc3MpLnRvQmUodHJ1ZSk7XG4gICAgICAgICAgICBleHBlY3QobW9ja1JlcG9zaXRvcnkuZmluZEJ5SWQpLnRvSGF2ZUJlZW5DYWxsZWQoKTtcbiAgICAgICAgICAgIGV4cGVjdChtb2NrUmVwb3NpdG9yeS5zYXZlKS50b0hhdmVCZWVuQ2FsbGVkKCk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGl0KCdzaG91bGQgZmFsbGJhY2sgdG8gZmlsZW5hbWUgd2hlbiBVVUlEIG5vdCBmb3VuZCcsIGFzeW5jICgpID0+IHtcbiAgICAgICAgICAgIG1vY2tSZXBvc2l0b3J5LmZpbmRCeUlkLm1vY2tSZXNvbHZlZFZhbHVlKG51bGwpO1xuICAgICAgICAgICAgbW9ja1JlcG9zaXRvcnkuZmluZEJ5RmlsZW5hbWUubW9ja1Jlc29sdmVkVmFsdWUodGVzdEFzc2V0KTtcbiAgICAgICAgICAgIG1vY2tSZXBvc2l0b3J5LnNhdmUubW9ja1Jlc29sdmVkVmFsdWUodW5kZWZpbmVkKTtcblxuICAgICAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdXNlQ2FzZS5leGVjdXRlKHtcbiAgICAgICAgICAgICAgICBhc3NldElkOiAnTXlBc3NldC5tZCcsXG4gICAgICAgICAgICAgICAgcHJvcGVydHlOYW1lOiAndGVzdFByb3AnLFxuICAgICAgICAgICAgICAgIHZhbHVlOiAnbmV3VmFsdWUnLFxuICAgICAgICAgICAgICAgIHByb3BlcnR5RGVmaW5pdGlvbjoge1xuICAgICAgICAgICAgICAgICAgICBwcm9wZXJ0eU5hbWU6ICd0ZXN0UHJvcCcsXG4gICAgICAgICAgICAgICAgICAgIGxhYmVsOiAnVGVzdCBQcm9wZXJ0eScsXG4gICAgICAgICAgICAgICAgICAgIHJhbmdlOiAnc3RyaW5nJyxcbiAgICAgICAgICAgICAgICAgICAgaXNSZXF1aXJlZDogZmFsc2VcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgZXhwZWN0KHJlc3VsdC5pc1N1Y2Nlc3MpLnRvQmUodHJ1ZSk7XG4gICAgICAgICAgICBleHBlY3QobW9ja1JlcG9zaXRvcnkuZmluZEJ5SWQpLnRvSGF2ZUJlZW5DYWxsZWQoKTtcbiAgICAgICAgICAgIGV4cGVjdChtb2NrUmVwb3NpdG9yeS5maW5kQnlGaWxlbmFtZSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoJ015QXNzZXQubWQnKTtcbiAgICAgICAgICAgIGV4cGVjdChtb2NrUmVwb3NpdG9yeS5zYXZlKS50b0hhdmVCZWVuQ2FsbGVkKCk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGl0KCdzaG91bGQgaGFuZGxlIGZpbGVuYW1lIHdpdGhvdXQgZXh0ZW5zaW9uJywgYXN5bmMgKCkgPT4ge1xuICAgICAgICAgICAgbW9ja1JlcG9zaXRvcnkuZmluZEJ5SWQubW9ja1Jlc29sdmVkVmFsdWUobnVsbCk7XG4gICAgICAgICAgICBtb2NrUmVwb3NpdG9yeS5maW5kQnlGaWxlbmFtZS5tb2NrUmVzb2x2ZWRWYWx1ZSh0ZXN0QXNzZXQpO1xuICAgICAgICAgICAgbW9ja1JlcG9zaXRvcnkuc2F2ZS5tb2NrUmVzb2x2ZWRWYWx1ZSh1bmRlZmluZWQpO1xuXG4gICAgICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB1c2VDYXNlLmV4ZWN1dGUoe1xuICAgICAgICAgICAgICAgIGFzc2V0SWQ6ICdNeUFzc2V0JyxcbiAgICAgICAgICAgICAgICBwcm9wZXJ0eU5hbWU6ICd0ZXN0UHJvcCcsXG4gICAgICAgICAgICAgICAgdmFsdWU6ICduZXdWYWx1ZScsXG4gICAgICAgICAgICAgICAgcHJvcGVydHlEZWZpbml0aW9uOiB7XG4gICAgICAgICAgICAgICAgICAgIHByb3BlcnR5TmFtZTogJ3Rlc3RQcm9wJyxcbiAgICAgICAgICAgICAgICAgICAgbGFiZWw6ICdUZXN0IFByb3BlcnR5JyxcbiAgICAgICAgICAgICAgICAgICAgcmFuZ2U6ICdzdHJpbmcnLFxuICAgICAgICAgICAgICAgICAgICBpc1JlcXVpcmVkOiBmYWxzZVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBleHBlY3QocmVzdWx0LmlzU3VjY2VzcykudG9CZSh0cnVlKTtcbiAgICAgICAgICAgIGV4cGVjdChtb2NrUmVwb3NpdG9yeS5maW5kQnlGaWxlbmFtZSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoJ015QXNzZXQnKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgaXQoJ3Nob3VsZCByZXR1cm4gZXJyb3Igd2hlbiBhc3NldCBub3QgZm91bmQgYnkgYW55IG1ldGhvZCcsIGFzeW5jICgpID0+IHtcbiAgICAgICAgICAgIG1vY2tSZXBvc2l0b3J5LmZpbmRCeUlkLm1vY2tSZXNvbHZlZFZhbHVlKG51bGwpO1xuICAgICAgICAgICAgbW9ja1JlcG9zaXRvcnkuZmluZEJ5RmlsZW5hbWUubW9ja1Jlc29sdmVkVmFsdWUobnVsbCk7XG5cbiAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHVzZUNhc2UuZXhlY3V0ZSh7XG4gICAgICAgICAgICAgICAgYXNzZXRJZDogJ05vbkV4aXN0ZW50JyxcbiAgICAgICAgICAgICAgICBwcm9wZXJ0eU5hbWU6ICd0ZXN0UHJvcCcsXG4gICAgICAgICAgICAgICAgdmFsdWU6ICduZXdWYWx1ZScsXG4gICAgICAgICAgICAgICAgcHJvcGVydHlEZWZpbml0aW9uOiB7XG4gICAgICAgICAgICAgICAgICAgIHByb3BlcnR5TmFtZTogJ3Rlc3RQcm9wJyxcbiAgICAgICAgICAgICAgICAgICAgbGFiZWw6ICdUZXN0IFByb3BlcnR5JyxcbiAgICAgICAgICAgICAgICAgICAgcmFuZ2U6ICdzdHJpbmcnLFxuICAgICAgICAgICAgICAgICAgICBpc1JlcXVpcmVkOiBmYWxzZVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBleHBlY3QocmVzdWx0LmlzRmFpbHVyZSkudG9CZSh0cnVlKTtcbiAgICAgICAgICAgIGV4cGVjdChyZXN1bHQuZXJyb3IpLnRvQ29udGFpbignQXNzZXQgbm90IGZvdW5kJyk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGl0KCdzaG91bGQgaGFuZGxlIGZpbGUgcGF0aHMgYXMgaWRlbnRpZmllcnMnLCBhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICBtb2NrUmVwb3NpdG9yeS5maW5kQnlJZC5tb2NrUmVzb2x2ZWRWYWx1ZShudWxsKTtcbiAgICAgICAgICAgIG1vY2tSZXBvc2l0b3J5LmZpbmRCeUZpbGVuYW1lLm1vY2tSZXNvbHZlZFZhbHVlKHRlc3RBc3NldCk7XG4gICAgICAgICAgICBtb2NrUmVwb3NpdG9yeS5zYXZlLm1vY2tSZXNvbHZlZFZhbHVlKHVuZGVmaW5lZCk7XG5cbiAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHVzZUNhc2UuZXhlY3V0ZSh7XG4gICAgICAgICAgICAgICAgYXNzZXRJZDogJ2ZvbGRlci9zdWJmb2xkZXIvTXlBc3NldC5tZCcsXG4gICAgICAgICAgICAgICAgcHJvcGVydHlOYW1lOiAndGVzdFByb3AnLFxuICAgICAgICAgICAgICAgIHZhbHVlOiAnbmV3VmFsdWUnLFxuICAgICAgICAgICAgICAgIHByb3BlcnR5RGVmaW5pdGlvbjoge1xuICAgICAgICAgICAgICAgICAgICBwcm9wZXJ0eU5hbWU6ICd0ZXN0UHJvcCcsXG4gICAgICAgICAgICAgICAgICAgIGxhYmVsOiAnVGVzdCBQcm9wZXJ0eScsXG4gICAgICAgICAgICAgICAgICAgIHJhbmdlOiAnc3RyaW5nJyxcbiAgICAgICAgICAgICAgICAgICAgaXNSZXF1aXJlZDogZmFsc2VcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgZXhwZWN0KHJlc3VsdC5pc1N1Y2Nlc3MpLnRvQmUodHJ1ZSk7XG4gICAgICAgICAgICBleHBlY3QobW9ja1JlcG9zaXRvcnkuZmluZEJ5RmlsZW5hbWUpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKCdmb2xkZXIvc3ViZm9sZGVyL015QXNzZXQubWQnKTtcbiAgICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBkZXNjcmliZSgncHJvcGVydHkgdmFsaWRhdGlvbicsICgpID0+IHtcbiAgICAgICAgY29uc3QgdGVzdEFzc2V0ID0gQXNzZXQuY3JlYXRlKHtcbiAgICAgICAgICAgIGlkOiBBc3NldElkLmdlbmVyYXRlKCksXG4gICAgICAgICAgICBsYWJlbDogJ1Rlc3QgQXNzZXQnLFxuICAgICAgICAgICAgY2xhc3NOYW1lOiBDbGFzc05hbWUuY3JlYXRlKCdUZXN0Q2xhc3MnKS5nZXRWYWx1ZSgpISxcbiAgICAgICAgICAgIG9udG9sb2d5OiBPbnRvbG9neVByZWZpeC5jcmVhdGUoJ3Rlc3QnKS5nZXRWYWx1ZSgpISxcbiAgICAgICAgICAgIHByb3BlcnRpZXM6IHt9XG4gICAgICAgIH0pLmdldFZhbHVlKCkhO1xuXG4gICAgICAgIGJlZm9yZUVhY2goKCkgPT4ge1xuICAgICAgICAgICAgbW9ja1JlcG9zaXRvcnkuZmluZEJ5SWQubW9ja1Jlc29sdmVkVmFsdWUodGVzdEFzc2V0KTtcbiAgICAgICAgICAgIG1vY2tSZXBvc2l0b3J5LnNhdmUubW9ja1Jlc29sdmVkVmFsdWUodW5kZWZpbmVkKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgaXQoJ3Nob3VsZCB2YWxpZGF0ZSByZXF1aXJlZCBmaWVsZHMnLCBhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB1c2VDYXNlLmV4ZWN1dGUoe1xuICAgICAgICAgICAgICAgIGFzc2V0SWQ6ICd0ZXN0LWlkJyxcbiAgICAgICAgICAgICAgICBwcm9wZXJ0eU5hbWU6ICdyZXF1aXJlZFByb3AnLFxuICAgICAgICAgICAgICAgIHZhbHVlOiAnJyxcbiAgICAgICAgICAgICAgICBwcm9wZXJ0eURlZmluaXRpb246IHtcbiAgICAgICAgICAgICAgICAgICAgcHJvcGVydHlOYW1lOiAncmVxdWlyZWRQcm9wJyxcbiAgICAgICAgICAgICAgICAgICAgbGFiZWw6ICdSZXF1aXJlZCBQcm9wZXJ0eScsXG4gICAgICAgICAgICAgICAgICAgIHJhbmdlOiAnc3RyaW5nJyxcbiAgICAgICAgICAgICAgICAgICAgaXNSZXF1aXJlZDogdHJ1ZVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBleHBlY3QocmVzdWx0LmlzRmFpbHVyZSkudG9CZSh0cnVlKTtcbiAgICAgICAgICAgIGV4cGVjdChyZXN1bHQuZXJyb3IpLnRvQ29udGFpbignUmVxdWlyZWQgUHJvcGVydHkgaXMgcmVxdWlyZWQnKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgaXQoJ3Nob3VsZCBhbGxvdyBlbXB0eSB2YWx1ZXMgZm9yIG9wdGlvbmFsIGZpZWxkcycsIGFzeW5jICgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHVzZUNhc2UuZXhlY3V0ZSh7XG4gICAgICAgICAgICAgICAgYXNzZXRJZDogJ3Rlc3QtaWQnLFxuICAgICAgICAgICAgICAgIHByb3BlcnR5TmFtZTogJ29wdGlvbmFsUHJvcCcsXG4gICAgICAgICAgICAgICAgdmFsdWU6ICcnLFxuICAgICAgICAgICAgICAgIHByb3BlcnR5RGVmaW5pdGlvbjoge1xuICAgICAgICAgICAgICAgICAgICBwcm9wZXJ0eU5hbWU6ICdvcHRpb25hbFByb3AnLFxuICAgICAgICAgICAgICAgICAgICBsYWJlbDogJ09wdGlvbmFsIFByb3BlcnR5JyxcbiAgICAgICAgICAgICAgICAgICAgcmFuZ2U6ICdzdHJpbmcnLFxuICAgICAgICAgICAgICAgICAgICBpc1JlcXVpcmVkOiBmYWxzZVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBleHBlY3QocmVzdWx0LmlzU3VjY2VzcykudG9CZSh0cnVlKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgaXQoJ3Nob3VsZCB2YWxpZGF0ZSBlbnVtIHZhbHVlcycsIGFzeW5jICgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHVzZUNhc2UuZXhlY3V0ZSh7XG4gICAgICAgICAgICAgICAgYXNzZXRJZDogJ3Rlc3QtaWQnLFxuICAgICAgICAgICAgICAgIHByb3BlcnR5TmFtZTogJ3N0YXR1c1Byb3AnLFxuICAgICAgICAgICAgICAgIHZhbHVlOiAnaW52YWxpZCcsXG4gICAgICAgICAgICAgICAgcHJvcGVydHlEZWZpbml0aW9uOiB7XG4gICAgICAgICAgICAgICAgICAgIHByb3BlcnR5TmFtZTogJ3N0YXR1c1Byb3AnLFxuICAgICAgICAgICAgICAgICAgICBsYWJlbDogJ1N0YXR1cycsXG4gICAgICAgICAgICAgICAgICAgIHJhbmdlOiAnZW51bTpwZW5kaW5nLGFjdGl2ZSxjb21wbGV0ZWQnLFxuICAgICAgICAgICAgICAgICAgICBpc1JlcXVpcmVkOiB0cnVlXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGV4cGVjdChyZXN1bHQuaXNGYWlsdXJlKS50b0JlKHRydWUpO1xuICAgICAgICAgICAgZXhwZWN0KHJlc3VsdC5lcnJvcikudG9Db250YWluKCdTdGF0dXMgbXVzdCBiZSBvbmUgb2Y6IHBlbmRpbmcsIGFjdGl2ZSwgY29tcGxldGVkJyk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGl0KCdzaG91bGQgdmFsaWRhdGUgZGF0ZSBmb3JtYXQnLCBhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB1c2VDYXNlLmV4ZWN1dGUoe1xuICAgICAgICAgICAgICAgIGFzc2V0SWQ6ICd0ZXN0LWlkJyxcbiAgICAgICAgICAgICAgICBwcm9wZXJ0eU5hbWU6ICdkYXRlUHJvcCcsXG4gICAgICAgICAgICAgICAgdmFsdWU6ICdub3QtYS1kYXRlJyxcbiAgICAgICAgICAgICAgICBwcm9wZXJ0eURlZmluaXRpb246IHtcbiAgICAgICAgICAgICAgICAgICAgcHJvcGVydHlOYW1lOiAnZGF0ZVByb3AnLFxuICAgICAgICAgICAgICAgICAgICBsYWJlbDogJ0RhdGUnLFxuICAgICAgICAgICAgICAgICAgICByYW5nZTogJ2RhdGUnLFxuICAgICAgICAgICAgICAgICAgICBpc1JlcXVpcmVkOiB0cnVlXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGV4cGVjdChyZXN1bHQuaXNGYWlsdXJlKS50b0JlKHRydWUpO1xuICAgICAgICAgICAgZXhwZWN0KHJlc3VsdC5lcnJvcikudG9Db250YWluKCdEYXRlIG11c3QgYmUgYSB2YWxpZCBkYXRlJyk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGl0KCdzaG91bGQgdmFsaWRhdGUgY3VzdG9tIHJlZ2V4IHBhdHRlcm5zJywgYXN5bmMgKCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdXNlQ2FzZS5leGVjdXRlKHtcbiAgICAgICAgICAgICAgICBhc3NldElkOiAndGVzdC1pZCcsXG4gICAgICAgICAgICAgICAgcHJvcGVydHlOYW1lOiAnZW1haWxQcm9wJyxcbiAgICAgICAgICAgICAgICB2YWx1ZTogJ2ludmFsaWQtZW1haWwnLFxuICAgICAgICAgICAgICAgIHByb3BlcnR5RGVmaW5pdGlvbjoge1xuICAgICAgICAgICAgICAgICAgICBwcm9wZXJ0eU5hbWU6ICdlbWFpbFByb3AnLFxuICAgICAgICAgICAgICAgICAgICBsYWJlbDogJ0VtYWlsJyxcbiAgICAgICAgICAgICAgICAgICAgcmFuZ2U6ICdzdHJpbmcnLFxuICAgICAgICAgICAgICAgICAgICBpc1JlcXVpcmVkOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICB2YWxpZGF0aW9uOiAnXltcXFxcd1xcXFwuLV0rQFtcXFxcd1xcXFwuLV0rXFxcXC5cXFxcdyskJ1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBleHBlY3QocmVzdWx0LmlzRmFpbHVyZSkudG9CZSh0cnVlKTtcbiAgICAgICAgICAgIGV4cGVjdChyZXN1bHQuZXJyb3IpLnRvQ29udGFpbignRW1haWwgZm9ybWF0IGlzIGludmFsaWQnKTtcbiAgICAgICAgfSk7XG4gICAgfSk7XG59KTsiXSwidmVyc2lvbiI6M30=